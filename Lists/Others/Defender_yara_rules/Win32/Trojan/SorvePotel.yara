rule Trojan_Win32_SorvePotel_AKKB_2147957173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:Win32/SorvePotel.AKKB!MTB"
        threat_id = "2147957173"
        type = "Trojan"
        platform = "Win32: Windows 32-bit platform"
        family = "SorvePotel"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_AUTOITHSTR_EXT"
        threshold = "28"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = "DLLCALL ( \"kernel32.dll\" , \"handle\" , \"GetCurrentThread\" )" ascii //weight: 4
        $x_4_2 = {44 00 4c 00 4c 00 43 00 41 00 4c 00 4c 00 20 00 28 00 20 00 22 00 73 00 68 00 6c 00 77 00 61 00 70 00 69 00 2e 00 64 00 6c 00 6c 00 22 00 20 00 2c 00 20 00 22 00 6c 00 6f 00 6e 00 67 00 22 00 20 00 2c 00 20 00 22 00 55 00 72 00 6c 00 43 00 72 00 65 00 61 00 74 00 65 00 46 00 72 00 6f 00 6d 00 50 00 61 00 74 00 68 00 57 00 22 00 20 00 2c 00 20 00 22 00 77 00 73 00 74 00 72 00 22 00 20 00 2c 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 22 00 77 00 73 00 74 00 72 00 22 00 20 00 2c 00 20 00 22 00 22 00 20 00 2c 00 20 00 22 00 64 00 77 00 6f 00 72 00 64 00 2a 00 22 00 20 00 2c 00 20 00 34 00 30 00 39 00 36 00 20 00 2c 00 20 00 22 00 64 00 77 00 6f 00 72 00 64 00 22 00 20 00 2c 00 20 00 30 00 20 00 29 00}  //weight: 4, accuracy: Low
        $x_4_3 = {44 4c 4c 43 41 4c 4c 20 28 20 22 73 68 6c 77 61 70 69 2e 64 6c 6c 22 20 2c 20 22 6c 6f 6e 67 22 20 2c 20 22 55 72 6c 43 72 65 61 74 65 46 72 6f 6d 50 61 74 68 57 22 20 2c 20 22 77 73 74 72 22 20 2c 20 24 [0-50] 20 2c 20 22 77 73 74 72 22 20 2c 20 22 22 20 2c 20 22 64 77 6f 72 64 2a 22 20 2c 20 34 30 39 36 20 2c 20 22 64 77 6f 72 64 22 20 2c 20 30 20 29}  //weight: 4, accuracy: Low
        $x_2_4 = {44 00 4c 00 4c 00 53 00 54 00 52 00 55 00 43 00 54 00 43 00 52 00 45 00 41 00 54 00 45 00 20 00 28 00 20 00 22 00 70 00 74 00 72 00 5b 00 22 00 20 00 26 00 20 00 24 00 [0-50] 20 00 26 00 20 00 22 00 5d 00 22 00 20 00 29 00}  //weight: 2, accuracy: Low
        $x_2_5 = {44 4c 4c 53 54 52 55 43 54 43 52 45 41 54 45 20 28 20 22 70 74 72 5b 22 20 26 20 24 [0-50] 20 26 20 22 5d 22 20 29}  //weight: 2, accuracy: Low
        $x_2_6 = {46 00 49 00 4c 00 45 00 4f 00 50 00 45 00 4e 00 20 00 28 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 24 00 [0-50] 20 00 2b 00 20 00 24 00 [0-50] 20 00 29 00}  //weight: 2, accuracy: Low
        $x_2_7 = {46 49 4c 45 4f 50 45 4e 20 28 20 24 [0-50] 20 2c 20 24 [0-50] 20 2b 20 24 [0-50] 20 29}  //weight: 2, accuracy: Low
        $x_2_8 = "&= CHR ( RANDOM ( 97 , 122 , 1 ) )" ascii //weight: 2
        $x_2_9 = {42 00 49 00 54 00 53 00 48 00 49 00 46 00 54 00 20 00 28 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 38 00 20 00 29 00}  //weight: 2, accuracy: Low
        $x_2_10 = {42 49 54 53 48 49 46 54 20 28 20 24 [0-50] 20 2c 20 38 20 29}  //weight: 2, accuracy: Low
        $x_4_11 = {42 00 49 00 54 00 58 00 4f 00 52 00 20 00 28 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 42 00 49 00 54 00 41 00 4e 00 44 00 20 00 28 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 32 00 35 00 35 00 20 00 29 00 20 00 29 00}  //weight: 4, accuracy: Low
        $x_4_12 = {42 49 54 58 4f 52 20 28 20 24 [0-50] 20 2c 20 42 49 54 41 4e 44 20 28 20 24 [0-50] 20 2c 20 32 35 35 20 29 20 29}  //weight: 4, accuracy: Low
        $x_4_13 = {42 00 49 00 54 00 41 00 4e 00 44 00 20 00 28 00 20 00 28 00 20 00 42 00 49 00 54 00 41 00 4e 00 44 00 20 00 28 00 20 00 28 00 20 00 24 00 [0-50] 20 00 2b 00 20 00 24 00 [0-50] 20 00 29 00 20 00 2c 00 20 00 32 00 35 00 35 00 20 00 29 00 20 00 2a 00 20 00 24 00 [0-50] 20 00 2b 00 20 00 24 00 [0-50] 20 00 29 00 20 00 2c 00 20 00 36 00 35 00 35 00 33 00 35 00 20 00 29 00}  //weight: 4, accuracy: Low
        $x_4_14 = {42 49 54 41 4e 44 20 28 20 28 20 42 49 54 41 4e 44 20 28 20 28 20 24 [0-50] 20 2b 20 24 [0-50] 20 29 20 2c 20 32 35 35 20 29 20 2a 20 24 [0-50] 20 2b 20 24 [0-50] 20 29 20 2c 20 36 35 35 33 35 20 29}  //weight: 4, accuracy: Low
        $x_4_15 = {44 00 4c 00 4c 00 43 00 41 00 4c 00 4c 00 20 00 28 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 22 00 62 00 6f 00 6f 00 6c 00 22 00 20 00 2c 00 20 00 22 00 56 00 69 00 72 00 74 00 75 00 61 00 6c 00 50 00 72 00 6f 00 74 00 65 00 63 00 74 00 22 00 20 00 2c 00 20 00 22 00 70 00 74 00 72 00 22 00 20 00 2c 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 22 00 75 00 6c 00 6f 00 6e 00 67 00 5f 00 70 00 74 00 72 00 22 00 20 00 2c 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 22 00 64 00 77 00 6f 00 72 00 64 00 22 00 20 00 2c 00 20 00 24 00 [0-50] 20 00 2c 00 20 00 22 00 64 00 77 00 6f 00 72 00 64 00 2a 00 22 00 20 00 2c 00 20 00 24 00 [0-50] 20 00 29 00}  //weight: 4, accuracy: Low
        $x_4_16 = {44 4c 4c 43 41 4c 4c 20 28 20 24 [0-50] 20 2c 20 22 62 6f 6f 6c 22 20 2c 20 22 56 69 72 74 75 61 6c 50 72 6f 74 65 63 74 22 20 2c 20 22 70 74 72 22 20 2c 20 24 [0-50] 20 2c 20 22 75 6c 6f 6e 67 5f 70 74 72 22 20 2c 20 24 [0-50] 20 2c 20 22 64 77 6f 72 64 22 20 2c 20 24 [0-50] 20 2c 20 22 64 77 6f 72 64 2a 22 20 2c 20 24 [0-50] 20 29}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_4_*) and 6 of ($x_2_*))) or
            ((5 of ($x_4_*) and 4 of ($x_2_*))) or
            ((6 of ($x_4_*) and 2 of ($x_2_*))) or
            ((7 of ($x_4_*))) or
            (all of ($x*))
        )
}

