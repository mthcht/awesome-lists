rule Trojan_MSIL_AgentTesla_E_2147730435_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.E!MTB"
        threat_id = "2147730435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "highscores.dat" wide //weight: 1
        $x_1_2 = "GameManager" ascii //weight: 1
        $x_1_3 = "add_GameOver" ascii //weight: 1
        $x_1_4 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_5 = "OutputDebugString" ascii //weight: 1
        $x_1_6 = "VirtualProtect" ascii //weight: 1
        $x_1_7 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_8 = "NtQueryInformationProcess" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_E_2147730435_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.E!MTB"
        threat_id = "2147730435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {69 6e 73 74 61 6c 6c 75 74 69 6c 20 2f 6c 6f 67 74 6f 63 6f 6e 73 6f 6c 65 3d 66 61 6c 73 65 20 2f 6c 6f 67 66 69 6c 65 3d 20 2f 75 20 22 20 26 20 43 68 72 77 28 33 34 29 20 26 20 22 25 [0-6] 25 22 20 26 20 43 68 72 77 28 33 34 29}  //weight: 1, accuracy: Low
        $x_1_2 = "strs = str()" ascii //weight: 1
        $x_1_3 = "CreateObject(\"WScript.Shell\").run strs,0,false" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_E_2147730435_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.E!MTB"
        threat_id = "2147730435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {0f 00 00 00 1e 01 00 00 aa}  //weight: 3, accuracy: High
        $x_3_2 = "Telligent Evolution platform" ascii //weight: 3
        $x_3_3 = "Alex Crome" ascii //weight: 3
        $x_3_4 = "PermissionViewer.Properties.Resources.resources" ascii //weight: 3
        $x_3_5 = "HttpStatusCode" ascii //weight: 3
        $x_3_6 = "HttpWebResponse" ascii //weight: 3
        $x_3_7 = "ToBase64String" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_E_2147730435_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.E!MTB"
        threat_id = "2147730435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 d5 a2 eb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 90 00 00 00 12 00 00 00 97 00 00 00 4a 02 00 00 bb 00 00 00 fa}  //weight: 3, accuracy: High
        $x_3_2 = "Microsoft.VisualBasic.Devices" ascii //weight: 3
        $x_3_3 = "ShakeOfTheDay.Resources.resources" ascii //weight: 3
        $x_3_4 = "SqlConnection" ascii //weight: 3
        $x_3_5 = "System.Data.SqlClient" ascii //weight: 3
        $x_3_6 = "Services.Protocols.SoapHttpClientProtocol" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_E_2147730435_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.E!MTB"
        threat_id = "2147730435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VIPETSDYSYUYSDYSSIUSUDYUSDUISD.VIPETSDYSYUYSDYSSIUSUDYUSDUISD" wide //weight: 1
        $x_1_2 = "Users\\VICTOR" ascii //weight: 1
        $x_1_3 = "Hello World!" wide //weight: 1
        $x_1_4 = ".000webhostapp.com/VIPETSDYSYUYSDYSSIUSUDYUSDUISD.dll" wide //weight: 1
        $x_1_5 = {20 00 01 00 00 14 11 05 11 04 74 01 00 00 1b 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147731836_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla!MTB"
        threat_id = "2147731836"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 2d 43 00 38 a2 ?? ?? 00 72 7d ?? ?? 70 38 9e ?? ?? 00 38 a3 ?? ?? 00 38 a4 ?? ?? 00 72 e3 ?? ?? 70 38 a4 ?? ?? 00 38 a9 ?? ?? 00 38 aa ?? ?? 00 8e 69 15}  //weight: 2, accuracy: Low
        $x_2_2 = {07 8e 69 5d 91 06 11 04 91 61 d2 9c}  //weight: 2, accuracy: High
        $x_1_3 = "ToArray" ascii //weight: 1
        $x_1_4 = "WebRequest" ascii //weight: 1
        $x_1_5 = "GetResponseStream" ascii //weight: 1
        $x_1_6 = "GetDirectoryName" ascii //weight: 1
        $x_1_7 = "Encoding" ascii //weight: 1
        $x_1_8 = "GetBytes" ascii //weight: 1
        $x_1_9 = "http://tlsprotectgo.xyz/EmE6d/Mddoryz_Vbilvvxs.jpg" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147731836_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla!MTB"
        threat_id = "2147731836"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {d0 01 00 00 02 28 d1 00 00 0a 6f 8e 05 00 0a fe 0e 00 00 20 08 00 00 00 8d b5 00 00 01 80 8d 03 00 04 7e 8d 03 00 04 20 00 00 00 00 11 00 20 d1 00 00 0a 6f 8f 05 00 0a 6f 90 05 00 0a 13 01 12 01}  //weight: 1, accuracy: High
        $x_1_2 = "ToArray" ascii //weight: 1
        $x_1_3 = "Debugger" ascii //weight: 1
        $x_1_4 = "get_ManagedThreadId" ascii //weight: 1
        $x_1_5 = "InitializeArray" ascii //weight: 1
        $x_1_6 = "ToInt32" ascii //weight: 1
        $x_1_7 = "Encoding" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "GetILGenerator" ascii //weight: 1
        $x_1_10 = "LoadLibrary" ascii //weight: 1
        $x_1_11 = "GetProcAddress" ascii //weight: 1
        $x_1_12 = "VirtualProtect" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_A_2147735801_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.A"
        threat_id = "2147735801"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "What is the length of the left side" wide //weight: 1
        $x_1_2 = "What do you want to compute" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147741843_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla"
        threat_id = "2147741843"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "110"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "ProcessedByXenocode" ascii //weight: 10
        $x_10_2 = "SmartAssembly.Attributes.PoweredByAttribute" ascii //weight: 10
        $x_10_3 = "NineRays.Obfuscator.Evaluation" ascii //weight: 10
        $x_10_4 = "ObfuscatedByGoliath" ascii //weight: 10
        $x_10_5 = "YanoAttribute" ascii //weight: 10
        $x_10_6 = "BabelObfuscatorAttribute" ascii //weight: 10
        $x_10_7 = "CryptoObfuscator.ProtectedWithCryptoObfuscatorAttribute" ascii //weight: 10
        $x_10_8 = "DotNetPatcherObfuscatorAttribute" ascii //weight: 10
        $x_10_9 = "DotfuscatorAttribute" ascii //weight: 10
        $x_10_10 = "DotNetPatcherPackerAttribute" ascii //weight: 10
        $x_1_11 = "Select * from Win32_ComputerSystem" wide //weight: 1
        $x_1_12 = "SuppressUnmanagedCodeSecurity" ascii //weight: 1
        $x_1_13 = {53 79 73 74 65 6d 2e 53 65 63 75 72 69 74 79 2e 43 72 79 70 74 6f 67 72 61 70 68 79 00 44 65 66 69 6e 65 44 79 6e 61 6d 69 63 41 73 73 65 6d 62 6c 79}  //weight: 1, accuracy: High
        $x_1_14 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_15 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_16 = "System.Runtime.CompilerServices" ascii //weight: 1
        $x_1_17 = {44 65 62 75 67 67 65 72 00 4d 61 6e 61 67 65 6d 65 6e 74 4f 62 6a 65 63 74 53 65 61 72 63 68 65 72}  //weight: 1, accuracy: High
        $x_1_18 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_19 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_20 = "MethodImplAttributes" ascii //weight: 1
        $x_1_21 = "lpProcessAttributes" ascii //weight: 1
        $x_1_22 = "CompilationRelaxationsAttribute" ascii //weight: 1
        $x_1_23 = "CompilerGeneratedAttribute" ascii //weight: 1
        $x_1_24 = "UnverifiableCodeAttribute" ascii //weight: 1
        $x_1_25 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((10 of ($x_10_*) and 10 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AD_2147742722_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AD!MTB"
        threat_id = "2147742722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 15 a2 0b 09 09 00 00 00 10 00 03 00 00 00 00 01 00 00 00 3e 00 00 00 0e 00 00 00 13 00 00 00 25}  //weight: 3, accuracy: High
        $x_3_2 = "loader/uploads" wide //weight: 3
        $x_3_3 = "ServicePointManager" ascii //weight: 3
        $x_3_4 = "System.Net" ascii //weight: 3
        $x_3_5 = "set_SecurityProtocol" ascii //weight: 3
        $x_3_6 = "WebRequest" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AD_2147742722_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AD!MTB"
        threat_id = "2147742722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {67 65 74 5f 4f 66 66 73 65 74 4d 61 72 73 68 61 6c 65 72 00 67 65 74 5f 52 65 74 75 72 6e 4d 65 73 73 61 67 65 00 4f 66 66 73 65 74 4d 61 72 73 68 61 6c 65 72 00 52 65 74 75 72 6e 4d 65 73 73 61 67 65}  //weight: 1, accuracy: High
        $x_1_2 = {52 65 76 65 72 73 65 00 74 65 78 74 00 67 65 74 5f 41 6c 6c 6f 77 44 72 6f 70 00 73 65 74 5f 41 6c 6c 6f 77 44 72 6f 70}  //weight: 1, accuracy: High
        $x_1_3 = "CreateDirectory" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AD_2147742722_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AD!MTB"
        threat_id = "2147742722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {20 49 0c 00 00 95 e0 95 7e 33 00 00 04 20 a0 05 00 00 95 61 7e 33 00 00 04 20 03 02 00 00 95 2e 05 07 0b 17 2b 01 16 58}  //weight: 4, accuracy: High
        $x_4_2 = {19 9a 20 9e 08 00 00 95 2e 03 16 2b 01 17 17 59 7e 1d 00 00 04 19 9a 20 1c 03 00 00 95 5f 7e 1d 00 00 04 19 9a 20 e5 02 00 00 95 61 58}  //weight: 4, accuracy: High
        $x_4_3 = {19 9a 1f 13 95 e0 95 35 03 16 2b 01 17 17 59 7e 18 00 00 04 20 cb 0e 00 00 95 5f 7e 18 00 00 04 20 9a 01 00 00 95 61 58}  //weight: 4, accuracy: High
        $x_4_4 = {08 13 10 18 9a 11 10 0c 7e 28 01 00 04 20 5e 04 00 00 95 e0 95 7e 28 01 00 04 20 95 06 00 00 95 61 11 10 13 10}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AD_2147742722_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AD!MTB"
        threat_id = "2147742722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 ff 03 3e 09 1f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 38 01 00 00 32 01 00 00 bb 04 00 00 49}  //weight: 3, accuracy: High
        $x_3_2 = "System.Security.Cryptography.AesCryptoServiceProvider" ascii //weight: 3
        $x_3_3 = "{11111-22222-10009-11112}" ascii //weight: 3
        $x_3_4 = "hOOWd989DTOHFEOtZr.dVHUYZkf5VVcnHC4cP" ascii //weight: 3
        $x_3_5 = "{11111-22222-50001-00000}" ascii //weight: 3
        $x_3_6 = "GetDelegateForFunctionPointer" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MR_2147744805_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MR!MTB"
        threat_id = "2147744805"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 06 07 08 09 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 04 11 04 72 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 05 11 05 6f ?? ?? ?? ?? 16 9a 13 06 73 ?? ?? ?? ?? ?? ?? ?? ?? ?? 11 06 6f ?? ?? ?? ?? 14 1c 00 d0 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 14 14 17 8d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MR_2147744805_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MR!MTB"
        threat_id = "2147744805"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "48"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "wcm9ncmFtIGNhbm5vdC" wide //weight: 10
        $x_10_2 = "WIPoCYvIg8" wide //weight: 10
        $x_10_3 = "9Zj8bOQdRSDkHUUg" wide //weight: 10
        $x_3_4 = "Replace" ascii //weight: 3
        $x_3_5 = "FromBase64String" ascii //weight: 3
        $x_3_6 = "MNNHHGHJFJHBBNNHHUT" wide //weight: 3
        $x_3_7 = "TRASH" wide //weight: 3
        $x_3_8 = "ERERRWRWRWSGGSAGDHHJHJBNCBNCBN" wide //weight: 3
        $x_3_9 = "DebuggableAttribute" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PA_2147744864_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PA!MTB"
        threat_id = "2147744864"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 06 07 02 07 91 03 07 03 8e 69 5d 91 61 d2 9c 00 07 17 58 0b 07 02 8e 69 fe 04 0c 08 3a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PA_2147744864_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PA!MTB"
        threat_id = "2147744864"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 1f 61 32 0b 11 04 1f 7a fe 02 16 fe 01 2b 01 16 13 05 11 05 2c 24 00 11 04 1f 0d 58 13 06 11 06 1f 7a fe 02 13 07 11 07 2c 07 11 06 1f 1a 59 13 06 06 09 11 06 d1 9d 00 2b}  //weight: 1, accuracy: High
        $x_1_2 = {11 04 1f 41 32 0b 11 04 1f 5a fe 02 16 fe 01 2b 01 16 13 08 11 08 2c 24 00 11 04 1f 0d 58 13 09 11 09 1f 5a fe 02 13 0a 11 0a 2c 07 11 09 1f 1a 59 13 09 06 09 11 09 d1 9d 00 2b 07 00 06 09 11 04 9d 00 00 09 17 58 0d 09 02 6f ?? 00 00 0a fe 04 13 0b 11 0b 3a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_TQI_2147745146_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TQI!MTB"
        threat_id = "2147745146"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 02 09 11 05 6f ?? ?? ?? ?? 13 06 11 06 16 16 16 16 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 07 11 07 2c 2d 00 06 19 8d ?? ?? ?? ?? 25 16 12 06 28 ?? ?? ?? ?? 9c 25 17 12 06 28 ?? ?? ?? ?? 9c 25 18 12 06 28 ?? ?? ?? ?? 9c 6f ?? ?? ?? ?? 00 00 00 11 05 17 d6 13 05 11 05 11 04 fe 02 16 fe 01 13 08 11 08 2d 9b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MI_2147748450_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MI!MTB"
        threat_id = "2147748450"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 0c 02 00 20 ?? ?? ?? ?? fe 01 39 27 00 00 00 20 23 00 00 00 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 20 02 00 00 00 fe 0e 02 00}  //weight: 1, accuracy: Low
        $x_1_2 = "/optimize+ /platform:X86 /target:library" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MI_2147748450_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MI!MTB"
        threat_id = "2147748450"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "uplooder.net/img/image" wide //weight: 1
        $x_1_2 = "GetByteArrayAsync" wide //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "GetResponseStream" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MIB_2147748465_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MIB!MTB"
        threat_id = "2147748465"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 06 07 08 09 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 04 11 04 72 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 05 11 05}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MS_2147748511_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MS!MTB"
        threat_id = "2147748511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 17 19 8d ?? ?? 00 01 25 16 7e ?? ?? 00 04 a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 a2 14 14 14 17 28 ?? ?? 00 0a 26 1f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MS_2147748511_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MS!MTB"
        threat_id = "2147748511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 06 07 08 09 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 04 11 04 6f ?? ?? ?? ?? 16 9a 13 05 11 05 72 ?? ?? ?? ?? ?? ?? ?? ?? ?? 13 06 73 1c 00 d0 ?? ?? ?? ?? ?? ?? ?? ?? ?? 72 ?? ?? ?? ?? ?? ?? ?? ?? ?? 14 14 17 8d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MIL_2147749325_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MIL!MTB"
        threat_id = "2147749325"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {18 9a 0c 08 6f ?? ?? ?? ?? 18 9a 0d 09 14 17 8d ?? ?? ?? ?? 25 16 07 6f ?? ?? ?? ?? a2 6f ?? ?? ?? ?? 26 1f 37 07 00 0b 06 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MOB_2147750261_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MOB!MTB"
        threat_id = "2147750261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 14 72 ?? ?? ?? ?? 18 8d ?? ?? ?? ?? 25 17 17 8d ?? ?? ?? ?? 25 16 08 6f ?? ?? ?? ?? a2 a2 14 14 28 ?? ?? ?? ?? 26 1f 49 13 05 2b 00 11 05 2a 37 00 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a 1b 73 ?? ?? ?? ?? 0b 07 28 ?? ?? ?? ?? ?? 07 0c 06 72 ?? ?? ?? ?? ?? ?? ?? ?? ?? 0d 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MOC_2147750262_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MOC!MTB"
        threat_id = "2147750262"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 16 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 06 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 2a 15 00 d0 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MGM_2147750597_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MGM!MTB"
        threat_id = "2147750597"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 06 7b 01 00 00 04 a2 6f ?? ?? ?? ?? 26 2a 2e 00 73 ?? ?? ?? ?? 0a ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 16 9a ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 14 14 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MPJ_2147750842_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MPJ!MTB"
        threat_id = "2147750842"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 16 72 ?? ?? ?? ?? a2 06 17 72 ?? ?? ?? ?? a2 06 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 17 8d ?? ?? ?? ?? 0b 07 16 02 7b ?? ?? ?? ?? a2 07 28 0e 00 00 06 [0-10] 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KKH_2147750844_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KKH!MTB"
        threat_id = "2147750844"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 07 7b 0a 00 00 04 a2 6f ?? ?? ?? ?? 26 29 00 0b 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 16 9a 72 ?? ?? ?? ?? ?? ?? ?? ?? ?? 14 14 17 8d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KHG_2147750959_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KHG!MTB"
        threat_id = "2147750959"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 9a 0b 02 07 28 ?? ?? ?? ?? ?? 16 28 ?? ?? ?? ?? 00 2a 16 00 28 [0-15] 0a 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_W_2147751288_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.W!MTB"
        threat_id = "2147751288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 28 ?? ?? ?? 06 a2 25 18 72 ?? ?? ?? ?? a2 0a 06 73 ?? ?? ?? 06 0b 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PM_2147751504_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PM!MTB"
        threat_id = "2147751504"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 02 06 74 ?? ?? ?? ?? ?? ?? ?? ?? ?? 06 74 [0-14] 25 2d 17 26 7e [0-15] 25 [0-15] 25 2d 17 26 7e [0-15] 25 [0-15] 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PO_2147751505_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PO!MTB"
        threat_id = "2147751505"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {9a 0b 02 07 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 2a 12 00 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PQ_2147751747_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PQ!MTB"
        threat_id = "2147751747"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1f 5d 1f 2d 28 ?? ?? ?? ?? 16 9a 1c d0 ?? ?? ?? ?? ?? ?? ?? ?? ?? 1f 0f 20 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 14 14 14 6f ?? ?? ?? ?? 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MLQ_2147751827_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MLQ!MTB"
        threat_id = "2147751827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 9a 0b 02 07 28 [0-5] 16 28 [0-5] 16 16 00 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MLR_2147751932_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MLR!MTB"
        threat_id = "2147751932"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {9a 0a 02 06 28 ?? ?? ?? ?? ?? 16 28 ?? ?? ?? ?? ?? 16 0b 2b 00 07 2a 15 00 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 18}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MLT_2147752129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MLT!MTB"
        threat_id = "2147752129"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {61 2b a8 28 ?? ?? ?? ?? 06 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0b 09 ?? ?? ?? ?? ?? 5a ?? ?? ?? ?? ?? 61}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SK_2147752346_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SK!MTB"
        threat_id = "2147752346"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 08 11 04 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 13 07 09 17 8d 82 00 00 01 25 16 11 07 9c 6f ?? ?? ?? 0a 00 11 04 18 58 13 04 00 11 04 08 6f ?? ?? ?? 0a fe 04 13 08 11 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AA_2147752525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AA!MTB"
        threat_id = "2147752525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cystum.Sucuryty.Sryp" ascii //weight: 1
        $x_1_2 = "FiluStruam" ascii //weight: 1
        $x_1_3 = "ProtuctQttrybutu" ascii //weight: 1
        $x_1_4 = "GunerqtedSodeQttrybutu" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AA_2147752525_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AA!MTB"
        threat_id = "2147752525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "source\\repos\\Windows Update Certifier\\Windows Update Certifier\\obj\\Debug\\Update Certifier.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AA_2147752525_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AA!MTB"
        threat_id = "2147752525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 7e ?? ?? ?? 04 a2 25 17 28 ?? ?? ?? 06 a2 25 18 72 ?? ?? ?? 70 a2 0a 08 20 ?? ?? ?? ?? 5a 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AA_2147752525_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AA!MTB"
        threat_id = "2147752525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {73 10 00 00 06 0a 06 03 7d 0a 00 00 04 00 02 06 fe 06 11 00 00 06 73 19 00 00 0a 28 06 00 00 2b 28 07 00 00 2b 0b 2b 00}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AA_2147752525_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AA!MTB"
        threat_id = "2147752525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0c 07 08 28 15 00 00 0a 2c 28 07 08 17 28 16 00 00 0a 7e 17 00 00 0a 72 1b 00 00 70 6f 18 00 00 0a 08 28}  //weight: 2, accuracy: High
        $x_1_2 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AB_2147752793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AB!MTB"
        threat_id = "2147752793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {20 c7 0b 00 00 95 2e 03 16 2b 04 17 06 13 04 17 59 7e 27 00 00 04 20 a3 11 00 00 95 5f 7e 27 00 00 04 20 d8 01 00 00 95 61 61 80 14 00 00 04}  //weight: 4, accuracy: High
        $x_4_2 = {20 b5 09 00 00 95 e0 95 7e 0a 00 00 04 20 b0 0c 00 00 95 61 7e 0a 00 00 04 20 cd 02 00 00 95 2e 03 17 2b 01 16 58}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AB_2147752793_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AB!MTB"
        threat_id = "2147752793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {15 2d 0a 26 02 8e 69 16 2c 0a 26 2b 17 28 02 00 00 06 2b f0 0a 2b f4 28 01 00 00 06 02 06 91 6f 1e 00 00 0a 06 25 17 59 1b 2d 0a 26 16 fe 02 0b 07 2d e4 2b 03 0a 2b f4}  //weight: 10, accuracy: High
        $x_3_2 = {57 15 02 08 09 09 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 30 00 00 00 05 00 00 00 05 00 00 00 10 00 00 00 04 00 00 00 37}  //weight: 3, accuracy: High
        $x_3_3 = "SecurityProtocolType" ascii //weight: 3
        $x_3_4 = "WebRequest" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AB_2147752793_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AB!MTB"
        threat_id = "2147752793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AppendAllText" ascii //weight: 1
        $x_1_2 = "WriteAllText" ascii //weight: 1
        $x_1_3 = "TrimEnd" ascii //weight: 1
        $x_1_4 = "Transaction" ascii //weight: 1
        $x_1_5 = "get_Current" ascii //weight: 1
        $x_1_6 = "get_TransactionInformation" ascii //weight: 1
        $x_1_7 = "BitConverter" ascii //weight: 1
        $x_1_8 = "GetPixel" ascii //weight: 1
        $x_1_9 = "TransactionalFileManager.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_B_2147752795_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.B!MTB"
        threat_id = "2147752795"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Base32" ascii //weight: 1
        $x_1_2 = "GAMEOVER" wide //weight: 1
        $x_1_3 = "WinformMegaman" ascii //weight: 1
        $x_1_4 = "Decode" ascii //weight: 1
        $x_1_5 = "Z_dash_atk" wide //weight: 1
        $x_1_6 = "Z_attack" wide //weight: 1
        $x_1_7 = "plDropnF.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147752797_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTE!MTB"
        threat_id = "2147752797"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTE: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 07 06 07 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 14 6f ?? ?? ?? ?? 26 2b 02 2b 01 00 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_C_2147753151_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.C!MTB"
        threat_id = "2147753151"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Inflation_Calculator" wide //weight: 1
        $x_1_2 = "Network Adapters.dll" ascii //weight: 1
        $x_1_3 = "\\ConfigurationFiles\\obj\\Debug\\Network Adapters.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PD_2147753220_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PD!MTB"
        threat_id = "2147753220"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 06 08 8f 6d 00 00 01 25 47 02 08 1f 10 5d 91 61 d2 52 00 08 17 d6 0c 08 07 fe 02 16 fe 01 0d 09 2d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PD_2147753220_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PD!MTB"
        threat_id = "2147753220"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 16 9a 28 ?? ?? ?? ?? 0a 02 17 9a 75 ?? ?? ?? ?? 06 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 06 7e ?? ?? ?? ?? 6f ?? ?? ?? ?? 5d 0b 7e ?? ?? ?? ?? 0c 08 07 6f ?? ?? ?? ?? 61 8c ?? ?? ?? ?? 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {16 0a 2b 35 00 28 ?? ?? ?? ?? 73 ?? ?? ?? ?? 72 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f 1f 00 00 0a 16 6a 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? de 0d 26 17 0a 28 ?? ?? ?? ?? de 03}  //weight: 1, accuracy: Low
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\AddInProcess32.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {02 72 35 01 ?? 70 28 1a ?? ?? 06 0b 73 49 ?? ?? 0a 0c 07 8e 69 13 06 2b 13 00 16 2d 0a 08 07 11 06 91}  //weight: 6, accuracy: Low
        $x_1_2 = "WebClient" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "get_Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 04 11 05 6f ?? ?? ?? 0a 26 07 11 04 11 05 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 09 08 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 11 06 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 9c 11 05 17 58 13 05 11 05 07 6f ?? ?? ?? 0a 32 a1}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 96 b6 2b 09 1f 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 3, accuracy: High
        $x_1_2 = "Microsoft.VisualBasic.ApplicationServices" ascii //weight: 1
        $x_1_3 = "set_UseAntiAlias" ascii //weight: 1
        $x_1_4 = "set_PasswordChar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 15 02 08 09 01 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 2e 00 00 00 06 00 00 00 05 00 00 00 0f 00 00 00 03 00 00 00 31}  //weight: 3, accuracy: High
        $x_3_2 = "get_CurrentDomain" ascii //weight: 3
        $x_3_3 = "get_IsRunning" ascii //weight: 3
        $x_3_4 = "set_SecurityProtocol" ascii //weight: 3
        $x_3_5 = "ServicePointManager" ascii //weight: 3
        $x_3_6 = "WebRequest" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 17 a2 1f 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 ac 00 00 00 2e 00 00 00 e2}  //weight: 3, accuracy: High
        $x_3_2 = "Phoenix.Resources.resources" ascii //weight: 3
        $x_3_3 = "AuthenticationMode" ascii //weight: 3
        $x_3_4 = "Microsoft.VisualBasic.ApplicationServices" ascii //weight: 3
        $x_3_5 = "ShutdownEventHandler" ascii //weight: 3
        $x_3_6 = "ShutdownMode" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Buni555fu_Te5555xtB555ox" ascii //weight: 1
        $x_1_2 = "Are you sure you want to close me!!" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "LateBinding" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "Know_if_Your_Girlfriend_Is_Horny_Step_11" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AM_2147753500_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AM!MTB"
        threat_id = "2147753500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BBMS.FormCustomerInfo.resources" ascii //weight: 1
        $x_1_2 = "BBMS.FormDonorInfo.resources" ascii //weight: 1
        $x_1_3 = "BBMS.FormDonorUpdate.resources" ascii //weight: 1
        $x_1_4 = "BBMS.FormLogin.resources" ascii //weight: 1
        $x_1_5 = "BBMS.FormMain.resources" ascii //weight: 1
        $x_1_6 = "BBMS.FormReportViewer.resources" ascii //weight: 1
        $x_1_7 = "BBMS.FormStockList.resources" ascii //weight: 1
        $x_1_8 = "BBMS.FormUserAccount.resources" ascii //weight: 1
        $x_1_9 = "BBMS.Resources.resources" ascii //weight: 1
        $x_1_10 = "BBMS.yyt1.resources" ascii //weight: 1
        $x_1_11 = "WrapNonExceptionThrows" ascii //weight: 1
        $x_1_12 = "Arnav Mukhopadhay" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MRM_2147753556_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MRM!MTB"
        threat_id = "2147753556"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 72 46 a0 02 70 6f ?? ?? ?? ?? 0a 06 14 18 8d ?? ?? ?? ?? 25 16 7e ?? ?? ?? ?? a2 25 17 72 ?? ?? ?? ?? a2 6f ?? ?? ?? ?? 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AN_2147753577_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AN!MTB"
        threat_id = "2147753577"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 9a 20 08 12 00 00 95 e0 95 7e 2e 00 00 04 16 9a 20 33 03 00 00 95 61 7e 2e 00 00 04 16 9a 20 ef 0d 00 00 95 2e 03 17 2b 01 16 58}  //weight: 2, accuracy: High
        $x_2_2 = {95 2e 03 16 2b 01 17 17 59 7e 2e 00 00 04 16 9a 20 12 03 00 00 95 5f 7e 2e 00 00 04 16 9a 20 f8 0f 00 00 95 61 58 80 35 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AN_2147753577_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AN!MTB"
        threat_id = "2147753577"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {01 57 15 a2 09 09 01 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 2a}  //weight: 1, accuracy: High
        $x_1_2 = "Stopwatch" ascii //weight: 1
        $x_1_3 = "set_SecurityProtocol" ascii //weight: 1
        $x_1_4 = "WebRequest" ascii //weight: 1
        $x_1_5 = "discordapp.com/attachments" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_X_2147754321_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.X!MTB"
        threat_id = "2147754321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "40"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "System.Drawing.Bitmap" ascii //weight: 10
        $x_10_2 = "DES_Decrypt" ascii //weight: 10
        $x_10_3 = "FromBase64String" ascii //weight: 10
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "VirtualProtect" ascii //weight: 1
        $x_1_6 = "ConfuserEx" ascii //weight: 1
        $x_1_7 = "_ticker_Tick" ascii //weight: 1
        $x_1_8 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_9 = "EventArgs" ascii //weight: 1
        $x_1_10 = "sender" ascii //weight: 1
        $x_1_11 = "flatButton3_Click" ascii //weight: 1
        $x_1_12 = "password" ascii //weight: 1
        $x_1_13 = "WebBrowserDocumentCompletedEventArgs" ascii //weight: 1
        $x_1_14 = "BlockCopy" ascii //weight: 1
        $x_1_15 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_16 = "Capture" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 10 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_X_2147754321_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.X!MTB"
        threat_id = "2147754321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 13 07 19 8d ?? ?? ?? 01 80 ?? ?? ?? 04 7e ?? ?? ?? 04 16 7e ?? ?? ?? 04 a2 7e ?? ?? ?? 04 17 7e ?? ?? ?? 04 a2 38}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SS_2147754395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SS!MTB"
        threat_id = "2147754395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 04 11 05 09 11 05 09 8e 69 5d 91 06 11 05 91 61 d2 9c 11 05 17 58 13 05 11 05 06 8e 69 32 e0}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SS_2147754395_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SS!MTB"
        threat_id = "2147754395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 08 5d 13 05 06 17 58 08 5d 13 0a 07 11 0a 91 20 00 01 00 00 58 13 0b 07 11 05 91 13 0c 07 11 05 11 0c 11 06 06 1f 16 5d 91 61 11 0b 59 20 00 01 00 00 5d d2 9c 06 17 58 0a 06 08 11 07 17 58 5a fe 04 13 0d 11 0d 2d b7}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SP_2147754396_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SP!MTB"
        threat_id = "2147754396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 06 17 1f 64 6f ?? ?? ?? 0a 0b 02 7b 2f 00 00 04 6f ?? ?? ?? 0a 07 8c 32 00 00 01 6f ?? ?? ?? 0a 26 00 08 17 58 0c 08 1f 0a fe 02 16 fe 01 0d 09 2d cd}  //weight: 2, accuracy: Low
        $x_2_2 = "BaiTapThietKeForm.Properties.Resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SD_2147754397_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SD!MTB"
        threat_id = "2147754397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 07 06 8e 69 6a 5d d4 06 07 06 8e 69 6a 5d d4 91 08 07 08 8e 69 6a 5d d4 91 61 28 97 00 00 0a 06 07 17 6a 58 06 8e 69 6a 5d d4 91 28 98 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 99 00 00 0a 9c 07 17 6a 58 0b 07 06 8e 69 17 59 6a fe 02 16 fe 01 13 06 11 06 2d a5}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BK_2147754489_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BK!MTB"
        threat_id = "2147754489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 1e 8d ?? ?? ?? ?? 0c 07 28 ?? ?? ?? ?? 72 ?? ?? ?? ?? 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 16 08 16 1e 28 ?? ?? ?? ?? 06 08 6f ?? ?? ?? ?? 06 18 6f ?? ?? ?? ?? 06 6f ?? ?? ?? ?? 03 16 03 8e 69 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "FillRecta" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BK_2147754489_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BK!MTB"
        threat_id = "2147754489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "http://188.34.187.170/priv.dll" wide //weight: 2
        $x_2_2 = "stnemhcatta/moc.ppadrocsid.ndc//:sptth" wide //weight: 2
        $x_2_3 = "http://icanhazip.com" wide //weight: 2
        $x_2_4 = "C:\\Users\\xxx\\Desktop\\IPFAJNYPROGRAM\\Client\\Client\\obj\\x86\\Release\\Client.pdb" ascii //weight: 2
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "Form1_Load" ascii //weight: 1
        $x_1_7 = "Dispose" ascii //weight: 1
        $x_1_8 = "Concat" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 5 of ($x_1_*))) or
            ((3 of ($x_2_*) and 3 of ($x_1_*))) or
            ((4 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_SG_2147754601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SG!MTB"
        threat_id = "2147754601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 06 17 58 07 8e 69 5d 91 13 06 09 06 09 8e 69 5d 91 13 07 07 06 07 06 91 11 07 61 11 06 59 20 00 01 00 00 58 d2 9c 06 17 58 0a 06 07 8e 69 fe 04 13 08 11 08 2d c9}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SG_2147754601_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SG!MTB"
        threat_id = "2147754601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 20 00 01 00 00 13 0c 11 0b 17 58 13 0d 11 0b 20 ?? ?? ?? 00 5d 13 0e 11 0d 20 ?? ?? ?? 00 5d 13 0f 11 06 11 0f 91 11 0c 58 13 10 11 06 11 0e 91 13 11 11 07 11 0b 1f 16 5d 91 13 12 11 11 11 12 61 13 13 11 06 11 0e 11 13 11 10 59 11 0c 5d d2 9c 00 11 0b 17 58 13 0b 11 0b 20 ?? ?? ?? 00 fe 04 13 14 11 14 2d 98}  //weight: 2, accuracy: Low
        $x_1_2 = "set_UseShellExecute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MX_2147754694_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MX!MTB"
        threat_id = "2147754694"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 9a 0a 06 6f ?? ?? ?? ?? 19 9a 0b 07 72 ?? ?? 00 70 17 18 8d ?? ?? ?? ?? 25 17 19 8d ?? ?? ?? ?? 25 16 7e ?? 00 00 04 a2 25 17 7e ?? 00 00 04 a2 25 18 72 ?? ?? 00 70 a2 a2 28 ?? ?? ?? ?? 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MX_2147754694_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MX!MTB"
        threat_id = "2147754694"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Lerlibro_INC.My.Resources" ascii //weight: 1
        $x_1_2 = "$111ad02b-cccd-4106-b328-93b3adb05e52" ascii //weight: 1
        $x_1_3 = "BunifuElipse1" ascii //weight: 1
        $x_1_4 = "panelMIS" ascii //weight: 1
        $x_1_5 = "lvwUsers" ascii //weight: 1
        $x_1_6 = "txtPass" ascii //weight: 1
        $x_1_7 = "isPassword" ascii //weight: 1
        $x_1_8 = "bytesToDecompress" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MX_2147754694_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MX!MTB"
        threat_id = "2147754694"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 fd a3 ff 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 d7}  //weight: 10, accuracy: High
        $x_1_2 = "ICredentials" ascii //weight: 1
        $x_1_3 = "get_Controls" ascii //weight: 1
        $x_1_4 = "WaitForSingleObject" ascii //weight: 1
        $x_1_5 = "UnhookWindowsHookEx" ascii //weight: 1
        $x_1_6 = "Debugger" ascii //weight: 1
        $x_1_7 = "add_MouseDown" ascii //weight: 1
        $x_1_8 = "SuspendThread" ascii //weight: 1
        $x_1_9 = "set_PasswordChar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 16 7e ?? ?? ?? 04 a2 06 17 7e ?? ?? ?? 04 a2 06 18 72 ?? ?? ?? 70 a2 03}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 7e ?? ?? ?? 04 a2 25 17 02 7b ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 0a 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 28 ?? ?? ?? 06 9d 25 17 28 ?? ?? ?? 06 9d 25 18 1f ?? 9d 25 19 1f ?? 9d 80 ?? ?? ?? 04 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 28 ?? ?? ?? 0a 26 16 0b 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 9a 0a 06 14 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 0b 07 6f ?? ?? ?? 0a 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 16 0b 2b ?? 02 07 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 06 07 1f ?? 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 07 02 8e 69 32 ?? 02 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 16 0b 2b ?? 02 07 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 06 07 1f ?? 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 07 02 8e 69 fe ?? 0d 09 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 07 19 8d ?? ?? ?? 01 80 ?? ?? ?? 04 7e ?? ?? ?? 04 16 7e ?? ?? ?? 04 a2 7e ?? ?? ?? 04 17 7e ?? ?? ?? 04 a2 02 11 06 28 ?? ?? ?? 06 7e ?? ?? ?? 04 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5f 9c 61 1f ?? 59 06 61 29 00 0e ?? 05 7e ?? ?? ?? 04 20 ?? ?? ?? 00 7e ?? ?? ?? 04 20 ?? ?? ?? 00 91 7e ?? ?? ?? 04 20 ?? ?? ?? 00 91 5f 20 ?? ?? ?? 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_9
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 72 ?? ?? ?? 70 a2 25 17 7e ?? ?? ?? 04 a2 25 18 7e ?? ?? ?? 04 a2 13 ?? 11 ?? 28 ?? ?? ?? 0a 00 11 ?? 73 ?? ?? ?? 06 13 ?? 2b 05 00 19 8d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_10
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 02 16 28 ?? ?? ?? 0a 02 7b ?? ?? ?? 04 16 7e ?? ?? ?? 04 a2 02 7b ?? ?? ?? 04 17 7e ?? ?? ?? 04 a2 02 7b ?? ?? ?? 04 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2 02 7b ?? ?? ?? 04 73 ?? ?? ?? 06 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_11
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0d 09 72 ?? ?? ?? 70 17 18 8d ?? ?? ?? 01 25 17 18 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 72 ?? ?? ?? 70 a2 a2 28 ?? ?? ?? 0a 26 16 28 ?? ?? ?? 0a 00 72 ?? ?? ?? 70 13 ?? 2b ?? 11 ?? 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_12
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2 80 ?? ?? ?? 04 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_13
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 16 7e ?? ?? ?? 04 a2 06 17 7e ?? ?? ?? 04 a2 06 18 72 ?? ?? ?? 70 a2 06 73 ?? ?? ?? 06 0b 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {01 0b 07 16 7e ?? ?? ?? 04 a2 07 17 7e ?? ?? ?? 04 a2 07 18 72 ?? ?? ?? 70 a2 07 73 ?? ?? ?? 06 0c 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_14
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 02 28 ?? ?? ?? 06 a2 25 17 02 28 ?? ?? ?? 06 a2 25 18 72 ?? ?? ?? 70 a2 0a 06 73 ?? ?? ?? 06 0b 2b}  //weight: 1, accuracy: Low
        $x_1_2 = {01 25 16 28 ?? ?? ?? 06 a2 25 17 28 ?? ?? ?? 06 a2 25 18 72 ?? ?? ?? 70 a2 0a 06 73 ?? ?? ?? 06 0b 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_15
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 d2 81 ?? ?? ?? 01 00 06 17 13 ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 61 20 ?? ?? ?? ?? 40 ?? ?? ?? 00 20 ?? ?? ?? 00 13 ?? 20 ?? ?? ?? ?? 58 00 58 0a 06 02 8e 69 fe ?? 0c 08 2d ?? 02 0b 2b ?? 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_16
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 02 8e 69 5d 02 06 02 8e 69 5d 91 03 06 03 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 06 17 58 02 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d 28 ?? ?? ?? 0a 9c 00 06 15 58 0a 06 16 fe ?? 16 fe ?? 0b 07 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_17
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 16 0b 2b ?? 02 07 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 06 07 00 23 [0-10] 23 [0-10] 28 ?? ?? ?? 0a 58 28 ?? ?? ?? 0a 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 07 02 8e 69 fe ?? 0d 09 2d ?? 02 0c 2b ?? 08 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_18
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 16 0b 2b ?? 02 07 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 06 07 00 23 [0-10] 23 [0-10] 28 ?? ?? ?? 0a 59 28 ?? ?? ?? 0a 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 07 02 8e 69 fe ?? 0d 09 2d ?? 02 0c 2b ?? 08 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_19
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 02 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2}  //weight: 1, accuracy: Low
        $x_1_2 = {04 02 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 2b a2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_20
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 16 72 ?? ?? ?? 70 a2 06 17 7e ?? ?? ?? 04 a2 06 18 7e ?? ?? ?? 04 a2 06 28 ?? ?? ?? 0a 00 06}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 06 16 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a a2 06 17 7e ?? ?? ?? 04 a2 06 18 7e ?? ?? ?? 04 a2 06 28 ?? ?? ?? 0a 00 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_21
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 16 7e ?? ?? ?? 04 a2 06 17 7e ?? ?? ?? 04 a2 06 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2 7e ?? ?? ?? 04 28 ?? ?? ?? 06 0b 02 07}  //weight: 1, accuracy: Low
        $x_1_2 = {01 0a 06 16 7e ?? ?? ?? 04 a2 06 17 7e ?? ?? ?? 04 a2 06 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 2b a2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_22
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 16 7e ?? ?? ?? 04 a2 06 17 7e ?? ?? ?? 04 a2 06 18 72 ?? ?? ?? 70 a2 06 73 ?? ?? ?? 06 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {01 25 16 7e ?? ?? ?? 04 a2 80 ?? ?? ?? 04 2a 19 00 72 ?? ?? ?? 70 80 ?? ?? ?? 04 72 ?? ?? ?? 70 80 ?? ?? ?? 04 19 8d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_23
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 28 ?? ?? ?? 0a 26 16 28 ?? ?? ?? 0a 00 16 0b 2b ?? 07 2a 1f 00 02 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_24
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 16 0d 16 13 ?? 2b ?? 03 11 ?? 18 6f ?? ?? ?? 0a 1f ?? 28 ?? ?? ?? 0a 08 09 91 61 d1 13 ?? 06 11 ?? 6f ?? ?? ?? 0a 26 09 04 6f ?? ?? ?? 0a 17 59 33 ?? 16 0d 2b ?? 09 17 58 0d 11 ?? 18 58 13 ?? 11 ?? 03 6f ?? ?? ?? 0a 17 59 31 ?? 06 6f ?? ?? ?? 0a 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_25
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetFullPath" ascii //weight: 1
        $x_1_2 = "GetTempPath" ascii //weight: 1
        $x_1_3 = "WriteAllBytes" ascii //weight: 1
        $x_1_4 = "Write" ascii //weight: 1
        $x_1_5 = "BlockCopy" ascii //weight: 1
        $x_1_6 = "$d5069717-2717-4cc5-84d2-d87582400fe4" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_26
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Mini_Game_Center.My" ascii //weight: 1
        $x_1_2 = "snakeGameOver" ascii //weight: 1
        $x_1_3 = "Mini_Game_Center.snake.resources" ascii //weight: 1
        $x_1_4 = "$7180b8a4-b1de-4759-b39d-32d5ee276408" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_27
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 25 06 1f ?? 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 25 06 1f ?? 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 6f ?? ?? ?? 0a 03 16 03 8e 69 6f ?? ?? ?? 0a 0b 00 07 8e 69 1f ?? da 17 d6 8d ?? ?? ?? 01 0c 07 1f ?? 08 16 07 8e 69 1f ?? da 28 ?? ?? ?? 0a 00 08 0d 2b ?? 09 2a 13 00 00 04 1e 8d ?? ?? ?? 01 17 73 ?? ?? ?? 0a 0a 73}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_28
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0b 38 ?? ?? ?? 00 02 07 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 06 07 20 ?? ?? ?? ?? fe ?? ?? ?? fe ?? ?? ?? fe ?? ?? ?? fe ?? ?? ?? fe ?? ?? ?? 58 20 ?? ?? ?? ?? fe ?? 3a ?? ?? ?? 00 00 20 ?? ?? ?? 00 fe ?? ?? ?? 00 38 ?? ?? ?? 00 00 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 fe ?? ?? ?? 00 11 ?? 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 07 02 8e 69 fe ?? 0d 09 3a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_29
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MathDrill_01.My" ascii //weight: 1
        $x_1_2 = "startGame" ascii //weight: 1
        $x_1_3 = "gameOver" ascii //weight: 1
        $x_1_4 = "MathDrill_01.Resources" wide //weight: 1
        $x_1_5 = "$4E48F0AA-8D8F-46D6-AD16-773BF3C9B619" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_30
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {58 00 0b 2b ?? 02 07 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 06 07 1f ?? 13 ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 61 20 ?? ?? ?? ?? 40 ?? ?? ?? 00 20 ?? ?? ?? 00 13 ?? 20 ?? ?? ?? ?? 58 00 5d 91 61 d2 81 ?? ?? ?? 01 07 17 13 ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 61 20 ?? ?? ?? ?? 40 ?? ?? ?? 00 20 ?? ?? ?? 00 13 ?? 20 ?? ?? ?? ?? 58 00 58 0b 07 02 8e 69 fe ?? 0d 09 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VN_2147754890_31
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VN!MTB"
        threat_id = "2147754890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 0a 02 28 ?? ?? ?? 06 06 6f ?? ?? ?? 0a 0b 07 14 02 72 ?? ?? ?? 70 28 ?? ?? ?? 06 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 14 14 28 ?? ?? ?? 0a 0c 08 14 02 72 ?? ?? ?? 70 28 ?? ?? ?? 06 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 14 14 28 ?? ?? ?? 0a 0d 09 14 02 72 ?? ?? ?? 70 28 ?? ?? ?? 06 18 8d ?? ?? ?? 01 25 17 18 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 72 ?? ?? ?? 70 a2 a2 14 14 28 ?? ?? ?? 0a 26 72 ?? ?? ?? 70 13 ?? 2b ?? 11 ?? 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AC_2147755666_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AC!MTB"
        threat_id = "2147755666"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 00 01 00 00 13 08 11 07 17 58 13 09 11 07 20 00 56 01 00 5d 13 0a 11 09 20 00 56 01 00 5d 13 0b 07 11 0b 91 11 08 58 13 0c 07 11 0a 91 13 0d 08 11 07 1f 16 5d 91 13 0e 11 0d 11 0e 61 13 0f 07 11 0a 11 0f 11 0c 59 11 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AC_2147755666_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AC!MTB"
        threat_id = "2147755666"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {19 9a 20 0c 07 00 00 95 5f 7e 06 00 00 04 19 9a 20 86 08 00 00 95 61 59 81 07 00 00 01 7e 06 00 00 04 17 9a 1f 10 95}  //weight: 4, accuracy: High
        $x_4_2 = {2d 03 16 2b 01 17 17 59 7e 2c 00 00 04 20 53 02 00 00 95 5f 7e 2c 00 00 04 20 8b 01 00 00 95 61 58 81 07 00 00 01}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AC_2147755666_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AC!MTB"
        threat_id = "2147755666"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "CurrentVersion\\Explorer\\Shell Folders" ascii //weight: 3
        $x_3_2 = "\\AudioApp" ascii //weight: 3
        $x_3_3 = "/C rund" ascii //weight: 3
        $x_3_4 = "\\Downloads\\" ascii //weight: 3
        $x_3_5 = "DownloadFileTaskAsync" ascii //weight: 3
        $x_3_6 = "Jack+MyAddIn+<Download>" ascii //weight: 3
        $x_3_7 = "jazk.dll" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AC_2147755666_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AC!MTB"
        threat_id = "2147755666"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 95 a2 29 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 9e 00 00 00 1a 00 00 00 a4 00 00 00 59 01}  //weight: 3, accuracy: High
        $x_3_2 = "DockStyle" ascii //weight: 3
        $x_3_3 = "@pkReminder" ascii //weight: 3
        $x_3_4 = "ExecuteNonQuery" ascii //weight: 3
        $x_3_5 = "[poldata5].[DeleteExistingReminder]" ascii //weight: 3
        $x_3_6 = "@Datum" ascii //weight: 3
        $x_3_7 = "poldata5.UpdateSnooze" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AC_2147755666_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AC!MTB"
        threat_id = "2147755666"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 1e 9a 0c 19 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 7e ?? ?? ?? 04 a2 25 18 7e ?? ?? ?? 04 a2 0d 09 28 ?? ?? ?? 0a 00 08 09 28 ?? ?? ?? 0a 26 20 ?? ?? ?? 00 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_4_2 = "FallbackBuffer" ascii //weight: 4
        $x_4_3 = "WSTRBufferMarshaler" ascii //weight: 4
        $x_4_4 = "DskExplorer" ascii //weight: 4
        $x_3_5 = "IdentityAuthority" ascii //weight: 3
        $x_3_6 = "ExclusiveScheduler" ascii //weight: 3
        $x_2_7 = "DesEncriptIt" ascii //weight: 2
        $x_2_8 = "EncriptIt" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_4_*) and 2 of ($x_3_*) and 2 of ($x_2_*))) or
            ((3 of ($x_4_*) and 1 of ($x_3_*) and 2 of ($x_2_*))) or
            ((3 of ($x_4_*) and 2 of ($x_3_*))) or
            ((1 of ($x_10_*) and 2 of ($x_3_*) and 1 of ($x_2_*))) or
            ((1 of ($x_10_*) and 1 of ($x_4_*) and 2 of ($x_2_*))) or
            ((1 of ($x_10_*) and 1 of ($x_4_*) and 1 of ($x_3_*) and 1 of ($x_2_*))) or
            ((1 of ($x_10_*) and 1 of ($x_4_*) and 2 of ($x_3_*))) or
            ((1 of ($x_10_*) and 2 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_SH_2147755929_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SH!MTB"
        threat_id = "2147755929"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 57 00 00 0a 72 ed 06 00 70 6f 58 00 00 0a 11 04 1f 16 5d 91 61 13 09 11 09 07 11 04 17 58 09 5d 91 59 20 00 01 00 00 58 13 0a 07 11 08 11 0a 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SH_2147755929_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SH!MTB"
        threat_id = "2147755929"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 1f 16 5d 13 06 06 17 58 13 07 07 11 07 07 8e 69 5d 91 13 08 09 11 06 91 13 09 07 06 91 11 09 61 13 0a 07 06 11 0a 11 08 59 20 00 01 00 00 58 d2 9c 07 06 07 06 91 d2 9c 06 17 58 0a 06 11 04 32 be}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SV_2147755956_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SV!MTB"
        threat_id = "2147755956"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 09 5d 13 04 06 1f 16 5d 13 09 06 17 58 09 5d 13 0a 07 11 04 91 11 05 11 09 91 61 13 0b 11 0b 07 11 0a 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 13 0c 07 11 04 11 0c d2 9c 06 17 58 0a 06 09 11 06 17 58 5a fe 04 13 0d 11 0d 2d b3}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SJ_2147756279_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SJ!MTB"
        threat_id = "2147756279"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 08 17 58 13 06 07 08 07 08 91 28 15 00 00 06 08 1f 16 5d 91 61 07 11 06 09 5d 91 59 20 00 01 00 00 58 20 ff 00 00 00 5f d2 9c 08 17 58 0c 00 08 09 fe 04 13 07 11 07 2d c6}  //weight: 2, accuracy: High
        $x_2_2 = "FolderSearcher.Form1.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CO_2147756286_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CO!MTB"
        threat_id = "2147756286"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {12 02 28 33 00 00 0a 0a 00 06 17 fe 0e 05 00 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 61 20 ?? ?? ?? ?? 40 10 00 00 00 20 ?? ?? ?? ?? fe 0e 05 00 fe 1c 21 00 00 01 58 00 8d 38 00 00 01 0d 09 16 1f 3a 9d 09 6f 34 00 00 0a 0b 7e 02 00 00 04 07 16 9a 07 17 9a 73 35 00 00 0a 6f 36 00 00 0a 00 00 12 02 28 37 00 00 0a 13 04 11 04 3a}  //weight: 6, accuracy: Low
        $x_1_2 = "UGx1Z2luLkxhdW5jaA==" ascii //weight: 1
        $x_1_3 = "TWFpbg==" ascii //weight: 1
        $x_1_4 = "System.Text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CO_2147756286_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CO!MTB"
        threat_id = "2147756286"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 00}  //weight: 1, accuracy: High
        $x_1_2 = "GetFileNameByURL" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "imimimimim" ascii //weight: 1
        $x_1_11 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MZ_2147756474_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MZ!MTB"
        threat_id = "2147756474"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {1c 9a 0b 07 19 8d ?? ?? 00 01 25 16 7e ?? ?? 00 04 a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 28 ?? ?? 00 0a 26}  //weight: 10, accuracy: Low
        $x_1_2 = "AthleticClubManagementSystem.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MZ_2147756474_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MZ!MTB"
        threat_id = "2147756474"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$74cdbe07-a95b-481a-9d85-5546ed6154d8" ascii //weight: 1
        $x_1_2 = "RecordBgySystem.My.Resources" ascii //weight: 1
        $x_1_3 = "get__Any_blotter_record_" ascii //weight: 1
        $x_1_4 = "frmRbi_Load" ascii //weight: 1
        $x_1_5 = "get_lblTotalCerf" ascii //weight: 1
        $x_1_6 = "CerfDialogdelete" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MZ_2147756474_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MZ!MTB"
        threat_id = "2147756474"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 05 09 11 05 09 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 09 11 05 09 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 09 17 6f ?? ?? ?? 0a 00 08 09 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 13 06 [0-3] 11 06 02 16 02 8e 69 6f ?? ?? ?? 0a 00 11 06 6f ?? ?? ?? 0a [0-4] de 0d}  //weight: 10, accuracy: Low
        $x_1_2 = "fsafsafsafa" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "cminute_Load" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
        $x_1_7 = "afasfsafsafsafsafasAFSAF" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PB_2147756523_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PB!MTB"
        threat_id = "2147756523"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 09 16 28 [0-4] 13 ?? 07 14 72 [0-4] 17 8d [0-4] 25 16 16 8c [0-4] a2 14 14 28 [0-5] 11 ?? 17 da 17 d6 8d [0-4] 13 ?? 08 14 72 [0-4] 19 8d [0-4] 25 16 11 ?? a2 25 17 16 8c [0-4] a2 25 18 [0-2] 8c [0-4] a2}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147756628_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MT!MTB"
        threat_id = "2147756628"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MT: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "83"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "kLjw4iIsCLsZtxc4lksN0j" ascii //weight: 20
        $x_10_2 = "DebuggableAttribute" ascii //weight: 10
        $x_10_3 = "DownloadFile" ascii //weight: 10
        $x_10_4 = "CreateInstance" ascii //weight: 10
        $x_10_5 = "MemoryStream" ascii //weight: 10
        $x_10_6 = "Reverse" ascii //weight: 10
        $x_10_7 = "Replace" ascii //weight: 10
        $x_1_8 = "XbQ14aDT3Cvh1epK59c" ascii //weight: 1
        $x_1_9 = "QBPy7oDvBkXCqohEq2L" ascii //weight: 1
        $x_1_10 = "bW9S14Dy7GY9io6mvLV" ascii //weight: 1
        $x_1_11 = "IhuSqllPtUov9Symuvi" ascii //weight: 1
        $x_1_12 = "OjZNEXlCGK5LUwv8Rrf" ascii //weight: 1
        $x_1_13 = "ihaTEQlr3RY5QcURR71" ascii //weight: 1
        $x_1_14 = "g4toFNogugVFtfp4xL5" ascii //weight: 1
        $x_1_15 = "E6KKiLoD8wEyYgZIyPp" ascii //weight: 1
        $x_1_16 = "bpSFHUojjg7wKDcooWH" ascii //weight: 1
        $x_1_17 = "WN9pZjBFFTjgFnTr86G" ascii //weight: 1
        $x_1_18 = "OngfLWBE3OmFY6hvihE" ascii //weight: 1
        $x_1_19 = "heVqxOBQMwF4TIglEVT" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GG_2147756750_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GG!MTB"
        threat_id = "2147756750"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ZJ4FA7EZ75ECUJBZ" ascii //weight: 1
        $x_1_2 = "Flora" ascii //weight: 1
        $x_1_3 = "Bitmap" ascii //weight: 1
        $x_1_4 = "FizzBuzz" ascii //weight: 1
        $x_1_5 = "convert" ascii //weight: 1
        $x_1_6 = "Debugger" ascii //weight: 1
        $x_1_7 = "IsLogging" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CTW_2147756793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CTW!MTB"
        threat_id = "2147756793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RfVOXoYqhjryzEaXktxi" ascii //weight: 1
        $x_1_2 = "DTqLYOrsPEOvmL" ascii //weight: 1
        $x_1_3 = "TkCSeHQbmzypzHGlUAeoBzwBDUeJ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Trojan_MSIL_AgentTesla_D_2147756895_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.D!MTB"
        threat_id = "2147756895"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "roguelike.bin" wide //weight: 1
        $x_1_2 = "get_Encrypted" ascii //weight: 1
        $x_1_3 = "Maze" ascii //weight: 1
        $x_1_4 = "newworldorder" wide //weight: 1
        $x_1_5 = "Acid Blob" wide //weight: 1
        $x_1_6 = "Chain Mail" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AR_2147757741_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AR!MTB"
        threat_id = "2147757741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 08 8f 05 ?? ?? 01 25 47 02 08 1f 10 5d 91 61 d2 52 08 17 d6 0c 08 07 fe 02 16 fe 01 0d 09 2d df}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BB_2147757951_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BB!MTB"
        threat_id = "2147757951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "_serverStarted" ascii //weight: 1
        $x_1_2 = "Secure.Messenger.WpfHost" ascii //weight: 1
        $x_1_3 = "UriKind" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BB_2147757951_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BB!MTB"
        threat_id = "2147757951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 1d b6 09 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 94 00 00 00 28 00 00 00 c3}  //weight: 3, accuracy: High
        $x_3_2 = "isPasswordMasked" ascii //weight: 3
        $x_3_3 = "SecurityProtocolType" ascii //weight: 3
        $x_3_4 = "discordapp" ascii //weight: 3
        $x_3_5 = "ApartmanOto.pdb" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSB_2147758017_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSB!MTB"
        threat_id = "2147758017"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 00 16 11 00 8e 69 6f ?? ?? ?? ?? 13 04 38 ?? ?? ?? ?? 73 ?? ?? ?? ?? 13 01 20 ?? ?? ?? ?? 38 ?? ?? ?? ?? 11 05 2a}  //weight: 5, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AE_2147758027_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AE!MTB"
        threat_id = "2147758027"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 08 9a 13 07 11 07 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7}  //weight: 10, accuracy: Low
        $x_10_2 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7}  //weight: 10, accuracy: Low
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetSetMethod" ascii //weight: 1
        $x_1_7 = "GetProperties" ascii //weight: 1
        $x_1_8 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AE_2147758027_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AE!MTB"
        threat_id = "2147758027"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {20 6c 10 00 00 95 e0 95 7e 0e 01 00 04 20 cf 04 00 00 95 61 7e 0e 01 00 04 20 10 07 00 00 95 2e 03 17 2b 01 16 58 7e 52 00 00 04}  //weight: 4, accuracy: High
        $x_4_2 = {1f 40 95 2c 03 16 2b 01 17 7e 88 00 00 04 18 20 01 01 01 01 13 2c 9a 20 41 06 00 00 95 5a 7e 88 00 00 04 18 9a 20 5e 08 00 00 95 58 61 80 34 00 00 04}  //weight: 4, accuracy: High
        $x_4_3 = {37 03 16 2b 01 17 17 59 7e 62 00 00 04 20 0d 0c 00 00 95 5f 7e 62 00 00 04 20 94 00 00 00 95 61 58 81 0b 00 00 01}  //weight: 4, accuracy: High
        $x_4_4 = {1a 9a 08 0b 20 1f 12 00 00 95 5f 7e 38 00 00 04 1a 9a 20 ca 0d 00 00 95 61 58 81 09 00 00 01 38 54 01 00 00 7e 40 00 00 04}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AG_2147758227_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AG!MTB"
        threat_id = "2147758227"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 19 95 37 03 16 2b 01 17 17 59 7e 07 00 00 04 18 9a 20 58 03 00 00 95 5f 7e 07 00 00 04 18 9a 20 f6 01 00 00 95 61 61 81 05 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {18 9a 20 d6 02 00 00 95 61 81 05 00 00 01 38 99 01 00 00 7e 2d 00 00 04 1f 1b 95 7e 07 00 00 04 18 9a 20 5c 01 00 00 95 33 3b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BC_2147758507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BC!MTB"
        threat_id = "2147758507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IHMVB.My" ascii //weight: 1
        $x_1_2 = "C116CFCD5F95FD7E94993F490F21111BF17DB9FD240788F7024CCBFA45B63E0C" ascii //weight: 1
        $x_1_3 = "$e4076bfd-a50e-4244-9f1a-9b7df0ed5202" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BC_2147758507_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BC!MTB"
        threat_id = "2147758507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 01 57 ff 03 3e 09 1f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 38 01 00 00 32 01 00 00 bb 04}  //weight: 3, accuracy: High
        $x_3_2 = "System.Security.Cryptography.AesCryptoServiceProvider" wide //weight: 3
        $x_3_3 = "{11111-22222-10009-11112}" wide //weight: 3
        $x_3_4 = "UZFuqrwDkVHFYkyXH1.ffKwMcckaKx9b25LJf" wide //weight: 3
        $x_3_5 = "{11111-22222-50001-00000}" wide //weight: 3
        $x_3_6 = "GetDelegateForFunctionPointer" wide //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BC_2147758507_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BC!MTB"
        threat_id = "2147758507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "mehn.exe" wide //weight: 2
        $x_2_2 = "https://textbin.net/raw/d6dckfhnvk" wide //weight: 2
        $x_2_3 = "$6899564a-a3b7-44a3-9a7c-2aae747af1fa" ascii //weight: 2
        $x_2_4 = "Please enter your desired Username and Password for the account you wish to create" wide //weight: 2
        $x_1_5 = "CompareString" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "CompareMethod" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 6 of ($x_1_*))) or
            ((3 of ($x_2_*) and 4 of ($x_1_*))) or
            ((4 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_A_2147758653_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.A!MTB"
        threat_id = "2147758653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 18 5b 8d ?? ?? ?? ?? 0b 16 0c 2b 1a 00 07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 00 08 18 58 0c 08 06 fe 04 0d 09 2d de 07 13 04 2b 00 11 04 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "BaiTapThietKeForm.frmBai1.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_A_2147758653_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.A!MTB"
        threat_id = "2147758653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ComputeMatrix" ascii //weight: 1
        $x_1_2 = "MatrixData" ascii //weight: 1
        $x_1_3 = "MatrixSeparation" ascii //weight: 1
        $x_1_4 = "replaceX" ascii //weight: 1
        $x_1_5 = "GetDecoded" ascii //weight: 1
        $x_1_6 = "Base64Decoder" ascii //weight: 1
        $x_1_7 = "AHUHD" ascii //weight: 1
        $x_3_8 = {28 3b 00 00 06 0a 06 28 64 00 00 0a 6f 65 00 00 0a 17 9a 0b 02 07 28 3a 00 00 06 00 16 28 66 00 00 0a 00 16 0c 2b 00 08 2a}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((7 of ($x_1_*))) or
            ((1 of ($x_3_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_A_2147758653_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.A!MTB"
        threat_id = "2147758653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4a 00 56 00 4e 00 4a 00 41 00 41 00 41 00 44 00 41 00 41 00 41 00 41 00 41 00 42 00 41 00 41 00 41 00 41 00 41 00 50 00 37 00 37 00 59 00 41 00 41 00 43 00 34 00 41 00 41 00 41}  //weight: 1, accuracy: High
        $x_1_2 = {41 00 47 00 42 00 51 00 56 00 54 00 51 00 47 00 49 00 44 00 37 00 59 00 41 00 52 00 47 00 42 00 41 00 52 00 41 00 51 00 57 00 42 00 4f 00 41 00 41 00 43 00 50 00 4d 00 41 00 51 00 41 00 41 00 41 00 45 00 43 00 35}  //weight: 1, accuracy: High
        $x_1_3 = {41 00 41 00 41 00 41 00 45 00 51 00 41 00 41 00 41 00 41 00 59 00 41 00 41 00 41 00 41 00 42 00 4f 00 44 00 53 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41}  //weight: 1, accuracy: High
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AH_2147758788_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AH!MTB"
        threat_id = "2147758788"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 9a 1f 29 95 7e 21 00 00 04 1c 9a 1f 2d 95 60 7e 21 00 00 04 1c 9a 07 0a 20 54 01 00 00 95 61 7e 21 00 00 04 1c 07 0b 9a 20 e1 00 00 00 95 2e 03 16 2b 01}  //weight: 2, accuracy: High
        $x_2_2 = {17 9a 20 7c 07 00 00 95 2e 03 16 2b 01 17 17 59 7e 21 00 00 04 17 9a 20 08 07 00 00 95 5f 7e 21 00 00 04 17 9a 20 36 0a 00 00 95 61 58 80 20 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DX_2147758802_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DX!MTB"
        threat_id = "2147758802"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "@LoginName" wide //weight: 1
        $x_1_2 = "@LoginPwd" wide //weight: 1
        $x_1_3 = "Data Source=172.20.58.3" wide //weight: 1
        $x_1_4 = "ftp://172.20.58.5:8017/SoftUpdate" wide //weight: 1
        $x_1_5 = "AndroidStudio.dll" wide //weight: 1
        $x_1_6 = "RightingSys.DAL" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DX_2147758802_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DX!MTB"
        threat_id = "2147758802"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$a845d297-d62a-4e54-8656-d8255d4e2bb8" ascii //weight: 20
        $x_20_2 = "$a236408f-d04c-4514-8bde-bf41cc7247f1" ascii //weight: 20
        $x_20_3 = "$0d0d344b-07ce-496e-8038-d9a80692376b" ascii //weight: 20
        $x_20_4 = "$c670bcd9-8174-4797-b442-2c129d2548bf" ascii //weight: 20
        $x_1_5 = "Espionage_Sorter.My.Resources" ascii //weight: 1
        $x_1_6 = "SqlFormatter.Properties.Resources" ascii //weight: 1
        $x_1_7 = "MandelbrotExplorer.My.Resources" ascii //weight: 1
        $x_1_8 = "File_System_Controls.My.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "DebuggableAttribute" ascii //weight: 1
        $x_1_15 = "DebuggingModes" ascii //weight: 1
        $x_1_16 = "CreateInstance" ascii //weight: 1
        $x_1_17 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CX_2147758803_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CX!MTB"
        threat_id = "2147758803"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fLogin" wide //weight: 1
        $x_1_2 = "tbPassWord" wide //weight: 1
        $x_1_3 = {44 00 61 00 74 00 61 00 20 00 53 00 6f 00 75 00 72 00 63 00 65 00 3d 00 44 00 45 00 53 00 4b 00 54 00 4f 00 50 00 2d 00 90 00 01 00 08 00 5c 00 90 00 01 00 08 00}  //weight: 1, accuracy: High
        $x_1_4 = "QuanLyGaraOtoDataSet" wide //weight: 1
        $x_1_5 = "EXEC dbo.USP_Login @userName , @passWord" wide //weight: 1
        $x_1_6 = "http://tempuri.org/QuanLyGaraOtoDataSet.xsd" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AI_2147758865_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AI!MTB"
        threat_id = "2147758865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 14 00 00 0a 00 16 28 15 00 00 0a 00 73 77 00 00 06 0a 2a}  //weight: 1, accuracy: High
        $x_1_2 = {28 e6 00 00 0a 28 81 00 00 06 28 7a 00 00 06 6f e7 00 00 0a 0a 02 06 28 78 00 00 06 0b 02 07 28 7b 00 00 06 00 16 28 e8 00 00 0a 00 16 0c 2b 00 08 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AI_2147758865_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AI!MTB"
        threat_id = "2147758865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {18 9a 1f 09 95 2d 03 16 2b 01 17 17 59 7e 0b 00 00 04 16 9a 20 db 01 00 00 95 5f 7e 0b 00 00 04 16 9a 20 e5 01 00 00 95 61 59}  //weight: 2, accuracy: High
        $x_2_2 = {19 9a 20 01 05 00 00 95 e0 95 7e 0b 00 00 04 19 9a 20 de 0c 00 00 95 61 7e 0b 00 00 04 19 9a 20 c1 0b 00 00 95 2e 03 17 2b 01 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AJ_2147758878_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJ!MTB"
        threat_id = "2147758878"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {19 9a 20 af 11 00 00 95 e0 95 7e 23 00 00 04 19 9a 20 98 10 00 00 95 61 7e 23 00 00 04 19 9a 20 0f 0a 00 00 95 2e 03 17 2b 01 16 58 6a}  //weight: 2, accuracy: High
        $x_2_2 = {17 9a 1f 3d 95 2c 03 16 2b 01 17 17 59 7e 23 00 00 04 19 9a 20 59 13 00 00 95 5f 7e 23 00 00 04 19 9a 20 2a 12 00 00 95 61 59 81 05 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AK_2147759203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AK!MTB"
        threat_id = "2147759203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 7b a5 01 00 04 06 07 03 [0-48] 0c 08 2c 0f 07 08 58 0b 03 08 59 [0-48] 03 16 30 df 07 06 8e 69 2e 13 07 [0-48] 0d 06 16 09 16 07 [0-48] 09 0a 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AK_2147759203_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AK!MTB"
        threat_id = "2147759203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 45 0b 00 00 95 5a 7e 0d 00 00 04 20 f0 0d 00 00 95 58 61 81 07 00 00 01 28 0a 00 00 06 7e 1a 00 00 04 18 9a 1f 40 95 7e 0d 00 00 04 20 94 0c 00 00 95 33 37}  //weight: 2, accuracy: High
        $x_2_2 = {17 59 7e 0d 00 00 04 20 cf 03 00 00 95 5f 7e 0d 00 00 04 20 00 09 00 00 95 61 61 81 07 00 00 01 38 9a 00 00 00 7e 1a 00 00 04 18 9a 1f 40 95 7e 0d 00 00 04 20 c5 07 00 00 95 33 5b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RD_2147759383_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RD!MTB"
        threat_id = "2147759383"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 0b 2b 27 08 06 07 6f 3e 00 00 0a 26 08 06 07 6f 3e 00 00 0a 13 05 11 05 28 3f 00 00 0a 13 06 11 04 09 11 06 d2 9c 07 17 58 0b 07 08 6f 40 00 00 0a fe 04 13 07 11 07 2d ca 09 17 58 0d 06 17 58 0a 06 08 6f 41 00 00 0a fe 04 13 08 11 08 2d af}  //weight: 2, accuracy: High
        $x_2_2 = {28 43 00 00 0a 02 6f 44 00 00 0a 0a 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RD_2147759383_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RD!MTB"
        threat_id = "2147759383"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 0c 11 0d 9a 13 08 00 02 11 07 11 08 28 02 00 00 06 00 00 11 0d 17 58 13 0d 11 0d 11 0c 8e 69 fe 04 13 0e 11 0e 2d d8}  //weight: 5, accuracy: High
        $x_1_2 = "Tyxif.exe" wide //weight: 1
        $x_1_3 = "SharpDevelop Projects\\Tyxif\\Tyxif\\obj\\Debug\\Tyxif.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AL_2147759397_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AL!MTB"
        threat_id = "2147759397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {26 00 11 05 7b 10 00 00 04 28 21 00 00 0a 28 22 00 00 0a 6f 23 00 00 0a 00 dd 05}  //weight: 2, accuracy: High
        $x_1_2 = "RFESXG.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AL_2147759397_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AL!MTB"
        threat_id = "2147759397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {18 9a 20 21 03 00 00 95 e0 95 7e 60 00 00 04 18 9a 20 8e 04 00 00 95 61 08 0a 7e 60 00 00 04 18 9a 20 df 0d 00 00 95 2e 03 17 2b 01 16 58}  //weight: 2, accuracy: High
        $x_2_2 = {18 9a 20 68 0c 00 00 95 2e 03 16 2b 01 17 17 59 7e 60 00 00 04 18 9a 20 40 0a 00 00 95 5f 7e 60 00 00 04 18 9a 20 91 0f 00 00 95 61 58}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AL_2147759397_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AL!MTB"
        threat_id = "2147759397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 17 9a 28 50 ?? ?? 0a 28 14 ?? ?? 06 0c 02 07 19 9a 28 50 ?? ?? 0a 28 14 ?? ?? 06 0d 28 06 ?? ?? 06 6f 4a ?? ?? 0a 06 72 39 ?? ?? 70 07 18 9a 53 00 6f 4b ?? ?? 0a 6f 4c ?? ?? 0a 0a 28 4d ?? ?? 0a 28 4e ?? ?? 0a 72 1f ?? ?? 70 15 16 28 4f ?? ?? 0a 0b 02}  //weight: 2, accuracy: Low
        $x_2_2 = {1a 9a 28 51 ?? ?? 0a 09 16 6f 52 ?? ?? 0a 00 06 72 39 ?? ?? 70 07 18 9a 36 00 28 51 ?? ?? 0a 08 16 6f 52 ?? ?? 0a 00 28 06 ?? ?? 06 6f 4a ?? ?? 0a 06 72 39 ?? ?? 70 07}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SN_2147759636_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SN!MTB"
        threat_id = "2147759636"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 07 00 00 06 28 60 02 00 0a 6f 61 02 00 0a 13 04 73 62 02 00 0a 0b 28 55 07 00 06 75 3b 00 00 1b 73 63 02 00 0a 0c 08 11 04 16 73 64 02 00 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SN_2147759636_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SN!MTB"
        threat_id = "2147759636"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0d 11 04 20 ?? ?? ?? ?? 5a 20 ?? ?? ?? ?? 61 f0 00 07 17 7e ?? ?? ?? ?? a2 06 6f ?? ?? ?? ?? 16 9a 6f ?? ?? ?? ?? 19 9a 14 07 6f ?? ?? ?? ?? 0c 72}  //weight: 2, accuracy: Low
        $x_2_2 = {0b 11 04 20 ?? ?? ?? ?? 5a 20 ?? ?? ?? ?? 61 38 f0 00 72 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 72 ?? ?? ?? ?? 20 00 01 00 00 14 14 17 8d ?? ?? ?? ?? 25 16 28 ?? ?? ?? ?? 72 ?? ?? ?? ?? 72 ?? ?? ?? ?? 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? a2 6f ?? ?? ?? ?? 74 ?? ?? ?? ?? 0a 7e}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_F_2147759675_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.F!MTB"
        threat_id = "2147759675"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fdfrf.dll" wide //weight: 1
        $x_1_2 = {47 65 74 52 61 6e 64 6f 6d 46 69 6c 65 4e 61 6d 65 00 67 65 74 5f 4d 6f 64 75 6c 65 4e 61 6d 65 00 47 65 74 50 72 6f 63 65 73 73 65 73 42 79 4e 61 6d 65 00 41 73 73 65 6d 62 6c 79 4e 61 6d 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AO_2147759704_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AO!MTB"
        threat_id = "2147759704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 17 02 0a 09 0f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 6b 00 00 00 27 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MK_2147759711_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MK!MTB"
        threat_id = "2147759711"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 3c 00 00 06 72 57 ?? ?? ?? 72 5b ?? ?? ?? 6f 74 ?? ?? ?? 72 63 ?? ?? ?? 72 67 ?? ?? ?? 6f 74 ?? ?? ?? 72 6b 05 00 70 72 6f 05 00 70 6f 74 ?? ?? ?? 17 8d 61 00 00 01 25 16 1f 2d 9d 6f 75 ?? ?? ?? 0a 06 8e 69 8d 62 00 00 01 0b 16 13 06 2b 15 07 11 06 06 11 06 9a 1f 10 28 76 ?? ?? ?? 9c 11 06 17 58 13 06 11 06 06 8e 69 fe 04 13 07 11 07 2d de}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZA_2147759780_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZA"
        threat_id = "2147759780"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "lazarus4" ascii //weight: 1
        $x_1_2 = "Evilboy" wide //weight: 1
        $x_1_3 = "RSMD_EC" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "Rfc2898DeriveBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZB_2147759781_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZB"
        threat_id = "2147759781"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 9a 0a 02 06 28 50 00 00 11 ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 72 ?? ?? ?? ?? 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? [0-32] ?? ?? ?? ?? 00 16 28 ?? ?? ?? ?? 00 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {16 9a 0a 02 06 50 00 11 ?? 4e 00 00 0a 02 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? [0-32] 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 2a}  //weight: 1, accuracy: Low
        $x_1_3 = {16 9a 0a 02 06 28 50 00 00 11 28 3d ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? [0-32] 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AF_2147759782_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AF!MTB"
        threat_id = "2147759782"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Projects\\HotelManagementSystemRoom\\HotelManagementSystemRoom\\Hotel.mdf" wide //weight: 1
        $x_1_2 = "http://tempuri.org/HotelDataSet.xsd" wide //weight: 1
        $x_1_3 = "SELECT username FROM admin WHERE password=" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AF_2147759782_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AF!MTB"
        threat_id = "2147759782"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 2e 03 17 2b 01 16 58 7e 2a 00 00 04 7e 10 00 00 04 20 0d 07 00 00 95 e0 95 7e 10 00 00 04 20 de 0f 00 00 95 61 7e 10 00 00 04 20 fa 0c 00 00 95 2e 03 17 2b 01 16}  //weight: 2, accuracy: High
        $x_2_2 = {20 c5 0d 00 00 95 e0 95 7e 10 00 00 04 20 8e 11 00 00 95 61 7e 10 00 00 04 20 b4 0e 00 00 95 2e 03 17 2b 01 16 58}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AP_2147759850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AP!MTB"
        threat_id = "2147759850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2 73 ?? ?? ?? 06 7d ?? ?? ?? 04 02 28 ?? ?? ?? 0a 02 16}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AP_2147759850_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AP!MTB"
        threat_id = "2147759850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {19 9a 20 5b 10 00 00 95 e0 95 7e 29 00 00 04 19 9a 20 59 0e 00 00 95 61 7e 29 00 00 04 19 9a 20 1c 03 00 00 95 2e 03 17 2b 01 16}  //weight: 2, accuracy: High
        $x_2_2 = {19 9a 20 42 11 00 00 95 5f 7e 29 00 00 04 19 9a 1f 7d 95 61 61 80 27 00 00 04 2b 72 7e 27 00 00 04 7e 29 00 00 04 19 9a 20 5f 06 00 00 95 33 44}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AP_2147759850_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AP!MTB"
        threat_id = "2147759850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0d 16 13 05 2b 15 09 11 05 08 11 05 91 20 89 00 00 00 61 d2 9c 11 05 17 58 13 05 11 05 08 8e 69 17 59}  //weight: 2, accuracy: High
        $x_1_2 = "\\Microsoft\\EdgeFss\\FileSyncShell64.dat" wide //weight: 1
        $x_1_3 = "GetCurrentProcess" ascii //weight: 1
        $x_1_4 = "WriteProcessMemory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQ_2147759944_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQ!MTB"
        threat_id = "2147759944"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 02 07 8f 10 00 00 01 25 71 10 00 00 01 06 07 00 23 [0-48] 40 23 [0-48] 40 28 ?? ?? ?? 0a 58 28 ?? ?? ?? 0a 5d 91 61 d2 81 ?? ?? ?? 01 00 07 17 58 0b 07 02 8e 69 fe 04 0d 09 2d ba}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQ_2147759944_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQ!MTB"
        threat_id = "2147759944"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1b 9a 20 9f 0f 00 00 95 e0 95 7e 2a 00 00 04 1b 9a 20 64 03 00 00 95 61 7e 2a 00 00 04 1b 9a 20 f8 09 00 00 95 2e 03 17 2b 01 16 58}  //weight: 2, accuracy: High
        $x_2_2 = {1b 9a 20 af 0f 00 00 95 5f 7e 2a 00 00 04 1b 9a 20 86 08 00 00 95 61 61 81 05 00 00 01 7e 2a 00 00 04 19 9a 1f 2f 95 7e 2a 00 00 04 1b 9a 20 39 05 00 00 95 33 6c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AU_2147759967_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AU!MTB"
        threat_id = "2147759967"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Ths} program*mannot be*|un in DO]*mode" ascii //weight: 1
        $x_1_2 = "FA2605DBDA469078AAFA5B746A2A0306FE735B88308380821F76A2BA7830204E" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AU_2147759967_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AU!MTB"
        threat_id = "2147759967"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {06 07 02 07 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 06 8e 69 32}  //weight: 3, accuracy: Low
        $x_2_2 = "86 45 94 55 B6 27 F6 77 56 D6 16 27 64 47 96 F6 27 56 A5 F2 D6 F6 36 E2 67 27 37 16 47 C6 57 E2 03 03 13 93 73 03 63 33" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NS_2147760125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NS!MTB"
        threat_id = "2147760125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$f522119f-f12f-476a-b6e4-2655cc8c5ba2" ascii //weight: 1
        $x_1_2 = "RangePartition.dll" ascii //weight: 1
        $x_1_3 = {57 9d a2 29 09 1e 00 00 00 fa 01 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_4 = "GetPixel" ascii //weight: 1
        $x_1_5 = "GetMethods" ascii //weight: 1
        $x_1_6 = "BitConverter" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NS_2147760125_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NS!MTB"
        threat_id = "2147760125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {1f 30 8d c8 00 00 01 13 04 06 6f ?? ?? ?? 0a 16 11 04 16 1f 20 28 ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "UploadReportLogin.asmx" wide //weight: 1
        $x_1_3 = "ServerR2" wide //weight: 1
        $x_1_4 = "set_Expect100Continue" ascii //weight: 1
        $x_1_5 = "FormChooseLanguage_Load" ascii //weight: 1
        $x_1_6 = "Concat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NS_2147760125_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NS!MTB"
        threat_id = "2147760125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_7_1 = {a2 25 17 28 [0-4] a2 25 18 72 [0-4] a2 0a 72 [0-4] 0b 28 [0-4] 6f [0-4] 16 9a 72 [0-4] 18 17 8d [0-4] 25 16 07 28 [0-4] 28 [0-4] a2 28 [0-4] 06 28 [0-4] 2a}  //weight: 7, accuracy: Low
        $x_1_2 = "Bunifu.UI.Bunifu_Button" ascii //weight: 1
        $x_1_3 = "Bunifu_TextBox" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "GetAssemblies" ascii //weight: 1
        $x_1_6 = "GetDomain" ascii //weight: 1
        $x_1_7 = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567" ascii //weight: 1
        $x_1_8 = "OffsetMarshaler" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((7 of ($x_1_*))) or
            ((1 of ($x_7_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_M_2147760196_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.M!MTB"
        threat_id = "2147760196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 0c 02 08 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 7e ?? ?? ?? 04 07 1f 10 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 2b c9}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_M_2147760196_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.M!MTB"
        threat_id = "2147760196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0b 07 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 14 1a 8d ?? ?? ?? 01 25 d0 ?? ?? ?? 04 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 18 8d ?? ?? ?? 01 25 17 03 a2 14 14 28 ?? ?? ?? 0a 26 72 ?? ?? ?? ?? 0c 2b 00 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_M_2147760196_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.M!MTB"
        threat_id = "2147760196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {01 57 15 02 08 09 01 ?? ?? ?? fa 01 33 00 16 00 00 01 ?? ?? ?? 2a ?? ?? ?? 06 ?? ?? ?? 03 ?? ?? ?? 0e}  //weight: 3, accuracy: Low
        $x_3_2 = "Zlafm" ascii //weight: 3
        $x_3_3 = "get_CurrentDomain" ascii //weight: 3
        $x_3_4 = "get_FullName" ascii //weight: 3
        $x_3_5 = "GetDomain" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_M_2147760196_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.M!MTB"
        threat_id = "2147760196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 15 a2 09 09 01 00 00 00 10 00 01 00 00 00 00 01 00 00 00 2b 00 00 00 06 00 00 00 04 00 00 00 0f 00 00 00 02 00 00 00 2e 00 00 00 17 00 00 00 09}  //weight: 3, accuracy: High
        $x_3_2 = "ApplicationSettingsBase" ascii //weight: 3
        $x_3_3 = "SmartAssembly.Attributes" ascii //weight: 3
        $x_3_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 3
        $x_3_5 = "set_SecurityProtocol" ascii //weight: 3
        $x_3_6 = "SecurityProtocolType" ascii //weight: 3
        $x_3_7 = "Stopwatch" ascii //weight: 3
        $x_3_8 = "WebRequest" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_L_2147760289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.L!MTB"
        threat_id = "2147760289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetRunningDocumentsEnum" ascii //weight: 1
        $x_1_2 = "System.IO.Compression" ascii //weight: 1
        $x_1_3 = "IEnumRunningDocuments" ascii //weight: 1
        $x_1_4 = "IPAddress" ascii //weight: 1
        $x_1_5 = {28 15 00 00 06 72 01 00 00 70 28 16 00 00 06 72 05 00 00 70 28 46 00 00 0a 28 47 00 00 0a 28 17 00 00 06 28 48 00 00 0a 20 02 00 00 00 8d 07 00 00 01 25 20 01 00 00 00 20 01 00 00 00 8d 07 00 00 01 25 20 00 00 00 00 28 49 00 00 0a a2 a2 28 4a 00 00 0a 26}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_I_2147760292_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.I!MTB"
        threat_id = "2147760292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 16 72 ?? ?? ?? ?? a2 06 17 02 28 ?? ?? ?? 06 a2 06 18 7e ?? ?? ?? 04 a2 06 28 ?? ?? ?? 0a 00 06 73 ?? ?? ?? 06 0b 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_I_2147760292_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.I!MTB"
        threat_id = "2147760292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {57 4d 5f 4b 45 59 46 49 52 53 54 00 57 4d 5f 4b 45 59 44 4f 57 4e 00 57 4d 5f 4b 45 59 55 50 00 57 4d 5f 43 48 41 52 00 57 4d 5f 44 45 41 44 43 48 41 52 00 57 4d 5f 53 59 53 4b 45 59 44 4f 57 4e 00 57 4d 5f 53 59 53 4b 45 59 55 50 00 57 4d 5f 53 59 53 43 48 41 52 00 57 4d 5f 53 59 53 44 45 41 44 43 48 41 52 00 57 4d 5f 4b 45 59 4c 41 53 54 00 57 4d 5f 49 4d 45 5f 53 54 41 52 54 43}  //weight: 2, accuracy: High
        $x_1_2 = {54 6f 43 68 61 72 41 72 72 61 79 00 52 65 76 65 72 73 65 00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67}  //weight: 1, accuracy: High
        $x_1_3 = "Novel by Honor" ascii //weight: 1
        $x_1_4 = "Goriot.Controls" ascii //weight: 1
        $x_1_5 = "EjectAfterBoot" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_Q_2147760336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.Q!MTB"
        threat_id = "2147760336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 0c 02 08 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 7e ?? ?? ?? 04 07 ?? 23 [0-32] 23 [0-48] 28 ?? ?? ?? 0a 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 2b}  //weight: 1, accuracy: Low
        $x_1_2 = {07 0c 02 08 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 7e ?? ?? ?? 04 07 ?? 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 61 69 5d 91 61 d2 81 ?? ?? ?? 01 07 17 58 0b 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_Q_2147760336_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.Q!MTB"
        threat_id = "2147760336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "M*$#*$#QqVT" ascii //weight: 3
        $x_1_2 = "==*$#*$#*$#*$#*$#*$#*" ascii //weight: 1
        $x_1_3 = "CryptoServer" ascii //weight: 1
        $x_1_4 = {54 6f 43 68 61 72 41 72 72 61 79 00 52 65 76 65 72 73 65 00 52 65 70 6c 61 63 65 00 43 6f 6e 76 65 72 74 00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67}  //weight: 1, accuracy: High
        $x_1_5 = {54 6f 43 68 61 72 41 72 72 61 79 00 52 65 76 65 72 73 65 00 52 65 70 6c 61 63 65 00 47 65 74 54 79 70 65 00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00 49 6e 76 6f 6b 65 4d 65 6d 62 65}  //weight: 1, accuracy: High
        $x_1_6 = "mscoree.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_3_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_Q_2147760336_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.Q!MTB"
        threat_id = "2147760336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "stnemhc" wide //weight: 1
        $x_1_2 = "drocsid.ndc" wide //weight: 1
        $x_1_3 = "lld.rotarepOyreuQyraniB" wide //weight: 1
        $x_1_4 = "BinaryQueryOperator.DecimalSumAggregationOperator" wide //weight: 1
        $x_1_5 = "F2 D6 F6 36 E2 67 27 37 16 47 C6 57 E2 43 23 33 13 93 23 73 83 67 27 37 F2 F2 A3 07 47 47 86" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GN_2147760429_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GN!MTB"
        threat_id = "2147760429"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 14 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? ?? a2 25 18 72 ?? ?? ?? 70 a2 14 6f ?? ?? ?? 0a [0-16] 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GN_2147760429_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GN!MTB"
        threat_id = "2147760429"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 11 07 7e 01 00 00 04 11 07 91 7e 01 00 00 04 16 91 61 d2 9c 11 07 17 58 13 07 20 15 00 cf 30 20 00 00 80 00 58 20 00 00 80 00 59 fe 0e 0b 00 fe 0d 0b 00 00 48 68 d3 13 0a 38}  //weight: 1, accuracy: High
        $x_1_2 = "costura.costura.dll.compressed" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GN_2147760429_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GN!MTB"
        threat_id = "2147760429"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 08 06 8e 69 6a 5d d4 06 08 06 8e 69 6a 5d d4 91 07 08 07 8e 69 6a 5d d4 91 61 28 ?? ?? ?? 0a 06 08 17 6a 58 06 8e 69 6a 5d d4 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d 28 ?? ?? ?? 0a 9c 00 08 17 6a 58 0c 08 06 8e 69 17 59 6a 02 17 58 6e 5a fe 02 16 fe 01 0d 09 2d a0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IM_2147760541_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IM!MTB"
        threat_id = "2147760541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 01 25 16 02 03 74 ?? ?? ?? 1b 0b 12 01 28 b2 00 00 06 0c 07 10 01 08 a2 14 14 14 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0a 02 06 72}  //weight: 10, accuracy: Low
        $x_1_2 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
        $x_1_3 = "imimimimim" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IM_2147760541_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IM!MTB"
        threat_id = "2147760541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 10 00 00 8d ?? ?? ?? 01 13 04 2b 0b 08 11 04 16 11 05 6f ?? ?? ?? 0a 09 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 25 13 05 16 30 e2}  //weight: 10, accuracy: Low
        $x_1_2 = {57 15 a2 21 09 08 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 2f 00 00 00 06 00 00 00 02 00 00 00 0b}  //weight: 1, accuracy: High
        $x_1_3 = "MemoryStream" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
        $x_1_5 = "AppDomain" ascii //weight: 1
        $x_1_6 = "GetDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AX_2147760901_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AX!MTB"
        threat_id = "2147760901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\\Microsoft.NET\\Framework\\v4.0.30319\\RegAsm.exe" wide //weight: 1
        $x_1_2 = "/create /sc MINUTE /tn" wide //weight: 1
        $x_1_3 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" wide //weight: 1
        $x_1_4 = "/C choice /C Y /N /D Y /T 3 & Del" wide //weight: 1
        $x_1_5 = "#startup_name#" wide //weight: 1
        $x_1_6 = "GetDelegateForFunctionPointer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AX_2147760901_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AX!MTB"
        threat_id = "2147760901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 02 16 28 ?? ?? ?? 0a 19 8d ?? ?? ?? 01 0a 06 16 7e ?? ?? ?? 04 a2 06 17 7e ?? ?? ?? 04 a2 06 18 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 a2 06 73 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AX_2147760901_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AX!MTB"
        threat_id = "2147760901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 86 05 00 00 95 80 1f 00 00 04 7e 28 00 00 04 1b 9a 1f 0b 8f 06 00 00 01 25 71 06 00 00 01 7e 28 00 00 04 18 9a 20 7e 07 00 00 95 61 81 06 00 00 01 7e 28 00 00 04 1b 9a 1f 0b 95 7e 28 00 00 04 18 9a 20 ec 02 00 00 95 40 9a 04 00 00}  //weight: 2, accuracy: High
        $x_2_2 = {94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSA_2147760939_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSA!MTB"
        threat_id = "2147760939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 d5 a2 fd 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 a4 00 00 00 1f 00 00 00}  //weight: 5, accuracy: High
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ATMManager.Update.resources" ascii //weight: 1
        $x_1_6 = "get_CardNum" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GK_2147760989_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GK!MTB"
        threat_id = "2147760989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {53 74 72 52 65 76 65 72 73 65 00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00 4c 61 74 65 47 65 74 00 43 6f 6d 70 61 72 65 45 78 63 68 61 6e 67 65 00 53 75 62 74 72 61 63 74}  //weight: 1, accuracy: High
        $x_1_2 = "QqVT" ascii //weight: 1
        $x_2_3 = {80 eb a6 84 ec a7 80 45 eb a6 84 ec a7 80 eb a6 84 ec a7 80 4d eb a6 84 ec a7 80 51 71 56 54 40}  //weight: 2, accuracy: High
        $x_1_4 = {eb a6 84 ec a7 80 eb a6 84 ec a7}  //weight: 1, accuracy: High
        $x_1_5 = "DeltaEngine.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_1_*))) or
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GK_2147760989_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GK!MTB"
        threat_id = "2147760989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "PunkteEditierenToolStripMenuItem" ascii //weight: 1
        $x_1_2 = "BangunRuangToolStripMenuItem" ascii //weight: 1
        $x_1_3 = "LingkaranToolStripMenuItem" ascii //weight: 1
        $x_1_4 = "AnutiasToolStripMenuItem" ascii //weight: 1
        $x_1_5 = "SisipanToolStripMenuItem" ascii //weight: 1
        $x_1_6 = "Legt fest, welche Farbe die Beschriftung haben" ascii //weight: 1
        $x_1_7 = "die Kreuze sein sollen" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GK_2147760989_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GK!MTB"
        threat_id = "2147760989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$a214202b-8605-43fb-a0d4-2833184b640a" ascii //weight: 20
        $x_20_2 = "$3f2d8ada-aa15-40ea-b97c-840ce704e706" ascii //weight: 20
        $x_20_3 = "$b87eb131-34ce-456a-8038-b215473ebffd" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GL_2147760990_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GL!MTB"
        threat_id = "2147760990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {61 73 65 36 34 53 74 72 69 6e 67 00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_2 = {1e 1e 0d 0d 0d 0d 0d 1e 1e 0d 0d 0d 57 64 ab 11}  //weight: 1, accuracy: High
        $x_2_3 = "am trnnot sv run" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_1_*))) or
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GL_2147760990_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GL!MTB"
        threat_id = "2147760990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 07 7e 01 00 00 04 11 07 91 7e 01 00 00 04 16 91 61 d2 9c 11 07 17 58 13 07 20 [0-4] 20 01 00 00 00 ?? fe 0e 0b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {48 68 d3 13 0a 38 ?? fa ff ff}  //weight: 1, accuracy: Low
        $x_1_3 = "costura.costura.dll.compressed" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GL_2147760990_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GL!MTB"
        threat_id = "2147760990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {50 68 61 72 6d 61 63 79 [0-15] 2e 50 72 6f 70 65 72 74 69 65 73 2e 52 65 73 6f 75 72 63 65 73}  //weight: 10, accuracy: Low
        $x_10_2 = "ExpenseManager.Properties.Resources" ascii //weight: 10
        $x_1_3 = "Getxxx" ascii //weight: 1
        $x_1_4 = "Setxxx" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "Flora" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "Invoke" ascii //weight: 1
        $x_1_9 = "Form1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GH_2147761067_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GH!MTB"
        threat_id = "2147761067"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {ff 1f 6e 7e ?? ?? ?? 04 1f 76 7e ?? ?? ?? 04 1f 76 91 7e ?? ?? ?? 04 1f 1c 91 61 1b 5f 9c 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {ff 1f 4d 7e ?? ?? ?? 04 1f 3b 7e ?? ?? ?? 04 1f 3b 94 7e ?? ?? ?? 04 20 ?? ?? ?? 00 94 5a 20 ?? ?? ?? 00 5f 9e 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_GH_2147761067_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GH!MTB"
        threat_id = "2147761067"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 6f 7a 65 6e 62 61 79 6e 2e 46 6f 72 6d ?? 2e 72 65 73 6f 75 72 63 65 73}  //weight: 1, accuracy: Low
        $x_1_2 = {70 72 6f 6a 65 74 6f 72 2e 46 6f 72 6d ?? 2e 72 65 73 6f 75 72 63 65 73}  //weight: 1, accuracy: Low
        $x_1_3 = "Form1.resources" ascii //weight: 1
        $x_1_4 = "Form2.resources" ascii //weight: 1
        $x_1_5 = "Form3.resources" ascii //weight: 1
        $x_1_6 = {46 6f 72 6d ?? 5f 4c 6f 61 64}  //weight: 1, accuracy: Low
        $x_1_7 = "get_Assembly" ascii //weight: 1
        $x_1_8 = "get_Length" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
        $x_1_10 = "Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (9 of ($x*))
}

rule Trojan_MSIL_AgentTesla_G_2147761172_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.G!MTB"
        threat_id = "2147761172"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = "MAAQqVT@" ascii //weight: 3
        $x_3_2 = "DelphineDelphineDelphine" ascii //weight: 3
        $x_4_3 = {00 11 00 28 b0 03 00 06 72 55 3a 00 70 72 67 3a 00 70 6f 35 00 00 0a 28 36 00 00 0a 28 37 00 00 0a 0a 72 6f 3a 00 70 72 b9 3a 00 70 72 c7 3a 00 70 28 35 00 00 0a 28 38 00 00 0a 7e 19 03 00 04 20 00 01 00 00 14 14 17}  //weight: 4, accuracy: High
        $x_4_4 = {02 00 06 20 ?? ?? ?? ?? 28 18 04 00 06 20 ?? ?? ?? ?? 28 18 04 00 06 6f b0 00 00 0a 28 b1 00 00 0a 28 b2 00 00 0a 0a 20 ?? ?? ?? ?? 28 18 04 00 06 20 ?? ?? ?? ?? 28 18 04 00 06 20 ?? ?? ?? ?? 28 18 04 00 06 28 b0 00 00 0a 28 b3 00 00 0a 7e cd 01 00 04 20 00 01 00 00 14 14 17}  //weight: 4, accuracy: Low
        $x_1_5 = {52 65 70 6c 61 63 65 [0-3] 53 74 72 52 65 76 65 72 73 65 [0-3] 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 [0-3] 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 [0-3] 43 61 6c 6c 42 79 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_6 = "GetAsyncKeyState" ascii //weight: 1
        $x_1_7 = {61 64 64 5f 4b 65 79 44 6f 77 6e [0-3] 61 64 64 5f 4b 65 79 55 70 [0-3] 61 64 64 5f 4d 6f 75 73 65 44 6f 77 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 1 of ($x_1_*))) or
            ((2 of ($x_3_*))) or
            ((1 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_K_2147761188_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.K!MTB"
        threat_id = "2147761188"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BlendCore.Resources" wide //weight: 1
        $x_1_2 = "RatRunPct" wide //weight: 1
        $x_1_3 = "RatPct" wide //weight: 1
        $x_1_4 = "RatRun" wide //weight: 1
        $x_1_5 = "RatRun5" wide //weight: 1
        $x_1_6 = "BackRat" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_K_2147761188_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.K!MTB"
        threat_id = "2147761188"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 28 ?? ?? ?? 06 9d 25 17 28 ?? ?? ?? 06 9d 25 18 28 ?? ?? ?? 06 9d 25 19 28 ?? ?? ?? 06 9d 73 ?? ?? ?? 0a 80 ?? ?? ?? 04 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_N_2147761464_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.N!MTB"
        threat_id = "2147761464"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "StartGame" wide //weight: 1
        $x_1_2 = "GameOver" wide //weight: 1
        $x_10_3 = {52 65 76 65 72 73 65 00 43 6f 6e 76 65 72 74 00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67}  //weight: 10, accuracy: High
        $x_1_4 = "Tetris.Desktop.GameOver" ascii //weight: 1
        $x_1_5 = "GAME_OVER_LAYER" wide //weight: 1
        $x_1_6 = {00 52 61 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_N_2147761464_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.N!MTB"
        threat_id = "2147761464"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 13 04 7e ?? ?? ?? 04 16 7e ?? ?? ?? 04 a2 7e ?? ?? ?? 04 17 7e ?? ?? ?? 04 a2 7e ?? ?? ?? 04 18 72 ?? ?? ?? ?? a2 14 d0 ?? ?? ?? 01}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_N_2147761464_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.N!MTB"
        threat_id = "2147761464"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "EnableFocusTracking" ascii //weight: 3
        $x_3_2 = "System.CodeDom.Compiler" ascii //weight: 3
        $x_3_3 = "System.Security.Cryptography" ascii //weight: 3
        $x_3_4 = "WpfTouchKeyboard" ascii //weight: 3
        $x_3_5 = "ServiceHub.Host" ascii //weight: 3
        $x_3_6 = "2.4.227.2020" ascii //weight: 3
        $x_3_7 = "2.4.227+e4076a6e7d.RR" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_N_2147761464_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.N!MTB"
        threat_id = "2147761464"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Aeeee" ascii //weight: 1
        $x_1_2 = "RMQYKqZrL8JgpwH4h0Ypw" wide //weight: 1
        $x_1_3 = "2yM7fktBX6SdeGdvedJ9Vj6Sti1tcRCC4sUSQXCxS4" wide //weight: 1
        $x_1_4 = "Scripts" wide //weight: 1
        $x_1_5 = "LoadFromXMLString" ascii //weight: 1
        $x_1_6 = "AnchorStyles" ascii //weight: 1
        $x_1_7 = "Alicium2.Properties.Resources" wide //weight: 1
        $x_1_8 = "WebBrowser" ascii //weight: 1
        $x_1_9 = "Verdana" wide //weight: 1
        $x_1_10 = "PostText" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OA_2147761473_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OA!MTB"
        threat_id = "2147761473"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Parampaa" ascii //weight: 1
        $x_1_2 = {47 65 74 50 72 6f 70 65 72 74 79 00 58 58 58}  //weight: 1, accuracy: High
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = {41 72 72 61 79 00 43 6f 70 79}  //weight: 1, accuracy: High
        $x_1_5 = "GODofBeauty" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule Trojan_MSIL_AgentTesla_P_2147761474_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.P!MTB"
        threat_id = "2147761474"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {28 28 00 00 0a 20 68 02 a9 fc 28 3c 01 00 06 6f 29 00 00 0a 1e 8d 1a 00 00 01 17 73 2a 00 00 0a 0c 73 2b 00 00 0a 0a 06 08 1f 10 6f 2c 00 00 0a 6f 2d 00 00 0a 06 08 1f 10 6f 2c 00 00 0a 6f 2e 00 00 0a 06 6f 2f 00 00 0a 03 16 03 8e 69 6f 30 00 00 0a}  //weight: 10, accuracy: High
        $x_1_2 = "FromArgb" ascii //weight: 1
        $x_1_3 = "get_SaveMySettingsOnExit" ascii //weight: 1
        $x_1_4 = {43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00 54 72 61 6e 73 66 6f 72 6d 46 69 6e 61 6c 42 6c 6f 63 6b 00 43 6f 70 79}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_R_2147761784_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.R!MTB"
        threat_id = "2147761784"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {b5 13 04 17 0c 2b 25 07 09 02 08 17 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 61 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_R_2147761784_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.R!MTB"
        threat_id = "2147761784"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 28 ?? ?? ?? 06 9d 25 17 28 ?? ?? ?? 06 9d 25 28 ?? ?? ?? 06 73 ?? ?? ?? 0a [0-64] 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_S_2147761789_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.S!MTB"
        threat_id = "2147761789"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 12 00 00 0a 72 57 00 00 70 28 0d 00 00 06 6f 13 00 00 0a 28 13 00 00 06 28 02 00 00 2b 28 03 00 00 2b 13 02 38 00 00 00 00 dd 21}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_S_2147761789_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.S!MTB"
        threat_id = "2147761789"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 07 19 8d ?? ?? ?? 01 80 ?? ?? ?? 04 7e ?? ?? ?? 04 16 7e ?? ?? ?? 04 a2 7e ?? ?? ?? 04 17 7e ?? ?? ?? 04 a2 7e ?? ?? ?? 04 18 72 ?? ?? ?? ?? a2 02}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BD_2147761825_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BD!MTB"
        threat_id = "2147761825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e35f9389-5cf2-4ea7-9840-f6ff546077da" ascii //weight: 1
        $x_1_2 = "Blit.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BD_2147761825_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BD!MTB"
        threat_id = "2147761825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 1e 8d ?? ?? ?? ?? 0d 08 28 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 13 04 11 04 16 09 16 1e 28 ?? ?? ?? ?? 07 09 6f ?? ?? ?? ?? 07 18 6f ?? ?? ?? ?? 07 6f ?? ?? ?? ?? 03 16 03 8e 69 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BD_2147761825_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BD!MTB"
        threat_id = "2147761825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fa 01 33 00 02 00 00 01 00 00 00 3c 00 00 00 0b 00 00 00 0e 00 00 00 1f 00 00 00 16 00 00 00 50 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "CryptoObfuscator_Output" ascii //weight: 1
        $x_1_3 = "Users\\VICTOR" ascii //weight: 1
        $x_1_4 = "WERGHGHJHJF.pdb" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_T_2147761891_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.T!MTB"
        threat_id = "2147761891"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MAAQqVT" ascii //weight: 1
        $x_1_2 = "=,,,,,,,,,,,,,,,,,," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_T_2147761891_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.T!MTB"
        threat_id = "2147761891"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 0a 02 06 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 7e ?? ?? ?? 04 03 1f 10 5d 91 61 d2 81 ?? ?? ?? 01 02 06 91 0b 2b 00 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SA_2147761970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SA!MTB"
        threat_id = "2147761970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {8e 69 17 da 0b 16 0c 2b 32 06 02 02 7b ?? ?? ?? 04 08 9a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0a 08 02 7b ?? ?? ?? 04 8e 69 17 da 2e 0c 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 0a 08 17 d6 0c 08 07 31 ca}  //weight: 10, accuracy: Low
        $x_3_2 = "MediaManager" ascii //weight: 3
        $x_3_3 = "CsvDatabase" ascii //weight: 3
        $x_3_4 = "FormRawDatabase" ascii //weight: 3
        $x_3_5 = "FormSplashScreen" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SA_2147761970_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SA!MTB"
        threat_id = "2147761970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 26 13 07 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 13 08 2b 39 11 07 11 08 9a 13 09 06 11 09 6f ?? ?? ?? 06 25 26 2c 17}  //weight: 10, accuracy: Low
        $x_1_2 = "\\Roaming\\TReplaceokReplaceenReplaces.tReplacex" ascii //weight: 1
        $x_1_3 = "DownloadFile" ascii //weight: 1
        $x_1_4 = "%appdata%\\discord\\" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_V_2147762031_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.V!MTB"
        threat_id = "2147762031"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RunFIleInMemory" ascii //weight: 1
        $x_1_2 = "decryptBytes" ascii //weight: 1
        $x_1_3 = "UnblockFile" ascii //weight: 1
        $x_1_4 = {47 65 74 50 72 6f 63 65 73 73 65 73 00 4b 69 6c 6c}  //weight: 1, accuracy: High
        $x_1_5 = {67 65 74 5f 46 69 6c 65 4e 61 6d 65 00 67 65 74 5f 42 61 73 65 41 64 64 72 65 73 73}  //weight: 1, accuracy: High
        $x_1_6 = {52 75 6e 50 65 31 00 47 65 74 53 70 65 63 69 61 6c 46 6f 6c 64 65 72}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_V_2147762031_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.V!MTB"
        threat_id = "2147762031"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 15 a2 01 09 01 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 33 00 00 00 04 00 00 00 05 00 00 00 0d}  //weight: 3, accuracy: High
        $x_3_2 = "SecurityProtocolType" ascii //weight: 3
        $x_3_3 = "WebResponse" ascii //weight: 3
        $x_3_4 = "get_ResourceManager" ascii //weight: 3
        $x_3_5 = "ServicePointManager" ascii //weight: 3
        $x_3_6 = "99.0.4832.0" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_Y_2147762059_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.Y!MTB"
        threat_id = "2147762059"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {80 05 00 00 04 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 28 ?? ?? ?? 06 74 ?? ?? ?? 1b 80 ?? ?? ?? 04 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WB_2147762075_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WB!MTB"
        threat_id = "2147762075"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 03 91 19 59 1b 59 d2 2a}  //weight: 1, accuracy: High
        $x_1_2 = {02 03 02 03 28 0a 00 00 06 25 0a 9c 06 2a}  //weight: 1, accuracy: High
        $x_1_3 = {8d 2d 00 00 01 25 d0 21 00 00 04 16 2c 03 26 26 2a 28 16 00 00 0a 2b f8 32 02 28 37 00 00}  //weight: 1, accuracy: High
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WB_2147762075_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WB!MTB"
        threat_id = "2147762075"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "ShutdownEventHandler" ascii //weight: 3
        $x_3_2 = "ShutdownMode" ascii //weight: 3
        $x_3_3 = "Aspiring_Rookie.Resources.resources" ascii //weight: 3
        $x_3_4 = "DebuggerBrowsableAttribute" ascii //weight: 3
        $x_3_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 3
        $x_3_6 = "get_LeagueConnectionString" ascii //weight: 3
        $x_3_7 = "set_ShowInTaskbar" ascii //weight: 3
        $x_3_8 = "set_Dock" ascii //weight: 3
        $x_3_9 = "set_ShutdownStyle" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AS_2147762175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AS!MTB"
        threat_id = "2147762175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 08 6f 17 00 00 0a 0d 00 09 28 18 00 00 0a 72 53 00 00 70 28 19 00 00 0a 1f 1e 5d 5b 28 1a 00 00 0a 13 05 12 05 28 1b 00 00 0a 13 04 06 11 04 6f 1c 00 00 0a 26}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AS_2147762175_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AS!MTB"
        threat_id = "2147762175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {19 9a 20 b9 04 00 00 95 5f 7e 2e 00 00 04 19 9a 20 20 05 00 00 95 61 59 81 08 00 00 01 38 12 02 00 00 7e 09 00 00 04 1f 32 95}  //weight: 2, accuracy: High
        $x_2_2 = {16 2b 01 17 17 59 7e 21 00 00 04 20 41 05 00 00 95 5f 7e 21 00 00 04 20 ae 06 00 00 95 61 61 09 0d 81 08 00 00 01 7e 09 00 00 04 1f 12 95}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KG_2147762345_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KG"
        threat_id = "2147762345"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 1f 20 03 59 1f 1f 5f 64 02 03 1f 1f 5f 62 60 2a}  //weight: 5, accuracy: High
        $x_5_2 = {02 03 02 4b 03 05 5f 04 05 66 5f 60 58 0e 07 0e 04 e0 95 58 7e ?? ?? ?? ?? 0e 06 17 59 e0 95 58 0e 05 28}  //weight: 5, accuracy: Low
        $x_3_3 = "WindowsFormsApp" ascii //weight: 3
        $x_1_4 = "List_omdre.exe" ascii //weight: 1
        $x_1_5 = "$$method0x6000010-1" ascii //weight: 1
        $x_1_6 = "5r5oud" ascii //weight: 1
        $x_1_7 = "Lime_AsyncClientSpoofer" ascii //weight: 1
        $x_1_8 = "Lime_AsyncClientSpoofer.exe" ascii //weight: 1
        $x_1_9 = "Lime_AsyncClientSpoofer.Consumers" ascii //weight: 1
        $x_1_10 = "$$method0x600003d-1" ascii //weight: 1
        $x_1_11 = "bitclient1.exe" ascii //weight: 1
        $x_1_12 = "$$method0x6000065-1" ascii //weight: 1
        $x_1_13 = "WindowsFormsApp76.Properties" ascii //weight: 1
        $x_1_14 = "Lime_async.Definitions" ascii //weight: 1
        $x_1_15 = "CalcSchema" ascii //weight: 1
        $x_1_16 = "Lime_async.Specifications" ascii //weight: 1
        $x_1_17 = "Lime_Agent" ascii //weight: 1
        $x_1_18 = "Lime_Agent.exe" ascii //weight: 1
        $x_1_19 = "$$method0x600001c-1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((16 of ($x_1_*))) or
            ((1 of ($x_3_*) and 13 of ($x_1_*))) or
            ((1 of ($x_5_*) and 11 of ($x_1_*))) or
            ((1 of ($x_5_*) and 1 of ($x_3_*) and 8 of ($x_1_*))) or
            ((2 of ($x_5_*) and 6 of ($x_1_*))) or
            ((2 of ($x_5_*) and 1 of ($x_3_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RSB_2147763118_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSB!MTB"
        threat_id = "2147763118"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 29 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 77 00 00 00 0b 00 00 00 17 00 00 00 3c 00 00 00 4f 00 00 00 cd 00 00 00 17 00 00 00 01 00 00 00 22 00 00 00 03 00 00 00 06 00 00 00 07 00 00 00 0a 00 00 00 01 00 00 00 01 00 00 00 06 00 00 00 03 00 00 00 01 00 00 00 03}  //weight: 1, accuracy: High
        $x_1_2 = "fe70c855-0f31-4037-8cf5-9d7c6f897293" ascii //weight: 1
        $x_1_3 = "DesktopClean" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RS_2147763288_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RS!MTB"
        threat_id = "2147763288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 06 94 58 20 00 01 00 00 5d 94 13 07 09 11 05 08 11 05 91 11 07 61 d2 9c 11 05 17 58 13 05 11 05 08 8e 69 32 95}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RS_2147763288_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RS!MTB"
        threat_id = "2147763288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 08 09 28 55 00 00 06 28 53 00 00 06 28 52 00 00 06 28 54 00 00 06 28 51 00 00 06 28 50 00 00 06 d2 06 28 4e 00 00 06 09 17 58 0d 09 17 fe 04 13 04 11 04 2d ca}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RS_2147763288_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RS!MTB"
        threat_id = "2147763288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {07 28 13 00 00 0a 72 01 00 00 70 6f 14 00 00 0a 08 28 13 00 00 0a 72 01 00 00 70 6f 14 00 00 0a 8e 69 5d 91 06 08 91 61 d2 6f 15 00 00 0a 08 17 58 0c 08 06 8e 69 32 c8}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RS_2147763288_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RS!MTB"
        threat_id = "2147763288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {6f a4 00 00 0a 72 73 0c 00 70 72 77 0c 00 70}  //weight: 5, accuracy: High
        $x_5_2 = {07 06 11 07 9a 1f 10 28 a7 00 00 0a 6f a8 00 00 0a 00 11 07 17 58 13 07 11 07 20 00 ea 00 00 fe 04 13 08 11 08 2d d9}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RS_2147763288_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RS!MTB"
        threat_id = "2147763288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 12 06 28 1a 00 00 0a 08 06 18 6f 1b 00 00 0a 11 04 28 1c 00 00 0a 13 07 07 06 11 07 6f 1d 00 00 0a de 0b}  //weight: 1, accuracy: High
        $x_1_2 = {07 6f 20 00 00 0a 28 01 00 00 2b 13 05 1c 2c a5 11 05 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RS_2147763288_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RS!MTB"
        threat_id = "2147763288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 08 09 11 04 28 8c 00 00 06 28 8a 00 00 06 00 28 89 00 00 06 28 8b 00 00 06 28 88 00 00 06 00 07 17 8d 58 00 00 01 25 16 28 87 00 00 06 d2 9c 6f 59 00 00 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 05 11 05 2d b8}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MA_2147763404_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MA!MTB"
        threat_id = "2147763404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 95 a2 29 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 c3 00 00 00 1e 00 00 00 7f 02 00 00 04 04 00 00 8b 02}  //weight: 3, accuracy: High
        $x_3_2 = "GuidAttribute" ascii //weight: 3
        $x_3_3 = "HelpKeywordAttribute" ascii //weight: 3
        $x_3_4 = "GeneratedCodeAttribute" ascii //weight: 3
        $x_3_5 = "txtPassword" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MA_2147763404_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MA!MTB"
        threat_id = "2147763404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {07 00 00 00 04 00 00 00 0a 00 00 00 02 00 00 00 03 00 00 00 03 00 00 00 08}  //weight: 10, accuracy: High
        $x_3_2 = "aR3nbf8dQp2feLmk31" ascii //weight: 3
        $x_3_3 = "lSfgApatkdxsVcGcrktoFd" ascii //weight: 3
        $x_3_4 = "CopyTo" ascii //weight: 3
        $x_3_5 = "GetExecutingAssembly" ascii //weight: 3
        $x_3_6 = "GetManifestResourceStream" ascii //weight: 3
        $x_3_7 = "GetBytes" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MA_2147763404_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MA!MTB"
        threat_id = "2147763404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 15 a2 09 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 2b 00 00 00 06 00 00 00 06 00 00 00 10}  //weight: 3, accuracy: High
        $x_3_2 = "System.ComponentModel" ascii //weight: 3
        $x_3_3 = "ContinueWhenAll" ascii //weight: 3
        $x_3_4 = "set_AutoReset" ascii //weight: 3
        $x_3_5 = "TaskFactory" ascii //weight: 3
        $x_3_6 = "EditorBrowsableState" ascii //weight: 3
        $x_3_7 = "24032.3018.0.1" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MA_2147763404_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MA!MTB"
        threat_id = "2147763404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 95 a2 29 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 49 00 00 00 14 00 00 00 3b 00 00 00 56}  //weight: 10, accuracy: High
        $x_1_2 = "get_CurrentThread" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "CompressionMode" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "Debugger" ascii //weight: 1
        $x_1_7 = "TransformFinalBlock" ascii //weight: 1
        $x_1_8 = "rangeDecoder" ascii //weight: 1
        $x_1_9 = "ParameterizedThreadStart" ascii //weight: 1
        $x_1_10 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MA_2147763404_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MA!MTB"
        threat_id = "2147763404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "dda3478b-d463-4391-8c04-ecceb791fbf5" ascii //weight: 1
        $x_1_2 = "Discord_Shutdown" ascii //weight: 1
        $x_1_3 = "ByMynix.xyz" ascii //weight: 1
        $x_1_4 = "DownloadFileAsync" ascii //weight: 1
        $x_1_5 = "Discord_UpdatePresence" ascii //weight: 1
        $x_1_6 = "ConfusedByAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "IsLogging" ascii //weight: 1
        $x_1_9 = "DownloadString" ascii //weight: 1
        $x_1_10 = "MemoryStream" ascii //weight: 1
        $x_1_11 = "set_UseSystemPasswordChar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BE_2147763521_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BE!MTB"
        threat_id = "2147763521"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Pittsburgh12Mode" ascii //weight: 1
        $x_1_2 = "txtStore_KeyDown" ascii //weight: 1
        $x_1_3 = "NoSpaceCopyTextBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BE_2147763521_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BE!MTB"
        threat_id = "2147763521"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 09 09 09 00 00 00 5a a4 01 00 14 00 00 01 00 00 00 34 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "2.56.57.124/timo_Nnxddrsf.png" wide //weight: 1
        $x_1_3 = "powershell" wide //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BE_2147763521_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BE!MTB"
        threat_id = "2147763521"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Chr_0_M_e" ascii //weight: 1
        $x_1_2 = "FileZilla" ascii //weight: 1
        $x_1_3 = "g_E_c_" ascii //weight: 1
        $x_1_4 = "NordApp" ascii //weight: 1
        $x_1_5 = "CryptoHelper" ascii //weight: 1
        $x_1_6 = "FileScanning" ascii //weight: 1
        $x_1_7 = "AllWallets" ascii //weight: 1
        $x_1_8 = "Atomic" ascii //weight: 1
        $x_1_9 = "Binance" ascii //weight: 1
        $x_1_10 = "C_o1_n0_m" ascii //weight: 1
        $x_1_11 = "EL3_K_Tr00M" ascii //weight: 1
        $x_1_12 = "E_x0_d_u_S" ascii //weight: 1
        $x_1_13 = "ProtonVPN" ascii //weight: 1
        $x_1_14 = "BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSA_2147764446_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSA!MTB"
        threat_id = "2147764446"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 09 09 09 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 98 00 00 00 0d 00 00 00 4e 00 00 00 4f 00 00 00 4a 00 00 00 0a 01 00 00 3f 00 00 00 22 00 00 00 05 00 00 00 0d 00 00 00 0f 00 00 00 05 00 00 00 01 00 00 00 08 00 00 00 06 00 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = "16031b9e-bcfe-42ca-9442-4d66d1b95cef" ascii //weight: 1
        $x_1_3 = "IgniteFitnessTracker" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSC_2147764509_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSC!MTB"
        threat_id = "2147764509"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 29 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 9f 00 00 00 ef 00 00 00 c1 01 00 00 ac 02 00 00 e0 01 00 00 6a 01 00 00 d6 01 00 00 01 00 00 00 ec 00 00 00 02 00 00 00 04 00 00 00 05 00 00 00 0d 00 00 00 01 00 00 00 01 00 00 00 05 00 00 00 02 00 00 00 d9 00 00 00 04 00 00 00 03}  //weight: 1, accuracy: High
        $x_1_2 = "82516f76-caee-4f6f-942c-28969ac8c5a8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSD_2147764629_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSD!MTB"
        threat_id = "2147764629"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 29 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 9e 00 00 00 2b 00 00 00 05 01 00 00 45 01 00 00 64 01 00 00 57 01 00 00 42 00 00 00 01 00 00 00 55 00 00 00 03 00 00 00 07 00 00 00 09 00 00 00 13 00 00 00 01 00 00 00 01 00 00 00 07 00 00 00 1b 00 00 00 03 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_2 = "9c6251dc-6a93-48bb-bccf-e187420058ca" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_TA_2147764993_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TA!MTB"
        threat_id = "2147764993"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 08 20 ?? ?? ?? ?? 6f ?? ?? ?? ?? 08 20 ?? ?? ?? ?? 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 06 20 ?? ?? ?? ?? 73 ?? ?? ?? ?? 0d 08 09 08 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? ?? 6f ?? ?? ?? 0a 08 09 08 6f ?? ?? ?? ?? 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 08 17 6f ?? ?? ?? ?? 07 08 6f ?? ?? ?? ?? 17 73 ?? ?? ?? ?? 13 04 11 04 02 16 02 8e 69 6f ?? ?? ?? ?? 11 04}  //weight: 10, accuracy: Low
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FA_2147765189_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FA!MTB"
        threat_id = "2147765189"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 07 16 20 00 10 00 00 6f ?? ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 00 08 07 16 09 6f ?? ?? ?? 0a ?? ?? ?? 09 16 fe 02 13 05 11 05 2d d0 08 6f ?? ?? ?? 0a 13 06 de 16 08 2c 07 08 6f ?? ?? ?? 0a 00 dc}  //weight: 10, accuracy: Low
        $x_1_2 = "GZIDEKKKK" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "AES_Decrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FA_2147765189_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FA!MTB"
        threat_id = "2147765189"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$00452a94-597a-488b-9166-5fdcdc0daafc" ascii //weight: 20
        $x_20_2 = "$987b45a6-aed5-4f8f-b784-6b0ad85bebbc" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "LightWatch.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "Forge.Templating.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FC_2147765190_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FC!MTB"
        threat_id = "2147765190"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 03 50 02 04 28 ?? ?? ?? 06 04 28 10 00 00 0a 17 15 16 28 11 00 00 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {51 00 de 08 26 00 05 17 52 00 de 00 2a}  //weight: 1, accuracy: High
        $x_1_3 = "Convert" ascii //weight: 1
        $x_1_4 = "ToString" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "Concat" ascii //weight: 1
        $x_1_7 = "GetTy" ascii //weight: 1
        $x_1_8 = "EntryP" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FC_2147765190_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FC!MTB"
        threat_id = "2147765190"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$f8787ba1-c050-4b47-ade0-349b94117cdd" ascii //weight: 20
        $x_20_2 = "$f1cb664a-ad71-4b15-adc3-0d0ff420f840" ascii //weight: 20
        $x_20_3 = "$9ad89af9-9f59-4902-8be1-0a62af0bb735" ascii //weight: 20
        $x_20_4 = "$48648ae7-8923-4158-ab44-80f3041b0372" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FB_2147765334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FB!MTB"
        threat_id = "2147765334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0b 16 0c 02 6f ?? ?? ?? 0a 0d 2b 35 02 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 04 28 ?? ?? ?? 0a 20 18 04 00 00 da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 08 17 d6 0c 00 08 09 fe 04 13 06 11 06 2d c1 07 0a 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FB_2147765334_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FB!MTB"
        threat_id = "2147765334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$27c6c48f-9e15-4b0e-ba29-e4a8fefa81d0" ascii //weight: 20
        $x_20_2 = "$7c77a9c9-5e32-4849-a480-cce292401a5e" ascii //weight: 20
        $x_20_3 = "$43783d15-f916-4dee-8631-3075fa835b02" ascii //weight: 20
        $x_20_4 = "$4c230219-93e9-426d-8797-9b75258cb46e" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RSE_2147765353_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSE!MTB"
        threat_id = "2147765353"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 29 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 8a 00 00 00 0e 00 00 00 2a 00 00 00 61 00 00 00 62 00 00 00 e9 00 00 00 46 00 00 00 01 00 00 00 2a 00 00 00 04 00 00 00 08 00 00 00 0b 00 00 00 0c 00 00 00 01 00 00 00 01 00 00 00 07 00 00 00 06 00 00 00 03 00 00 00 02}  //weight: 1, accuracy: High
        $x_1_2 = "cec4a6c4-770a-46f2-b4c8-fbf342998a7e" ascii //weight: 1
        $x_1_3 = "CompilerProject" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSF_2147765543_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSF!MTB"
        threat_id = "2147765543"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 57 a2 09 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 73 00 00 00 0d 00 00 00 20 00 00 00 45 00 00 00 3f 00 00 00 02 00 00 00 b7 00 00 00 21 00 00 00 01 00 00 00 0e 00 00 00 03 00 00 00 0a 00 00 00 0e 00 00 00 09 00 00 00 01 00 00 00 05 00 00 00 04 00 00 00 01 00 00 00 03}  //weight: 1, accuracy: High
        $x_1_2 = "6de5d9ec-6984-4d53-b074-14190a66b00f" ascii //weight: 1
        $x_1_3 = "Baking_Management" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ML_2147765580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ML!MTB"
        threat_id = "2147765580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 14 17 8d ?? ?? 00 01 25 16 19 8d ?? ?? 00 01 25 16 7e ?? ?? 00 04 a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 a2 6f ?? ?? 00 0a 26 1f 17 8c ?? ?? 00 01 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ML_2147765580_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ML!MTB"
        threat_id = "2147765580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 16 73 23 00 00 0a 73 24 00 00 0a 0c 00 08 25 00 28 ?? ?? ?? 06 73 21 00 00 0a 0a 00 73 22 00 00 0a 0b [0-19] 07 6f 25 00 00 0a 00 07 6f 26 00 00 0a 0d de ?? 08 2c 07 08 6f ?? ?? ?? 0a 00 dc 07 2c 07 07 6f ?? ?? ?? 0a 00 dc 06 2c 07 06 6f ?? ?? ?? 0a 00 dc 09 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Decompress" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "GZipStream" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSG_2147765761_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSG!MTB"
        threat_id = "2147765761"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 09 09 07 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a4 00 00 00 28 00 00 00 07 01 00 00 0f 01 00 00 2a 01 00 00 3a 01 00 00 eb 00 00 00 34 00 00 00 0b 00 00 00 2f 00 00 00 58 00 00 00 15 00 00 00 01 00 00 00 06 00 00 00 0b 00 00 00 02 00 00 00 03}  //weight: 1, accuracy: High
        $x_1_2 = "73c3e0d9-abf3-46fa-b349-3cfb98e4226f" ascii //weight: 1
        $x_1_3 = "PSQS.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ND_2147765964_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ND!MTB"
        threat_id = "2147765964"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {5d 59 d2 9c 06 17 58 0a 06 20}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MU_2147766365_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MU!MTB"
        threat_id = "2147766365"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "noitalsnarT" ascii //weight: 3
        $x_3_2 = "OFNI_NOISREV_SV" ascii //weight: 3
        $x_3_3 = "VS_VERSION_INFO" ascii //weight: 3
        $x_3_4 = "System.CodeDom.Compiler" ascii //weight: 3
        $x_3_5 = "Reverse" ascii //weight: 3
        $x_3_6 = "97.0.1.8082" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FE_2147766860_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FE!MTB"
        threat_id = "2147766860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "hilal.Properties.Resources" ascii //weight: 10
        $x_1_2 = "Convert" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Concat" ascii //weight: 1
        $x_1_6 = "GetTy" ascii //weight: 1
        $x_1_7 = "EntryP" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FE_2147766860_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FE!MTB"
        threat_id = "2147766860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Reload.My.Resources" ascii //weight: 1
        $x_1_2 = "Reload.Reload.resources" ascii //weight: 1
        $x_1_3 = "11111-22222-20001-00001" ascii //weight: 1
        $x_1_4 = "file:///" ascii //weight: 1
        $x_1_5 = "ToBase64String" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "Form1" ascii //weight: 1
        $x_1_8 = "ImageBmp" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FF_2147766866_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FF!MTB"
        threat_id = "2147766866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 50 8e 69 6a 5d b7 03 50 ?? 03 50 8e 69 6a 5d b7 91 ?? ?? ?? 8e 69 6a 5d b7 91 61 03 50 ?? 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 00 01 00 00 d6 20 00 01 00 00 5d b4}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FF_2147766866_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FF!MTB"
        threat_id = "2147766866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$185103e7-c02f-4603-8644-9618ef3e3bda" ascii //weight: 20
        $x_20_2 = "$1a69028e-4c9a-442e-8836-dd73ccc1912c" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "Owl.Core.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "ASManager2017.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Imaginer.malheureux" wide //weight: 1
        $x_1_2 = "CanSeek" wide //weight: 1
        $x_1_3 = "RC2CryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0d 16 13 04 2b 31 09 08 17 8d 03 00 00 01 25 16 11 04 8c 88 00 00 01 a2 14 28}  //weight: 2, accuracy: High
        $x_1_2 = "Poker1" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {73 16 00 00 06 0a 06 03 7d 0c 00 00 04 00 02 06 fe 06 17 00 00 06 73 15 00 00 0a 28}  //weight: 2, accuracy: High
        $x_1_2 = "Stupid" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2b 1e 07 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 13 05 08 11 05 6f ?? ?? ?? 0a 09 18 58 0d 09 07}  //weight: 2, accuracy: Low
        $x_1_2 = "CC01" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 09 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 13 06 08 17 8d ?? 00 00 01 25 16 11 06 9c 6f}  //weight: 2, accuracy: Low
        $x_1_2 = "quanlycuahang" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 2b 4b 07 06 8e 69 5d 13 05 07 11 04 6f ?? ?? ?? 0a 5d 13 08 06 11 05 91 13 09 11 04 11 08 6f ?? ?? ?? 0a 13 0a 02 06 07 28 ?? ?? ?? 06 13 0b 02 11 09 11 0a 11 0b 28 ?? ?? ?? 06 13 0c 06 11 05 02 11 0c 28 ?? ?? ?? 06 9c 07 17 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1a 9a 20 e6 06 00 00 95 e0 95 7e 0e 00 00 04 1a 9a 20 ab 0b 00 00 95 61 7e 0e 00 00 04 1a 9a 20 e2 0c 00 00 95}  //weight: 2, accuracy: High
        $x_2_2 = {1a 9a 20 94 10 00 00 95 e0 95 7e 0e 00 00 04 1a 9a 20 05 10 00 00 95 61 7e 0e 00 00 04 1a 9a 20 f9 07 00 00 95 2e 03 17 2b 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Lime_Dropper_1" ascii //weight: 1
        $x_1_2 = "MNJKolK87.pdb" ascii //weight: 1
        $x_1_3 = "DownloadPayload" ascii //weight: 1
        $x_1_4 = "f6fa886d-5689-4243-8898-627a79b45661" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AT_2147766894_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AT!MTB"
        threat_id = "2147766894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 3b 00 00 06 17 2d 1c 26 28 30 00 00 0a 06 6f 31 00 00 0a 28 32 00 00 0a 28 43 00 00 06 18 2d 06 26 de 09 0a 2b e2 0b 2b f8 26 de d2}  //weight: 1, accuracy: High
        $x_1_2 = {16 1a 2d 0c 26 02 8e 69 17 59 1a 2d 06 26 2b 24 0a 2b f2 0b 2b f8 02 06 91 16 2c 15 26 02 06 02 07 91 9c 02 07 08 9c 06 17 58 0a 07 17 59 0b 2b 03 0c 2b e9 06 07 32 de}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AV_2147767091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AV!MTB"
        threat_id = "2147767091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 07 72 ff 01 00 70 72 6d 01 00 70 72 23 00 00 70 28 5a 00 00 0a 6f ?? ?? ?? ?? 0c 08 14 02 28 41 00 00 06 6f ?? ?? ?? ?? 26 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "get_iii" ascii //weight: 1
        $x_1_3 = "B u t a" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PK_2147767103_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PK!MTB"
        threat_id = "2147767103"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {ff b6 ff 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 d4 00 00 00 28 00 00 00 04 01 00 00 57 02 00 00 da 00 00 00 07 00 00 00 78 01 00 00 67}  //weight: 1, accuracy: High
        $x_1_2 = "1de5e903b61b" ascii //weight: 1
        $x_1_3 = "LCD.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PK_2147767103_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PK!MTB"
        threat_id = "2147767103"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 16 02 8e b7 17 da 13 06 13 05 2b 28 07 11 05 02 11 05 91 06 61 09 08 91 61 b4 9c 08 03 6f ?? ?? ?? 0a 17 da 33 04 16 0c 2b 04 08 17 d6 0c 11 05 17 d6 13 05 11 05 11 06 31 d2}  //weight: 10, accuracy: Low
        $x_1_2 = "RC2Decrypt" ascii //weight: 1
        $x_1_3 = "XOR_DEC" ascii //weight: 1
        $x_1_4 = "RijnDecrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RSH_2147767104_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSH!MTB"
        threat_id = "2147767104"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {04 06 72 cb 11 00 70 6f 2f 00 00 0a 74 2c 00 00 01 72 d3 11 00 70 72 d7 11 00 70 6f 30 00 00 0a 17 8d 33 00 00 01 25 16 1f 2d 9d 6f 31 00 00 0a 0b 07 8e 69 8d 34 00 00 01 0c 16 13 06 2b 18}  //weight: 1, accuracy: High
        $x_1_2 = {18 00 08 11 06 07 11 06 9a 1f 10 28 32 00 00 0a d2 9c 00 11 06 17 58 13 06 11 06 07 8e 69 fe 04 13 07 11 07 2d db}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSH_2147767104_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSH!MTB"
        threat_id = "2147767104"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 17 a2 1f 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a1 00 00 00 22 00 00 00 71 00 00 00 aa 00 00 00 9f 00 00 00 05 00 00 00 42 01 00 00 69 00 00 00 30 00 00 00 08 00 00 00 14 00 00 00 1b 00 00 00 07 00 00 00 02 00 00 00 2b 00 00 00 08 00 00 00 01 00 00 00 09 00 00 00 03 00 00 00 10 00 00 00 07 00 00 00 14}  //weight: 1, accuracy: High
        $x_1_2 = "2fb3cd1c-0c8a-43ea-be59-7a9789eee65c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSI_2147767202_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSI!MTB"
        threat_id = "2147767202"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 5f a2 09 09 09 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 6d 00 00 00 14 00 00 00 38 00 00 00 86 00 00 00 67 00 00 00 04 00 00 00 c0 00 00 00 07 00 00 00 3b 00 00 00 01 00 00 00 1b 00 00 00 07 00 00 00 14 00 00 00 23 00 00 00 09 00 00 00 01 00 00 00 06 00 00 00 02 00 00 00 02}  //weight: 1, accuracy: High
        $x_1_2 = "a3d52a03-97e6-4db1-ab1b-b8996b61968e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MV_2147767442_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MV!MTB"
        threat_id = "2147767442"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 15 a2 01 09 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00 36 00 00 00 06}  //weight: 3, accuracy: High
        $x_3_2 = "SecurityProtocolType" ascii //weight: 3
        $x_3_3 = "ServicePointManager" ascii //weight: 3
        $x_3_4 = "set_SecurityProtocol" ascii //weight: 3
        $x_3_5 = "54.65.13.91" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MV_2147767442_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MV!MTB"
        threat_id = "2147767442"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 1f 25 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c 08 07 7e ?? ?? ?? 04 28 ?? ?? ?? 06 6f ?? ?? ?? 0a de 0a 08 2c 06 08 6f ?? ?? ?? 0a dc de 03 26 de 00 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "XXG5xM9WdKX92P80XAK4z78J" wide //weight: 1
        $x_1_3 = "abX8ZehBvQo8c8uZwry" wide //weight: 1
        $x_1_4 = "checkrun2programsnot" wide //weight: 1
        $x_1_5 = "Decrypt" ascii //weight: 1
        $x_1_6 = "Sleep" ascii //weight: 1
        $x_1_7 = "GetBytes" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "MemoryStream" ascii //weight: 1
        $x_1_10 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AW_2147767456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AW!MTB"
        threat_id = "2147767456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 55 01 00 00 95 e0 95 7e 0d 00 00 04 20 47 0e 00 00 95 61 7e 0d 00 00 04 20 f8 07 00 00 95 2e 03 17 2b 03 16 06 0a}  //weight: 2, accuracy: High
        $x_2_2 = {20 76 04 00 00 95 e0 95 7e 0d 00 00 04 20 83 01 00 00 95 61 7e 0d 00 00 04 20 2f 0d 00 00 95 2e 03 17 2b 01 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AW_2147767456_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AW!MTB"
        threat_id = "2147767456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "Application Data\\server.txt" ascii //weight: 3
        $x_3_2 = "GetFolderPath" ascii //weight: 3
        $x_3_3 = "FromBase64String" ascii //weight: 3
        $x_3_4 = "DownloadFile" ascii //weight: 3
        $x_3_5 = {57 15 a2 01 09 01 00 00 00 fa 01 33 00 16}  //weight: 3, accuracy: High
        $x_3_6 = "discordapp.com/attachments" wide //weight: 3
        $x_3_7 = "TVqQA" wide //weight: 3
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule Trojan_MSIL_AgentTesla_RSJ_2147767897_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSJ!MTB"
        threat_id = "2147767897"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 1f b6 09 09 0b 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 ea 00 00 00 19 00 00 00 86 00 00 00 81 03 00 00 f5 00 00 00 02 00 00 00 b7 01 00 00 0d 00 00 00 60 02 00 00 56 00 00 00 02 00 00 00 08 00 00 00 0f 00 00 00 60 00 00 00 9e 00 00 00 0f 00 00 00 01 00 00 00 0a 00 00 00 04 00 00 00 0d 00 00 00 06}  //weight: 1, accuracy: High
        $x_1_2 = "tranquvis.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FM_2147769052_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FM!MTB"
        threat_id = "2147769052"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AltiumManager.Resources.resources" ascii //weight: 1
        $x_1_2 = "AltiumManager.Platinium.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetDomain" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Convert" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FM_2147769052_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FM!MTB"
        threat_id = "2147769052"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$1f11da0c-3a06-462b-a2a4-50a2a6d41366" ascii //weight: 20
        $x_20_2 = "$6b798129-cae1-4b68-be37-602fccdb9eb3" ascii //weight: 20
        $x_20_3 = "$59a7986f-7aba-4217-b5c5-7bc5b11b9f3c" ascii //weight: 20
        $x_20_4 = "$6a7b54ff-066b-407b-ba63-08243227c69a" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "QuanLyDiemSV.Resources.resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "GraphicsUtility.Form1.resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "ClumsyProof.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "MeteorUiLib.My.Resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MB_2147769166_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MB!MTB"
        threat_id = "2147769166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {01 57 15 a2 09 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 31 00 00 00 06 00 00 00 06 00 00 00 0f}  //weight: 5, accuracy: High
        $x_5_2 = {13 05 00 11 04 13 08 16 13 09 2b 15 11 08 11 09 9a 13 0a 11 0a 6f 27 00 00 0a 00 11 09 17 58 13 09 11 09 11 08 8e 69 32 e3}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MB_2147769166_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MB!MTB"
        threat_id = "2147769166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 28 ?? ?? 00 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = "MainWindow.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MB_2147769166_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MB!MTB"
        threat_id = "2147769166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "Email Checker Pro" ascii //weight: 3
        $x_3_2 = "ULEse" ascii //weight: 3
        $x_3_3 = "discordapp.com/attachments" ascii //weight: 3
        $x_3_4 = "3tg_xsg" ascii //weight: 3
        $x_3_5 = "qfa/ti_0ti_" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MB_2147769166_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MB!MTB"
        threat_id = "2147769166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0d 2b 22 06 09 08 09 08 8e 69 5d 91 07 09 91 61 d2 6f ?? ?? ?? 0a 2b 03 0c 2b e4 09 17 58 0d 2b 04 2c 0f 2b c9 09 07 8e 69 32 02 2b 05 2b d4 0b 2b b9}  //weight: 1, accuracy: Low
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "get_ProcessorCount" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MB_2147769166_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MB!MTB"
        threat_id = "2147769166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 1e 5a 6f ?? ?? ?? 0a 00 07 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 00 07 02 7b ?? ?? ?? 04 8e 69 1e 5a 6f ?? ?? ?? 0a 00 07 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 0c 00 03 73 ?? ?? ?? 0a 0d 00 09 08 16 73 59 01 00 0a 13 04 00 03 8e 69 8d ?? 00 00 01 13 05 11 04 11 05 16 03 8e 69 6f ?? ?? ?? 0a 13 06 11 05 11 06 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0a 00 de}  //weight: 1, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "MemoryStream" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "get_MouseOverBackground" ascii //weight: 1
        $x_1_9 = "SetStateMachine" ascii //weight: 1
        $x_1_10 = "get_Key" ascii //weight: 1
        $x_1_11 = "Debug" ascii //weight: 1
        $x_1_12 = "get_CapsLock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FK_2147769434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FK!MTB"
        threat_id = "2147769434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0a 72 01 00 00 70 12 00 28 ?? ?? ?? 0a 2c 10 06 16 31 0c 06 20 e8 03 00 00 5a 28 ?? ?? ?? 0a de 03}  //weight: 10, accuracy: Low
        $x_10_2 = {70 12 01 28 ?? ?? ?? 0a 2c 10 07 16 31 0c 07 20 e8 03 00 00 5a 28 ?? ?? ?? 0a de 03 06 00 16 0b 72}  //weight: 10, accuracy: Low
        $x_5_3 = {26 de 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 74 01 00 00 1b 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 14 16 8d 01 00 00 01 6f ?? ?? ?? 0a 26 de 03 26 de 00 2a}  //weight: 5, accuracy: Low
        $x_1_4 = "watchdog" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Loader" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_5_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FK_2147769434_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FK!MTB"
        threat_id = "2147769434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$2b20407e-b7c3-4f9e-8cbf-3d9b0d6b5bf2" ascii //weight: 20
        $x_20_2 = "$e5407721-112c-4231-b396-ffa4c30aeb10" ascii //weight: 20
        $x_20_3 = "$b28cec68-f775-4178-ba33-265a9692cf03" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FN_2147769435_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FN!MTB"
        threat_id = "2147769435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "LamdaX.My.Resources" ascii //weight: 1
        $x_1_2 = "LamdaX.Hyatt.resources" ascii //weight: 1
        $x_1_3 = "Tesla" ascii //weight: 1
        $x_1_4 = "GetDomain" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Convert" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FN_2147769435_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FN!MTB"
        threat_id = "2147769435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "36"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "IExpando.Plug" ascii //weight: 10
        $x_10_2 = {78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00 61 7a 78}  //weight: 10, accuracy: High
        $x_10_3 = {00 69 6d 69 6d 69 6d 69 6d 69 6d 00}  //weight: 10, accuracy: High
        $x_1_4 = "ObsoleteAttribute" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "StrReverse" ascii //weight: 1
        $x_1_10 = {4c 00 6f 00 61 00 64 00 00 0f 47 00 65 00 74 00 54 00 79 00 70 00 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 6 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FN_2147769435_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FN!MTB"
        threat_id = "2147769435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$7b84d3d8-0b92-49a5-b285-3855aeabe9b4" ascii //weight: 20
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "Foldz.My.Resources" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "Activator" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FO_2147769436_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FO!MTB"
        threat_id = "2147769436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {02 08 02 08 91 06 08 06 8e 69 5d 91 61 d2 9c 16 0d 2b 18 02 08 02 08 91 06 09 91 07 1f 1f 5f 62 09 61 08 58 61 d2 9c 09 17 58 0d 09 06 8e 69 32 e2 08 17 58 0c 08 02 8e 69 32 c5}  //weight: 10, accuracy: High
        $x_1_2 = "Decompress" ascii //weight: 1
        $x_1_3 = "Decrypt" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FO_2147769436_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FO!MTB"
        threat_id = "2147769436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {70 12 01 28 ?? ?? ?? 0a 2c 10 07 16 31 0c 07 20 e8 03 00 00 5a 28 ?? ?? ?? 0a de 03 06 00 16 0b 72}  //weight: 5, accuracy: Low
        $x_5_2 = {26 de 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 74 01 00 00 1b 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 14 16 8d 01 00 00 01 6f ?? ?? ?? 0a 26 de 03 26 de 00 2a}  //weight: 5, accuracy: Low
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Convert" ascii //weight: 1
        $x_1_6 = "Concat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FP_2147769560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FP!MTB"
        threat_id = "2147769560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$b6ed7f10-ac88-428c-ae28-139f1594e687" ascii //weight: 20
        $x_20_2 = "$44C19D58-7E0A-4599-ABE2-40916A539BB3" ascii //weight: 20
        $x_20_3 = "$0981cf86-0191-4e55-8dcc-57827cd752e8" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "MonopolySim.My.Resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "CheckingAccount.My.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "QLGR_GUI.My.Resources" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
        $x_1_12 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
        $x_1_14 = "DebuggableAttribute" ascii //weight: 1
        $x_1_15 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FQ_2147769579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FQ!MTB"
        threat_id = "2147769579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$e4137a8b-cd52-43f7-9ffb-3837a86a9243" ascii //weight: 20
        $x_1_2 = "Windowssettings.Settings.resources" ascii //weight: 1
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FQ_2147769579_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FQ!MTB"
        threat_id = "2147769579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$ba1d96a8-c5bc-46ba-ad6e-c8986c4b3267" ascii //weight: 20
        $x_20_2 = "$b3d61e66-23b3-44e3-8b13-0674634c6944" ascii //weight: 20
        $x_20_3 = "$fc5ee9e7-31a1-4092-af48-69df9fe6688e" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FR_2147769847_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FR!MTB"
        threat_id = "2147769847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0a 72 01 00 00 70 12 00 28 ?? ?? ?? 0a 2c 10 06 16 31 0c 06 20 e8 03 00 00 5a 28 ?? ?? ?? 0a de 03}  //weight: 5, accuracy: Low
        $x_5_2 = {26 de 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 74 01 00 00 1b 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 14 16 8d 01 00 00 01 6f ?? ?? ?? 0a 26 de 03 26 de 00 2a}  //weight: 5, accuracy: Low
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Loader" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FR_2147769847_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FR!MTB"
        threat_id = "2147769847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$88a7a406-e873-486c-b20f-4382c2baa2a2" ascii //weight: 20
        $x_20_2 = "$6d91cf8c-d571-4f88-a5ac-c5bd5501df03" ascii //weight: 20
        $x_20_3 = "$692a8c7b-8166-487a-847f-05aa59545470" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FS_2147769850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FS!MTB"
        threat_id = "2147769850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {19 0a 02 13 05 16 13 04 11 05 6f ?? ?? ?? 0a 13 06 2b 2a 11 05 11 04 6f ?? ?? ?? 0a 0d 08 09 28 ?? ?? ?? 0a 06 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c 11 04 17 d6 13 04 00 11 04 11 06 fe 04 13 07 11 07 2d ca}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FS_2147769850_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FS!MTB"
        threat_id = "2147769850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$f01a6d54-e376-4ec2-a075-424d844336fd" ascii //weight: 20
        $x_20_2 = "$559ed2ee-efb6-47a5-8ec9-7179cdd51ed8" ascii //weight: 20
        $x_20_3 = "$5c880e45-7007-494b-9389-d1ad989cfc12" ascii //weight: 20
        $x_20_4 = "$EBBD35FE-D05A-444C-A764-796334568FBF" ascii //weight: 20
        $x_20_5 = "$fabcba6f-79e5-4edf-9503-53746793f5e7" ascii //weight: 20
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "BasicClassValidation.My.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "MinesweeperAdvance.My.Resources" ascii //weight: 1
        $x_1_10 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_11 = "FootballTeams.My.Resources" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_13 = "MDIWindowManager.My.Resources" ascii //weight: 1
        $x_1_14 = "CreateInstance" ascii //weight: 1
        $x_1_15 = "Patch.My.Resources" ascii //weight: 1
        $x_1_16 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_17 = "Activator" ascii //weight: 1
        $x_1_18 = "DebuggableAttribute" ascii //weight: 1
        $x_1_19 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FV_2147769987_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FV!MTB"
        threat_id = "2147769987"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$a21b131c-d9b4-4b99-ae1c-a24330a54791" ascii //weight: 20
        $x_20_2 = "$7d8dde5f-7853-4f26-87ed-f6ae98695b12" ascii //weight: 20
        $x_20_3 = "$4f80ea7b-cf52-4883-9831-a5208580bc36" ascii //weight: 20
        $x_20_4 = "$5c31ffee-3de8-4c0e-b80b-ee643e7c3d3c" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FV_2147769987_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FV!MTB"
        threat_id = "2147769987"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$9989a000-3c0c-409d-8448-c4db3f061a95" ascii //weight: 20
        $x_20_2 = "$7f0c4324-bb5a-46e5-82d2-fc025a3978d9" ascii //weight: 20
        $x_20_3 = "$04674227-4dfd-42c6-98fc-d467b2185ded" ascii //weight: 20
        $x_20_4 = "$67016abc-26e3-44bb-8fe3-69a058e6926f" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "test404.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "LibraryManagementSystem.My.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "FormEditor.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "SoccerStatsForAllProject.My.Resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FW_2147769999_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FW!MTB"
        threat_id = "2147769999"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "Low"
    strings:
        $x_20_1 = {43 6f 6e 73 6f 6c 65 41 70 70 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_20_2 = {74 61 72 20 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_20_3 = {50 61 79 6d 65 6e 74 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_20_4 = {52 65 71 75 69 72 65 6d 65 6e 74 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_1_5 = "c:\\sri\\Message.txt" ascii //weight: 1
        $x_1_6 = "get_CurrentDomain" ascii //weight: 1
        $x_1_7 = {24 24 6d 65 74 68 6f 64 30 78 36 30 30 30 33 [0-15] 2d 31}  //weight: 1, accuracy: Low
        $x_1_8 = "BeginInvoke" ascii //weight: 1
        $x_1_9 = "ResolveMethod" ascii //weight: 1
        $x_1_10 = "get_Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FW_2147769999_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FW!MTB"
        threat_id = "2147769999"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$2f84182c-db91-4187-a381-821cb5112a09" ascii //weight: 20
        $x_20_2 = "$328300c1-55e9-4a0a-8e55-72306630152e" ascii //weight: 20
        $x_20_3 = "$e896d11b-3d8d-4445-8223-f176e9ea8464" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FX_2147770181_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FX!MTB"
        threat_id = "2147770181"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "PTM.MainForm.resources" ascii //weight: 1
        $x_1_2 = "PTM.OPIC.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "Logger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FX_2147770181_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FX!MTB"
        threat_id = "2147770181"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$5116b8c4-7da1-4646-83da-a6f3ba2c743B" ascii //weight: 20
        $x_20_2 = "$ef0f6e11-2917-45a2-ae11-5e333cb795bf" ascii //weight: 20
        $x_20_3 = "$d3866791-873f-4dc4-a695-9a3b7ed15bb1" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "JoooO.STUB.OoooJ.My.Resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "UI.My.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "Timeseries.My.Resources" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "GoWEditor.My.Resources" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
        $x_1_15 = "DebuggableAttribute" ascii //weight: 1
        $x_1_16 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RSK_2147770471_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RSK!MTB"
        threat_id = "2147770471"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 09 09 01 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 5f 00 00 00 0f 00 00 00 96 00 00 00 41 00 00 00 43 00 00 00 94 00 00 00 16 00 00 00 0f 00 00 00 02 00 00 00 04 00 00 00 05 00 00 00 0a 00 00 00 01 00 00 00 05 00 00 00 0b}  //weight: 1, accuracy: High
        $x_1_2 = "PersonnelTracking.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FY_2147770478_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FY!MTB"
        threat_id = "2147770478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$b0257227-0e55-493b-b318-6244d83211c6" ascii //weight: 20
        $x_20_2 = "$0a26ba0a-ee8a-4da5-9c3c-377c1b797aa9" ascii //weight: 20
        $x_20_3 = "$b52f9ba5-8b3c-452f-a7da-e603ce4f700a" ascii //weight: 20
        $x_20_4 = "$831ef2f5-5a11-439c-8f46-f9542ab0c28f" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FY_2147770478_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FY!MTB"
        threat_id = "2147770478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$3009D38A-5752-4EA2-8A62-764360932C71" ascii //weight: 20
        $x_20_2 = "$b4fc07c8-3511-47ee-95df-833e67c3c01a" ascii //weight: 20
        $x_20_3 = "$bc77ccbd-f3ad-4f19-8b60-af897afaa9c5" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "LibInUse.My.Resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "Software.My.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "FileCopier.Properties.Resources" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
        $x_1_12 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
        $x_1_14 = "DebuggableAttribute" ascii //weight: 1
        $x_1_15 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FZ_2147770479_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FZ!MTB"
        threat_id = "2147770479"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$072c06db-aab9-4f01-97cd-4cc221ba3870" ascii //weight: 20
        $x_20_2 = "$dd02f4ef-2bdd-42d9-aa3f-b843c2296e03" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FZ_2147770479_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FZ!MTB"
        threat_id = "2147770479"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$8779ca64-efdb-4aeb-afb0-9adce72398a1" ascii //weight: 20
        $x_20_2 = "$70ef9051-e9f3-496d-ad9d-307fa9b6caa4" ascii //weight: 20
        $x_20_3 = "$8c21d5e2-bbee-4098-8244-1788c124e2f6" ascii //weight: 20
        $x_20_4 = "$719ef1db-968e-4b5a-847b-b7a6929fa73d" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GA_2147770480_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GA!MTB"
        threat_id = "2147770480"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 07 11 04 9a 72 ?? ?? ?? 70 15 16 28 ?? ?? ?? 0a 16 9a 14 02 fe 06 c6 00 00 06 73 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 11 04 9a 72 ?? ?? ?? 70 15 16 28 ?? ?? ?? 0a 17 9a 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04 11 04 09 31 ae}  //weight: 10, accuracy: Low
        $x_1_2 = "CriticalAttribute" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GB_2147770481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GB!MTB"
        threat_id = "2147770481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "://wymascensores.com/" wide //weight: 1
        $x_1_2 = "Yottabit" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GB_2147770481_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GB!MTB"
        threat_id = "2147770481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CriticalAttribute.Resources.resources" ascii //weight: 1
        $x_1_2 = "get_MousePosition" ascii //weight: 1
        $x_1_3 = "remove_DoubleClick" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GZipStream" ascii //weight: 1
        $x_1_7 = "GetFolderPath" ascii //weight: 1
        $x_1_8 = "MkDir" ascii //weight: 1
        $x_1_9 = "NimitzDEV" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GC_2147770482_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GC!MTB"
        threat_id = "2147770482"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MultiToken.Resources" ascii //weight: 1
        $x_1_2 = "AZXCCCCCCCCCCCCCCCCCCC" ascii //weight: 1
        $x_1_3 = "AmIYourParent" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
        $x_1_6 = "GZipStream" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GD_2147770483_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GD!MTB"
        threat_id = "2147770483"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$32645a38-2335-406a-8f2b-a8b2f60c6693" ascii //weight: 20
        $x_20_2 = "$a96392fd-9287-4631-a0e5-aa2f63cf63bb" ascii //weight: 20
        $x_20_3 = "$831ef2f5-5a11-439c-8f46-f9542ab0c28f" ascii //weight: 20
        $x_20_4 = "$a590456f-4a0d-4efe-8c6c-63bc2064ac66" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 2 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GE_2147770484_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GE!MTB"
        threat_id = "2147770484"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateToolhelp32Snapshot" ascii //weight: 1
        $x_1_2 = "BlockCopy" ascii //weight: 1
        $x_3_3 = "FuckingShit" ascii //weight: 3
        $x_3_4 = "FuckingShit" wide //weight: 3
        $x_4_5 = "pTccFnnCmlrCjDw6" wide //weight: 4
        $x_3_6 = "Fastkroak.exe" wide //weight: 3
        $x_3_7 = "Fastkroak" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_3_*) and 2 of ($x_1_*))) or
            ((3 of ($x_3_*))) or
            ((1 of ($x_4_*) and 1 of ($x_3_*) and 1 of ($x_1_*))) or
            ((1 of ($x_4_*) and 2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GE_2147770484_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GE!MTB"
        threat_id = "2147770484"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$9d48327a-903f-4b47-8dd6-b8928c90614e" ascii //weight: 20
        $x_20_2 = "$51e02905-9b8e-4ea0-ab0f-be751018d5bf" ascii //weight: 20
        $x_20_3 = "$98c4f282-e30e-42af-8a63-538736f33df6" ascii //weight: 20
        $x_20_4 = "$4c78e9d7-8fac-4735-9c9b-b813abfbc059" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GI_2147771289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GI!MTB"
        threat_id = "2147771289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "RFEQRB26X3PDEDFWVBNNz7Z5LqvJaYhBqzMPIQb93YplgNHPM4189lIZcVRUKIkvpDx6XyTyImBe2JWqGmPJYOGZruKd4cPHwDCng3w" ascii //weight: 2
        $x_2_2 = "ytj59d27m747ndlu4lvj2zex5nufaljv" ascii //weight: 2
        $x_2_3 = "47juruc42l6q8vtle8qaflzeue4snpe8" ascii //weight: 2
        $x_2_4 = "q9gcjs5cdzu8afy5yun73g7sbu286um" ascii //weight: 2
        $x_1_5 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_6 = "GetFolderPath" ascii //weight: 1
        $x_1_7 = "Get_UserDomainName" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 3 of ($x_1_*))) or
            ((2 of ($x_2_*) and 1 of ($x_1_*))) or
            ((3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GF_2147771292_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GF!MTB"
        threat_id = "2147771292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 08 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 04 11 04 16 fe 02 13 05 11 05 2c 0c 09 08 16 11 04 6f ?? ?? ?? 0a 00 00 00 00 11 04 16 fe 02 13 06 11 06 2d cc}  //weight: 10, accuracy: Low
        $x_5_2 = "AZXCCCCCCCCCCCCCCCCCCC" ascii //weight: 5
        $x_5_3 = "BookstoreManagement.GUI.My.Resources" ascii //weight: 5
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_5_*) and 4 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GJ_2147771340_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GJ!MTB"
        threat_id = "2147771340"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {a2 25 17 7e ?? ?? ?? 0a a2 25 18 11 06 a2 25 19 17 8c ?? ?? ?? 01 a2 13 0a 11 09 11 07}  //weight: 10, accuracy: Low
        $x_1_2 = "//transfer.sh" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GJ_2147771340_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GJ!MTB"
        threat_id = "2147771340"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$ce027d2f-5644-4078-bdd5-2526d68ea6c4" ascii //weight: 20
        $x_20_2 = "$a590456f-4a0d-4efe-8c6c-63bc2064ac66" ascii //weight: 20
        $x_20_3 = "$b4f2edf6-f015-4900-87e5-ee23a0215d71" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_SZ_2147771869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SZ!MTB"
        threat_id = "2147771869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 17 58 13 07 06 20 c0 e1 00 00 5d 0d 07 09 91 13 08 06 1f 16 5d 13 09 07 09 11 08 1f 16 8d 05 00 00 01 25 d0 15 00 00 04 28 ?? ?? ?? 0a 11 09 91 61 07 11 07 20 c0 e1 00 00 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 06 17 58 0a 06 20 c0 e1 00 00 fe 04 13 0a 11 0a 2d a3}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VPL_2147772033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VPL!MTB"
        threat_id = "2147772033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$59af0211-f366-4e6e-ad91-330336c4980c" ascii //weight: 1
        $x_1_2 = "ha4=y={K'a*J'b3K'>&F_(+_})6%Ivppp\"<ppppqcffzf|ppppE{xx*rdz#~'&$pppppD)}d3_2e8v3s@'$!g?8$D|;G%p=C~5}vAI>" ascii //weight: 1
        $x_1_3 = "5bIshZ28Cfv!<E%{svhBcub{" ascii //weight: 1
        $x_1_4 = "AddUserToolStripMenuItem_Click" ascii //weight: 1
        $x_1_5 = "DeleteUserToolStripMenuItem_Click" ascii //weight: 1
        $x_1_6 = "AMS.My" ascii //weight: 1
        $x_1_7 = "ContainsKey" ascii //weight: 1
        $x_1_8 = "System.Security.Cryptography" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "AMS.Add_Course_Teacher_Student.resources" ascii //weight: 1
        $x_1_12 = "AMS.AddUserFrm.resources" ascii //weight: 1
        $x_1_13 = "AMS.AnsiCharMarshaler.resources" ascii //weight: 1
        $x_1_14 = "AMS.Course_Registration.resources" ascii //weight: 1
        $x_1_15 = "AMS.GPA_Academic_History_Look_Up.resources" ascii //weight: 1
        $x_1_16 = "AMS.LogIn.resources" ascii //weight: 1
        $x_1_17 = "AMS.Main_Menu.resources" ascii //weight: 1
        $x_1_18 = "AMS.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VIA_2147772080_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VIA!MTB"
        threat_id = "2147772080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$50bd48aa-5e67-412b-b37d-5f130cb10716" ascii //weight: 1
        $x_1_2 = "PaCman.AboutBox1.resources" ascii //weight: 1
        $x_1_3 = "PaCman.Controller_MainForm.resources" ascii //weight: 1
        $x_1_4 = "PaCman.Properties.Resources.resources" ascii //weight: 1
        $x_1_5 = "PaCman.View.resources" ascii //weight: 1
        $x_1_6 = "sdf;,klmvgdklsjfdoisaklufhnaskidujfhbasdjkhf_2" wide //weight: 1
        $x_1_7 = "get_MNBVCXCZBGYH" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VIA_2147772080_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VIA!MTB"
        threat_id = "2147772080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$b805d273-55a3-4ded-ac43-8a9e902b043e" ascii //weight: 1
        $x_1_2 = "MNBVCXCZBGYH" ascii //weight: 1
        $x_1_3 = "Factor.Factor.resources" ascii //weight: 1
        $x_1_4 = "ArrangePicture.Form1.resources" ascii //weight: 1
        $x_1_5 = "ITokenReader.frmITokenReader.resources" ascii //weight: 1
        $x_1_6 = "ITokenReader.frmDestino.resources" ascii //weight: 1
        $x_1_7 = "ITokenReader.frmPessoa.resources" ascii //weight: 1
        $x_1_8 = "ITokenReader.frmPrincipal.resources" ascii //weight: 1
        $x_1_9 = "ITokenReader.frmSobre.resources" ascii //weight: 1
        $x_1_10 = "ITokenReader.frmTramitando.resources" ascii //weight: 1
        $x_1_11 = "VehicleManager.ListView.resources" ascii //weight: 1
        $x_1_12 = "VehicleManager.MainForm.resources" ascii //weight: 1
        $x_1_13 = "ITokenReader.Properties.Resources.resources" ascii //weight: 1
        $x_1_14 = "ITokenReader.Resources.resources" ascii //weight: 1
        $x_1_15 = "VehicleManager.TypeControl.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KA_2147772101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KA!MTB"
        threat_id = "2147772101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 08 03 8e 69 5d 17 58 17 59 7e ?? ?? ?? ?? 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? ?? 03 08 19 58 18 59 03 8e 69 5d 91 59 20}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKL_2147772142_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKL!MTB"
        threat_id = "2147772142"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {04 08 03 08 91 05 09 95 61 d2 9c 00 08 17 58 0c 08 03 8e 69 fe 04 13 06 11 06 2d 80}  //weight: 1, accuracy: High
        $x_1_2 = "NBCV547857P0T5T4B75C4J" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VAL_2147772219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VAL!MTB"
        threat_id = "2147772219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$31e6340c-0529-4c33-88bc-8e79fda31733" ascii //weight: 1
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "szHSnbcBiCQzrhHzExKvktAqdIdL" ascii //weight: 1
        $x_1_5 = "ToBase64String" ascii //weight: 1
        $x_1_6 = "ContainsKey" ascii //weight: 1
        $x_1_7 = "GetTempPath" ascii //weight: 1
        $x_1_8 = "https://" wide //weight: 1
        $x_1_9 = "w3wp.exe" wide //weight: 1
        $x_1_10 = "aspnet_wp.exe" wide //weight: 1
        $x_1_11 = "DnEaz.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VH_2147772229_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VH!MSR"
        threat_id = "2147772229"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 41 00 00 0a 00 02 02 fe 06 fd 02 00 06 73 42 00 00 0a 28 43 00 00 0a 00 02 02 28 0f 00 00 06 28 ee 02 00 06 73 6f 00 00 06 7d c2 01 00 04 02 73 31 00 00 0a 28 37 00 00 0a 7d cb 01 00 04 02 73 31 00 00 0a 28 37 00 00 0a 7d cc 01 00 04 02 73 46 00 00 0a 7d cd 01 00 04 02 28 ed 02 00 06}  //weight: 1, accuracy: High
        $x_1_2 = {28 a0 00 00 0a 03 6f a1 00 00 0a 0b 07 6f a2 00 00 0a 1c 9a 0c 08 6f a3 00 00 0a 0d 09 16 9a 6f a4 00 00 0a 13 04 11 04 14 17 8d 19 00 00 01 25 16 19 8d 76 00 00 01 25 16 7e 36 00 00 04 a2 25 17 7e 37 00 00 04 a2 25 18 72 0f 0f 00 70 a2 a2 6f a5 00 00 0a 26 1f 17 8c 85 00 00 01 0a 2b 00 06 2a}  //weight: 1, accuracy: High
        $x_2_3 = {6f 12 01 00 0a 13 04 12 04 28 13 01 00 0a 17 da 0d 16 0c 2b 7a 03 6f 12 01 00 0a 13 04 12 04 28 14 01 00 0a 17 da 13 06 16 13 05 2b 58 03 08 11 05 6f 15 01 00 0a 13 07 16 16 16 16 28 16 01 00 0a 13 08 11 07 11 08 28 17 01 00 0a 13 09 11 09 2c 2c 07 19 8d 99 00 00 01 25 16 12 07 28 18 01 00 0a 9c 25 17 12 07 28 19 01 00 0a 9c 25 18 12 07 28 1a 01 00 0a 9c 6f 1b 01 00 0a 00 00 00 11 05 17 d6 13 05 11 05 11 06 31 a2 08 17 d6 0c 08 09 31 82 07 6f 1c 01 00 0a 0a 2b 00 06 2a}  //weight: 2, accuracy: High
        $x_1_4 = "SYSTEM_BNHS.vb.Block64.resources" ascii //weight: 1
        $x_1_5 = "BNHSCommand" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_1_*))) or
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AMP_2147772472_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMP!MTB"
        threat_id = "2147772472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WrapNonExceptionThrows" ascii //weight: 1
        $x_1_2 = "MedImmune" ascii //weight: 1
        $x_1_3 = "MedImmune Distribution" ascii //weight: 1
        $x_1_4 = "AstraZeneca" ascii //weight: 1
        $x_1_5 = "AstraZeneca plc" ascii //weight: 1
        $x_1_6 = "$ba5fb082-7f35-4854-97af-705afc318212" ascii //weight: 1
        $x_1_7 = "op_Equality" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMP_2147772472_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMP!MTB"
        threat_id = "2147772472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CS.Resources" wide //weight: 1
        $x_1_2 = "FromBase64String" wide //weight: 1
        $x_1_3 = "\\db.accdb;" wide //weight: 1
        $x_1_4 = "xuxixx" wide //weight: 1
        $x_1_5 = "http://tempuri.org/dbDataSetChurch.xsd" wide //weight: 1
        $x_1_6 = "WinForms_RecursiveFormCreate" wide //weight: 1
        $x_1_7 = "WinForms_SeeInnerException" wide //weight: 1
        $x_1_8 = "$512e913d-1c5a-44d1-bc7e-a7ce5cfcdd25" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMP_2147772472_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMP!MTB"
        threat_id = "2147772472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ISO2022Modes.Search.resources" ascii //weight: 1
        $x_1_2 = "ISO2022Modes.crystal.resources" ascii //weight: 1
        $x_1_3 = "ISO2022Modes.Kin.resources" ascii //weight: 1
        $x_1_4 = "ISO2022Modes.frmMain.resources" ascii //weight: 1
        $x_1_5 = "ISO2022Modes.AddInfo.resources" ascii //weight: 1
        $x_1_6 = "ISO2022Modes.UpdateInfo.resources" ascii //weight: 1
        $x_1_7 = "ISO2022Modes.Deleteinfo.resources" ascii //weight: 1
        $x_1_8 = "ISO2022Modes.Properties.Resources.resources" ascii //weight: 1
        $x_1_9 = "ISO2022Modes.product.resources" ascii //weight: 1
        $x_1_10 = "ISO2022Modes.view.resources" ascii //weight: 1
        $x_1_11 = "cryrptbtn" wide //weight: 1
        $x_1_12 = "frmMain" wide //weight: 1
        $x_1_13 = "553UBK7BGFF488Z548ZU5F" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMP_2147772472_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMP!MTB"
        threat_id = "2147772472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DownloadWeb" ascii //weight: 1
        $x_1_2 = "Append" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "get_Current" ascii //weight: 1
        $x_1_5 = "Convert" ascii //weight: 1
        $x_1_6 = "_okqwdoqwkodqw" ascii //weight: 1
        $x_1_7 = "op_Equality" ascii //weight: 1
        $x_1_8 = "RANDOM_STRING" wide //weight: 1
        $x_1_9 = "[SPLITTER]" wide //weight: 1
        $x_1_10 = "LINKS_HERE" wide //weight: 1
        $x_1_11 = "xxxDxxxoxxxwxxxnxxxlxxoxxaxdxSxtxrxixxnxxgx" wide //weight: 1
        $x_1_12 = "xGxxxexxtxxTxyxpxex" wide //weight: 1
        $x_1_13 = "xxxAxxsxxsxxexmxxbxxlxxyx" wide //weight: 1
        $x_1_14 = "xxxLxxoxxxxxaxxdxxx" wide //weight: 1
        $x_1_15 = "xxxExxnxxtrxxxyxxxPxxxoxxixxxnxxtxxxx" wide //weight: 1
        $x_1_16 = "xxxIxxnxxvxoxkxexx" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (15 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMP_2147772472_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMP!MTB"
        threat_id = "2147772472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "rkQuAtdP2v2DC8XaJSe" ascii //weight: 1
        $x_1_2 = "lhcV8xdREPyCL3VmioD" ascii //weight: 1
        $x_1_3 = "l9Hu4idAPYUmBCZtNlK" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "EditorBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "passwordHashing" ascii //weight: 1
        $x_1_9 = "ToBase64String" ascii //weight: 1
        $x_1_10 = "SchoolManagementSystem.Properties" ascii //weight: 1
        $x_1_11 = "http://tempuri.org/SchoolManagementSystemDataSet.xsd" wide //weight: 1
        $x_1_12 = "http://tempuri.org/SchoolManagementSystemDataSet1.xsd" wide //weight: 1
        $x_1_13 = "http://tempuri.org/SchoolManagementSystemDataSet2.xsd" wide //weight: 1
        $x_1_14 = "$cbe94887-4abd-4cac-8e7c-513d483309a2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMP_2147772472_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMP!MTB"
        threat_id = "2147772472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "{11111-22222-50001-00000}" wide //weight: 1
        $x_1_2 = "GetDelegateForFunctionPointer" wide //weight: 1
        $x_1_3 = "file:///" wide //weight: 1
        $x_1_4 = "Find" wide //weight: 1
        $x_1_5 = "ResourceA" wide //weight: 1
        $x_1_6 = "Virtual" wide //weight: 1
        $x_1_7 = "Alloc" wide //weight: 1
        $x_1_8 = "Write" wide //weight: 1
        $x_1_9 = "Process" wide //weight: 1
        $x_1_10 = "Memory" wide //weight: 1
        $x_1_11 = "Protect" wide //weight: 1
        $x_1_12 = "Open" wide //weight: 1
        $x_1_13 = "Close" wide //weight: 1
        $x_1_14 = "Handle" wide //weight: 1
        $x_1_15 = "System.Security.Cryptography.AesCryptoServiceProvider" wide //weight: 1
        $x_1_16 = "UHXH1RmoBkPRUsydPS.nnnUPyhBjndrxXA5yn" wide //weight: 1
        $x_1_17 = "{11111-22222-10009-11112}" wide //weight: 1
        $x_1_18 = "fnS2mlNhNBySi9ebib.rXVXoMZNWJfZUW43Ca" wide //weight: 1
        $x_1_19 = "000004b0" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SBR_2147772790_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SBR!MSR"
        threat_id = "2147772790"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "{11111-22222-50001-00000}" wide //weight: 1
        $x_1_2 = "{11111-22222-10009-11112}" wide //weight: 1
        $x_1_3 = "{11111-22222-20001-00001}" wide //weight: 1
        $x_1_4 = "{11111-22222-20001-00002}" wide //weight: 1
        $x_1_5 = "32.dll" wide //weight: 1
        $x_1_6 = "file:///" wide //weight: 1
        $x_1_7 = "{11111-22222-30001-00001}" wide //weight: 1
        $x_1_8 = "{11111-22222-30001-00002}" wide //weight: 1
        $x_1_9 = "{11111-22222-40001-00001}" wide //weight: 1
        $x_1_10 = "{11111-22222-40001-00002}" wide //weight: 1
        $x_1_11 = "{11111-22222-50001-00001}" wide //weight: 1
        $x_1_12 = "{11111-22222-50001-00002}" wide //weight: 1
        $x_1_13 = "GetDelegateForFunctionPointer" wide //weight: 1
        $x_1_14 = "GetHashCode" ascii //weight: 1
        $x_1_15 = "SoapName.dll" ascii //weight: 1
        $x_1_16 = "SoapName.My.Resources" ascii //weight: 1
        $x_1_17 = "get_Unicod" ascii //weight: 1
        $x_1_18 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_19 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVP_2147772816_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVP!MTB"
        threat_id = "2147772816"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CrazyTetris.Form1.resources" ascii //weight: 1
        $x_1_2 = "CrazyTetris.frmLevel2.resources" ascii //weight: 1
        $x_1_3 = "CrazyTetris.frmLevel3.resources" ascii //weight: 1
        $x_1_4 = "CrazyTetris.frmLevel4.resources" ascii //weight: 1
        $x_1_5 = "CrazyTetris.frmLevel5CHIMNEY.resources" ascii //weight: 1
        $x_1_6 = "CrazyTetris.frmLevelSelect.resources" ascii //weight: 1
        $x_1_7 = "CrazyTetris.frmMainMenu.resources" ascii //weight: 1
        $x_1_8 = "CrazyTetris.frmSettings.resources" ascii //weight: 1
        $x_1_9 = "CrazyTetris.GameForm.resources" ascii //weight: 1
        $x_1_10 = "CrazyTetris.HighScoreForm.resources" ascii //weight: 1
        $x_1_11 = "CrazyTetris.MainMenu.resources" ascii //weight: 1
        $x_1_12 = "CrazyTetris.Resources.resources" ascii //weight: 1
        $x_1_13 = "CrazyTetris.SplashScreen.resources" ascii //weight: 1
        $x_1_14 = "$552EB7F2-7F2C-41D9-AAD1-6408A8F4C29B" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FT_2147772859_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FT!MTB"
        threat_id = "2147772859"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {02 50 08 02 50 8e 69 6a 5d b7 02 50 08 02 50 8e 69 6a 5d b7 91 03 08 03 8e 69 6a 5d b7 91 61 02 50 08 17 6a d6 02 50 8e 69 6a 5d b7 91 da 20 00 01 00 00 d6 20 00 01 00 00 5d b4 9c 08 17 6a d6 0c 08 07 31 bb}  //weight: 10, accuracy: High
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FT_2147772859_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FT!MTB"
        threat_id = "2147772859"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$079F9E61-154F-40BA-ADAA-535745FC5DC0" ascii //weight: 20
        $x_20_2 = "$957bb7d2-1585-41a0-80a2-ee3cbbe63415" ascii //weight: 20
        $x_20_3 = "$653119ee-f094-449c-96c0-9c5d8082dc75" ascii //weight: 20
        $x_20_4 = "$95f4621c-b341-4cff-bc4d-4e206106f037" ascii //weight: 20
        $x_20_5 = "$f4173fae-d9b8-4ac2-b1ca-4366e7ac9408" ascii //weight: 20
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FU_2147772860_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FU!MTB"
        threat_id = "2147772860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 50 06 03 06 02 50 8e 69 59 03 8e 69 58 91 9c 06 17 58 0a 06 02 50 8e 69 32 e5}  //weight: 5, accuracy: High
        $x_5_2 = {13 04 12 01 07 8e 69 11 04 8e 69 58 28 ?? ?? ?? 06 12 01 11 04 28 ?? ?? ?? 06 08 17 58 0c 08}  //weight: 5, accuracy: Low
        $x_1_3 = "get_EntryPoint" ascii //weight: 1
        $x_1_4 = "get_PixelFormat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FU_2147772860_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FU!MTB"
        threat_id = "2147772860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$13ccbb88-03ae-418d-b75c-31dcbe06c754" ascii //weight: 20
        $x_20_2 = "$af484777-98af-4350-8a85-5f1435dc9472" ascii //weight: 20
        $x_20_3 = "$795465c1-caaa-485a-8157-13e9fc5b1c66" ascii //weight: 20
        $x_20_4 = "$e3f7bab3-25d5-4d7c-b7b2-0dd1f6bb65f3" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_PC_2147773041_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PC!MTB"
        threat_id = "2147773041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {11 07 11 04 95 11 07 11 05 95 58 d2 13 16 11 07 11 16 20 ff 00 00 00 5f 95 d2 13 17 11 15 11 17 61 13 18 11 08 11 12}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PC_2147773041_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PC!MTB"
        threat_id = "2147773041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Software\\VBSamples\\Collapse\\HighScores" wide //weight: 1
        $x_1_2 = "\\resources\\Images\\tut.png" ascii //weight: 1
        $x_1_3 = "TankGame.StartUp.resources" ascii //weight: 1
        $x_1_4 = "TankGame.Resources.resources" ascii //weight: 1
        $x_1_5 = "TankGame.MultipleBlocks.resources" ascii //weight: 1
        $x_1_6 = "TankGame.QuickStart.resources" ascii //weight: 1
        $x_1_7 = "FromBase64String" wide //weight: 1
        $x_1_8 = "WinForms_RecursiveFormCreate" wide //weight: 1
        $x_1_9 = "WinForms_SeeInnerException" wide //weight: 1
        $x_1_10 = "$B587AAD2-1EA4-416F-9904-BD8D4AF3A072" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DB_2147773114_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DB!MTB"
        threat_id = "2147773114"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 15 a2 09 09 01 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 58 00 00 00 06 00 00 00 5b 00 00 00 e0}  //weight: 3, accuracy: High
        $x_3_2 = "InternalDecoderBestFitFallb" ascii //weight: 3
        $x_3_3 = "set_ShortcutKeys" ascii //weight: 3
        $x_3_4 = "IEnumSTORECATEGORYINSTA.exe" ascii //weight: 3
        $x_3_5 = "set_HelpLink" ascii //weight: 3
        $x_3_6 = "get_IsCompleted" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DB_2147773114_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DB!MTB"
        threat_id = "2147773114"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$74cdbe07-a95b-481a-9d85-5546ed6154d8" ascii //weight: 1
        $x_1_2 = "RecordBgySystem.My.Resources" ascii //weight: 1
        $x_1_3 = "RecordBgySystem.Res_delete.resources" ascii //weight: 1
        $x_1_4 = "Barangay Resolutions" ascii //weight: 1
        $x_1_5 = "Purok is Empty" ascii //weight: 1
        $x_1_6 = "Church of Christ" ascii //weight: 1
        $x_1_7 = "Bible Baptist Church" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {25 47 11 0b 11 0f 11 0b 8e 69 5d 91 61 d2 52 00 ?? ?? 17 58 13 0f 11 0f 11 0a 8e 69}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 7c 3b 02 70 17 8d ?? ?? ?? 01 25 16 11 01 a2 25 13 02}  //weight: 5, accuracy: Low
        $x_1_2 = "QQQWWW" wide //weight: 1
        $x_1_3 = "blnAoyX" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 07 6f 2c 00 00 0a 0c 20 ?? ?? ?? ff 28 ?? ?? ?? 0a fe ?? ?? 00 38 ?? ?? ?? 00}  //weight: 5, accuracy: Low
        $x_1_2 = "public.class.Main.HelloWorld.module13" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 07 25 1a 58 13 07 4b 11 07 25 1a 58 13 07 4b 5a 13 11 11 11 20 ?? ?? ?? dc 33 2d 08 07 2d 07}  //weight: 5, accuracy: Low
        $x_1_2 = "MKMNnN988.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {8f 0b 00 00 01 25 71 ?? 00 00 01 fe ?? ?? 00 fe ?? ?? 00 20 ?? 00 00 00 5d 91 61 d2 81 ?? 00 00 01 20 ?? 00 00 00 fe ?? ?? 00 00 fe ?? ?? 00 20 ?? 00 00 00 fe 01 39 ?? 00 00 00}  //weight: 5, accuracy: Low
        $x_1_2 = "FlameAssemblies" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 40 00 00 0a 0a 28 ?? 00 00 06 0b 07 1f 20 8d ?? 00 00 01 25 d0 ?? 00 00 04 28 ?? 00 00 0a 6f ?? 00 00 0a 07 1f 10 8d ?? 00 00 01 25 d0 ?? 00 00 04 28 ?? 00 00 0a 6f ?? 00 00 0a 06 07 6f ?? 00 00 0a 17 73 ?? 00 00 0a 0c 08 02 16 02 8e 69 6f ?? 00 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "Chuang.Printer.ClientUninstall" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NA_2147773163_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NA!MTB"
        threat_id = "2147773163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "Delo2Mail.My.Resources" ascii //weight: 5
        $x_5_2 = "Delo2Mail.Baidu" ascii //weight: 5
        $x_5_3 = "get_SMTPPassword" ascii //weight: 5
        $x_1_4 = "DownloadFile" ascii //weight: 1
        $x_1_5 = "AttachmentFile" ascii //weight: 1
        $x_1_6 = "ShellExecute" ascii //weight: 1
        $x_1_7 = "RSEditParameters_Load" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "ICredentialsByHost" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_5_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MY_2147773167_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MY!MTB"
        threat_id = "2147773167"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0d 16 13 04 2b [0-7] 11 04 08 8e 69 5d 91 06 11 04 91 61 d2 [0-18] 17 58 13 04 11 04 06 8e 69 32 ?? 09 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MY_2147773167_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MY!MTB"
        threat_id = "2147773167"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VirtualProtect" ascii //weight: 1
        $x_1_2 = "kernel32.dll" ascii //weight: 1
        $x_1_3 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_4 = "ResourceManager" ascii //weight: 1
        $x_1_5 = "invoice" ascii //weight: 1
        $x_1_6 = "password" ascii //weight: 1
        $x_1_7 = "HotelMgmtSystem.Booking.resources" ascii //weight: 1
        $x_1_8 = "HotelMgmtSystem.loginForm.resources" ascii //weight: 1
        $x_1_9 = "HotelMgmtSystem.Properties.Resources.resources" ascii //weight: 1
        $x_1_10 = "MemoryStream" ascii //weight: 1
        $x_1_11 = "ReadByte" ascii //weight: 1
        $x_1_12 = "get_Length" ascii //weight: 1
        $x_1_13 = "Buffer" ascii //weight: 1
        $x_1_14 = "BlockCopy" ascii //weight: 1
        $x_1_15 = "Encoding" ascii //weight: 1
        $x_1_16 = "get_Assembly" ascii //weight: 1
        $x_1_17 = "System.Drawing.Bitmap" ascii //weight: 1
        $x_1_18 = "GetTypes" ascii //weight: 1
        $x_1_19 = "GetMethods" ascii //weight: 1
        $x_1_20 = "MethodBase" ascii //weight: 1
        $x_1_21 = "Invoke" ascii //weight: 1
        $x_1_22 = "ComponentResourceManager" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (20 of ($x*))
}

rule Trojan_MSIL_AgentTesla_PE_2147773296_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PE!MTB"
        threat_id = "2147773296"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WinForms_RecursiveFormCreate" wide //weight: 1
        $x_1_2 = "WinForms_SeeInnerException" wide //weight: 1
        $x_1_3 = "$ee138a73-c604-41e4-9dff-b7a0142f64ef" ascii //weight: 1
        $x_1_4 = "FionnCharacterSheet.Welcome.resources" ascii //weight: 1
        $x_1_5 = "FionnCharacterSheet.LCDEmulatorFrm.resources" ascii //weight: 1
        $x_1_6 = "FionnCharacterSheet.Resources.resources" ascii //weight: 1
        $x_1_7 = "FionnCharacterSheet.SkillsFocuses.resources" ascii //weight: 1
        $x_1_8 = "FionnCharacterSheet.MultipleBlocks.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MN_2147773377_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MN!MTB"
        threat_id = "2147773377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 14 13 04 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 05 11 05 14 fe 03 13 06 11 06 2c 5f 00 11 05 6f ?? ?? ?? 0a 13 04 11 04 14 fe 03 13 07 11 07 2c 49 00 11 04 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 20 00 04 00 00 8d ?? 00 00 01 13 08 00 08 11 08 16 11 08 8e 69 6f ?? ?? ?? 0a 13 09 09 11 08 16 11 09 6f ?? ?? ?? 0a 00 07 11 09 58 0b 00 11 09 16 fe 02 13 0a 11 0a 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "Exception" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MN_2147773377_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MN!MTB"
        threat_id = "2147773377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://DATABASE AQUI/ddos.txt" ascii //weight: 1
        $x_1_2 = "http://DATABASE AQUI/geoip.txt" ascii //weight: 1
        $x_1_3 = "http://DATABASE AQUI/sniffer.txt" ascii //weight: 1
        $x_1_4 = "http://DATABASE AQUI/database.txt" ascii //weight: 1
        $x_1_5 = "http://DATABASE AQUI/chat.txt" ascii //weight: 1
        $x_1_6 = "http://DATABASE AQUI/project.txt" ascii //weight: 1
        $x_1_7 = "fuckinhoksgy" ascii //weight: 1
        $x_1_8 = "wireshark" ascii //weight: 1
        $x_1_9 = "Skype Sniffer" ascii //weight: 1
        $x_1_10 = "snifferstatus" ascii //weight: 1
        $x_1_11 = "geoipstatus" ascii //weight: 1
        $x_1_12 = "ddosstatus" ascii //weight: 1
        $x_1_13 = "chatstatus" ascii //weight: 1
        $x_1_14 = "databasestatus" ascii //weight: 1
        $x_1_15 = "projectstatus" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (10 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NB_2147773378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NB!MTB"
        threat_id = "2147773378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {5d 59 d2 9c 11 04 17 58 13 04 11 04 20}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NB_2147773378_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NB!MTB"
        threat_id = "2147773378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {20 42 11 f3 ff 5a 09 61 2b af 28 ?? ?? ?? 06 20 ?? ?? ?? 15 2b 00 28 ?? ?? ?? 2b 12 00 28 ?? ?? ?? 0a 20 ?? ?? ?? c4 2b 00 28 ?? ?? ?? 2b 28 ?? ?? ?? 0a 25 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "DownloadString" ascii //weight: 1
        $x_1_3 = "HTTPService.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NB_2147773378_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NB!MTB"
        threat_id = "2147773378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {64 fe 0c 23 00 1f 19 62 60 fe ?? ?? 00 20 ?? ?? ?? 00 fe ?? ?? 00 20 ?? ?? ?? 00 5f 5a}  //weight: 5, accuracy: Low
        $x_1_2 = "FolderCreator.Resources" wide //weight: 1
        $x_1_3 = "WinForms_RecursiveFormCreate" wide //weight: 1
        $x_1_4 = "WinForms_SeeInnerException" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NB_2147773378_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NB!MTB"
        threat_id = "2147773378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cmd /c taskkill /f /t /im files\\s-irecovery.exe" ascii //weight: 1
        $x_1_2 = "TOOL_ADVRAND" ascii //weight: 1
        $x_1_3 = "Exploiting with limera1n" ascii //weight: 1
        $x_1_4 = "http://ih8sn0w.com" ascii //weight: 1
        $x_1_5 = "\\files\\llb.3gs.dfu" ascii //weight: 1
        $x_1_6 = "iBooty.Resources.resources" ascii //weight: 1
        $x_1_7 = "Adobe ImageReadyq" ascii //weight: 1
        $x_1_8 = "tEXtSoftware" ascii //weight: 1
        $x_1_9 = "_thismsgtxt" ascii //weight: 1
        $x_1_10 = "STARTF_USESHOWWINDOW" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MM_2147773393_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MM!MTB"
        threat_id = "2147773393"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 0a 28 ?? ?? 00 06 16 28 ?? ?? 00 06 28 ?? ?? 00 0a 06 28 ?? ?? 00 06 00 2a 07 00 25 16 7e ?? ?? 00 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MM_2147773393_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MM!MTB"
        threat_id = "2147773393"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MemoryStream" ascii //weight: 1
        $x_1_2 = "ToArray" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "GetDomain" ascii //weight: 1
        $x_1_6 = "TUFHktI1xF28DqruSsh" wide //weight: 1
        $x_1_7 = "xTCIIygbvL" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MP_2147773597_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MP!MTB"
        threat_id = "2147773597"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1c 9a 0c 08 19 8d ?? ?? 00 01 25 16 7e ?? ?? 00 04 a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 28 ?? ?? 00 0a 26 1f 17 8c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MP_2147773597_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MP!MTB"
        threat_id = "2147773597"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HVNkpkZ34KmeciVVJfi" ascii //weight: 1
        $x_1_2 = "cdaW9OvMU9" ascii //weight: 1
        $x_1_3 = "ORqFeQMAMTv8mRxvwSr" ascii //weight: 1
        $x_1_4 = "ugldq5MWW1Rn1xsDbXq" ascii //weight: 1
        $x_1_5 = "ykVlHHMbUgDisxT7SxS" ascii //weight: 1
        $x_1_6 = "kLjw4iIsCLsZtxc4lksN0j" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DownloadFile" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "MemoryStream" ascii //weight: 1
        $x_1_11 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZD_2147773600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZD!MTB"
        threat_id = "2147773600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ms2mz.KeyWriter.resources" ascii //weight: 1
        $x_1_2 = "ApplicationActivator" ascii //weight: 1
        $x_1_3 = "get_UseCompatibleTextRendering" ascii //weight: 1
        $x_1_4 = "MzValuesPrecision64bit" ascii //weight: 1
        $x_1_5 = "chkUseInputFormat_CheckedChanged" ascii //weight: 1
        $x_1_6 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_7 = "Encrypt Key" wide //weight: 1
        $x_1_8 = "Ms2mz config files|*.2mz|All files|*.*" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NC_2147773601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NC!MTB"
        threat_id = "2147773601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 03 17 58 ?? ?? ?? ?? ?? 5d 91 0a 16 0b 02 03 28}  //weight: 1, accuracy: Low
        $x_1_2 = {02 03 1f 16 28 ?? ?? ?? 06 0a 06 0b 2b 00 07 2a}  //weight: 1, accuracy: Low
        $x_1_3 = {20 16 f8 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NC_2147773601_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NC!MTB"
        threat_id = "2147773601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "32"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "broke_mobile.My.Resources" ascii //weight: 5
        $x_5_2 = "get_VerzeichnisDerAdminKonsole" ascii //weight: 5
        $x_5_3 = "$3f72fd67-0db0-4aa6-8ec4-a6551825cde9" ascii //weight: 5
        $x_5_4 = "get_Keypad_1" ascii //weight: 5
        $x_5_5 = "$VB$NonLocal_2" ascii //weight: 5
        $x_5_6 = "set_UpdateCommand" ascii //weight: 5
        $x_1_7 = "LoginScreen_Load" ascii //weight: 1
        $x_1_8 = "Update users set password = 'Hello123'" ascii //weight: 1
        $x_1_9 = "Consolas" ascii //weight: 1
        $x_1_10 = "Debuggerle_Closing" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((6 of ($x_5_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NE_2147773602_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NE!MTB"
        threat_id = "2147773602"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {d2 9c 06 17 58 0a 06 08 11 06 17 58}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NE_2147773602_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NE!MTB"
        threat_id = "2147773602"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 06 17 da 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 09 11 06 09 6f ?? ?? ?? ?? 5d 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? da 13 07 11 04 11 07 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 13 04 11 06 17 d6 13 06 11 06 11 05 31 b9}  //weight: 1, accuracy: Low
        $x_1_2 = {69 00 33 06 6e 00 76 00 33 06 6f 00 6b 00 33 06 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NE_2147773602_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NE!MTB"
        threat_id = "2147773602"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HotelMgmtSystem.loginForm.resources" ascii //weight: 1
        $x_1_2 = "btnInvoice_Click" ascii //weight: 1
        $x_1_3 = "transactionForm_Load" ascii //weight: 1
        $x_1_4 = "receipt_Load" ascii //weight: 1
        $x_1_5 = "btnLogin_Click" ascii //weight: 1
        $x_1_6 = "btnPay_Click" ascii //weight: 1
        $x_1_7 = "Baywatch Villas" ascii //weight: 1
        $x_1_8 = "Monotype Corsiva" ascii //weight: 1
        $x_1_9 = "get_password" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PF_2147773659_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PF!MTB"
        threat_id = "2147773659"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "d255eddf-bc00-4e51-bea8-f2f33258b449" ascii //weight: 1
        $x_1_2 = "CreateUrlCacheEntryW" ascii //weight: 1
        $x_1_3 = "CommitUrlCacheEntryW" ascii //weight: 1
        $x_1_4 = "get_ExecutablePath" ascii //weight: 1
        $x_1_5 = "get_net_http_content_buffersize_exceeded" ascii //weight: 1
        $x_1_6 = "get_net_http_client_send_completed" ascii //weight: 1
        $x_1_7 = "get_net_http_operation_started" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SST_2147773709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SST!MTB"
        threat_id = "2147773709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Lerlibro_INC.Baidu" wide //weight: 1
        $x_1_2 = "UrlIdentityPermission" wide //weight: 1
        $x_1_3 = "Lerlibro_INC.Resources" wide //weight: 1
        $x_1_4 = "Lerlibro_INC.Se1.resources" ascii //weight: 1
        $x_1_5 = "Lerlibro_INC.fnt1.resources" ascii //weight: 1
        $x_1_6 = "Lerlibro_INC.frmHRPanel.resources" ascii //weight: 1
        $x_1_7 = "Lerlibro_INC.frmMISPanel.resources" ascii //weight: 1
        $x_1_8 = "Lerlibro_INC.frmAccountingPanel.resources" ascii //weight: 1
        $x_1_9 = "Lerlibro_INC.frmSalesPanel.resources" ascii //weight: 1
        $x_1_10 = "Lerlibro_INC.frmMain.resources" ascii //weight: 1
        $x_1_11 = "Lerlibro_INC.Resources.resources" ascii //weight: 1
        $x_1_12 = "Lerlibro_INC.ucUsers.resources" ascii //weight: 1
        $x_1_13 = "Lerlibro_INC.Baidu.resources" ascii //weight: 1
        $x_1_14 = "Create__Instance__" ascii //weight: 1
        $x_1_15 = "Dispose__Instance__" ascii //weight: 1
        $x_1_16 = "CreateInstance" ascii //weight: 1
        $x_1_17 = "defaultInstance" ascii //weight: 1
        $x_1_18 = "set_ShowInTaskbar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MYP_2147773798_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MYP!MTB"
        threat_id = "2147773798"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5.172.39.25/browser.php" ascii //weight: 1
        $x_1_2 = "https://ostoja.tk/browser.php" ascii //weight: 1
        $x_1_3 = "TOJA_Browser.Properties.Resources" ascii //weight: 1
        $x_1_4 = "InvokeMethod.InvokeMethod" ascii //weight: 1
        $x_1_5 = "MyClass" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_8 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_9 = "sender" ascii //weight: 1
        $x_1_10 = "get_ResourceManager" ascii //weight: 1
        $x_1_11 = "ComponentResourceManager" ascii //weight: 1
        $x_1_12 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_13 = "HashAlgorithm" ascii //weight: 1
        $x_1_14 = "ICryptoTransform" ascii //weight: 1
        $x_1_15 = "CipherMode" ascii //weight: 1
        $x_1_16 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_17 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (15 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MLK_2147773799_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MLK!MTB"
        threat_id = "2147773799"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 07 a2 25 17 19 8d ?? ?? 00 01 25 16 7e ?? ?? 00 04 a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 a2 6f ?? ?? 00 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = "CMS.Resources.resources" ascii //weight: 1
        $x_1_3 = "CMS.Hett.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MSX_2147773926_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MSX!MTB"
        threat_id = "2147773926"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 01 00 00 14 14 ?? 8d ?? ?? 00 01 25 16 ?? a2 25 ?? ?? 8d ?? ?? 00 01 25 16 7e ?? ?? 00 04 a2 25 17 7e ?? ?? 00 04 a2 25 18 72 ?? ?? 00 70 a2 ?? 6f ?? ?? 00 0a 26}  //weight: 10, accuracy: Low
        $x_1_2 = "LibraryManagementSystem.Resources.resources" ascii //weight: 1
        $x_1_3 = "Studioborne.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MSM_2147773927_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MSM!MTB"
        threat_id = "2147773927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Variant" ascii //weight: 1
        $x_1_2 = "get_Scalar" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "XsdType" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "Scalar" ascii //weight: 1
        $x_1_8 = "get_Assembly" ascii //weight: 1
        $x_1_9 = "Concat" ascii //weight: 1
        $x_1_10 = "GetObject" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "Encoding" ascii //weight: 1
        $x_1_13 = "get_ResourceManager" ascii //weight: 1
        $x_1_14 = "ComponentResourceManager" ascii //weight: 1
        $x_1_15 = "Tokenizer" ascii //weight: 1
        $x_1_16 = "Bitmap" ascii //weight: 1
        $x_1_17 = "AppDomain" ascii //weight: 1
        $x_1_18 = "ToString" ascii //weight: 1
        $x_10_19 = "553UBK7BGFF488Z548ZU5F" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MQ_2147773945_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MQ!MTB"
        threat_id = "2147773945"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "83"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "kLjw4iIsCLsZtxc4lksN0j" ascii //weight: 20
        $x_10_2 = "DebuggableAttribute" ascii //weight: 10
        $x_10_3 = "DownloadFile" ascii //weight: 10
        $x_10_4 = "CreateInstance" ascii //weight: 10
        $x_10_5 = "MemoryStream" ascii //weight: 10
        $x_10_6 = "Reverse" ascii //weight: 10
        $x_10_7 = "Replace" ascii //weight: 10
        $x_1_8 = "uo1ournWA7Zx4kDUpd3" ascii //weight: 1
        $x_1_9 = "U7MJJGpgHEQcWMDg4N" ascii //weight: 1
        $x_1_10 = "kLTMoFuCk" ascii //weight: 1
        $x_1_11 = "gDnKxIlxeIxM6iSqsya" ascii //weight: 1
        $x_1_12 = "VQ2DtIgomZgNEt5OFh" ascii //weight: 1
        $x_1_13 = "mMypNwtYYwwnwnHmIH8" ascii //weight: 1
        $x_1_14 = "i67SIkk2lOGb0TXaomH" ascii //weight: 1
        $x_1_15 = "NMLhlIk4J3rCbT8w9Tf" ascii //weight: 1
        $x_1_16 = "RhWlajkmgu5tj8UEIcl" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MYT_2147774205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MYT!MTB"
        threat_id = "2147774205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Create__Instance__" ascii //weight: 1
        $x_1_2 = "frmLogin" ascii //weight: 1
        $x_1_3 = "Asymmetric" ascii //weight: 1
        $x_1_4 = "EnvoyTerminatorSink" ascii //weight: 1
        $x_1_5 = "Destinationd" ascii //weight: 1
        $x_1_6 = "MetadataCollector" ascii //weight: 1
        $x_1_7 = "PoolAwaitable" ascii //weight: 1
        $x_1_8 = "ITypeComp" ascii //weight: 1
        $x_1_9 = "MinorVersion" ascii //weight: 1
        $x_1_10 = "ApplicationIdentity" ascii //weight: 1
        $x_1_11 = "AppDomain" ascii //weight: 1
        $x_1_12 = "Destinationd.Resources.resources" ascii //weight: 1
        $x_1_13 = "Destinationd.Underlying.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (12 of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147774206_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTS!MTB"
        threat_id = "2147774206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTS: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "BestFitMappingAttribute.EnumeratorSimple" ascii //weight: 2
        $x_2_2 = "Tienda.Resources" ascii //weight: 2
        $x_2_3 = "MuiResourceMapEntryFieldId" ascii //weight: 2
        $x_2_4 = "Tienda.Util" ascii //weight: 2
        $x_2_5 = "NewLateBinding" ascii //weight: 2
        $x_2_6 = "LateIndexGet" ascii //weight: 2
        $x_2_7 = "Tienda.Util.resources" ascii //weight: 2
        $x_2_8 = "BidiCategory" ascii //weight: 2
        $x_2_9 = "FeedbackSize" ascii //weight: 2
        $x_2_10 = "MinorVersion" ascii //weight: 2
        $x_2_11 = "ApplicationIdentity" ascii //weight: 2
        $x_2_12 = "Create__Instance__" ascii //weight: 2
        $x_2_13 = "Asymmetric" ascii //weight: 2
        $x_2_14 = "DebuggerNonUserCodeAttribute" ascii //weight: 2
        $x_2_15 = "Bitmap" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (14 of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147774207_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTQ!MTB"
        threat_id = "2147774207"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTQ: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {69 6a 5d d4 91 06 07 06 8e 69 6a 5d d4 91 61 28 ?? ?? 00 0a 02 07 17 6a 58 02 8e 69 6a 5d d4 91 28 ?? ?? 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5e}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147774207_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTQ!MTB"
        threat_id = "2147774207"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTQ: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "PTSoft_MailServer.Officer" ascii //weight: 2
        $x_2_2 = "Asymmetric" ascii //weight: 2
        $x_2_3 = "PTSoft_MailServer.Resources" ascii //weight: 2
        $x_2_4 = "EventOpcode" ascii //weight: 2
        $x_2_5 = "Bitmap" ascii //weight: 2
        $x_2_6 = "EmailInfo" ascii //weight: 2
        $x_2_7 = "FileSystemInfo" ascii //weight: 2
        $x_2_8 = "MinorVersion" ascii //weight: 2
        $x_2_9 = "Create__Instance__" ascii //weight: 2
        $x_2_10 = "POP3Server" ascii //weight: 2
        $x_2_11 = "BestFitMappingAttribute.EnumeratorSimple" ascii //weight: 2
        $x_2_12 = "GetPixel" ascii //weight: 2
        $x_2_13 = "security.cer" ascii //weight: 2
        $x_2_14 = "message.txt" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (13 of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147774208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTX!MTB"
        threat_id = "2147774208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTX: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "ocrvb.SDP" ascii //weight: 2
        $x_2_2 = "Asymmetric" ascii //weight: 2
        $x_2_3 = "ocrvb.Resources" ascii //weight: 2
        $x_2_4 = "BestFitMappingAttribute.EnumeratorSimple" ascii //weight: 2
        $x_2_5 = "ocrvb" ascii //weight: 2
        $x_2_6 = "dsadada" ascii //weight: 2
        $x_2_7 = "Bitmap" ascii //weight: 2
        $x_2_8 = "ContainsKey" ascii //weight: 2
        $x_2_9 = "System.Security.Cryptography" ascii //weight: 2
        $x_2_10 = "get_Assembly" ascii //weight: 2
        $x_2_11 = "set_ReadOnly" ascii //weight: 2
        $x_2_12 = "CreateDirectory" ascii //weight: 2
        $x_2_13 = "DeleteDirectory" ascii //weight: 2
        $x_2_14 = "Create__Instance__" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (13 of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147774228_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTL!MTB"
        threat_id = "2147774228"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTL: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Tokenizer" ascii //weight: 1
        $x_1_2 = "Variant" ascii //weight: 1
        $x_1_3 = "Data_1" ascii //weight: 1
        $x_1_4 = "Round" ascii //weight: 1
        $x_1_5 = "XsdType" ascii //weight: 1
        $x_1_6 = "Bitmap" ascii //weight: 1
        $x_1_7 = "GetTypes" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "AZTFGA44GG4Y8U2445GIV5" ascii //weight: 1
        $x_1_10 = "get_Sync" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NF_2147774361_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NF!MTB"
        threat_id = "2147774361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 ff b7 ff 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 c7 00 00 00 78 07 00 00 07 08 00 00 ce 68 00 00 d7}  //weight: 1, accuracy: High
        $x_1_2 = {8a 00 00 cc 03 00 00 c8 01 00 00 8c 03 00 00 9d 0d 00 00 16 73 00 00 02 00 00 00 05 00 00 00 2c 00 00 00 e5 00}  //weight: 1, accuracy: High
        $x_1_3 = "8A8D0BB485E1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NF_2147774361_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NF!MTB"
        threat_id = "2147774361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a 06 16 06 8e 69 28 ?? ?? ?? 0a 02 7b ?? ?? ?? 04 25 2d 02 26 2a 06 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "niaMllDroC_" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = ".edom SOD ni nur eb tonnac margorp sihT!" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NF_2147774361_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NF!MTB"
        threat_id = "2147774361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "Draw4BitImage" ascii //weight: 5
        $x_5_2 = "ITypeComp" ascii //weight: 5
        $x_5_3 = "get_AcrossPartitions" ascii //weight: 5
        $x_5_4 = "CartoonersFileViewerProgram.Se1" ascii //weight: 5
        $x_5_5 = "Cartoons.exe" ascii //weight: 5
        $x_1_6 = "$STATIC$ExportFilesMenu_Click$20211C1280A1$PathO" ascii //weight: 1
        $x_1_7 = "CartoonersFileViewerProgram.Resources" ascii //weight: 1
        $x_1_8 = "cstoon.smb" ascii //weight: 1
        $x_1_9 = "GBRToText" ascii //weight: 1
        $x_1_10 = "$602329F0-C5AF-4057-8C66-4E31EC2C22F8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_5_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NG_2147774362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NG!MTB"
        threat_id = "2147774362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 08 91 11 ?? 61 13 0b 07 11 ?? 07 8e 69 5d 91}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NG_2147774362_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NG!MTB"
        threat_id = "2147774362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 26 0c 1f 61 6a 08 28 ?? ?? ?? 2b 25 26 80 ?? ?? ?? 04 09 20 ?? ?? ?? 25 5a 20 ?? ?? ?? 4b 61 2b 84 06 28 ?? ?? ?? 0a 0b 09 20 ?? ?? ?? 4a 5a 20 84 ?? ?? ?? 61 38}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NG_2147774362_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NG!MTB"
        threat_id = "2147774362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 ce 21 00 70 06 28 ?? ?? ?? 0a 08 20 ?? ?? ?? 2d 5a 20 ?? ?? ?? ef 61 38 ?? ?? ?? ff 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 0a 08 20 ?? ?? ?? c5 5a 20 ?? ?? ?? 3e 61 38 ?? ?? ?? ff 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 0a 08 20 ?? ?? ?? c6 5a 20 ?? ?? ?? 27 61 38 ?? ?? ?? ff 73 ?? ?? ?? 0a 25 6f ?? ?? ?? 0a 17 6f ?? ?? ?? 0a 25 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "AstroFNLauncher" ascii //weight: 1
        $x_1_3 = "del Trinity.bat" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NG_2147774362_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NG!MTB"
        threat_id = "2147774362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ITypeComp" ascii //weight: 1
        $x_1_2 = "AthleticClubManagementSystem.SplashScreen1.resources" ascii //weight: 1
        $x_1_3 = "AthleticClubManagementSystem.Resources" ascii //weight: 1
        $x_1_4 = "PoolAwaitable" ascii //weight: 1
        $x_1_5 = "txtAmountPaid" ascii //weight: 1
        $x_1_6 = "AthleticClubDB" ascii //weight: 1
        $x_1_7 = "$248b5c59-a2f8-48d5-8672-48cda9108458" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NG_2147774362_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NG!MTB"
        threat_id = "2147774362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {2b 54 38 55 00 00 00 38 ?? ?? ?? 00 38 ?? ?? ?? 00 38 ?? ?? ?? 00 16 2c 03}  //weight: 5, accuracy: Low
        $x_1_2 = "//endirect2.fr/loader/uploads/withoutstartup_Egaeoith.jpg" wide //weight: 1
        $x_1_3 = "Lhqzamossvn" wide //weight: 1
        $x_1_4 = "Make Computer faster and more secure" wide //weight: 1
        $x_1_5 = "KDE Softwares" wide //weight: 1
        $x_1_6 = "Computer Sentinel" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MUR_2147775118_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUR!MTB"
        threat_id = "2147775118"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 01 00 00 14 14 19 8d ?? ?? ?? ?? 25 16 28 ?? ?? ?? ?? a2 25 17 28 ?? ?? ?? ?? a2 25 18 72 ?? ?? ?? ?? a2 6f ?? ?? ?? ?? 26}  //weight: 10, accuracy: Low
        $x_2_2 = "MinorVersion" ascii //weight: 2
        $x_2_3 = "Bitmap" ascii //weight: 2
        $x_2_4 = "GetResourceString" ascii //weight: 2
        $x_2_5 = "GetObjectValue" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147775173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTO!MTB"
        threat_id = "2147775173"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTO: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "BMS1.Resources" ascii //weight: 2
        $x_2_2 = "TypeInfo" ascii //weight: 2
        $x_2_3 = "BMS1.Sheet1" ascii //weight: 2
        $x_2_4 = "Asymmetric" ascii //weight: 2
        $x_2_5 = "http://www.tempuri.org/DataSet1.xsd" ascii //weight: 2
        $x_2_6 = "BestFitMappingAttribute.EnumeratorSimple" ascii //weight: 2
        $x_2_7 = "GetPixel" ascii //weight: 2
        $x_2_8 = "BidiCategory" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147775174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTI!MTB"
        threat_id = "2147775174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTI: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "30"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "SqlCommand" ascii //weight: 2
        $x_2_2 = "password" ascii //weight: 2
        $x_2_3 = "InfoCache" ascii //weight: 2
        $x_2_4 = "Invoke" ascii //weight: 2
        $x_2_5 = "GetType" ascii //weight: 2
        $x_2_6 = "GetPixel" ascii //weight: 2
        $x_2_7 = "email" ascii //weight: 2
        $x_2_8 = "SQLManager" ascii //weight: 2
        $x_2_9 = "SqlDataReader" ascii //weight: 2
        $x_2_10 = "DeleteRow" ascii //weight: 2
        $x_2_11 = "BidiCategory" ascii //weight: 2
        $x_2_12 = "MinorVersion" ascii //weight: 2
        $x_2_13 = "Asymmetric" ascii //weight: 2
        $x_2_14 = "BestFitMappingAttribute.EnumeratorSimple" ascii //weight: 2
        $x_2_15 = "RPF:SmartAssembly" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_2147775175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MTV!MTB"
        threat_id = "2147775175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTV: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "30"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "ExecuteNonQuery" ascii //weight: 2
        $x_2_2 = "BidiCategory" ascii //weight: 2
        $x_2_3 = "DbDataAdapter" ascii //weight: 2
        $x_2_4 = "SqlDataAdapter" ascii //weight: 2
        $x_2_5 = "SqlDataReader" ascii //weight: 2
        $x_2_6 = "ExecuteReader" ascii //weight: 2
        $x_2_7 = "Bitmap" ascii //weight: 2
        $x_2_8 = "SqlConnection" ascii //weight: 2
        $x_2_9 = "MinorVersion" ascii //weight: 2
        $x_2_10 = "GetPixel" ascii //weight: 2
        $x_2_11 = "GetType" ascii //weight: 2
        $x_2_12 = "Lion_Match_Employee_Management_System" ascii //weight: 2
        $x_2_13 = "Lion_Match_Employee_Management_System.HBT" ascii //weight: 2
        $x_2_14 = "SZGeneric" ascii //weight: 2
        $x_2_15 = "Lion_Match_Employee_Management_System.Resources" ascii //weight: 2
        $x_2_16 = "txtpassword" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (15 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MUY_2147775177_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUY!MTB"
        threat_id = "2147775177"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 07 9a 0c ?? 08 6f ?? ?? ?? ?? 16 fe 02 ?? ?? 2c ?? ?? 7e ?? ?? ?? ?? 08 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? ?? ?? ?? 07 17 58 0b 07 06 8e 69 32}  //weight: 10, accuracy: Low
        $x_2_2 = "Invoke" ascii //weight: 2
        $x_2_3 = "DownloadString" ascii //weight: 2
        $x_2_4 = "dowqkdoko" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NI_2147775367_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NI!MTB"
        threat_id = "2147775367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "facebook_circle_512" ascii //weight: 1
        $x_1_2 = "gmail_tracking_300x300" ascii //weight: 1
        $x_1_3 = "Stub62.Resources" ascii //weight: 1
        $x_1_4 = "About_Me" ascii //weight: 1
        $x_1_5 = "Praneethmadush@gmail.com" ascii //weight: 1
        $x_1_6 = "Ass2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NI_2147775367_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NI!MTB"
        threat_id = "2147775367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {55 a2 cb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 b1 00 00 00 13 00 00 00 0f 01 00 00 fe 03 00 00 29 01 00 00 62 01 00 00 f7 04 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = "Sales_Dashboard.Resources.resource" ascii //weight: 1
        $x_1_3 = "51b9bb59-3582-4c22-8610-dd9a5b2ce010" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJ_2147775368_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJ!MTB"
        threat_id = "2147775368"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AZTFGA44GG4Y8U2445GIV5" ascii //weight: 1
        $x_1_2 = "IterationCount" ascii //weight: 1
        $x_1_3 = "Bunifu_TextBox" ascii //weight: 1
        $x_1_4 = "get_Sync" ascii //weight: 1
        $x_1_5 = "AsynchronousProgramming" ascii //weight: 1
        $x_1_6 = "ReadFromFileAsync" ascii //weight: 1
        $x_1_7 = "GetHtmlAsync" ascii //weight: 1
        $x_1_8 = "get_Action2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NK_2147775369_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NK!MTB"
        threat_id = "2147775369"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8d 19 00 00 01 25 16 7e [0-4] a2 25 17 7e [0-4] a2 25 18 72 [0-4] a2 0a 28 [0-4] 72 [0-6] 8d 19 00 00 01 25 16 28 [0-4] 16 28 [0-4] a2 28 [0-4] 74 [0-4] 06 28}  //weight: 1, accuracy: Low
        $x_1_2 = "GetDomain" ascii //weight: 1
        $x_1_3 = "CallByName" ascii //weight: 1
        $x_3_4 = {69 6a 5d 28 [0-4] 28 [0-7] 8e 69 6a 5d 28 [0-4] 28 [0-8] 8e 69 6a 5d 28 [0-4] 28 [0-4] 91 61 28 [0-7] 6a 58 02 8e 69 6a 5d 28 [0-4] 28 [0-4] 91 28 [0-4] 59 20 [0-4] 58 20 [0-4] 5e d2 9c 00 07 17 6a 58 0b 07 02 8e 69 17 59 6a 03 17 58 6e 5a fe ?? 16 fe ?? 0c 08 2d}  //weight: 3, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_1_*))) or
            ((1 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MUJ_2147775641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUJ!MTB"
        threat_id = "2147775641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 28 ?? ?? ?? ?? 10 00}  //weight: 10, accuracy: Low
        $x_10_2 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 28 ?? ?? ?? ?? fe 0b 00 00}  //weight: 10, accuracy: Low
        $x_10_3 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f [0-40] 61 b4 28 ?? ?? ?? ?? fe 0b 00 00}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MUO_2147775642_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUO!MTB"
        threat_id = "2147775642"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {8e 69 6a 5d 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 91 06 07 06 8e 69 6a 5d 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 91 61 02 07 17 6a 58 02 8e 69 6a 5d 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 91 59 6a 20 00 01 00 00 6a 58 20 00 01 00 00 6a 5d d2 9c}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_QY_2147775690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.QY!MTB"
        threat_id = "2147775690"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {91 06 07 06 8e 69 6a 5d 28 [0-9] 91 61 28 [0-4] 02 07 17 6a 58 02 8e 69 6a 5d 28 [0-27] 5e d2 9c 00 07 17 6a 58 0b 07 02 8e 69 17 59 6a 03 17 58 6e 5a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NL_2147775826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NL!MTB"
        threat_id = "2147775826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 b5 a2 3d 09 1f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 7e 00 00 00 51 00 00 00 f4 00 00 00 b2 01 00 00 f2 00 00 00 cc 00 00 00 5f 00 00 00 02 00 00 00 07 00 00 00 2e 00 00 00 04 00 00 00 09}  //weight: 1, accuracy: High
        $x_1_2 = {57 95 a2 29 09 03 00 00 00 fa 01 33 00 02 00 00 01 00 00 00 64 00 00 00 41 00 00 00 6a 01 00 00 de 00 00 00 25 02 00 00 96 00 00 00 7e 00 00 00 04 00 00 00 0f 00 00 00 02 00 00 00 03 00 00 00 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NL_2147775826_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NL!MTB"
        threat_id = "2147775826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$13bbb016-1fdf-4a5b-a032-93a7313ce61a" ascii //weight: 1
        $x_1_2 = "LibraryItems.Properties.Resources.resource" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NL_2147775826_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NL!MTB"
        threat_id = "2147775826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Medical_.Stock10.resources" ascii //weight: 1
        $x_1_2 = "Medical_.Expiry11.resources" ascii //weight: 1
        $x_1_3 = "$96b7a448-9bc0-4e3d-a40b-22bc7d029d8d" ascii //weight: 1
        $x_1_4 = "m_OwnerPass4" ascii //weight: 1
        $x_1_5 = "_UserApplicationTrusts" ascii //weight: 1
        $x_1_6 = "ICryptoTransform" ascii //weight: 1
        $x_1_7 = "S_noTextBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NL_2147775826_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NL!MTB"
        threat_id = "2147775826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f a6 00 00 0a 6f ?? ?? ?? 0a 06 09 06 6f ?? ?? ?? 0a 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 13 04 11 04 06 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 13 05 02 28 ?? ?? ?? 0a 0b 11 05 07 16 07 8e 69 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_5_2 = {20 5a 05 00 00 28 ?? ?? ?? 06 02 28 ?? ?? ?? 0a 0b 07 28 ?? ?? ?? 0a 3a ?? ?? ?? 00 06 7e ?? ?? ?? 04 02 28 ?? ?? ?? 0a 07 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_3 = "PickerHost.g.resources" ascii //weight: 1
        $x_1_4 = "Debugger Detected" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NL_2147775826_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NL!MTB"
        threat_id = "2147775826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {47 54 02 08 09 00 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 19 00 00 00 02 00 00 00 01 00 00 00 17 00 00 00 08 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00 03 00 00 00 00 00 0a 00 01 00 00 00 00 00 06}  //weight: 1, accuracy: High
        $x_1_2 = {42 00 71 00 70 00 73 00 71 00 67 00 73 00 6a 00 67 00 61 00 6d 00 6d 00 63 00 00 37 53 00 6b 00 75 00 68 00 63 00 63 00 2e 00 50 00 72 00 6f 00 70}  //weight: 1, accuracy: High
        $x_1_3 = "Silgybnquqpepm.Ulhstbffnssheu" wide //weight: 1
        $x_1_4 = "Rplpssssnhcvsjhmjebwgn" wide //weight: 1
        $x_1_5 = "Ojwxpdcks.Cvgcidnubekmkaxmby" wide //weight: 1
        $x_10_6 = "cdn.discordapp.com/attachments/" wide //weight: 10
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NM_2147775827_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NM!MTB"
        threat_id = "2147775827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 d5 a2 ff 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 68 00 00 00 1e 00 00 00 5e 00 00 00 7f 01 00 00 4c 00 00 00 ae 00 00 00 ce 00 00 00 01 00 00 00 01 00 00 00 2c 00 00 00 0a 00 00 00 25}  //weight: 1, accuracy: High
        $x_1_2 = "Pizza_App_User.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NM_2147775827_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NM!MTB"
        threat_id = "2147775827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 07 20 c3 06 fb 0d 58 0b 7b ?? ?? ?? 04 6f ?? ?? ?? 06 13 04 07 20 ?? ?? ?? 70 60 0b 08 6f ?? ?? ?? 06 07 20 ?? ?? ?? 35 5e 0b 39 ?? ?? ?? 00 20 ?? ?? ?? 3a 07 43 ?? ?? ?? 00 02 11 04 6f ?? ?? ?? 06 07 20 ?? ?? ?? 2f 61 0b 06 28 ?? ?? ?? 06}  //weight: 5, accuracy: Low
        $x_1_2 = "unknownspf_loader" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NM_2147775827_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NM!MTB"
        threat_id = "2147775827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 8c 01 00 00 1b 2c 12 0f 00 fe 16 ?? ?? ?? 1b 6f ?? ?? ?? 0a 2d 03 16 2b 01 17 00 13 04 11 04 39 ?? ?? ?? 00}  //weight: 5, accuracy: Low
        $x_1_2 = "VE5JT1BZUlRORQ==" wide //weight: 1
        $x_1_3 = "ZGFvbA==" wide //weight: 1
        $x_1_4 = "ComplexGen" wide //weight: 1
        $x_1_5 = "WinForms_SeeInnerException" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NM_2147775827_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NM!MTB"
        threat_id = "2147775827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SE_GUI.Resources" ascii //weight: 1
        $x_1_2 = "SE_GUI.AdminPage.resources" ascii //weight: 1
        $x_1_3 = "get_Wids" ascii //weight: 1
        $x_1_4 = "Timer2_Tick_1" ascii //weight: 1
        $x_1_5 = "RequestBtn.Iconimage" ascii //weight: 1
        $x_1_6 = "server=localhost;user id=root;database=managementsystem;" ascii //weight: 1
        $x_1_7 = "System.Drawing.Bitmap" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MUH_2147775865_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUH!MTB"
        threat_id = "2147775865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Assembly" ascii //weight: 1
        $x_1_2 = "TcpChannel" ascii //weight: 1
        $x_1_3 = "Bitmap" ascii //weight: 1
        $x_1_4 = "PuppetMaster.Ward.resources" ascii //weight: 1
        $x_1_5 = "GetObject" ascii //weight: 1
        $x_1_6 = "Sleep" ascii //weight: 1
        $x_1_7 = "set_UseShellExecute" ascii //weight: 1
        $x_1_8 = "get_Black" ascii //weight: 1
        $x_1_9 = "get_Red" ascii //weight: 1
        $x_1_10 = "LateGet" ascii //weight: 1
        $x_1_11 = "GetTypes" ascii //weight: 1
        $x_1_12 = "GetMethods" ascii //weight: 1
        $x_1_13 = "op_Inequality" ascii //weight: 1
        $x_1_14 = "O Q'T)U*Y+]-d0e3f7g8" ascii //weight: 1
        $x_1_15 = "]a]b]c]hgvu" ascii //weight: 1
        $x_1_16 = "tcp://localhost:" ascii //weight: 1
        $x_1_17 = "PuppetMasterMaster" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MRU_2147775866_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MRU!MTB"
        threat_id = "2147775866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "UnmanagedFunction" ascii //weight: 1
        $x_1_2 = "Bitmap" ascii //weight: 1
        $x_1_3 = "CurrentSystemTimeZone" ascii //weight: 1
        $x_1_4 = "SignatureDeformatter.IPermission" ascii //weight: 1
        $x_1_5 = "Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=mdmsDB;Integrated Security=True;Pooling=False" ascii //weight: 1
        $x_1_6 = "ThreadPool" ascii //weight: 1
        $x_1_7 = "ICryptoTransform" ascii //weight: 1
        $x_1_8 = "TransformFinalBlock" ascii //weight: 1
        $x_1_9 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_10 = "get_payment" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MUI_2147775867_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUI!MTB"
        threat_id = "2147775867"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SymmetricDec" ascii //weight: 1
        $x_1_2 = "Thread" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "CipherMode" ascii //weight: 1
        $x_1_5 = "DataINsert" ascii //weight: 1
        $x_1_6 = "ValueExport" ascii //weight: 1
        $x_1_7 = "CaptIt" ascii //weight: 1
        $x_1_8 = "get_CaptIt" ascii //weight: 1
        $x_1_9 = "CreateDecryptor" ascii //weight: 1
        $x_1_10 = "PictureEditor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MLI_2147775868_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MLI!MTB"
        threat_id = "2147775868"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SignatureDeformatter.IPermission" ascii //weight: 1
        $x_1_2 = "ConditionalWeakTable" ascii //weight: 1
        $x_1_3 = "UnmanagedFunction" ascii //weight: 1
        $x_1_4 = "DomainPolicy" ascii //weight: 1
        $x_1_5 = "Bitmap" ascii //weight: 1
        $x_1_6 = "LockHolder" ascii //weight: 1
        $x_1_7 = "UIntPtr" ascii //weight: 1
        $x_1_8 = "PointerAttribute" ascii //weight: 1
        $x_1_9 = "Pathology" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (8 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DD_2147775944_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DD!MTB"
        threat_id = "2147775944"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8d 01 00 00 01 25 20 ?? ?? ?? ?? 20 02 ?? ?? ?? 8d 01 00 00 01 25 20 ?? ?? ?? ?? 72 ?? ?? 1a 70 a2 20 01 ?? ?? ?? 9a a2}  //weight: 1, accuracy: Low
        $x_1_2 = {fe 0c 02 00 74 ?? 00 00 01 72 ?? ?? 1a 70 72 ?? ?? 1a 70 72 ?? ?? 1a 70 28 12 00 00 0a fe 0c 02 00 74 02 00 00 1b fe 0c 02 00 74 03 00 00 1b fe 0c 02 00}  //weight: 1, accuracy: Low
        $x_1_3 = "0123456789" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UG_2147776156_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UG!MTB"
        threat_id = "2147776156"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {5f 0c 11 04 07 e0 95 0d 11 04 07 e0 11 04 08 e0 95 9e 11 04 08 e0 09 9e 11 05 11 06 d4 02 11 06 d4 91 11 04 11 04 07 e0 95 11 04 08 e0 95 58 20 [0-4] 5f e0 95 61 28 [0-4] 9c 11 06 17 6a 58}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NN_2147776207_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NN!MTB"
        threat_id = "2147776207"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {5d 13 0b 07 11 0b 91 11 08 58 13 0c 07 11 0a 91 13 0d 08 11 07 1f 16 5d 91 13 0e ?? ?? ?? ?? 61 13 0f 07 11 0a ?? ?? ?? ?? 59 11 08 5d d2 9c 00 11 07 17 58}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NN_2147776207_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NN!MTB"
        threat_id = "2147776207"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WinClient.frmlogin.resources" ascii //weight: 1
        $x_1_2 = "Emplyee Authentication Program" ascii //weight: 1
        $x_1_3 = "$e44ed7da-f512-47fc-a1a8-5ab17a8c6375" ascii //weight: 1
        $x_1_4 = "Network_Printer.txt" ascii //weight: 1
        $x_1_5 = "Global_Declarations" ascii //weight: 1
        $x_1_6 = "btnempmngmnt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NO_2147776208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NO!MTB"
        threat_id = "2147776208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "set_SelectCommand" ascii //weight: 1
        $x_1_2 = "MHMS.Form1.resources" ascii //weight: 1
        $x_1_3 = "MHMS.frmSystemInfo.resources" ascii //weight: 1
        $x_1_4 = "$240bf021-183f-46f6-97c0-cd4918a348e9" ascii //weight: 1
        $x_1_5 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NP_2147776209_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NP!MTB"
        threat_id = "2147776209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 0f 00 28 ?? 00 00 06 25 26 0f 01 28 ?? 00 00 06 25 26 d0 01 00 00 1b 28 ?? 00 00 0a 25 26 28 ?? 00 00 0a 25 26 a5 01 00 00 1b 0a 38 00 00 00 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {57 b5 a2 3d 09 0f 00 00 00 00 00 00 00 00 00 00 01}  //weight: 1, accuracy: High
        $x_1_3 = "GetDelegateForFunctionPointer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NP_2147776209_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NP!MTB"
        threat_id = "2147776209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 0a 06 28 ?? ?? ?? 0a 25 26 0b 28 ?? ?? ?? 0a 25 26 07 16 07 8e 69 6f ?? ?? ?? 0a 25 26 0a 09 20 ?? ?? ?? 5d 5a 20 ?? ?? ?? 3e 61 2b ad}  //weight: 10, accuracy: Low
        $x_1_2 = {54 00 6b 00 4a 00 45 00 55 00 30 00 70 00 49 00 55 00 30 00 52 00 4b 00 53 00 46 00 4e 00 45 00 4e 00 7a 00 67 00 7a 00 4e 00 43 00 51 00 3d}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NP_2147776209_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NP!MTB"
        threat_id = "2147776209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "32"
        strings_accuracy = "High"
    strings:
        $x_7_1 = "Medical_Laboratory.Result_1.resources" ascii //weight: 7
        $x_7_2 = "get_FT1" ascii //weight: 7
        $x_7_3 = "$82cd1bcf-1dd7-4ba9-be87-625bbfbd96a2" ascii //weight: 7
        $x_7_4 = "Password=12345678" ascii //weight: 7
        $x_1_5 = "IsLogging" ascii //weight: 1
        $x_1_6 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_7 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_8 = "ParameterizedThreadStart" ascii //weight: 1
        $x_1_9 = "FailFast" ascii //weight: 1
        $x_1_10 = "get_IsAttached" ascii //weight: 1
        $x_1_11 = "_ENABLE_PROFILING" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_7_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NQ_2147776210_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQ!MTB"
        threat_id = "2147776210"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "get_CaptIt" ascii //weight: 1
        $x_1_2 = "DataINsert" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "InsertPicture" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "ComputeHash" ascii //weight: 1
        $x_1_8 = "get_BigEndianUnicode" ascii //weight: 1
        $x_1_9 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NR_2147776211_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NR!MTB"
        threat_id = "2147776211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 08 11 01 1a 62 11 01 1b 63 61 11 01 58 11 03 11 00 11 03 1f 0b 63 19 5f 94 58 61 59 13 08 20 13 00 00 00}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NR_2147776211_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NR!MTB"
        threat_id = "2147776211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {2b 02 26 16 72 ?? ?? ?? 70 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 28 ?? ?? ?? 06}  //weight: 5, accuracy: Low
        $x_1_2 = "DnEaz" wide //weight: 1
        $x_1_3 = "DnEaz.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NR_2147776211_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NR!MTB"
        threat_id = "2147776211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 11 00 00 70 11 04 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 72 ?? ?? ?? 70}  //weight: 5, accuracy: Low
        $x_1_2 = "zumsel" wide //weight: 1
        $x_1_3 = "2019 A1 HelpDesk" ascii //weight: 1
        $x_1_4 = "set_UseShellExecute" ascii //weight: 1
        $x_1_5 = "set_CreateNoWindow" ascii //weight: 1
        $x_1_6 = "GetScriptBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NR_2147776211_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NR!MTB"
        threat_id = "2147776211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "get_TicTacToe" ascii //weight: 1
        $x_1_2 = "TicTacToe.TicTacToe.resources" ascii //weight: 1
        $x_1_3 = "TicTacToe.My.Resources" ascii //weight: 1
        $x_1_4 = "TicTacToe.frmIntro.resources" ascii //weight: 1
        $x_1_5 = "get_HotTrack" ascii //weight: 1
        $x_1_6 = "cmdHard_Click" ascii //weight: 1
        $x_1_7 = "cmdGet1And8And16_Click" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MXB_2147776221_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MXB!MTB"
        threat_id = "2147776221"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 1b 5b 18 58 93 28 ?? ?? ?? ?? 60 0d 20 ff 00 00 00 09 1f 0f 08 1b 5d 59 1e 59 1f 1f 5f 63 5f 0d 06 09 d2 6f ?? ?? ?? ?? ?? ?? 08 1e 58 0c 08 02 6f ?? ?? ?? ?? 1b 5a fe 04}  //weight: 10, accuracy: Low
        $x_2_2 = "Bitmap" ascii //weight: 2
        $x_2_3 = "GetMethod" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DR_2147776434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DR!MTB"
        threat_id = "2147776434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {a2 06 18 72 ?? 0d 00 70 a2 28 5d 00 00 06 0b 07 72 ?? 0d 00 70 72 ?? 0d 00 70 6f ?? ?? ?? 0a 0c 08 28 6a 00 00 06 0d 09 28 ?? ?? ?? 0a 13 04 11 04 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {16 9a 13 05 11 05 72 ?? 0d 00 70 6f ?? ?? ?? 0a 13 06 11 06 16 8c ?? ?? ?? 01 06 6f ?? ?? ?? 0a 26 16 28 ?? ?? ?? 0a 00 72 ?? 0d 00 70 13 07 2b 00 11 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PKA_2147776469_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PKA!MTB"
        threat_id = "2147776469"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {6f 00 6e 00 6c 00 69 00 6e 00 65 00 2f 00 62 00 61 00 73 00 65 00 2f 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 2e 00 68 00 74 00 6d 00 6c 00 a0 00 68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 30 00 6b 00 31 00 30 00 64 00 6b 00 32 00 31 00 6b 00 6b 00 65 00 6f 00 6b 00 32 00 65 00 2e 00}  //weight: 10, accuracy: Low
        $x_1_2 = "ChinaCommunistParty" wide //weight: 1
        $x_1_3 = "yIyynyvyoykyeyyyyyy" wide //weight: 1
        $x_1_4 = "QOWKDOQWD0QO4201IO4O12034201931204K0WAKDKOQWKDADoqdwkqodqwpokp1241ADQWODDKOWQ" wide //weight: 1
        $x_1_5 = "RANDOM_STRING" wide //weight: 1
        $x_1_6 = "[SPLITTER]" wide //weight: 1
        $x_1_7 = "Setting_01" wide //weight: 1
        $x_1_8 = ".html" wide //weight: 1
        $x_1_9 = "totallist" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NT_2147776804_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NT!MTB"
        threat_id = "2147776804"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e 19 00 00 0a 8c ?? ?? ?? 1b 2d 0a 28 ?? ?? ?? 2b 80 ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "SetProjectError" ascii //weight: 1
        $x_1_3 = "ClearProjectError" ascii //weight: 1
        $x_1_4 = "WriteAllBytes" ascii //weight: 1
        $x_1_5 = "DATACENTERENC" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NT_2147776804_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NT!MTB"
        threat_id = "2147776804"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VB_blackjack.Base_Table.resources" ascii //weight: 1
        $x_1_2 = "LockHolder" ascii //weight: 1
        $x_1_3 = "UnmanagedFunction" ascii //weight: 1
        $x_1_4 = "BoundHandle" ascii //weight: 1
        $x_1_5 = "PointerAttribute" ascii //weight: 1
        $x_1_6 = "get_Settingx" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NU_2147776994_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NU!MTB"
        threat_id = "2147776994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0a 03 04 28 ?? ?? ?? 06 03 04 17 58 20 00 3a 00 00 5d 91 59 06 58 06 5d 0b 03 04 20 00 3a 00 00 5d 07 d2 9c 03 0c 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = "5PH475NGB8YEF944ZFCI5A" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NU_2147776994_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NU!MTB"
        threat_id = "2147776994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f [0-4] 1f ?? 28 [0-4] 28 [0-4] 6f [0-4] 26 09 18 d6 0d 09 08 31}  //weight: 1, accuracy: Low
        $x_1_2 = {91 08 61 07 11 ?? 91 61 b4 9c 11 [0-2] 6f [0-4] 17 da fe [0-9] 2c ?? 16 13 [0-2] 2b [0-2] 11 ?? 17 d6 13 [0-2] 11 ?? 17 d6 13 ?? 11 ?? 11 ?? 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NU_2147776994_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NU!MTB"
        threat_id = "2147776994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 06 08 11 04 6f ?? ?? ?? 0a 13 05 08 11 05 58 0c 11 04 11 05 59 13 04 11 04 16 3d ?? ?? ?? ff}  //weight: 5, accuracy: Low
        $x_1_2 = "SpfSetKey" ascii //weight: 1
        $x_1_3 = "Spoofer.Properties.Resources" wide //weight: 1
        $x_1_4 = "HwidEditItem" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NV_2147776995_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NV!MTB"
        threat_id = "2147776995"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 11 0e 17 da 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 09 11 0e 09 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 0f 11 04 11 0f 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 0e 17 d6 13 0e 11 0e 11 0d 31 a5}  //weight: 1, accuracy: Low
        $x_1_2 = {86 06 45 00 86 06 45 00 86 06 45 00 86 06 45 00 86 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NV_2147776995_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NV!MTB"
        threat_id = "2147776995"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GMYNAME" ascii //weight: 1
        $x_1_2 = "Destroy_Everything" ascii //weight: 1
        $x_1_3 = "DownloadString" ascii //weight: 1
        $x_1_4 = "System.Runtime.Versioning" ascii //weight: 1
        $x_1_5 = "bigstring" ascii //weight: 1
        $x_1_6 = "GetTempPath" ascii //weight: 1
        $x_1_7 = "wclient" ascii //weight: 1
        $x_1_8 = "totallist" ascii //weight: 1
        $x_1_9 = "ONE_STRINGEntrONE_STRINGyPointONE_STRING" ascii //weight: 1
        $x_1_10 = ".online/base/" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DE_2147777289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DE!MTB"
        threat_id = "2147777289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$bc3f17fb-3eaa-4d4a-8fbe-5261380e04be" ascii //weight: 20
        $x_20_2 = "$a5816048-12ef-4d8f-be53-ba605cf72de5" ascii //weight: 20
        $x_20_3 = "$053852b6-246b-4853-a574-b33a4893a1b6" ascii //weight: 20
        $x_20_4 = "$4e6be2be-65ea-492c-b944-26eebc7f77e8" ascii //weight: 20
        $x_1_5 = "shutdowntimer.Properties.Resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "CrackerBarrelGame.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "SecurityContextRunData.Resources" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "Softworks_Rhino.Resources" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DF_2147777290_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DF!MTB"
        threat_id = "2147777290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {08 1d 5d 16 fe 01 0d 09 2c 0b 06 08 06 08 91 1f 4b 61 b4 9c 00 00 08 17 d6 0c 08 07 31}  //weight: 4, accuracy: High
        $x_1_2 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DF_2147777290_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DF!MTB"
        threat_id = "2147777290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 07 11 07 28 ?? ?? ?? 0a 13 08 08 06 11 08}  //weight: 1, accuracy: Low
        $x_1_2 = "MyApplication" ascii //weight: 1
        $x_1_3 = "ISectionEntry" ascii //weight: 1
        $x_1_4 = "SubtractObject" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "GetObjectValue" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DF_2147777290_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DF!MTB"
        threat_id = "2147777290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$994b6ecf-672b-4297-8bf3-18a1a5b2088d" ascii //weight: 20
        $x_20_2 = "$E1062140-62C8-4890-9E24-1B472F1B02FD" ascii //weight: 20
        $x_20_3 = "$532b8968-5fe5-4932-9c5e-4d798760c739" ascii //weight: 20
        $x_20_4 = "$9b435e97-17e3-49bf-b097-c10c0435d7ac" ascii //weight: 20
        $x_1_5 = "EasyScreenshotCapture.Form1.resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "StestWinForm.Properties.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "Painter.Properties.Resources" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "get_CurrentDomain" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
        $x_1_14 = "GetExtension" ascii //weight: 1
        $x_1_15 = "CreateDomain" ascii //weight: 1
        $x_1_16 = "GetDomain" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OX_2147777305_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OX!MTB"
        threat_id = "2147777305"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 16 9a 28 [0-4] d0 [0-4] 28 [0-4] 28 [0-4] 74 [0-7] 28 [0-7] 72 [0-4] 17 8d [0-7] 8c [0-4] a2 14 14 28 [0-4] 09 17 da 17 d6 8d [0-4] 13 04 07 14 72 [0-4] 19}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OX_2147777305_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OX!MTB"
        threat_id = "2147777305"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "FourAr" ascii //weight: 2
        $x_2_2 = "StrReverse" ascii //weight: 2
        $x_2_3 = "FallbackBuffer" ascii //weight: 2
        $x_2_4 = "WSTRBufferMarshaler" ascii //weight: 2
        $x_2_5 = "GetType" ascii //weight: 2
        $x_2_6 = "SafeRegistryHandle.IPermission" ascii //weight: 2
        $x_2_7 = "LoginForm" ascii //weight: 2
        $x_2_8 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 74 00 65 00 6d 00 70 00 75 00 72 00 69 00 2e 00 6f 00 72 00 67 00 2f 00 [0-37] 2e 00 78 00 73 00 64 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NW_2147777416_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NW!MTB"
        threat_id = "2147777416"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 15 00 00 0a 02 72 ?? 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0a dd 06 00 00 00}  //weight: 5, accuracy: Low
        $x_1_2 = "Eihorgw" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NW_2147777416_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NW!MTB"
        threat_id = "2147777416"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 11 0e 17 da 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 09 11 0e 09 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 0f 11 04 11 0f 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 0e 17 d6 13 0e 11 0e 11 0d 31 a5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NW_2147777416_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NW!MTB"
        threat_id = "2147777416"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FourAr" ascii //weight: 1
        $x_1_2 = "FallbackBuffer" ascii //weight: 1
        $x_1_3 = "WSTRBufferMarshaler" ascii //weight: 1
        $x_1_4 = "IVector_Raw" ascii //weight: 1
        $x_1_5 = "KeyCollection" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "FromBase64CharArray" ascii //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "LoginInfo" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OXY_2147777595_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OXY!MTB"
        threat_id = "2147777595"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0d 09 16 08 16 1e 28 ?? ?? ?? ?? ?? 06 08 6f ?? ?? ?? ?? ?? 06 18 6f ?? ?? ?? ?? ?? 06 6f ?? ?? ?? ?? 02 16 02 8e 69 6f ?? ?? ?? ?? 13 04 11 04 13 05 2b 00 11 05 2a}  //weight: 10, accuracy: Low
        $x_2_2 = "CaptIt" ascii //weight: 2
        $x_2_3 = "get_CaptIt" ascii //weight: 2
        $x_2_4 = "SymmetricAlgorithm" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PAC_2147777648_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PAC!MTB"
        threat_id = "2147777648"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "EraseExpressionFromHistoryScreen" ascii //weight: 1
        $x_1_2 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_3 = "get_OffsetMarshaler" ascii //weight: 1
        $x_1_4 = "SelectingOperation" ascii //weight: 1
        $x_1_5 = "PerformOperation" ascii //weight: 1
        $x_1_6 = "CalculatorState" ascii //weight: 1
        $x_1_7 = "get_Turquoise" ascii //weight: 1
        $x_1_8 = "get_Precision" ascii //weight: 1
        $x_1_9 = "set_Precision" ascii //weight: 1
        $x_1_10 = "XmlTextWriter" ascii //weight: 1
        $x_1_11 = "JustExecuted" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NX_2147777851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NX!MTB"
        threat_id = "2147777851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {b7 a2 3d 09 0f 00 00 00 00 00 00 00 00 00 00 02}  //weight: 1, accuracy: High
        $x_1_2 = "$33fe5c32-db6a-4d7a-addc-e1d0d8588fa9" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "TweenEngineAPI.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NX_2147777851_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NX!MTB"
        threat_id = "2147777851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {17 6a d7 20 [0-4] 6a 5f 88 13 ?? 11 ?? 08 11 ?? 84 95 d7 6e 20 [0-4] 6a 5f 88 13 ?? 08 11 ?? 84 95 13 ?? 08 11 ?? 84 08 11 ?? 84 95 9e 08 11 ?? 84 11 ?? 9e 09 11 ?? 03 11 ?? 91 08 08 11 ?? 84 95 08 11 ?? 84 95 d7 6e 20 [0-4] 6a 5f 84 95 61 86 9c 11 ?? 17 d6 13 [0-2] 11 ?? 11 ?? fe 02 13 ?? 11 ?? 2c 04 09 0a [0-3] 2b 8a 06 2a}  //weight: 6, accuracy: Low
        $x_1_2 = "FourAr" ascii //weight: 1
        $x_1_3 = "FallbackBuffer" ascii //weight: 1
        $x_1_4 = "WSTRBufferMarshaler" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "IsNotPublic" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "FormatterTypeStyle" ascii //weight: 1
        $x_1_9 = "Timer1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((8 of ($x_1_*))) or
            ((1 of ($x_6_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RM_2147777855_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RM!MTB"
        threat_id = "2147777855"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "35"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$52803763-0c38-45d0-8df9-79be41327f72" ascii //weight: 10
        $x_10_2 = "delbtn_Click" ascii //weight: 10
        $x_10_3 = "ConDb_Click" ascii //weight: 10
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "insert_Click" ascii //weight: 1
        $x_1_7 = "get_Controls" ascii //weight: 1
        $x_1_8 = "DBTableInfo" ascii //weight: 1
        $x_1_9 = "InsertData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 5 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RT_2147777856_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RT!MTB"
        threat_id = "2147777856"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 07 9a 0c 08 28 ?? ?? ?? 0a 0d 09 72 ?? ?? ?? 70 72 ?? ?? ?? 70 17 15 16 28 ?? ?? ?? 0a 0d 02 6f ?? ?? ?? 06 6f ?? ?? ?? 0a 09 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "XOR_Decrypt" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RT_2147777856_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RT!MTB"
        threat_id = "2147777856"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Star Admiral" ascii //weight: 1
        $x_10_2 = "$6d2daa07-4980-4c4f-9cf0-f381cc536dc8" ascii //weight: 10
        $x_1_3 = "Barbara" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "Prien" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_10_7 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RT_2147777856_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RT!MTB"
        threat_id = "2147777856"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_10_2 = "$CB1C2FE1-EEF7-42E2-9E3B-76011183EC26" ascii //weight: 10
        $x_1_3 = "Badd_Click" ascii //weight: 1
        $x_1_4 = "GetEncoding" ascii //weight: 1
        $x_1_5 = "get_FilePath" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "get_WhiteSmoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RT_2147777856_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RT!MTB"
        threat_id = "2147777856"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$7ad1831e-1448-4c19-a8c5-ab471fd41259" ascii //weight: 1
        $x_1_2 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_3 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_4 = "GetDomain" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "GetEnvironmentVariable" ascii //weight: 1
        $x_1_7 = "get_Controls" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZ_2147777939_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZ!MTB"
        threat_id = "2147777939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 18 13 06 2b 96 06 1f 11 d8 0b 1f 10 8d ?? ?? ?? 01 0c 17 0d 1a}  //weight: 1, accuracy: Low
        $x_1_2 = "49c7a3bf9737" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZ_2147777939_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZ!MTB"
        threat_id = "2147777939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HRHA5447E85NV455Q77OTAx" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZ_2147777939_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZ!MTB"
        threat_id = "2147777939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 03 17 58 ?? ?? ?? ?? ?? 5d 91 13 00}  //weight: 1, accuracy: Low
        $x_1_2 = "WeatherObserver.Properties.Resources.resource" ascii //weight: 1
        $x_1_3 = "4d37b87bdcf9" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZ_2147777939_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZ!MTB"
        threat_id = "2147777939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {9a 0c 08 19 8d [0-4] 25 16 7e [0-4] a2 25 17 7e [0-4] a2 25 18 72 [0-4] a2 28 [0-4] 26 20 [0-4] 0a 2b 0e 00 28 [0-4] 0b 07 6f [0-4] 1f}  //weight: 1, accuracy: Low
        $x_1_2 = {10 04 02 0e 04 28 [0-4] 28 [0-4] 26 2a 13 00 28 [0-5] 02 0e ?? 28 [0-4] 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DC_2147778051_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DC!MTB"
        threat_id = "2147778051"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$6baca0a1-1962-44db-8726-572030098945" ascii //weight: 10
        $x_10_2 = "$3f573a3d-25be-444f-b029-d03ebdb95d46" ascii //weight: 10
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
        $x_1_4 = "get_BoostBass" ascii //weight: 1
        $x_1_5 = "get_NextTrack" ascii //weight: 1
        $x_1_6 = "get_Play" ascii //weight: 1
        $x_1_7 = "MediaCommands" ascii //weight: 1
        $x_1_8 = "Computer" ascii //weight: 1
        $x_1_9 = "ICloneable" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ME_2147778090_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ME!MTB"
        threat_id = "2147778090"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 07 03 07 91 02 7b [0-4] 16 9a 6f [0-4] d2 02 7b [0-4] 17 9a 6f [0-4] d2 61 d2 61 d2 9c}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "Activator" ascii //weight: 2
        $x_2_4 = "ResourceManager" ascii //weight: 2
        $x_2_5 = "Assembly" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ME_2147778090_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ME!MTB"
        threat_id = "2147778090"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TsemachPod" ascii //weight: 1
        $x_1_2 = "Debug" ascii //weight: 1
        $x_1_3 = "MemoryStream" ascii //weight: 1
        $x_1_4 = "snapshotField" ascii //weight: 1
        $x_1_5 = "get_Snapshot" ascii //weight: 1
        $x_1_6 = "e6f75381-8d38-4ddd-8e03-d75a0f6e7740" ascii //weight: 1
        $x_1_7 = "Password" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "get_UserState" ascii //weight: 1
        $x_1_10 = "set_PasswordChar" ascii //weight: 1
        $x_1_11 = "FromBase64String" ascii //weight: 1
        $x_1_12 = "RunWorkerAsync" ascii //weight: 1
        $x_1_13 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ME_2147778090_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ME!MTB"
        threat_id = "2147778090"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 09 08 6f 67 00 00 0a 00 09 18 6f 68 00 00 0a 00 09 6f 69 00 00 0a 06 16 06 8e 69 6f 6a 00 00 0a 13 04 11 04 03 28 19 00 00 06 28 18 00 00 06 72 ?? ?? ?? 70 6f 6b 00 00 0a 80 0b 00 00 04 02 03 73 54 00 00 0a 13 05 2b 00 11 05 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "ec8426be-e154-4f0e-8b25-bcf2c8db02b4" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "keyisdown" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "ZeroOrMinus" ascii //weight: 1
        $x_1_8 = "SafeHandle" ascii //weight: 1
        $x_1_9 = "shlomi2_Click" ascii //weight: 1
        $x_1_10 = "Finance.Framework.Types.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZ_2147778091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZ!MTB"
        threat_id = "2147778091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 6f [0-9] 0b 07 6f [0-4] 1f 09 9a 0c 08 72 [0-9] 14 14 19 8d ?? ?? ?? ?? 25 16 7e ?? ?? ?? ?? a2 25 17 7e ?? ?? ?? ?? a2 25 18 72 ?? ?? ?? ?? a2 6f ?? ?? ?? ?? 26}  //weight: 10, accuracy: Low
        $x_2_2 = "FromBase64String" ascii //weight: 2
        $x_2_3 = "StrReverse" ascii //weight: 2
        $x_2_4 = "WSTRBufferMarshaler" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZ_2147778091_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZ!MTB"
        threat_id = "2147778091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {26 20 02 00 00 00 38 [0-4] 11 00 11 02 11 00 28 [0-3] 06 1e 5b 6f [0-3] 0a 6f [0-3] 0a 20 06 00 00 00 38 [0-4] 11 08 11 05 20 e8 03 00 00 73 [0-3] 0a 13 02 38 [0-4] 11 09}  //weight: 2, accuracy: Low
        $x_1_2 = "80.66.75.27/arx1-Ncpvfuijj.bmp" wide //weight: 1
        $x_1_3 = "Ltqjxcqu" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ACG_2147778092_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ACG!MTB"
        threat_id = "2147778092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 08 a2 25 17 19 8d ?? ?? ?? ?? 25 16 7e ?? ?? ?? ?? a2 25 17 7e ?? ?? ?? ?? a2 25 18 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 a2 25 0d 14 14 18 8d ?? ?? ?? ?? 25 16 17 9c 25 13 04 17}  //weight: 10, accuracy: Low
        $x_2_2 = "WSTRBufferMarshaler" ascii //weight: 2
        $x_2_3 = "FormatterTypeStyle" ascii //weight: 2
        $x_2_4 = "FallbackBuffer" ascii //weight: 2
        $x_2_5 = "CreateInstance" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OLY_2147778248_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OLY!MTB"
        threat_id = "2147778248"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "FormatterTypeStyle" ascii //weight: 2
        $x_2_2 = "ForNextCheckObj" ascii //weight: 2
        $x_2_3 = "ForLoopInitObj" ascii //weight: 2
        $x_2_4 = "WSTRBufferMarshaler" ascii //weight: 2
        $x_2_5 = "EqualityComparer" ascii //weight: 2
        $x_2_6 = "GetType" ascii //weight: 2
        $x_2_7 = "FallbackBuffer" ascii //weight: 2
        $x_2_8 = "FromBase64CharArray" ascii //weight: 2
        $x_2_9 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 74 00 65 00 6d 00 70 00 75 00 72 00 69 00 2e 00 6f 00 72 00 67 00 2f 00 [0-37] 2e 00 78 00 73 00 64 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NY_2147778249_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NY!MTB"
        threat_id = "2147778249"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 03 04 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {18 58 19 59 fe 01 13 06 11 06 2c 04 16 0d 2b 04 09 17 58 0d 00 11 04 17 58 13 04 11 04 02 8e 69 17 59 fe 02 16 fe 01 13 07 11 07 2d b8}  //weight: 1, accuracy: High
        $x_1_3 = {02 11 04 91 07 61 06 09 91 61 13 05 08 11 04 11 05 d2 9c 09 03 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NY_2147778249_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NY!MTB"
        threat_id = "2147778249"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Database = amayahotel_db; Trusted_Connection = Yes" ascii //weight: 1
        $x_1_2 = "AmayaHotel.Resources" ascii //weight: 1
        $x_1_3 = "Ass2" wide //weight: 1
        $x_1_4 = "AmayaSplashScreen" ascii //weight: 1
        $x_1_5 = "GetCommandLineArgs" ascii //weight: 1
        $x_1_6 = "PasswordTextBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NY_2147778249_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NY!MTB"
        threat_id = "2147778249"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 28 00 29 00 28 00 29 00 4d 00 28 00 29 00 28 00 29 00 28 00 29 00 28 00 29 00 45 00 28 00 29 00 28}  //weight: 1, accuracy: High
        $x_1_2 = {50 00 67 00 49 00 44 00 4b 00 43 00 73 00 28 00 29 00 28 00 29 00 28 00 29 00 59 00 71 00 30 00 28 00 29 00 49 00 28 00 29}  //weight: 1, accuracy: High
        $x_1_3 = {56 00 30 00 52 00 58 00 68 00 30 00 5a 00 57 00 35 00 7a 00 61 00 57 00 39 00 75 00 28 00 29 00 45 00 6c 00 44 00 62 00 32}  //weight: 1, accuracy: High
        $x_1_4 = {28 00 29 00 28 00 29 00 4c 00 67 00 28 00 29 00 77 00 28 00 29 00 43 00 34 00 28 00 29 00 4d 00 28 00 29 00 28 00 29 00 75}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OB_2147778250_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OB!MTB"
        threat_id = "2147778250"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SimpleGameLib.WordJumblePro.resources" ascii //weight: 1
        $x_1_2 = "get_xxxxxx" ascii //weight: 1
        $x_1_3 = "_isDefend" ascii //weight: 1
        $x_1_4 = "get_OffsetMarshaler" ascii //weight: 1
        $x_1_5 = "InitializeArray" ascii //weight: 1
        $x_1_6 = "AutoScaleBaseSize" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "CreateDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OB_2147778250_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OB!MTB"
        threat_id = "2147778250"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {f2 02 f4 02 0f 03 ef 02 3d 72 eb 02 3d 72 3d 72 e3 02 3d 72 3d 72 cd 02 cd 02 d6 02 3d 72 ea 02 05 03 3d 72 3d 72 3d 72 3d 72 df 02 ef}  //weight: 1, accuracy: High
        $x_1_2 = {d6 02 03 03 e6 02 d1 02 ef 02 0d 03 e2 02 ef 02 3d 72 e0 02 0e 03 15 03 0a 03 e4 02 16 03 e7 02 e4 02 e7 02 e7 02 09 03 3d 72 3d 72 05 03 d2 02 05 03 3d 72 df 02 e1}  //weight: 1, accuracy: High
        $x_1_3 = {df 02 18 03 df 02 e1 02 d2 02 df 02 eb 02 3d 72 13 03 df 02 e2 02 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72}  //weight: 1, accuracy: High
        $x_1_4 = "B#un#ifu#_Tex#tBo#x" ascii //weight: 1
        $x_1_5 = "#Get#Met#hod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OC_2147778251_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OC!MTB"
        threat_id = "2147778251"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {56 e4 6e 64 74 69 61 5f 4c 69 76 65 5f 53 65 72 76 65 72 2e 46 6f 72 6d 4c 6f 61 64 65 72}  //weight: 1, accuracy: High
        $x_1_2 = "ndtia_Live_Server.My" ascii //weight: 1
        $x_1_3 = "CardInfoForm" ascii //weight: 1
        $x_1_4 = "Timer1" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "TextBox1" ascii //weight: 1
        $x_1_8 = "ForLoopInitObj" ascii //weight: 1
        $x_1_9 = "ReadByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ACT_2147778255_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ACT!MTB"
        threat_id = "2147778255"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 08 17 58 0c 08 06 fe 04 0d 09 2d d9}  //weight: 10, accuracy: Low
        $x_2_2 = "ToHexBytes" ascii //weight: 2
        $x_2_3 = "GetExportedTypes" ascii //weight: 2
        $x_2_4 = "GetMethod" ascii //weight: 2
        $x_2_5 = "Invoke" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ACZ_2147778256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ACZ!MTB"
        threat_id = "2147778256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 08 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 28 ?? ?? ?? 0a 26 20 00 08 00 00 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_2_2 = "ToCharArray" ascii //weight: 2
        $x_2_3 = "CreateInstance" ascii //weight: 2
        $x_2_4 = "FromBase64" ascii //weight: 2
        $x_2_5 = "ForNextCheckObj" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DG_2147778327_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DG!MTB"
        threat_id = "2147778327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$3e69f7f4-3ef0-492d-8f37-ae1745700dcc" ascii //weight: 20
        $x_20_2 = "$ca92b07c-58a4-41b2-86ae-08277c85d283" ascii //weight: 20
        $x_20_3 = "$2151e0b3-7cab-480f-85b1-4dfa38e8b12d" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "Text_Editer.Properties.Resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "PhotoEditor.Properties.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "TextEditer.Properties.Resources.resources" ascii //weight: 1
        $x_1_10 = "TargetFrameworkAttribute" ascii //weight: 1
        $x_1_11 = "get_AutoScaleBaseSize" ascii //weight: 1
        $x_1_12 = "GetAssemblies" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OLQ_2147778333_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OLQ!MTB"
        threat_id = "2147778333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {9a 13 05 11 05 28 ?? ?? ?? ?? 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? ?? b7 13 06 07 11 06 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 26 11 04 17 d6 13 04 00 11 04 09 8e 69 fe 04 16 fe 01}  //weight: 10, accuracy: Low
        $x_2_2 = "FormatterTypeStyle" ascii //weight: 2
        $x_2_3 = "WSTRBufferMarshaler" ascii //weight: 2
        $x_2_4 = "EqualityComparer" ascii //weight: 2
        $x_2_5 = "FromBase64String" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DH_2147778401_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DH!MTB"
        threat_id = "2147778401"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$387cdf2b-2cc3-491d-b1c2-ce436b23bf86" ascii //weight: 20
        $x_20_2 = "$04EC2F12-E8CC-48BF-9447-83DE9AD68B79" ascii //weight: 20
        $x_20_3 = "$77f0a00b-98d1-4100-9714-9eedb8219018" ascii //weight: 20
        $x_20_4 = "$e894edc0-e6fd-4443-adf8-181d1c92abc3" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "FunkeySelector.Properties.Resources.resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "FunnyTrader.Properties.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "SyntecADUserEditor.Resources" ascii //weight: 1
        $x_1_11 = "get_CurrentDomain" ascii //weight: 1
        $x_1_12 = "Bloc.My.Resources" ascii //weight: 1
        $x_1_13 = "get_Assembly" ascii //weight: 1
        $x_1_14 = "CreateInstance" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OD_2147778440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OD!MTB"
        threat_id = "2147778440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "geir.My" ascii //weight: 1
        $x_1_2 = "Stankovi" ascii //weight: 1
        $x_1_3 = "Create__Instance__" ascii //weight: 1
        $x_1_4 = "get_Settings" ascii //weight: 1
        $x_1_5 = "set_DoubleBuffered" ascii //weight: 1
        $x_1_6 = "get_Transparent" ascii //weight: 1
        $x_1_7 = "set_BackColor" ascii //weight: 1
        $x_1_8 = "_passmask" ascii //weight: 1
        $x_1_9 = "Marlett" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OE_2147778441_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OE!MTB"
        threat_id = "2147778441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "KeyedCollection.Inner.resources" ascii //weight: 1
        $x_1_2 = "$7f635159-c1ba-4ac7-99a7-d683fd60b168" ascii //weight: 1
        $x_1_3 = "CycMailMSG" ascii //weight: 1
        $x_1_4 = "EnvMailMSG" ascii //weight: 1
        $x_1_5 = "set_UseShellExecute" ascii //weight: 1
        $x_1_6 = "FromBase64CharArray" ascii //weight: 1
        $x_1_7 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJ_2147778545_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJ!MTB"
        threat_id = "2147778545"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "LOLLanguageSelector.UI.Properties.Resources" ascii //weight: 20
        $x_20_2 = "ValueFixup.My.Resources" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "mehrzady@gmail.com" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "Devolepors@gmal.com" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DK_2147778547_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DK!MTB"
        threat_id = "2147778547"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "43"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$e64003eb-a302-4888-a8a5-50838643bfc5" ascii //weight: 20
        $x_20_2 = "$45802242-81b4-42a5-a0a0-017bf7af26df" ascii //weight: 20
        $x_20_3 = "$1eba939b-c46c-4a38-a7c4-23204d6698fb" ascii //weight: 20
        $x_20_4 = "$0f32cdd6-a324-40c4-be70-1d2485cb71d6" ascii //weight: 20
        $x_10_5 = "CreateInstance" ascii //weight: 10
        $x_10_6 = "Activator" ascii //weight: 10
        $x_1_7 = "mickey.Resources.resources" ascii //weight: 1
        $x_1_8 = "VisorView.Properties.Resources" ascii //weight: 1
        $x_1_9 = "RegisterVB.My.Resources" ascii //weight: 1
        $x_1_10 = "William_Golding.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_14 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_15 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 2 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*) and 1 of ($x_10_*))) or
            ((3 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DL_2147778549_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DL!MTB"
        threat_id = "2147778549"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 09 91 13 0c 07 11 09 11 0c 08 11 08 1f 16 5d 91 61 11 0b 59 20 00 01 00 00 5d d2 9c 00 11 08 17 58 13 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DL_2147778549_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DL!MTB"
        threat_id = "2147778549"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$9c4eab90-4f39-411d-85da-8b00e1291b6e" ascii //weight: 20
        $x_20_2 = "$787400a6-a2e6-473a-8a22-7f9e8f1c53fd" ascii //weight: 20
        $x_20_3 = "$e968eeb7-a696-4f85-9e93-773cd22f0154" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "MentQ.Properties.Resources" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "TitleEditor.TitleList.resources" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
        $x_1_9 = "ITP_RMSS.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_TO_2147778568_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TO!MTB"
        threat_id = "2147778568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 8e b7 17 33 1b 06 14 17 8d ?? ?? ?? 01 0b 07 16 16 8d ?? ?? ?? 01 a2 07 6f ?? ?? ?? 0a 26 2b 09 06 14 14 6f ?? ?? ?? 0a 26 2a}  //weight: 10, accuracy: Low
        $x_2_2 = "GetParameters" ascii //weight: 2
        $x_2_3 = "Invoke" ascii //weight: 2
        $x_2_4 = "ParameterizedThreadStart" ascii //weight: 2
        $x_2_5 = "FlushFinalBlock" ascii //weight: 2
        $x_2_6 = "CreateDecryptor" ascii //weight: 2
        $x_2_7 = "CryptoServiceProvider" ascii //weight: 2
        $x_2_8 = "FromBase64String" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ADC_2147778569_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADC!MTB"
        threat_id = "2147778569"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 08 a2 25 17 19 8d [0-4] 25 16 7e [0-4] a2 25 17 7e [0-4] a2 25 18 [0-10] a2 a2 25 0d 14 14 18 8d [0-4] 25 16 17 9c 25 13 04 17 28 [0-4] 26}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetTypes" ascii //weight: 2
        $x_2_4 = "Activator" ascii //weight: 2
        $x_2_5 = "GetObjectValue" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ADC_2147778569_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADC!MTB"
        threat_id = "2147778569"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 41 32 33 35 34 38 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 41 36 38 37 39 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 41 41 41 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 41 41 41 34 33 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 44 44 44 44 44 44 44 44 44 44 44 34 34 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 58 58 58 58 58 32 32 32 32 00}  //weight: 1, accuracy: High
        $x_1_7 = "StrReverse" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "ToDouble" ascii //weight: 1
        $x_1_10 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADD_2147778570_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADD!MTB"
        threat_id = "2147778570"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0c 08 0d 16 13 04 11 04 16 fe 01 13 07 11 07 2c 02 2b 35 00 00 09 11 04 9a 13 05 11 05}  //weight: 10, accuracy: High
        $x_10_2 = {26 11 04 17 d6 13 04 00 11 04 09 8e 69 fe 04 16 fe 01 13 08 11 08 2c 09 07 6f [0-4] 0a 2b 03 00 2b af 06 2a}  //weight: 10, accuracy: Low
        $x_2_3 = "Invoke" ascii //weight: 2
        $x_2_4 = "GetType" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ADE_2147778571_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADE!MTB"
        threat_id = "2147778571"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a [0-3] 08 17 58 0c 08 06 fe 04 0d 09 2d}  //weight: 10, accuracy: Low
        $x_2_2 = "GetExportedTypes" ascii //weight: 2
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "Invoke" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADG_2147778572_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADG!MTB"
        threat_id = "2147778572"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6 8d ?? ?? ?? 01 0d 02 8e 69 17 da 13 04 11 04 13 05 16 13 06 38 ?? ?? ?? ?? 09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c}  //weight: 10, accuracy: Low
        $x_2_2 = "GetMethods" ascii //weight: 2
        $x_2_3 = "Invoke" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OF_2147778649_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OF!MTB"
        threat_id = "2147778649"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 18 17 16 02 7b [0-4] 23 [0-8] 23 [0-8] 73 [0-4] 7d [0-4] 02 28 [0-4] 00 2a 2e 00 28 [0-4] 00 02 02 fe [0-5] 73 [0-4] 28 [0-4] 00 02 28 [0-4] 28 [0-4] 28 [0-4] 7d}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 04 9a 13 05 11 05 28 [0-4] 23 [0-8] 59 28 [0-4] b7 13 06 20 [0-4] 13 07 11 07 20 [0-4] fe 01 13 08 11 08 2c 0a 20 [0-4] 13 07 00 2b 30 11 07 20 [0-4] fe 01 13 09 11 09 2c 0a 20 [0-4] 13 07 00 2b 17 00 20 [0-4] 13 07 07 11 06 28 [0-4] 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DI_2147778774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DI!MTB"
        threat_id = "2147778774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$9c4eab90-4f39-411d-85da-8b00e1291b6e" ascii //weight: 20
        $x_20_2 = "$76041b48-6d8a-4e37-93d4-5dac76c65cb6" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "MentQ.Properties.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "LoaderCodeSelector.Properties.Resources.resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "DarkUI.Properties.Resources" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DM_2147778777_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DM!MTB"
        threat_id = "2147778777"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$96c62c82-5618-4581-9a90-82bd44e067c3" ascii //weight: 20
        $x_20_2 = "$87367f05-e856-4d93-b520-1d8e01293026" ascii //weight: 20
        $x_20_3 = "$06998a01-2fa3-4439-9ac6-abb6add58b75" ascii //weight: 20
        $x_20_4 = "$ac6f348a-2639-496e-8218-f22e408641e7" ascii //weight: 20
        $x_1_5 = "WpfApp1.My.Resources" ascii //weight: 1
        $x_1_6 = "encrption.My.Resources" ascii //weight: 1
        $x_1_7 = "ZenDirect.My.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_13 = "DebuggableAttribute" ascii //weight: 1
        $x_1_14 = "DebuggingModes" ascii //weight: 1
        $x_1_15 = "CreateInstance" ascii //weight: 1
        $x_1_16 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OZN_2147778780_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OZN!MTB"
        threat_id = "2147778780"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 11 07 6f ?? ?? ?? 0a 08 18 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 13 05 02 28 ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 11 05 11 04 16 11 04 8e b7 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 06 0b dd}  //weight: 10, accuracy: Low
        $x_2_2 = "GetMethod" ascii //weight: 2
        $x_2_3 = "Invoke" ascii //weight: 2
        $x_2_4 = "FromBase64String" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AER_2147778781_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AER!MTB"
        threat_id = "2147778781"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {8e 69 17 da 91 1f 70 61 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 8e 69 17 d6 17 da 17 d6 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 02 8e 69 17 25 2c 56 da 13 04 11 04 13 05 16 25 2d dd 13 06 2b 43 09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03}  //weight: 10, accuracy: Low
        $x_2_2 = "GetMethods" ascii //weight: 2
        $x_2_3 = "GetTypes" ascii //weight: 2
        $x_2_4 = "CallByName" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEP_2147778782_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEP!MTB"
        threat_id = "2147778782"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 17 17 8d ?? ?? ?? 01 25 16 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 a2 a2 14 14 14 17 28 ?? ?? ?? 0a 26 20 00 08 00 00 2a}  //weight: 10, accuracy: Low
        $x_10_2 = {11 04 08 9a 13 07 11 07 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEH_2147778783_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEH!MTB"
        threat_id = "2147778783"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 08 17 58 0c 08 06 fe 04 0d 09 2d d9}  //weight: 10, accuracy: Low
        $x_10_2 = {25 16 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 9c 6f ?? ?? ?? 0a 00 00 08 17 58 0c 08 06 fe 04 0d 09 2d d0}  //weight: 10, accuracy: Low
        $x_2_3 = "GetTypes" ascii //weight: 2
        $x_2_4 = "GetExportedTypes" ascii //weight: 2
        $x_2_5 = "GetMethod" ascii //weight: 2
        $x_2_6 = "Invoke" ascii //weight: 2
        $x_2_7 = "Replace" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AEM_2147778784_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEM!MTB"
        threat_id = "2147778784"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 a2 6f ?? ?? ?? 0a 26 20 00 08 00 00 0a}  //weight: 10, accuracy: Low
        $x_10_2 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEY_2147778851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEY!MTB"
        threat_id = "2147778851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a [0-5] 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d [0-5] 07 6f ?? ?? ?? 0a dc 06 6f ?? ?? ?? 0a dc 09 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetMethods" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DO_2147778853_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DO!MTB"
        threat_id = "2147778853"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 61 20 93 01 00 01 5a 0a 07 17 58 0b 07 02 6f ?? ?? ?? 0a 2f 02 07 00 02 07 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 28 25 01 00 06 20 ?? ?? ?? ?? 28 74 00 00 06 20 ?? ?? ?? ?? 28 74 00 00 06 6f ?? ?? ?? 0a 20 63 06 00 00 1f 33 6f ?? ?? ?? 0a 28 35 00 00 06 7d 09 00 00 04 02 18 17 16 02 7b 09 00 00 04 06 00 02 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DP_2147778855_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DP!MTB"
        threat_id = "2147778855"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$ec6b579d-98ca-4a1c-90bf-461020231017" ascii //weight: 20
        $x_20_2 = "$9a22fd61-c0d2-4e94-9545-17178b3a431a" ascii //weight: 20
        $x_20_3 = "$5530d762-3800-429b-9ff0-dfe2557c14d0" ascii //weight: 20
        $x_20_4 = "$e3c2989e-9401-4ec5-9687-d8c366d74fbe" ascii //weight: 20
        $x_20_5 = "$fafb308b-23ec-4f32-b701-0fdf7b2fdce0" ascii //weight: 20
        $x_1_6 = "PunismentSystemApp.Properties.Resources" ascii //weight: 1
        $x_1_7 = "Ridgeway_Cover_Manager.Resources.resources" ascii //weight: 1
        $x_1_8 = "BitConverter.My.Resources" ascii //weight: 1
        $x_1_9 = "belongiar.Properties.Resources" ascii //weight: 1
        $x_1_10 = "$safeprojectname$.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_14 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_15 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
        $x_1_18 = "CreateInstance" ascii //weight: 1
        $x_1_19 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AFO_2147778861_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFO!MTB"
        threat_id = "2147778861"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {1e 9a 0c 19 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 7e ?? ?? ?? 04 a2 25 18 7e ?? ?? ?? 04 a2 0d 09 28 ?? ?? ?? 0a 00 08 09 28 ?? ?? ?? 0a 26 20 00 08 00 00 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DN_2147778919_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DN!MTB"
        threat_id = "2147778919"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$852d6491-4580-4a45-8c80-766430a6dfc6" ascii //weight: 20
        $x_20_2 = "$ac6f348a-2639-496e-8218-f22e408641e7" ascii //weight: 20
        $x_20_3 = "$ecb3546f-1868-4e31-9d16-8a7ae6b3c7ce" ascii //weight: 20
        $x_1_4 = "SKS.Resources.resources" ascii //weight: 1
        $x_1_5 = "ZenDirect.My.Resources" ascii //weight: 1
        $x_1_6 = "MentQ.Properties.Resources" ascii //weight: 1
        $x_1_7 = "kredit_hp.My.Resources" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_13 = "DebuggableAttribute" ascii //weight: 1
        $x_1_14 = "DebuggingModes" ascii //weight: 1
        $x_1_15 = "CreateInstance" ascii //weight: 1
        $x_1_16 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DQ_2147778922_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DQ!MTB"
        threat_id = "2147778922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$475dc766-7057-4320-af0c-adc657e69d0b" ascii //weight: 20
        $x_20_2 = "$3b8d46c0-46c3-46f4-98c5-8ad9df0e41a6" ascii //weight: 20
        $x_1_3 = "FormsClasses.Properties.Resources" ascii //weight: 1
        $x_1_4 = "DskExplorer.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DS_2147778923_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DS!MTB"
        threat_id = "2147778923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2b 51 00 02 6f ?? ?? ?? 06 72 ?? ?? ?? 70 02 7b ?? ?? ?? 04 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 18 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 2, accuracy: Low
        $x_2_2 = {0b 02 03 72 ?? ?? ?? 70 28 ?? ?? ?? 06 0c 08 0d 16 13 04 38 b2 00 00 00 09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a}  //weight: 2, accuracy: Low
        $x_1_3 = {13 04 11 04 14 17 8d ?? ?? ?? 01 25 16 19 8d ?? ?? ?? 01 25 16 7e ?? ?? ?? 04 a2 25 17 7e ?? ?? ?? 04 a2 25 18 72 ?? ?? ?? 70 a2 a2 6f ?? ?? ?? 0a 26 20 00 08 00 00 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DT_2147778925_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DT!MTB"
        threat_id = "2147778925"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$3daa8980-9ce6-476a-9bf0-cf8f75f05bf3" ascii //weight: 20
        $x_20_2 = "$e613fcf0-45cb-4110-9ca7-ad62d0840fec" ascii //weight: 20
        $x_1_3 = "nTarlasi.Form1.resources" ascii //weight: 1
        $x_1_4 = "ClockLogic.Main.resources" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DU_2147778927_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DU!MTB"
        threat_id = "2147778927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 14 17 8d ?? ?? ?? 1b 25 16 02 a2 50 00 16 8d ?? ?? ?? 01 0a 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0a 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 06 28 ?? ?? ?? 0a 14 6f ?? ?? ?? 0a 74}  //weight: 1, accuracy: Low
        $x_1_2 = {26 de 03 26 de 00 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DV_2147778928_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DV!MTB"
        threat_id = "2147778928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$6740ca89-5538-49b8-9c34-93ab61ff6abc" ascii //weight: 20
        $x_20_2 = "$d24fff3e-67b3-4b11-9048-b3a8f3bf48e0" ascii //weight: 20
        $x_1_3 = "MemberManagerLite.Resources.resources" ascii //weight: 1
        $x_1_4 = "CasinoGame.Resources.resources" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AFH_2147778948_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFH!MTB"
        threat_id = "2147778948"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7}  //weight: 10, accuracy: Low
        $x_10_2 = {11 04 08 9a 13 07 11 07 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7}  //weight: 10, accuracy: Low
        $x_2_3 = "Reverse" ascii //weight: 2
        $x_2_4 = "CreateInstance" ascii //weight: 2
        $x_2_5 = "GetTypes" ascii //weight: 2
        $x_2_6 = "FromBase64String" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AFU_2147778949_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFU!MTB"
        threat_id = "2147778949"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {1e 9a 0c 19 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 7e ?? ?? ?? 04 a2 25 18 7e ?? ?? ?? 04 a2 0d 09 28 ?? ?? ?? 0a 00 08 09 28 ?? ?? ?? 0a 26 20 00 08 00 00 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AFW_2147778950_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFW!MTB"
        threat_id = "2147778950"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 09 a2 25 17 16 8c ?? ?? ?? 01 a2 25 18 1a 8c ?? ?? ?? 01 a2 13 08 11 08 0b 19 8d ?? ?? ?? 01 13 04 11 04 16 17 9c 11 04 0c 11 12}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetTypes" ascii //weight: 2
        $x_2_4 = "Reverse" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGB_2147778951_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGB!MTB"
        threat_id = "2147778951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 19 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 7e ?? ?? ?? 04 a2 25 18 7e ?? ?? ?? 04 a2 0d 09 28 ?? ?? ?? 0a 00 08 09 28 ?? ?? ?? 0a 26 20 00 08 00 00 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "Reverse" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PAB_2147779014_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PAB!MTB"
        threat_id = "2147779014"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "set_CheckForIllegalCrossThreadCalls" ascii //weight: 1
        $x_1_2 = "DskExplorer.Etcher.resources" ascii //weight: 1
        $x_1_3 = "ShutdownEventHandler" ascii //weight: 1
        $x_1_4 = "NetworkCredential" ascii //weight: 1
        $x_1_5 = "FileSystemProxy" ascii //weight: 1
        $x_1_6 = "ClipboardProxy" ascii //weight: 1
        $x_1_7 = "FileSystemInfo" ascii //weight: 1
        $x_1_8 = "FtpWebResponse" ascii //weight: 1
        $x_1_9 = "get_WhiteSmoke" ascii //weight: 1
        $x_1_10 = "get_Clipboard" ascii //weight: 1
        $x_1_11 = "ICredentials" ascii //weight: 1
        $x_1_12 = "GetTickCount" ascii //weight: 1
        $x_1_13 = "TcpListener" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_TE_2147779069_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TE!MTB"
        threat_id = "2147779069"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DownloadData" ascii //weight: 1
        $x_1_2 = "$cfa28c77-244d-418a-8a8d-f7d91c538769" ascii //weight: 1
        $x_1_3 = "linkDownload" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "CreateEncryptor" ascii //weight: 1
        $x_1_6 = "execution_param" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "get_HotTrack" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "DownloadFile" ascii //weight: 1
        $x_1_11 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_TF_2147779071_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TF!MTB"
        threat_id = "2147779071"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\thedevilcoder.exe" ascii //weight: 1
        $x_1_2 = "c:\\Users\\VICTOR\\source\\repos\\DSGSGDSDSDLKJSDJK\\DSGSGDSDSDLKJSDJK\\obj\\Debug\\DSGSGDSDSDLKJSDJK.pdb" ascii //weight: 1
        $x_1_3 = "$fb5aa52f-9f7e-4be4-bcad-866da1716403" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "thedevilcoder" ascii //weight: 1
        $x_1_6 = "https:##tepidness-tuesdays.000webhostapp.com#ta.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGK_2147779172_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGK!MTB"
        threat_id = "2147779172"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03 6f ?? ?? ?? 0a 17 da fe 01 13 08 11 08 13 09 11 09 2c 06 16 13 07 00 2b 08 00 11 07 17 d6 13 07 00 11 06 17 d6 13 06 11 06 11 05 31 c0}  //weight: 10, accuracy: Low
        $x_2_2 = "GetMethod" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "Invoke" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGK_2147779172_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGK!MTB"
        threat_id = "2147779172"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 07 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0c 19 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 7e ?? ?? ?? 04 a2 25 18 7e ?? ?? ?? 04 a2 0d 09 28 ?? ?? ?? 0a 00 08 09 28 ?? ?? ?? 0a 26 06 2a}  //weight: 10, accuracy: Low
        $x_2_2 = "Reverse" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "CreateInstance" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGM_2147779173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGM!MTB"
        threat_id = "2147779173"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 40 00 00 13 04 07 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 16 8c ?? ?? ?? 01 a2 14 14 28 ?? ?? ?? 0a 00 11 04 17 da 17 d6 8d ?? ?? ?? 01 13 05 08 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 18 19 8d ?? ?? ?? 01 25 16 11 05 a2 25 17 16}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "Reverse" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGS_2147779174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGS!MTB"
        threat_id = "2147779174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Coursework.About_Program.resources" ascii //weight: 1
        $x_1_2 = "Coursework.frmGiris.resources" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Decompress" ascii //weight: 1
        $x_1_5 = "GZipStream" ascii //weight: 1
        $x_1_6 = "GetAssemblies" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Reverse" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_10 = "GetObjectValue" ascii //weight: 1
        $x_1_11 = "CreateDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGT_2147779175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGT!MTB"
        threat_id = "2147779175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 0b 2b 4d 16 0c 2b 3b 16 0d 2b 29 11 07 06 08 58 07 09 58 6f ?? ?? ?? 0a 13 0f 12 0f 28 ?? ?? ?? 0a 13 09 11 05 11 04 11 09 9c 11 04 17 58 13 04 09 17 58 0d 09 17 fe 04 13 0a 11 0a 2d cd}  //weight: 2, accuracy: Low
        $x_1_2 = "QuanLySanPham" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGT_2147779175_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGT!MTB"
        threat_id = "2147779175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 09 11 05 6f ?? ?? ?? 0a 13 06 04 09 11 05 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 06 11 08 28 ?? ?? ?? 0a 9c 11 05 17 d6 13 05 11 05 11 04 31 cb}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "Reverse" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AHD_2147779176_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AHD!MTB"
        threat_id = "2147779176"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 08 17 58 0c 08 06 fe 04 0d 09 2d da}  //weight: 10, accuracy: Low
        $x_10_2 = {16 9a 13 05 11 05 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 14 14 28 ?? ?? ?? 0a 13 06 11 06 14 72 ?? ?? ?? 70 18 8d ?? ?? ?? 01 25 16 16 8c ?? ?? ?? 01 a2 25 17 06 a2 14 14}  //weight: 10, accuracy: Low
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "Invoke" ascii //weight: 2
        $x_2_5 = "Replace" ascii //weight: 2
        $x_2_6 = "ToCharArray" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AHE_2147779177_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AHE!MTB"
        threat_id = "2147779177"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 09 11 05 6f ?? ?? ?? 0a 13 06 04 09 11 05 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 06 11 08 28 ?? ?? ?? 0a 9c 11 05 17 d6 13 05 11 05 11 04 31 cb}  //weight: 10, accuracy: Low
        $x_10_2 = {0a 16 9a 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 03 a2 25 13 04 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 05 28 ?? ?? ?? 0a 11 05 16 91 2d 02 2b 0b 11 04 16 9a}  //weight: 10, accuracy: Low
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "CreateInstance" ascii //weight: 2
        $x_2_5 = "Reverse" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DY_2147779332_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DY!MTB"
        threat_id = "2147779332"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$2b1c9776-08ab-49de-973e-283deca94a1d" ascii //weight: 20
        $x_20_2 = "$0e23f0b7-aee1-4601-ad18-16082b871a25" ascii //weight: 20
        $x_1_3 = "job.Properties.Resources" ascii //weight: 1
        $x_1_4 = "Rocket_Mission.Properties.Resources" ascii //weight: 1
        $x_1_5 = "ModuleResolveEventHandler" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DZ_2147779334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZ!MTB"
        threat_id = "2147779334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 08 17 58 0c 08 06 fe 04 0d 09 2d da}  //weight: 1, accuracy: Low
        $x_1_2 = {06 0b 07 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f 18 01 00 0a 0c 08 28 9d 00 00 06 0d 28 19 01 00 0a 09 6f 1a 01 00 0a 13 04 11 04 6f 1b 01 00 0a 16 9a 13 05 11 05 14 72 ?? ?? ?? 70 17 8d 11 00 00 01 25 16 72 ?? ?? ?? 70 a2 14 14 28 1c 01 00 0a 13 06 11 06 14}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EA_2147779336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EA!MTB"
        threat_id = "2147779336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {0c 16 0d 38 19 00 00 00 08 07 09 18 6f 09 00 00 0a 1f 10 28 0a 00 00 0a 6f 0b 00 00 0a 09 18 58 0d 09 07 6f 0c 00 00 0a 32 de}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EA_2147779336_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EA!MTB"
        threat_id = "2147779336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04}  //weight: 3, accuracy: High
        $x_1_2 = "AppDomain" ascii //weight: 1
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
        $x_1_4 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EA_2147779336_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EA!MTB"
        threat_id = "2147779336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 20 00 10 00 00 8d ?? ?? ?? ?? 0b 73 ?? ?? ?? 0a 0c 00 00 06 07 16 20 00 10 00 00 6f ?? ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 00 08 07 16 09 6f ?? ?? ?? 0a 00 00 00 09 16 fe 02 13 05 11 05 2d d0 08 6f ?? ?? ?? 0a 13 06 de 16}  //weight: 10, accuracy: Low
        $x_1_2 = "GZIDEKKKK" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EA_2147779336_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EA!MTB"
        threat_id = "2147779336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$93c3f5ff-7a75-49c1-be97-47c41a21f9ec" ascii //weight: 20
        $x_20_2 = "$24d176af-ebae-4115-80ac-09d880f45d96" ascii //weight: 20
        $x_20_3 = "$f255e226-5d6f-4628-8494-04ea14d41387" ascii //weight: 20
        $x_5_4 = "CreateInstance" ascii //weight: 5
        $x_5_5 = "Activator" ascii //weight: 5
        $x_1_6 = "DataTree.My.Resources" ascii //weight: 1
        $x_1_7 = "InmacolProyecto.My.Resources" ascii //weight: 1
        $x_1_8 = "Pomf_Uploader.My.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "DebuggableAttribute" ascii //weight: 1
        $x_1_15 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 1 of ($x_5_*) and 8 of ($x_1_*))) or
            ((1 of ($x_20_*) and 2 of ($x_5_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EA_2147779336_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EA!MTB"
        threat_id = "2147779336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$84a722b1-8c42-45f3-a33c-fdd16dd3788f" ascii //weight: 20
        $x_20_2 = "$700b1561-b721-4f64-8855-96776fa2c828" ascii //weight: 20
        $x_20_3 = "$9c6dc23f-a279-47c7-a9f5-aaccd42beecb" ascii //weight: 20
        $x_20_4 = "$5a573664-476d-47c7-b8a3-c9193a22e37e" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "LeaveManager.Resources.resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "Sklgeh.Properties.Resources.resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "LevelEditor.Resources.resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "Helpers.My.Resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EB_2147779339_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EB!MTB"
        threat_id = "2147779339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_7_1 = {20 d1 c4 d1 c2 20 04 00 00 00 63 20 04 00 00 00 62 20 f6 55 15 f3 61 7d ?? ?? ?? ?? 38 38 02 00 00 7e ?? ?? ?? ?? 20 3a c0 42 be 20 98 89 53 36 58 20 49 5c a0 21 59 20 89 ed f5 d2 61}  //weight: 7, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EB_2147779339_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EB!MTB"
        threat_id = "2147779339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "soft_Gqcap" ascii //weight: 1
        $x_1_2 = "ack_ugi" ascii //weight: 1
        $x_1_3 = "fxsolicy_ReBR2" ascii //weight: 1
        $x_1_4 = "nubs_Intatcha" ascii //weight: 1
        $x_1_5 = "Loct_sctmgt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EB_2147779339_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EB!MTB"
        threat_id = "2147779339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {03 04 03 8e 69 5d 91 11 01 04 05 5d 91 61 7e 1a 01 00 04 28 ?? ?? ?? ?? 03 04 17 58 03 8e 69 5d 91 7e 1b 01 00 04 28 ?? ?? ?? ?? 59 11 00}  //weight: 5, accuracy: Low
        $x_1_2 = "TaskTrayApp.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EB_2147779339_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EB!MTB"
        threat_id = "2147779339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetMethod" ascii //weight: 1
        $x_1_2 = "MathEasy" ascii //weight: 1
        $x_1_3 = "toText" ascii //weight: 1
        $x_1_4 = "GZIDEKKKK" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GZipStream" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "HipHop" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "KeyDecoder" ascii //weight: 1
        $x_1_11 = "StringSplitOptions" ascii //weight: 1
        $x_1_12 = "uploadData" ascii //weight: 1
        $x_1_13 = "DebuggableAttribute" ascii //weight: 1
        $x_1_14 = "downloadData" ascii //weight: 1
        $x_1_15 = "Replace" ascii //weight: 1
        $x_1_16 = "wScanCode" ascii //weight: 1
        $x_1_17 = "UriKind" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EB_2147779339_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EB!MTB"
        threat_id = "2147779339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$322e7ebf-9041-4b7e-af78-c992f340ed78" ascii //weight: 20
        $x_20_2 = "$afbc335e-cb67-4251-b0c3-00f65cd47bf8" ascii //weight: 20
        $x_20_3 = "$6cafeded-eba4-4e16-8f1d-c51659b0051d" ascii //weight: 20
        $x_1_4 = "Imager.PodajIloscKlasHistogramuG.resources" ascii //weight: 1
        $x_1_5 = "PhotoSlideCS.Form1.resources" ascii //weight: 1
        $x_1_6 = "aR3nbf8dQp2feLmk31.SplashForm.resources" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
        $x_1_12 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EB_2147779339_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EB!MTB"
        threat_id = "2147779339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$6ceff35a-c476-4f2f-9d08-16c3d9bd5091" ascii //weight: 20
        $x_20_2 = "$9480809e-5472-44f3-b076-dcdf7379e766" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "captainalm.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "TrackManager.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "webshellManager.aboutForm.resources" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_12 = "Activator" ascii //weight: 1
        $x_1_13 = "DebuggableAttribute" ascii //weight: 1
        $x_1_14 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AIV_2147779425_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AIV!MTB"
        threat_id = "2147779425"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 06 16 13 07 2b 2d 07 11 04 11 07 6f ?? ?? ?? 0a 13 08 07 11 04 11 07 6f ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 13 0a 08 06 11 0a b4 9c 11 07 17 d6 13 07 11 07 11 06 31 cd}  //weight: 10, accuracy: Low
        $x_10_2 = {a2 25 13 04 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 05 28 ?? ?? ?? 0a 11 05 16 91 2d 02 2b 0b 11 04 16 9a 28 ?? ?? ?? 0a 10 01 74 ?? ?? ?? 01 0b 07 6f ?? ?? ?? 0a 1f 0b 9a 0c 19 8d 19}  //weight: 10, accuracy: Low
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "CreateInstance" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AJB_2147779426_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJB!MTB"
        threat_id = "2147779426"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Holiday.AboutBox.resources" ascii //weight: 1
        $x_1_2 = "Holiday.AddSource.resources" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Bitmap" ascii //weight: 1
        $x_1_5 = "ReadOnlyDictionary" ascii //weight: 1
        $x_1_6 = "BuilderInstantiation" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "ISectionEntry" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_10 = "GetObjectValue" ascii //weight: 1
        $x_1_11 = "CreateDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AJC_2147779427_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJC!MTB"
        threat_id = "2147779427"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Picturesque.Editor.AboutForm.resources" ascii //weight: 1
        $x_1_2 = "Picturesque.Editor.HelpForm.resources" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Bitmap" ascii //weight: 1
        $x_1_5 = "Picturesque.Editor.MDI.resources" ascii //weight: 1
        $x_1_6 = "Reverse" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "GetElementType" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_10 = {43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00 68 65 78}  //weight: 1, accuracy: High
        $x_1_11 = {73 73 73 73 73 00 52 65 76 65 72 73 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AJM_2147779428_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJM!MTB"
        threat_id = "2147779428"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 26 00 08 17 58 0c 08 06 fe 04 0d 09 2d d5}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "Reverse" ascii //weight: 2
        $x_2_5 = "Invoke" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AJT_2147779429_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJT!MTB"
        threat_id = "2147779429"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03 6f ?? ?? ?? 0a 17 da fe 01 13 08 11 08 13 09 11 09 ?? ?? ?? ?? ?? 16 13 07 00 ?? ?? ?? ?? ?? ?? 11 07 17 d6 13 07 00 11 06 17 d6 13 06 11 06 11 05}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "GetMethod" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EE_2147779633_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EE!MTB"
        threat_id = "2147779633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 16 0c 2b 13 00 07 08 07 08 91 20 ?? ?? ?? 00 59 d2 9c 00 08 17 58 0c 08 07 8e 69 fe 04 0d 09 2d e3}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EE_2147779633_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EE!MTB"
        threat_id = "2147779633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$2a6ff1d3-04cc-42b6-a04d-cf163c20ae7f" ascii //weight: 20
        $x_1_2 = "StudyTool.StudyTool.resources" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EE_2147779633_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EE!MTB"
        threat_id = "2147779633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$FE19E2E5-C43E-4547-BF52-C1F2E93ABF1B" ascii //weight: 20
        $x_20_2 = "$34626a3d-9ba0-4744-a97a-3318a0eafb5c" ascii //weight: 20
        $x_20_3 = "$6e3bbb3c-9668-4a30-b87c-62023cd9ebfe" ascii //weight: 20
        $x_1_4 = "VideoLan.Plugin.Properties.Resources" ascii //weight: 1
        $x_1_5 = "ReplacementFallback.Properties.Resources" ascii //weight: 1
        $x_1_6 = "ASCIIArt.Form1.resources" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EF_2147779634_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EF!MTB"
        threat_id = "2147779634"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 5f a2 1f 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 75 00 00 00 96 00 00 00 f4 00 00 00 b7}  //weight: 3, accuracy: High
        $x_3_2 = "gBS1B11DRiIYj6Gm9H+1hQ==" ascii //weight: 3
        $x_3_3 = "5fP3Y3+aq03P3i0TDTQqDQ==" ascii //weight: 3
        $x_3_4 = "2CtPEmP3JBQZarCdDzYlQA==" ascii //weight: 3
        $x_3_5 = "mkdir" ascii //weight: 3
        $x_3_6 = "System.Security.Cryptography" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EF_2147779634_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EF!MTB"
        threat_id = "2147779634"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DETAILS PACKING _LOADING _CONTAINER" ascii //weight: 1
        $x_1_2 = "License Panel" ascii //weight: 1
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "ToString" ascii //weight: 1
        $x_1_7 = "Bitmap" ascii //weight: 1
        $x_1_8 = "get_B" ascii //weight: 1
        $x_1_9 = "get_G" ascii //weight: 1
        $x_1_10 = "get_A" ascii //weight: 1
        $x_1_11 = "get_R" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EF_2147779634_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EF!MTB"
        threat_id = "2147779634"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 06 11 06 06 94 11 06 08 94 58 20 00 01 00 00 5d 94 0d 11 07 07 03 07 91 09 61 d2 9c 07 17 58 0b 07 03 8e 69 32}  //weight: 1, accuracy: High
        $x_1_2 = "Decrypt" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "ClassLibrary" ascii //weight: 1
        $x_1_9 = "CopyTo" ascii //weight: 1
        $x_1_10 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EF_2147779634_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EF!MTB"
        threat_id = "2147779634"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$00e2da06-067c-42ee-8a8a-90438843c23c" ascii //weight: 20
        $x_20_2 = "$87978767-523d-4b7f-bc0d-9d539f401e3a" ascii //weight: 20
        $x_20_3 = "$5f81a3a1-fd3d-4560-9fde-e5ed44c27be7" ascii //weight: 20
        $x_20_4 = "$c82096df-1d25-40e8-9968-f0151feb90b9" ascii //weight: 20
        $x_5_5 = "CreateInstance" ascii //weight: 5
        $x_5_6 = "Activator" ascii //weight: 5
        $x_1_7 = "BigVid.Resources" ascii //weight: 1
        $x_1_8 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_9 = "$safeprojectname$.Resources" ascii //weight: 1
        $x_1_10 = "DS_ASS_2.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_14 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_15 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 1 of ($x_5_*) and 8 of ($x_1_*))) or
            ((1 of ($x_20_*) and 2 of ($x_5_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AJY_2147779696_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJY!MTB"
        threat_id = "2147779696"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 11 04 11 0c 18 5a 18 6f ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 00 11 0c 17 58 13 0c 11 0c 11 05 fe 04 13 0d 11 0d 2d aa 11 06 72 ?? ?? ?? 70 28}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "Reverse" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKA_2147779697_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKA!MTB"
        threat_id = "2147779697"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0d 16 0a 2b 13 09 06 07 06 91 08 06 08 8e 69 5d 91 61 d2 9c 06 17 58 0a 06 07 8e 69 fe 04 13 06 11 06 2d e1}  //weight: 2, accuracy: High
        $x_1_2 = "WindowsForms.IMEHelper" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKA_2147779697_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKA!MTB"
        threat_id = "2147779697"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 02 28 ?? ?? ?? 06 a2 6f ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 16 9a 25 72 ?? ?? ?? 70 20 00 02 00 00 14 14 14 6f ?? ?? ?? 0a 0a 25 6f ?? ?? ?? 0a 16 9a 6f ?? ?? ?? 0a 20 00 01 00 00 14 06 17 8d ?? ?? ?? 01 25 16 03 a2}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetExportedTypes" ascii //weight: 2
        $x_2_4 = "GetMethods" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKB_2147779698_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKB!MTB"
        threat_id = "2147779698"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 07 16 73 ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 08 09 28 ?? ?? ?? 06 09 16 6a 6f ?? ?? ?? 0a 09 13 04 dd ?? ?? ?? ?? 08 39 ?? ?? ?? ?? 08 6f ?? ?? ?? 0a dc 07 39 ?? ?? ?? ?? 07 6f ?? ?? ?? 0a dc 06 02}  //weight: 10, accuracy: Low
        $x_2_2 = "costura.classlibrary1.dll" ascii //weight: 2
        $x_2_3 = "ReadExistingAssembly" ascii //weight: 2
        $x_2_4 = "ReadFromEmbeddedResources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKC_2147779699_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKC!MTB"
        threat_id = "2147779699"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2d 02 2b 0a 09 16 9a 28 ?? ?? ?? 0a 10 01 74 ?? ?? ?? 01 0b 07 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0c 08 19}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKD_2147779700_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKD!MTB"
        threat_id = "2147779700"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 20 00 00 00 00 38 ?? ?? ?? ?? ?? 28 ?? ?? ?? 06 03}  //weight: 10, accuracy: Low
        $x_10_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6 8d ?? ?? ?? 01 0d}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKI_2147779701_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKI!MTB"
        threat_id = "2147779701"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 14 14 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 16 9a 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 03 a2 25 13 1c 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 1d 28 ?? ?? ?? 0a 11 1d 16 91 2d 02 2b 0b 11 1c 16 9a}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "Reverse" ascii //weight: 2
        $x_2_4 = "GetType" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKP_2147779702_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKP!MTB"
        threat_id = "2147779702"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2d 02 2b 0a 09 16 9a 28 ?? ?? ?? 0a 10 01 74 ?? ?? ?? 01 0b 07}  //weight: 10, accuracy: Low
        $x_10_2 = {25 16 08 a2 25 17 19 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06 a2 25 17 28 ?? ?? ?? 06 a2 25 18 72 ?? ?? ?? 70 a2 a2 25 0d 14 14 18 8d ?? ?? ?? 01 25 16 17 9c 25 13 04 17}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKT_2147779703_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKT!MTB"
        threat_id = "2147779703"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 0a 06 16 28 ?? ?? ?? 06 a2 06 17 28 ?? ?? ?? 06 a2 06 18 72 ?? ?? ?? 70 a2 28 ?? ?? ?? 06 0b 07 28 ?? ?? ?? 06 0c 08}  //weight: 10, accuracy: Low
        $x_10_2 = {11 05 09 11 0b 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 26 00 11 0b 17 58 13 0b 11 0b 11 04 fe 04 13 0c 11 0c 2d cc}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AKY_2147779704_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AKY!MTB"
        threat_id = "2147779704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GameMaker.Resources.resources" ascii //weight: 1
        $x_1_2 = "GameMaker.frmAddContact.resources" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Bitmap" ascii //weight: 1
        $x_1_5 = "StopGrey" ascii //weight: 1
        $x_1_6 = "ReadOnlyDictionary" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "NewLateBinding" ascii //weight: 1
        $x_1_9 = "BuilderInstantiation" ascii //weight: 1
        $x_1_10 = "get_StopGrey" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ALD_2147779705_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALD!MTB"
        threat_id = "2147779705"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "Gamer_Clock.Resources.resources" ascii //weight: 10
        $x_10_2 = "Gamer_Clock.iBaseTools.resources" ascii //weight: 10
        $x_10_3 = "MouseManager.Resources.resources" ascii //weight: 10
        $x_10_4 = "MouseManager.frmOptions.resources" ascii //weight: 10
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "Bitmap" ascii //weight: 1
        $x_1_7 = "StopGrey" ascii //weight: 1
        $x_1_8 = "ReadOnlyDictionary" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "NewLateBinding" ascii //weight: 1
        $x_1_11 = "BuilderInstantiation" ascii //weight: 1
        $x_1_12 = "get_StopGrey" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 8 of ($x_1_*))) or
            ((3 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ALP_2147779706_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALP!MTB"
        threat_id = "2147779706"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Emuloader.Resources.resources" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Bitmap" ascii //weight: 1
        $x_1_5 = "StopGrey" ascii //weight: 1
        $x_1_6 = "ColorTranslator" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "NewLateBinding" ascii //weight: 1
        $x_1_9 = "GetObjectValue" ascii //weight: 1
        $x_1_10 = "get_StopGrey" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ALQ_2147779707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALQ!MTB"
        threat_id = "2147779707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "PEFileKinds.MCCCCC.resources" ascii //weight: 1
        $x_1_2 = "PEFileKinds.Properties.Resources" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "Bitmap" ascii //weight: 1
        $x_1_6 = "OffsetMarshaler" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Replace" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_10 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ALR_2147779708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALR!MTB"
        threat_id = "2147779708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 13 05 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 06 28 ?? ?? ?? 0a 11 06 16 91 2d 02 2b 0b 11 05 16 9a 28 ?? ?? ?? 0a 10 01 74 ?? ?? ?? 01 0b 1f 0b 0c 07}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "StopGrey" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AME_2147779709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AME!MTB"
        threat_id = "2147779709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 05 12 05 28 ?? ?? ?? 0a 17 da 13 06 16 13 07 2b 21 07 11 04 11 07 6f ?? ?? ?? 0a 13 08 11 08 28 ?? ?? ?? 0a 13 09 08 06 11 09 b4 9c 11 07 17 d6 13 07 11 07 11 06 31 d9}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "NewLateBinding" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a 02 8e 69 8d ?? ?? ?? ?? 0b 16 0c 2b 15 00 07 08 02 08 91 06 08 06 8e 69 5d 91 61 d2 9c 00 08 17 58 0c 08 02 8e 69 fe 04 13 04 11 04 2d df}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {02 7b 07 00 00 04 0c 02 08 02 7b 06 00 00 04 58 02 7b 04 00 00 04 58 20 8d 3b e0 7c 02 7b 09 00 00 04 58 61 7d 07 00 00 04 02 08 7d 06 00 00 04}  //weight: 3, accuracy: High
        $x_1_2 = "NotePad PRo" wide //weight: 1
        $x_1_3 = "Esmail EL BoB" wide //weight: 1
        $x_1_4 = "set_Url" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {fa 01 33 00 16 00 00 01 00 00 00 1d 01 00 00 0f 01 00 00 db 03 00 00 bc 07 00 00 ec 06}  //weight: 3, accuracy: High
        $x_3_2 = "DownloadFile" ascii //weight: 3
        $x_3_3 = "get_AbsolutePath" ascii //weight: 3
        $x_3_4 = "get_ConnectionString" ascii //weight: 3
        $x_3_5 = "DebuggerHiddenAttribute" ascii //weight: 3
        $x_3_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {01 57 9f a2 2b 09 0f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 88 00 00 00 44 00 00 00 52}  //weight: 2, accuracy: High
        $x_1_2 = "Ophthalmic" ascii //weight: 1
        $x_1_3 = "HttpListenerContext" ascii //weight: 1
        $x_1_4 = "SELECT * FROM Win32_VolumeChangeEvent" wide //weight: 1
        $x_1_5 = "G4D54C7D48A57E47Y87HB4" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fa 01 33 00 16 00 00 01 00 00 00 9f 00 00 00 5c 00 00 00 7f 02 00 00 c8 02 00 00 29 02}  //weight: 1, accuracy: High
        $x_1_2 = "S1T1U1V4W4X" wide //weight: 1
        $x_1_3 = "Sanford.Multimedia.Midi.Properties.Resources" wide //weight: 1
        $x_1_4 = "Multimedia.Midi.UI.Device" ascii //weight: 1
        $x_1_5 = "EnableVisualStyles" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "36"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "ThemingSharper.Properties.Resources" ascii //weight: 10
        $x_10_2 = "ThemingSharper.ForgotPassword.resources" ascii //weight: 10
        $x_10_3 = "ThemingSharper.Payment.resources" ascii //weight: 10
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "GetElementType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
        $x_1_8 = "Reverse" ascii //weight: 1
        $x_1_9 = "Bitmap" ascii //weight: 1
        $x_1_10 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 6 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ED_2147779725_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ED!MTB"
        threat_id = "2147779725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$3050D0A4-BBD7-4CDD-B5D8-2981FE6D4261" ascii //weight: 20
        $x_20_2 = "$285814ee-4621-452d-902a-9d1de07b506e" ascii //weight: 20
        $x_20_3 = "$7b7fb72f-6621-44e7-b367-7cc308bee26e" ascii //weight: 20
        $x_20_4 = "$0cedc90f-6f91-46b1-b912-da562f3c0695" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "Reboot_IMG.Properties.Resources.resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "ok.My.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "TP2_Prog.Resources.resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "stbc.MDIParent1.resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {11 0a 1f 18 fe 01 2c 19 07 07 8e 69 17 63 8f ?? ?? ?? ?? 25 47 06 1a 58 4a d2 61 d2 52 1f 19 13 0a}  //weight: 6, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 04 19 5a 11 05 58 08 6f ?? ?? ?? 06 17 59 11 04 58 08 6f ?? ?? ?? 06 17 59 11 05 58 73 ?? ?? ?? 06 a2 00 11 05 17 58 13 05 11 05 19 fe 04 13 06 11 06 2d c9}  //weight: 10, accuracy: Low
        $x_1_2 = "BattleShip" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "PoralPeril_StefanTicu.Resources" wide //weight: 1
        $x_1_2 = "GoogleChromeStatus" wide //weight: 1
        $x_1_3 = "ykhg3yuzq8931" wide //weight: 1
        $x_1_4 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_5 = "HideModuleNameAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {fa 01 33 00 16 00 00 01 00 00 00 93 00 00 00 1f 00 00 00 98 00 00 00 86 00 00 00 75}  //weight: 2, accuracy: High
        $x_1_2 = "Your_Friend_The_Rat_icon" wide //weight: 1
        $x_1_3 = "Kruskal Algorithm" wide //weight: 1
        $x_1_4 = "smtp.gmail.com" wide //weight: 1
        $x_1_5 = "runonstart=" wide //weight: 1
        $x_1_6 = "DebugLog.txt" wide //weight: 1
        $x_1_7 = "CallLog_" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HadZK8PNBnGpEqfEE2.24oCK30iiKiJZLgvnb" wide //weight: 1
        $x_1_2 = "ignorepartiallyemptydata" wide //weight: 1
        $x_1_3 = "stealer" wide //weight: 1
        $x_1_4 = "set CDAudio door open" wide //weight: 1
        $x_1_5 = "AesCryptoServiceProvider" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "38"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$3cd9f460-93ee-49e9-8f2f-22ecb0918fc9" ascii //weight: 20
        $x_5_2 = "CreateInstance" ascii //weight: 5
        $x_5_3 = "Activator" ascii //weight: 5
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DataDragonUrl" ascii //weight: 1
        $x_1_11 = "ChampionGGUrl" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EH_2147779730_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EH!MTB"
        threat_id = "2147779730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5nqRNftpeCIHRE3NMx.IjVtQdiHu7EbGMvr7N" wide //weight: 1
        $x_1_2 = "OnStealerDone" wide //weight: 1
        $x_1_3 = "[Browsers] Grabbing cookies" wide //weight: 1
        $x_1_4 = "[Browsers] Grabbing passwords" wide //weight: 1
        $x_1_5 = "[StealerPlugin] Invoke" wide //weight: 1
        $x_1_6 = "schtasks.exe /create /tn" wide //weight: 1
        $x_1_7 = "SELECT * FROM FirewallProduct" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EI_2147779731_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EI!MTB"
        threat_id = "2147779731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 00 06 16 73 ?? ?? ?? 0a 0b 00 73 ?? ?? ?? 0a 0c 00 20 ?? ?? ?? 00 8d ?? ?? ?? 01 0d 16 13 04 2b 14 00 08 09 16 11 05 6f ?? ?? ?? 0a 00 11 04 11 05 58 13 04 00 07 09 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 25 13 05 16 fe 02 13 06 11 06 2d d3 28 73 00 00 0a 08 6f ?? ?? ?? 0a 16 11 04 6f ?? ?? ?? 0a 13 07 de 21}  //weight: 10, accuracy: Low
        $x_1_2 = "DecompressGZip" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ExtractGZipToDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EI_2147779731_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EI!MTB"
        threat_id = "2147779731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "37"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$c927a9ee-cedd-4165-9566-de3789afcb63" ascii //weight: 20
        $x_5_2 = "CreateInstance" ascii //weight: 5
        $x_5_3 = "Activator" ascii //weight: 5
        $x_1_4 = "BO.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EI_2147779731_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EI!MTB"
        threat_id = "2147779731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$d150c9e8-a601-46cc-9619-00216a5710a6" ascii //weight: 20
        $x_20_2 = "$34c82a99-c687-44df-8498-9b19880be5a7" ascii //weight: 20
        $x_20_3 = "$03C9D35D-81EF-498C-94BB-559414C12331" ascii //weight: 20
        $x_20_4 = "$21c6d92e-0574-4111-a218-ec736c5fc3d3" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "Almarafiw.Properties.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "ClassAssignment.Properties.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "ImageRecognition.Properties.Resources.resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "Fluxx.Form1.resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EL_2147779733_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EL!MTB"
        threat_id = "2147779733"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$4b2addad-f8e7-4e75-b265-ed98095990bf" ascii //weight: 20
        $x_20_2 = "Matrix_Graph.Properties.Resources" ascii //weight: 20
        $x_1_3 = "Matrix_Graph.GraphForm" ascii //weight: 1
        $x_1_4 = "data/Gauss.txt" ascii //weight: 1
        $x_1_5 = "data/AlgoParam.txt" ascii //weight: 1
        $x_1_6 = "ActiveMarker" ascii //weight: 1
        $x_1_7 = "CreateNewMarker" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EL_2147779733_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EL!MTB"
        threat_id = "2147779733"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 13 07 12 07 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 07 04 6f ?? ?? ?? 0a 17 da 33 03}  //weight: 10, accuracy: Low
        $x_10_2 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 07 04 6f ?? ?? ?? 0a 17 da 33 03}  //weight: 10, accuracy: Low
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OXBL_2147779741_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OXBL!MTB"
        threat_id = "2147779741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 06 8e 69 17 59 0c 2b 17 07 06 08 8f ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 0b 08 17 59 0c 08 15 fe 02 0d 09 2d e1 07 13 04 11 04 2a}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "Replace" ascii //weight: 2
        $x_2_5 = "Substring" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DW_2147779755_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DW!MTB"
        threat_id = "2147779755"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 11 05 11 05 72 ?? ?? ?? 70 28 ?? ?? ?? 06 72 ?? ?? ?? 70 28 ?? ?? ?? 06 28 0c 00 00 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 7e 03 00 00 04 2d 11 14 fe ?? ?? ?? ?? 06 73 21 00 00 0a 80 03 00 00 04 7e 03 00 00 04 28 02 00 00 2b 28 03 00 00 2b 73 24 00 00 0a 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 13 05 11 05 72 ?? ?? ?? 70 28 ?? ?? ?? 06 72 ?? ?? ?? 70 28 ?? ?? ?? 06 28 0c 00 00 0a 6f ?? ?? ?? 0a 3a 7a ff ff ff}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EC_2147779756_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EC!MTB"
        threat_id = "2147779756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 07 11 01 03 11 01 91 11 03 61 d2 9c}  //weight: 10, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetDomain" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EC_2147779756_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EC!MTB"
        threat_id = "2147779756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Trapdoor" ascii //weight: 1
        $x_1_2 = "HttpWebRequest" ascii //weight: 1
        $x_1_3 = "uawAnPsn" ascii //weight: 1
        $x_1_4 = "RegexOptions" ascii //weight: 1
        $x_1_5 = "GetResponse" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "SecurityProtocolType" ascii //weight: 1
        $x_1_8 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EC_2147779756_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EC!MTB"
        threat_id = "2147779756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "/WdKaclv;component/mainwindow.xaml" wide //weight: 1
        $x_1_2 = "check2500w" wide //weight: 1
        $x_1_3 = "get_ResourceManager" ascii //weight: 1
        $x_1_4 = "WdKaclv.g.resources" ascii //weight: 1
        $x_1_5 = "ReactionDiffusionLib.Properties.Resources.resources" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EC_2147779756_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EC!MTB"
        threat_id = "2147779756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SELECT * FROM Win32_PnPEntity" wide //weight: 1
        $x_1_2 = "COM port RX data thread" wide //weight: 1
        $x_1_3 = "terminal.Resources.resources" ascii //weight: 1
        $x_1_4 = "AnnaClarkNude25" wide //weight: 1
        $x_1_5 = "FSAFSFAFASFASFAFSFAFSFA" wide //weight: 1
        $x_1_6 = "HideModuleNameAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EC_2147779756_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EC!MTB"
        threat_id = "2147779756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$7dbb6250-d282-44da-aac8-db47d7386623" ascii //weight: 20
        $x_20_2 = "$c2b44135-f1ac-48a9-bd70-3be2c38c2a15" ascii //weight: 20
        $x_20_3 = "$789B225B-A5AE-4DC3-8C44-43EB51022F7C" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "Streamship_Screenshot.Properties.Resources.resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "CPE200Lab1.ExtendForm.resources" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "ClownfishVoiceChanger.Properties.Resources.resources" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "App__Beta_.Easy.resources" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
        $x_1_15 = "DebuggableAttribute" ascii //weight: 1
        $x_1_16 = "DebuggingModes" ascii //weight: 1
        $x_1_17 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AMZ_2147779784_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMZ!MTB"
        threat_id = "2147779784"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 05 16 13 06 2b 21 07 11 04 11 06 ?? ?? ?? ?? ?? 13 07 11 07 ?? ?? ?? ?? ?? 13 08 08 06 11 08 b4 9c 11 06 17 d6 13 06 11 06 11 05 31 d9 06 17 d6 0a 11 04 17 d6 13 04 11 04 09 31 bb}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "CreateInstance" ascii //weight: 2
        $x_2_4 = "SimpleUI.Form1" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OG_2147779879_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OG!MTB"
        threat_id = "2147779879"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FileZillaProject.frmMain.resources" ascii //weight: 1
        $x_1_2 = "FileZillaProject.frmDeckViewer.resources" ascii //weight: 1
        $x_1_3 = "veluwevakantie" ascii //weight: 1
        $x_1_4 = "FormatterTypeStyle" ascii //weight: 1
        $x_1_5 = "Timer0" ascii //weight: 1
        $x_1_6 = "WSTRBufferMarshaler" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMQ_2147779905_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMQ!MTB"
        threat_id = "2147779905"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 05 09 11 ?? 18 5a 18 ?? ?? ?? ?? ?? 1f 10 28 ?? ?? ?? ?? d2}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "Invoke" ascii //weight: 2
        $x_2_4 = "GetMethod" ascii //weight: 2
        $x_2_5 = "MetroFramework.Metro_Button" ascii //weight: 2
        $x_2_6 = "Reverse" ascii //weight: 2
        $x_2_7 = "Replace" ascii //weight: 2
        $x_2_8 = "ToCharArray" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMG_2147779906_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMG!MTB"
        threat_id = "2147779906"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 06 16 0b 2b 1e 09 06 07 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 04 08 11 08 b4 9c 07 17 d6 0b 07 11 06 31 dd 08 17 d6 0c 06 17 d6 0a 06 11 05 31 c2}  //weight: 10, accuracy: Low
        $x_2_2 = "GetType" ascii //weight: 2
        $x_2_3 = "InvokeMember" ascii //weight: 2
        $x_2_4 = "InvokeMethod" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0c 06 8e 69 17 59 0d 2b 1a 08 06 09 9a 07 09 8f ?? ?? ?? 01 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 09 17 59 0d 09 16 2f e2}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MOHBAD.MOHBAD" ascii //weight: 1
        $x_1_2 = "badbadmohh.txt" ascii //weight: 1
        $x_1_3 = "KYO-TUX-GINUX-FILE-TYPES-JPEG" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "set_SecurityProtocol" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {08 1b 62 08 58 11 04 61 0c 11 05 18 58 49 13 04 11 04 39 1d 00 00 00 09 1b 62 09 58 11 04 61 0d 11 05 18 d3 18 5a 58 13 05 11 05 49 25 13 04}  //weight: 5, accuracy: High
        $x_1_2 = "pNpFnV9ZnWR2UHQFgg.LqkrBSAaREv4d5E8lw" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SshNetSwitch" wide //weight: 1
        $x_1_2 = "SshNet.Logging" wide //weight: 1
        $x_1_3 = "http://192.3.215.60" wide //weight: 1
        $x_1_4 = "Shell is started" wide //weight: 1
        $x_1_5 = "HttpResponseMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 17 02 08 09 01 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 2f 00 00 00 07 00 00 00 05 00 00 00 10}  //weight: 3, accuracy: High
        $x_3_2 = "SecurityProtocolType" ascii //weight: 3
        $x_3_3 = "discordapp.com/attachments" ascii //weight: 3
        $x_3_4 = "GetResponseStream" ascii //weight: 3
        $x_3_5 = "get_CurrentDomain" ascii //weight: 3
        $x_3_6 = "set_SecurityProtocol" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "UseSystemPasswordChar" ascii //weight: 1
        $x_1_2 = "1mvyHDQTtl6Lbzl4DLUCQyV7ojfWFJoAULQGhcRAA0B" ascii //weight: 1
        $x_1_3 = "ohenadofimotukifuyakaq" ascii //weight: 1
        $x_1_4 = "ACGNoGUhaOERxfBEUnu7aQaoHpHe" ascii //weight: 1
        $x_1_5 = "CqFeKrtNHipfo9xReJqxJg5n9SEWgB32fP" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "567327f6-87f0-42f0-9ab6-5c1d1def1842.exe" wide //weight: 1
        $x_1_2 = "get_GuidMasterKey" ascii //weight: 1
        $x_1_3 = "Serialization.Formatters.Binary" ascii //weight: 1
        $x_1_4 = "Unable to resolve HTTP prox" ascii //weight: 1
        $x_1_5 = "com.apple.Safari" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 9f a2 29 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 be 00 00 00 33 00 00 00 7e 00 00 00 26 01}  //weight: 3, accuracy: High
        $x_3_2 = "System.Threading.Tasks" ascii //weight: 3
        $x_3_3 = "HttpServerUtility" ascii //weight: 3
        $x_3_4 = "KeyValueStore/Master" ascii //weight: 3
        $x_3_5 = "playerBindingSource.TrayLocation" ascii //weight: 3
        $x_3_6 = "H5FGJ8XR44G5TFW4A4PA8P" ascii //weight: 3
        $x_3_7 = "Aircraft Rig" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "D:\\Effffffffffffffffffffffffffxt.txt" ascii //weight: 3
        $x_3_2 = "await =" ascii //weight: 3
        $x_3_3 = "D:ughuExt.txt" ascii //weight: 3
        $x_3_4 = "CryptoObfuscator.ProtectedWithCryptoObfuscatorAttribute" ascii //weight: 3
        $x_3_5 = "UseShellExecute" ascii //weight: 3
        $x_3_6 = "ProcessedByXenocode" ascii //weight: 3
        $x_3_7 = "Edfijki0joifffffffffxt.txt" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_9
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "XXSXyXsXtXeXmX.XRXeXXXfXXlXeXcXtXiXoXnX.XAXsXsXeXmXbXlXyXX" wide //weight: 1
        $x_1_2 = "Squealer.Resources" wide //weight: 1
        $x_1_3 = "GetManifestResourceNames" wide //weight: 1
        $x_1_4 = "SoapHttpClientProtocol" ascii //weight: 1
        $x_1_5 = "Tools.StronglyTypedResourceBuilder" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EM_2147779923_10
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EM!MTB"
        threat_id = "2147779923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$6e2ef049-6fb0-479f-a346-2f8e5d9195aa" ascii //weight: 20
        $x_20_2 = "$C5ACAD9F-F4B4-4532-8585-F31D5855269B" ascii //weight: 20
        $x_5_3 = "CreateInstance" ascii //weight: 5
        $x_5_4 = "Activator" ascii //weight: 5
        $x_1_5 = "AnaSoftVerKSV.Resources.resources" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 1 of ($x_5_*) and 8 of ($x_1_*))) or
            ((1 of ($x_20_*) and 2 of ($x_5_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OH_2147779969_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OH!MTB"
        threat_id = "2147779969"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 11 06 6f [0-4] 13 07 11 07 28 [0-4] 13 08 08 06 11 08 b4 9c 11 06 17 d6 13 06 11 06 11 05 31 d9}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "ReadOnlyDictionary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EN_2147779972_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EN!MTB"
        threat_id = "2147779972"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 18 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 04 07 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 6a 61 b7 28}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "ISectionEntry" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EN_2147779972_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EN!MTB"
        threat_id = "2147779972"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$55ec1ae8-4fb9-44da-9ee0-8594fcd16b45" ascii //weight: 20
        $x_20_2 = "MultiplayerLib.Properties.Resources" ascii //weight: 20
        $x_1_3 = "FATAL ERROR! GO TO HELL!" ascii //weight: 1
        $x_1_4 = "explosion.png" ascii //weight: 1
        $x_1_5 = "skulls.png" ascii //weight: 1
        $x_1_6 = "Aaaaaargh!" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_SOD_2147779974_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOD!MTB"
        threat_id = "2147779974"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 05 09 11 05 09 ?? ?? ?? ?? ?? 1e 5b ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 09 11 05 09 ?? ?? ?? ?? ?? 1e 5b ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 09 17 ?? ?? ?? ?? ?? 08 09 ?? ?? ?? ?? ?? 17 ?? ?? ?? ?? ?? 13 06 11 06 02 16 02 8e 69}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "InvokeMember" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANV_2147779975_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANV!MTB"
        threat_id = "2147779975"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {d4 91 11 04 11 04 07 95 11 04 08 95 58 20 ff 00 00 00 5f 95 61 ?? ?? ?? ?? ?? 9c 00 11 08 17 6a 58 13 08 11 08 11 05 8e 69 17 59 6a fe 02 16 fe 01 13 09 11 09 2d 97}  //weight: 10, accuracy: Low
        $x_2_2 = "GetMethod" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "Invoke" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANV_2147779975_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANV!MTB"
        threat_id = "2147779975"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$55ec1ae8-4fb9-44da-9ee0-8594fcd16b45" ascii //weight: 1
        $x_1_2 = "D7J48H77F9Y55K4JCAG5FD" ascii //weight: 1
        $x_1_3 = "MultiplayerLib.Resource1.resources" ascii //weight: 1
        $x_1_4 = "MultiplayerLib.ServerWindow.resources" ascii //weight: 1
        $x_1_5 = "SmartFormat.SmartExtensions" ascii //weight: 1
        $x_1_6 = "OffsetMarshaler" ascii //weight: 1
        $x_1_7 = "ReturnMessage" ascii //weight: 1
        $x_1_8 = "BackgroundImage" ascii //weight: 1
        $x_1_9 = "Aaaaaargh! Server" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AND_2147779976_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AND!MTB"
        threat_id = "2147779976"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {91 08 61 06 11 04 91 61 d2 9c 11 04 03 ?? ?? ?? ?? ?? 17 59 fe 01 13 06 11 06 2c 05 16 13 04 2b 06 11 04 17 58 13 04 00 11 05 17 58 13 05 11 05 07 17 59 fe 02 16 fe 01 13 07 11 07 2d bb}  //weight: 10, accuracy: Low
        $x_10_2 = {13 07 11 07 2c 2c 00 06 12 06 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 06 12 06 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 06 12 06 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 11 05 17 d6 13 05}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OXCJ_2147779984_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OXCJ!MTB"
        threat_id = "2147779984"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 14 0d de 4c 08 28 ?? ?? ?? ?? 0b de 0a 08 2c 06 08 6f ?? ?? ?? ?? dc 03 06 28 ?? ?? ?? ?? 13 04 11 04 2c 17 18 2c 12 11 04 28 ?? ?? ?? ?? 13 05 07 11 05 28 ?? ?? ?? ?? 0d de 15 de 0c 11 04 2c 07 11 04 6f ?? ?? ?? ?? dc 07 28 ?? ?? ?? ?? 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "WindowsFormsApp1.Properties" ascii //weight: 1
        $x_1_3 = "Sleep" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANY_2147780050_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANY!MTB"
        threat_id = "2147780050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 11 04 ?? ?? ?? ?? ?? a2 25 17 11 06 ?? ?? ?? ?? ?? a2 25 13 09 14 14 18 ?? ?? ?? ?? ?? 25 16 17 9c 25 17 17 9c 25 13 0a ?? ?? ?? ?? ?? 13 0b 11 0a 16 91 2d 02}  //weight: 10, accuracy: Low
        $x_10_2 = {16 9a 0b 07 ?? ?? ?? ?? ?? 14 ?? ?? ?? ?? ?? 17 ?? ?? ?? ?? ?? 25 16 03 a2 14 14 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0c 08 ?? ?? ?? ?? ?? 14 ?? ?? ?? ?? ?? 17 ?? ?? ?? ?? ?? 25 16 ?? ?? ?? ?? ?? a2 14 14 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0d 19 ?? ?? ?? ?? ?? 25 16}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AOA_2147780051_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AOA!MTB"
        threat_id = "2147780051"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SimpleUI.Form1" ascii //weight: 1
        $x_1_2 = "$eed75628-2ea0-4451-8ca4-bb651a13cddb" ascii //weight: 1
        $x_1_3 = {57 69 6e 43 6f 6e 74 72 6f 6c 73 2e 4c 69 73 74 56 69 65 77 2e 43 6f 6e 74 61 69 6e 65 72 43 6f 6c 75 6d 6e 48 65 61 64 65 72 2e 72 65 73 6f 75 72 63 65 73 e2 80 8e}  //weight: 1, accuracy: High
        $x_1_4 = "WinControls.ListView.Resources.resource" ascii //weight: 1
        $x_1_5 = "ReadOnlyDictionary" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ISectionEntry" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "GetAssemblies" ascii //weight: 1
        $x_1_10 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (8 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AOG_2147780052_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AOG!MTB"
        threat_id = "2147780052"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {da 13 05 16 13 06 2b 21 07 11 04 11 06 ?? ?? ?? ?? ?? 13 07 11 07 ?? ?? ?? ?? ?? 13 08 08 06 11 08 b4 9c 11 06 17 d6 13 06 11 06 11 05 31 d9 06 17 d6 0a 11 04 17 d6 13 04 11 04 09 31 bb}  //weight: 10, accuracy: Low
        $x_2_2 = "StrReverse" ascii //weight: 2
        $x_2_3 = "ReadOnlyDictionary" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AOK_2147780053_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AOK!MTB"
        threat_id = "2147780053"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$3454746C-DDEE-4133-98ED-0362E57B60A0" ascii //weight: 10
        $x_10_2 = "$55ec1ae8-4fb9-44da-9ee0-8594fcd16b45" ascii //weight: 10
        $x_1_3 = "D7J48H77F9Y55K4JCAG5FD" ascii //weight: 1
        $x_1_4 = "SmartFormat.SmartExtensions" ascii //weight: 1
        $x_1_5 = "OffsetMarshaler" ascii //weight: 1
        $x_1_6 = "ReturnMessage" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FEK_2147780054_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FEK!MTB"
        threat_id = "2147780054"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {5f 0c 07 06 95 13 04 07 06 07 08 95 9e 07 08 11 04 9e 11 05 09 d4 02 09 d4 91 07 07 06 95 07 08 95 58 20 ff 00 00 00 5f 95 61 ?? ?? ?? ?? ?? 9c 09 17 6a 58 0d 09 11 05 8e 69 17 59 6a fe 02 16 fe 01 13 09 11 09 2d a4}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AOU_2147780055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AOU!MTB"
        threat_id = "2147780055"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$bcfce0a0-ec17-11d0-8d10-00a0c90f2719" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "ReadOnlyDictionary" ascii //weight: 1
        $x_1_5 = "LateBinding" ascii //weight: 1
        $x_1_6 = "NewLateBinding" ascii //weight: 1
        $x_1_7 = "RestrictedError" ascii //weight: 1
        $x_1_8 = "ValueEnumerator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EO_2147780067_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EO!MTB"
        threat_id = "2147780067"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 16 fe 01 0d 09 2c 1d 00 03 07 08 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 07 08 6f ?? ?? ?? 0a 6f ?? ?? ?? 06 ?? ?? ?? 08 13 04 11 04 17 58 0c 08 07 6f ?? ?? ?? 0a fe 04 13 05 11 05 2d b7}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Activator" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EO_2147780067_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EO!MTB"
        threat_id = "2147780067"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$ab094690-6807-4d1f-a348-4a531bf3997e" ascii //weight: 20
        $x_20_2 = "$44c0fc11-6577-48ff-926d-40eeea9dd939" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "Develop.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "GradientPicker.X.resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EP_2147780068_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EP!MTB"
        threat_id = "2147780068"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 05 02 11 05 91 06 61 09 08 91 61 b4 9c 08 03 6f ?? ?? ?? 0a 17 da 33 04 16 0c 2b 04 08 17 d6 0c 11 05 17 d6 13 05}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EP_2147780068_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EP!MTB"
        threat_id = "2147780068"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "POS_Sales_and_Inventory.My.Resources" ascii //weight: 1
        $x_1_2 = "POS_Sales_and_Inventory.ISO.resources" ascii //weight: 1
        $x_1_3 = "Sample POS @deaspo_studios" ascii //weight: 1
        $x_1_4 = "CurrentClockSpeed" ascii //weight: 1
        $x_1_5 = "Motherboard Name" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
        $x_1_8 = "temp.txt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQ_2147780071_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQ!MTB"
        threat_id = "2147780071"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0d 04 17 da 13 04 16 0b 2b 0a 09 03 07 94 d6 0d 07 17 d6 0b 07 11 04 31 f1 09 6c 04 6c 5b 0c 02 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 1f 0a 9a 7d ?? ?? ?? 04 08 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "ISectionEntry" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQ_2147780071_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQ!MTB"
        threat_id = "2147780071"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$eed75628-2ea0-4451-8ca4-bb651a13cddb" ascii //weight: 20
        $x_5_2 = "CreateInstance" ascii //weight: 5
        $x_5_3 = "Activator" ascii //weight: 5
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "WinControls.ListView.Resources.resources" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 1 of ($x_5_*) and 8 of ($x_1_*))) or
            ((1 of ($x_20_*) and 2 of ($x_5_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ER_2147780072_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ER!MTB"
        threat_id = "2147780072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0a 16 0b 03 0c 16 0d 2b 0c 08 09 94 0b 06 07 d6 0a 09 17 d6 0d 09 08 8e 69 32 ee 02}  //weight: 5, accuracy: High
        $x_5_2 = {25 16 02 28 ?? ?? ?? 06 13 04 12 04 28 ?? ?? ?? 06 a2 06 00 17 8d ?? ?? ?? 01}  //weight: 5, accuracy: Low
        $x_1_3 = "ISectionEntry" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ER_2147780072_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ER!MTB"
        threat_id = "2147780072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {01 57 15 a2 09 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 bd 00 00 00 15 00 00 00 bf}  //weight: 2, accuracy: High
        $x_1_2 = "Know_if_Your_Girlfriend_Is_Horny" wide //weight: 1
        $x_1_3 = "hahn2014/MovieBrowser" wide //weight: 1
        $x_1_4 = "Buni555fu" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ER_2147780072_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ER!MTB"
        threat_id = "2147780072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$dc3fb9bb-520d-48a0-9be3-8421c07273a6" ascii //weight: 20
        $x_20_2 = "PassCrypt.My.Resources" ascii //weight: 20
        $x_1_3 = "Criptatore in AES256 di password e dati personali" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_APO_2147780217_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.APO!MTB"
        threat_id = "2147780217"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 03 08 03 ?? ?? ?? ?? ?? 5d 17 d6 ?? ?? ?? ?? ?? da 0d 06 09 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a 00 08 17 d6 0c 08 07 fe 02 16 fe 01 13 04 11 04 2d c2}  //weight: 10, accuracy: Low
        $x_10_2 = {0a 03 08 03 ?? ?? ?? ?? ?? 5d 17 d6 ?? ?? ?? ?? ?? da 0d 06 09 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a 08 17 d6 0c 08 07 fe 02 16 fe 01 13 04 11 04 2d c4}  //weight: 10, accuracy: Low
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "GetType" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_APJ_2147780218_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.APJ!MTB"
        threat_id = "2147780218"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 06 16 0b 2b 1e 09 06 07 ?? ?? ?? ?? ?? 13 07 11 07 ?? ?? ?? ?? ?? 13 08 11 04 08 11 08 b4 9c 07 17 d6 0b 07 11 06 31 ?? 08 17 d6 0c 06 17 d6 0a 06 11 05 31}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_APD_2147780219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.APD!MTB"
        threat_id = "2147780219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 13 04 14 14 17 ?? ?? ?? ?? ?? 25 16 17 9c 25 13 05 ?? ?? ?? ?? ?? 11 05 16 91 2c 03 17 2b 03 16 2b 00 2d 02 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "SimpleUI.MDI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_APQ_2147780220_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.APQ!MTB"
        threat_id = "2147780220"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 04 11 07 ?? ?? ?? ?? ?? 13 08 11 08 ?? ?? ?? ?? ?? 13 09 08 06 11 09 b4 9c 11 07 17 d6 13 07 11 07 11 06 31 d9}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "SimpleUI.MDI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OI_2147780221_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OI!MTB"
        threat_id = "2147780221"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 09 91 7e [0-4] 7e [0-4] 6f [0-4] 74 [0-4] 07 09 28 [0-4] 9c 09 17 d6 0d 09 08 31 [0-1] 7e [0-4] 7e [0-4] 06 6f [0-5] 73 [0-4] 20 [0-4] 20 [0-4] 6f [0-4] 28 [0-4] 6f [0-5] 28 [0-5] 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OJ_2147780222_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OJ!MTB"
        threat_id = "2147780222"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 da 13 06 16 13 ?? 2b ?? 07 11 ?? 11 ?? 6f ?? ?? ?? ?? 13 ?? 11 ?? 28 ?? ?? ?? ?? 13 ?? 08 06 11 ?? b4 9c 11 ?? 17 d6 13 ?? 11 ?? 11 ?? 31 ?? 06 17 d6 0a 11 ?? 17 d6 13 ?? 11 ?? 09 31 06 00 07 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OK_2147780299_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OK!MTB"
        threat_id = "2147780299"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 07 09 11 ?? 6f ?? ?? ?? ?? 13 ?? 11 ?? 28 ?? ?? ?? ?? 13 ?? 08 06 11 ?? b4 9c 11 ?? 17 d6 13 ?? 11 ?? 16 31 ?? 06 17 d6 0a 09 17 d6 0d 09 20 ?? ?? ?? ?? 31 ?? 02 72 ?? ?? ?? ?? 1f ?? 17 16 16 08 28 ?? ?? ?? ?? 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OL_2147780300_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OL!MTB"
        threat_id = "2147780300"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 17 0c 2b [0-2] 02 08 28 ?? ?? ?? ?? 03 08 03 6f ?? ?? ?? ?? 5d 17 d6 28 ?? ?? ?? ?? da 0d 06 09 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 0a 00 08 17 d6 0c 08 07 fe ?? 16 fe ?? 13 ?? 11 ?? 2d ?? 06 13 ?? 2b ?? 11 ?? 2a 0c 00 72 ?? ?? ?? ?? 0a 02 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQD_2147780302_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQD!MTB"
        threat_id = "2147780302"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {da 0d 06 09 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a 00 08 17 d6 0c 08 07 fe 02 16 fe 01 13 04 11 04 2d c2}  //weight: 10, accuracy: Low
        $x_10_2 = {13 07 11 07 14 ?? ?? ?? ?? ?? 18 ?? ?? ?? ?? ?? 25 16 16 ?? ?? ?? ?? ?? a2 25 17 06 a2 14 14 ?? ?? ?? ?? ?? 13 08 ?? ?? ?? ?? ?? 13 09 2b 00 11 09 2a}  //weight: 10, accuracy: Low
        $x_2_3 = "GetMethod" ascii //weight: 2
        $x_2_4 = "GetType" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQF_2147780303_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQF!MTB"
        threat_id = "2147780303"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 04 07 09 11 04 ?? ?? ?? ?? ?? 13 05 11 05 ?? ?? ?? ?? ?? 13 06 08 06 11 06 b4 9c 11 04 17 d6 13 04 11 04 16 31 db 06 17 d6 0a 09 17 d6 0d 09}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "SimpleUI.MDI" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQG_2147780304_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQG!MTB"
        threat_id = "2147780304"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 17 2d 03 26 2b 03 0c 2b 00 73 ?? ?? ?? 0a 0d 08 09 28 ?? ?? ?? 06 09 16 6a 6f ?? ?? ?? 0a 09 13 04 de 19 08 6f ?? ?? ?? 0a dc}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQG_2147780304_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQG!MTB"
        threat_id = "2147780304"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 09 a2 25 17 ?? ?? ?? ?? ?? a2 25 13 04 14 14 18 ?? ?? ?? ?? ?? 25 16 17 9c 25 13 05 17 ?? ?? ?? ?? ?? 26}  //weight: 10, accuracy: Low
        $x_2_2 = "CreateInstance" ascii //weight: 2
        $x_2_3 = "GetType" ascii //weight: 2
        $x_2_4 = "SimpleUI.MDI" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQC_2147780305_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQC!MTB"
        threat_id = "2147780305"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0b 11 04 06 07 ?? ?? ?? ?? ?? 13 05 11 05 ?? ?? ?? ?? ?? 13 06 09 08 11 06 b4 9c 07 17 d6 0b 07 16 31 de 08 17 d6 0c 06 17 d6 0a 06}  //weight: 10, accuracy: Low
        $x_10_2 = {25 16 09 a2 25 17 ?? ?? ?? ?? ?? a2 25 13 04 14 14 18 ?? ?? ?? ?? ?? 25 16 17 9c 25 13 05 17 ?? ?? ?? ?? ?? 26 11 05 16 91 2d 02}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQC_2147780305_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQC!MTB"
        threat_id = "2147780305"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 03 08 03 ?? ?? ?? ?? ?? 5d 17 d6 ?? ?? ?? ?? ?? da 0d 06 09 ?? ?? ?? ?? ?? 13 04 12 04 ?? ?? ?? ?? ?? 28 ?? ?? ?? 06 0a 00 08 17 d6 0c 08 07 fe 02 16 fe 01 13 05 11 05 2d be 06 13 06 2b 00 11 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "LateBinding" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ES_2147780333_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ES!MTB"
        threat_id = "2147780333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 18 5b 0a 73 ?? ?? ?? 0a 0b 16 0c 2b 1e 00 07 02 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 08 17 58 0c 08 06 fe 04 0d 09 2d da 07 6f ?? ?? ?? 0a 13 04 2b 00 11 04 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "Click" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ES_2147780333_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ES!MTB"
        threat_id = "2147780333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$f89de394-6dc6-4583-8810-aae5dcc15125" ascii //weight: 20
        $x_20_2 = "YTGet.My.Resources" ascii //weight: 20
        $x_1_3 = "YTGet.ruleeditor.resources" ascii //weight: 1
        $x_1_4 = "Sav-A-Center" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OM_2147780346_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OM!MTB"
        threat_id = "2147780346"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 17 d6 28 [0-4] da 0d 06 09 28 [0-4] 28 [0-4] 28 [0-4] 0a 00 08 17 d6 0c 08 07 fe ?? 16 fe ?? 13 ?? 11 ?? 2d 07 00 08 03 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQQ_2147780347_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQQ!MTB"
        threat_id = "2147780347"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 09 16 09 8e 69 ?? ?? ?? ?? ?? 13 04 11 04 2c 0a 07 09 16 11 04 ?? ?? ?? ?? ?? 11 04 09 8e 69 2e de}  //weight: 10, accuracy: Low
        $x_10_2 = {20 00 01 00 00 14 11 09 17 ?? ?? ?? ?? ?? 25 16 02 ?? ?? ?? ?? ?? a2 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0d de 30 11 07 17 58 13 07 11 07 11 06 8e 69 32 97}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQO_2147780348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQO!MTB"
        threat_id = "2147780348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 09 16 09 8e 69 ?? ?? ?? ?? ?? 13 04 11 04 2c 0a 07 09 16 11 04 ?? ?? ?? ?? ?? 11 04 09 8e 69 2e de}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "Lo!ad" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQT_2147780349_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQT!MTB"
        threat_id = "2147780349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6 ?? ?? ?? ?? ?? 0d 02 8e 69 17 da 13 04 11 04 13 05 16 13 06 11 06 2c 42 09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AQT_2147780349_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQT!MTB"
        threat_id = "2147780349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "transfer.sh/get/GgD2LC/" ascii //weight: 10
        $x_10_2 = "transfer.sh/get/GkVJxj/" ascii //weight: 10
        $x_10_3 = "transfer.sh/get/8sD6To/" ascii //weight: 10
        $x_10_4 = "transfer.sh/get/qxvw7E/" ascii //weight: 10
        $x_10_5 = "transfer.sh/get/2s3yIi/" ascii //weight: 10
        $x_1_6 = "GetResponseStream" ascii //weight: 1
        $x_1_7 = "WebRequest" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "GetType" ascii //weight: 1
        $x_1_11 = "MONEYMONEYMONEY" wide //weight: 1
        $x_1_12 = "GHJXHJHSHSDJ.BLOODMONEY" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ET_2147780434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ET!MTB"
        threat_id = "2147780434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 03 11 05 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 07 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 00 1f fb 13 07}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "ISectionEntry" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ET_2147780434_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ET!MTB"
        threat_id = "2147780434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$355F5281-3B41-44DC-90F3-736C399302D0" ascii //weight: 20
        $x_20_2 = "$d744907e-c50e-4d51-abd9-a61bdd9e3a1e" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "Viborita.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "SuperAdventure.Properties.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EU_2147780435_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EU!MTB"
        threat_id = "2147780435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0d 08 09 61 d1 13 04 06 11 04 6f ?? ?? ?? 0a 26 00 07 17 58 0b 07 02 6f ?? ?? ?? 0a fe 04 13 05 11 05 2d ce 0d 00 02 07 6f ?? ?? ?? 0a 0c 7e ?? ?? ?? 04}  //weight: 10, accuracy: Low
        $x_1_2 = "AES_Decrypt" ascii //weight: 1
        $x_1_3 = "EncryptDecrypt" ascii //weight: 1
        $x_1_4 = "XorKey" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EU_2147780435_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EU!MTB"
        threat_id = "2147780435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 06 07 02 08 6f ?? ?? ?? 0a 9d 06 08 02 07 6f ?? ?? ?? 0a 9d 00 07 17 58 0b 08 17 59 0c 07 08 fe 04 0d 09 2d da}  //weight: 10, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EU_2147780435_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EU!MTB"
        threat_id = "2147780435"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$dc3fb9bb-520d-48a0-9be3-8421c07273a6" ascii //weight: 20
        $x_20_2 = "$84fc6c17-bc30-4f7c-85dd-95a7a345f82e" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "PassCrypt.Resources.resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "mPortal.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EV_2147780438_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EV!MTB"
        threat_id = "2147780438"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 91 03 07 03 6f ?? ?? ?? 0a 5d 17 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 02 8e 69 32 d6}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "EncryptDecrypt" ascii //weight: 1
        $x_1_4 = "gprogejger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EV_2147780438_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EV!MTB"
        threat_id = "2147780438"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "eb79f488-8b10-41cb-b7c8-118c895109ce" ascii //weight: 1
        $x_1_2 = "DeflateStream" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "Cryptography" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "GabCopyPaste" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "FromBase64CharArray" ascii //weight: 1
        $x_1_12 = "StrReverse" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "RSACryptoServiceProvider" ascii //weight: 1
        $x_1_15 = "11111-22222-50001-00001" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EW_2147780441_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EW!MTB"
        threat_id = "2147780441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 97 a2 2b 09 07 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 6b 00 00 00 2d 00 00 00 53 00 00 00 b3 00 00 00 80}  //weight: 3, accuracy: High
        $x_3_2 = "DTEDReader.Properties.Resources.resources" ascii //weight: 3
        $x_3_3 = "GetExecutingAssembly" ascii //weight: 3
        $x_3_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 3
        $x_3_5 = "DebuggerHiddenAttribute" ascii //weight: 3
        $x_3_6 = "BlockCopy" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EW_2147780441_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EW!MTB"
        threat_id = "2147780441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$c2797ab4-9dc5-4a03-b2bd-d7c58896260f" ascii //weight: 20
        $x_20_2 = "$0749a2b8-1cf5-41c3-99cf-969cdea20ee2" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "Windows_Forms_Books.Form.resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "discordhelper_module.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EW_2147780441_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EW!MTB"
        threat_id = "2147780441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$7f9d7c38-4e09-43a3-8455-a79f19f8d810" ascii //weight: 20
        $x_20_2 = "$220cd880-5ab8-44cf-9ff8-daf6da23274e" ascii //weight: 20
        $x_20_3 = "$33f2ca60-13aa-48ad-a90e-6edbadee272f" ascii //weight: 20
        $x_20_4 = "$1eebdb20-746e-4091-afb4-f654936a9bc8" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EX_2147780455_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EX!MTB"
        threat_id = "2147780455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 05 11 01 11 08 11 01 11 08 8e 69 5d 91 9e 38}  //weight: 10, accuracy: High
        $x_10_2 = {11 07 11 01 03 11 01 91 11 09 61 d2 9c 38}  //weight: 10, accuracy: High
        $x_1_3 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EX_2147780455_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EX!MTB"
        threat_id = "2147780455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$0cedc90f-6f91-46b1-b912-da562f3c0695" ascii //weight: 20
        $x_20_2 = "$d25b5dc5-6515-4111-9ae0-6548de4889e1" ascii //weight: 20
        $x_20_3 = "$31ad2cc5-61b5-4d95-a171-5fe5760036af" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EX_2147780455_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EX!MTB"
        threat_id = "2147780455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$1f86058e-dd02-48c8-bec2-ebfc867f6001" ascii //weight: 20
        $x_20_2 = "$ffe789a4-c3c1-4b0c-8678-5d86d70aa4fb" ascii //weight: 20
        $x_20_3 = "$977e168a-3a7b-4e0d-a2ef-47e1eb2016d5" ascii //weight: 20
        $x_20_4 = "$4ebb04c5-c09d-49be-90d0-58823fbba200" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "SACFE.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "Winter_Sports_Rental.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "RogueButtons.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "TechSupportRegistration.My.Resources" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "CreateInstance" ascii //weight: 1
        $x_1_15 = "DebuggableAttribute" ascii //weight: 1
        $x_1_16 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AQZ_2147780465_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQZ!MTB"
        threat_id = "2147780465"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 06 16 13 07 2b 21 07 11 04 11 07 ?? ?? ?? ?? ?? 13 08 11 08 ?? ?? ?? ?? ?? 13 09 08 06 11 09 b4 9c 11 07 17 d6 13 07 11 07 11 06 31 d9 06 17 d6 0a 11 04 17 d6 13 04 11 04 09 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARD_2147780466_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARD!MTB"
        threat_id = "2147780466"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 06 07 ?? ?? ?? ?? ?? 13 05 11 05 ?? ?? ?? ?? ?? 13 06 09 08 11 06 b4 9c 07 17 d6 0b 07 16 31 ?? 08 17 d6 0c 06 17 d6 0a 06}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARB_2147780467_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARB!MTB"
        threat_id = "2147780467"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {56 69 67 44 65 63 72 79 70 74 00 70 72 6f 6a 00 6b 65 79}  //weight: 10, accuracy: High
        $x_10_2 = {58 41 53 58 41 58 00 70 72 6f 6a 00 6b 65 79}  //weight: 10, accuracy: High
        $x_10_3 = {73 73 73 73 73 00 41 73 73 65 6d 62 6c 79}  //weight: 10, accuracy: High
        $x_10_4 = "sssasSADASDADADss" ascii //weight: 10
        $x_1_5 = {4c 6f 61 64 00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_6 = "ResourceManager" ascii //weight: 1
        $x_1_7 = "FromBase64CharArray" ascii //weight: 1
        $x_1_8 = {54 6f 43 68 61 72 41 72 72 61 79 00 43 6f 6e 76 65 72 74}  //weight: 1, accuracy: High
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 5 of ($x_1_*))) or
            ((3 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EY_2147780581_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EY!MTB"
        threat_id = "2147780581"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 01 00 00 6f ?? ?? ?? 0a 06 20 80 00 00 00 6f ?? ?? ?? 0a 7e ?? ?? ?? 04 7e ?? ?? ?? 04 20 ?? ?? ?? ?? 73 ?? ?? ?? 0a 0b 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 02 06 6f ?? ?? ?? 0a 17 73}  //weight: 10, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EY_2147780581_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EY!MTB"
        threat_id = "2147780581"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$0e95aedc-5127-4e59-9063-f17290b40a9b" ascii //weight: 20
        $x_20_2 = "$c2797ab4-9dc5-4a03-b2bd-d7c58896260f" ascii //weight: 20
        $x_20_3 = "$39328e3f-80ea-4d02-aafb-0ffbf7d16303" ascii //weight: 20
        $x_20_4 = "$5d174d49-6d94-4b88-a75d-8ecbaad367bd" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "Windows_Forms_Books.CCCC.resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "TaskManager.Resources.resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "Mo.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
        $x_1_15 = "DebuggableAttribute" ascii //weight: 1
        $x_1_16 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ARE_2147780602_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARE!MTB"
        threat_id = "2147780602"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0b 11 04 06 07 ?? ?? ?? ?? ?? 13 05 11 05 ?? ?? ?? ?? ?? 13 06 09 08 11 06 b4 9c 07 17 d6 0b 07 16 31 de 08 17 d6 0c 06 17 d6 0a 06}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARR_2147780603_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARR!MTB"
        threat_id = "2147780603"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 04 07 14 ?? ?? ?? ?? ?? 18 ?? ?? ?? ?? ?? 25 16 09 ?? ?? ?? ?? ?? a2 25 17 11 04 ?? ?? ?? ?? ?? a2 25 13 07 14 14 18 ?? ?? ?? ?? ?? 25 16 17 9c 25 17 17 9c 25 13 08 ?? ?? ?? ?? ?? 13 09 11 08 16 91}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASB_2147780604_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASB!MTB"
        threat_id = "2147780604"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 03 08 03 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 0d 06 09 28 ?? ?? ?? 0a 13 04 12 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0a [0-1] 08 17 d6 0c 08 07 fe 02 16 fe 01 13 05 11 05 2d}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EK_2147780653_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EK!MTB"
        threat_id = "2147780653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 07 11 05 11 07 1b 8d 01 00 00 01 13 0a 11 0a 16 72 ?? ?? ?? 70 28 07 00 00 06 a2 11 0a 17 1f 40 8c 07 00 00 01 a2 11 0a 18 11 07 17}  //weight: 1, accuracy: Low
        $x_1_2 = {11 07 6f 1c 00 00 0a 18 59 6f 1b 00 00 0a 28 06 00 00 06 a2 11 0a 19 1f 40 8c 07 00 00 01 a2 11 0a 1a 72 ?? ?? ?? 70 28 07 00 00 06 a2 11 0a 28 1d 00 00 0a 6f 1e 00 00 0a 13 05 11 05 1f 22 28 01 00 00 2b 3a 64 ff ff ff}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EK_2147780653_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EK!MTB"
        threat_id = "2147780653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 13 07 12 07 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 07 04 6f ?? ?? ?? 0a 17 da 33 03}  //weight: 10, accuracy: Low
        $x_10_2 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 07 04 6f ?? ?? ?? 0a 17 da 33 03}  //weight: 10, accuracy: Low
        $x_1_3 = "XOR_Decrypt" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EK_2147780653_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EK!MTB"
        threat_id = "2147780653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 00}  //weight: 1, accuracy: High
        $x_1_2 = "AZXCCCCCCCCCCCCCCCCCCC" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "imimimimim" ascii //weight: 1
        $x_1_11 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EZ_2147780654_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EZ!MTB"
        threat_id = "2147780654"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {03 50 09 03 50 8e 69 6a 5d b7 03 50 09 03 50 8e 69 6a 5d b7 91 07 09 07 8e 69 6a 5d b7 91 61 03 50 09 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 00 01 00 00 d6 20 00 01 00 00 5d b4 9c 09 17 6a d6 0d 09 08}  //weight: 10, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EZ_2147780654_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EZ!MTB"
        threat_id = "2147780654"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#This-world-have-many-things" ascii //weight: 1
        $x_1_2 = "#Learn-everything-by-heart" ascii //weight: 1
        $x_1_3 = "#Fuck-this-society" ascii //weight: 1
        $x_1_4 = "#Yikes-skids" ascii //weight: 1
        $x_1_5 = "#MeowtrixHaxor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EZ_2147780654_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EZ!MTB"
        threat_id = "2147780654"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 20 00 01 00 00 6f ?? ?? ?? 0a 00 06 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 20 ?? ?? ?? ?? 73 ?? ?? ?? 0a 0b 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 17 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Lo@d" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ON_2147780673_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ON!MTB"
        threat_id = "2147780673"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 09 8c [0-4] a2 25 17 11 ?? 8c [0-4] a2 14 14 28 [0-4] 25 2d ?? 26 12 ?? fe [0-5] 11 ?? 2b ?? a5 [0-4] 13 ?? 11 ?? 28 [0-4] 13 ?? 08 06 11 ?? b4 9c 11 ?? 17 d6 13 ?? 11 ?? 16 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FD_2147780709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FD!MTB"
        threat_id = "2147780709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {03 08 18 5a 58 0d 02 09 91 1e 62 02 09 17 58 91 58 13 04 11 04 05 61 13 04 07 08 11 04 d1 9d 00 08 17 58 0c 05 17 58 10 03 08 06 fe 04 13 05 11 05 2d cc}  //weight: 10, accuracy: High
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "GetBitmap" ascii //weight: 1
        $x_1_4 = "get_Key" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FD_2147780709_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FD!MTB"
        threat_id = "2147780709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://185.246.220.65/lee/Chdcespbkah.jpeg" ascii //weight: 1
        $x_1_2 = "Hooxtlmvsnf" ascii //weight: 1
        $x_1_3 = "Dnvegwwohj.Aupzikoxziowvfsknfbwizqw" ascii //weight: 1
        $x_1_4 = "Pxonqgthxbbscinuwhewjuwu" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FD_2147780709_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FD!MTB"
        threat_id = "2147780709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$fb7727bd-5cd2-49c1-9415-6207604eae31" ascii //weight: 20
        $x_20_2 = "$c8a20977-55e7-44e9-8e42-efc9bf93851a" ascii //weight: 20
        $x_20_3 = "$aa85f4f5-9661-4536-b14d-78f6cf61ba2b" ascii //weight: 20
        $x_20_4 = "$ede23425-8caa-4c50-915f-03ed51df44bf" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "Church_Projector.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "StarEggControl.My.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "Shop_Manager.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "Interface.Properties.Resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ATF_2147780742_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATF!MTB"
        threat_id = "2147780742"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {a2 25 17 07 ?? ?? ?? ?? ?? a2 14 14 ?? ?? ?? ?? ?? 25 2d 0d 26 12 07 ?? ?? ?? ?? ?? ?? 11 07 2b 05 ?? ?? ?? ?? ?? 13 05 11 05 ?? ?? ?? ?? ?? 13 06 09 08 11 06 b4 9c 07 17 d6 0b 07 16 31 a6 08 17 d6 0c 06 17 d6 0a 06}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ATH_2147780743_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATH!MTB"
        threat_id = "2147780743"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "XASXAX" ascii //weight: 1
        $x_1_2 = "ToCharArray" ascii //weight: 1
        $x_1_3 = {46 72 6f 6d 42 61 73 65 36 34 43 68 61 72 41 72 72 61 79 e2 80 8e}  //weight: 1, accuracy: High
        $x_1_4 = "GetChar" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "sssasSADASDADADss" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "SmartFormat" ascii //weight: 1
        $x_1_10 = "Flora" ascii //weight: 1
        $x_1_11 = "Invoke" ascii //weight: 1
        $x_1_12 = "OffsetMarshaler" ascii //weight: 1
        $x_1_13 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (12 of ($x*))
}

rule Trojan_MSIL_AgentTesla_FG_2147780811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FG!MTB"
        threat_id = "2147780811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "HospitalManagementSystem" ascii //weight: 10
        $x_10_2 = "XASXAX" ascii //weight: 10
        $x_1_3 = "sssasSADASDADADss" ascii //weight: 1
        $x_1_4 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "IsLogging" ascii //weight: 1
        $x_1_7 = "get_IsAlive" ascii //weight: 1
        $x_1_8 = "Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FG_2147780811_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FG!MTB"
        threat_id = "2147780811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "Low"
    strings:
        $x_20_1 = {49 4d 47 5f [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_20_2 = {43 6f 6e 73 6f 6c 65 41 70 70 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_20_3 = {43 6c 61 73 73 4c 69 62 72 61 72 79 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_20_4 = {4f 72 64 65 72 [0-15] 2e 67 2e 72 65 73 6f 75 72 63 65 73}  //weight: 20, accuracy: Low
        $x_1_5 = "Suresh Dasari" ascii //weight: 1
        $x_1_6 = "get_CurrentDomain" ascii //weight: 1
        $x_1_7 = {24 24 6d 65 74 68 6f 64 30 78 36 30 30 30 33 [0-15] 2d 31}  //weight: 1, accuracy: Low
        $x_1_8 = "BeginInvoke" ascii //weight: 1
        $x_1_9 = "ResolveMethod" ascii //weight: 1
        $x_1_10 = "get_Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FH_2147780812_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FH!MTB"
        threat_id = "2147780812"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$44127038-1f3b-4b7a-93b4-5214a3b39124" ascii //weight: 20
        $x_20_2 = "$386cbf96-71c6-4f54-a544-8af7110f8198" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "Jamils_Good_Old_Fun_Family_Center.My.Resources" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "Car_Server.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FI_2147780814_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FI!MTB"
        threat_id = "2147780814"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {06 17 58 0a 06 20 00 01 00 00 5d 0a 08 11 06 06 94 58 0c 08 20 00 01 00 00 5d 0c 11 06 06 94 13 04 11 06 06 11 06 08 94 9e 11 06 08 11 04 9e 11 06 11 06 06 94 11 06 08 94 58 20 00 01 00 00 5d 94 0d 11 07 07 02 07 91 09 61 d2 9c 00 07 17 58 0b 07 02 8e 69 fe 04 13 0a 11 0a 2d a2}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FI_2147780814_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FI!MTB"
        threat_id = "2147780814"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "ipaddress/api/admin/configuration/v1/conference/1/" ascii //weight: 1
        $x_1_2 = ".Newtonsoft.Json.dll" ascii //weight: 1
        $x_1_3 = "www.google.com" ascii //weight: 1
        $x_1_4 = "App1.Properties" ascii //weight: 1
        $x_1_5 = {41 70 70 31 2e 52 65 73 6f 75 72 63 65 73 2e [0-25] 2e 64 6c 6c}  //weight: 1, accuracy: Low
        $x_1_6 = "HttpWebRequest" ascii //weight: 1
        $x_1_7 = "get_CurrentDomain" ascii //weight: 1
        $x_1_8 = "admin123" ascii //weight: 1
        $x_1_9 = "ReadToEnd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQI_2147780829_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQI!MTB"
        threat_id = "2147780829"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 11 03 16 11 04 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? 11 01 6f ?? ?? ?? 0a 13 05 ?? ?? ?? ?? ?? 11 02 11 03 16 11 03 8e 69 ?? ?? ?? ?? ?? 13 04 ?? ?? ?? ?? ?? 11 04 11 03 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = {43 6f 6e 76 65 72 74 6f 72 00 42 79 74 65}  //weight: 1, accuracy: High
        $x_1_3 = "ClassLibrary.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASG_2147780830_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASG!MTB"
        threat_id = "2147780830"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0d 2b 3d 02 09 08 ?? ?? ?? ?? ?? 25 26 13 04 06 12 04 ?? ?? ?? ?? ?? 25 26 ?? ?? ?? ?? ?? 06 12 04 ?? ?? ?? ?? ?? 25 26 ?? ?? ?? ?? ?? 06 12 04 ?? ?? ?? ?? ?? 25 26 ?? ?? ?? ?? ?? 09 17 d6 0d 09 02 ?? ?? ?? ?? ?? 25 26 32}  //weight: 1, accuracy: Low
        $x_1_2 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZQ_2147780831_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZQ!MTB"
        threat_id = "2147780831"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0d 09 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 09 6f ?? ?? ?? 0a 00 73 ?? ?? ?? 0a 13 04 11 04 06 6f ?? ?? ?? 0a 00 11 04 04 6f ?? ?? ?? 0a 00 11 04 05 6f ?? ?? ?? 0a 00 11 04 6f ?? ?? ?? 0a 02 16 02 8e b7 6f ?? ?? ?? 0a 0b 11 04 6f ?? ?? ?? 0a 00 07 0c}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ATU_2147780832_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATU!MTB"
        threat_id = "2147780832"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "XASXAX" ascii //weight: 1
        $x_1_2 = {70 72 6f 6a 00 6b 65 79}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "GetChar" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "sssasSADASDADADss" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "OffsetMarshaler" ascii //weight: 1
        $x_1_10 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUB_2147780833_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUB!MTB"
        threat_id = "2147780833"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 09 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 13 04 11 04 07 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? 11 04 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 13 05 ?? ?? ?? ?? ?? 07 6f ?? ?? ?? 0a dc ?? ?? ?? ?? ?? 09 6f ?? ?? ?? 0a dc}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary1.dll" ascii //weight: 1
        $x_1_3 = "Newtonsoft.Json.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AUE_2147780834_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUE!MTB"
        threat_id = "2147780834"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 06 16 06 8e 69 6f ?? ?? ?? 0a 0b 07 2c 09 09 06 16 07 6f ?? ?? ?? 0a 07 06 8e 69 2e}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Hebrew" ascii //weight: 1
        $x_1_2 = "Parsing.Cust" ascii //weight: 1
        $x_1_3 = "$0981cf86-0191-4e55-8dcc-57827cd752e8" ascii //weight: 1
        $x_1_4 = {57 15 a2 09 09 1f 00 00 00 fa 01 33 00 16 00 00}  //weight: 1, accuracy: High
        $x_1_5 = "Bitmap" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 14 14 17 8d ?? ?? ?? 01 25 16 06 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 14 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 07 a2 25 0c 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 0d 28 ?? ?? ?? 0a 09 16 91 2c ?? 08}  //weight: 1, accuracy: Low
        $x_1_2 = "mailto:luungoc2005@yahoo.com" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 02 07 72 ?? ?? ?? 70 28 ?? ?? ?? 06 0c 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 08 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0d 28 ?? ?? ?? 0a 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 09 a2 25 13 ?? 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 ?? 28 ?? ?? ?? 0a 11 ?? 16 91 2d ?? 2b ?? 11 ?? 16 9a 28 ?? ?? ?? 0a 0d 74 ?? ?? ?? 01 0a 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VirtualProtect" ascii //weight: 1
        $x_1_2 = "kernel32.dll" ascii //weight: 1
        $x_1_3 = "get_ResourceManager" ascii //weight: 1
        $x_1_4 = "set_PasswordChar" ascii //weight: 1
        $x_1_5 = "set_Connection" ascii //weight: 1
        $x_1_6 = "ResumeLayout" ascii //weight: 1
        $x_1_7 = "myapp.exe" ascii //weight: 1
        $x_1_8 = {57 d5 a2 fd 09 1f 00 00 00 fa 25 33 00 16 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 93 0d 06 07 06 08 93 9d 06 08 09 9d 00 07 17 d6 0b 08 17 da 0c 07 08 fe ?? 13 ?? 11 ?? 2d}  //weight: 1, accuracy: Low
        $x_1_2 = {06 0a 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 28 ?? ?? ?? 06 00 72 ?? ?? ?? 70 0c 2b ?? 08 2a}  //weight: 1, accuracy: Low
        $x_1_3 = {70 0c 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 6f ?? ?? ?? 0a 16 02 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "file:///" ascii //weight: 1
        $x_1_2 = "$647615f3-870d-45da-89d9-bd06637267df" ascii //weight: 1
        $x_1_3 = "GetTempPath" ascii //weight: 1
        $x_1_4 = "CryptoConfig" ascii //weight: 1
        $x_1_5 = {57 bf b6 2b 09 0f 00 00 00 00 00 00 00 00 00 00}  //weight: 1, accuracy: High
        $x_1_6 = "Invoke" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
        $x_1_8 = "LoadFromOutlookCsv" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 ?? 07 11 ?? 6f ?? ?? ?? 0a 26 08 04 6f ?? ?? ?? 0a 17 da fe ?? 13 ?? 11 ?? 2c ?? 16 0c 2b ?? 00 08 17 d6 0c 11 ?? 18 d6 13 ?? 11 ?? 09 31}  //weight: 1, accuracy: Low
        $x_1_2 = {25 16 02 06 72 ?? ?? ?? 70 28 ?? ?? ?? 06 28 ?? ?? ?? 0a a2 14 14 14 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0b 02 07 28 ?? ?? ?? 06 26 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "wBFJERBcd29sYM7Gw4qGk9tgFLMit0ME" ascii //weight: 1
        $x_1_2 = "9fSKkjS40ejTN5FSW0Lh+NUKhMRkCjed" ascii //weight: 1
        $x_1_3 = {70 0c 07 20 ?? ?? ?? 00 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 13 ?? 20 ?? ?? ?? 00 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 ?? 16 11 ?? 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 08 13 ?? 2b ?? 11 ?? 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$4B6CB794-F881-4002-9C4E-6156E3C39FEA" ascii //weight: 1
        $x_1_2 = {57 1f a2 0b 09 1f 00 00 00 fa 01 33 00 16 00 00}  //weight: 1, accuracy: High
        $x_1_3 = "path_db" ascii //weight: 1
        $x_1_4 = "SignIn_Load" ascii //weight: 1
        $x_1_5 = "CompressionMode" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "BitConverter" ascii //weight: 1
        $x_1_8 = "Garrix.Explorer1" ascii //weight: 1
        $x_1_9 = "JetBrain" ascii //weight: 1
        $x_1_10 = "password" ascii //weight: 1
        $x_1_11 = "Jeu_Echec\\bin\\Debug" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_9
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 17 a2 09 09 01 00 00 00 fa 25 33 00 16 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "WriteByte" ascii //weight: 1
        $x_1_5 = "Save" ascii //weight: 1
        $x_1_6 = "ToString" ascii //weight: 1
        $x_1_7 = "BufferedStream" ascii //weight: 1
        $x_1_8 = "MemoryStream" ascii //weight: 1
        $x_1_9 = "WebHeaderCollection" ascii //weight: 1
        $x_1_10 = "WebClient" ascii //weight: 1
        $x_1_11 = "Regex" ascii //weight: 1
        $x_1_12 = "get_Assembly" ascii //weight: 1
        $x_1_13 = "DownloadString" ascii //weight: 1
        $x_1_14 = "System.Net" ascii //weight: 1
        $x_1_15 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_10
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 00 02 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 00}  //weight: 1, accuracy: Low
        $x_1_2 = {01 0c 00 73 ?? ?? ?? 0a 0d 00 07 08 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 13 ?? 11 ?? 16 fe ?? 13 ?? 11 ?? 2c ?? 09 08 16 11 ?? 6f ?? ?? ?? 0a 00 00 00 00 11 ?? 16 fe ?? 13 ?? 11 ?? 2d ?? 09 6f ?? ?? ?? 0a 0a de ?? 00 09 2c ?? 09 6f ?? ?? ?? 0a 00 dc 00 07 2c ?? 07 6f ?? ?? ?? 0a 00 dc 06}  //weight: 1, accuracy: Low
        $x_1_3 = "H4sIAAAAAAAEAOx9d3hbVdL3XEmWuxPHie1U26Qp" ascii //weight: 1
        $x_1_4 = "C5pg23iQOmj+suU2+tKpd7Hl2X7dAfMwKdg" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_11
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {a2 06 18 72 ?? ?? ?? 70 a2 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0b 07 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0c 08 28 ?? ?? ?? 06 0d 09 28 ?? ?? ?? 0a 13 ?? 11 ?? 6f ?? ?? ?? 0a 16 9a 13 ?? 11 ?? 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 14 14 28 ?? ?? ?? 0a 13 ?? 11}  //weight: 10, accuracy: Low
        $x_1_2 = "HttpWebResponse" ascii //weight: 1
        $x_1_3 = "generateRandom" ascii //weight: 1
        $x_1_4 = "ImageLoadProgressForm" ascii //weight: 1
        $x_1_5 = "ENCRYPT" ascii //weight: 1
        $x_1_6 = "Floyd-Steinberg" ascii //weight: 1
        $x_1_7 = "$a236408f-d04c-4514-8bde-bf41cc7247f1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_12
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 07 08 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 13 ?? 11 ?? 16 fe ?? 13 ?? 11 ?? 39 ?? ?? ?? 00 09 14 72 ?? ?? ?? 70 19 8d ?? ?? ?? 01 25 16 08 a2 25 17 16 8c ?? ?? ?? 01 a2 25 18 11 ?? 8c ?? ?? ?? 01 a2 25 13 ?? 14 14 19 8d}  //weight: 1, accuracy: Low
        $x_1_2 = {01 25 16 17 9c 25 18 17 9c 25 13 ?? 17 28 ?? ?? ?? 0a 26 11 ?? 16 91 2d ?? 2b ?? 11 ?? 16 9a 28 ?? ?? ?? 0a d0 ?? ?? ?? 1b 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 74 ?? ?? ?? 1b 0c 11 ?? 18 91 2d ?? 2b ?? 11}  //weight: 1, accuracy: Low
        $x_1_3 = {10 01 02 03 6f ?? ?? ?? 0a 16 03 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_4 = "GetFileNameByURL" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_13
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "QdmSk54FX" ascii //weight: 1
        $x_1_2 = "M619D1Z" ascii //weight: 1
        $x_1_3 = "zyb13jaCATiY7heFScJ" ascii //weight: 1
        $x_1_4 = "q7vcpTBV1pkik659QJId0Y0Sa7O1HWx3OS8obirYa" ascii //weight: 1
        $x_1_5 = "Lbj08DaM5RuPiiBQG5knUIUPul" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "SqlCommand" ascii //weight: 1
        $x_1_8 = "txt_password" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_11 = "HashAlgorithm" ascii //weight: 1
        $x_1_12 = "ResumeLayout" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_14
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Difgr" ascii //weight: 1
        $x_1_2 = "$EBBD35FE-D05A-444C-A764-796334568FBF" ascii //weight: 1
        $x_1_3 = {57 3f b6 1f 09 1f 00 00 00 fa 01 33 00 16 00 00}  //weight: 1, accuracy: High
        $x_1_4 = "GetPixel" ascii //weight: 1
        $x_1_5 = "Hebrew" ascii //weight: 1
        $x_1_6 = "GetEntryAssembly" ascii //weight: 1
        $x_1_7 = "calcOnly" ascii //weight: 1
        $x_1_8 = "RemoveWindowFromHistory" ascii //weight: 1
        $x_1_9 = "AddWindowToHistory" ascii //weight: 1
        $x_1_10 = "ISectionEntry" ascii //weight: 1
        $x_1_11 = "ContainsKey" ascii //weight: 1
        $x_1_12 = "RemoveByKey" ascii //weight: 1
        $x_1_13 = "get_Assembly" ascii //weight: 1
        $x_1_14 = "ResumeLayout" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_15
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 17 a2 0b 09 1f 00 00 00 fa 01 33 00 16 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "$84a722b1-8c42-45f3-a33c-fdd16dd3788f" ascii //weight: 1
        $x_1_3 = "get_KeyCode" ascii //weight: 1
        $x_1_4 = "ContainsKey" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "LateGet" ascii //weight: 1
        $x_1_7 = "get_Assembly" ascii //weight: 1
        $x_1_8 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_9 = "ResumeLayout" ascii //weight: 1
        $x_1_10 = "get_RSS_PATH_DB" ascii //weight: 1
        $x_1_11 = "set_RSS_PATH_DB" ascii //weight: 1
        $x_1_12 = "GetResourceString" ascii //weight: 1
        $x_1_13 = "get_Connection" ascii //weight: 1
        $x_1_14 = "bd1ConnectionString" ascii //weight: 1
        $x_1_15 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_16
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "54"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MemoryStream" ascii //weight: 1
        $x_1_2 = "BlockCopy" ascii //weight: 1
        $x_1_3 = "ContainsKey" ascii //weight: 1
        $x_1_4 = "GetHashCode" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "_password" ascii //weight: 1
        $x_1_7 = "SuspendLayout" ascii //weight: 1
        $x_1_8 = "Substring" ascii //weight: 1
        $x_1_9 = "VirtualProtect" ascii //weight: 1
        $x_5_10 = "IDispatch" ascii //weight: 5
        $x_5_11 = "cDisplayClass40" ascii //weight: 5
        $x_5_12 = "SiteString" ascii //weight: 5
        $x_5_13 = "IEntryPointEntry" ascii //weight: 5
        $x_5_14 = "Nullable" ascii //weight: 5
        $x_5_15 = "WaitOrTimerCallback" ascii //weight: 5
        $x_5_16 = "EmptyArray" ascii //weight: 5
        $x_40_17 = {d7 9d a2 3d 09 1f 00 00 00 fa 25 33 00 16 00 00}  //weight: 40, accuracy: High
        $x_40_18 = {57 dd a2 fd 09 1f 00 00 00 fa 25 33 00 16 00 00}  //weight: 40, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_40_*) and 1 of ($x_5_*) and 9 of ($x_1_*))) or
            ((1 of ($x_40_*) and 2 of ($x_5_*) and 4 of ($x_1_*))) or
            ((1 of ($x_40_*) and 3 of ($x_5_*))) or
            ((2 of ($x_40_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_17
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "68"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$f8435256-8e11-46fe-a675-52fe01f290f2" ascii //weight: 10
        $x_10_2 = "$ad3b9318-40dd-4618-ae5e-b66b0a47afa6" ascii //weight: 10
        $x_10_3 = "$3339d760-68c6-4689-b013-9b76eb80759b" ascii //weight: 10
        $x_50_4 = {57 3f a2 1f 09 1f 00 00 00 7a a4 13 00 16 00 00}  //weight: 50, accuracy: High
        $x_50_5 = {57 1f a2 0b 09 1f 00 00 00 5a a4 03 00 16 00 00}  //weight: 50, accuracy: High
        $x_50_6 = {57 fd a2 fd 09 1f 00 00 00 fa 25 33 00 16 00 00}  //weight: 50, accuracy: High
        $x_1_7 = "Marshal" ascii //weight: 1
        $x_1_8 = "MemoryStream" ascii //weight: 1
        $x_1_9 = "ContainsKey" ascii //weight: 1
        $x_1_10 = "Utils" ascii //weight: 1
        $x_1_11 = "get_Assembly" ascii //weight: 1
        $x_1_12 = "ResumeLayout" ascii //weight: 1
        $x_1_13 = "StartsWith" ascii //weight: 1
        $x_1_14 = "WriteAllBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_50_*) and 1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((1 of ($x_50_*) and 2 of ($x_10_*))) or
            ((2 of ($x_50_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_18
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "escPressed" ascii //weight: 1
        $x_1_2 = "leftPressed" ascii //weight: 1
        $x_1_3 = "rightPressed" ascii //weight: 1
        $x_1_4 = "spacePressed" ascii //weight: 1
        $x_1_5 = "add_upPressed" ascii //weight: 1
        $x_1_6 = "remove_upPressed" ascii //weight: 1
        $x_1_7 = "add_downPressed" ascii //weight: 1
        $x_1_8 = "remove_downPressed" ascii //weight: 1
        $x_1_9 = "add_enterPressed" ascii //weight: 1
        $x_1_10 = "remove_enterPressed" ascii //weight: 1
        $x_1_11 = "add_escPressed" ascii //weight: 1
        $x_1_12 = "set_Culture" ascii //weight: 1
        $x_1_13 = "FromBase64String" ascii //weight: 1
        $x_1_14 = "get_Assembly" ascii //weight: 1
        $x_1_15 = "Invoke" ascii //weight: 1
        $x_1_16 = "MemoryStream" ascii //weight: 1
        $x_20_17 = "$3a9edc16-8410-422d-8427-393e71077b7d" ascii //weight: 20
    condition:
        (filesize < 20MB) and
        (
            ((16 of ($x_1_*))) or
            ((1 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_19
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "75"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_2 = "AesManaged" ascii //weight: 1
        $x_1_3 = "HashAlgorithm" ascii //weight: 1
        $x_1_4 = "ComputeHash" ascii //weight: 1
        $x_1_5 = "SymmetricAlgorithm" ascii //weight: 1
        $x_6_6 = "xpdgROUX5L2bOq8cDm" ascii //weight: 6
        $x_6_7 = "XPGe9oYhkntcICk5bIe" ascii //weight: 6
        $x_6_8 = "nwUcqpY6AsSR1pitKh8" ascii //weight: 6
        $x_6_9 = "MZRqwpYCe9sPTPwYjjX" ascii //weight: 6
        $x_6_10 = "QRqWkbpYtDPkoRjKT9" ascii //weight: 6
        $x_20_11 = {57 95 a2 29 09 1f 00 00 00 00 00 00 00 00 00 00}  //weight: 20, accuracy: High
        $x_50_12 = "$08d193a3-f16f-4cd9-892c-98cfdb122829" ascii //weight: 50
        $x_50_13 = "$14915d73-c484-4459-a266-31b84c221ab4" ascii //weight: 50
        $x_50_14 = "$c4f09678-d1fe-4bd6-b52e-d26a2dc15efa" ascii //weight: 50
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_50_*) and 4 of ($x_6_*) and 1 of ($x_1_*))) or
            ((1 of ($x_50_*) and 5 of ($x_6_*))) or
            ((1 of ($x_50_*) and 1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((1 of ($x_50_*) and 1 of ($x_20_*) and 1 of ($x_6_*))) or
            ((2 of ($x_50_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_20
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "74"
        strings_accuracy = "High"
    strings:
        $x_50_1 = "9fSKkjS40ejTN5FSW0Lh+NUKhMRkCjed/" ascii //weight: 50
        $x_50_2 = "QpEyERKM619D1ZKRmjXc5D" ascii //weight: 50
        $x_50_3 = "QpEyERKM619D1ZKRmjXc5DlSITEpwoX3PUnpEZOexlPUKhMRkCjed" ascii //weight: 50
        $x_20_4 = "K8lnT8Bgj7Honj9FeoJx3m09qQQKpOks" ascii //weight: 20
        $x_20_5 = "ETperwPlnuFWCIwbP3ssqnwuPB9AG" ascii //weight: 20
        $x_20_6 = "4ZQfMYSEoZGVOUmnr9J5YbTMNUVyYtL" ascii //weight: 20
        $x_20_7 = "KF7M4HCRbatV5DMGWjfSi" ascii //weight: 20
        $x_20_8 = "RaDyfhd3YZT0o5ixj1WXXhA2IGot2lHXCl" ascii //weight: 20
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "set_Key" ascii //weight: 1
        $x_1_11 = "System.Security.Cryptography" ascii //weight: 1
        $x_1_12 = "get_Assembly" ascii //weight: 1
        $x_1_13 = "ResumeLayout" ascii //weight: 1
        $x_1_14 = "ComputeHash" ascii //weight: 1
        $x_1_15 = "Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_20_*))) or
            ((1 of ($x_50_*) and 1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((1 of ($x_50_*) and 2 of ($x_20_*))) or
            ((2 of ($x_50_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_21
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Difgr" ascii //weight: 1
        $x_1_2 = {f3 fa e7 b5 90 e7 3f 5c f5 1d 7c fd 0d ee cb 12 7e c6 78 7e 9b 05 5f 61 c1 1f bd d5 e1 fe c0 82 37 5f f0 79 0b de 67 01 1b df 60 c1 c7 16 ee 3b 2e f8 41}  //weight: 1, accuracy: High
        $x_1_3 = {0b 7e f0 82 1f b3 e0 bd 17 fc a8 05 3f 7a c1 8f 5c f0 03 6f f5 ef bd e0 87 2f d0 fe 7d 6f cf 3f e2 06 e8 7e ec 02 6d df 67 c1 f7 bf d5 f1 fd b8 05 68 3c}  //weight: 1, accuracy: High
        $x_1_4 = {eb 23 f5 6f bc e0 db 2e f8 0e b7 67 b2 c9 f9 7e 0b f0 7f f5 05 6f 7d 83 b7 58 f0 be 0b da de 09 df 6e c1 37 a9 67 36 b2 35 79 f0 56 0b 3e 7c c1 df 5b f0}  //weight: 1, accuracy: High
        $x_1_5 = {8b 6e b8 2b f8 a2 5b f9 86 0b f8 e9 2d 17 90 a7 9f d0 7c d3 aa 83 37 19 cf 0d ec 61 5b e3 d8 dd cf 33 a6 81 b7 bb 95 93 9e 6e a9 cf fc 9e 70 af 1d fc c9}  //weight: 1, accuracy: High
        $x_1_6 = {f1 dc f2 27 c4 af c6 c5 cf bd d5 41 74 9d f5 1d 6e d7 1e b8 6a db c1 17 2e 90 97 79 96 57 dd 0e da bf bf 7d c1 9c 23 5e 2d fc 86 aa cb b7 6e fb ff 01 3a}  //weight: 1, accuracy: High
        $x_1_7 = {ff de ac ea 8f 00 fa e6 ff e6 55 7f 04 8c 1f 73 8c b9 e1 27 de ea dd fe 21 0b cc 29 8d 9b e3 65 8e d7 ab fc be 07 2d fb 13 17 d0 cf 7c 67 0e 55 76 2e 82}  //weight: 1, accuracy: High
        $x_1_8 = {5d be cd f1 3e c7 e8 53 7d d4 d0 eb 95 7a f4 e3 bf 1f b6 c0 5c db 3a ee f2 b5 f3 19 4c 7f 99 63 fb f9 29 d0 fa 7d c3 aa bf 28 98 2f e6 fc da 30 7d 19 5b}  //weight: 1, accuracy: High
        $x_1_9 = {5e b9 95 e2 f3 01 b7 3a f8 e0 05 1f 59 cf f7 e6 8a 7f b7 e0 fd eb f9 de 7e e2 f5 0d ac 5d 1f b8 e0 bd 16 f0 0d 5b be dc 82 b4 5b 83 b5 7f e5 db 73 68 de}  //weight: 1, accuracy: High
        $x_1_10 = {f5 f6 1c 1a 25 ba bf ba c0 58 78 b7 1b 2e ed 72 de 3a 1a 9c 9c 47 f7 ee 85 0b 5d e7 5b e8 be 7c e1 42 d7 b1 09 dd 7b 14 2e 74 3d be 42 f7 9e 85 0b 5d 72}  //weight: 1, accuracy: High
        $x_1_11 = {22 74 ec b1 b7 f4 ac af 2f 59 f0 2e 0b 7a bd a7 97 31 f5 7e 85 23 af 79 de 79 c1 e4 d9 f9 34 cf 20 32 66 6c be ca 82 a6 d1 fe 15 17 68 d7 1f 5d 3a 1f 77 34 da}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_22
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e8 ff ff f7 ff fd 6b fc 1a 7f d7 af 21 cf ef a9 3f 37 3d 7f 10 fd ff 37 f9 5d fe 9e df e4 d7 f8 db 7e ec 9f ff 5d ff ae 5f f3 f9 3f ff bb be 99 17 4d ba aa ab 8b 3a 5b a4 d3 6c b9 ac da 74 92 a7 f5 7a 99 16 cb f4 e9 97 af d3 45 35 cb c7 bf f1 6f 9c fc 6e 0a e3 e5 e9 af f1 6b 3c ff 35 7f 9d 5f e3 5f f9 5f ff b3 bf c6 c0 fd 8f 7e 8d df e4 77 fd 0d 7f cd 5f ef d7 f8 35 fe a9 5f f3 d7 f8 35 12 f9 ec c5 7f 41 bf a7 f8 ed d7 fa 35 18 bb 54 7e 05 de 78 cc cf 5f e3 0f 70 1f fe da bf c6 ef f9 87 ff 1a bf c6 6f c6 ff 73 3f ed 0f 79 08 ee ef 85 9f e9 af f5 6b b4 bf b6 f9 d0 7b 7e cf 5f eb d7 f8 8d 22 1f df f8 a4 bf c6 af f1 1b 78 7f fe 06 f4 f7 b7 bd bf c7 6d fe ae a5 9f 6f fe 09 1d 17 c6 6a 07 21 0f 7d fc 07 8c 9b 59 d6 66 bf c6 af f1 5f 61 d8 66 c0}  //weight: 1, accuracy: High
        $x_1_2 = {ff dc af 19 b4 fb 3d 7f 8d 5f e3 1f 1a d7 4d 3d a5 df 79 0c a9 b6 fb 97 7a ed 7e cf 71 9d 97 15 35 e4 31 d1 d8 98 9c ff 5a af dd 93 e0 83 1f 3d ff bf 7d 76 fe 0b 99 fb 6f ff 1a 60 85 5f f7 d7 f8 bb fe 05 fa e5 4f fe 35 58 27 e0 f9 bb 7e ff 5f f3 d7 f8 3d ff 88 81 97 23 cf ab 4f 7e ad 5f f8 db e0 ff 5b c4 58 bf de af b5 45 70 7e bd 6f d1 e7 63 7c f6 6b 6c fd 1b bf 26 fd f9 08 bf ff 5f 3f f6 6b fc 1a 5b bf 31 c9 f7 b7 7e 8d df 01 7f ff b6 fa f3 b7 f9 d6 af f1 53 16 c6 af 4f 6f ff 1a bf d6 d6 6f 02 35 f0 ad 00 46 f7 9d df 72 e7 d7 fe 35 fe 69 ea 87 46 f3 9b 9b d7 53 0c e2 b7 7d f4 9c fe fd 85 5b bf 19 81 fa 6d b6 7e 73 fa f7 e1 2f c6 07 29 04 e4 60 87 fe 69 7e 53 02 ff 07 fd ba 24 32 e9 af 8f cf 7e 27 7c f6 9b e1 33 88 d1 c1 ef 4d 7f 32 a4 ff 8b d0}  //weight: 1, accuracy: High
        $x_1_3 = {f8 bf 48 6e 4e 7f 03 fa e3 af fd bf ff ef ff 1b 32 f4 db d0 ff ff 24 fd fd 1f a4 9f bf 90 7e 3e c5 1b bf 1e be 7c f8 2f e1 a3 e6 37 07 30 c8 f7 c1 5f 86 bf d3 5f 17 dd fc ed f4 6b f3 5b e0 1b 02 fe eb 34 bf 25 7e fb 75 80}  //weight: 1, accuracy: High
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "CompressionMode" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "PixelFormat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MFP_2147781042_23
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MFP!MTB"
        threat_id = "2147781042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "41"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$a5e60e2a-c126-4b96-8a9d-544b07fea7af" ascii //weight: 10
        $x_10_2 = "$9caefde7-e6ff-491d-9230-d91692ab53e3" ascii //weight: 10
        $x_10_3 = "$9f97c38c-23a0-4f5a-9f4e-8aafe1be662b" ascii //weight: 10
        $x_10_4 = "$cc59e983-36ec-4923-8b9f-9248683f34f1" ascii //weight: 10
        $x_10_5 = "$6df1ffb1-a8ae-48d4-86fe-bb187b2e9191" ascii //weight: 10
        $x_10_6 = "$2c76b234-32a4-4382-8c86-049c9a70e2e3" ascii //weight: 10
        $x_10_7 = "$3c61b32f-6fc7-4b7d-86c3-d0132b98ad48" ascii //weight: 10
        $x_10_8 = "$f2eaee70-e2f4-4cdd-9504-2a684d74faed" ascii //weight: 10
        $x_10_9 = "$87d4a818-b098-4d5a-874c-c7de277a0ba1" ascii //weight: 10
        $x_10_10 = "$31092a40-11b0-4e3e-9afa-bdb740641cbd" ascii //weight: 10
        $x_10_11 = "$0e8c2b40-e4f2-41a6-bb6a-5981b36e17a1" ascii //weight: 10
        $x_10_12 = "$a2b6a3d2-8ba6-4048-9395-2ca6cc340128" ascii //weight: 10
        $x_10_13 = "$54b91af3-92cd-47b1-b9b5-0b48aeddb34c" ascii //weight: 10
        $x_10_14 = "$75b5bb89-7934-44a7-8ede-beecfa74cdad" ascii //weight: 10
        $x_10_15 = "$7b2431e7-f5e7-4707-b809-12e42a854eee" ascii //weight: 10
        $x_3_16 = {57 15 a2 2b 09 01 00 00 00 10 00 23 00 00 00}  //weight: 3, accuracy: High
        $x_2_17 = "ResumeLayout" ascii //weight: 2
        $x_2_18 = "CopyTo" ascii //weight: 2
        $x_2_19 = "MemoryStream" ascii //weight: 2
        $x_2_20 = "GetExecutingAssembly" ascii //weight: 2
        $x_2_21 = "RijndaelManaged" ascii //weight: 2
        $x_2_22 = "Rfc2898DeriveBytes" ascii //weight: 2
        $x_2_23 = "SymmetricAlgorithm" ascii //weight: 2
        $x_2_24 = "Nullable" ascii //weight: 2
        $x_2_25 = "System.Threading" ascii //weight: 2
        $x_2_26 = "CreateDecryptor" ascii //weight: 2
        $x_2_27 = "set_KeySize" ascii //weight: 2
        $x_2_28 = "set_BlockSize" ascii //weight: 2
        $x_2_29 = "Encoding" ascii //weight: 2
        $x_2_30 = "System.Text" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_3_*) and 14 of ($x_2_*))) or
            ((2 of ($x_10_*) and 11 of ($x_2_*))) or
            ((2 of ($x_10_*) and 1 of ($x_3_*) and 9 of ($x_2_*))) or
            ((3 of ($x_10_*) and 6 of ($x_2_*))) or
            ((3 of ($x_10_*) and 1 of ($x_3_*) and 4 of ($x_2_*))) or
            ((4 of ($x_10_*) and 1 of ($x_2_*))) or
            ((4 of ($x_10_*) and 1 of ($x_3_*))) or
            ((5 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AUN_2147781048_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUN!MTB"
        threat_id = "2147781048"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 14 14 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0c 08 14 02 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 17 ?? ?? ?? ?? ?? 25 16 02 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? a2 14 14 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 0d 09 ?? ?? ?? ?? ?? 14 ?? ?? ?? ?? ?? 17 ?? ?? ?? ?? ?? 25 16 ?? ?? ?? ?? ?? a2 14 14}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "IDM.IUelpmiS" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUV_2147781049_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUV!MTB"
        threat_id = "2147781049"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "epyTteG" ascii //weight: 1
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "IDM.IUelpmiS" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ToWin32" ascii //weight: 1
        $x_1_8 = "ResourceManager" ascii //weight: 1
        $x_1_9 = "SelectorX" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUX_2147781050_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUX!MTB"
        threat_id = "2147781050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 17 d6 0d 17 0a ?? ?? ?? ?? ?? 07 17 d6 0b 1d 0a 2b ?? 02 11 ?? ?? ?? ?? ?? ?? 26 1e 0a 2b ?? 11 ?? ?? ?? ?? ?? ?? 13 ?? 1c 0a 2b ?? 08 17 d6 0c 1b 0a 2b ?? 08 16 fe 02 16 fe 01 13 ?? 11 ?? 2c}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUX_2147781050_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUX!MTB"
        threat_id = "2147781050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SmartExtensions" ascii //weight: 1
        $x_1_2 = {46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 e2 80 8e}  //weight: 1, accuracy: High
        $x_1_3 = "GetChar" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = {0d 59 0d 59 36 52 0d 59 0d 59 36 52 0d 59 0d 59}  //weight: 1, accuracy: High
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "SmartFormat" ascii //weight: 1
        $x_1_9 = "Flora" ascii //weight: 1
        $x_1_10 = "Invoke" ascii //weight: 1
        $x_1_11 = "OffsetMarshaler" ascii //weight: 1
        $x_1_12 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (10 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUO_2147781051_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUO!MTB"
        threat_id = "2147781051"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 08 07 6f ?? ?? ?? 0a 13 ?? 06 12 ?? 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 12 ?? 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 12 ?? 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 08 17 d6 0c 08 02 6f ?? ?? ?? 0a 32 ?? 07 17 d6 0b 07 02}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVA_2147781052_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVA!MTB"
        threat_id = "2147781052"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 35 2b 3a 2b 3f 00 2b 0b 2b 0c ?? ?? ?? ?? ?? 00 00 de 14 08 2b f2 07 2b f1 08 2c 0a 16 2d 06 08 ?? ?? ?? ?? ?? 00 dc 07 ?? ?? ?? ?? ?? 0d 16 2d cb de 30 06 2b c8 ?? ?? ?? ?? ?? 2b c4 ?? ?? ?? ?? ?? 2b bf 0c 2b be}  //weight: 10, accuracy: Low
        $x_1_2 = "Newtonsoft.Json.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVB_2147781053_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVB!MTB"
        threat_id = "2147781053"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 03 08 03 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 0d 06 09 d1 13 ?? 12 ?? 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a [0-2] 08 17 d6 0c 08 07 fe 02 16 fe 01 13 05 11 05 2d}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVF_2147781054_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVF!MTB"
        threat_id = "2147781054"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 17 d6 0b 17 ?? ?? ?? ?? ?? ?? ?? 00 11 ?? 17 d6 13 ?? 1d 13 ?? 2b ?? 00 02 09 28 ?? ?? ?? 06 26 1e 13 ?? 2b ?? 00 11 ?? 28 ?? ?? ?? 0a 0a 1c 13 ?? 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVH_2147781187_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVH!MTB"
        threat_id = "2147781187"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {26 16 00 28 ?? ?? ?? 0a 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 03 a2 25 13 ?? 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = "SimpleUI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OO_2147781257_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OO!MTB"
        threat_id = "2147781257"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 09 1f 54 61 13 ?? 11 ?? 1f ?? 58 45 [0-24] 1f ?? 28 ?? ?? ?? ?? 13 ?? 2b ?? 16 0a 1f ?? 28 ?? ?? ?? ?? 13 ?? 2b ?? 20 ?? ?? ?? ?? 8d ?? ?? ?? ?? 0c 15 13 ?? 2b ?? d0 ?? ?? ?? ?? 26 1f ?? 13 ?? 2b ?? 28 ?? ?? ?? ?? 0b 1f ?? 13 ?? 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OP_2147781258_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OP!MTB"
        threat_id = "2147781258"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ISectionEntry" ascii //weight: 1
        $x_1_2 = "MessageSurrogateFilter" ascii //weight: 1
        $x_1_3 = "Create__Instance__" ascii //weight: 1
        $x_1_4 = "MySettings" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "ToWin32" ascii //weight: 1
        $x_1_7 = "GetDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FJ_2147781293_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FJ!MTB"
        threat_id = "2147781293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$fb7cce03-14df-4c2a-adc7-e6cf4ed06aa4" ascii //weight: 20
        $x_20_2 = "$4f80ea7b-cf52-4883-9831-a5208580bc36" ascii //weight: 20
        $x_20_3 = "$d9e319be-47e0-48c2-9ccb-b6c3b7205466" ascii //weight: 20
        $x_20_4 = "$6e716fa4-6c56-45d2-b95d-e25b72a8db61" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FJ_2147781293_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FJ!MTB"
        threat_id = "2147781293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$57b8b999-0f5b-4c3c-ad57-3d28264fef6f" ascii //weight: 20
        $x_20_2 = "$f908c781-6cb5-47fb-88ea-1b603c7bf6a4" ascii //weight: 20
        $x_20_3 = "$7dfe67d3-ae9b-4e7a-a0e8-887b2e1c4012" ascii //weight: 20
        $x_20_4 = "$ae997ce3-f11c-4c9b-9bd7-ce31ba7e1229" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "ElektroPictureBox.My.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "Agent.Common.My.Resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "HTML_Update_Checker.My.Resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "SpaceInvaders.Properties.Resources" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
        $x_1_16 = "DebuggableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FL_2147781296_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FL!MTB"
        threat_id = "2147781296"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 1e 8d ?? ?? ?? 01 0d 08 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 11 04 16 09 16 1e 28 ?? ?? ?? 0a 00 07 09 6f ?? ?? ?? 0a 00 07 18 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 03 16 03 8e 69 6f ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FL_2147781296_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FL!MTB"
        threat_id = "2147781296"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 09 00 00 06 72 01 00 00 70 72 05 00 00 70 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 72 0b 00 00 70 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0a 06 6f ?? ?? ?? 0a 0b}  //weight: 5, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "MD5Decrypt" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "KB4GGH0RF5P" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AXY_2147781412_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AXY!MTB"
        threat_id = "2147781412"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 ?? ?? ?? ?? ?? 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2d 02 2b 0a 09 16 9a 28 ?? ?? ?? 0a 10 01 ?? ?? ?? ?? ?? 0b 07}  //weight: 10, accuracy: Low
        $x_10_2 = {25 16 03 a2 25 0d 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2c 03 17 2b 03 16 2b 00 2d 02 2b 0c 09 16 9a}  //weight: 10, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = {47 00 65 00 74 00 00 03 78 00 00 0b 50 00 69 00 78 00 65 00 6c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AXY_2147781412_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AXY!MTB"
        threat_id = "2147781412"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 ?? ?? ?? ?? ?? 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2d 02 2b 0a 09 16 9a 28 ?? ?? ?? 0a 10 01 ?? ?? ?? ?? ?? 0b 07}  //weight: 10, accuracy: Low
        $x_10_2 = {25 16 03 a2 25 0d 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2c 03 17 2b 03 16 2b 00 2d 02 2b 0c 09 16 9a}  //weight: 10, accuracy: Low
        $x_1_3 = "SimpleUI.AB" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "SelectorX" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AYN_2147781413_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYN!MTB"
        threat_id = "2147781413"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 ?? ?? ?? ?? ?? 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2d 02 2b 0a 09 16 9a 28 ?? ?? ?? 0a 10 01 ?? ?? ?? ?? ?? 0b 07}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "SelectorX" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYM_2147781414_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYM!MTB"
        threat_id = "2147781414"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 04 28 ?? ?? ?? 0a 11 04 16 91 2c 03 17 2b 03 16 2b 00 2d 02 2b 0c 09 16 9a}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "SelectorX" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYL_2147781415_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYL!MTB"
        threat_id = "2147781415"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? 0b 0e 05 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 6f ?? ?? ?? 0a 10 05 07 0e 05 6f ?? ?? ?? 0a 0c 08 0e 04 20 00 01 00 00 14 14 19 ?? ?? ?? ?? ?? 25 16 28 ?? ?? ?? 06 a2 25 17 28 ?? ?? ?? 06 a2 25 18}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYL_2147781415_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYL!MTB"
        threat_id = "2147781415"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 0c 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 08 13 05 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYO_2147781416_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYO!MTB"
        threat_id = "2147781416"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetMethod" ascii //weight: 1
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "ZBJUCE57ZE7AF4JZ" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "flora" ascii //weight: 1
        $x_1_8 = "SmartExtensions" ascii //weight: 1
        $x_1_9 = "GetBytes" ascii //weight: 1
        $x_1_10 = "AES_Decrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (9 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYP_2147781487_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYP!MTB"
        threat_id = "2147781487"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 07 16 13 04 2b 2f 08 09 11 04 ?? ?? ?? ?? ?? 13 08 08 09 11 04 ?? ?? ?? ?? ?? 13 09 11 09 ?? ?? ?? ?? ?? 13 0a 07 06 11 0a ?? ?? ?? ?? ?? 9c 11 04 17 d6 13 04 11 04 11 07 31 cb 06 17 d6 0a 09 17 d6 0d 09 11 06 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYQ_2147781556_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYQ!MTB"
        threat_id = "2147781556"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {91 08 61 07 11 07 91 61 b4 9c 11 07 03 ?? ?? ?? ?? ?? 17 da fe 01 13 08 11 08 13 09 11 09 2c 06 16 13 07 00 2b 08 00 11 07 17 d6 13 07 00 11 06 17 d6 13 06 11 06 11 05 31 c0}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AZW_2147781557_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AZW!MTB"
        threat_id = "2147781557"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 01 11 08 16 11 09 28 ?? ?? ?? 06 ?? ?? ?? ?? ?? 11 07 11 08 16 11 08 8e 69 6f ?? ?? ?? 0a 13 09 ?? ?? ?? ?? ?? 11 09 ?? ?? ?? ?? ?? 38}  //weight: 10, accuracy: Low
        $x_10_2 = {11 0c 16 17 ?? ?? ?? ?? ?? 13 08 ?? ?? ?? ?? ?? 02 28 ?? ?? ?? 06 73 ?? ?? ?? 0a 13 0c ?? ?? ?? ?? ?? 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 11 01 20 00 01 00 00 14 28 ?? ?? ?? 0a 17 8d ?? ?? ?? 01 25 16 11 05 6f ?? ?? ?? 0a a2 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 13 06}  //weight: 10, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "ClassLibrary1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BAC_2147781558_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAC!MTB"
        threat_id = "2147781558"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 18 18 8d ?? ?? ?? 01 25 16 09 8c ?? ?? ?? 01 a2 25 17 11 04 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a 25 2d 0d 26 12 0b ?? ?? ?? ?? ?? ?? 11 0b 2b 05 ?? ?? ?? ?? ?? 13 09 11 09 28 ?? ?? ?? 0a 13 0a 07 06 11 0a b4 9c 11 04 17 d6 13 04 11 04 11 08 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAC_2147781558_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAC!MTB"
        threat_id = "2147781558"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {18 9a 19 95 6e 31 03 16 2b 01 17 17 59 7e 23 00 00 04 18 9a 1f 77 95 5f 7e 23 00 00 04 18 9a 20 c8 02 00 00 95 61 58 80 34 00 00 04}  //weight: 10, accuracy: High
        $x_10_2 = {20 f8 0a 00 00 95 2e 05 16 07 0c 2b 01 17 7e 42 00 00 04 20 7a 04 00 00 95 5a 7e 42 00 00 04 20 76 0d 00 00 95 58 61 81 06 00 00 01}  //weight: 10, accuracy: High
        $x_10_3 = {16 2b 01 17 17 59 7e 33 00 00 04 1b 9a 20 2a 07 00 00 95 5f 7e 33 00 00 04 1b 9a 20 eb 08 00 00 95 61 58 81 07 00 00 01}  //weight: 10, accuracy: High
        $x_10_4 = {95 2e 03 16 2b 01 17 17 59 7e 7b 00 00 04 1b 9a 20 0f 08 00 00 95 5f 7e 7b 00 00 04 1b 9a 20 ff 09 00 00 95 61 61 81 09 00 00 01}  //weight: 10, accuracy: High
        $x_10_5 = {16 9a 20 18 03 00 00 95 2e 03 16 2b 01 17 17 59 7e 21 01 00 04 16 9a 07 0b 20 d0 0b 00 00 95 5f 7e 21 01 00 04 16 9a 20 c0 09 00 00 95 61 58 81 08 00 00 01}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAN_2147781559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAN!MTB"
        threat_id = "2147781559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 18 18 8d ?? ?? ?? 01 25 16 09 8c ?? ?? ?? 01 a2 25 17 11 04 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a 25 2d 0d 26 12 0a ?? ?? ?? ?? ?? ?? 11 0a 2b 05 ?? ?? ?? ?? ?? 28 ?? ?? ?? 0a 13 09 07 06 11 09 b4 9c 11 04 17 d6 13 04 11 04 11 08 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAN_2147781559_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAN!MTB"
        threat_id = "2147781559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {2c 05 11 3d 16 35 03 16 2b 01 17 17 59 11 39 20 e7 02 00 00 95 5f 11 39 20 43 06 00 00 95 61 58 13 2e}  //weight: 2, accuracy: High
        $x_2_2 = {11 1c 33 0b 11 3a 13 3a 16 11 16 13 21 2b 01 17 17 59 11 1b 20 52 09 00 00 95 5f 11 1b 20 0b 0d 00 00 95 61 58 13 19}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAM_2147781560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAM!MTB"
        threat_id = "2147781560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 14 72 3a 3f 02 70 18 8d ?? 00 00 01 25 16 72 4a 3f 02 70 a2 25 17 72 4e 3f 02 70 a2 14 14 14 28}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAM_2147781560_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAM!MTB"
        threat_id = "2147781560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".resources" ascii //weight: 1
        $x_1_2 = {47 65 74 4d 65 74 68 6f 64 00 49 6e 76 6f 6b 65}  //weight: 1, accuracy: High
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "GetBytes" ascii //weight: 1
        $x_1_8 = {5f 4e 5f 00 41 45 53 5f 44 65 63 72 79 70 74}  //weight: 1, accuracy: High
        $x_1_9 = "RijndaelManaged" ascii //weight: 1
        $x_1_10 = "MD5CryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAI_2147781561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAI!MTB"
        threat_id = "2147781561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {25 16 1f 2d 9d 6f ?? 00 00 0a 0b 07 8e 69 8d ?? 00 00 01 0c 16 0a 2b 12 08 06 07 06 9a 1f 10 28 ?? 00 00 0a d2 9c 06 17 58 0a 06 07 8e 69 fe 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAI_2147781561_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAI!MTB"
        threat_id = "2147781561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 18 18 8d ?? ?? ?? 01 25 16 09 8c ?? ?? ?? 01 a2 25 17 11 04 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 06 25 2d 0d 26 12 0b ?? ?? ?? ?? ?? ?? 11 0b 2b 05 ?? ?? ?? ?? ?? 13 09 11 09 28 ?? ?? ?? 06 13 0a 07 06 11 0a b4 9c 11 04 17 d6 13 04 11 04 11 08 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OR_2147781567_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OR!MTB"
        threat_id = "2147781567"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 09 8c [0-4] a2 25 17 11 ?? 8c [0-4] a2 28 [0-4] 25 [0-2] 26 [0-2] fe [0-5] 11 ?? 2b ?? a5 [0-4] 13 ?? 11 ?? 28}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "get_Height" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FTR_2147781623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FTR!MTB"
        threat_id = "2147781623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {02 50 06 03 06 02 50 8e 69 59 03 8e 69 58 91 9c 06 17 58 0a 06 02 50 8e 69 32 e5}  //weight: 10, accuracy: High
        $x_3_2 = "ResourceManager" ascii //weight: 3
        $x_3_3 = "CallByName" ascii //weight: 3
        $x_3_4 = "get_EntryPoint" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AQE_2147781703_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AQE!MTB"
        threat_id = "2147781703"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a 02 16 28 ?? ?? ?? 0a 0b 06 02 1a 02 8e 69 1a 59 6f ?? ?? ?? 0a 07 ?? ?? ?? ?? ?? 0c 06 16 6a 6f ?? ?? ?? 0a 06 16 ?? ?? ?? ?? ?? 08 16 08 8e 69 6f ?? ?? ?? 0a 26 08 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
        $x_1_4 = "CryptoStreamMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BBR_2147781766_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BBR!MTB"
        threat_id = "2147781766"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 04 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 07 11 05 6f ?? ?? ?? 0a 26 08 04 6f ?? ?? ?? 0a 17 da fe 01 13 06 11 06 2c 04 16 0c 2b 05 [0-2] 08 17 d6 0c 11 04 18 d6 13 04 11 04 09 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BBQ_2147781767_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BBQ!MTB"
        threat_id = "2147781767"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 04 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 06 04 6f ?? ?? ?? 0a 17 da fe 01 13 06 11 06 2c 04 16 0a 2b 04 06 17 d6 0a 07 18 d6 0b 07 11 04 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BBO_2147781768_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BBO!MTB"
        threat_id = "2147781768"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 08 18 2c [0-1] 17 58 0c 08 07 8e 69 32 [0-1] 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 2a 73 ?? ?? ?? 0a ?? ?? ?? ?? ?? 0a ?? ?? ?? ?? ?? 6f ?? ?? ?? 0a 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "ToInt32" ascii //weight: 1
        $x_1_3 = "StartTests" ascii //weight: 1
        $x_1_4 = "RefRegModel" ascii //weight: 1
        $x_1_5 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BBG_2147781769_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BBG!MTB"
        threat_id = "2147781769"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 02 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 11 0c 11 04 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 13 05 11 05 17 8d ?? ?? ?? 01 25 16 02 28 ?? ?? ?? 06 a2 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 13 0a 38}  //weight: 10, accuracy: Low
        $x_1_2 = "CallTests" ascii //weight: 1
        $x_1_3 = "StartTests" ascii //weight: 1
        $x_1_4 = "RefRegModel" ascii //weight: 1
        $x_1_5 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAS_2147781770_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAS!MTB"
        threat_id = "2147781770"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {95 33 56 11 4f 11 2d 2c 07 16 11 17 13 17 2b 01 17 17 59 11 4a 20 1e 10 00 00 95 5f 11 4a 20 94 13 00 00 95 61 58 13 4f}  //weight: 5, accuracy: High
        $x_5_2 = {17 2b 01 16 58 6a 11 4a 20 61 07 00 00 95 6e 31 03 16 2b 01 17 17 59 11 4a 20 d4 07 00 00 95 5f 11 4a 20 71 0b 00 00 95 61 58 13 4f 38 db 13 00 00}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAS_2147781770_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAS!MTB"
        threat_id = "2147781770"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 02 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 09 11 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 05 11 05 17 8d ?? ?? ?? 01 25 16 02 28 ?? ?? ?? 06 a2 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary1.dll" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OS_2147781843_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OS!MTB"
        threat_id = "2147781843"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 8e 69 6f [0-4] 6f 35 00 28 [0-4] 03 6f [0-4] 6f [0-9] 6f [0-4] 06 18 6f [0-4] 02 28 [0-4] 0c 28 [0-4] 06 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAY_2147781845_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAY!MTB"
        threat_id = "2147781845"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 0b 07 28 ?? 00 00 0a 0c 08 16 08 8e 69 28 ?? 00 00 0a 08 0d de 1b 26 20 88 13 00 00 28 ?? 00 00 0a de 00}  //weight: 3, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAY_2147781845_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAY!MTB"
        threat_id = "2147781845"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 18 18 8d ?? ?? ?? 01 25 16 11 0a 8c ?? ?? ?? 01 a2 25 17 11 0b 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a 25 2d 0d 26 12 20 ?? ?? ?? ?? ?? ?? 11 20 2b 05 ?? ?? ?? ?? ?? 13 1e 11 1e 28 ?? ?? ?? 0a 13 1f 07 06 11 1f b4 9c 11 0b 17 d6 13 0b 11 0b 11 1d 31}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BEJ_2147781875_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BEJ!MTB"
        threat_id = "2147781875"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 09 20 ?? ?? ?? ?? 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 06 11 04 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 02 6f ?? ?? ?? 0a 16 02 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 08 16 08 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0b 07}  //weight: 10, accuracy: Low
        $x_10_2 = {70 0c 07 20 ?? ?? ?? ?? 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 6f ?? ?? ?? 0a 16 02 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 08}  //weight: 10, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BDT_2147781876_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BDT!MTB"
        threat_id = "2147781876"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 02 28 ?? ?? ?? 06 a2 28 ?? ?? ?? 06 74 ?? ?? ?? 01 13 ?? 16 7e ?? ?? ?? 04 ?? ?? ?? ?? ?? 26 1b ?? ?? ?? ?? ?? 09 6f ?? ?? ?? 0a 08 20 00 01 00 00 14 09}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "ClassLibrary1.dll" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "StubStatusStrategy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BDR_2147781877_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BDR!MTB"
        threat_id = "2147781877"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 02 8e 69 17 da 91 1f 70 61 0c 20 02 00 00 00 ?? ?? ?? ?? ?? 02 8e 69 17 d6 17 da 17 d6 8d ?? ?? ?? 01 0d 02 8e 69 17 da 13 04 11 04 13 05 16 13 06 ?? ?? ?? ?? ?? 09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ALI_2147781885_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALI!MTB"
        threat_id = "2147781885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 0c 07 20 ?? ?? ?? 00 28 ?? ?? ?? 0a 03 6f ?? ?? ?? ?? ?? ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 6f ?? ?? ?? 0a 16 02 6f ?? ?? ?? ?? ?? ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? ?? ?? ?? ?? ?? 0a 0c 08 13 05 2b 00 11 05 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OT_2147781889_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OT!MTB"
        threat_id = "2147781889"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Streamship_Screenshot" ascii //weight: 1
        $x_1_2 = "ZBJUCE57ZE7AF4JZ" ascii //weight: 1
        $x_1_3 = "AES_Decrypt" ascii //weight: 1
        $x_1_4 = "Flora" ascii //weight: 1
        $x_1_5 = "SmartExtensions" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OU_2147781890_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OU!MTB"
        threat_id = "2147781890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 6f [0-4] 06 18 6f [0-4] 02 6f [0-4] 16 02 6f [0-4] 28 [0-4] 0c 28 [0-4] 06 6f [0-4] 08 16 08 8e 69 6f [0-4] 6f [0-4] 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "ComputeHash" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HD_2147782037_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HD!MTB"
        threat_id = "2147782037"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 08 16 17 73 ?? ?? ?? 0a 0b 73 ?? ?? ?? 0a 0d 1f 40 8d ?? ?? ?? 01 0a 15 13 04 07 06 16 06 8e b7 6f ?? ?? ?? 0a 13 04 38 ?? ?? ?? 00 09 06 16 11 04 6f ?? ?? ?? 0a 07 06 16 06 8e b7 6f ?? ?? ?? 0a 13 04 11 04}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WR_2147782039_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WR!MTB"
        threat_id = "2147782039"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 07 04 6f ?? ?? ?? 0a 17 da 33 03 17 2b 01}  //weight: 10, accuracy: Low
        $x_1_2 = "XOR_Decrypt" ascii //weight: 1
        $x_1_3 = "sadada" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DA_2147782040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DA!MTB"
        threat_id = "2147782040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 15 a2 09 09 03 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 31 00 00 00 07}  //weight: 3, accuracy: High
        $x_3_2 = "SecurityProtocolType" ascii //weight: 3
        $x_3_3 = "HttpWebResponse" ascii //weight: 3
        $x_3_4 = "HttpWebRequest" ascii //weight: 3
        $x_3_5 = "MoveNext" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DA_2147782040_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DA!MTB"
        threat_id = "2147782040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 15 02 08 09 0b 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 2f 00 00 00 03 00 00 00 04 00 00 00 24 00 00 00 03 00 00 00 48}  //weight: 3, accuracy: High
        $x_3_2 = "GetTempPath" ascii //weight: 3
        $x_3_3 = "FromBase64String" ascii //weight: 3
        $x_3_4 = "CreateDecryptor" ascii //weight: 3
        $x_3_5 = "ProcessStartInfo" ascii //weight: 3
        $x_3_6 = "AesCryptoServiceProvider" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DA_2147782040_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DA!MTB"
        threat_id = "2147782040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "NAudio" ascii //weight: 10
        $x_1_2 = "nojarr.Rules" ascii //weight: 1
        $x_1_3 = "Wcoeadcpse.Properties" ascii //weight: 1
        $x_1_4 = "Rcwgu.Rules" ascii //weight: 1
        $x_1_5 = "Atsrsf.Properties" ascii //weight: 1
        $x_1_6 = "JpkgqbzMMP.Readers" ascii //weight: 1
        $x_1_7 = "Fteuvrjk.Properties" ascii //weight: 1
        $x_1_8 = "Cvrosme.Writers" ascii //weight: 1
        $x_1_9 = "Akvacfkhhv.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OV_2147782044_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OV!MTB"
        threat_id = "2147782044"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 11 04 18 6f [0-4] 28 [0-4] 28 [0-4] 04 07 6f [0-4] 28 [0-4] 6a 61 b7 28 [0-8] 28 [0-9] 6f [0-4] 26 07 04 6f [0-4] 17}  //weight: 1, accuracy: Low
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = "Concat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BET_2147782045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BET!MTB"
        threat_id = "2147782045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "4c78e9d7-8fac-4735-9c9b-b813abfbc059" ascii //weight: 10
        $x_10_2 = "e5d657a2-7294-4ee2-aed5-c830404b6863" ascii //weight: 10
        $x_10_3 = "e35fba50-d3eb-438f-b47e-10f4f41a6342" ascii //weight: 10
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "ISectionEntry" ascii //weight: 1
        $x_1_9 = "XOR_Decrypt" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BEP_2147782046_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BEP!MTB"
        threat_id = "2147782046"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 16 11 04 6f ?? ?? ?? 0a 2b 00 11 04 09 8e 69 2e 02 2b 0f 08 09 16 09 8e 69 6f ?? ?? ?? 0a 13 04 2b 0a 07 28 ?? ?? ?? 06 13 05 2b 06 11 04 2c da 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary1.dll" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BEM_2147782047_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BEM!MTB"
        threat_id = "2147782047"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 08 11 05 ?? ?? ?? ?? ?? 26 07 04 ?? ?? ?? ?? ?? 17 da}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ISectionEntry" ascii //weight: 1
        $x_1_5 = "XOR_Decrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFB_2147782048_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFB!MTB"
        threat_id = "2147782048"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 6a 61 b7 28 ?? ?? ?? 0a [0-4] 28 ?? ?? ?? 0a 13 05 08 11 05 ?? ?? ?? ?? ?? 26 07 04 ?? ?? ?? ?? ?? 17 da}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ISectionEntry" ascii //weight: 1
        $x_1_5 = "XOR_Decrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFB_2147782048_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFB!MTB"
        threat_id = "2147782048"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "Garrix.Explorer1" ascii //weight: 10
        $x_10_2 = "SUPERME" ascii //weight: 10
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "InvokeMethod" ascii //weight: 1
        $x_1_7 = "Append" ascii //weight: 1
        $x_1_8 = "Substring" ascii //weight: 1
        $x_1_9 = "ToString" ascii //weight: 1
        $x_1_10 = "System.Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 7 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BFF_2147782049_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFF!MTB"
        threat_id = "2147782049"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 0c 07 20 ?? ?? ?? ?? 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 13 04 20 ?? ?? ?? ?? 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 08 13}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "Flora" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFI_2147782050_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFI!MTB"
        threat_id = "2147782050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetMethod" ascii //weight: 1
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "ZBJUCE57ZE7AF4JZ" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "flora" ascii //weight: 1
        $x_1_8 = "SmartExtensions" ascii //weight: 1
        $x_1_9 = "GetBytes" ascii //weight: 1
        $x_1_10 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (9 of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFI_2147782050_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFI!MTB"
        threat_id = "2147782050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "ZBJUCE57ZE7AF4JZ" ascii //weight: 10
        $x_1_2 = "flora" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "SmartExtensions" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "TransformFinalBlock" ascii //weight: 1
        $x_1_9 = "GetBytes" ascii //weight: 1
        $x_1_10 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BFE_2147782051_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFE!MTB"
        threat_id = "2147782051"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 05 02 11 05 91 08 61 06 11 04 91 61 d2 9c 11 04 03 [0-5] 17 59 fe 01 13 06 11 06 2c 05 16 13 04 2b 06 11 04 17 58 13 04 00 11 05 17 58 13 05 11 05 07 17 59 fe 02 16 fe 01 13 07 11 07 2d}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFA_2147782052_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFA!MTB"
        threat_id = "2147782052"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 02 09 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26 09 18 25 2c 92 d6 0d 09 08 31 be 7e ?? ?? ?? 04 07 28 ?? ?? ?? 06 0a 2b 00 06 2a 02}  //weight: 10, accuracy: Low
        $x_1_2 = "Kygo.dll" ascii //weight: 1
        $x_1_3 = "Garrix.Explorer1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFA_2147782052_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFA!MTB"
        threat_id = "2147782052"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 09 11 05 6f ?? ?? ?? 0a 13 06 11 06 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 07 11 07 2c 33 00 06 06 6f ?? ?? ?? 0a 19 ?? ?? ?? ?? ?? 25 16 12 06 28 ?? ?? ?? 0a 9c 25 17 12 06 28 ?? ?? ?? 0a 9c 25 18 12 06 28 ?? ?? ?? ?? 9c 6f [0-7] 11 05 17 d6}  //weight: 10, accuracy: Low
        $x_10_2 = {0b 06 07 16 1a 6f ?? ?? ?? 0a 26 07 16 28 ?? ?? ?? 0a 0c 06 16 ?? ?? ?? ?? ?? 0d 00 08 8d ?? ?? ?? 01 13 04 09 11 04 16 08 6f ?? ?? ?? 0a 26 11 04 13 05 de 16 09 2c 07 09 6f ?? ?? ?? 0a [0-2] dc 06 2c 07 06 6f ?? ?? ?? 0a [0-2] dc}  //weight: 10, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EJ_2147782065_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJ!MTB"
        threat_id = "2147782065"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 00 07 17 73 ?? ?? ?? 0a 0c 00 08 06 16 06 8e 69 6f ?? ?? ?? 0a 00 08 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 0d de 16}  //weight: 10, accuracy: Low
        $x_1_2 = "CompressGZip" ascii //weight: 1
        $x_1_3 = "DeserializeJson" ascii //weight: 1
        $x_1_4 = "EncodeBase64" ascii //weight: 1
        $x_1_5 = "ToMemoryStream" ascii //weight: 1
        $x_1_6 = "DecompressGZip" ascii //weight: 1
        $x_1_7 = "ToXDocument" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
        $x_1_10 = "GetBytes" ascii //weight: 1
        $x_1_11 = "ExtractGZipToDirectory" ascii //weight: 1
        $x_1_12 = "ToByteArray" ascii //weight: 1
        $x_1_13 = "EncryptRSA" ascii //weight: 1
        $x_1_14 = "OpenRead" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJ_2147782065_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJ!MTB"
        threat_id = "2147782065"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$d62da66d-1de4-4b6b-bbcf-06fa3f4c400d" ascii //weight: 20
        $x_20_2 = "$577b0e2f-2b7a-4c9d-bba0-bfcdfbd0167e" ascii //weight: 20
        $x_20_3 = "$a830ce85-d95e-41fd-b961-1ebed42bbf5f" ascii //weight: 20
        $x_20_4 = "$5a85e55a-2d77-4c76-8788-fa7aa58b14b7" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "_2048.Properties.Resources" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "BattleShip_WinFormsApp.MainForm.resources" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "Dungeon_Sheehan.Form1.resources" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
        $x_1_15 = "DebuggableAttribute" ascii //weight: 1
        $x_1_16 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EG_2147782116_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EG!MTB"
        threat_id = "2147782116"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 06 11 06 11 00 94 11 06 11 02 94 58 20 00 01 00 00 5d 94 13 09 38}  //weight: 5, accuracy: High
        $x_5_2 = {11 07 11 01 02 11 01 91 11 09 61 d2 9c}  //weight: 5, accuracy: High
        $x_10_3 = {9e 07 07 09 94 07 08 94 58 20 00 01 00 00 5d 94 13 08 11 06 06 02 06 91 11 08 61 d2 9c 06 17 58 0a 06 02 8e 69}  //weight: 10, accuracy: High
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_5_*) and 1 of ($x_1_*))) or
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((1 of ($x_10_*) and 1 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EG_2147782116_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EG!MTB"
        threat_id = "2147782116"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {08 11 04 02 11 04 91 07 11 04 07 8e b7 5d 91 61 09 11 04 09 8e b7 5d 91 61 9c 11 04 17 d6 13 04 11 04 11 05 31 da}  //weight: 10, accuracy: High
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Decompress" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "get_CurrentDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SF_2147782125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SF!MTB"
        threat_id = "2147782125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 07 02 07 18 5a 18 6f fa 00 00 0a 1f 10 28 fb 00 00 0a 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0c 08 2d dc}  //weight: 2, accuracy: High
        $x_2_2 = "Nakliye.Anasayfa.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SF_2147782125_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SF!MTB"
        threat_id = "2147782125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 18 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a ?? ?? ?? ?? ?? 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 26 07 04 ?? ?? ?? ?? ?? 17 da 33}  //weight: 10, accuracy: Low
        $x_1_2 = "XOR_Decrypt" ascii //weight: 1
        $x_1_3 = "sadada" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFW_2147782168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFW!MTB"
        threat_id = "2147782168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 00 00 07 0a 38 [0-5] 72 ?? ?? ?? 70 03 11 05 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 0a 17 13 13 11 0a 13 06 00 2b 00 00 08 11 06 6f ?? ?? ?? 0a 26 09 04 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "ISectionEntry" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFV_2147782169_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFV!MTB"
        threat_id = "2147782169"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 16 9a 18 3a ?? ?? ?? ?? 26 38 ?? ?? ?? ?? 11 01 02 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 11 00 11 01 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 1e 3a ?? ?? ?? ?? 26 11 02 17 8d ?? ?? ?? 01 25 16 02 28 ?? ?? ?? 06 a2 6f ?? ?? ?? 0a 74}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary1" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BGO_2147782183_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BGO!MTB"
        threat_id = "2147782183"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 00 1f fb 13 06 2b 7b}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "Garrix.Explorer1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BHA_2147782184_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHA!MTB"
        threat_id = "2147782184"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 07 16 28 ?? ?? ?? 06 a2 07 17 28 ?? ?? ?? 06 a2 07 18 72 ?? ?? ?? 70 a2 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 17 1b 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 28 ?? ?? ?? 0a a2 25 17 20 00 01 00 00 8c ?? ?? ?? 01 a2 25 1a 07 a2 28}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "Garrix.Explorer1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BHB_2147782185_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHB!MTB"
        threat_id = "2147782185"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "37"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41}  //weight: 10, accuracy: High
        $x_10_2 = {52 65 76 65 72 73 65 00 74 65 78 74}  //weight: 10, accuracy: High
        $x_10_3 = {54 65 78 54 00 69 4b 65 79}  //weight: 10, accuracy: High
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
        $x_1_9 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_10 = "ToCharArray" ascii //weight: 1
        $x_1_11 = "InvokeMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 7 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BHB_2147782185_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHB!MTB"
        threat_id = "2147782185"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {69 6d 69 6d 69 6d 69 6d 69 6d 00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78}  //weight: 10, accuracy: High
        $x_10_2 = {44 00 53 00 44 00 53 00 [0-4] 44 00 65 00 5f 00 44 00 65 00 66 00 6c 00 61 00 74 00 65 00}  //weight: 10, accuracy: Low
        $x_10_3 = {44 53 44 53 [0-4] 44 65 5f 44 65 66 6c 61 74 65}  //weight: 10, accuracy: Low
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "DeflateStream" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "CompressionMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 8 of ($x_1_*))) or
            ((3 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OW_2147782191_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OW!MTB"
        threat_id = "2147782191"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 11 04 18 [0-5] 28 [0-4] 28 [0-4] 04 07 6f [0-4] 28 [0-4] 6a 61 b7 28 [0-4] 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = "ISectionEntry" ascii //weight: 1
        $x_1_3 = "get_Chars" ascii //weight: 1
        $x_1_4 = "ToLong" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HG_2147782201_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HG!MTB"
        threat_id = "2147782201"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 6f ?? ?? ?? 0a 26 07 04 6f ?? ?? ?? 0a 17}  //weight: 10, accuracy: Low
        $x_1_2 = "Concat" ascii //weight: 1
        $x_1_3 = "ISectionEntry" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HG_2147782201_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HG!MTB"
        threat_id = "2147782201"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$f74dcee9-2130-4f6f-83b2-1a34cf58aa3f" ascii //weight: 20
        $x_20_2 = "$38a56343-6e50-4f63-9f83-79fb32005a71" ascii //weight: 20
        $x_20_3 = "$02decb4d-a973-4ae4-90cf-4b1da7c5d3e4" ascii //weight: 20
        $x_20_4 = "$f590334a-5ac5-482e-981a-1c9c77f18e9e" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "FromBase64String" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LK_2147782202_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LK!MTB"
        threat_id = "2147782202"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 9a 18 3a ?? ?? ?? ?? 26 38 ?? ?? ?? 00 11 01 02 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 11 00 11 01 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 1e 3a ?? ?? ?? 00 26 11 02 17 8d ?? ?? ?? ?? 25 16 02 28}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary1" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BN_2147782203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BN!MTB"
        threat_id = "2147782203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 18 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 04 07 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 6a 61 b7 28 ?? ?? ?? ?? 13 07}  //weight: 10, accuracy: Low
        $x_1_2 = "ISectionEntry" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZN_2147782204_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZN!MTB"
        threat_id = "2147782204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 18 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 04 07 ?? ?? ?? ?? ?? 28 ?? ?? ?? ?? 6a 61 b7 28}  //weight: 10, accuracy: Low
        $x_1_2 = "ISectionEntry" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "get_Chars" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WE_2147782205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WE!MTB"
        threat_id = "2147782205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 02 07 6f ?? ?? ?? ?? 03 07 03 6f ?? ?? ?? ?? 5d 6f ?? ?? ?? ?? 61 d1 6f ?? ?? ?? ?? 26 07 17 58 0b 07 02 6f ?? ?? ?? ?? 32 d5}  //weight: 10, accuracy: Low
        $x_1_2 = "StringDecrypt" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RF_2147782306_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RF!MTB"
        threat_id = "2147782306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fe 01 13 24 11 24 2c 06 18 13 0a 00 2b 06 00 1f 52 13 0a 00 1f 26 13 0b 11 0b 1f 31 fe 01 13 25 11 25}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RF_2147782306_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RF!MTB"
        threat_id = "2147782306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 1c 62 11 07 58 13 04 11 05 17 58 13 05 11 05 19 3e ?? ff ff ff 07 08 11 04 1f 10 63 20 ?? 00 00 00 5f 28 ?? 00 00 0a 9c 08 17 58 0c 07 08 11 04 1e 63}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RF_2147782306_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RF!MTB"
        threat_id = "2147782306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "christianbeltran.co/wp-admin/images/css/ground/bo" wide //weight: 1
        $x_1_2 = "Sleep" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RF_2147782306_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RF!MTB"
        threat_id = "2147782306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 16 20 [0-4] 6f [0-4] 0d 09 16 fe 02 13 04 11 04 2c 0c ?? 08 07 16 09 6f [0-7] 09 16 fe 02 13 05 11 05 2d d0}  //weight: 1, accuracy: Low
        $x_1_2 = "GZIDEKKKK" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Primer" ascii //weight: 1
        $x_1_5 = "DES_Decrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RF_2147782306_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RF!MTB"
        threat_id = "2147782306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {09 11 04 9a 13 05 00 11 05 11 05 6f 1e 00 00 06 16 fe 01 6f 1f 00 00 06 00 00 11 04 17 58 13 04 11 04 09 8e 69 32 d9}  //weight: 5, accuracy: High
        $x_1_2 = "hkkzuwl10ETj+SzxmTLlyw==" wide //weight: 1
        $x_1_3 = "MatrixGraphicsGenerator.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BHH_2147782372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHH!MTB"
        threat_id = "2147782372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$1efdd2e1-4a81-41f0-a0a1-f77ad51ce26f" ascii //weight: 10
        $x_1_2 = "ClassLibrary" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "ToArray" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "CompressionMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BHH_2147782372_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHH!MTB"
        threat_id = "2147782372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 16 9a 11 01 17 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 38 ?? ?? ?? ?? 28 ?? ?? ?? 0a 02 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 25 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 13 00 11 00 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 13 01 38}  //weight: 10, accuracy: Low
        $x_10_2 = {0a 0a 08 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0b 16 7e ?? ?? ?? 04 2d 03 26 11 04 45 01 ?? ?? ?? ?? ?? ?? ?? 2b 09 06 6f ?? ?? ?? 0a 0d 2b 14 00 07 06 6f ?? ?? ?? 0a de ed 07 2c 06 07 6f ?? ?? ?? 0a dc dd}  //weight: 10, accuracy: Low
        $x_2_3 = "ClassLibrary1.Polices.Pool" ascii //weight: 2
        $x_1_4 = "DestroyDefinition" ascii //weight: 1
        $x_1_5 = "ClassLibrary1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((1 of ($x_10_*) and 1 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BHT_2147782373_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHT!MTB"
        threat_id = "2147782373"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 07 74 ?? ?? ?? 01 16 73 ?? ?? ?? 0a 0c 1a 8d ?? ?? ?? 01 0d 07 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 07 14 72 ?? ?? ?? 70 16 8d ?? ?? ?? 01 14 14 14 28 ?? ?? ?? 0a 1b 8c ?? ?? ?? 01 28 ?? ?? ?? 0a a2 14 14 28 ?? ?? ?? 0a 00 07 14 72 ?? ?? ?? 70 19 8d}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BHS_2147782374_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BHS!MTB"
        threat_id = "2147782374"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03 28 ?? ?? ?? 06 17 da}  //weight: 10, accuracy: Low
        $x_10_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6 8d ?? ?? ?? 01 0d 02 8e 69 17 da}  //weight: 10, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUY_2147782375_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUY!MTB"
        threat_id = "2147782375"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "417450af-ed6d-4177-b0cb-cef4ccdbdb02" ascii //weight: 10
        $x_1_2 = {00 44 65 63 72 79 70 74 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 52 65 73 6f 6c 76 65 00 e2 80 8e}  //weight: 1, accuracy: High
        $x_1_4 = {00 44 65 63 6f 6d 70 72 65 73 73 00}  //weight: 1, accuracy: High
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "ToBase64String" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "ReverseDecode" ascii //weight: 1
        $x_1_9 = "GetBytes" ascii //weight: 1
        $x_1_10 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BIN_2147782465_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BIN!MTB"
        threat_id = "2147782465"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0b 04 17 da 0c 16 0a 2b [0-2] 07 03 06 94 d6 0b 06 17 d6 0a 06 08 31 [0-2] 07 6c 04 6c 5b 02 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 1f 0a 9a 7d ?? ?? ?? 04 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ISectionEntry" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BIM_2147782466_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BIM!MTB"
        threat_id = "2147782466"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {75 00 72 00 75 00 47 00 00 11 50 00 6f 00 73 00 69 00 74 00 69 00 6f 00 6e 00 00 0d 4c 00 65 00 6e 00 67 00 74 00 68}  //weight: 10, accuracy: High
        $x_10_2 = "IIIIIIIIIIIII.L.System.IO.DGIP" ascii //weight: 10
        $x_1_3 = "AddElements" ascii //weight: 1
        $x_1_4 = "TaskCanceledException" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "InvokeMethod" ascii //weight: 1
        $x_1_7 = "GetTypes" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "ISectionEntry" ascii //weight: 1
        $x_1_10 = "getAverage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_HB_2147782494_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HB!MTB"
        threat_id = "2147782494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {91 11 05 11 05 07 84 95 11 05 08 84 95 d7 6e 20 ?? ?? ?? ?? 6a 5f b7 95 61 86 9c 06 11 09 12 00 28 ?? ?? ?? ?? 2d 94}  //weight: 10, accuracy: Low
        $x_1_2 = "Proper_RC4" ascii //weight: 1
        $x_1_3 = "ExecBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HB_2147782494_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HB!MTB"
        threat_id = "2147782494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 8e 69 d6 14 80 ?? ?? ?? 04 1d 5f 20 ?? ?? ?? ?? 80 ?? ?? ?? 04 62 d2 20 00 01 00 00 07 20 ?? ?? ?? ?? 80 ?? ?? ?? 04 8c ?? ?? ?? 01 80 ?? ?? ?? 04 11 05 80 ?? ?? ?? 04 14 80 ?? ?? ?? 04 14 80 ?? ?? ?? 04 5d 61 11 06 20 ?? ?? ?? ?? 80 ?? ?? ?? 04 80 ?? ?? ?? 04 b4 9c 07 17 20 ?? ?? ?? ?? 8c ?? ?? ?? 01 80 ?? ?? ?? 04 d6 0b 07 11 04 3e 66 ff ff ff}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HC_2147782495_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HC!MTB"
        threat_id = "2147782495"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 84 95 9e 11 05 08 84 11 06 9e 09 06 28 ?? ?? ?? ?? 03 06 28 ?? ?? ?? ?? 91 11 05 11 05 07 84 95 11 05 08 84 95 d7 6e 20 ?? ?? ?? ?? 6a 5f b7 95 61 86 9c 06 11 09 12 00 28 ?? ?? ?? ?? 2d 94}  //weight: 10, accuracy: Low
        $x_1_2 = "Proper_RC4" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZA_2147782496_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZA!MTB"
        threat_id = "2147782496"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cb3c68bd-1bbe-47c8-a24a-20b45bb374ae" ascii //weight: 1
        $x_1_2 = "SubtractObject" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "ToBase64String" ascii //weight: 1
        $x_1_5 = "NewLateBinding" ascii //weight: 1
        $x_1_6 = "BitConverter" ascii //weight: 1
        $x_1_7 = "ToInt32" ascii //weight: 1
        $x_1_8 = "LateSet" ascii //weight: 1
        $x_1_9 = "Conversions" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
        $x_1_11 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZA_2147782496_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZA!MTB"
        threat_id = "2147782496"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {66 00 69 00 6c 00 65 00 3a 00 2f 00 2f 00 2f 00 00 11 4c 00 6f 00 63 00 61 00 74 00 69 00 6f 00 6e 00}  //weight: 1, accuracy: High
        $x_1_2 = {11 56 00 69 00 72 00 74 00 75 00 61 00 6c 00 20 00 00 0b 41 00 6c 00 6c 00 6f 00 63 00 00 0d 57 00 72 00 69 00 74 00 65 00 20 00 00 11 50 00 72 00 6f 00 63 00 65 00 73 00 73 00 20 00 00 0d 4d 00 65 00 6d 00 6f 00 72 00 79}  //weight: 1, accuracy: High
        $x_1_3 = "GetHashCode" ascii //weight: 1
        $x_1_4 = "RSACryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "set_UseMachineKeyStore" ascii //weight: 1
        $x_1_6 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "SpecialDirectoriesProxy" ascii //weight: 1
        $x_1_9 = "CreateEncryptor" ascii //weight: 1
        $x_1_10 = "FileSystemProxy" ascii //weight: 1
        $x_1_11 = "Text Files (*.txt)|*.txt|All Files (*.*)|*.*" wide //weight: 1
        $x_1_12 = "SoapName.dll" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BIY_2147782511_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BIY!MTB"
        threat_id = "2147782511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "6b455914-b6b3-425e-b220-773fa04692b8" ascii //weight: 10
        $x_10_2 = "7f9d7c38-4e09-43a3-8455-a79f19f8d810" ascii //weight: 10
        $x_10_3 = "820bdaf1-c58c-44e6-80d3-37a47e51d929" ascii //weight: 10
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CompressionMode" ascii //weight: 1
        $x_1_8 = "Invoke" ascii //weight: 1
        $x_1_9 = "GetMethod" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FGI_2147782512_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FGI!MTB"
        threat_id = "2147782512"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 7e ?? ?? ?? 04 16 14 28 ?? ?? ?? 06 a2 25 17 7e ?? ?? ?? 04 16 14 28 ?? ?? ?? 06 a2 25 18 7e ?? ?? ?? 04 19 14 28 ?? ?? ?? 06 a2 25 19 7e ?? ?? ?? 04 19 14 28 ?? ?? ?? 06 a2 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 80 ?? ?? ?? 04 7e ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 06 08 16 20 00 10 00 00}  //weight: 10, accuracy: Low
        $x_1_2 = "RaceCore.dll" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WA_2147782522_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WA!MTB"
        threat_id = "2147782522"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {06 11 0f 18 64 e0 07 11 0e 11 0f 19 58 58 e0 91 1f 18 62 07 11 0e 11 0f 18 58 58 e0 91 1f 10 62 60 07 11 0e 11 0f 17 58 58 e0 91 1e 62 60 07 11 0e 11 0f 58 e0 91 60 9e 11 0f 1a 58 13 0f 11 0f 1f 3d 44 b9 ff ff ff}  //weight: 10, accuracy: High
        $x_3_2 = "Reload.com.InspectorMu.Web" ascii //weight: 3
        $x_3_3 = "HostEntry" ascii //weight: 3
        $x_3_4 = "GetFromLine" ascii //weight: 3
        $x_3_5 = "WritePrivateProfileString" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BJN_2147782650_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BJN!MTB"
        threat_id = "2147782650"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 0d 06 14 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 17 8d ?? ?? ?? 01 25 16 06 14 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 16 8d ?? ?? ?? 01 14 14 14 28 ?? ?? ?? 0a 1b 8c ?? ?? ?? 01 28 ?? ?? ?? 0a a2 14 14 28 ?? ?? ?? 0a 06 14 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 19 8d ?? ?? ?? 01 25 16 09 a2 25 17 16 8c ?? ?? ?? 01 a2 25 18 1a 8c}  //weight: 10, accuracy: Low
        $x_1_2 = "InvokeMethod" ascii //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BKE_2147782651_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BKE!MTB"
        threat_id = "2147782651"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {03 50 09 03 50 8e 69 6a 5d b7 03 50 09 03 50 8e 69 6a 5d b7 91 07 09 07 8e 69 6a 5d b7 91 61 03 50 09 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 00 01 00 00 d6 20 00 01 00 00 5d b4 9c 09 17 6a d6 0d 09 08}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BKB_2147782652_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BKB!MTB"
        threat_id = "2147782652"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c}  //weight: 1, accuracy: High
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6 8d ?? ?? ?? 01 0d 16 28}  //weight: 1, accuracy: Low
        $x_1_3 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABF_2147782676_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABF!MTB"
        threat_id = "2147782676"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 6e 31 03 16 2b 01 17 7e 02 00 00 04 18 06 0c 9a 20 81 0b 00 00 95 5a 7e 02 00 00 04 18 9a 20 a7 0d 00 00 95 58 61 81 05 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {95 e0 95 2d 06 16 09 13 08 2b 01 17 7e 1c 01 00 04 17 9a 20 b1 01 00 00 95 5a 7e 1c 01 00 04 17 9a 20 c2 01 00 00 95 58 61 80 18 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABF_2147782676_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABF!MTB"
        threat_id = "2147782676"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 09 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 0b 07 16 fe 02 13 06 11 06 2c 09 06 09 16 07 6f ?? ?? ?? 0a 07 16 fe 02 13 07 11 07 2d d5 06 6f ?? ?? ?? 0a 13 05 de 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "MemoryStream" ascii //weight: 1
        $x_1_4 = "get_Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABF_2147782676_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABF!MTB"
        threat_id = "2147782676"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 da 13 04 16 13 05 11 05 16 fe 01 13 08 11 08 2c 05 38 c8 00 00 00 00 00 72 ?? ?? ?? ?? 03 11 05 18 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 07 08 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 6a 61 b7 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 13 06}  //weight: 10, accuracy: Low
        $x_3_2 = "SUPERME" ascii //weight: 3
        $x_3_3 = "wyb_fig" ascii //weight: 3
        $x_3_4 = "wypelnij_siatke" ascii //weight: 3
        $x_3_5 = "wyp_siatka_leg" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABF_2147782676_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABF!MTB"
        threat_id = "2147782676"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {12 17 28 4d ?? ?? 0a 73 4e ?? ?? 0a 0b d0 0e ?? ?? 02 28 19 ?? ?? 0a 6f 31 ?? ?? 0a 72 52 ?? ?? 70 6f 4f ?? ?? 0a 73 50 ?? ?? 0a 0c 08 6f 4a ?? ?? 0a 16 6a 6f 4b ?? ?? 0a 08 08 43 00 7e 27 ?? ?? 04 25 13 26}  //weight: 5, accuracy: Low
        $x_5_2 = {11 07 11 08 61 13 11 11 06 11 0b 11 11 20 ff ?? ?? 00 5f d2 9c 11 06 11 0b 17 58 11 11 20 00 ?? ?? 00 5f 1e 64 d2 9c 11 06}  //weight: 5, accuracy: Low
        $x_1_3 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_4 = "ReadBytes" ascii //weight: 1
        $x_1_5 = "MemoryStream" ascii //weight: 1
        $x_1_6 = "FileAccess" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WC_2147782679_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WC!MTB"
        threat_id = "2147782679"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "application/json; charset=utf-8" ascii //weight: 3
        $x_3_2 = "StreamReader" ascii //weight: 3
        $x_3_3 = "v2/process.php" ascii //weight: 3
        $x_3_4 = "httpWebRequest" ascii //weight: 3
        $x_3_5 = "costura.newtonsoft.json.dll.compressed" ascii //weight: 3
        $x_3_6 = "costura.costura.dll.compressed" ascii //weight: 3
        $x_3_7 = "Zoo has {0} animals." ascii //weight: 3
        $x_3_8 = "unwiredlabs" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SQ_2147782683_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SQ!MTB"
        threat_id = "2147782683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 50 09 03 50 8e 69 6a 5d b7 03 50 09 03 50 8e 69 6a 5d b7 91 07 09 07 8e 69 6a 5d b7 91 61 03 50 09 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 ?? ?? ?? ?? d6 20 ?? ?? ?? ?? 5d b4 9c 09 17 6a d6 0d 09 08 31 bb}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SQ_2147782683_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SQ!MTB"
        threat_id = "2147782683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 08 5d 13 04 06 17 58 08 5d 13 0a 07 11 0a 91 20 00 01 00 00 58 13 0b 07 11 04 91 13 0c 11 0c 11 06 06 1f 16 5d 91 61 13 0d 11 0d 11 0b 59 13 0e 07 11 04 11 0e 20 00 01 00 00 5d d2 9c 06 17 58 0a 06 08 11 07 17 58 5a fe 04 13 0f 11 0f 2d af}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BLI_2147782761_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BLI!MTB"
        threat_id = "2147782761"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 50 8e 69 6a 5d b7 03 50 ?? 03 50 8e 69 6a 5d b7 91 ?? ?? ?? 8e 69 6a 5d b7 91 61 03 50 ?? 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 00 01 00 00 d6 20 00 01 00 00 5d b4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BLI_2147782761_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BLI!MTB"
        threat_id = "2147782761"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 0d 20 05 00 00 00 28 ?? ?? ?? 06 3a ?? ?? ?? ?? 26 09 08 3e}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SR_2147782762_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SR!MTB"
        threat_id = "2147782762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 50 08 03 50 8e 69 6a 5d b7 03 50 08 03 50 8e 69 6a 5d b7 91 06 08 06 8e 69 6a 5d b7 91 61 03 50 08 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 ?? ?? ?? ?? d6 20 ?? ?? ?? ?? 5d b4}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SR_2147782762_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SR!MTB"
        threat_id = "2147782762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 11 22 11 04 5d 13 23 11 22 17 58 11 04 5d 13 24 07 11 24 91 20 00 01 00 00 58 13 25 07 11 23 91 13 26 11 26 08 11 22 1f 16 5d 91 61 13 27 11 27 11 25 59 13 28 07 11 23 11 28 20 00 01 00 00 5d d2 9c 00 11 22 17 58 13 22 11 22 11 04 09 17 58 5a fe 04 13 29 11 29 2d a6}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BKZ_2147782819_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BKZ!MTB"
        threat_id = "2147782819"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {03 50 09 03 50 8e 69 6a 5d b7 91 07 09 07 8e 69 6a 5d b7 91 61 03 50 09 17 6a d6 03 50 8e 69 6a 5d b7 91 da 20 00 01 00 00 d6 20 00 01 00 00 5d b4}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BKY_2147782820_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BKY!MTB"
        threat_id = "2147782820"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 00 07 17 58 0b 07 02 6f ?? ?? ?? 0a fe 04 0c 08 2d}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "i0ANBZWOXoLECgIF3wiGAZpBXg=" ascii //weight: 1
        $x_1_5 = "RscLhYiIj4cZCxBLxg2BAY0GnQPPQk7FDtFEzkmLms=" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SB_2147782929_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SB!MTB"
        threat_id = "2147782929"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 06 91 20 ?? ?? ?? ?? 59 d2 9c 00 06 17 58 0a 06 7e ?? ?? ?? ?? 8e 69 fe 04 0b 07 2d d7}  //weight: 10, accuracy: Low
        $x_1_2 = "nadjodo.duckdns.org" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SB_2147782929_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SB!MTB"
        threat_id = "2147782929"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 06 07 02 07 18 5a 18 6f 6c 00 00 0a 1f 10 28 6d 00 00 0a 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0c 08 2d dc}  //weight: 2, accuracy: High
        $x_2_2 = "AmigoSecretoWinForms.Form1.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SB_2147782929_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SB!MTB"
        threat_id = "2147782929"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {28 51 00 00 0a 02 d6 6c 0b 2b 0e 17 28 52 00 00 0a 00 28 53 00 00 0a 00 00 28 51 00 00 0a 6c 07 fe 04 0c 08 2d e5}  //weight: 10, accuracy: High
        $x_3_2 = "CheckFileLocation" ascii //weight: 3
        $x_3_3 = "AddTo_NonKey" ascii //weight: 3
        $x_3_4 = "Info_Grab_IB" ascii //weight: 3
        $x_3_5 = "Web_NewAddress" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OY_2147783057_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OY!MTB"
        threat_id = "2147783057"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 02 26 16 28 [0-4] 02 28 [0-4] 28 [0-4] 28 [0-4] 0a 02 06 72 [0-4] 28 [0-4] 28 [0-4] 7d [0-4] 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OZ_2147783058_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OZ!MTB"
        threat_id = "2147783058"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_11_1 = {06 0a 06 28 [0-4] 28 [0-4] 0b 07 28 [0-4] 09 20 [0-4] 5a 20 [0-4] 61 38 [0-4] 09 20 [0-4] 5a 20 [0-4] 61 38 13 00 28 [0-4] 28 [0-4] 28 [0-4] 28}  //weight: 11, accuracy: Low
        $x_1_2 = "PTM.OPIC.resources" ascii //weight: 1
        $x_1_3 = "NETRESOURCE" ascii //weight: 1
        $x_1_4 = "strrever" ascii //weight: 1
        $x_1_5 = "SplashForm" ascii //weight: 1
        $x_1_6 = "SetLoadProgress" ascii //weight: 1
        $x_1_7 = "RijndaelManaged" ascii //weight: 1
        $x_1_8 = "System.Security.Cryptography" ascii //weight: 1
        $x_1_9 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_10 = "ICryptoTransform" ascii //weight: 1
        $x_1_11 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_12 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((11 of ($x_1_*))) or
            ((1 of ($x_11_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BML_2147783060_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BML!MTB"
        threat_id = "2147783060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 1e 8d ?? ?? ?? 01 0d 08 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 11 04 16 09 16 1e 28 ?? ?? ?? 0a 00 07 09 6f ?? ?? ?? 0a 00 07 18 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 03 16 03 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BMF_2147783061_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BMF!MTB"
        threat_id = "2147783061"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = "FillRecta" ascii //weight: 1
        $x_1_4 = "Associates" ascii //weight: 1
        $x_1_5 = "ColorConverter" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "GetBytes" ascii //weight: 1
        $x_1_10 = "Lydio" ascii //weight: 1
        $x_1_11 = "orphi" ascii //weight: 1
        $x_1_12 = {47 65 74 44 6f 6d 61 69 6e 00 4c 6f 61 64}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BMH_2147783062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BMH!MTB"
        threat_id = "2147783062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "get_OffsetMarshaler" ascii //weight: 1
        $x_1_2 = "get_ReturnMessage" ascii //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_8 = "GetBytes" ascii //weight: 1
        $x_1_9 = "CreateDecryptor" ascii //weight: 1
        $x_1_10 = "TransformFinalBlock" ascii //weight: 1
        $x_1_11 = "GetType" ascii //weight: 1
        $x_1_12 = "InvokeMember" ascii //weight: 1
        $x_1_13 = "GetAssemblies" ascii //weight: 1
        $x_1_14 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BNP_2147783063_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BNP!MTB"
        threat_id = "2147783063"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 09 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = {09 02 8e 69 18 da 17 d6 17 da 17 d6 8d ?? ?? ?? 01 28 ?? ?? ?? 06 74 ?? ?? ?? 1b 0a}  //weight: 1, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
        $x_1_5 = "ekovnI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BNN_2147783064_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BNN!MTB"
        threat_id = "2147783064"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = "FillRecta" ascii //weight: 1
        $x_1_4 = "Associates" ascii //weight: 1
        $x_1_5 = "ColorConverter" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "CompressionMode" ascii //weight: 1
        $x_1_10 = "FromBase64String" ascii //weight: 1
        $x_1_11 = "RestrictedError" ascii //weight: 1
        $x_1_12 = "ValueEnumerator" ascii //weight: 1
        $x_1_13 = "TaskCanceledException" ascii //weight: 1
        $x_1_14 = "GetDomain" ascii //weight: 1
        $x_1_15 = "bytesToDecompress" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BNH_2147783065_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BNH!MTB"
        threat_id = "2147783065"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 00 07 17 58 0b 07 02 6f ?? ?? ?? 0a fe 04 0c 08 2d}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "xoredString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BOC_2147783066_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BOC!MTB"
        threat_id = "2147783066"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "29"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {50 65 78 65 73 6f 43 6f 72 65 00 43 6f 72 65}  //weight: 10, accuracy: High
        $x_10_2 = "PexesoClass" ascii //weight: 10
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "UnaryOperation" ascii //weight: 1
        $x_1_7 = "BinaryOperation" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "CompressionMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BOD_2147783067_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BOD!MTB"
        threat_id = "2147783067"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "30"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "FEA94A50-E5C8-4edd-BE62-F738BC8C043E" ascii //weight: 20
        $x_1_2 = "BinaryOperation" ascii //weight: 1
        $x_1_3 = "PexesoCore.dll" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetMethodFromHandle" ascii //weight: 1
        $x_1_6 = "ToUInt32" ascii //weight: 1
        $x_1_7 = "UnaryOperation" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_10 = "CreateDecryptor" ascii //weight: 1
        $x_1_11 = "RequestingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BOQ_2147783068_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BOQ!MTB"
        threat_id = "2147783068"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0c 07 28 ?? ?? ?? ?? 72 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 6f ?? ?? ?? 0a 16 02 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 20 ?? ?? ?? ?? 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BOQ_2147783068_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BOQ!MTB"
        threat_id = "2147783068"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "SmartExtensions" ascii //weight: 10
        $x_10_2 = "ZJ4FA7EZ75ECUJBZ" ascii //weight: 10
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "GetBytes" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
        $x_1_11 = "flora" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 7 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_TC_2147783091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TC!MTB"
        threat_id = "2147783091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {8e 69 17 da 0c 16 0d ?? 13 05 2b ?? 06 ?? ?? ?? ?? ?? 09 06 ?? ?? ?? ?? ?? 09 91 7e ?? ?? ?? ?? 7e ?? ?? ?? ?? 6f ?? ?? ?? ?? 74 ?? ?? ?? ?? 07 09 28 ?? ?? ?? ?? 9c ?? 13 05 38 ?? ff ff ff 09 17 d6 0d ?? 13 05 38 ?? ff ff ff 09 08}  //weight: 10, accuracy: Low
        $x_10_2 = {8e 69 17 da 0c 16 ?? 2b ?? 06 09 06 09 91 7e ?? ?? ?? ?? 7e ?? ?? ?? ?? 6f ?? ?? ?? ?? 74 ?? ?? ?? ?? 07 09 28 ?? ?? ?? ?? 9c 09 17 d6 0d 09 08 31 d7}  //weight: 10, accuracy: Low
        $x_1_3 = "WebResponse" ascii //weight: 1
        $x_1_4 = "set_ConnectionString" ascii //weight: 1
        $x_1_5 = "WebRequest" ascii //weight: 1
        $x_1_6 = "CorruptLoad" ascii //weight: 1
        $x_1_7 = "WriteResPassword" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BS_2147783092_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BS!MTB"
        threat_id = "2147783092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 05 2b bd 16 0a 18 13 05 2b b6 04 03 61 1f 60 59 06 61 ?? ?? ?? ?? ?? ?? ?? ?? ?? 1e 13 05 2b a0 19 2b f9 14 0b 16 13 05 2b 96}  //weight: 10, accuracy: Low
        $x_1_2 = "WebResponse" ascii //weight: 1
        $x_1_3 = "set_ConnectionString" ascii //weight: 1
        $x_1_4 = "WebRequest" ascii //weight: 1
        $x_1_5 = "CorruptLoad" ascii //weight: 1
        $x_1_6 = "WriteResPassword" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BP_2147783093_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BP!MTB"
        threat_id = "2147783093"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bytesToDecompress" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = "FillRecta" ascii //weight: 1
        $x_1_4 = "Associates" ascii //weight: 1
        $x_1_5 = "ColorConverter" ascii //weight: 1
        $x_1_6 = "RestrictedError" ascii //weight: 1
        $x_1_7 = "TaskCanceledException" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "CompressionMode" ascii //weight: 1
        $x_1_10 = "FromBase64String" ascii //weight: 1
        $x_1_11 = "GetType" ascii //weight: 1
        $x_1_12 = "ValueEnumerator" ascii //weight: 1
        $x_1_13 = "GZipStream" ascii //weight: 1
        $x_1_14 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EDP_2147783114_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EDP!MTB"
        threat_id = "2147783114"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 1f 0a 2b fb 20 e7 03 00 00 ?? 2d 0a 26 06 17 59 ?? 2d 0a 26 2b 0a 28 17 00 00 0a 2b f0 0a 2b 00 06 16 fe 03 0c 08 2d dc}  //weight: 10, accuracy: Low
        $x_3_2 = "GetExecutingAssembly" ascii //weight: 3
        $x_3_3 = "GetDomain" ascii //weight: 3
        $x_3_4 = "Animals run" ascii //weight: 3
        $x_3_5 = "Humans run" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BOO_2147783195_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BOO!MTB"
        threat_id = "2147783195"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0d 09 06 20 e8 03 00 00 73 ?? ?? ?? 0a 13 04 08 11 04 08 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 17 2c b8 08 11 04 08 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 17 6f ?? ?? ?? 0a 00 1b 2c b8 07 08 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BOP_2147783196_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BOP!MTB"
        threat_id = "2147783196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 00 00 00 00 38 ?? ?? ?? ?? 11 00 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 20 00 01 00 00 14 11 00 17 8d ?? ?? ?? 01 25 16 02 7e ?? ?? ?? 04 28 ?? ?? ?? 06 a2 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 28 ?? ?? ?? 06 13 01 38 ?? ?? ?? ?? 28 ?? ?? ?? 0a 13 00 38}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BPQ_2147783197_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BPQ!MTB"
        threat_id = "2147783197"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 10 00 00 8d ?? ?? ?? 01 0d 73 ?? ?? ?? 0a 0a 08 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 0b 07 16 fe 02 13 05 11 05 2c 09 06 09 16 07 6f ?? ?? ?? 0a 07 16 fe 02 13 06 11 06 2d d5 06 6f ?? ?? ?? 0a 13 04 de 11 06 2c 06 06 6f ?? ?? ?? 0a dc}  //weight: 10, accuracy: Low
        $x_1_2 = "ColorConverter" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetDomain" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BPM_2147783292_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BPM!MTB"
        threat_id = "2147783292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00 4d 75 6c 74 69 54 6f 6b 65 6e}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 5a 58 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_5 = "ColorConverter" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "CompressionMode" ascii //weight: 1
        $x_1_10 = "FromBase64" ascii //weight: 1
        $x_1_11 = "RestrictedError" ascii //weight: 1
        $x_1_12 = "ValueEnumerator" ascii //weight: 1
        $x_1_13 = "TaskCanceledException" ascii //weight: 1
        $x_1_14 = {00 69 6d 69 6d 69 6d 69 6d 69 6d 00}  //weight: 1, accuracy: High
        $x_1_15 = {42 54 44 00 61 6c 70 68 61 45}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BPN_2147783293_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BPN!MTB"
        threat_id = "2147783293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 16 2d}  //weight: 1, accuracy: Low
        $x_1_2 = {91 08 61 07 11 07 91 61 b4 9c 11 07 03 6f ?? ?? ?? 0a 17 da 16 2d}  //weight: 1, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BPK_2147783294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BPK!MTB"
        threat_id = "2147783294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "ZJ4FA7EZ75ECUJBZ" ascii //weight: 10
        $x_1_2 = "flora" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetBytes" ascii //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BQI_2147783295_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BQI!MTB"
        threat_id = "2147783295"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 5a 58 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_5 = "ColorConverter" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "CompressionMode" ascii //weight: 1
        $x_1_10 = "FromBase64" ascii //weight: 1
        $x_1_11 = "RestrictedError" ascii //weight: 1
        $x_1_12 = "ValueEnumerator" ascii //weight: 1
        $x_1_13 = "TaskCanceledException" ascii //weight: 1
        $x_1_14 = {00 69 6d 69 6d 69 6d 69 6d 69 6d 00}  //weight: 1, accuracy: High
        $x_1_15 = {44 00 53 00 44 00 53 00 [0-4] 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00}  //weight: 1, accuracy: Low
        $x_1_16 = {44 53 44 53 [0-4] 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (15 of ($x*))
}

rule Trojan_MSIL_AgentTesla_BJ_2147783372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BJ!MTB"
        threat_id = "2147783372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 06 16 73 ?? ?? ?? ?? 73 ?? ?? ?? ?? 0c 08 07 6f ?? ?? ?? ?? dd ?? ?? ?? ?? 08 39 ?? ?? ?? ?? 08 6f ?? ?? ?? ?? dc 07 6f ?? ?? ?? ?? 0d dd}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BJ_2147783372_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BJ!MTB"
        threat_id = "2147783372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "45.11.126.185" wide //weight: 1
        $x_1_2 = "www.irispanel.org/HataLog.ashx" wide //weight: 1
        $x_1_3 = "Debugger Detected" wide //weight: 1
        $x_1_4 = "SELECT * FROM Win32_DiskDrive" wide //weight: 1
        $x_1_5 = "pack0.irispanel.org/packlist" wide //weight: 1
        $x_1_6 = "temp\\Patcher.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BQG_2147783478_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BQG!MTB"
        threat_id = "2147783478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 04 11 04 16 fe 02 13 05 11 05 2c 0c 09 08 16 11 04 6f ?? ?? ?? 0a 00 00 00 00 11 04 16 fe 02 13 06 11 06 2d}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "RestrictedError" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BQH_2147783479_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BQH!MTB"
        threat_id = "2147783479"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 18 1b 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 20 00 01 00 00 8c ?? ?? ?? 01 a2 25 1a 17 8d ?? ?? ?? 01 25 16 03 74 ?? ?? ?? 1b 28 ?? ?? ?? 06 a2 a2 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 02 06 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 18 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 28}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "RestrictedError" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BQF_2147783480_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BQF!MTB"
        threat_id = "2147783480"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 20 00 01 00 00 6f ?? ?? ?? 0a 00 06 20 80 00 00 00 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 7e ?? ?? ?? 04 20 e8 03 00 00 73 ?? ?? ?? 0a 0b 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 17 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "InvokeMethod" ascii //weight: 1
        $x_1_5 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BQC_2147783481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BQC!MTB"
        threat_id = "2147783481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {14 0b 14 0c 16 0d 16 13 04 16 13 05 02 73 ?? ?? ?? 0a 16 73 ?? ?? ?? 0a 13 06 17 13 07 11 06 0c 00 2b 00 00 08 13 08 20 00 10 00 00 8d ?? ?? ?? 01 13 09 73 ?? ?? ?? 0a 13 0a 00 00 08 11 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 0c 17 13 0d 11 0c 0d 00 2b 00 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "TaskCanceledException" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BQD_2147783482_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BQD!MTB"
        threat_id = "2147783482"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {14 13 04 14 0c 16 0a 16 13 05 16 13 06 02 73 ?? ?? ?? 0a 16 73 ?? ?? ?? 0a 13 0a 11 0a 0c 08 13 07 20 00 10 00 00 8d ?? ?? ?? 01 13 08 73 ?? ?? ?? 0a 0b 08 11 08 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 0c 11 0c 0a 2b}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BO_2147783505_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BO!MTB"
        threat_id = "2147783505"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 07 06 1f 10 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 07 06 1f 10 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 07 6f ?? ?? ?? ?? 02 16 02 8e 69 6f ?? ?? ?? ?? 0c 08 8e 69 1f 11 da 17 d6 17 da 17 d6 8d ?? ?? ?? ?? 0d 08 1f 10 09 16 08 8e 69 1f 10 da 28 ?? ?? ?? ?? 09 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BA_2147783506_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BA!MTB"
        threat_id = "2147783506"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 50 06 02 50 8e b7 6a 5d b7 02 50 06 02 50 8e b7 6a 5d b7 91 03 06 03 8e b7 6a 5d b7 91 61 02 50 06 17 6a d6 02 50 8e b7 6a 5d b7 91 da 20 ?? ?? ?? ?? d6 20 ?? ?? ?? ?? 5d b4}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BA_2147783506_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BA!MTB"
        threat_id = "2147783506"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 bf a2 3d 09 0b 00 00 00 00 00 00 00 00 00 00 01 00 00 00 bb 00 00 00 40 00 00 00 c7}  //weight: 3, accuracy: High
        $x_3_2 = "HeavyDuck.Eve" ascii //weight: 3
        $x_3_3 = "HttpWebRequest" ascii //weight: 3
        $x_3_4 = "WebRequest" ascii //weight: 3
        $x_3_5 = "System.Security.Permissions" ascii //weight: 3
        $x_3_6 = "FileIOPermissionAccess" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BA_2147783506_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BA!MTB"
        threat_id = "2147783506"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 95 a2 29 09 03 00 00 00 00 00 00 00 00 00 00 01 00 00 00 4a 00 00 00 11 00 00 00 54}  //weight: 3, accuracy: High
        $x_3_2 = "HJSHJSLKW.pdb" ascii //weight: 3
        $x_3_3 = "Bellbellbell" ascii //weight: 3
        $x_3_4 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 3
        $x_3_5 = "SecurityProtocolType" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CA_2147783507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CA!MTB"
        threat_id = "2147783507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {08 11 16 08 11 16 91 11 04 61 20 ff 00 00 00 5f d2 9c 11 16 17 58 13 16 11 16 08 8e 69 32 e1}  //weight: 5, accuracy: High
        $x_1_2 = "VirusDeleted" ascii //weight: 1
        $x_1_3 = "NtCreateThreadEx" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CA_2147783507_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CA!MTB"
        threat_id = "2147783507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 39 02 08 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? 13 04 11 04 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? da 13 05 07 11 05 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 0b 08 28 ?? ?? ?? ?? d6 0c 00 08 09 fe 04 13 06 11 06 2d bd}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CA_2147783507_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CA!MTB"
        threat_id = "2147783507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Decrypt" ascii //weight: 1
        $x_1_2 = "Decompress" ascii //weight: 1
        $x_1_3 = "VirtualProtect" ascii //weight: 1
        $x_1_4 = "LzmaDecoder" ascii //weight: 1
        $x_1_5 = "BitTreeDecoder" ascii //weight: 1
        $x_1_6 = "ReverseDecode" ascii //weight: 1
        $x_1_7 = "ResolveSignature" ascii //weight: 1
        $x_10_8 = "jfdawdawo.exe" ascii //weight: 10
        $x_10_9 = "hnbzdfikeao.exe" ascii //weight: 10
        $x_1_10 = "Debugger" ascii //weight: 1
        $x_1_11 = "ToBase64String" ascii //weight: 1
        $x_1_12 = "get_CurrentDomain" ascii //weight: 1
        $x_1_13 = "MemoryStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 11 of ($x_1_*))) or
            ((2 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CB_2147783508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CB!MTB"
        threat_id = "2147783508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_12_1 = {0a 00 07 28 ?? ?? ?? ?? 03 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 13 06 08 11 06 6f ?? ?? ?? ?? 00 08 18 6f ?? ?? ?? ?? 00 08 6f ?? ?? ?? ?? 13 05 02 28 ?? ?? ?? ?? 13 04 28 ?? ?? ?? ?? 11 05 11 04 16 11 04 8e b7 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 0a 06 0d de 13 de 10}  //weight: 12, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CB_2147783508_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CB!MTB"
        threat_id = "2147783508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 01 00 00 70 d0 ?? ?? ?? 02 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 73 1c 00 00}  //weight: 5, accuracy: Low
        $x_1_2 = "YASAT" wide //weight: 1
        $x_1_3 = "YASAT_Report" wide //weight: 1
        $x_1_4 = "Oklahoma Tire & Supply Company" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CB_2147783508_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CB!MTB"
        threat_id = "2147783508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ConwayLife.Properties.Resources" wide //weight: 1
        $x_1_2 = "se sikertelen!" wide //weight: 1
        $x_1_3 = "Hiba!" wide //weight: 1
        $x_1_4 = "selfie_me" wide //weight: 1
        $x_1_5 = "selfie_panty" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZ_2147783509_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZ!MTB"
        threat_id = "2147783509"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 04 09 04 6f ?? ?? ?? ?? 5d 17 d6 28 ?? ?? ?? ?? da 2b 15 07 11 04 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 0b 2b 04 13 04 2b e7 09 17 d6 0d 2b 03 0c 2b c0 09 08 31 02 2b 05 2b bc 0b 2b ad}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CG_2147783510_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CG!MTB"
        threat_id = "2147783510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {03 07 03 07 91 02 04 07 04 8e b7 5d 91 04 04 07 04 8e b7 5d 91 04 8e b7 5d 91 6f}  //weight: 1, accuracy: High
        $x_1_2 = {61 04 07 07 1d 5d d6 04 8e b7 5d 04 8e b7 5d 91 61 9c 07 17 d6 0b 07 08 31}  //weight: 1, accuracy: High
        $x_1_3 = "EncryptionKEY" wide //weight: 1
        $x_1_4 = "XorCrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CG_2147783510_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CG!MTB"
        threat_id = "2147783510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GameBackupManager" ascii //weight: 1
        $x_1_2 = "AZXCCCCCCCCCCCCCCCCCCC" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "GetDomain" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "imimimimim" ascii //weight: 1
        $x_1_12 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CF_2147783511_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CF!MTB"
        threat_id = "2147783511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Aile Hekiminden birinin NBYS" ascii //weight: 1
        $x_1_2 = "tercih etmesinin onurunu ya" ascii //weight: 1
        $x_1_3 = "5Telif Hakk" ascii //weight: 1
        $x_1_4 = "$ac045e25-5d9e-42b8-a1ce-4c3a95960eae" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CF_2147783511_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CF!MTB"
        threat_id = "2147783511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "34"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 28 41 00 00 06 26 14 0a 2b 00 06 2a}  //weight: 10, accuracy: High
        $x_10_2 = {0a 0a 02 06 6f ?? ?? ?? 0a 1f 09 9a}  //weight: 10, accuracy: Low
        $x_10_3 = {00 07 08 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 13 04 11 04 16 fe 02 13 05 11 05 2c 0c}  //weight: 10, accuracy: Low
        $x_1_4 = "AZXCCCCCCCCCCCCCCCCCCC" ascii //weight: 1
        $x_1_5 = "imimimimim" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "tf2modutil.Main.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CU_2147783512_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CU!MTB"
        threat_id = "2147783512"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 06 20 00 01 00 00 6f ?? ?? ?? ?? 00 06 20 ?? ?? ?? ?? 6f ?? ?? ?? ?? 00 7e 07 00 00 04 7e 06 00 00 04 20 ?? ?? ?? ?? 73 ?? ?? ?? ?? 0b 06 07 06 6f ?? ?? ?? ?? 1e 5b 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 00 06 07 06 6f ?? ?? ?? ?? 1e 5b 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 00 06 17 6f ?? ?? ?? ?? 00 02 06 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CT_2147783513_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CT!MTB"
        threat_id = "2147783513"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 20 00 01 00 00 6f ?? ?? ?? 0a 06 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 7e 04 00 00 04 7e 03 00 00 04 20 ?? ?? ?? 00 73 [0-6] 2d 43 26 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 02 06 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CS_2147783514_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CS!MTB"
        threat_id = "2147783514"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 10 00 00 8d ?? ?? ?? 01 0d 73 ?? ?? ?? 0a 0a 08 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 0b 07 16 fe 02 13 05 11 05 2c 09 06 09 16 07 6f ?? ?? ?? 0a 07 16 fe 02 13 06 11 06 2d d5 06 6f ?? ?? ?? 0a 13 04 de 11 06 2c 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQ_2147783515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQ!MTB"
        threat_id = "2147783515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 00}  //weight: 1, accuracy: High
        $x_1_2 = "AZXCCCCCCCCCCCCCCCCCCC" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
        $x_1_8 = "ColorConverter" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "imimimimim" ascii //weight: 1
        $x_1_12 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CR_2147783516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CR!MTB"
        threat_id = "2147783516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 18 1b 8d ?? ?? ?? 01 25 16 20 ?? ?? ?? ?? 28 ?? ?? ?? ?? a2 25 17 20 00 01 00 00 8c ?? ?? ?? ?? a2 25 1a 17 8d ?? ?? ?? 01 25 16 03 74 09 00 00 1b 28 ?? ?? ?? 06 a2 a2 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0b}  //weight: 10, accuracy: Low
        $x_1_2 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_3 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVI_2147783523_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVI!MTB"
        threat_id = "2147783523"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 03 a2 25 0d 14 14 17 8d ?? ?? ?? 01 25 16 17 9c 25 13 ?? 28 ?? ?? ?? 0a 11 ?? 16 91 2d ?? 2b ?? 09 16 9a}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BSO_2147783576_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BSO!MTB"
        threat_id = "2147783576"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 61 fe 0b 00 00 18 0c 2b ca 02 0a 06 2a}  //weight: 10, accuracy: High
        $x_10_2 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 7e ?? ?? ?? ?? 20 ?? ?? ?? ?? 7e ?? ?? ?? ?? 20 ?? ?? ?? ?? 93 05 60 1f 37 5f 9d 61 fe 0b 00 00 19 0c}  //weight: 10, accuracy: Low
        $x_10_3 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 61 fe 0b 00 00 16 0c 2b ca 02 0a 06}  //weight: 10, accuracy: High
        $x_2_4 = "WebRequest" ascii //weight: 2
        $x_2_5 = "WebResponse" ascii //weight: 2
        $x_2_6 = "GetResponse" ascii //weight: 2
        $x_2_7 = "Delay" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BRO_2147783617_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BRO!MTB"
        threat_id = "2147783617"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 0c 06 08 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 0d 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 09 16 09 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0b 07 13 04 2b 00 11 04 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "SmartExtensions" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BRP_2147783618_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BRP!MTB"
        threat_id = "2147783618"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {8a a7 28 c8 da 08 05 86 7a 54 a0 63 f7 ba 8f 7d}  //weight: 10, accuracy: High
        $x_1_2 = "flora" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "SmartExtensions" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BRM_2147783619_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BRM!MTB"
        threat_id = "2147783619"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "flora" ascii //weight: 1
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "SmartExtensions" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "TransformFinalBlock" ascii //weight: 1
        $x_1_8 = "RijndaelManaged" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "Replace" ascii //weight: 1
        $x_1_11 = "FormDelegates" ascii //weight: 1
        $x_1_12 = "OffsetMarshaler" ascii //weight: 1
        $x_1_13 = "ReturnMessage" ascii //weight: 1
        $x_1_14 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (13 of ($x*))
}

rule Trojan_MSIL_AgentTesla_BRN_2147783620_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BRN!MTB"
        threat_id = "2147783620"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 07 74 ?? ?? ?? 01 16 73 ?? ?? ?? 0a 0c 1a 8d ?? ?? ?? 01 0d 07 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 07 14 72 ?? ?? ?? 70 16 8d ?? ?? ?? 01 14 14 14 28 ?? ?? ?? 0a 1b 8c ?? ?? ?? 01 28 ?? ?? ?? 0a a2 14 14 28 f0 00 00 0a 00 07 28}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BRX_2147783621_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BRX!MTB"
        threat_id = "2147783621"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 16 8c ?? ?? ?? 01 a2 14 14 28 ?? ?? ?? 0a 07 17 da 17 d6 8d ?? ?? ?? 01 0c 11 07 14 [0-5] 28 ?? ?? ?? 06 19 8d ?? ?? ?? 01 25 16 08 a2 25 17 16 8c ?? ?? ?? 01 a2 25 18 07 8c ?? ?? ?? 01 a2 25 13 04 14 14 19 8d ?? ?? ?? 01 25 16 17 9c 25 18 17 9c 25}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SC_2147783639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SC!MTB"
        threat_id = "2147783639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1f 16 5d 91 61 07 11 04 17 58 09 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 13 08 07 11 07 11 08 9c 11 05 07 11 07 91 6f 59 00 00 0a 11 04 17 58 13 04 11 04 09 08 17 58 5a 32 a8}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SC_2147783639_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SC!MTB"
        threat_id = "2147783639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 06 17 58 13 0e 11 06 20 00 56 01 00 5d 13 0b 11 09 11 0b 91 13 0f 11 06 1f 16 5d 13 10 11 09 11 0b 11 0f 1f 16 8d 06 00 00 01 25 d0 15 00 00 04 28 ?? ?? ?? 0a 11 10 91 61 11 09 11 0e 20 00 56 01 00 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 11 06 17 58 13 06 11 06 20 00 56 01 00 fe 04 13 11 11 11 2d 97}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SC_2147783639_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SC!MTB"
        threat_id = "2147783639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 ec 8e fb 0e 0b 07 20 fb 8e fb 0e fe 01 13 09 11 09 2c 09 20 1c 8f fb 0e 0b 00 2b 1f 07 20 ce 8e fb 0e}  //weight: 10, accuracy: High
        $x_3_2 = "/c net start" wide //weight: 3
        $x_3_3 = "GetFileNameByURL" ascii //weight: 3
        $x_3_4 = "Rot13" ascii //weight: 3
        $x_3_5 = "7o0ULOkWyvHzY23Xr39X9HeK4UFuPVOtRlGLxRND7ZTVmrnF7O1cElZcdldOlzIJMI1zSxQZ7M28995777333aiiisr6B51BW" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GM_2147783693_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GM!MTB"
        threat_id = "2147783693"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DAL_Download_List_Generator" ascii //weight: 1
        $x_1_2 = "Activity Logger" ascii //weight: 1
        $x_1_3 = "Main_Screen" ascii //weight: 1
        $x_1_4 = "Position" ascii //weight: 1
        $x_1_5 = "Length" ascii //weight: 1
        $x_1_6 = "imimimimim" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GO_2147783695_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GO!MTB"
        threat_id = "2147783695"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$a44e10aa-e53f-4ff1-9a85-82455cb5176d" ascii //weight: 20
        $x_20_2 = "$ad4a9f59-8d68-4f83-a9df-1fc8d644edcd" ascii //weight: 20
        $x_20_3 = "$455efd69-1a49-41f0-85dd-6465eb9f05a1" ascii //weight: 20
        $x_20_4 = "$bc51761e-d3bc-4f7b-9407-56b3d9dae68e" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GP_2147783696_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GP!MTB"
        threat_id = "2147783696"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$9cfb954e-1378-42ee-9b44-1dbff7cabd53" ascii //weight: 20
        $x_20_2 = "$e9caaaf0-3035-4e04-ba34-c991c0a8785a" ascii //weight: 20
        $x_20_3 = "$b4f2edf6-f015-4900-87e5-ee23a0215d71" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CM_2147783698_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CM!MTB"
        threat_id = "2147783698"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "Low"
    strings:
        $x_20_1 = {ef ff ff 00 07 20 ?? ?? ?? ?? 5a 20 ?? ?? ?? ?? 61 ?? ?? ef ff ff}  //weight: 20, accuracy: Low
        $x_20_2 = {07 11 08 93 28 ?? ?? ?? 0a 13 0a 11 0a 07 32 0a 11 0a 08 fe 02 16 fe 01 2b 01 16 13 0b 11 0b 2c 21 11 0a 09 fe 02 13 0c 11 0c 2c 0a}  //weight: 20, accuracy: Low
        $x_1_3 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
        $x_1_4 = {44 00 53 00 44 00 53 00 [0-4] 44 00 65 00 5f 00 44 00 65 00 66 00 6c 00 61 00 74 00 65 00}  //weight: 1, accuracy: Low
        $x_1_5 = {44 53 44 53 [0-4] 44 65 5f 44 65 66 6c 61 74 65}  //weight: 1, accuracy: Low
        $x_1_6 = "GetFileNameByURL" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "De_Deflate" ascii //weight: 1
        $x_1_10 = "FromBase64" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
        $x_1_12 = "imimimimim" ascii //weight: 1
        $x_1_13 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 8 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CL_2147783699_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CL!MTB"
        threat_id = "2147783699"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ClassLibrary" ascii //weight: 1
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_7 = "Cryptography" ascii //weight: 1
        $x_1_8 = "get_BlockSize" ascii //weight: 1
        $x_1_9 = "Lo@d" ascii //weight: 1
        $x_1_10 = "Replace" ascii //weight: 1
        $x_1_11 = "the same age as" ascii //weight: 1
        $x_1_12 = {00 11 00 20 00 01 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CK_2147783700_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CK!MTB"
        threat_id = "2147783700"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "1efdd2e1-4a81-41f0-a0a1-f77ad51ce26f" ascii //weight: 1
        $x_1_2 = "ClassLibrary" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Cryptography" ascii //weight: 1
        $x_1_9 = "$$method0x60005c0-1" ascii //weight: 1
        $x_1_10 = "BindingFlags" ascii //weight: 1
        $x_1_11 = "NJK0HP6bbE" ascii //weight: 1
        $x_1_12 = "Replace" ascii //weight: 1
        $x_1_13 = "GetMethod" ascii //weight: 1
        $x_1_14 = "GZipStream" ascii //weight: 1
        $x_1_15 = "ToArray" ascii //weight: 1
        $x_1_16 = "AesCryptoServiceProvider" ascii //weight: 1
        $x_1_17 = "FromBase64String" ascii //weight: 1
        $x_1_18 = "LoadLibrary" ascii //weight: 1
        $x_1_19 = "GetType" ascii //weight: 1
        $x_1_20 = "$$method0x600039c-1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJ_2147783701_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJ!MTB"
        threat_id = "2147783701"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {06 17 58 0a 06 20 00 01 00 00 5d 0a 08 11 06 06 94 58 0c 08 20 00 01 00 00 5d 0c 11 06 06 94 13 04 11 06 06 11 06 08 94 9e 11 06 08 11 04 9e 11 06 11 06 06 94 11 06 08 94 58 20 00 01 00 00 5d 94 0d 11 07 07 03 07 91 09 61 d2 9c 07 17 58 0b 07 03 8e 69 3f}  //weight: 10, accuracy: High
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJ_2147783701_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJ!MTB"
        threat_id = "2147783701"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 1a 58 11 04 16 08 28 4a ?? ?? ?? 28 47 ?? ?? ?? 11 04 16 11 04 8e 69 6f 8a ?? ?? ?? 13 05 7e 19 ?? ?? ?? 11 05 6f 8b ?? ?? ?? 7e 1f ?? ?? ?? 02 6f 8c ?? ?? ?? 7e 19 ?? ?? ?? 6f 8d ?? ?? ?? 17 59 28 8e ?? ?? ?? 16 7e 1d ?? ?? ?? 02 1a 28 4a ?? ?? ?? 11 05}  //weight: 10, accuracy: Low
        $x_2_2 = "Debugger Detected" ascii //weight: 2
        $x_2_3 = "file:///" ascii //weight: 2
        $x_2_4 = "Location" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BSE_2147783707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BSE!MTB"
        threat_id = "2147783707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 16 2d c2 16 2c 22 26 09 16 2d d0 16 2d cd 08 31}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03 6f ?? ?? ?? 0a 17 da 16 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BSN_2147783708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BSN!MTB"
        threat_id = "2147783708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "5b24b9b8-b766-4a1a-b099-2590f8ed6108" ascii //weight: 10
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "DeflateStream" ascii //weight: 1
        $x_1_7 = "CompressionMode" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BTH_2147783709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BTH!MTB"
        threat_id = "2147783709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "arolF" ascii //weight: 1
        $x_1_2 = "dohteMteG" ascii //weight: 1
        $x_1_3 = "SmartExtensions" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "TransformFinalBlock" ascii //weight: 1
        $x_1_8 = "RijndaelManaged" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "Replace" ascii //weight: 1
        $x_1_11 = "OffsetMarshaler" ascii //weight: 1
        $x_1_12 = "ReturnMessage" ascii //weight: 1
        $x_1_13 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GQ_2147783746_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GQ!MTB"
        threat_id = "2147783746"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {14 0b 14 0c 19 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06 a2 0c 08 17 28 ?? ?? ?? 06 a2 08 18 72 ?? ?? ?? 70 a2 02 7b ?? ?? ?? 04 08 28 ?? ?? ?? 0a 26 08 18 9a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_10_2 = {03 16 1a 6f ?? ?? ?? 0a 0b 14 0c 14 0d 19 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06 a2 0d 09 17 28 ?? ?? ?? 06 a2 09 18 72 ?? ?? ?? 70 a2 02 7b ?? ?? ?? 04 09 28 ?? ?? ?? 0a 26 07 07 6f ?? ?? ?? 0a 13 04 12 04 28 ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_1_3 = "GetFileNameByURL" ascii //weight: 1
        $x_1_4 = "imimimimim" ascii //weight: 1
        $x_1_5 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GR_2147783747_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GR!MTB"
        threat_id = "2147783747"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BaseChannel.My" ascii //weight: 1
        $x_1_2 = "BaseChannel.Resources.resources" ascii //weight: 1
        $x_1_3 = "frontdesk_inventoryConnectionString" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "apple.com" ascii //weight: 1
        $x_1_6 = "Position" ascii //weight: 1
        $x_1_7 = "Length" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (8 of ($x*))
}

rule Trojan_MSIL_AgentTesla_GS_2147783748_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GS!MTB"
        threat_id = "2147783748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 02 08 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 03 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 d1 28 ?? ?? ?? 0a 13 04 06 11 04 6f ?? ?? ?? 0a 26 07 03 6f ?? ?? ?? 0a 17 59 fe 01 13 05 11 05}  //weight: 10, accuracy: Low
        $x_1_2 = "XOR_Decrypt" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "GZIDEKKKK" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GU_2147783750_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GU!MTB"
        threat_id = "2147783750"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$1bb09f35-4839-4c17-a8c0-7e287c9e6c9d" ascii //weight: 20
        $x_20_2 = "$61849258-72b9-4a0a-b31d-e25e4a6ba559" ascii //weight: 20
        $x_20_3 = "$8916a929-789d-4831-a7ea-dce1f99e1428" ascii //weight: 20
        $x_20_4 = "$2423b512-5e0c-49b1-801b-c9b7c23b2408" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_OXIE_2147783766_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OXIE!MTB"
        threat_id = "2147783766"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 07 11 08 93 28 ?? ?? ?? ?? 13 0a 11 0a 07 32 0a 11 0a 08 fe 02 16 fe 01 2b 01 16 13 0b 11 0b 2c 21 11 0a 09 fe 02 13 0c 11 0c 2c 0a 11 0a 1f 0d da 13 0a 00 2b 09 00 11 0a 1f 0d d6 13 0a 00 00 2b 38 11 0a 11 04 32 0b 11 0a 11 05 fe 02 16 fe 01 2b 01 16 13 0d 11 0d 2c 20 11 0a 11 06 fe 02 13 0e 11 0e 2c 0a 11 0a 1f 0d da 13 0a 00 2b 09 00 11 0a 1f 0d d6 13 0a 00 00 11 07 11 08 11 0a 28 ?? ?? ?? ?? 9d 11 08 17 d6 13 08 11}  //weight: 10, accuracy: Low
        $x_2_2 = "FromBase64CharArray" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BSV_2147783785_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BSV!MTB"
        threat_id = "2147783785"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 11 01 02 11 01 91 11 03 61 d2 9c}  //weight: 1, accuracy: High
        $x_1_2 = {11 02 11 06 11 00 94 58 13 02 38 ?? ?? ?? ?? 11 00 20 00 01 00 00 5d 13 00 20 01 00 00 00}  //weight: 1, accuracy: Low
        $x_1_3 = {11 06 11 06 11 00 94 11 06 11 02 94 58 20 00 01 00 00 5d 94 13 03 20 02 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BSU_2147783786_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BSU!MTB"
        threat_id = "2147783786"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "1bb09f35-4839-4c17-a8c0-7e287c9e6c9d" ascii //weight: 10
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "DeflateStream" ascii //weight: 1
        $x_1_7 = "CompressionMode" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GT_2147783873_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GT!MTB"
        threat_id = "2147783873"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 05 2c 14 09 72 ?? ?? ?? 70 07 08 1b 5b 18 58 93 28 ?? ?? ?? 0a 60 0d 20 ff 00 00 00 09 1f 0f 08 1b 5d 59 1e 59 1f 1f 5f 63 5f 0d 06 09 d2 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 26 00 08 1e 58 0c 08 02 6f ?? ?? ?? 0a 1b 5a fe 04 13 06 11 06 3a 67 ff ff ff}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Snake" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GV_2147783874_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GV!MTB"
        threat_id = "2147783874"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$3194e65d-cd2b-42c7-aa4f-be37cef83adc" ascii //weight: 20
        $x_20_2 = "$da725005-5c26-4376-ba26-2d210829b249" ascii //weight: 20
        $x_20_3 = "$b7caf5d6-14a5-4a00-b90a-911cf6369340" ascii //weight: 20
        $x_20_4 = "$b5fab614-ffdc-42f2-bc63-f1c3da132706" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GW_2147783875_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GW!MTB"
        threat_id = "2147783875"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$b8ac5745-516b-4766-98d9-e6b8572c50f7" ascii //weight: 20
        $x_20_2 = "$5b24b9b8-b766-4a1a-b099-2590f8ed6108" ascii //weight: 20
        $x_20_3 = "$658bb70c-fc0e-4d13-8c75-0f0620008de9" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 3 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_GZ_2147783876_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GZ!MTB"
        threat_id = "2147783876"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 00 01 00 00 5d 0c 07 09 94 13 04 07 09 07 08 94 9e 07 08 11 04 9e 07 07 09 94 07 08 94 58 20 00 01 00 00 5d 94 13 08 11 06 06 02 06 91 11 08 61 d2 9c 06 17 58 0a}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RWA_2147783935_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RWA!MTB"
        threat_id = "2147783935"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$69c6f83c-ace6-4eef-8e6b-e1906abe7e57" ascii //weight: 10
        $x_1_2 = "set_UseSystemPasswordChar" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "get_PharrmaPlusConnectionString" ascii //weight: 1
        $x_1_5 = "get_ResourceManager" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "get_OffsetMarshaler" ascii //weight: 1
        $x_1_8 = "FormDelegates" ascii //weight: 1
        $x_1_9 = "CipherMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BTM_2147784002_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BTM!MTB"
        threat_id = "2147784002"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {49 73 61 61 63 43 6f 72 65 00 43 6f 72 65}  //weight: 1, accuracy: High
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "CryptoStreamMode" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "KeySize" ascii //weight: 1
        $x_1_6 = "BlockSize" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "ToArray" ascii //weight: 1
        $x_1_9 = "add_AssemblyResolve" ascii //weight: 1
        $x_1_10 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BTN_2147784003_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BTN!MTB"
        threat_id = "2147784003"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {9e 02 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 58 20 00 01 00 00 5d 94 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 03 02 7b ?? ?? ?? 04 91 02 7b ?? ?? ?? 04 61 d2 9c 02 02 7b ?? ?? ?? 04 17 58 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 03 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_3 = "AssemblyResolve" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IA_2147784030_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IA!MTB"
        threat_id = "2147784030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 07 17 58 0b 07 02 6f ?? ?? ?? 0a 32 d5}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "xoredString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IA_2147784030_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IA!MTB"
        threat_id = "2147784030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "jfdsiofsdaof" ascii //weight: 20
        $x_20_2 = "jfaiawddkfk" ascii //weight: 20
        $x_20_3 = "hnbzdfikeao" ascii //weight: 20
        $x_20_4 = "jfseieofqwe" ascii //weight: 20
        $x_20_5 = "nsdgfjefuje2" ascii //weight: 20
        $x_20_6 = "mkjsefo3df" ascii //weight: 20
        $x_20_7 = "jgsdifsaofg2" ascii //weight: 20
        $x_20_8 = "jfdawdawo" ascii //weight: 20
        $x_20_9 = "nsdfujeiof21" ascii //weight: 20
        $x_1_10 = "VirtualProtect" ascii //weight: 1
        $x_1_11 = "ToBase64String" ascii //weight: 1
        $x_1_12 = "get_CurrentDomain" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
        $x_1_14 = "ResolveSignature" ascii //weight: 1
        $x_1_15 = "LoadModule" ascii //weight: 1
        $x_1_16 = "Convert" ascii //weight: 1
        $x_1_17 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 8 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IZ_2147784031_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IZ!MTB"
        threat_id = "2147784031"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 0c 11 12 11 0a 11 12 94 11 0b 11 12 94 58 9e 11 0d 11 0c 11 12 94 6c ?? ?? ?? ?? ?? ?? ?? ?? ?? 5b 58 13 0d 11 12 17 58 13 12 11 12 1b 32 d0}  //weight: 10, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "GetMember" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IY_2147784032_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IY!MTB"
        threat_id = "2147784032"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 4a 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 04 28 ?? ?? ?? 0a 20 ?? ?? ?? ?? da 1f 64 da 1f 1e d6 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d a7}  //weight: 10, accuracy: Low
        $x_1_2 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IB_2147784033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IB!MTB"
        threat_id = "2147784033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$15ba281e-3a99-482d-9b04-703a662e5d5b" ascii //weight: 20
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IB_2147784033_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IB!MTB"
        threat_id = "2147784033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_11_1 = "443ce222-e07f-4bc5-9b34-9908d06ca495" ascii //weight: 11
        $x_1_2 = "Bicera_Project_Finals" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Activator" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_13 = "GetBytes" ascii //weight: 1
        $x_1_14 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_11_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IC_2147784034_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IC!MTB"
        threat_id = "2147784034"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TwitDuel.UI.Properties.Resources.resources" ascii //weight: 1
        $x_1_2 = "set_TwitterClientUrl" ascii //weight: 1
        $x_1_3 = "l1lilliIililI" ascii //weight: 1
        $x_1_4 = "b948wmhny3g4rakaj6egvg8pwbf5tk55" ascii //weight: 1
        $x_1_5 = "ygmu3r9veejwjh7ja2pp2nyxk927suyl" ascii //weight: 1
        $x_1_6 = "Yedda.Twitter" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
        $x_1_9 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IC_2147784034_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IC!MTB"
        threat_id = "2147784034"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FromBase64String" ascii //weight: 1
        $x_1_2 = "StrReverse" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
        $x_1_8 = "imimimimim" ascii //weight: 1
        $x_1_9 = "GetObjectValue" ascii //weight: 1
        $x_1_10 = "GetFileNameByURL" ascii //weight: 1
        $x_1_11 = "BVIPM_Local" ascii //weight: 1
        $x_1_12 = "IExpando.Plug" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BVI_2147784053_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BVI!MTB"
        threat_id = "2147784053"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 c8 00 00 00 da 1f 64 da 1f 1e d6 20 90 01 00 00 da}  //weight: 10, accuracy: High
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
        $x_1_8 = "IExpando.Plug" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BVI_2147784053_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BVI!MTB"
        threat_id = "2147784053"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "36"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 61 7a 78 00 43 6f 6e 74 61 69 6e 65 72 00}  //weight: 10, accuracy: High
        $x_10_2 = {00 44 53 44 53 00 53 00 59 72 64 61 00}  //weight: 10, accuracy: High
        $x_10_3 = {00 69 6d 69 6d 69 6d 69 6d 69 6d 00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 10, accuracy: High
        $x_1_4 = "ObsoleteAttribute" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HHS_2147784058_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HHS!MTB"
        threat_id = "2147784058"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a dd ?? ?? ?? ?? 08 39 ?? ?? ?? ?? 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d dd ?? ?? ?? ?? 07 39 ?? ?? ?? ?? 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "ClassLibrary1.Strategies.EventVisitorStrategy" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ID_2147784091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ID!MTB"
        threat_id = "2147784091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 05 00 00 06 72 63 04 00 70 72 67 04 00 70 6f 7c 00 00 0a 17 8d 57 00 00 01 25 16 1f 2d 9d 6f 7d 00 00 0a 0b 07 8e 69 8d 58 00 00 01 0c 16 13 07 2b 15}  //weight: 1, accuracy: High
        $x_1_2 = {08 11 07 07 11 07 9a 1f 10 28 7e 00 00 0a 9c 11 07 17 58 13 07 11 07 07 8e 69 fe 04 13 08 11 08 2d de}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ID_2147784091_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ID!MTB"
        threat_id = "2147784091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$1efdd2e1-4a81-41f0-a0a1-f77ad51ce26f" ascii //weight: 1
        $x_1_2 = "ClassLibrary" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "BindingFlags" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
        $x_1_10 = "ToString" ascii //weight: 1
        $x_1_11 = "ToArray" ascii //weight: 1
        $x_1_12 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ID_2147784091_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ID!MTB"
        threat_id = "2147784091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$5750521f-7f37-4e6a-88a2-c51522992705" ascii //weight: 20
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "Activator" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IE_2147784092_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IE!MTB"
        threat_id = "2147784092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {8e 69 17 da 0c 16 0d ?? ?? 05 2b ?? 06 ?? ?? ?? ?? ?? 09 06 ?? ?? ?? ?? ?? 09 91 7e ?? ?? ?? ?? 7e ?? ?? ?? ?? 6f ?? ?? ?? ?? 74 ?? ?? ?? ?? 07 09 28 ?? ?? ?? ?? 9c ?? 13 05 38 ?? ff ff ff 09 17 d6 0d ?? 13 05 38 ?? ff ff ff 09 08}  //weight: 10, accuracy: Low
        $x_10_2 = {8e 69 17 da 0c 16 ?? 2b ?? 06 09 06 09 91 7e ?? ?? ?? ?? 7e ?? ?? ?? ?? 6f ?? ?? ?? ?? 74 ?? ?? ?? ?? 07 09 28 ?? ?? ?? ?? 9c 09 17 d6 0d 09 08 31 d7}  //weight: 10, accuracy: Low
        $x_1_3 = "WebResponse" ascii //weight: 1
        $x_1_4 = "GetResponse" ascii //weight: 1
        $x_1_5 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IE_2147784092_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IE!MTB"
        threat_id = "2147784092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "37"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "ggvEOvpEbhV6UOmm05" ascii //weight: 10
        $x_10_2 = "XNTbl8Vbks8sffuIyA" ascii //weight: 10
        $x_10_3 = "Ui9mHyubhFapqRX4dd" ascii //weight: 10
        $x_10_4 = "p1c1CB7yxj3tVNih61" ascii //weight: 10
        $x_10_5 = "kf9SCtcx4iWQKIiGiW" ascii //weight: 10
        $x_10_6 = "aCaDLaZVurEb0BF6Zu" ascii //weight: 10
        $x_10_7 = "nWmHsHcZohSYIXugGBP" ascii //weight: 10
        $x_10_8 = "VfJqeOcX98g3AdTKs4m" ascii //weight: 10
        $x_10_9 = "qurRDkcHLlVH2pscGvi" ascii //weight: 10
        $x_1_10 = "kLjw4iIsCLsZtxc4lksN0j" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DownloadFile" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "MemoryStream" ascii //weight: 1
        $x_1_15 = "Reverse" ascii //weight: 1
        $x_1_16 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 7 of ($x_1_*))) or
            ((4 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IF_2147784093_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IF!MTB"
        threat_id = "2147784093"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 17 58 7d ?? ?? ?? 04 02 02 7b ?? ?? ?? 04 20 ?? ?? ?? 00 5d 7d ?? ?? ?? 04 02 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 58 7d ?? ?? ?? 04 02 02 7b ?? ?? ?? 04 20 ?? ?? ?? 00 5d 7d ?? ?? ?? 04 02 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b}  //weight: 10, accuracy: Low
        $x_10_2 = {04 94 9e 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 9e 02 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 58 20 ?? ?? ?? 00 5d 94 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 03 02 7b ?? ?? ?? 04 91 02 7b ?? ?? ?? 04 61 d2 9c 02 02 7b ?? ?? ?? 04 17 58 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 03 8e 69}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IH_2147784094_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IH!MTB"
        threat_id = "2147784094"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 03 02 7b ?? ?? ?? 04 91 02 7b ?? ?? ?? 04 61 d2 9c}  //weight: 10, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IL_2147784095_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IL!MTB"
        threat_id = "2147784095"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 dd a2 fd 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 75 00 00 00 18}  //weight: 10, accuracy: High
        $x_1_2 = "$a47fa15e-e997-4e96-9329-8bcea48ec378" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "GetTypes" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "MemoryStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IL_2147784095_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IL!MTB"
        threat_id = "2147784095"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 c8 00 00 00 da 1f 64 da 1f 1e d6 20 90 01 00 00 da}  //weight: 10, accuracy: High
        $x_1_2 = "IExpando.Plug" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IN_2147784096_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IN!MTB"
        threat_id = "2147784096"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {57 ff a2 3f 09 1f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 0d 01 00 00 af 02 00 00 c8 05 00 00 ?? 0d 00 00 ?? 07 00 00 7b 00 00 00 ?? 03 00 00 10 00 00 00}  //weight: 10, accuracy: Low
        $x_1_2 = "SharpRpc.Properties.Resources" wide //weight: 1
        $x_1_3 = "Run Once Wrapper" ascii //weight: 1
        $x_1_4 = "GetDomain" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IN_2147784096_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IN!MTB"
        threat_id = "2147784096"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 00}  //weight: 1, accuracy: High
        $x_1_2 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "GetFileNameByURL" ascii //weight: 1
        $x_1_8 = "Create__Instance__" ascii //weight: 1
        $x_1_9 = "DeflateStream" ascii //weight: 1
        $x_1_10 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00 61 7a 78 00}  //weight: 1, accuracy: High
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = {4c 6f 61 64 00 73 61 64}  //weight: 1, accuracy: High
        $x_1_13 = "DebuggableAttribute" ascii //weight: 1
        $x_1_14 = "imimimimim" ascii //weight: 1
        $x_1_15 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_16 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BUV_2147784102_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BUV!MTB"
        threat_id = "2147784102"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {78 78 00 58 58 58 58 58 58 58 58 58 58 00 74 00 57 5f 53}  //weight: 10, accuracy: High
        $x_10_2 = {54 65 78 54 00 54 72 61 6e 73 66 6f 72 6d}  //weight: 10, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BUS_2147784103_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BUS!MTB"
        threat_id = "2147784103"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26 09 18 d6 0d 09 08 3e}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da 17 d6 8d ?? ?? ?? 01 0d 02 8e 69 17 da}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HGN_2147784104_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HGN!MTB"
        threat_id = "2147784104"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 03 a2 14 14 14 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0a 02 06 72 ?? ?? ?? 70 18 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 7d ?? ?? ?? 04 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BVW_2147784105_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BVW!MTB"
        threat_id = "2147784105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "44"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 48 65 78 32 53 74 72 69 6e 67 00 69 6e 70 75 74 00}  //weight: 10, accuracy: High
        $x_10_2 = {00 78 78 00 58 58 58 58 58 58 58 58 58 58 00}  //weight: 10, accuracy: High
        $x_10_3 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 5f 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 10, accuracy: High
        $x_10_4 = {00 54 65 78 54 00 54 72 61 6e 73 66 6f 72 6d 00}  //weight: 10, accuracy: High
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IG_2147784175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IG!MTB"
        threat_id = "2147784175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {38 88 02 00 00 [0-64] 38 ?? ?? ?? 00 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 9e 38 ?? ?? ?? 00 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 9e 38}  //weight: 10, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IG_2147784175_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IG!MTB"
        threat_id = "2147784175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 16 20 00 b0 02 00 8d ?? ?? ?? ?? a2 06 17 00 20 67 02 00 00 20 4a 02 00 00 28 ?? ?? ?? ?? a2 06 18 06 17 9a 14}  //weight: 1, accuracy: Low
        $x_1_2 = "ToInt32" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_II_2147784176_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.II!MTB"
        threat_id = "2147784176"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 07 07 11 13 20 ?? ?? ?? ff 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 9e 11 07 07 8f ?? ?? ?? 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 11 07 07 94 1f 9c 32 0e 11 07 07 94 1f 64 30 06 11 11 17 58 13 11 07 17 58 0b 07 11 07 8e 69 32 ae}  //weight: 10, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_II_2147784176_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.II!MTB"
        threat_id = "2147784176"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 dd a2 ff 09 0e 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 71 00 00 00 26 00 00 00 db 00 00 00 12 02 00 00 a7}  //weight: 10, accuracy: High
        $x_10_2 = {57 df a2 ff 09 0e 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 77 00 00 00 2b 00 00 00 e1 00 00 00 43 02 00 00 b5}  //weight: 10, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DownloadFile" ascii //weight: 1
        $x_1_6 = "GetTempPath" ascii //weight: 1
        $x_1_7 = "UploadFile" ascii //weight: 1
        $x_1_8 = "Reverse" ascii //weight: 1
        $x_1_9 = "ZipFile" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IJ_2147784177_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IJ!MTB"
        threat_id = "2147784177"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 02 08 17 58 8f ?? ?? ?? 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 16 31 30 06 08 02 08 a3 ?? ?? ?? 02 a4 ?? ?? ?? 02 02 08 02 08 17 58 a3 ?? ?? ?? 02 a4 ?? ?? ?? 02 02 08 17 58 06 08 a3 ?? ?? ?? 02 a4 ?? ?? ?? 02 17 0b 08 17 58 0c 08 02 8e 69 17 59 32 a2}  //weight: 10, accuracy: Low
        $x_10_2 = {fe 0c 0c 00 fe ?? ?? 00 fe ?? ?? 00 fe ?? ?? 00 94 fe ?? ?? 00 fe ?? ?? 00 94 58 9e fe ?? ?? ?? fe ?? ?? ?? ?? ?? ?? ?? 94 6c ?? ?? ?? ?? ?? ?? ?? ?? ?? 5b 58 fe ?? ?? ?? fe ?? ?? ?? 20 ?? ?? ?? 00 58 fe ?? ?? ?? ?? ?? ?? ?? 20 ?? ?? ?? 00 3f}  //weight: 10, accuracy: Low
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BWK_2147784179_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BWK!MTB"
        threat_id = "2147784179"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 17 58 0d 09 20 00 01 00 00 5d 0d 08 07 09 94 58 0c 08 20 00 01 00 00 5d 0c 07 09 94 [0-2] 07 09 07 08 94 9e 07 08 [0-2] 9e 07 07 09 94 07 08 94 58 20 00 01 00 00 5d 94}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BVV_2147784208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BVV!MTB"
        threat_id = "2147784208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 c8 00 00 00 da 1f 64 da 1f 1e d6 20 90 01 00 00 da}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BFP_2147784209_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BFP!MTB"
        threat_id = "2147784209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 03 11 04 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 04 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 b7 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BWW_2147784712_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BWW!MTB"
        threat_id = "2147784712"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 94 02 7b ?? ?? ?? 0a 02 7b ?? ?? ?? 0a 94 58 20 00 01 00 00 5d 94 7d ?? ?? ?? 0a 02 7b ?? ?? ?? 0a 02 7b ?? ?? ?? 0a 03 02 7b ?? ?? ?? 0a 91 02 7b ?? ?? ?? 0a 61 d2 9c 02 02 7b ?? ?? ?? 0a 17 58 7d ?? ?? ?? 0a 02 7b ?? ?? ?? 0a 03 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_3 = "AssemblyResolve" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BWV_2147784713_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BWV!MTB"
        threat_id = "2147784713"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 48 65 78 32 53 74 72 69 6e 67 00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_2 = "ToCharArray" ascii //weight: 1
        $x_1_3 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 5f 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "dohteMteG" ascii //weight: 1
        $x_1_7 = "arolF" ascii //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IK_2147784817_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IK!MTB"
        threat_id = "2147784817"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 9d a2 3d 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 60 00 00 00 19 00 00 00 4c 00 00 00 a1 01 00 00 37}  //weight: 10, accuracy: High
        $x_1_2 = "MemoryStream" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "get_CurrentDomain" ascii //weight: 1
        $x_1_5 = "IsLogging" ascii //weight: 1
        $x_1_6 = "ConfuserEx" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IK_2147784817_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IK!MTB"
        threat_id = "2147784817"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 16 06 8e 69 6f ?? ?? ?? 0a 0d 09 8e 69 1f 10 59 8d ?? ?? ?? ?? 13 04 09 1f 10 11 04 16 09 8e 69 1f 10 59 1f 10 58 1f 10 59 28}  //weight: 10, accuracy: Low
        $x_1_2 = {00 6f 00 45 00 69 00 62 00 72 00 36 00 34 00 31 00 56 00 4e 00 45 00 42 00 32 00 59 00 75 00 78 00 42 00 6b 00 38 00 4f 00 30 00 53 00 74 00 4d}  //weight: 1, accuracy: High
        $x_1_3 = "57H3FNPC54JHXFFF8DC347" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IK_2147784817_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IK!MTB"
        threat_id = "2147784817"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 10 00 00 8d 0c 00 00 01 13 ?? 73}  //weight: 10, accuracy: Low
        $x_1_2 = "Freyja the Freyka" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
        $x_1_7 = "Collect" ascii //weight: 1
        $x_1_8 = {00 33 32 30 31 32 32 32 33 35 39 35 39 5a 30}  //weight: 1, accuracy: High
        $x_1_9 = "GetMethod" ascii //weight: 1
        $x_1_10 = "GetEnumerator" ascii //weight: 1
        $x_1_11 = "UnaryOperation" ascii //weight: 1
        $x_1_12 = "AddRange" ascii //weight: 1
        $x_1_13 = "MethodInvoker" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IO_2147784818_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IO!MTB"
        threat_id = "2147784818"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 9f a2 3f 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 b1 00 00 00 29 00 00 00 41 01 00 00}  //weight: 10, accuracy: High
        $x_10_2 = {57 97 a2 3f 09 0b 00 00 00 00 00 00 00 00 00 00 01 00 00 00 b7 00 00 00 35 00 00 00 71 01 00 00}  //weight: 10, accuracy: High
        $x_1_3 = "$b9b06652-aa79-4e39-a53c-06794b100f74" ascii //weight: 1
        $x_1_4 = "TrafficSimulation.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_IO_2147784818_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IO!MTB"
        threat_id = "2147784818"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "d0d2cfbb-c06c-4dbe-af8a-ae0fbb6a2db0" ascii //weight: 1
        $x_1_2 = "KUI Sole" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
        $x_1_4 = "GetString" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "RijndaelManaged" ascii //weight: 1
        $x_1_8 = "TransformFinalBlock" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IP_2147784819_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IP!MTB"
        threat_id = "2147784819"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 07 11 0a 03 11 0a 91 11 03 61 d2 9c 20 16 00 00 00 38 e2 fe ff ff}  //weight: 10, accuracy: High
        $x_1_2 = "15620c03-1547-4fe8-b4b5-8254aa5e153c" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IQ_2147784820_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IQ!MTB"
        threat_id = "2147784820"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 06 07 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 0c 02 0d 08 09 16 09 8e b7 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "c_AntiKill" ascii //weight: 1
        $x_1_4 = "c_ImAntiKill" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IR_2147784821_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IR!MTB"
        threat_id = "2147784821"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 03 a2 14 14 14 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0a 02 06 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 7d ?? ?? ?? 04 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "S0.EO" ascii //weight: 1
        $x_1_3 = "imimimimim" ascii //weight: 1
        $x_1_4 = "ObsAttribute" ascii //weight: 1
        $x_1_5 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00 61 7a 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XA_2147785013_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XA!MTB"
        threat_id = "2147785013"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 11 08 6f ?? ?? ?? 0a 13 09 11 04 11 09 28 ?? ?? ?? 0a 11 05 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 00 11 08 17 d6 13 08 11 08 11 07 6f ?? ?? ?? 0a fe 04 13 0a 11 0a 2d c0}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateImageFromBase64" ascii //weight: 1
        $x_1_3 = "Base64Data" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IT_2147785016_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IT!MTB"
        threat_id = "2147785016"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Testing" ascii //weight: 1
        $x_1_2 = "AZZZZZZZZZZZZZZZZ23" ascii //weight: 1
        $x_1_3 = "Hex2String" ascii //weight: 1
        $x_1_4 = {00 53 5f 53 5f 53 00 73 00 64 00 58 44 41 53 58 41 58 41 58 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 73 74 72 00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_6 = "Reflection" ascii //weight: 1
        $x_1_7 = {00 41 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 32 33 00 54 79 70 65 00 78 7a 00}  //weight: 1, accuracy: High
        $x_1_8 = "toolStripMenuItem1_Click" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_10 = "Split" ascii //weight: 1
        $x_1_11 = "BeginInit" ascii //weight: 1
        $x_1_12 = "FromBase64String" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "DebuggableAttribute" ascii //weight: 1
        $x_1_15 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_16 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IU_2147785017_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IU!MTB"
        threat_id = "2147785017"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 03 a2 14 14 14 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0a 02 06 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 7d ?? ?? ?? 04 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "S0.EO" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ParamArray0" ascii //weight: 1
        $x_1_5 = "ArrayAttribute" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetObjectValue" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BXB_2147785227_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BXB!MTB"
        threat_id = "2147785227"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 1f 64 73 ?? ?? ?? 0a 1f 10 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0b 07 02 16 02 8e 69 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a de 0a 07 2c 06 07 6f ?? ?? ?? 0a dc 06 6f ?? ?? ?? 0a 0c de 0a}  //weight: 10, accuracy: Low
        $x_10_2 = {07 1f 64 73 ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 09 20 00 01 00 00 6f ?? ?? ?? 0a 09 17 6f ?? ?? ?? 0a 03 2d 11 09 08 1f 10 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 2b 0f 09 08 1f 10 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 13 04 73 ?? ?? ?? 0a 13 05}  //weight: 10, accuracy: Low
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "RijndaelManaged" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BXD_2147785228_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BXD!MTB"
        threat_id = "2147785228"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 17 8d ?? ?? ?? 01 25 16 07 6f ?? ?? ?? 0a a2 0d de 1e 08 2c 06 08 6f ?? ?? ?? 0a dc 07 2c 06 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IV_2147785229_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IV!MTB"
        threat_id = "2147785229"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_2 = "AZZZZZZZZZZZZZZZZ23" ascii //weight: 1
        $x_1_3 = "Hex2String" ascii //weight: 1
        $x_1_4 = {00 58 44 41 53 58 41 58 41 58 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_6 = "Reflection" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "Split" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "FromBase64" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_14 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZA_2147785260_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZA!MTB"
        threat_id = "2147785260"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 94 9e 7e ?? ?? ?? 04 7e ?? ?? ?? 04 7e ?? ?? ?? 04 9e 7e ?? ?? ?? 04 7e ?? ?? ?? 04 7e ?? ?? ?? 04 94 7e ?? ?? ?? 04 7e ?? ?? ?? 04 94 58 20 00 01 00 00 5d 94 80 ?? ?? ?? 04 7e ?? ?? ?? 04 7e ?? ?? ?? 04 02 50 7e ?? ?? ?? 04 91 7e ?? ?? ?? 04 61 d2 9c 7e ?? ?? ?? 04 17 58 80 ?? ?? ?? 04 7e ?? ?? ?? 04 02 50 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IS_2147785347_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IS!MTB"
        threat_id = "2147785347"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 47 65 74 54 65 78 74 46 72 6f 6d 4c 69 6e 65 00 4c 69 6e 65 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 70 32 00 4f 50 00 61 7a 00 61 7a 78 00 43 6f 6e 74 61 69 6e 65 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 70 31 00 69 6d 69 6d 69 6d 69 6d 69 6d 00 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 78 00 6b 00 44 53 44 53 00 53 00}  //weight: 1, accuracy: High
        $x_1_4 = "ObsAttribute" ascii //weight: 1
        $x_1_5 = "FileName" ascii //weight: 1
        $x_1_6 = "GetObjectValue" ascii //weight: 1
        $x_1_7 = "ParamArray0" ascii //weight: 1
        $x_1_8 = "ArrayAttribute" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_15 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_16 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_17 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_18 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZN_2147785349_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZN!MTB"
        threat_id = "2147785349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "35"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "6E 4E 49 62 67 42 54 4D 30 68 56 47 68 70 63 79 42 77 63 6D 39 6E 63 6D 46 74 49 47 4E 68 62 6D 35 76 64 43 42 69" ascii //weight: 10
        $x_10_2 = "79 64 57 34 67 61 57 34 67 52 45 39 54 49 47 31 76 5A 47 55 75 44 51 30 4B 4A" ascii //weight: 10
        $x_10_3 = "42 51 52 51 --54 -45 44 -4F 44 70 4C" ascii //weight: 10
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetResourceString" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "NewLateBinding" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZM_2147785350_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZM!MTB"
        threat_id = "2147785350"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26 38}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03 28 ?? ?? ?? 06 17 da}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZ_2147786224_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZ!MTB"
        threat_id = "2147786224"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 02 72 ?? ?? ?? ?? 15 16 28 ?? ?? ?? ?? 0a 06 13 05 16 13 04 2b 29 11 05 11 04 9a 0d 08 72 ?? ?? ?? ?? 09 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 26 11 04 17 d6 13 04 00 11 04 11 05 8e b7 fe 04 13 06 11 06 2d c9 08 6f ?? ?? ?? ?? 0b 2b 00 07 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZ_2147786224_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZ!MTB"
        threat_id = "2147786224"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "EbvsOCcOBZhzqaH" ascii //weight: 2
        $x_1_2 = "=====M============a==============i=============n=========" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IW_2147786225_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IW!MTB"
        threat_id = "2147786225"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 07 11 01 02 11 01 91 11 03 61 d2 9c}  //weight: 10, accuracy: High
        $x_10_2 = {0b 07 16 73 ?? ?? ?? 0a 0c 20 00 00 10 00 8d ?? ?? ?? 01 0d}  //weight: 10, accuracy: Low
        $x_1_3 = "ClassLibrary" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JAA_2147786226_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAA!MTB"
        threat_id = "2147786226"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 13 06 06 11 06 28 ?? ?? ?? 0a 11 05 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 07 17 d6 0b 07 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d c9}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAB_2147786227_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAB!MTB"
        threat_id = "2147786227"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 06 07 61 0c 73 ?? ?? ?? 0a 25 72 ?? ?? ?? 70 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 25 72 ?? ?? ?? 70 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 25 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0d 72 ?? ?? ?? 70 12 02 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 06 66 0c 72 ?? ?? ?? 70 12 02 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 06 18 62 0c 72 ?? ?? ?? 70 12 02 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 06 18 63 0c 09 6f}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAC_2147786228_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAC!MTB"
        threat_id = "2147786228"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "46"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {8a 00 42 5f d8 a8 00 6b 00 58 58 00 58 58 58 00 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4}  //weight: 10, accuracy: High
        $x_10_2 = {a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 00 78 00 50 6f 69 6e 74 00 70 31 00 d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9}  //weight: 10, accuracy: High
        $x_10_3 = {b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 00 53 00 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5}  //weight: 10, accuracy: High
        $x_10_4 = {ab d8 ab d8 ab d8 ab 00 d8 a1 d8 a1 d8 a1 d8 a1 d8}  //weight: 10, accuracy: High
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "GetObjectValue" ascii //weight: 1
        $x_1_8 = "ParamArray0" ascii //weight: 1
        $x_1_9 = "ArrayAttribute" ascii //weight: 1
        $x_1_10 = "NewLateBinding" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAD_2147786229_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAD!MTB"
        threat_id = "2147786229"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {7e 04 00 00 04 91 7e ?? ?? ?? 04 61 d2 9c}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAE_2147786230_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAE!MTB"
        threat_id = "2147786230"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 14 0d 02 8e b7 16 31 47 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 13 04 73 ?? ?? ?? 0a 11 04 16 11 04 8e b7 6f ?? ?? ?? 0a 13 05 08 11 05 6f ?? ?? ?? 0a 08 18 6f ?? ?? ?? 0a 08 17 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 02 16 02 8e b7 6f ?? ?? ?? 0a 0d 09 0a de 0c de 0a}  //weight: 10, accuracy: Low
        $x_10_2 = {02 8e b7 16 3e ?? ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe}  //weight: 10, accuracy: Low
        $x_1_3 = "AESDecryption" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JAH_2147786231_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAH!MTB"
        threat_id = "2147786231"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "54"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {95 db 95 db 95 db 95 00 70 32 00 58 5f d8 a2 00 6f 77 00 43 5f d8 b5 00 d8 ab d8 ab}  //weight: 10, accuracy: High
        $x_10_2 = {ab d8 ab d8 ab d8 ab d8 ab 00 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1}  //weight: 10, accuracy: High
        $x_10_3 = {a1 d8 a1 d8 a1 d8 a1 d8 a1 d8 a1 00 50 6f 69 6e 74 00 70 31 00 d9 8a d9 8a d9 8a d9}  //weight: 10, accuracy: High
        $x_10_4 = {8a d9 8a d9 8a d9 8a d9 8a 00 42 5f d8 a8 00 6b 00 58 58 00 58 58 58 00 d8 b4 d8 b4}  //weight: 10, accuracy: High
        $x_10_5 = {b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 00 4c 69 6e 65}  //weight: 10, accuracy: High
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "ParamArray0" ascii //weight: 1
        $x_1_9 = "ArrayAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAI_2147786232_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAI!MTB"
        threat_id = "2147786232"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a 16 0b 2b 22 06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 07 17 58 0b 07 02 6f ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_1_2 = {00 73 74 72 69 6e 67 4b 65 79 00 47 65 74 45 78 65 63 75 74 69 6e 67 41 73 73 65 6d 62 6c 79 00}  //weight: 1, accuracy: High
        $x_1_3 = "LoadLibrary" ascii //weight: 1
        $x_1_4 = "SystemServiceModelChannels" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BYZ_2147786240_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BYZ!MTB"
        threat_id = "2147786240"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 03 a2 14 14 14 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0a 02 06 6f ?? ?? ?? 0a 1f 0a 9a 7d ?? ?? ?? 04 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "GetResourceString" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "NewLateBinding" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "GameDots" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BYY_2147786241_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BYY!MTB"
        threat_id = "2147786241"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "32"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "54 56 71 51 41 41 4D 41 41 41 41 45 41 41 41 41 2F 2F 38 41" ascii //weight: 10
        $x_10_2 = "49 62 67 42 54 4D 30 68 56 47 68 70 63 79 42 77 63 6D 39 6E 63 6D 46 74 49 47 4E 68 62 6D 35 76" ascii //weight: 10
        $x_10_3 = "64 43 42 69 5A 53 42 79 64 57 34 67 61 57 34 67 52" ascii //weight: 10
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetResourceString" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "NewLateBinding" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "GameDots" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_BYQ_2147786242_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BYQ!MTB"
        threat_id = "2147786242"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 02 50 7e ?? ?? ?? 04 91 7e ?? ?? ?? 04 61 d2 9c 38 ?? ?? ?? ?? 7e ?? ?? ?? 04 02 50 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZK_2147786243_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZK!MTB"
        threat_id = "2147786243"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 02 50 7e ?? ?? ?? 04 91 7e ?? ?? ?? 04 61 d2 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "AssemblyResolve" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZL_2147786244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZL!MTB"
        threat_id = "2147786244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c 11 07 03 28 ?? ?? ?? 06 17 da}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAH_2147786245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAH!MTB"
        threat_id = "2147786245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {05 03 05 8e 69 5d 91 04 03 1f 16 5d 91 61 28 ?? 00 00 06 05 03 17 58 05 8e 69 5d 91 28 ?? 00 00 06 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 0a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAH_2147786245_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAH!MTB"
        threat_id = "2147786245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 6f ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 08 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 11 04 17 d6 13 04 11 04 09 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d c5}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAF_2147786246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAF!MTB"
        threat_id = "2147786246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c}  //weight: 1, accuracy: High
        $x_1_2 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAF_2147786246_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAF!MTB"
        threat_id = "2147786246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {2b 1d 12 03 2b 1c 2b 21 07 02 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a de 20 08 2b e0 28 ?? 00 00 0a 2b dd 06 2b dc}  //weight: 4, accuracy: Low
        $x_1_2 = "ToByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAF_2147786246_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAF!MTB"
        threat_id = "2147786246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 1f 10 28 ?? ?? ?? 06 d1 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "ToInt32" ascii //weight: 1
        $x_1_7 = "get_OffsetMarshaler" ascii //weight: 1
        $x_1_8 = "get_ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAI_2147786247_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAI!MTB"
        threat_id = "2147786247"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0d 16 13 06 2b 1b 09 11 06 08 11 06 9a 1f 10 28 ?? 00 00 0a d2 6f ?? 00 00 0a 00 11 06 17 58 13 06 11 06 08 8e 69 fe 04 13 07 11 07 2d d8}  //weight: 3, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "ToSByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAI_2147786247_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAI!MTB"
        threat_id = "2147786247"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "42"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a d9 8a}  //weight: 10, accuracy: High
        $x_10_2 = {db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95 db 95}  //weight: 10, accuracy: High
        $x_10_3 = {d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5 d8 b5}  //weight: 10, accuracy: High
        $x_10_4 = {d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4 d8 b4}  //weight: 10, accuracy: High
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetResourceString" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JAK_2147786248_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAK!MTB"
        threat_id = "2147786248"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 10 00 00 8d ?? ?? ?? 01 0b 73 ?? ?? ?? 0a 0c [0-2] 06 07 16 20 00 10 00 00 6f ?? ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 00 08 07 16 09 6f ?? ?? ?? 0a [0-3] 09 16 fe 02 13 05 11 05 2d d0 08 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "VerifyDetails" ascii //weight: 1
        $x_1_3 = "DB_Finder" ascii //weight: 1
        $x_1_4 = "Analyise" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAK_2147786248_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAK!MTB"
        threat_id = "2147786248"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 28 ?? ?? ?? ?? 13 05 11 05 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 11 06 2c 33 00 06 06 6f ?? ?? ?? 0a 19 8d ?? ?? ?? ?? 25 16 12 05 28}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 0c 06 16 73 ?? ?? ?? 0a 0d 00 08 8d ?? ?? ?? 01 13 04 09 11 04 16 08 6f ?? ?? ?? 0a 26 11 04 13 05 de 16}  //weight: 1, accuracy: Low
        $x_1_3 = {09 11 05 02 11 05 91 08 61 06 11 04 91 61 d2 9c 11 04 03 6f ?? ?? ?? 0a 17 59 fe 01 16 fe 01 13 06 11 06 2c 0a}  //weight: 1, accuracy: Low
        $x_1_4 = "Resource_Meter" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CBD_2147786356_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CBD!MTB"
        threat_id = "2147786356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 6f ?? ?? ?? 0a 13 05 07 11 05 08 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 11 04 17 d6 13 04 11 04 09 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d ca}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CBD_2147786356_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CBD!MTB"
        threat_id = "2147786356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 53 00 50 72 6f 54 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 48 75 6e 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 61 6c 6c 73 74 61 63 6b 00 4b 69 63 6b 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 63 6f 6c 6f 72 00 52 65 74 75 72 6e 45 72 72 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_8 = "FromBase64" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "GetTypes" ascii //weight: 1
        $x_1_11 = "ParamArray0" ascii //weight: 1
        $x_1_12 = "ArrayAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XB_2147786431_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XB!MTB"
        threat_id = "2147786431"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 02 17 8d ?? ?? ?? 01 25 16 1f 2d 9d 6f ?? ?? ?? 0a 0b 00 07 0c 16 0d 2b 1c 08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 6f ?? ?? ?? 0a 26 00 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "Hex2String" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XB_2147786431_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XB!MTB"
        threat_id = "2147786431"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {18 0c 12 02 28 ?? ?? ?? 0a 16 28 ?? ?? ?? 0a 16 fe 01 0b 07 2c 0c 72 ?? ?? ?? ?? 28 ?? ?? ?? 0a 00 00 00 02 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = {45 00 41 00 4c 00 67 00 41 00 7a 00 41 00 43 00 34 00 41 00 4d 00 30 06 75 00 41 00 44 00 41}  //weight: 1, accuracy: High
        $x_1_3 = "Buni1fu_Te1xtB1ox" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAG_2147786440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAG!MTB"
        threat_id = "2147786440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 06 02 11 06 91 08 61 07 11 07 91 61 b4 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAG_2147786440_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAG!MTB"
        threat_id = "2147786440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 13 04 2b 3b 09 17 8d ?? 00 00 01 25 16 08 17 8d ?? 00 00 01 25 16 11 04 8c ?? 00 00 01 a2 14 28 ?? ?? ?? 0a 28 ?? 00 00 0a 1f 10 28 ?? ?? ?? 0a b4 9c 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RH_2147786443_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RH!MTB"
        threat_id = "2147786443"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 9a 13 04 7e ?? ?? ?? ?? 17 8d ?? ?? ?? 01 25 16 1f 24 9d 6f ?? ?? ?? 0a 13 05 19 8d ?? ?? ?? 01 25 16 11 05 16 9a a2 25 17 11 05 17 9a a2 25 18 72 ?? ?? ?? ?? a2 13 06 11 04 11 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAJ_2147786481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAJ!MTB"
        threat_id = "2147786481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "29"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 0b 06 8e 69 17 59 0c 2b 19 00 07 06 08 8f ?? ?? ?? 01 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 08 17 59 0c 08 15 fe 02 0d 09 2d df}  //weight: 10, accuracy: Low
        $x_10_2 = {0b 00 07 0c 16 0d 2b 1c 08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 6f ?? ?? ?? 0a 26 00 09 17 58 0d 09 08 8e 69 32 de}  //weight: 10, accuracy: Low
        $x_20_3 = "a4e450a1-cd08-40bd-9aae-49dd80df08c5" ascii //weight: 20
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
        $x_1_9 = "FunctionInit" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_11 = "Tetris" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 9 of ($x_1_*))) or
            ((1 of ($x_20_*) and 9 of ($x_1_*))) or
            ((1 of ($x_20_*) and 1 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JAN_2147786482_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAN!MTB"
        threat_id = "2147786482"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {70 0b 06 8e 69 17 59 0c 2b 19 00 07 06 08 8f ?? ?? ?? 01 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 08 17 59 0c 08 15 fe 02 0d 09 2d df}  //weight: 10, accuracy: Low
        $x_10_2 = {01 25 16 1f 2d 9d 6f ?? ?? ?? 0a 0b 00 07 0c 16 0d 2b 1c 08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 6f ?? ?? ?? 0a 26 00 09 17 58 0d 09 08 8e 69 32 de}  //weight: 10, accuracy: Low
        $x_1_3 = "FunctionInit" ascii //weight: 1
        $x_1_4 = "NavigationLib" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAX_2147786563_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAX!MTB"
        threat_id = "2147786563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 50 72 6f 54 00 4b 69 63 6b 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 5f 44 00 70 32 00 48 75 6e 74 65 72 00 53}  //weight: 1, accuracy: High
        $x_1_3 = {00 52 65 74 75 72 6e 45 72 72 6f 72 00 4d 65 73 73 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "GetTypes" ascii //weight: 1
        $x_1_10 = "ParamArray0" ascii //weight: 1
        $x_1_11 = "ArrayAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAY_2147786564_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAY!MTB"
        threat_id = "2147786564"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 61 10 00 02 0a 2b 00 06 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CBZ_2147786565_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CBZ!MTB"
        threat_id = "2147786565"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 70 72 6f 74 00 6b 69 63 6b 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 5f 44 00 70 32 00 69 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 48 75 6e 74 65 72 00 53 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 52 65 74 75 72 6e 45 72 72 6f 72 00 4d 65 73 73 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_8 = "FromBase64" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "GetType" ascii //weight: 1
        $x_1_11 = "ParamArray0" ascii //weight: 1
        $x_1_12 = "ArrayAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAL_2147786667_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAL!MTB"
        threat_id = "2147786667"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "9f392727-1e00-4eb0-a629-dde20cb1ced7" ascii //weight: 1
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "Portalquiz" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "Timer_tick" ascii //weight: 1
        $x_1_8 = "Split" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "FunctionInit" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_13 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAM_2147786668_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAM!MTB"
        threat_id = "2147786668"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "7beb9122-58b2-4d3b-a044-6f7f3fd6578b" ascii //weight: 1
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
        $x_1_8 = "ControlVehicular" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBA_2147786669_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBA!MTB"
        threat_id = "2147786669"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "3786c6e8-37c0-45aa-a5a1-5fdc696511d8" ascii //weight: 1
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "QAZXSWEDCVFRTGBNHY" ascii //weight: 1
        $x_1_6 = "FromBase64CharArray" ascii //weight: 1
        $x_1_7 = "IIIIIIIUHGFDFCDCHH" ascii //weight: 1
        $x_1_8 = "uNotepad" ascii //weight: 1
        $x_1_9 = "SADFGHJNERFGTBWSDEC" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
        $x_1_11 = "UJNBHYTGVCFTRDX" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBB_2147786670_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBB!MTB"
        threat_id = "2147786670"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "abb97cfb-972e-494e-b7e5-bab7c6e8cafc" ascii //weight: 1
        $x_1_2 = "StrReverse" ascii //weight: 1
        $x_1_3 = "InternalTaskStopped" ascii //weight: 1
        $x_1_4 = "CheckForSyncLockOnValueType" ascii //weight: 1
        $x_1_5 = "IExpando.Plug" ascii //weight: 1
        $x_1_6 = "FILEID" ascii //weight: 1
        $x_1_7 = "GetDomain" ascii //weight: 1
        $x_1_8 = "GetObjectValue" ascii //weight: 1
        $x_1_9 = "C:\\Temp\\" ascii //weight: 1
        $x_1_10 = "Form1_FormClosing" ascii //weight: 1
        $x_1_11 = "FromBase64CharArray" ascii //weight: 1
        $x_1_12 = "ToCharArrayRankOne" ascii //weight: 1
        $x_1_13 = "messageController" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCS_2147786740_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCS!MTB"
        threat_id = "2147786740"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 70 72 6f 6a 00 43 5f 44 00 70 32 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 48 75 6e 74 65 72 00 53 00 52 65 74 75 72 6e 45 72 72 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 48 65 6c 70 6c 69 6e 6b 00 43 61 6c 6c 73 74 61 63 6b 00}  //weight: 1, accuracy: High
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToString" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "GetType" ascii //weight: 1
        $x_1_10 = "ParamArray0" ascii //weight: 1
        $x_1_11 = "ArrayAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCP_2147786741_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCP!MTB"
        threat_id = "2147786741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 11 04 28 ?? ?? ?? 0a 08 11 04 18 5d 17 d6 28 ?? ?? ?? 0a da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04 11 04 09 31 cb}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCP_2147786741_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCP!MTB"
        threat_id = "2147786741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BF54A684-93AD-45B4-BF19-87B10C9B602F" ascii //weight: 1
        $x_1_2 = "IExpando" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBC_2147786770_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBC!MTB"
        threat_id = "2147786770"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 07 16 73 ?? ?? ?? 0a 0c 20 ?? ?? ?? 00 8d ?? ?? ?? 01 0d 38 ?? ?? ?? 00 06 09 16 11 04 6f ?? ?? ?? 0a 08 09 16 09 8e 69 6f ?? ?? ?? 0a 25 13 04 16 3d ?? ?? ?? ?? 06 6f ?? ?? ?? 0a 13 05}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBD_2147786771_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBD!MTB"
        threat_id = "2147786771"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 05 5c 00 37 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "SetCompatibleTextRenderingDefault" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_5 = "GetDomain" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "GetString" ascii //weight: 1
        $x_1_9 = "ClassLibrary" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_11 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBE_2147786772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBE!MTB"
        threat_id = "2147786772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "_26_Kissy" ascii //weight: 1
        $x_1_2 = "anguilla_16x16_32924" ascii //weight: 1
        $x_1_3 = "_25_Not_guilty" ascii //weight: 1
        $x_1_4 = "aland_16x16_32908" ascii //weight: 1
        $x_1_5 = "albania_16x16_32909" ascii //weight: 1
        $x_1_6 = "_24_Hay" ascii //weight: 1
        $x_1_7 = "algeria_16x16_32972" ascii //weight: 1
        $x_1_8 = "_27_Goatse" ascii //weight: 1
        $x_1_9 = "_28_Nomnomnom" ascii //weight: 1
        $x_1_10 = "Fr#omBa#se64Str#ing" ascii //weight: 1
        $x_1_11 = "GetMethod" ascii //weight: 1
        $x_1_12 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_13 = "Replace" ascii //weight: 1
        $x_1_14 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCC_2147786809_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCC!MTB"
        threat_id = "2147786809"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IExpando.Plug" ascii //weight: 1
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ControlePorTwitter" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "ToCharArray" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCA_2147786810_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCA!MTB"
        threat_id = "2147786810"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 1f 10 28 ?? ?? ?? 0a d1 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = "ToCharArray" ascii //weight: 1
        $x_1_3 = "ToUInt32" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "Invoke" ascii //weight: 1
        $x_1_8 = "OffsetMarshaler" ascii //weight: 1
        $x_1_9 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCB_2147786811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCB!MTB"
        threat_id = "2147786811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 05 02 11 05 91 08 61 06 11 04 91 61 d2 9c 11 04 03 6f ?? ?? ?? 0a 17 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDA_2147786812_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDA!MTB"
        threat_id = "2147786812"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {da 13 04 06 11 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 09 17 d6 0d 09 08 31 d0 12 00 03 09 28 ?? ?? ?? 0a 07 09 18 5d 17 d6 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDB_2147786813_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDB!MTB"
        threat_id = "2147786813"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 0a 08 11 04 08 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDB_2147786813_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDB!MTB"
        threat_id = "2147786813"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$3fadce44-9037-4bc7-92d0-93f6cffae06a" ascii //weight: 10
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "ArrayAttribute" ascii //weight: 1
        $x_1_4 = "ParamArray0" ascii //weight: 1
        $x_1_5 = "IExpando.Plug" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "GetChar" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDC_2147787007_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDC!MTB"
        threat_id = "2147787007"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 74 00 00 0c 2b 13 00 72 ?? ?? ?? 70 07 08 28 ?? ?? ?? 06 0b 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d e2}  //weight: 1, accuracy: Low
        $x_1_2 = "BatchRunner" wide //weight: 1
        $x_1_3 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDC_2147787007_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDC!MTB"
        threat_id = "2147787007"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 06 07 16 07 8e 69 6f ?? ?? ?? 0a 26 17 8d ?? ?? ?? 01 25 16 07 28 ?? ?? ?? 06 28 ?? ?? ?? 06 a2 0c 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 d0 ?? ?? ?? 1b 28 ?? ?? ?? 0a a2 6f ?? ?? ?? 0a 14 08 6f ?? ?? ?? 0a 75 ?? ?? ?? 01 0d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDM_2147787008_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDM!MTB"
        threat_id = "2147787008"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 0a 08 11 04 08 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04 11 04 09 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDN_2147787009_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDN!MTB"
        threat_id = "2147787009"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {ce 00 d0 00 eb 00 cb 00 bb 00 bb 00 c7 00 bb 00 bb 00 bb 00 bb 00 bf 00 bb 00 bb 00 bb 00 bb}  //weight: 1, accuracy: High
        $x_1_2 = {d0 00 c1 00 e2 00 ea 00 dd 00 f3 00 bc 00 f1 00 dd 00 e7 00 b3 00 e8 00 dd 00 e7 00 c0 00 ee 00 c3 00 c1 00 c8 00 e2 00 dc 00 e7 00 af}  //weight: 1, accuracy: High
        $x_1_3 = {00 48 75 6e 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ArrayAttribute" ascii //weight: 1
        $x_1_7 = "ParamArray0" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "GetChar" ascii //weight: 1
        $x_1_10 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDL_2147787010_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDL!MTB"
        threat_id = "2147787010"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 0d 09 08 31}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "ToUInt32" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDR_2147787011_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDR!MTB"
        threat_id = "2147787011"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 6f ?? ?? ?? 0a 26 00 09 17 58 0d 09 08 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDR_2147787011_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDR!MTB"
        threat_id = "2147787011"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "X_02312312" ascii //weight: 1
        $x_1_2 = "X_123123454363" ascii //weight: 1
        $x_1_3 = "X_12394147894" ascii //weight: 1
        $x_1_4 = "X_1248931414" ascii //weight: 1
        $x_1_5 = "X_21398138721" ascii //weight: 1
        $x_1_6 = "X_85432343242" ascii //weight: 1
        $x_1_7 = "FromBase64CharArray" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "ToInt32" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
        $x_1_11 = "ToCharArray" ascii //weight: 1
        $x_1_12 = "GetType" ascii //weight: 1
        $x_1_13 = "OffsetMarshaler" ascii //weight: 1
        $x_1_14 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JDB_2147787017_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JDB!MTB"
        threat_id = "2147787017"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 28 08 07 6f ?? ?? ?? 0a 13 05 06 11 05 28 ?? ?? ?? 0a 11 04 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 07 17 d6 0b 07 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d c9}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAO_2147787029_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAO!MTB"
        threat_id = "2147787029"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a de 1c 26 03 72 ?? ?? ?? 70 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 10 01 03 28 ?? ?? ?? 0a 0a de 00}  //weight: 10, accuracy: Low
        $x_10_2 = {0a 26 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 06 2e 17 72 ?? ?? ?? 70 06 28 ?? ?? ?? 06 06 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 2a 06 17 58 0a 06 1f 64 32 c7}  //weight: 10, accuracy: Low
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "Decode" ascii //weight: 1
        $x_1_7 = "Encode" ascii //weight: 1
        $x_1_8 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JAP_2147787030_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JAP!MTB"
        threat_id = "2147787030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 0d 2b 13 08 09 16 09 8e 69 6f ?? ?? ?? 0a 25 13 04 16 30 0e 2b 02 2b eb 06 28 ?? ?? ?? 06 13 05 2b 0c 06 09 16 11 04 6f ?? ?? ?? 0a 2b d5}  //weight: 10, accuracy: Low
        $x_10_2 = {01 13 03 38 ?? ?? ?? 00 38 ?? ?? ?? 00 38 ?? ?? ?? 00 11 02 11 03 16 11 03 8e 69 6f ?? ?? ?? 0a 25 13 04 16 3d ?? ?? ?? 00 38 ?? ?? ?? 00 11 00 11 03 16 11 04 28 ?? ?? ?? 06 38 ?? ?? ?? ff 11 00 6f ?? ?? ?? 0a 13 05 38}  //weight: 10, accuracy: Low
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JBH_2147787031_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBH!MTB"
        threat_id = "2147787031"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {41 00 61 00 65 00 65 00 65 00 65 00 65 00 53 00 2d 00 2d 00 69 00 55 00 73}  //weight: 1, accuracy: High
        $x_1_2 = "New SEALand App" ascii //weight: 1
        $x_1_3 = "BlockSize" ascii //weight: 1
        $x_1_4 = "GetMember" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "add_AssemblyResolve" ascii //weight: 1
        $x_1_9 = "CryptoStreamMode" ascii //weight: 1
        $x_1_10 = "TrimStart" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBM_2147787032_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBM!MTB"
        threat_id = "2147787032"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {06 02 07 6f 1e 00 00 0a 03 07 03 6f 19 00 00 0a 5d 6f 1e 00 00 0a 61 d1 6f 1f 00 00 0a 26 07 17 58 0b 07 02 6f}  //weight: 10, accuracy: High
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Convert" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JBN_2147787033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JBN!MTB"
        threat_id = "2147787033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "american_512x512_32917" ascii //weight: 1
        $x_1_2 = "albania_512x512_32909" ascii //weight: 1
        $x_1_3 = "afghanistan_512x512_32928" ascii //weight: 1
        $x_1_4 = "aland_512x512_32908" ascii //weight: 1
        $x_1_5 = "algeria_512x512_32972" ascii //weight: 1
        $x_1_6 = "anguilla_512x512_32924" ascii //weight: 1
        $x_1_7 = "angola_512x512_32914" ascii //weight: 1
        $x_1_8 = "andorra_512x512_32921" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "Reverse" ascii //weight: 1
        $x_1_11 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_12 = "Replace" ascii //weight: 1
        $x_1_13 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JEB_2147787116_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JEB!MTB"
        threat_id = "2147787116"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {28 27 00 00 0a 13 06 11 06 13 07 11 07 2c 0d 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 00 00 20 ?? ?? ?? 00 28 ?? ?? ?? 0a 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 26 15 28 ?? ?? ?? 0a 00 00 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "$4c2a5b0b-87fc-4ccd-bf48-86904954221f" ascii //weight: 1
        $x_1_3 = {00 73 65 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JEA_2147787117_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JEA!MTB"
        threat_id = "2147787117"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "*33*0*0*0*5*0*0*0*73*0*0*0*56*28*0*0*0*2*3*40*2*0*0*6*32*0" wide //weight: 10
        $x_10_2 = "77*90*144*0*3*" wide //weight: 10
        $x_1_3 = {43 6c 61 73 73 4c 69 62 72 61 72 79 31 00 53 74 61 72 74 54 65 73 74 73}  //weight: 1, accuracy: High
        $x_1_4 = "RefRegModel" ascii //weight: 1
        $x_1_5 = "StartTests" ascii //weight: 1
        $x_1_6 = "Convert" ascii //weight: 1
        $x_1_7 = "ToInt32" ascii //weight: 1
        $x_1_8 = "ToArray" ascii //weight: 1
        $x_1_9 = "Split" ascii //weight: 1
        $x_1_10 = "AssemblyResolve" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JED_2147787118_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JED!MTB"
        threat_id = "2147787118"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {73 22 00 00 0a 0a 16 0b 2b 24 00 06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 00 07 17 58 0b 07 02 6f ?? ?? ?? 0a fe 04 0c 08 2d cf 06 6f ?? ?? ?? 0a 0d 2b 00 09 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "DownloadString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CDZ_2147787135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CDZ!MTB"
        threat_id = "2147787135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 28 ?? ?? ?? 0a 09 11 05 09 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 13 06 08 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c 11 05 17 d6 13 05 11 05 11 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEA_2147787136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEA!MTB"
        threat_id = "2147787136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 0a 08 11 04 08 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEF_2147787137_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEF!MTB"
        threat_id = "2147787137"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {b0 00 d5 00 b2 00 b3 00 cf 00 e6 00 dc 00 af 00 ae 00 ae 00 dd 00 e3 00 b9 00 d4 00 b2 00 ae 00 b0 00 d4 00 d4 00 dc 00 e1 00 be 00 ae 00 ae 00 b0 00 d5 00 b6 00 b6 00}  //weight: 1, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "ThreadPool.Light" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEK_2147787138_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEK!MTB"
        threat_id = "2147787138"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 06 08 11 04 08 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04 11 04 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEK1_2147787139_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEK1!MTB"
        threat_id = "2147787139"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 0a 08 11 04 08 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 06 da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04 11 04 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEI_2147787140_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEI!MTB"
        threat_id = "2147787140"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c1 00 c3 00 de 00 be 00 ae 00 ae 00 ba 00 ae 00 ae 00 ae 00 ae 00 b2 00 ae 00 ae 00 ae 00 ae 00}  //weight: 1, accuracy: High
        $x_1_2 = {e2 00 d4 00 a1 00 ae 00 e1 00 ae 00 db 00 bb 00 b6 00 cf 00 d4 00 af 00 c1 00 ba 00 9d 00 d5 00 c3 00 b4 00 d5 00 dd 00 d0 00 e6 00 af 00 e4 00 d0 00 da 00 a6 00 db}  //weight: 1, accuracy: High
        $x_1_3 = "ThreadPool.Light" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CED_2147787192_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CED!MTB"
        threat_id = "2147787192"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 34 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 1f 00 20 07 8f fb 0e 0b 17 13 04 02 28 ?? ?? ?? 2b 16 02 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CED_2147787192_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CED!MTB"
        threat_id = "2147787192"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 07 16 73 ?? ?? ?? 0a 0c 20 00 00 10 00 8d ?? ?? ?? 01 0d 38 ?? ?? ?? ?? 06 09 16 11 04 6f ?? ?? ?? 0a 08 09 16 09 8e 69 6f ?? ?? ?? 0a 25 13 04 16 3d ?? ?? ?? ?? 06 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CED_2147787192_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CED!MTB"
        threat_id = "2147787192"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 00 6c 00 61 00 73 00 73 00 4c 00 69 00 62 00 72 00 61 00 72 00 79 00 [0-37] 44 00 61 00 74 00 61 00}  //weight: 1, accuracy: Low
        $x_1_2 = {43 6c 61 73 73 4c 69 62 72 61 72 79 [0-37] 44 61 74 61}  //weight: 1, accuracy: Low
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetString" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "po@wershe@ll" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
        $x_1_9 = "AssemblyResolve" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (8 of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEL_2147787199_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEL!MTB"
        threat_id = "2147787199"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e5 ae a2 e4 b8 8d e5 8a b3 39 54 56 71 51 41 41 4d 41 41 41 41 45 41 41 41 41 2f 2f 38 41 41 4c}  //weight: 1, accuracy: High
        $x_1_2 = {a2 e4 b8 8d e5 8a b3 39 67 41 41 41 41 41 34 66 75 67 34 41 74 41 6e 4e 49 62 67 42 54 4d 30 68}  //weight: 1, accuracy: High
        $x_1_3 = "PackageDownloads" ascii //weight: 1
        $x_1_4 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_7 = "GetString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CET_2147787213_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CET!MTB"
        threat_id = "2147787213"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 02 18 d8 17 d6 11 00 8e 69 fe 04 13 03 38 ?? ?? ?? 00 00 00 11 02 17 d6}  //weight: 5, accuracy: Low
        $x_1_2 = "WindowsFormsApp57" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CET_2147787213_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CET!MTB"
        threat_id = "2147787213"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 17 d6 28 ?? ?? ?? 0a da 13 04 07 11 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 0f 00 06 09 28 ?? ?? ?? 0a 08 09 08 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEV_2147787214_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEV!MTB"
        threat_id = "2147787214"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 0a 08 11 04 17 5d 17 d6 28 ?? ?? ?? 0a da 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04 11 04 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JCB_2147787216_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JCB!MTB"
        threat_id = "2147787216"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "aruba_32923" ascii //weight: 1
        $x_1_2 = "anguilla_32924" ascii //weight: 1
        $x_1_3 = "austallia_32912" ascii //weight: 1
        $x_1_4 = "antigua_32910" ascii //weight: 1
        $x_1_5 = "argentina_32919" ascii //weight: 1
        $x_1_6 = "armenia_32925" ascii //weight: 1
        $x_1_7 = "antarctica_33151" ascii //weight: 1
        $x_1_8 = "GetObject" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_11 = "Replace" ascii //weight: 1
        $x_1_12 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JCM_2147787217_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JCM!MTB"
        threat_id = "2147787217"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6b6f37e3-5573-4fab-922f-19b14ece3ae6" ascii //weight: 1
        $x_1_2 = "Douglas Heriot" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "FromBase64CharArray" ascii //weight: 1
        $x_1_9 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JCN_2147787218_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JCN!MTB"
        threat_id = "2147787218"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a 02 06 6f ?? ?? ?? 0a d4 8d ?? ?? ?? 01 7d ?? ?? ?? 04 06 02 7b ?? ?? ?? 04 16 02 7b ?? ?? ?? 04 8e 69 6f ?? ?? ?? 0a 26 02}  //weight: 10, accuracy: Low
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "GetString" ascii //weight: 1
        $x_1_7 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JDA_2147787219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JDA!MTB"
        threat_id = "2147787219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "66af0239-7820-4efc-a120-2e04e262061a" ascii //weight: 20
        $x_20_2 = "$76af1fc7-ee62-4f86-a192-e4bdba61b3f8" ascii //weight: 20
        $x_10_3 = "Dibakar Mandal" ascii //weight: 10
        $x_10_4 = "QManager" ascii //weight: 10
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "FromBase64String" ascii //weight: 1
        $x_1_11 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 7 of ($x_1_*))) or
            ((1 of ($x_20_*) and 7 of ($x_1_*))) or
            ((1 of ($x_20_*) and 1 of ($x_10_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JDC_2147787220_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JDC!MTB"
        threat_id = "2147787220"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 03 0c 04 0d 08 13 04 2b 11 07 02 11 04 9a 6f ?? ?? ?? 0a 26 11 04 17 d6 13 04 11 04 09 31 ea}  //weight: 10, accuracy: Low
        $x_1_2 = "BridgeHistoryForm" ascii //weight: 1
        $x_1_3 = "m_BridgeNoteEditForm" ascii //weight: 1
        $x_1_4 = "m_BridgeAddForm" ascii //weight: 1
        $x_1_5 = "$00020813-0000-0000-c000-000000000046" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JEE_2147787221_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JEE!MTB"
        threat_id = "2147787221"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "e2acb467-72ee-4e9b-950d-e2cfdb8a48d1" ascii //weight: 1
        $x_1_2 = "Powered by SmartAssembly 8.0.2.4779" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DownloadString" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "LoadLibrary" ascii //weight: 1
        $x_1_8 = "GZipStream" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JGC_2147787266_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JGC!MTB"
        threat_id = "2147787266"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0d 06 09 28 ?? ?? ?? 0a 08 09 08 6f ?? ?? ?? 0a 5d 17 d6 28 ?? ?? ?? 0a da 13 04 07 11 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 20 ?? ?? ?? 00 31 c7}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CEL1_2147787352_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CEL1!MTB"
        threat_id = "2147787352"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 09 8e 69 6f ?? ?? ?? 0a 26 28 ?? ?? ?? 0a 09 6f ?? ?? ?? 0a 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a de 0a 0f 00 08 6f ?? ?? ?? 0a d4 8d ?? ?? ?? 01 0d 08 09}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CFC_2147787390_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CFC!MTB"
        threat_id = "2147787390"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 08 28 ?? ?? ?? 06 5d 17 d6 28 ?? ?? ?? 06 da 13 04 07 00 06 09 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_2 = "ThreadPool.Light" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetChar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CFB_2147787391_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CFB!MTB"
        threat_id = "2147787391"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 16}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 06 11 08 08 61 11 09 61 b4 9c 11 07 03}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CFM_2147787392_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CFM!MTB"
        threat_id = "2147787392"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQ" wide //weight: 1
        $x_1_2 = "ug4AtAnNIbgBTM0h" wide //weight: 1
        $x_1_3 = "ThreadPool.Light" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JGA_2147787439_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JGA!MTB"
        threat_id = "2147787439"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {82 99 06 20 01 01 12 82 f5 04 20 01 01 1c 10 07 0a 12 82 99}  //weight: 1, accuracy: High
        $x_1_2 = {50 72 6f 67 72 61 6d 73 00 00 0c 01 00 07 32 2e 33 2e 33 2e 32 00 00 47}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "DeflateStream" ascii //weight: 1
        $x_1_5 = "GetHINSTANCE" ascii //weight: 1
        $x_1_6 = "LoadLibrary" ascii //weight: 1
        $x_1_7 = "ReadToEnd" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "GetMethod" ascii //weight: 1
        $x_1_12 = "GZipStream" ascii //weight: 1
        $x_1_13 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_14 = "DebuggingModes" ascii //weight: 1
        $x_1_15 = "DownloadString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JGB_2147787440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JGB!MTB"
        threat_id = "2147787440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetTempPath" ascii //weight: 1
        $x_1_2 = "LzmwAqmV.exe" ascii //weight: 1
        $x_1_3 = "WriteAllBytes" ascii //weight: 1
        $x_1_4 = "DownloadPayload" ascii //weight: 1
        $x_1_5 = "Combine" ascii //weight: 1
        $x_1_6 = "Execute" ascii //weight: 1
        $x_1_7 = "RunOnStartup" ascii //weight: 1
        $x_1_8 = "CheckEmulator" ascii //weight: 1
        $x_1_9 = "DetectVirtualMachine" ascii //weight: 1
        $x_1_10 = "Program" ascii //weight: 1
        $x_1_11 = "GetEntryAssembly" ascii //weight: 1
        $x_1_12 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_13 = "GetModuleHandle" ascii //weight: 1
        $x_1_14 = "SbieDll.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CFP_2147787575_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CFP!MTB"
        threat_id = "2147787575"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 58 0d 09 08 8e 69 32}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CGE_2147787576_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CGE!MTB"
        threat_id = "2147787576"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {19 28 e5 6d 73 32 30 32 32 54 72 75 92 8f 32 30 8a 36 54 72 75 6d 70 32 70 32 36 54 72 75 6d 70}  //weight: 1, accuracy: High
        $x_1_2 = {7c 6a d7 7e 32 84 3b fb 75 ca 74 21 bd 13 64 5a 5f 27 52 05 1f 1f 55 42 53 5b 74 11 14 03 1e 5d}  //weight: 1, accuracy: High
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "Trump2026" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CGO_2147787577_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CGO!MTB"
        threat_id = "2147787577"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncm" wide //weight: 1
        $x_1_2 = {5a 00 53 00 42 00 79 00 64 00 57 00 34 00 67 00 61 00 57 00 34 00 67 00 52 00 45 00 39 00 54 00 49}  //weight: 1, accuracy: High
        $x_1_3 = "ThreadPool.Light" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CGP_2147787578_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CGP!MTB"
        threat_id = "2147787578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 09 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26 09 18 25}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 06 11 08 08 61 11 09 61 b4 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CGP_2147787578_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CGP!MTB"
        threat_id = "2147787578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "X_02312312" ascii //weight: 1
        $x_1_2 = "X_123123454363" ascii //weight: 1
        $x_1_3 = "X_12394147894" ascii //weight: 1
        $x_1_4 = "X_1248931414" ascii //weight: 1
        $x_1_5 = "X_21398138721" ascii //weight: 1
        $x_1_6 = "X_85432343242" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "GetMethod" ascii //weight: 1
        $x_1_10 = "ToCharArray" ascii //weight: 1
        $x_1_11 = "GetType" ascii //weight: 1
        $x_1_12 = "OffsetMarshaler" ascii //weight: 1
        $x_1_13 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CGU_2147787579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CGU!MTB"
        threat_id = "2147787579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 03 05 03 8e 69 5d 91 05 04 03 8e 69 5d d6 04 5f 61 b4 28}  //weight: 1, accuracy: High
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CGR_2147787580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CGR!MTB"
        threat_id = "2147787580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 17 58 0b 07 20 00 01 00 00 5d 0b 09 11 07 07 94 58 0d 09 20 00 01 00 00 5d 0d 11 07 07 94 13 05 11 07 07 11 07 09 94 9e 11 07 09 11 05 9e 11 07 11 07 07 94 11 07 09 94 58 20 00 01 00 00 5d 94 13 04 11 08 08 11 09 08 91 11 04 61 d2 9c 08 17 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JGD_2147787601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JGD!MTB"
        threat_id = "2147787601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 d0 ?? ?? ?? 1b 28 ?? ?? ?? 0a a2 28 ?? ?? ?? 0a 14 17 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 a2 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 7d ?? ?? ?? 04 7e ?? ?? ?? 04 2d 24 16 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_1_2 = "CompressionMode" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "UnaryOperation" ascii //weight: 1
        $x_1_10 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JGE_2147787602_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JGE!MTB"
        threat_id = "2147787602"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "66840DDA154E8A113C31DD0AD32F7F3A366A80E8136979D8F5A101D3D29D6F72" ascii //weight: 1
        $x_1_2 = "Sleep" ascii //weight: 1
        $x_1_3 = "OMMapp" ascii //weight: 1
        $x_1_4 = "DBbhEQ" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "tKzBEG" ascii //weight: 1
        $x_1_7 = "%xEKcX" ascii //weight: 1
        $x_1_8 = "ClassLibrary" ascii //weight: 1
        $x_1_9 = "CreateDecryptor" ascii //weight: 1
        $x_1_10 = "ICryptoTransform" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JGG_2147787603_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JGG!MTB"
        threat_id = "2147787603"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {6a 69 69 0c 02 4f 05 64 63 62 61 9f b5 eb 1d b7 7b 78 58 73 76 26 75 74 71 70 71 8f a3 f9 0d 47 6b 6a 69 d2 47 64 65 64 43 62 61 9f d5 e9 1d 57 7b 3a 79 78 57 76 75 74 71 72 71 8b a5 fb 0d 47 6b 6a 69 6e 67 66 65 64 63 62 61 9f 35 e9 1d 57 79 7a 79 78 77 76 75 77 73 12 f4 8f a5 eb 0d 47 7b 6a 69 68 67 76 65 64 73 62 61 9f 35 6b}  //weight: 10, accuracy: High
        $x_1_2 = "Delay" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHA_2147787604_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHA!MTB"
        threat_id = "2147787604"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 07 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 00 08 07 16 09 6f ?? ?? ?? 0a 00 00 00 09 16 fe 02 13 05 11 05 2d d0 08 6f}  //weight: 10, accuracy: Low
        $x_10_2 = {08 09 9a 13 04 00 11 04 28 ?? ?? ?? 0a ?? ?? ?? ?? ?? ?? ?? ?? ?? 59 28 ?? ?? ?? 0a 69 13 05 06 11 05 d1 6f ?? ?? ?? 0a 26 00 09 17 58 0d 09 08 8e 69 32 cc}  //weight: 10, accuracy: Low
        $x_1_3 = "382 426 423 421 378 409 427 413 366 364 395 428 426 417 422 415" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHB_2147787605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHB!MTB"
        threat_id = "2147787605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {43 5f 44 00 70 32 00 58 58 58 58 58 58 00 53 00 73 73 00 57 53 53}  //weight: 1, accuracy: High
        $x_1_2 = "b1a1dcdd-ad61-4e6f-8e4f-c81512e69fee" ascii //weight: 1
        $x_1_3 = "flextronics" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = {00 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHC_2147787606_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHC!MTB"
        threat_id = "2147787606"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 94 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 58 20 ?? ?? ?? 00 5d 94 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 06 02 7b ?? ?? ?? 04 91 02 7b ?? ?? ?? 04 61 d2 9c 02 02 7b ?? ?? ?? 04 17 58 7d}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHG_2147787607_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHG!MTB"
        threat_id = "2147787607"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {04 94 58 02 7b 07 00 00 04 02 7b 03 00 00 04 94 58 20 00 01 00 00 5d 7d}  //weight: 10, accuracy: High
        $x_10_2 = {7b 03 00 00 04 91 02 7b 05 00 00 04 61 d2 9c}  //weight: 10, accuracy: High
        $x_1_3 = "Test-Connection" ascii //weight: 1
        $x_1_4 = "p^owe^rs^he^ll" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHH_2147787608_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHH!MTB"
        threat_id = "2147787608"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "55"
        strings_accuracy = "Low"
    strings:
        $x_50_1 = {0a 13 04 06 11 04 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 6f ?? ?? ?? ?? ?? ?? ?? ?? 0a 06 11 04 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 6f ?? ?? ?? ?? ?? ?? ?? ?? 0a 06 17 6f ?? ?? ?? ?? 1f 64 28 ?? ?? ?? ?? 07 06 6f}  //weight: 50, accuracy: Low
        $x_50_2 = {04 11 06 7e ?? ?? ?? 04 72 ?? ?? ?? 70 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 7e ?? ?? ?? 04 11 05 7e ?? ?? ?? 04 11 06 7e ?? ?? ?? 04 72 ?? ?? ?? 70 ?? ?? ?? 00 06 28 ?? ?? ?? 06}  //weight: 50, accuracy: Low
        $x_1_3 = "Jdasdagsgqk1240124Ldajhsdhyg1qjwvfb?" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_50_*) and 5 of ($x_1_*))) or
            ((2 of ($x_50_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JHI_2147787609_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHI!MTB"
        threat_id = "2147787609"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 25 26 fe ?? ?? 00 fe ?? ?? 00 fe ?? ?? 00 6f ?? ?? ?? 0a 25 26 5d 6f ?? ?? ?? 0a 25 26 61 d1 6f ?? ?? ?? 0a 25 26 26 fe ?? ?? 00 20 ?? ?? ?? 00 58 fe ?? ?? 00 fe ?? ?? 00 fe ?? ?? 00 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "ToString" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHJ_2147787610_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHJ!MTB"
        threat_id = "2147787610"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 08 6f ?? ?? ?? 0a d4 8d ?? ?? ?? 01 0d 08 09 16 09 8e 69 6f ?? ?? ?? 0a 26 28 ?? ?? ?? 0a 09 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a dd}  //weight: 10, accuracy: Low
        $x_1_2 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHX_2147787611_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHX!MTB"
        threat_id = "2147787611"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 6e 17 6a d6 20 ?? ?? ?? 00 6a 5f b8 0c 09 11 05 08 84 95 d7 6e 20 ?? ?? ?? 00 6a 5f b8 0d 11 05 08 84 95 13 04 11 05 08 84 11 05 09 84 95 9e 11 05 09 84 11 04 9e 11 06 11 08 02 11 08 91 11 05 11 05 08 84 95 11 05 09 84 95 d7 6e 20 ?? ?? ?? 00 6a 5f b7 95 61 86 9c 11 08 17 d6 13 08}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CHH_2147787760_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CHH!MTB"
        threat_id = "2147787760"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 5d 0c 11 06 06 94 13 04 11 06 06 11 06 08 94 9e 11 06 08 11 04 9e 11 06 11 06 06 94 11 06 08 94 58 20 00 01 00 00 5d 94 0d 11 07 07 ?? 07 91 09 61 d2 9c 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "AssemblyResolve" ascii //weight: 1
        $x_1_3 = {00 44 65 63 72 79 70 74 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CHH_2147787760_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CHH!MTB"
        threat_id = "2147787760"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 08 20 00 01 00 00 6f ?? ?? ?? 0a 08 17 6f ?? ?? ?? 0a 08 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 1f 64 73 ?? ?? ?? 0a 1f 10 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0b 07 02 16 02 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "CryptoStreamMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CHJ_2147787761_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CHJ!MTB"
        threat_id = "2147787761"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 09 08 09 91 07 09 1f 10 5d 91 61 9c 09 17 d6 0d 09}  //weight: 1, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CHK_2147787762_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CHK!MTB"
        threat_id = "2147787762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IIIIIIII2" ascii //weight: 1
        $x_1_2 = "IIIIIIIII5" ascii //weight: 1
        $x_1_3 = "IIIIIIIIII1" ascii //weight: 1
        $x_1_4 = "IIIIIIIIIII3" ascii //weight: 1
        $x_1_5 = "IIIIIIIIIIIIII4" ascii //weight: 1
        $x_1_6 = "X_123123454363" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "GetMethod" ascii //weight: 1
        $x_1_10 = "ToCharArray" ascii //weight: 1
        $x_1_11 = "GetType" ascii //weight: 1
        $x_1_12 = "OffsetMarshaler" ascii //weight: 1
        $x_1_13 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CIH_2147787826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CIH!MTB"
        threat_id = "2147787826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 08 07 08 91 06 08 1f 10 5d 91 61 9c 08 17 d6 0c 08}  //weight: 1, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CIJ_2147787827_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CIJ!MTB"
        threat_id = "2147787827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 26 09 18 d6 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {02 11 06 91 13 08 07 11 07 91 13 09 09 11 06 11 08 08 61 11 09 61 b4 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CIN_2147787828_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CIN!MTB"
        threat_id = "2147787828"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 57 53 53 00 54 00 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "ArrayAttribute" ascii //weight: 1
        $x_1_4 = "ParamArray0" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIB_2147787837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIB!MTB"
        threat_id = "2147787837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 8e b7 16 3e ?? ?? ?? 00 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe ?? ?? ?? 72 ?? ?? ?? 70 fe}  //weight: 10, accuracy: Low
        $x_10_2 = {4c 00 6f 00 61 00 64 00 00 15 45 00 6e 00 74 00 72 00 79 00 50 00 6f 00 69 00 6e 00 74 00 00 0d 49 00 6e 00 76 00 6f 00 6b 00 65}  //weight: 10, accuracy: High
        $x_1_3 = "AesCryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "WriteAllBytes" ascii //weight: 1
        $x_1_7 = "GetObjectValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIC_2147787838_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIC!MTB"
        threat_id = "2147787838"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "b85f09a0-4cf5-4ec8-a65a-b6b323879607" ascii //weight: 1
        $x_1_2 = "Two Pesos" ascii //weight: 1
        $x_1_3 = "Jarokn Club" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "PublicKeyToken=b77a5c561934e089" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "DebuggerStepThroughAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIE_2147787839_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIE!MTB"
        threat_id = "2147787839"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0a 2b 1a 02 72 ?? ?? ?? 70 06 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 06 17 58 0a 06 20 ?? ?? ?? 00 32 de}  //weight: 10, accuracy: Low
        $x_1_2 = "5e15d392-3331-4175-b04e-bf3deba77766" ascii //weight: 1
        $x_1_3 = "xstoppartykeeptogether" ascii //weight: 1
        $x_1_4 = "hostmigration_start" ascii //weight: 1
        $x_1_5 = "killserver" ascii //weight: 1
        $x_1_6 = "BlackOpsColdWar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIH_2147787840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIH!MTB"
        threat_id = "2147787840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SFDSDFSD!!!" ascii //weight: 1
        $x_1_2 = "LzmaDecoder" ascii //weight: 1
        $x_1_3 = "m_IsMatchDecoders" ascii //weight: 1
        $x_1_4 = {43 6f 70 79 42 6c 6f 63 6b 00 50 75 74 42 79 74 65 00 47 65 74 42 79 74 65}  //weight: 1, accuracy: High
        $x_1_5 = "VirtualProtect" ascii //weight: 1
        $x_1_6 = "Decrypt" ascii //weight: 1
        $x_1_7 = "Decompress" ascii //weight: 1
        $x_1_8 = "ReverseDecode" ascii //weight: 1
        $x_1_9 = "WriteInt64" ascii //weight: 1
        $x_1_10 = "ToBase64String" ascii //weight: 1
        $x_1_11 = "IsDebuggerPresent" wide //weight: 1
        $x_1_12 = "BitDecoder" ascii //weight: 1
        $x_1_13 = "BitTreeDecoder" ascii //weight: 1
        $x_1_14 = "DecodeDirectBits" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ICZ_2147788020_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ICZ!MTB"
        threat_id = "2147788020"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 11 01 02 11 01 91 11 03 61 d2 9c 38}  //weight: 2, accuracy: High
        $x_1_2 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
        $x_1_3 = "pkowekrshkekll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJB_2147788021_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJB!MTB"
        threat_id = "2147788021"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 08 07 08 91 06 08 1f 10 5d 91 61 9c 08 17 d6 0c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJC_2147788022_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJC!MTB"
        threat_id = "2147788022"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 58 58 58 58 58 58 00 53 00 57 53 53 00}  //weight: 1, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "ArrayAttribute" ascii //weight: 1
        $x_1_4 = "ParamArray0" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJK_2147788023_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJK!MTB"
        threat_id = "2147788023"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 09 08 09 91 07 09 1f 10 5d 91 61 9c 09 17 d6 0d}  //weight: 1, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJL_2147788024_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJL!MTB"
        threat_id = "2147788024"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 09 08 09 91 07 09 1f 10 5d 91 61 9c}  //weight: 1, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIK_2147788057_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIK!MTB"
        threat_id = "2147788057"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 06 20 00 01 00 00 6f ?? ?? ?? 0a 06 20 80 00 00 00 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 03 16 73 ?? ?? ?? 06 6f ?? ?? ?? 06 7e ?? ?? ?? 04 25 2d 17 26 7e}  //weight: 10, accuracy: Low
        $x_10_2 = {20 00 01 00 00 6f ?? ?? ?? 0a 11 0a 20 80 00 00 00 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 25 26 03 6f ?? ?? ?? 0a 25 26 72 ?? ?? ?? 70 03 16 73 ?? ?? ?? 06 6f ?? ?? ?? 06 25 26 7e ?? ?? ?? 04 25 2d 21}  //weight: 10, accuracy: Low
        $x_1_3 = "aasdasdasddassjdsudabshadad" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CJX_2147788136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJX!MTB"
        threat_id = "2147788136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 02 11 03 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 13 02}  //weight: 1, accuracy: High
        $x_1_3 = {11 03 11 06 11 08 11 02 61 11 09 61 b4 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CJM_2147788137_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CJM!MTB"
        threat_id = "2147788137"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IIIIIIII2" ascii //weight: 1
        $x_1_2 = "IIIIIIIII5" ascii //weight: 1
        $x_1_3 = "IIIIIIIIII1" ascii //weight: 1
        $x_1_4 = "IIIIIIIIIII3" ascii //weight: 1
        $x_1_5 = "IIIIIIIIIIIIII4" ascii //weight: 1
        $x_1_6 = "X_123123454363" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "ToUInt32" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_10 = "ToCharArray" ascii //weight: 1
        $x_1_11 = "GetType" ascii //weight: 1
        $x_1_12 = "OffsetMarshaler" ascii //weight: 1
        $x_1_13 = "ReturnMessage" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CKE_2147788138_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CKE!MTB"
        threat_id = "2147788138"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 06 02 28 ?? ?? ?? ?? 06 02 28 ?? ?? ?? ?? 8e 69 5d 91 03 06 91 61 d2 9c 06 17 58 0a 06 03 8e 69 17 59 fe [0-2] 16 fe [0-2] 0b 07}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CKI_2147788139_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CKI!MTB"
        threat_id = "2147788139"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 07 17 58 0b 07 02 6f ?? ?? ?? 0a 3f}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CKH_2147788140_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CKH!MTB"
        threat_id = "2147788140"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a de 07 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d de 0e 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JHZ_2147788147_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JHZ!MTB"
        threat_id = "2147788147"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 11 06 07 94 58 11 05 07 94 58 20 00 01 00 00 5d 0c 11 06 07 94 13 04 11 06 07 11 06 08 94 9e 11 06 08 11 04 9e 07 17 58 0b}  //weight: 1, accuracy: High
        $x_1_2 = "Usqqlrjupjyybuus" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JID_2147788148_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JID!MTB"
        threat_id = "2147788148"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {74 00 70 00 73 00 3a 00 2f 00 2f 00 63 00 64 00 6e 00 2e 00 64 00 69 00 73 00 63 00 6f 00 72 00 64 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f}  //weight: 1, accuracy: High
        $x_1_2 = "C:\\dnwaiodwandwaniodawnodwandawoangrdp\\dwad.exe" ascii //weight: 1
        $x_1_3 = "DetectVirtualMachine" ascii //weight: 1
        $x_1_4 = "DownloadPayload" ascii //weight: 1
        $x_1_5 = "RunPayload" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "GetFolderPath" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JII_2147788149_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JII!MTB"
        threat_id = "2147788149"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "50"
        strings_accuracy = "High"
    strings:
        $x_40_1 = "53b371fd-2d3f-44b4-a5d9-319d08bb3dfc" ascii //weight: 40
        $x_40_2 = "260d6060-40dd-4926-973b-768f78f14d12" ascii //weight: 40
        $x_1_3 = {78 78 78 31 00 63 6f 6d 70 6f 6e 65 6e 74 73 00 49 43 6f 6e 74 61 69 6e 65 72 00 47 65 74 78 78 78 00 53 65 74 78 78 78}  //weight: 1, accuracy: High
        $x_1_4 = {52 5f 46 00 73 00 64 00 51 5f 41 00 74 00 57 5f 53 00 78 7a 00 41 5f 5a}  //weight: 1, accuracy: High
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "CreateDecryptor" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_40_*) and 10 of ($x_1_*))) or
            ((2 of ($x_40_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JIJ_2147788150_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIJ!MTB"
        threat_id = "2147788150"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 00 01 00 00 38 ?? ?? ?? 00 00 38 ?? ?? ?? 00 20 ?? ?? ?? 00 38 ?? ?? ?? 00 00 38 ?? ?? ?? 00 7b ?? ?? ?? 04 38 ?? ?? ?? 00 7b ?? ?? ?? 04 20 ?? ?? ?? 00 38 ?? ?? ?? 00 0b 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 17 6f ?? ?? ?? 0a 00 02 06 6f}  //weight: 10, accuracy: Low
        $x_1_2 = "Shobha" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_5 = "ClassLibrary" ascii //weight: 1
        $x_1_6 = {00 53 70 6f 74 69 66 79 00 78 6d 72 69 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIL_2147788151_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIL!MTB"
        threat_id = "2147788151"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {9e 02 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 94 58 20 00 01 00 00 5d 94 7d ?? ?? ?? 04 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? ?? 03 50 02 7b ?? ?? ?? ?? 91 02 7b ?? ?? ?? 04 61 d2 9c 02 02 7b ?? ?? ?? ?? 17 58 7d}  //weight: 1, accuracy: Low
        $x_1_2 = {04 94 9e 38 ?? ?? ?? ff 02 02 7b ?? ?? ?? 04 17 58 7d ?? ?? ?? 04 38 ?? ?? ?? ff 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 03 50 02 7b ?? ?? ?? 04 91 02 7b ?? ?? ?? 04 61 d2 9c 38 ?? ?? ?? ff 02 02 7b ?? ?? ?? 04 20 ?? ?? ?? 00 5d 7d ?? ?? ?? 04 38}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIP_2147788152_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIP!MTB"
        threat_id = "2147788152"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {19 28 e5 6d 73 32 30 32 32 54 72 75 92 8f 32 30 8a 36 54 72 75 6d 70 32 70 32 36 54 72 75 6d 70}  //weight: 1, accuracy: High
        $x_1_2 = {7c 6a d7 7e 32 84 3b fb 75 ca 74 21 bd 13 64 5a 5f 27 52 05 1f 1f 55 42 53 5b 74 11 14 03 1e 5d}  //weight: 1, accuracy: High
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "Trump2026" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIO_2147788153_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIO!MTB"
        threat_id = "2147788153"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 17 73 ?? ?? ?? 0a 13 04 06 6f ?? ?? ?? 0a 1f 0d 6a 59 13 05 07 06 11 04 11 05 09 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "m_IsMatchDecoders" ascii //weight: 1
        $x_1_3 = "fdsfds" ascii //weight: 1
        $x_1_4 = {43 6f 70 79 42 6c 6f 63 6b 00 50 75 74 42 79 74 65 00 47 65 74 42 79 74 65}  //weight: 1, accuracy: High
        $x_1_5 = "Decrypt" ascii //weight: 1
        $x_1_6 = "Decompress" ascii //weight: 1
        $x_1_7 = "ReverseDecode" ascii //weight: 1
        $x_1_8 = "DecodeDirectBits" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIZ_2147788154_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIZ!MTB"
        threat_id = "2147788154"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 07 09 07 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 07 17 d6 0b 07 11 04 31 e3}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIX_2147788155_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIX!MTB"
        threat_id = "2147788155"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0a 00 20 00 10 00 00 8d ?? ?? ?? 01 0b 73 ?? ?? ?? 0a 0c 00 00 06 07 16 20 00 10 00 00 6f ?? ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 00 08 07 16 09 6f ?? ?? ?? 0a 00 00 00 09 16 fe 02 13 05 11 05 2d d0}  //weight: 10, accuracy: Low
        $x_1_2 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIY_2147788156_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIY!MTB"
        threat_id = "2147788156"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 04 06 11 04 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 11 04 17 d6 13 04 11 04 09 31 df}  //weight: 10, accuracy: Low
        $x_1_2 = {00 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ArrayAttribute" ascii //weight: 1
        $x_1_5 = "ParamArray0" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIW_2147788157_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIW!MTB"
        threat_id = "2147788157"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 02 16 02 8e b7 6f ?? ?? ?? 0a 13 ?? 72 [0-3] 70}  //weight: 1, accuracy: Low
        $x_1_2 = {4c 00 6f 00 61 00 64 00 00 15 45 00 6e 00 74 00 72 00 79 00 50 00 6f 00 69 00 6e 00 74 00 00 0d 49 00 6e 00 76 00 6f 00 6b 00 65}  //weight: 1, accuracy: High
        $x_1_3 = "AesCryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "WriteAllBytes" ascii //weight: 1
        $x_1_7 = "GetObjectValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HI_2147788234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HI!MTB"
        threat_id = "2147788234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RPTI The first prod" ascii //weight: 1
        $x_1_2 = "RPG The Intellect" ascii //weight: 1
        $x_1_3 = "You must select a gender" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
        $x_1_5 = "get_CurrentDomain" ascii //weight: 1
        $x_1_6 = "Paladin" ascii //weight: 1
        $x_1_7 = "CompressionMode" ascii //weight: 1
        $x_1_8 = "Female" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HJ_2147788235_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HJ!MTB"
        threat_id = "2147788235"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$5d3f56b0-0ca8-4a5f-ad27-bb5ecac5e49d" ascii //weight: 20
        $x_20_2 = "$97c5a2e5-38b1-4313-93a4-139c6d069a49" ascii //weight: 20
        $x_20_3 = "$4a43ae81-7a0c-4f9f-a230-e85e130c574a" ascii //weight: 20
        $x_20_4 = "$8e6a82d6-f3fd-44ea-8453-3b1c69125772" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "FromBase64String" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_HK_2147788236_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HK!MTB"
        threat_id = "2147788236"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$7665c8e9-c2ed-48b5-89f6-948287d1bddd" ascii //weight: 20
        $x_20_2 = "$8a5f1e11-a3d4-4598-8cee-290d984904c4" ascii //weight: 20
        $x_20_3 = "$ae7bc02d-9991-4378-8042-c4eb9d602b0f" ascii //weight: 20
        $x_20_4 = "$81b65043-70c7-4b65-9c91-43042a060b8b" ascii //weight: 20
        $x_20_5 = "$9db03728-9995-4a10-a2c8-1fae9b7bfd97" ascii //weight: 20
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
        $x_1_13 = "FromBase64String" ascii //weight: 1
        $x_1_14 = "CreateInstance" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 2 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CVV_2147788246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CVV!MTB"
        threat_id = "2147788246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VirtualProtect" ascii //weight: 1
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_5 = "StreamReader" ascii //weight: 1
        $x_1_6 = "ServerComputer" ascii //weight: 1
        $x_1_7 = "WebClient" ascii //weight: 1
        $x_1_8 = "CopyFromScreen" ascii //weight: 1
        $x_1_9 = "NetworkStream" ascii //weight: 1
        $x_1_10 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_11 = "GetResourceString" ascii //weight: 1
        $x_1_12 = "$5c0253b1-c766-4111-b6b6-d3f46f6f532d" ascii //weight: 1
        $x_1_13 = "GZipStream" ascii //weight: 1
        $x_1_14 = "System.IO.Compression" ascii //weight: 1
        $x_1_15 = "CompressionMode" ascii //weight: 1
        $x_1_16 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_17 = "DownloadData" ascii //weight: 1
        $x_1_18 = "GetTempFileName" ascii //weight: 1
        $x_1_19 = "WriteAllBytes" ascii //weight: 1
        $x_1_20 = "get_CtrlKeyDown" ascii //weight: 1
        $x_1_21 = "BitConverter" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_TM_2147788247_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TM!MTB"
        threat_id = "2147788247"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "StrReverse" ascii //weight: 1
        $x_1_2 = "DownloadString" ascii //weight: 1
        $x_1_3 = "GetResourceString" ascii //weight: 1
        $x_1_4 = "_XboxFriends" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "ClipboardProxy" ascii //weight: 1
        $x_1_7 = "Chatzilla Advanced Chat-System" ascii //weight: 1
        $x_1_8 = "StatusXboxLiveSignedIn" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CKS_2147788358_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CKS!MTB"
        threat_id = "2147788358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a de 0a 08 2c 06 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d de 14 07 2c 06 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
        $x_1_4 = "AssemblyResolve" ascii //weight: 1
        $x_1_5 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CLK_2147788359_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CLK!MTB"
        threat_id = "2147788359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 05 07 11 05 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 11 05 17 d6 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ArrayAttribute" ascii //weight: 1
        $x_1_5 = "ParamArray0" ascii //weight: 1
        $x_1_6 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CLB_2147788360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CLB!MTB"
        threat_id = "2147788360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 06 08 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 02 6f ?? ?? ?? 0a 0d 06 6f ?? ?? ?? 0a 09 16 09 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CLW_2147788417_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CLW!MTB"
        threat_id = "2147788417"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0c 07 28 ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 03 13 04 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 13 05 de 1b}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CLP_2147788418_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CLP!MTB"
        threat_id = "2147788418"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 00 01 00 00 14 14 18 8d ?? ?? ?? 01 25 16 06 11 04 18 d8 18 6f ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 9c 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ArrayAttribute" ascii //weight: 1
        $x_1_5 = "ParamArray0" ascii //weight: 1
        $x_1_6 = "S____________________________S" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CLO_2147788419_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CLO!MTB"
        threat_id = "2147788419"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "46"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "E1FBA0E00B409CD21B8014CCD21546869732070726F677261" wide //weight: 10
        $x_10_2 = "A4EFCFFFF263844FCFFFF00022" wide //weight: 10
        $x_10_3 = "CEFAFFFF0002737C0100066F39" wide //weight: 10
        $x_10_4 = "C11061108110261110961B49C38EE" wide //weight: 10
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "ArrayAttribute" ascii //weight: 1
        $x_1_8 = "ParamArray0" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EHH_2147788420_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EHH!MTB"
        threat_id = "2147788420"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 07 06 07 91 20 ?? ?? ?? ?? 59 d2 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0c 08 2d e3}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLA_2147788454_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLA!MTB"
        threat_id = "2147788454"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 11 05 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d ?? ?? ?? 01 25 16 07 11 05 18 d8 18 6f ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 9c 11 05 17 d6 13 05 11 05 11 04 31 b2}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLC_2147788455_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLC!MTB"
        threat_id = "2147788455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {69 00 63 00 61 00 74 00 69 00 6f 00 6e 00 2f 00 78 00 2d 00 77 00 77 00 77 00 2d 00 66 00 6f 00 72 00 6d 00 2d 00 75 00 72 00 6c 00 65 00 6e 00 63 00 6f 00 64 00 65 00 64 00 00 15 64 00 65 00 62 00 75 00 67 00 2e 00 68 00 74 00 6d 00 6c}  //weight: 10, accuracy: High
        $x_1_2 = {41 00 70 00 70 00 6c 00 65 00 57 00 65 00 62 00 4b 00 69 00 74 00 2f 00 35 00 33 00 34 00 2e 00 32 00 33}  //weight: 1, accuracy: High
        $x_1_3 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "ComputeHash" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLG_2147788456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLG!MTB"
        threat_id = "2147788456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "B________________________B" ascii //weight: 1
        $x_1_2 = "S____________________________S" ascii //weight: 1
        $x_1_3 = {00 46 54 50 00 53 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 53 00 54 00 67 65 74 5f 68 75 6d 4d 41 58 00}  //weight: 1, accuracy: High
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "OddsMissionControl" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "LateGet" ascii //weight: 1
        $x_1_9 = "GetObjectValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLM_2147788457_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLM!MTB"
        threat_id = "2147788457"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 11 05 72 ?? ?? ?? 70 28 ?? ?? ?? ?? 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d ?? ?? ?? 01 25 16 07 11 05 18 d8 18 6f ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 9c 11 05 17 d6 13 05 11 05 11 04 31 b2}  //weight: 10, accuracy: Low
        $x_10_2 = {42 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 42 00 53 00 53 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 53}  //weight: 10, accuracy: High
        $x_1_3 = "LateGet" ascii //weight: 1
        $x_1_4 = "ToByte" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
        $x_1_6 = "Round" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "get_ParamArray0" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CMC_2147788479_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMC!MTB"
        threat_id = "2147788479"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "44"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F74206265207275" wide //weight: 10
        $x_10_2 = "11002A38F8FFFFFF38F3FFFFFF007E0" wide //weight: 10
        $x_10_3 = "DBFFFFFF38B5FFFFFF11002A11013AABFFFFFF" wide //weight: 10
        $x_10_4 = "A4EFCFFFF263844FCFFFF000228" wide //weight: 10
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMF_2147788908_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMF!MTB"
        threat_id = "2147788908"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0c 07 28 ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 03 13 04 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 13 05 de}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMD_2147788909_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMD!MTB"
        threat_id = "2147788909"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 42 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 42 00}  //weight: 10, accuracy: High
        $x_10_2 = {53 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 53 00 4d 65 73 73 61 67 65}  //weight: 10, accuracy: High
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMS_2147788910_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMS!MTB"
        threat_id = "2147788910"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "ToUInt32" ascii //weight: 1
        $x_1_3 = "Resource_Meter" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMN_2147788911_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMN!MTB"
        threat_id = "2147788911"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 06 08 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 02 0d 06 6f ?? ?? ?? 0a 09 16 09 8e 69 6f ?? ?? ?? 0a 13 04 de 1f 07 2c 06 07 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMO_2147788912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMO!MTB"
        threat_id = "2147788912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a dd ?? ?? ?? ?? 08 39 ?? ?? ?? ?? 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d dd ?? ?? ?? ?? 07 39 ?? ?? ?? ?? 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
        $x_1_4 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMX_2147788913_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMX!MTB"
        threat_id = "2147788913"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 06 11 04 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a b4 9c 07 11 04 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 00 01 00 00 14 14 18 8d ?? ?? ?? 01 25 16 06 11 04 18 d8 18 6f ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 28}  //weight: 1, accuracy: Low
        $x_1_2 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CMY_2147788914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMY!MTB"
        threat_id = "2147788914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "44"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "FFF027B1300000414FE033812000000380C0000001101390F00" wide //weight: 10
        $x_10_2 = "00110500004B02000025070000290200006F060000BA040000AC030" wide //weight: 10
        $x_10_3 = "A000006186F3A00000A388F00000000026F3E00" wide //weight: 10
        $x_10_4 = "8F306000000026F3800000620FA0000001F187" wide //weight: 10
        $x_10_5 = "E600F6009600370027005600650002009700C6002600D60056" wide //weight: 10
        $x_10_6 = "E600F600960037002700560065005600C60096006400100" wide //weight: 10
        $x_10_7 = "D6001600E4009700E60016000700D600F6003400" wide //weight: 10
        $x_10_8 = "F637562556D69647E65725E23756362757F6375625E2D65647" wide //weight: 10
        $x_1_9 = "GetType" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_10_*) and 4 of ($x_1_*))) or
            ((5 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CMZ_2147788915_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CMZ!MTB"
        threat_id = "2147788915"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 06 11 04 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a b4 9c 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = "W__________W" ascii //weight: 1
        $x_1_3 = "X__________X" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLB_2147788958_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLB!MTB"
        threat_id = "2147788958"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 02 11 04 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26 38 ?? ?? ?? 00 11 04 11 02 3e ?? ?? ?? ff 38 ?? ?? ?? 00 11 04 18 d6 13 04 38 ?? ?? ?? ff 11 01 6f ?? ?? ?? 0a 13 00 38 ?? ?? ?? ff 00 02 6f}  //weight: 1, accuracy: Low
        $x_1_2 = {11 02 11 02 d8 1a d8 13 03 38 ?? ?? ?? 00 00 16 13 0d 38}  //weight: 1, accuracy: Low
        $x_1_3 = "GetMethods" ascii //weight: 1
        $x_1_4 = "BigEndianUnicode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLE_2147788959_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLE!MTB"
        threat_id = "2147788959"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "114"
        strings_accuracy = "High"
    strings:
        $x_50_1 = "382 426 423 421 378 409 427 413 366 364 395 428 426 417 422 415" ascii //weight: 50
        $x_50_2 = "DESCryptoServiceProvider" ascii //weight: 50
        $x_10_3 = "$64454995-9304-4346-9fc4-17a3ccd090f5" ascii //weight: 10
        $x_10_4 = "$754c5cfc-3473-41f4-ae4a-41bc1131ef3e" ascii //weight: 10
        $x_10_5 = "$5dd071ce-5623-4539-af52-652145852aac" ascii //weight: 10
        $x_10_6 = "$8a8f5292-823c-4b83-9b15-8617a8a4b610" ascii //weight: 10
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "FromBase64" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_50_*) and 1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_50_*) and 2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JLN_2147788960_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLN!MTB"
        threat_id = "2147788960"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0c 43 74 42 6d 2d 27 42 6d 2d 27 42 6d 2d 27 19 05 2e 26 48 6d 2d 27 19 05 28 26 d2 6d 2d 27}  //weight: 1, accuracy: High
        $x_1_2 = {05 29 26 50 6d 2d 27 24 02 d0 27 41 6d 2d 27 10 18 28 26 67 6d 2d 27 10 18 29 26 51 6d 2d 27 10 18 2e 26 57 6d 2d 27 19 05 2c 26}  //weight: 1, accuracy: High
        $x_1_3 = {4b 6d 2d 27 42 6d 2c 27 d8 6d 2d 27 14 18 29 26 43 6d 2d 27 14 18 d2 27 43 6d 2d 27 42 6d ba 27 43 6d 2d 27 14 18 2f 26 43 6d 2d 27 52 69 63 68 42 6d 2d}  //weight: 1, accuracy: High
        $x_1_4 = {44 4f 53 20 6d 6f 64 65 2e 0d 0d 0a 24 00 00 00 00 00 00 00 06 0c 43 74 42 6d 2d 27 42 6d 2d 27 42}  //weight: 1, accuracy: High
        $x_1_5 = {43 00 4f 00 4d 00 53 00 50 00 45 00 43 00 00 00 5c 00 63 00 6d 00 64 00 2e 00 65 00 78 00 65}  //weight: 1, accuracy: High
        $x_1_6 = "xpxxxx" ascii //weight: 1
        $x_1_7 = "LCMapStringEx" ascii //weight: 1
        $x_1_8 = "LocaleNameToLCID" ascii //weight: 1
        $x_1_9 = "VirtualProtect" ascii //weight: 1
        $x_1_10 = "\\command\\start.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLP_2147788961_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLP!MTB"
        threat_id = "2147788961"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "c2e7d57a-f365-4702-a7a2-ae90c5c55a23" ascii //weight: 1
        $x_1_2 = "GoatRaising" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "EmptyArray" ascii //weight: 1
        $x_1_6 = "The Jolly Farmer" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CNS_2147789083_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CNS!MTB"
        threat_id = "2147789083"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 49 49 49 49 49 49 49 49 49 49 49 33 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 5a 33 33 33 33 33 33 33 33 33 33 33 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 5a 34 34 34 34 34 34 34 34 34 34 34 34 34 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 5a 36 36 36 36 36 36 36 36 36 36 36 36 36 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 5a 36 37 34 34 34 34 34 34 34 34 34 34 34 34 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 5a 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 33 33 33 33 33 33 33 33 00}  //weight: 1, accuracy: High
        $x_1_8 = "ToUInt32" ascii //weight: 1
        $x_1_9 = "GetMethod" wide //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "GetType" ascii //weight: 1
        $x_1_12 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CNV_2147789162_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CNV!MTB"
        threat_id = "2147789162"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "ToByte" ascii //weight: 1
        $x_1_3 = "Substring" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JLO_2147789173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JLO!MTB"
        threat_id = "2147789173"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 14 14 18 8d ?? ?? ?? 01 25 16 08 06 18 d8 18 6f ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 9c 06 17 d6 0a 06 11 04 31}  //weight: 1, accuracy: Low
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMA_2147789174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMA!MTB"
        threat_id = "2147789174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a b4 9c 09 17 d6 0d 09 08 31 e3}  //weight: 1, accuracy: Low
        $x_1_2 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMB_2147789175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMB!MTB"
        threat_id = "2147789175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 58 5f 31 32 33 31 32 33 34 35 34 33 36 33 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 58 5f 34 35 36 31 00}  //weight: 1, accuracy: High
        $x_1_3 = "ToUInt32" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "ToCharArray" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
        $x_1_10 = "TextEncrypt" ascii //weight: 1
        $x_1_11 = {00 49 49 49 49 49 49 49 49 32 00}  //weight: 1, accuracy: High
        $x_1_12 = {00 49 49 49 49 49 49 49 49 49 35 00}  //weight: 1, accuracy: High
        $x_1_13 = {00 49 49 49 49 49 49 49 49 49 49 31 00}  //weight: 1, accuracy: High
        $x_1_14 = {00 49 49 49 49 49 49 49 49 49 49 49 33 00}  //weight: 1, accuracy: High
        $x_1_15 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 34 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMC_2147789176_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMC!MTB"
        threat_id = "2147789176"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 06 11 04 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a b4 9c 11 04 17 d6 13 04 11 04 09 3e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COM_2147789232_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COM!MTB"
        threat_id = "2147789232"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 06 11 04 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 11 04 17 d6 13 04 11 04 09 31}  //weight: 1, accuracy: Low
        $x_1_2 = "sepyTteG" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CON_2147789233_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CON!MTB"
        threat_id = "2147789233"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 57 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 57 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 58 5f 58 5f 58 5f 58 5f 41 5f 41 5f 41 5f 41 5f 53 5f 53 5f 53 5f 53 00}  //weight: 1, accuracy: High
        $x_1_3 = "get_ParamXGroup" ascii //weight: 1
        $x_1_4 = "get_ParamXArray" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ToCharArray" ascii //weight: 1
        $x_1_7 = "sepyTteG" wide //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COL_2147789234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COL!MTB"
        threat_id = "2147789234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "Resource_Meter" wide //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COP_2147789235_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COP!MTB"
        threat_id = "2147789235"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 1f 7a fe 02 16 fe 01 2b 01 16 0d 09 2c 1f 00 08 1f 6d fe 02 13 04 11 04 2c 09 00 08 1f 0d 59 0c 00 2b 07 00 08 1f 0d 58 0c 00 00 2b 33 08 1f 41 32 0a 08 1f 5a fe 02 16 fe 01 2b 01 16 13 05 11 05 2c 1d 00 08 1f 4d fe 02 13 06 11 06 2c 09 00 08 1f 0d 59 0c 00 2b 07 00 08 1f 0d 58 0c}  //weight: 1, accuracy: High
        $x_1_2 = "Resource_Meter" wide //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COG_2147789236_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COG!MTB"
        threat_id = "2147789236"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 46 5f 32 5f 32 5f 32 5f 32 5f 32 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 46 5f 37 5f 37 5f 37 5f 37 5f 37 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 51 5f 38 5f 51 5f 38 5f 51 5f 38 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 58 5f 30 5f 30 5f 30 5f 30 5f 30 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 5a 36 36 36 36 36 36 36 36 36 36 36 36 36 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 33 33 33 33 33 33 33 33 00}  //weight: 1, accuracy: High
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "FromBase64" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "ToInt64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JME_2147789269_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JME!MTB"
        threat_id = "2147789269"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "1b75ae26-cdce-4404-9933-6d1ba872149c" ascii //weight: 1
        $x_1_2 = "ToByte" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "ParamXArray" ascii //weight: 1
        $x_1_11 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMG_2147789270_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMG!MTB"
        threat_id = "2147789270"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 58 0d 09 08 8e 69 32 d5}  //weight: 1, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMJ_2147789271_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMJ!MTB"
        threat_id = "2147789271"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 7e ?? ?? ?? 04 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 06 03 08 17 58 03 8e 69 5d 91 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 08 17 58 0c 08 6a 03 8e 69 17 59 6a 06 17 58 6e 5a 31 b6}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMZ_2147789272_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMZ!MTB"
        threat_id = "2147789272"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 00 06 11 04 1f 10 28 ?? ?? ?? 0a d1 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 58 0d 09 08 8e 69 32 d5}  //weight: 1, accuracy: Low
        $x_1_2 = {00 07 06 08 8f ?? ?? ?? 01 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 08 17 59 0c 08 15 fe 02 0d 09 2d df}  //weight: 1, accuracy: Low
        $x_1_3 = "Split" ascii //weight: 1
        $x_1_4 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMX_2147789273_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMX!MTB"
        threat_id = "2147789273"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "L2MgcG93ZXJzaGVs" wide //weight: 10
        $x_10_2 = "bCAtQ29tbWFuZCBB" wide //weight: 10
        $x_10_3 = "ZGQtTXBQcmVmZXJl" wide //weight: 10
        $x_10_4 = "bmNlIC1FeGNsdXNp" wide //weight: 10
        $x_1_5 = "GetString" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "runas" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 3 of ($x_1_*))) or
            ((3 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CNW_2147789426_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CNW!MTB"
        threat_id = "2147789426"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 57 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 57 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 53 00 58 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 58 00}  //weight: 1, accuracy: High
        $x_1_3 = "get_ParamXGroup" ascii //weight: 1
        $x_1_4 = "get_ParamXArray" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "SplashScreen_Load" ascii //weight: 1
        $x_1_7 = {00 50 6f 69 6e 74 00 4d 65 73 73 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COY_2147789427_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COY!MTB"
        threat_id = "2147789427"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 07 11 04 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 11 04 17 58 13 04 11 04 08 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ToByte" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
        $x_1_6 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COZ_2147789428_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COZ!MTB"
        threat_id = "2147789428"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "612BC9062A00133003003F0000000300001100205321DFF92" wide //weight: 1
        $x_1_2 = "A0A0720DFEAADF05A20E4B7A47A612BC9062A0013300" wide //weight: 1
        $x_1_3 = "1007E050000046F2700000A0A204B211F9A201B4DAC" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ToByte" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "ParamXArray" ascii //weight: 1
        $x_1_9 = "ParamXGroup" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COX_2147789429_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COX!MTB"
        threat_id = "2147789429"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {44 72 61 77 00 66 67 68}  //weight: 1, accuracy: High
        $x_1_2 = {50 31 00 4b 31 00 63 62 61}  //weight: 1, accuracy: High
        $x_1_3 = {47 75 72 75 00 58 65 48 00 68 65 78}  //weight: 1, accuracy: High
        $x_1_4 = {75 67 7a 31 00 75 67 7a 33 00 70 72 6f 6a 6e 61 6d 65}  //weight: 1, accuracy: High
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "ToInt32" ascii //weight: 1
        $x_1_9 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COW_2147789430_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COW!MTB"
        threat_id = "2147789430"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a dd ?? ?? ?? ?? 08 39 ?? ?? ?? ?? 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d dd ?? ?? ?? ?? 07 39 ?? ?? ?? ?? 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CPD_2147789431_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CPD!MTB"
        threat_id = "2147789431"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 41 31 32 33 34 00 69 6e 70 75 74 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 41 32 33 35 34 38 00 73 00 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 41 36 38 37 39 00 73 74 72 00 41 36 35 34 36 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 39 38 37 00 74 65 78 74 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 41 41 41 31 32 33 00 54 79 70 65 00 78 7a 00}  //weight: 1, accuracy: High
        $x_1_6 = "ToCharArray" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "ToInt64" ascii //weight: 1
        $x_1_9 = "GetType" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CPM_2147789432_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CPM!MTB"
        threat_id = "2147789432"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 73 ?? ?? ?? 0a 0c 08 06 6f ?? ?? ?? 0a 00 08 18 6f ?? ?? ?? 0a 00 08 6f ?? ?? ?? 0a 0d 09 02 16 02 8e 69 6f ?? ?? ?? 0a 13 04 08 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetExportedTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMH_2147789455_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMH!MTB"
        threat_id = "2147789455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Split" ascii //weight: 1
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = {00 46 5f 32 5f 32 5f 32 5f 32 5f 32 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 46 5f 37 5f 37 5f 37 5f 37 5f 37 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 51 5f 38 5f 51 5f 38 5f 51 5f 38 00}  //weight: 1, accuracy: High
        $x_1_9 = "ZZZZZZZZZZZ33333333" ascii //weight: 1
        $x_1_10 = {00 58 5f 30 5f 30 5f 30 5f 30 5f 30 00}  //weight: 1, accuracy: High
        $x_1_11 = {00 5a 36 36 36 36 36 36 36 36 36 36 36 36 36 00}  //weight: 1, accuracy: High
        $x_1_12 = {00 5a 36 37 34 34 34 34 34 34 34 34 34 34 34 34 00}  //weight: 1, accuracy: High
        $x_1_13 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNA_2147789456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNA!MTB"
        threat_id = "2147789456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Reverse" ascii //weight: 1
        $x_1_2 = {00 57 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 57 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 58 5f 58 5f 58 5f 58 5f 41 5f 41 5f 41 5f 41 5f 53 5f 53 5f 53 5f 53 00}  //weight: 1, accuracy: High
        $x_1_4 = "get_ParamXGroup" ascii //weight: 1
        $x_1_5 = "get_ParamXArray" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "ToCharArray" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNC_2147789457_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNC!MTB"
        threat_id = "2147789457"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 d0 ?? ?? ?? 1b 28 ?? ?? ?? 0a a2 6f ?? ?? ?? 0a 14 17 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNL_2147789458_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNL!MTB"
        threat_id = "2147789458"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "65"
        strings_accuracy = "High"
    strings:
        $x_50_1 = {00 57 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 57 00}  //weight: 50, accuracy: High
        $x_10_2 = {00 58 5f 58 5f 58 5f 58 5f 41 5f 41 5f 41 5f 41 5f 53 5f 53 5f 53 5f 53 00}  //weight: 10, accuracy: High
        $x_10_3 = {00 58 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 58 00}  //weight: 10, accuracy: High
        $x_1_4 = "get_ParamXGroup" ascii //weight: 1
        $x_1_5 = "get_ParamXArray" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_50_*) and 1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((1 of ($x_50_*) and 2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JNM_2147789459_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNM!MTB"
        threat_id = "2147789459"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a ?? ?? ?? ?? ?? ?? ?? ?? ?? 59 28 ?? ?? ?? 0a b7 13 06 07 11 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 00 11 04 17 d6 13 04 11 04 09 8e 69 fe 04 13 07 11 07 2d bf}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNO_2147789460_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNO!MTB"
        threat_id = "2147789460"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 93 03 07 03 8e 69 5d 93 61 d1 6f ?? ?? ?? 0a 26 07 17 58 0b 07 02 8e 69 32 e3}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQL_2147793015_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQL!MTB"
        threat_id = "2147793015"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 08 17 58 0c 08 06 6f ?? ?? ?? 0a 18 5b fe 04 0d 09 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "ToByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQK_2147793016_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQK!MTB"
        threat_id = "2147793016"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "2B0F0720D0F3FA805A208EA7B1BC612BD4" wide //weight: 1
        $x_1_2 = "EF43E2C45A613875FFFFFF0011072042B67CD45A2071" wide //weight: 1
        $x_1_3 = "204A3AF5ED206EBBBFB261251307195E4503" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ToByte" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQH_2147793017_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQH!MTB"
        threat_id = "2147793017"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 4f 5f 30 5f 30 5f 30 5f 30 5f 30 5f 30 5f 30 5f 30 5f 30 5f 30 5f 30 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 4f 5f 4f 5f 4f 5f 4f 5f 4f 5f 4f 5f 4f 5f 4f 5f 4f 5f 4f 00}  //weight: 1, accuracy: High
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "ToByte" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "ParamXGroup" ascii //weight: 1
        $x_1_8 = "Substring" ascii //weight: 1
        $x_1_9 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNE_2147793072_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNE!MTB"
        threat_id = "2147793072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 73 ?? ?? ?? 0a 0c 08 06 6f ?? ?? ?? 0a 00 08 18 6f ?? ?? ?? 0a 00 08 6f ?? ?? ?? 0a 0d 09 02 16 02 8e 69 6f ?? ?? ?? 0a 13 04 08 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "90acc8ed-f12e-4222-802f-c2b05a6535ca" ascii //weight: 1
        $x_1_3 = "OpenCC GUI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNZ_2147793073_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNZ!MTB"
        threat_id = "2147793073"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "396 398 425 393 377 377 389 377 377 377 377 381 377 377 377 377 359" ascii //weight: 10
        $x_10_2 = "410 415 378 396 389 360 416 398 383 416 424 411 433 378 431 411 421" ascii //weight: 10
        $x_1_3 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNY_2147793074_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNY!MTB"
        threat_id = "2147793074"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 07 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 08 8e 69 32 e2}  //weight: 1, accuracy: Low
        $x_1_2 = "19dfd389-a165-4e69-b1ad-6ca6cbd2a1a7" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOA_2147793143_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOA!MTB"
        threat_id = "2147793143"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "8a3f4cab-74be-4553-b6c8-c6672e815420" ascii //weight: 1
        $x_1_2 = "AAA123" ascii //weight: 1
        $x_1_3 = {00 4f 4f 4f 4f 4f 00}  //weight: 1, accuracy: High
        $x_1_4 = "A23548" ascii //weight: 1
        $x_1_5 = "A6546" ascii //weight: 1
        $x_1_6 = "A6879" ascii //weight: 1
        $x_1_7 = "A9283" ascii //weight: 1
        $x_1_8 = "Kp34" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOB_2147793313_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOB!MTB"
        threat_id = "2147793313"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 09 06 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 09 6f ?? ?? ?? 0a 18 5b fe 04 13 05 11 05 2d d3}  //weight: 1, accuracy: Low
        $x_1_2 = "NxtManagerV3" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOE_2147793314_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOE!MTB"
        threat_id = "2147793314"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 07 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 09 17 58 0d 09 06 6f ?? ?? ?? 0a 18 5b fe 04 13 04 11 04 2d d0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOG_2147793315_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOG!MTB"
        threat_id = "2147793315"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$f80e8773-4c8c-4355-a28a-78d4b3bf2268" ascii //weight: 1
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOH_2147793316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOH!MTB"
        threat_id = "2147793316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "asssssssssddddd.dll" ascii //weight: 1
        $x_1_2 = "#f.dll#" ascii //weight: 1
        $x_1_3 = "#fsdf.dll#" ascii //weight: 1
        $x_1_4 = "#fsdfsdf.dll#" ascii //weight: 1
        $x_1_5 = "#r.dll#" ascii //weight: 1
        $x_1_6 = "#s.dll#" ascii //weight: 1
        $x_1_7 = "gdfgfdg" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOJ_2147793317_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOJ!MTB"
        threat_id = "2147793317"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$29b75cd8-cfc7-441e-85ca-89059e5c7291" ascii //weight: 1
        $x_1_2 = "Game" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOM_2147793318_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOM!MTB"
        threat_id = "2147793318"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AAA123" ascii //weight: 1
        $x_1_2 = {00 4f 4f 4f 4f 4f 00}  //weight: 1, accuracy: High
        $x_1_3 = "A23548" ascii //weight: 1
        $x_1_4 = "A6546" ascii //weight: 1
        $x_1_5 = "A6879" ascii //weight: 1
        $x_1_6 = "A9283" ascii //weight: 1
        $x_1_7 = "Split" ascii //weight: 1
        $x_1_8 = "ToDouble" ascii //weight: 1
        $x_1_9 = "Round" ascii //weight: 1
        $x_1_10 = "ToString" ascii //weight: 1
        $x_1_11 = "Append" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOK_2147793319_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOK!MTB"
        threat_id = "2147793319"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 08 17 58 0c 08 06 6f ?? ?? ?? 0a 18 5b fe 04 0d 09 2d d5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JOL_2147793320_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JOL!MTB"
        threat_id = "2147793320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$4629d8b2-b162-44a9-a207-f2b0b42234c5" ascii //weight: 1
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CPY_2147793359_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CPY!MTB"
        threat_id = "2147793359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 07 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 08 8e 69 fe 04 13 04 11 04 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "ToByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQB_2147793360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQB!MTB"
        threat_id = "2147793360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 07 17 58 0b 07 06 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "4900560045005100570049004A005600450049004A004900510057005600490071007A002E00" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQN_2147793361_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQN!MTB"
        threat_id = "2147793361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2d 03 26 2b 03 0b 2b 00 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a ?? 2d 03 26 2b 03 0c 2b 00 08 07 6f ?? ?? ?? 0a de 07 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d de 0e 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_3 = "ClassLibrary" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PK_2147793387_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PK!MSR"
        threat_id = "2147793387"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 08 11 04 07 11 04 18 5a 18 6f ?? ?? ?? ?? 1f 10 28 ?? ?? ?? ?? 9c 00 11 04 17 58 13 04 11 04 08 8e 69 fe 04}  //weight: 1, accuracy: Low
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ToByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADA_2147793458_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADA!MTB"
        threat_id = "2147793458"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 09 17 58 0d 09 06 6f ?? ?? ?? 0a 18 5b}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" wide //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
        $x_1_6 = "ParamXArray" ascii //weight: 1
        $x_1_7 = "ParamXGroup" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADB_2147793459_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADB!MTB"
        threat_id = "2147793459"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00A0A209A6A6CE020A429FFDE61250B195E4503" wide //weight: 1
        $x_1_2 = "A0B612B95082D08202289FFC1252B06204AB02BD92526110720EF4" wide //weight: 1
        $x_1_3 = "A0D092C0820AE02FA45252B06201E63990A2526110" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" wide //weight: 1
        $x_1_6 = "ToInt32" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "ParamXArray" ascii //weight: 1
        $x_1_9 = "ParamXGroup" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPA_2147793515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPA!MTB"
        threat_id = "2147793515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetArrays" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "Reflection" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPB_2147793516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPB!MTB"
        threat_id = "2147793516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 09 17 58 0d 09 06 6f ?? ?? ?? 0a 18 5b fe 04 13 04 11 04}  //weight: 10, accuracy: Low
        $x_10_2 = "$bb2f95a9-eb9f-43ff-9211-b44dfd0e435b" ascii //weight: 10
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = {50 00 61 00 6e 00 61 00 6d 00 65 00 72 00 61 00 2e 00 50 00 6f 00 72 00 73 00 63 00 68}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JPC_2147793517_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPC!MTB"
        threat_id = "2147793517"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a dd ?? ?? ?? 00 08 39 ?? ?? ?? 00 08 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "ClassLibrary" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPD_2147793518_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPD!MTB"
        threat_id = "2147793518"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "e092b687-6835-4927-bae4-5422b13f6536" ascii //weight: 1
        $x_1_2 = "Outrage Engine" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CQJ_2147793536_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CQJ!MTB"
        threat_id = "2147793536"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "9fb8206e-400f-4360-9579-09611a7bfa65" ascii //weight: 1
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "Bitmap" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CRH_2147793537_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CRH!MTB"
        threat_id = "2147793537"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 41 32 33 35 34 38 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 41 36 35 34 36 00 41 73 73 65 6d 62 6c 79 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 41 36 38 37 39 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 41 41 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 41 39 32 38 33 00}  //weight: 1, accuracy: High
        $x_1_6 = "ToCharArray" ascii //weight: 1
        $x_1_7 = "FromBase64CharArray" ascii //weight: 1
        $x_1_8 = "ToDouble" ascii //weight: 1
        $x_1_9 = "GetType" ascii //weight: 1
        $x_1_10 = "Append" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CRN_2147793538_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CRN!MTB"
        threat_id = "2147793538"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 09 18 5a 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 d2}  //weight: 1, accuracy: Low
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = "ToUInt32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CRS_2147793539_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CRS!MTB"
        threat_id = "2147793539"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 46 54 5f 46 54 32 00 53 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 46 54 5f 46 54 31 00 4d 65 73 73 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_3 = "Substring" ascii //weight: 1
        $x_1_4 = "ToUInt32" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADN_2147793546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADN!MTB"
        threat_id = "2147793546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 09 17 58 0d 09 06 6f ?? ?? ?? 0a 18 5b}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" wide //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADM_2147793547_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADM!MTB"
        threat_id = "2147793547"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00A0A204B211F9A201B4DACD261250B195E4503" wide //weight: 1
        $x_1_2 = "A0D092C0820AE02FA45252B06201E63990A252611072" wide //weight: 1
        $x_1_3 = "2B12020A110720FAC8F2DD5A2015794C6C612BD0062A" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" wide //weight: 1
        $x_1_6 = "ToInt32" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSM_2147793548_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSM!MTB"
        threat_id = "2147793548"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 06 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 08 17 58 0c 08 06 6f ?? ?? ?? 0a 18 5b fe 04 0d 09}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GetDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSP_2147793615_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSP!MTB"
        threat_id = "2147793615"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 07 11 04 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 07 6f ?? ?? ?? 0a 18 5b}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" wide //weight: 1
        $x_1_4 = "Panamera.Porsche" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KGO_2147793616_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KGO!MTB"
        threat_id = "2147793616"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 58 30 46 54 5f 46 54 32 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 58 30 46 54 5f 46 54 31 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 44 65 73 44 65 63 72 79 70 74 00}  //weight: 1, accuracy: High
        $x_1_4 = "Panamera.Porsche" wide //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "CreateInstance" wide //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KGO_2147793616_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KGO!MTB"
        threat_id = "2147793616"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0c 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 08 13 05 2b}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "CreateInstance" wide //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KGP_2147793617_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KGP!MTB"
        threat_id = "2147793617"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MqQ4b7ToMNFb2euUN06mzVvZ65Q3Tqb" wide //weight: 1
        $x_1_2 = "rmKDYZoHhdUbKdnrIsxP6rMRoiQoP" wide //weight: 1
        $x_1_3 = "WDDpXPO43sQiuwBoAMXWUz1x1TNn" wide //weight: 1
        $x_1_4 = "Panamera.Porsche" wide //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "CreateInstance" wide //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KII_2147793714_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KII!MTB"
        threat_id = "2147793714"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7 13 06 07 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 11 04 17 d6 13 04 11 04 09 8e 69 fe 04 13 07 11 07 2d ba}  //weight: 1, accuracy: Low
        $x_1_2 = "gnirtS46esaBmorF" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JNX_2147793740_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JNX!MTB"
        threat_id = "2147793740"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 d6 0d 09 08 31 e4}  //weight: 1, accuracy: Low
        $x_1_2 = "$769b753c-436e-4588-a6a8-89ea6ac04a6e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPG_2147793741_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPG!MTB"
        threat_id = "2147793741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 03 04 09 6c 07 5a 58 6f ?? ?? ?? 06 58 0c 09 17 58 0d 09 06}  //weight: 1, accuracy: Low
        $x_1_2 = {00 45 78 70 00}  //weight: 1, accuracy: High
        $x_1_3 = "Log10" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "TripleDESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPI_2147793742_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPI!MTB"
        threat_id = "2147793742"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 7e ?? ?? ?? 04 06 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 18 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 0c 08 02 16 02 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPJ_2147793743_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPJ!MTB"
        threat_id = "2147793743"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 d6 0d 09 08 31 e4}  //weight: 1, accuracy: Low
        $x_1_2 = "9848e74d-26d0-4ce7-817f-b8c9daf189cd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPN_2147793744_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPN!MTB"
        threat_id = "2147793744"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 06 07 02 07 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0d 09 2d dc}  //weight: 1, accuracy: Low
        $x_1_2 = "680074007400" ascii //weight: 1
        $x_1_3 = "700073003A002F002F" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPO_2147793745_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPO!MTB"
        threat_id = "2147793745"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 07 02 07 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0d 09 3a}  //weight: 10, accuracy: Low
        $x_1_2 = "gameoverlayui.exe" ascii //weight: 1
        $x_1_3 = "Telegram FZ-LLC" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JPP_2147793746_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPP!MTB"
        threat_id = "2147793746"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = "cdeb7676-ea35-4498-ac26-38a230e1f1da" ascii //weight: 10
        $x_1_2 = {00 07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 00 09 17 58 0d 09 06 6f ?? ?? ?? 0a 18 5b fe 04 13 04 11 04}  //weight: 1, accuracy: Low
        $x_1_3 = "ConsolePokerGame" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JPQ_2147793747_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPQ!MTB"
        threat_id = "2147793747"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "venezuela_48x48_33" ascii //weight: 1
        $x_1_2 = "vietnam_48x48_33" ascii //weight: 1
        $x_1_3 = "virgin_48x48_33" ascii //weight: 1
        $x_1_4 = "wales_48x48_33" ascii //weight: 1
        $x_1_5 = "wallis_48x48_33" ascii //weight: 1
        $x_1_6 = "western_48x48_33" ascii //weight: 1
        $x_1_7 = "yemen_48x48_33" ascii //weight: 1
        $x_1_8 = "zambia_48x48_33" ascii //weight: 1
        $x_1_9 = "zimbabwe_48x48_33" ascii //weight: 1
        $x_1_10 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPZ_2147793748_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPZ!MTB"
        threat_id = "2147793748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 08 11 04 07 11 04 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 07 6f ?? ?? ?? 0a 18 5b fe 04 13 05 11 05 2d c6}  //weight: 10, accuracy: Low
        $x_10_2 = "$856c6768-4a38-4846-8fb4-94e1becee1d8" ascii //weight: 10
        $x_1_3 = "ConsoleGameCollection" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JPY_2147793749_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPY!MTB"
        threat_id = "2147793749"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 58 30 46 54 5f 46 54 32 00 53 00 58 30 46 54 5f 46 54 31}  //weight: 1, accuracy: High
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "ParamXGroup" ascii //weight: 1
        $x_1_8 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPX_2147793750_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPX!MTB"
        threat_id = "2147793750"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 93 03 07 03 8e 69 5d 93 61 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 07 17 58 0b 07 02 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JPW_2147793751_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JPW!MTB"
        threat_id = "2147793751"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FromBase64String" ascii //weight: 1
        $x_1_2 = "FindRdasdsesource" ascii //weight: 1
        $x_1_3 = "gfhhfhfhfhfhfhfhfhfhfhfh" ascii //weight: 1
        $x_1_4 = "gfdffffffg" ascii //weight: 1
        $x_1_5 = "fsdfsdfsd" ascii //weight: 1
        $x_1_6 = "#fsdfdsf.dll#" ascii //weight: 1
        $x_1_7 = "#fsdfsd.dll#" ascii //weight: 1
        $x_1_8 = "#gdfg#" ascii //weight: 1
        $x_1_9 = "#ghfh.dll#" ascii //weight: 1
        $x_1_10 = "#fsd.dll#" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JQB_2147793752_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JQB!MTB"
        threat_id = "2147793752"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$8a8f5292-823c-4b83-9b15-8617a8a4b610" ascii //weight: 1
        $x_1_2 = {00 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_3 = "ThreadPool.Light" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Action_Timer" ascii //weight: 1
        $x_1_6 = "Action List.ini" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JQC_2147793753_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JQC!MTB"
        threat_id = "2147793753"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "NeWcOPhare" ascii //weight: 10
        $x_10_2 = "gfgfdfdg" ascii //weight: 10
        $x_10_3 = "fdsfds" ascii //weight: 10
        $x_1_4 = "LzmaDecoder" ascii //weight: 1
        $x_1_5 = "m_IsMatchDecoders" ascii //weight: 1
        $x_1_6 = {43 6f 70 79 42 6c 6f 63 6b 00 50 75 74 42 79 74 65 00 47 65 74 42 79 74 65}  //weight: 1, accuracy: High
        $x_1_7 = "VirtualProtect" ascii //weight: 1
        $x_1_8 = "Decrypt" ascii //weight: 1
        $x_1_9 = "Decompress" ascii //weight: 1
        $x_1_10 = "ReverseDecode" ascii //weight: 1
        $x_1_11 = "ToBase64String" ascii //weight: 1
        $x_1_12 = "BitDecoder" ascii //weight: 1
        $x_1_13 = "BitTreeDecoder" ascii //weight: 1
        $x_1_14 = "DecodeDirectBits" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 11 of ($x_1_*))) or
            ((2 of ($x_10_*) and 1 of ($x_1_*))) or
            ((3 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CRZ_2147793755_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CRZ!MTB"
        threat_id = "2147793755"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 58 30 46 54 5f 46 54 32 00 53 00}  //weight: 1, accuracy: High
        $x_1_2 = {58 30 46 54 5f 46 54 31 [0-21] 4d 65 73 73 61 67 65}  //weight: 1, accuracy: Low
        $x_1_3 = "Substring" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "ParamXGroup" ascii //weight: 1
        $x_1_8 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSI_2147793756_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSI!MTB"
        threat_id = "2147793756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2d 03 26 2b 03 0b 2b 00 73 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a [0-2] 2d 22 26 07 08 6f ?? ?? ?? 0a 07 18 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 03 16 03 8e 69 6f ?? ?? ?? 0a 0d de 15 0c 2b dc 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResource" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "AssemblyResolve" ascii //weight: 1
        $x_1_5 = {00 43 6c 61 73 73 4c 69 62 72 61 72 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABP_2147793762_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABP!MTB"
        threat_id = "2147793762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 6e 31 03 16 2b 01 17 17 59 7e 2c 00 00 04 20 04 0a 00 00 95 5f 7e 2c 00 00 04 20 88 08 00 00 95 61 58 81 07 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABP_2147793762_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABP!MTB"
        threat_id = "2147793762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 11 0a 8f 13 00 00 01 25 47 08 d2 61 d2 52 11 0a 20 ff 00 00 00 5f 2d 0b 08 08 5a 20 b7 5c 8a 00 6a 5e 0c 11 0a 17 58 13 0a 11 0a 11 05 8e 69 32 cd}  //weight: 1, accuracy: High
        $x_1_2 = "67.0.3396.87" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRB_2147793777_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRB!MTB"
        threat_id = "2147793777"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 05 07 11 05 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 11 05 17 d6 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "87e2143a-8cb9-462f-84aa-c78e00bdf97a" ascii //weight: 1
        $x_1_3 = {00 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 57 53 53 00}  //weight: 1, accuracy: High
        $x_1_5 = "get_ParamArray0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRC_2147793778_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRC!MTB"
        threat_id = "2147793778"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$373e9203-e00d-4e2f-a726-8eeae96ae57f" ascii //weight: 1
        $x_1_2 = {00 58 30 46 54 5f 46 54 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 58 30 46 54 5f 46 54 31 00}  //weight: 1, accuracy: High
        $x_1_4 = "towerDefenseG" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
        $x_1_10 = "ParamXGroup" ascii //weight: 1
        $x_1_11 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRD_2147793791_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRD!MTB"
        threat_id = "2147793791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "49ef1f2e-9537-470c-b869-9bdd52010f42" ascii //weight: 1
        $x_1_2 = "AccountManage" ascii //weight: 1
        $x_1_3 = "people.xml" ascii //weight: 1
        $x_1_4 = "people.csv" ascii //weight: 1
        $x_1_5 = "0S8hezeGK1w" ascii //weight: 1
        $x_1_6 = "KK84syQzi3pGpMTkn0" ascii //weight: 1
        $x_1_7 = "4zechLExJiEKxqSX" ascii //weight: 1
        $x_1_8 = "VjM3nISxMSYhCze" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_11 = "System.Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HL_2147793871_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HL!MTB"
        threat_id = "2147793871"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$8054d9cc-f83c-4e25-9083-714fb217a78d" ascii //weight: 20
        $x_1_2 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_3 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_HM_2147793874_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HM!MTB"
        threat_id = "2147793874"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$ce9537f3-4b97-4085-8165-8ed2b274e00e" ascii //weight: 20
        $x_20_2 = "$8054d9cc-f83c-4e25-9083-714fb217a78d" ascii //weight: 20
        $x_20_3 = "$b03a5e7e-fe3a-4041-9b51-015257d924f5" ascii //weight: 20
        $x_20_4 = "$013b62e6-0f54-46fd-9c1e-fe65f7b8b3c5" ascii //weight: 20
        $x_20_5 = "$87cba0c0-858d-48b0-9efe-43847b811526" ascii //weight: 20
        $x_20_6 = "$22529860-2fc2-4ffe-94ce-84ea6f5ef2c6" ascii //weight: 20
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggingModes" ascii //weight: 1
        $x_1_14 = "FromBase64String" ascii //weight: 1
        $x_1_15 = "CreateInstance" ascii //weight: 1
        $x_1_16 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CTM_2147793888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CTM!MTB"
        threat_id = "2147793888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7 13 06 07 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 11 04 17 d6 13 04 11 04 09 8e 69 fe 04 13 07 11 07 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "GetMethod" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RAM_2147793894_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RAM!MTB"
        threat_id = "2147793894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 04 06 11 04 18 d8 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 11 04 17 d6 13 04}  //weight: 10, accuracy: Low
        $x_10_2 = "sepyTteG" wide //weight: 10
        $x_1_3 = "LateGet" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRN_2147793937_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRN!MTB"
        threat_id = "2147793937"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 ?? ?? ?? ?? ?? ?? ?? ?? 59 28 ?? ?? ?? 0a b7 13 06 07 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 11 04 17 d6 13 04 11 04 09 8e 69 fe 04 13 07 11 07 2d ba}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRN_2147793937_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRN!MTB"
        threat_id = "2147793937"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 09 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 06 11 04 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 02 28 ?? ?? ?? 0a 0c 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 08 16 08 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0b 07 13 05 11 05}  //weight: 1, accuracy: Low
        $x_1_2 = "$0bceef2e-c6d7-4401-85f7-8d0cd7aa7416" ascii //weight: 1
        $x_1_3 = "ServiceManager" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "Ventelo" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRE_2147793980_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRE!MTB"
        threat_id = "2147793980"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fe 0e 04 00 38 38 00 00 00 fe 0d 04 00 28 16 00 00 0a fe 0e 05 00 fe 0c 05 00 28 17 00 00 0a fe 0c 02 00 28 18 00 00 0a da fe 0e 06 00 fe 0c 03 00 fe 0c 06 00 28 19 00 00 0a 6f 1a 00 00 0a 26 00 fe 0d 04}  //weight: 1, accuracy: High
        $x_1_2 = "LoadLibrary" ascii //weight: 1
        $x_1_3 = "ConvertFromUtf32" ascii //weight: 1
        $x_1_4 = "ConferenceRegistration.My" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JSA_2147793990_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JSA!MTB"
        threat_id = "2147793990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0c 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 18 17 8d ?? ?? ?? 01 25 16 06 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "$a7f4eeb7-988c-4454-9618-9b0b2f91a60e" ascii //weight: 1
        $x_1_3 = "_X_X0FT_FT2" ascii //weight: 1
        $x_1_4 = "_X_X0FT_FT1" ascii //weight: 1
        $x_1_5 = "_X_TSS3" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FGQ_2147793993_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FGQ!MTB"
        threat_id = "2147793993"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 20 00 01 00 00 6f ?? ?? ?? 0a 06 20 80 00 00 00 6f ?? ?? ?? 0a 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 20 e8 03 00 00 73 ?? ?? ?? 0a [0-2] 2d 43 26 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 03 06 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "GetManifestResource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KGZ_2147793994_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KGZ!MTB"
        threat_id = "2147793994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 20 00 01 00 00 6f ?? ?? ?? 0a 06 20 80 00 00 00 6f ?? ?? ?? 0a 02 7b ?? ?? ?? 04 02 7b ?? ?? ?? 04 20 ?? ?? ?? ?? 73 ?? ?? ?? 0a 0b 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 03 06 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0c}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "ClassLibrary" ascii //weight: 1
        $x_1_5 = "GetManifestResource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KIJ_2147793995_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KIJ!MTB"
        threat_id = "2147793995"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingMode" ascii //weight: 1
        $x_1_3 = "System.Convert" wide //weight: 1
        $x_1_4 = "gnirtS46esaBmorF" wide //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetMethod" wide //weight: 1
        $x_1_8 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CTS_2147794025_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CTS!MTB"
        threat_id = "2147794025"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "53"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "DebuggableAttribute" ascii //weight: 10
        $x_10_2 = "DebuggingMode" ascii //weight: 10
        $x_10_3 = "System.Convert" wide //weight: 10
        $x_10_4 = "gnirtS46esaBmorF" wide //weight: 10
        $x_10_5 = "StrReverse" ascii //weight: 10
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "spyTteG" wide //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "Invoke" ascii //weight: 1
        $x_1_10 = "dohteMteG" wide //weight: 1
        $x_1_11 = "ekovnI" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JSC_2147794057_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JSC!MTB"
        threat_id = "2147794057"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 06 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 07 06 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 02 16 02 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "$40d41dbe-54e6-48b1-acd9-a8c3146f5e96" ascii //weight: 1
        $x_1_3 = "_X_X0FT_FT2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CUC_2147794073_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CUC!MTB"
        threat_id = "2147794073"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RiMaHU8bJLpOqrDSEmHr7I3uaR" wide //weight: 1
        $x_1_2 = "WoZGMdRuuAIpRu+USKdyn7oaxQBzzwaMfDobHdf" wide //weight: 1
        $x_1_3 = "Em9NH8QAXxa0ESb33fKfiETrNVKjNSJGqKeGP" wide //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CUD_2147794074_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CUD!MTB"
        threat_id = "2147794074"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 05 02 11 05 91 08 61 07 06 91 61 b4 9c}  //weight: 1, accuracy: High
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "Substring" ascii //weight: 1
        $x_1_6 = "ToInt32" ascii //weight: 1
        $x_1_7 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JSF_2147794079_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JSF!MTB"
        threat_id = "2147794079"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 11 05}  //weight: 1, accuracy: Low
        $x_1_2 = "6A1C8CBD-5672-4B41-B6AE-A0B20EFEB250" ascii //weight: 1
        $x_1_3 = "set_X" ascii //weight: 1
        $x_1_4 = "get_Jonas" ascii //weight: 1
        $x_1_5 = {00 58 65 48 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 78 79 7a 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 63 62 61 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 66 67 68 00}  //weight: 1, accuracy: High
        $x_1_9 = "EnvoySinks" ascii //weight: 1
        $x_1_10 = {00 58 65 48 00 68 65 78 00}  //weight: 1, accuracy: High
        $x_1_11 = "System.Threading" ascii //weight: 1
        $x_1_12 = {00 78 78 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KLS_2147794085_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KLS!MTB"
        threat_id = "2147794085"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "YXSRurpd36K8q9HcGTR0zm4zMtJeSdntwoDT" wide //weight: 1
        $x_1_2 = "MNMtlcylOQVWBvD3j5lZYWmJPibIUtknshM" wide //weight: 1
        $x_1_3 = "IoxGoakfznkWa3DHs0fhQx6BV913eyDZ" wide //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JSB_2147794116_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JSB!MTB"
        threat_id = "2147794116"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 9a 13 05 11 05 28 ?? ?? ?? 0a 23 ?? ?? ?? ?? ?? ?? ?? ?? 59 28 ?? ?? ?? 0a b7 13 06 07 11 06 28 [0-21] 0a 0b 00 11 04 17 d6 13 04 11 04 09 8e 69 fe 04 13 07 11 07 2d ba}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CUN_2147794136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CUN!MTB"
        threat_id = "2147794136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5f 58 5f 58 30 46 54 5f 46 54 31 00 4d 65 73 73 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 5f 58 5f 58 30 46 54 5f 46 54 32 00 53 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 52 53 4d 00 49 6e 74 65 78 74 00}  //weight: 1, accuracy: High
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "DebuggingMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRA_2147794185_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRA!MTB"
        threat_id = "2147794185"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "64B166EE-D721-4A2F-9C71-51C495D31ECB" ascii //weight: 1
        $x_1_2 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_3 = "Factory Reset" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JSD_2147794186_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JSD!MTB"
        threat_id = "2147794186"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 1, accuracy: Low
        $x_1_2 = "Decoder" ascii //weight: 1
        $x_1_3 = "WinApi" ascii //weight: 1
        $x_1_4 = "DynamicInvoke" ascii //weight: 1
        $x_1_5 = "Phone" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CreateDelegate" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JSE_2147794187_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JSE!MTB"
        threat_id = "2147794187"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "47"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "_X_X0FT_FT2" ascii //weight: 20
        $x_20_2 = "_X_X0FT_FT1" ascii //weight: 20
        $x_1_3 = "_X_TSS3" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "ParamXArray" ascii //weight: 1
        $x_1_7 = "ParamXGroup" ascii //weight: 1
        $x_1_8 = "System.Activator" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "InvokeMember" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_12 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_20_*) and 7 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JTA_2147794208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTA!MTB"
        threat_id = "2147794208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 28 ?? ?? ?? 0a 02 06 17 6a 58 02 8e 69 6a 5d d4 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d 28 ?? ?? ?? 0a 9c 00 06 17 6a 58 0a 06 02 8e 69 17 59 6a 04 17 58 6e 5a fe 02 16 fe 01 0b 07 2d a0}  //weight: 1, accuracy: Low
        $x_1_2 = "IIIIII42" ascii //weight: 1
        $x_1_3 = "IIIIII43" ascii //weight: 1
        $x_1_4 = "ParamXArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTB_2147794209_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTB!MTB"
        threat_id = "2147794209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 28 ?? ?? ?? 0a 02 06 17 6a 58 02 8e 69 6a 5d d4 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00}  //weight: 1, accuracy: Low
        $x_1_2 = "$169836f3-525e-4019-9d80-272eeb6fd14a" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KKQ_2147794218_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KKQ!MTB"
        threat_id = "2147794218"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 6f ?? ?? ?? 0a 7e ?? ?? ?? 04 07 7e ?? ?? ?? 04 8e 69 5d 91 61 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = {d2 6a 98 21 4e 6e 4c 09 aa e4 b2 de e9 9e 58 e4 c2 5f 42 f8 a7 76 7d ce e0 10 14 b1 8a 99 fd 28 d9 e4 b2 8b a5 85 cc a6}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CTY_2147794219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CTY!MTB"
        threat_id = "2147794219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 07 08 20 e8 03 00 00 73 ?? ?? ?? 0a 0d 06 09 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 09 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 02 06 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 13}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = {47 65 74 45 78 65 63 75 74 69 6e 67 41 73 73 65 6d 62 6c 79 00 43 6c 61 73 73 4c 69 62 72 61 72 79}  //weight: 1, accuracy: High
        $x_1_4 = "GetManifestResource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CUE_2147794220_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CUE!MTB"
        threat_id = "2147794220"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 09 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_10_2 = {06 11 04 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 13 05 11 05 06 6f ?? ?? ?? 0a 17}  //weight: 10, accuracy: Low
        $x_1_3 = "-enc UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMgAwAA==" wide //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CUL_2147794221_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CUL!MTB"
        threat_id = "2147794221"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 20 80 00 00 00 6f ?? ?? ?? 0a 38 ?? ?? ?? 00 11 00 11 03 11 00 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 20 01 00 00 00 7e ?? ?? ?? 04 3a}  //weight: 1, accuracy: Low
        $x_1_2 = "-enc UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMgAwAA==" wide //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule Trojan_MSIL_AgentTesla_CUM_2147794222_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CUM!MTB"
        threat_id = "2147794222"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 06 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 06 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0c 08 8e 69 1f 10 59 8d ?? ?? ?? 01 0d 08 1f 10 09 16 08 8e 69 1f 10 59 28}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CVB_2147794240_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CVB!MTB"
        threat_id = "2147794240"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 02 06 17 6a 58 02 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 06 17 6a 58 0a}  //weight: 1, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "get_ParamXGroup" ascii //weight: 1
        $x_1_4 = "get_ParamXArray" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CVC_2147794241_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CVC!MTB"
        threat_id = "2147794241"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "BE0D4CD8V8G74444598K78" wide //weight: 10
        $x_1_2 = {00 43 32 31 32 33 31 34 35 32 31 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 32 33 34 32 35 35 36 34 37 34 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 32 33 35 34 32 36 35 34 33 36 37 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 33 32 34 33 32 31 00}  //weight: 1, accuracy: High
        $x_1_6 = "get_ParamXGroup" ascii //weight: 1
        $x_1_7 = "get_ParamXArray" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = {00 44 61 74 61 5f 31 00 4b 65 79 47 65 6e 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTC_2147794265_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTC!MTB"
        threat_id = "2147794265"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "gfhhfhfhfhfhfhfhfhfhfhfh" ascii //weight: 1
        $x_1_2 = "#fsdfsdf.dll#" ascii //weight: 1
        $x_1_3 = "#fsdfsd.dll#" ascii //weight: 1
        $x_1_4 = "#fsdfdsf.dll#" ascii //weight: 1
        $x_1_5 = "fssssssssssafffffffff" ascii //weight: 1
        $x_1_6 = "fsdfsdfdsf" ascii //weight: 1
        $x_1_7 = "SizeofResource" ascii //weight: 1
        $x_1_8 = "faffffhhhhhhhhhhhhhhhhhhhhhhfffff" ascii //weight: 1
        $x_1_9 = "#fsddddddddd#" ascii //weight: 1
        $x_1_10 = "gfdffffffg" ascii //weight: 1
        $x_1_11 = "IsDebuggerPresent" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTG_2147794266_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTG!MTB"
        threat_id = "2147794266"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$02b69cd2-ef96-4d52-b4d9-214a22288d1b" ascii //weight: 1
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "GetString" ascii //weight: 1
        $x_1_4 = "Duo Bizz Snake" ascii //weight: 1
        $x_1_5 = "Solymosi" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTJ_2147794302_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTJ!MTB"
        threat_id = "2147794302"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 02 06 17 6a 58 02 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2}  //weight: 1, accuracy: High
        $x_1_2 = "$02b69cd2-ef96-4d52-b4d9-214a22288d1b" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTH_2147794303_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTH!MTB"
        threat_id = "2147794303"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "https://ghghghfhfhfh.000webhostapp.com/RunPE.dll" ascii //weight: 2
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTI_2147794304_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTI!MTB"
        threat_id = "2147794304"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$bdf894ba-a1c2-492d-898f-fcbd3b9c842e" ascii //weight: 1
        $x_1_2 = "D1231315765" ascii //weight: 1
        $x_1_3 = "F534534535435" ascii //weight: 1
        $x_1_4 = "D2313125435" ascii //weight: 1
        $x_1_5 = "D288321238721321" ascii //weight: 1
        $x_1_6 = "D6549645123" ascii //weight: 1
        $x_1_7 = "D8656534" ascii //weight: 1
        $x_1_8 = "Generation" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTM_2147794355_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTM!MTB"
        threat_id = "2147794355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://a.uguu.se/" ascii //weight: 1
        $x_1_2 = "http://ceylantreyler.com/Cms_Data/Sites/asd/Themes/Default/" ascii //weight: 1
        $x_1_3 = "DownloadString" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "tester.rasa" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTN_2147794356_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTN!MTB"
        threat_id = "2147794356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 02 06 17 6a 58 02 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 06 17 6a 58 0a}  //weight: 1, accuracy: High
        $x_1_2 = "34724cce-3c3d-47e8-9096-cec606ad9eae" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CWA_2147794400_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CWA!MTB"
        threat_id = "2147794400"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03 08 17 58 03 8e 69 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 08 17 58 16}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CWI_2147794401_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CWI!MTB"
        threat_id = "2147794401"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 02 06 17 6a 58 02 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CWH_2147794402_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CWH!MTB"
        threat_id = "2147794402"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BE0D4CD8V8G74444598K78" wide //weight: 1
        $x_1_2 = {00 43 5f 5f 32 31 32 33 31 34 35 32 31 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 5f 5f 32 33 34 32 35 35 36 34 37 34 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 5f 5f 32 33 35 34 32 36 35 34 33 36 37 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 5f 5f 33 32 34 33 32 31 00}  //weight: 1, accuracy: High
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = {00 44 61 74 61 5f 31 00 4b 65 79 47 65 6e 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTD_2147794426_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTD!MTB"
        threat_id = "2147794426"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Imac" ascii //weight: 1
        $x_1_4 = "Iphone" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FKEC_2147794429_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FKEC!MTB"
        threat_id = "2147794429"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "vsdvsdvsdsdv.exe" ascii //weight: 1
        $x_1_2 = "sdvsdsdvds" ascii //weight: 1
        $x_1_3 = "vsdvsdvdsvsd" ascii //weight: 1
        $x_1_4 = "vsdvsdsv" ascii //weight: 1
        $x_1_5 = "ResolveSignature" ascii //weight: 1
        $x_1_6 = "get_CurrentDomain" ascii //weight: 1
        $x_1_7 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTO_2147794504_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTO!MTB"
        threat_id = "2147794504"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 08 04 6f ?? ?? ?? 0a 08 05 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 02 16 02 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "vecrypt" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTX_2147794505_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTX!MTB"
        threat_id = "2147794505"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://a.uguu.se/" ascii //weight: 1
        $x_1_2 = "https://astexproject.com/" ascii //weight: 1
        $x_1_3 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "DownloadData" ascii //weight: 1
        $x_1_6 = "DownloadString" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_9 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUC_2147794623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUC!MTB"
        threat_id = "2147794623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {49 00 6e 00 76 00 6f 00 6b 00 00 09 65 00 4d 00 65 00 6d 00 00 07 62 00 65 00 72}  //weight: 10, accuracy: High
        $x_1_2 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_3 = "D1231315765" ascii //weight: 1
        $x_1_4 = "esaBmorF" ascii //weight: 1
        $x_1_5 = "gnirtS46" ascii //weight: 1
        $x_1_6 = "FTTH_0" ascii //weight: 1
        $x_1_7 = "Str_0" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JUD_2147794624_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUD!MTB"
        threat_id = "2147794624"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "DarwinApp" ascii //weight: 1
        $x_1_7 = "ParamXArray" ascii //weight: 1
        $x_1_8 = "ParamXGroup" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUE_2147794625_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUE!MTB"
        threat_id = "2147794625"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_20_1 = {12 04 30 04 48 04 20 00 31 04 30 04 3b 04 30 04 3d 04 41 04 20 00 34 04 3e 04 20 00 3e 04 31 04}  //weight: 20, accuracy: High
        $x_20_2 = {65 00 6c 00 6c 00 00 2d 53 00 74 00 61 00 72 00 74 00 2d 00 53 00 6c 00 65 00 65 00 70 00 20 00}  //weight: 20, accuracy: High
        $x_1_3 = "https://store2.gofile.io/download/" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "GetTypes" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 6 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_FLA_2147794641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FLA!MTB"
        threat_id = "2147794641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 02 06 17 6a 58 02 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FLB_2147794642_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FLB!MTB"
        threat_id = "2147794642"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BE0D4CD8V8G74444598K78" ascii //weight: 1
        $x_1_2 = {00 67 65 74 5f 50 61 72 61 6d 58 47 72 6f 75 70 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 67 65 74 5f 50 61 72 61 6d 58 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 69 6c 65 5f 31 00}  //weight: 1, accuracy: High
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = {00 44 61 74 61 5f 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXQ_2147794657_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXQ!MTB"
        threat_id = "2147794657"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 06 03 6f ?? ?? ?? 0a 5d 17 58 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 59 0c 07 08 28 ?? ?? ?? 0a 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 06 17 58 0a 06 02 6f ?? ?? ?? 0a fe 02 16 0c 00 02 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_10_2 = {03 07 03 6f ?? ?? ?? 0a 5d 17 58 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 59 0c 06 08 28 ?? ?? ?? 0a 0d 12 03 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 07 17 58 0b 07 02 6f ?? ?? ?? 0a 0c 00 02 07 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CXP_2147794658_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXP!MTB"
        threat_id = "2147794658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 07 03 6f ?? ?? ?? 0a 5d 17 58 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 59 0c 0c 00 02 07 28 73 01 00 0a 28 74 01 00 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXP_2147794658_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXP!MTB"
        threat_id = "2147794658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {07 11 04 07 11 04 91 08 11 04 91 61 d2 9c 11 04 17 58 13 04 11 04 08 8e 69 3f}  //weight: 5, accuracy: High
        $x_1_2 = "SELECT * FROM Win32_ComputerSystem" wide //weight: 1
        $x_1_3 = "Select * from Win32_NetworkLoginProfile where Name LIKE '%" wide //weight: 1
        $x_1_4 = "select * from Win32_UserAccount" wide //weight: 1
        $x_1_5 = "chrome.exe" wide //weight: 1
        $x_1_6 = "SELECT AddressWidth FROM Win32_Processor" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXR_2147794659_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXR!MTB"
        threat_id = "2147794659"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 67 65 74 5f 50 61 72 61 6d 58 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 67 65 74 5f 50 61 72 61 6d 58 47 72 6f 75 70 00}  //weight: 1, accuracy: High
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "FromBase64" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXS_2147794660_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXS!MTB"
        threat_id = "2147794660"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXS_2147794660_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXS!MTB"
        threat_id = "2147794660"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 04 9a 13 08 09 11 08 1f 10 28 ?? ?? ?? ?? b4 6f ?? ?? ?? ?? 00 11 04 17 d6 13 04 00 11 04 08 8e 69 fe 04 13 09 11 09 2d}  //weight: 5, accuracy: Low
        $x_1_2 = "66_Nude_Photos___22" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXK_2147794661_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXK!MTB"
        threat_id = "2147794661"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 9a 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7 0d 06 09 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 08 17 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "esaBmorF" wide //weight: 1
        $x_1_5 = "gnirtS46" wide //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JIG_2147794683_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JIG!MTB"
        threat_id = "2147794683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "d2484be4-0728-4224-a8fd-612c4fd9aca1" ascii //weight: 1
        $x_1_2 = {80 8d 09 01 00 04 44 65 76 5f}  //weight: 1, accuracy: High
        $x_1_3 = "GetModuleHandleA" ascii //weight: 1
        $x_1_4 = "OpenProcess" ascii //weight: 1
        $x_1_5 = "WriteProcessMemory" ascii //weight: 1
        $x_1_6 = "VirtualAllocEx" ascii //weight: 1
        $x_1_7 = "CreateRemoteThread" ascii //weight: 1
        $x_1_8 = "WaitForSingleObject" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_13 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_14 = "DebuggerStepThroughAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JMD_2147794684_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JMD!MTB"
        threat_id = "2147794684"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$13419c17-a7bb-4c10-87f7-85fef80cdbf1" ascii //weight: 1
        $x_1_2 = "0.30319\\RegAsm.exe" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "877689582395719724/8776900" ascii //weight: 1
        $x_1_6 = "winomoera.operavnb" ascii //weight: 1
        $x_1_7 = "KafeOtomasyon.cs" ascii //weight: 1
        $x_1_8 = "Debug\\KafeOtomasyon" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JRM_2147794685_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JRM!MTB"
        threat_id = "2147794685"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$8efd0882-4f66-41a5-aca2-56fdfbe850e2" ascii //weight: 1
        $x_1_2 = "Luis Perez" ascii //weight: 1
        $x_1_3 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JTZ_2147794686_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JTZ!MTB"
        threat_id = "2147794686"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 0b 1f 56 8d ?? ?? ?? 01 25 d0 ?? ?? ?? 04 28 ?? ?? ?? 0a 0c 28 ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 0d 09 28 ?? ?? ?? 06 13 04 1a 8d ?? ?? ?? 01 13 07 11 07 16 72 ?? ?? ?? 70 a2 11 07 17 7e ?? ?? ?? 0a a2 11 07 18 07 a2 11 07 19 17 8c ?? ?? ?? 01 a2 11 07 13 05 14 13 06 11 04 28}  //weight: 1, accuracy: Low
        $x_1_2 = "Download" ascii //weight: 1
        $x_1_3 = "InstallUtil" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUH_2147794690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUH!MTB"
        threat_id = "2147794690"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 10, accuracy: High
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUI_2147794715_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUI!MTB"
        threat_id = "2147794715"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3d2b6db1-5b3f-4794-9679-a0d84099f96d" ascii //weight: 1
        $x_1_2 = "C__212314521" ascii //weight: 1
        $x_1_3 = "C__324321" ascii //weight: 1
        $x_1_4 = "ParamXArray" ascii //weight: 1
        $x_1_5 = "ParamXGroup" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BNI_2147794725_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BNI!MTB"
        threat_id = "2147794725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 07 03 6f ?? ?? ?? 0a 5d 17 58 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 59 0c 0c 00 02 07 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CYA_2147794726_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CYA!MTB"
        threat_id = "2147794726"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 02 8e 69 17 da 91 1f 70 61 0c}  //weight: 1, accuracy: High
        $x_1_2 = {09 11 05 02 11 05 91 08 61 07 06 91 61 b4 9c}  //weight: 1, accuracy: High
        $x_1_3 = {25 47 02 08 1f 10 5d 91 61 d2 52}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUB_2147794771_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUB!MTB"
        threat_id = "2147794771"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 03 07 03 6f ?? ?? ?? 0a 5d 17 58 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 59 0c 06 08 28 ?? ?? ?? 0a 0d 12 03 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 07 17 58 0b 07 02 6f ?? ?? ?? 0a fe 02 16 fe 01}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JVA_2147794822_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JVA!MTB"
        threat_id = "2147794822"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 00 73 00 3a 00 2f 00 2f 00 [0-48] 2e 00 30 00 30 00 30 00 77 00 65 00 62 00 68 00 6f 00 73 00 74 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 44 00 6f 00 63 00 75 00 6d 00 65 00 6e 00 74 00 2e 00 65 00 78 00 65 00}  //weight: 1, accuracy: Low
        $x_1_2 = {68 74 74 70 73 3a 2f 2f [0-48] 2e 30 30 30 77 65 62 68 6f 73 74 61 70 70 2e 63 6f 6d 2f 44 6f 63 75 6d 65 6e 74 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_3 = {68 00 74 00 74 00 70 00 73 00 3a 00 2f 00 2f 00 [0-48] 2e 00 30 00 30 00 30 00 77 00 65 00 62 00 68 00 6f 00 73 00 74 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 52 00 75 00 6e 00 50 00 45 00 2e 00 64 00 6c 00 6c 00}  //weight: 1, accuracy: Low
        $x_1_4 = {68 74 74 70 73 3a 2f 2f [0-48] 2e 30 30 30 77 65 62 68 6f 73 74 61 70 70 2e 63 6f 6d 2f 52 75 6e 50 45 2e 64 6c 6c}  //weight: 1, accuracy: Low
        $x_1_5 = "DownloadData" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "RunPE.RunPE" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule Trojan_MSIL_AgentTesla_JVB_2147794823_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JVB!MTB"
        threat_id = "2147794823"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$c5df25c7-ffab-4296-bf12-bd54bc44a67f" ascii //weight: 1
        $x_1_2 = "TNT Original Invoice" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUL_2147794857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUL!MTB"
        threat_id = "2147794857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 1d 5c 00 24 00 28 00 5b 00 5e 00 5c 00 73 00 5c 00 24 00 5d 00 2b 00 29 00 5c 00 24 00 00 c0 01 10 01 cc 00 ce 00 e9 00 c9 00 b9 00 b9 00 c5 00 b9 00 b9 00 b9 00 b9 00 bd 00 b9 00 b9 00 b9}  //weight: 1, accuracy: High
        $x_1_2 = {de 00 ed 00 df 00 ac 00 b9 00 ec 00 b9 00 e6 00 c6 00 c1 00 da 00 df 00 ba 00 cc 00 c5 00 a8 00 e0 00 ce 00 bf 00 e0 00 e8 00 db}  //weight: 1, accuracy: High
        $x_1_3 = "Snippets" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUM_2147794858_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUM!MTB"
        threat_id = "2147794858"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 d0 ?? ?? ?? 1b 28 ?? ?? ?? 0a a2 28 ?? ?? ?? 0a 14 17 8d ?? ?? ?? 01 25 16 11 00 28}  //weight: 1, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "GetString" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "powershell" ascii //weight: 1
        $x_1_8 = "Test-NetConnection" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZD_2147794921_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZD!MTB"
        threat_id = "2147794921"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 9a 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = "gnirtS46esaBmorF" wide //weight: 1
        $x_1_3 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZE_2147794922_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZE!MTB"
        threat_id = "2147794922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d ?? ?? ?? ?? ?? 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 ?? ?? ?? ?? ?? 03 08 17 58 03 8e 69 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZE_2147794922_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZE!MTB"
        threat_id = "2147794922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "System.Convert" wide //weight: 1
        $x_1_2 = "gnirtS46esaBmorF" wide //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "XXXXXXXXXXXXX" wide //weight: 1
        $x_1_6 = "Invoke" wide //weight: 1
        $x_1_7 = {47 00 65 00 00 09 74 00 54 00 79 00 70 00 00 03 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JVL_2147794964_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JVL!MTB"
        threat_id = "2147794964"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 07 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "$229fb860-eb99-4f48-afb2-f0fa410f3dfe" ascii //weight: 1
        $x_1_3 = "HJD.Pexeso.FormGUI" ascii //weight: 1
        $x_1_4 = {68 00 78 00 2e 00 6a 00 39}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CYQ_2147795082_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CYQ!MTB"
        threat_id = "2147795082"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 07 03 6f ?? ?? ?? 0a 5d 17 58 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 59 0c 0c 00 02 07 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CYR_2147795083_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CYR!MTB"
        threat_id = "2147795083"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 07 03 28 ?? ?? ?? 06 5d 17 58 28 ?? ?? ?? 06 28 ?? ?? ?? 06 59 0c 0c 00 02 07 28 ?? ?? ?? 06 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZA_2147795084_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZA!MTB"
        threat_id = "2147795084"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 07 03 6f ?? ?? ?? ?? 5d 17 58 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 59 0c 0c 00 02 07 28 ?? ?? ?? ?? 28}  //weight: 10, accuracy: Low
        $x_10_2 = {03 07 03 28 ?? ?? ?? ?? 5d 17 58 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 59 0c 0c 00 02 07 28 ?? ?? ?? ?? 28}  //weight: 10, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "ToCharArray" ascii //weight: 1
        $x_1_7 = {00 47 65 74 43 68 61 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 68 72 57 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JUP_2147795097_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUP!MTB"
        threat_id = "2147795097"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {6e 00 61 00 6d 00 65 00 27 00 3a 00 20 00 27 00 41 00 64 00 6d 00 69 00 6e 00 27 00 20 00 7d 00 7b 00 20 00 27 00 6e 00 61 00 6d 00 65 00 27 00 3a 00 20 00 27 00 50 00 75 00 62 00 6c 00 69 00 73 00 68 00 65 00 72}  //weight: 1, accuracy: High
        $x_1_2 = "Start-Sleep -s 5" wide //weight: 1
        $x_1_3 = "WaitForExit" ascii //weight: 1
        $x_1_4 = "Test" ascii //weight: 1
        $x_1_5 = "powershell" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "GetString" ascii //weight: 1
        $x_1_8 = "ShowWindow" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
        $x_1_10 = "GetCurrentProcess" ascii //weight: 1
        $x_1_11 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUR_2147795098_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUR!MTB"
        threat_id = "2147795098"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "1468b0c5-9dac-464e-a3d0-3c4057eb77d4" ascii //weight: 1
        $x_1_2 = {00 58 58 44 45 00}  //weight: 1, accuracy: High
        $x_1_3 = "WordSearchGenerator" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JVH_2147795100_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JVH!MTB"
        threat_id = "2147795100"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "DataDirectory|\\bin\\Debug\\PayrollManagerDB.mdf" ascii //weight: 10
        $x_2_2 = "$c0067dee-27ca-46ac-afd3-607acf8e9516" ascii //weight: 2
        $x_2_3 = "$627527a8-2ae8-49c5-9be1-560c25aa9532" ascii //weight: 2
        $x_2_4 = "$e3d9633f-16ea-43de-a00c-8f01dd29d049" ascii //weight: 2
        $x_1_5 = "Sj31Pni0KFk69Ars8Y7Xq" ascii //weight: 1
        $x_1_6 = "Payroll Manager" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JVI_2147795101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JVI!MTB"
        threat_id = "2147795101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 06 11 04 28 ?? ?? ?? 0a 07 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 05 11 05 2d c8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JVM_2147795102_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JVM!MTB"
        threat_id = "2147795102"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$B121C034-A477-4EFF-8F92-D9A980F97DB1" ascii //weight: 1
        $x_1_2 = "PUBG CORPORATION" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "GetChar" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = {00 43 68 72 57 00}  //weight: 1, accuracy: High
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZH_2147795120_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZH!MTB"
        threat_id = "2147795120"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "System.Convert" wide //weight: 1
        $x_1_2 = "gnirtS46esaBmorF" wide //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "XXXXXXXXXXXXX" wide //weight: 1
        $x_1_6 = "Invoke" wide //weight: 1
        $x_1_7 = {00 50 4f 31 32 33 31 32 33 31 33 31 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 50 4f 31 36 36 35 34 36 35 34 36 34 36 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZR_2147795121_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZR!MTB"
        threat_id = "2147795121"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "System.Convert" wide //weight: 1
        $x_1_2 = "gnirtS46esaBmorF" wide //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "XXXXXXXXXXXXX" wide //weight: 1
        $x_1_7 = "G-e-t-M-e-t-h-o-d" wide //weight: 1
        $x_1_8 = "I--n--v--o--k--e" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAC_2147795243_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAC!MTB"
        threat_id = "2147795243"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 08 93 06 08 06 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 6f ?? ?? ?? 0a 26 08 17 58 0c 08 02 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "ToCharArray" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAA_2147795244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAA!MTB"
        threat_id = "2147795244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {20 b4 09 00 00 95 2e 03 16 2b 01 17 17 59 7e 26 00 00 04 20 ac 03 00 00 95 5f 7e 26 00 00 04 11 28 13 28 20 43 0f 00 00 95 61 58 80 42 00 00 04}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAD_2147795245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAD!MTB"
        threat_id = "2147795245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {13 04 16 13 07 2b 18 00 11 04 11 07 09 11 07 9a 1f 10 28 ?? 00 00 0a 9c 00 11 07 17 58 13 07 11 07 09 8e 69 fe 04 13 08 11 08 2d db}  //weight: 3, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "ToByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAD_2147795245_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAD!MTB"
        threat_id = "2147795245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 59 58 5a 31 32 33 34 35 36 37 38 39 30 00 73 00 64 00 59 58 5a 31 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 59 58 5a 30 00 59 58 5a 32 00 74 00 59 58 5a 33 00}  //weight: 1, accuracy: High
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = {00 6d 65 74 68 6f 64 00 70 61 72 61 6d 65 74 65 72 73 00 59 58 5a 35 00}  //weight: 1, accuracy: High
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAE_2147795246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAE!MTB"
        threat_id = "2147795246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0a 0b 03 8e 69 17 59 17 58 0c 03 04 08 5d 91 07 04 1f 16 5d 91 61 28 ?? 00 00 0a 03 04 17 58 08 5d 91 28 ?? 00 00 0a 59 06 58 06 5d d2 0d 2b 00 09 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAE_2147795246_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAE!MTB"
        threat_id = "2147795246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 06 11 04 28 ?? ?? ?? 06 07 da 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0a 00 09 17 d6 0d 09 08 28 ?? ?? ?? 06 fe 04 13 05 11 05 2d c8}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JZP_2147795261_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JZP!MTB"
        threat_id = "2147795261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 06 11 04 28 ?? ?? ?? 0a 07 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 05 11 05 2d ca}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "SuspendLayout" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXB_2147795337_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXB!MTB"
        threat_id = "2147795337"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 06 08 28 ?? ?? ?? 0a 04 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 07 17 d6 0b 07 03 6f ?? ?? ?? 0a fe 04 0d 09 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXC_2147795338_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXC!MTB"
        threat_id = "2147795338"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "G-e-t-M-e-t-h-o-d" wide //weight: 1
        $x_1_2 = "I--n--v--o--k--e" wide //weight: 1
        $x_1_3 = "XXXXXXXXXXXXX" wide //weight: 1
        $x_1_4 = "gnirtS46esaBmorF" wide //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAS_2147795377_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAS!MTB"
        threat_id = "2147795377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2b 18 2b 1d 1e 2c f9 2b 1b 2b 20 2b 21 2b 26 2b 2b 2b 30 2b 35 1d 2c ec de 39 28 ?? 00 00 06 2b e1 0a 2b e0 28 ?? 00 00 0a 2b de 06 2b dd 6f ?? 00 00 0a 2b d8 28 ?? 00 00 0a 2b d3 28 ?? 00 00 2b 2b ce 28 ?? 00 00 2b 2b c9 0b 2b c8}  //weight: 2, accuracy: Low
        $x_1_2 = "Reverse" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAS_2147795377_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAS!MTB"
        threat_id = "2147795377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TdDPKD|ET]D\\IDjDThDzJDlETeDXJD}EzfDHHDEDDFDjGDDD" ascii //weight: 1
        $x_1_2 = "TdDTKDvETgD3HDDDDDDXJDwET\\D7HD3Ez\\DXKDnEzeDLKDTE" ascii //weight: 1
        $x_1_3 = "DDDD7JDyETdDPKD|ET]D\\IDjD" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAP_2147795378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAP!MTB"
        threat_id = "2147795378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAP_2147795378_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAP!MTB"
        threat_id = "2147795378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {1e 2d 35 2b 1c 06 08 2b 09 06 18 6f ?? 00 00 0a 2b 07 6f ?? 00 00 0a 2b f0 28 ?? 00 00 06 0d 2b 03 26 2b e1 06 6f ?? 00 00 0a 09 16 09 8e 69 6f ?? 00 00 0a 13 04 de 11 0c 2b ca}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXE_2147795392_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXE!MTB"
        threat_id = "2147795392"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "82"
        strings_accuracy = "High"
    strings:
        $x_50_1 = "@DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD" ascii //weight: 50
        $x_10_2 = "DDDDDDzDjODHGDxDTPD7FD}DDDD7JDyETdDPKD|ET]D\\IDjD" ascii //weight: 10
        $x_10_3 = "DDDj{{kq;.p2r6WNXvwRn..y.PhvDLTL|7UEhoR5e3<rjxmp" ascii //weight: 10
        $x_10_4 = "TD22222GDDDHDDEIjDDLzF2222222222SDDDDDDDDDDDDDDD" ascii //weight: 10
        $x_10_5 = "DDDDDDDHDDEDzDDDDjHXzdHrOE|JTpIvfExZTpITEE]VjiHn" ascii //weight: 10
        $x_10_6 = "GDIiD:D\\LDDDDDOEKD9DD9KnFDJFDDDDjULGjRIvzEmDznDD" ascii //weight: 10
        $x_10_7 = "DDDPGHDvED6DDZ\\\\LDDDDD|DPDeLjXHfJDWFDDDDjP7FzJEL" ascii //weight: 10
        $x_1_8 = "FromBase64" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_50_*) and 3 of ($x_10_*) and 2 of ($x_1_*))) or
            ((1 of ($x_50_*) and 4 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_JXI_2147795430_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXI!MTB"
        threat_id = "2147795430"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Ixnxvxoxkxe" ascii //weight: 1
        $x_1_2 = "gnirtS46esaBmorF" ascii //weight: 1
        $x_1_3 = "trevnoC.metsyS" ascii //weight: 1
        $x_1_4 = "GetObject" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXK_2147795431_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXK!MTB"
        threat_id = "2147795431"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 06 08 28 ?? ?? ?? 0a 04 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 07 17 d6 0b 07 03 6f ?? ?? ?? 0a fe 04 0d 09 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CZJ_2147795450_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CZJ!MTB"
        threat_id = "2147795450"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 28 ?? ?? ?? 0a 07 da 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "StrReverse" ascii //weight: 1
        $x_1_3 = "hx.j9" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JYC_2147795518_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JYC!MTB"
        threat_id = "2147795518"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "iSntiyDtvOwYJ" ascii //weight: 1
        $x_1_2 = "ArSee" ascii //weight: 1
        $x_1_3 = "A4ASFAGF" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
        $x_1_5 = "ComputeHash" ascii //weight: 1
        $x_1_6 = "frmBaseSF" ascii //weight: 1
        $x_1_7 = "GetString" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
        $x_1_10 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JYA_2147795519_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JYA!MTB"
        threat_id = "2147795519"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "c64b2fbe-4e84-4f2f-9463-c3e743258ee1" ascii //weight: 1
        $x_1_2 = "DataAccess" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JYA_2147795519_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JYA!MTB"
        threat_id = "2147795519"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {6b 6f 69 00 67 73 64 66 2e 65 78}  //weight: 1, accuracy: High
        $x_1_2 = "LzmaDecoder" ascii //weight: 1
        $x_1_3 = "m_IsMatchDecoders" ascii //weight: 1
        $x_1_4 = {43 6f 70 79 42 6c 6f 63 6b 00 50 75 74 42 79 74 65 00 47 65 74 42 79 74 65}  //weight: 1, accuracy: High
        $x_1_5 = "VirtualProtect" ascii //weight: 1
        $x_1_6 = "Decrypt" ascii //weight: 1
        $x_1_7 = "Decompress" ascii //weight: 1
        $x_1_8 = "ReverseDecode" ascii //weight: 1
        $x_1_9 = "ToBase64String" ascii //weight: 1
        $x_1_10 = "BitDecoder" ascii //weight: 1
        $x_1_11 = "BitTreeDecoder" ascii //weight: 1
        $x_1_12 = "DecodeDirectBits" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCJ_2147795722_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCJ!MTB"
        threat_id = "2147795722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCJ_2147795722_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCJ!MTB"
        threat_id = "2147795722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$449BB57E-F37D-4207-99C4-5CCDAED0B95E" ascii //weight: 1
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 45 6e 74 72 79 41 73 73 65 6d 62 6c 79 00}  //weight: 1, accuracy: High
        $x_1_7 = {08 11 04 02 11 04 91 07 61 06 09 91 61}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCN_2147795723_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCN!MTB"
        threat_id = "2147795723"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 07 93 0c 08 1f 61 32 0a 08 1f 7a fe 02 16 fe 01 2b 01 16 0d 09 2c 19 08 1f 6d fe 02 13 04 11 04 2c 07 08 1f 0d 59 0c 2b 05 08 1f 0d 58 0c 2b 2d 08}  //weight: 1, accuracy: High
        $x_1_2 = {1f 41 32 0a 08 1f 5a fe 02 16 fe 01 2b 01 16 13 05 11 05 2c 17 08 1f 4d fe 02 13 06 11 06 2c 07 08 1f 0d 59 0c 2b 05 08 1f 0d 58 0c 06 07 08 d1 9d 07 17 58 0b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNB_2147795790_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNB!MTB"
        threat_id = "2147795790"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_3 = "YXZ1234567890" ascii //weight: 1
        $x_1_4 = {00 59 58 5a 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 59 58 5a 33 00}  //weight: 1, accuracy: High
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LND_2147795791_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LND!MTB"
        threat_id = "2147795791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 6c 23 ?? ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 13 05 07 11 05 6f ?? ?? ?? 0a 26 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b7}  //weight: 1, accuracy: Low
        $x_1_2 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LND_2147795791_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LND!MTB"
        threat_id = "2147795791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 09 11 04 6f ?? ?? ?? 0a 13 07 06 09 11 04 6f ?? ?? ?? 0a 13 08 11 08 28 ?? ?? ?? 0a 13 09 08 07 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 11 09 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 9c 00 11 04 17 58 13 04 11 04 06 6f ?? ?? ?? 0a fe 04 13 0a 11 0a 2d 96}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNG_2147795792_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNG!MTB"
        threat_id = "2147795792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "aHR0cDovLzgyLjE0Ni40OS4xOTcv" ascii //weight: 1
        $x_1_2 = "DownloadFile" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetFolderPath" ascii //weight: 1
        $x_1_6 = "GetString" ascii //weight: 1
        $x_1_7 = "GetPathRoot" ascii //weight: 1
        $x_1_8 = "WebClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCP_2147795810_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCP!MTB"
        threat_id = "2147795810"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a de 0a 08 2c 06 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d de 14 07 2c 06 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
        $x_1_4 = "ClassLibrary" wide //weight: 1
        $x_1_5 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCR_2147795811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCR!MTB"
        threat_id = "2147795811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 1f 6d fe 02 13 04 11 04 2c 03 16 2b 03 17 2b 00 2d 09 00 08 1f 0d 59 0c 00 2b 07 00 08 1f 0d 58 0c 00 00 2b 43 08 1f 41 32 0a 08 1f 5a fe 02 16 fe 01 2b 01}  //weight: 1, accuracy: High
        $x_1_2 = {16 13 05 11 05 2c 03 16 2b 03 17 2b 00 2d 25 00 08 1f 4d fe 02 13 06 11 06 2c 03 16 2b 03 17 2b 00 2d 09 00 08 1f 0d 59 0c 00 2b 07 00 08 1f 0d 58 0c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCZ_2147795840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCZ!MTB"
        threat_id = "2147795840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 07 09 11 04 11 05 6f ?? ?? ?? 0a 13 08 11 08 28 ?? ?? ?? 0a 13 09 08 07 11 09 28 ?? ?? ?? 0a 9c 00 11 05 17 58 13 05 11 05 09 6f ?? ?? ?? 0a fe 04 13 0a 11 0a 2d bd}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JUQ_2147795860_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JUQ!MTB"
        threat_id = "2147795860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 11 05 6f ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 16 09 06 1a 28 ?? ?? ?? 0a 06 1a 58 0a 11 05 17 58 13 05}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXA_2147795861_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXA!MTB"
        threat_id = "2147795861"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "session.ses" ascii //weight: 1
        $x_1_2 = "GetFolderPath" ascii //weight: 1
        $x_1_3 = "5a598256-48fa-490f-a5b3-7abc22332619" ascii //weight: 1
        $x_1_4 = "muyou Lib" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerDisplayAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXD_2147795862_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXD!MTB"
        threat_id = "2147795862"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 9a 28 ?? ?? ?? 0a 23 ?? ?? ?? ?? ?? ?? ?? ?? 59 28 ?? ?? ?? 0a b7 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 17 d6 13 04 11 04 09 31 c7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JXG_2147795863_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JXG!MTB"
        threat_id = "2147795863"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 02 03 6f ?? ?? ?? 0a 38 ?? ?? ?? 00 38 ?? ?? ?? 00 11 00 02 03 6f ?? ?? ?? 0a 13 01 38}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 13 01 38 ?? ?? ?? 00 00 11 00 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 13 02 38 ?? ?? ?? 00 11 01 6f ?? ?? ?? 0a 13 03 38 ?? ?? ?? 00 00 11 02 11 01 6f ?? ?? ?? 0a 38 ?? ?? ?? 00 ?? ?? ?? ?? ?? 11 02}  //weight: 1, accuracy: Low
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "GetString" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JYB_2147795865_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JYB!MTB"
        threat_id = "2147795865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0c 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 03 28 ?? ?? ?? 06 13 04 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 08 13 05 2b 00 11 05 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JYH_2147795866_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JYH!MTB"
        threat_id = "2147795866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 07 08 6f ?? ?? ?? 0a 07 18 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0d de 15}  //weight: 1, accuracy: Low
        $x_1_2 = "Sy!stem.Refl!ection.As!sembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HN_2147795868_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HN!MTB"
        threat_id = "2147795868"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Encrypt" ascii //weight: 1
        $x_1_2 = "AntiSandboxie" ascii //weight: 1
        $x_1_3 = "AntiWireshark" ascii //weight: 1
        $x_1_4 = "AntiProcessMonitor" ascii //weight: 1
        $x_1_5 = "AntiEmulator" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
        $x_1_7 = "dropLocation" ascii //weight: 1
        $x_1_8 = "Hidden" ascii //weight: 1
        $x_1_9 = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders" ascii //weight: 1
        $x_1_10 = "commandLine" ascii //weight: 1
        $x_1_11 = "runas" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNO_2147795892_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNO!MTB"
        threat_id = "2147795892"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 6e 11 08 6a 59 d4 11 04 1e 11 08 59 1e 5a 1f 3f 5f 64 20 ?? ?? ?? 00 6a 5f d2 9c 11 08 17 59 13 08}  //weight: 1, accuracy: Low
        $x_1_2 = "$763e4347-491d-47f4-80a7-43e17dce6cee" ascii //weight: 1
        $x_1_3 = "Self Cam" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNQ_2147795893_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNQ!MTB"
        threat_id = "2147795893"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TVqQAAMAAAAEAAAA//" ascii //weight: 1
        $x_1_2 = "//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAA" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetString" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "Invoke" ascii //weight: 1
        $x_1_7 = "GetTypes" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DBK_2147795973_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DBK!MTB"
        threat_id = "2147795973"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sy!stem.Refl!ection.As!sembly" wide //weight: 1
        $x_1_2 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 72 61 6e 73 66 6f 72 6d 46 69 6e 61 6c 42 6c 6f 63 6b 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCI_2147795974_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCI!MTB"
        threat_id = "2147795974"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 66 72 6d 42 61 73 65 53 46 00 70 6f 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 41 72 53 65 65 00 69 6e 74 65 78 74 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 72 61 6e 73 66 6f 72 6d 46 69 6e 61 6c 42 6c 6f 63 6b 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 58 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 78 78 78 78 78 78 78 78 78 78 78 78 78 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDB_2147795999_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDB!MTB"
        threat_id = "2147795999"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 2b 08 06 07 6f ?? ?? ?? 0a 26 08 06 07 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 04 09 11 08 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 08 6f ?? ?? ?? 0a fe 04 13 09 11 09 2d c6 09 17 58 0d 06 17 58 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LAN_2147796138_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAN!MTB"
        threat_id = "2147796138"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 09 09 11 04 11 05 6f ?? ?? ?? 0a 13 0a 11 0a 28 ?? ?? ?? 0a 13 0b 08 07 11 0b 28 ?? ?? ?? 0a 9c 00 11 05 17 58 13 05 11 05 09 6f ?? ?? ?? 0a fe 04 13 0c 11 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LAP_2147796139_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAP!MTB"
        threat_id = "2147796139"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "G-e-t-M-e-t-h-o-d" ascii //weight: 1
        $x_1_2 = "StrReverse" ascii //weight: 1
        $x_1_3 = "YXZ1234567890" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = {00 59 58 5a 32 00}  //weight: 1, accuracy: High
        $x_1_7 = "Reverse" ascii //weight: 1
        $x_1_8 = {00 59 58 5a 33 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 59 58 5a 35 00}  //weight: 1, accuracy: High
        $x_1_10 = "Split" ascii //weight: 1
        $x_1_11 = "SuspendLayout" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LAM_2147796140_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAM!MTB"
        threat_id = "2147796140"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 11 04 28 ?? ?? ?? 0a 23 ?? ?? ?? ?? ?? ?? ?? 40 59 28 ?? ?? ?? 0a b7 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 8e 69 fe 04 13 06 11 06 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LAQ_2147796141_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAQ!MTB"
        threat_id = "2147796141"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 06 07 6f ?? ?? ?? 0a 26 08 06 07 6f ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 13 0a 11 04 09 11 0a 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 08 6f ?? ?? ?? 0a fe 04 13 0b 11 0b 2d}  //weight: 4, accuracy: Low
        $x_4_2 = {08 09 11 04 6f ?? ?? ?? 0a 13 08 08 09 11 04 6f ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 13 0a 07 06 11 0a 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 08 6f ?? ?? ?? 0a fe 04 13 0b 11 0b 2d bf}  //weight: 4, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*) and 1 of ($x_1_*))) or
            ((2 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LAR_2147796142_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAR!MTB"
        threat_id = "2147796142"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 2b 08 06 07 6f ?? ?? ?? 0a 26 08 06 07 6f ?? ?? ?? 0a 13 08 11 08 28 ?? ?? ?? 0a 13 09 11 04 09 11 09 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 08 6f ?? ?? ?? 0a fe 04 13 0a 11 0a 2d c6}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCO_2147796143_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCO!MTB"
        threat_id = "2147796143"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 04 00 00 8d ?? ?? ?? 01 0d 16 13 04 2b 11 08 09 16 11 05 6f ?? ?? ?? 0a 11 04 11 05 58 13 04 07 09 16 20 00 04 00 00 6f ?? ?? ?? 0a 25 13 05 16 30 dc}  //weight: 1, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 62 61 73 65 36 34 45 6e 63 6f 64 65 64 44 61 74 61 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 67 65 74 5f 4b 65 79 00 73 74 72 69 6e 67 4b 65 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DCQ_2147796144_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DCQ!MTB"
        threat_id = "2147796144"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 66 72 6d 42 61 73 65 53 46 00 70 6f 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 41 72 53 65 65 00 69 6e 74 65 78 74 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 72 61 6e 73 66 6f 72 6d 46 69 6e 61 6c 42 6c 6f 63 6b 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNA_2147796164_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNA!MTB"
        threat_id = "2147796164"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 2b 31 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 17 13 08 00 08 07 02 11 07 28 ?? ?? ?? 06 d2 9c 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d c4}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNA_2147796164_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNA!MTB"
        threat_id = "2147796164"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 07 08 6f ?? ?? ?? 0a 07 18 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0d de 15}  //weight: 1, accuracy: Low
        $x_1_2 = {00 45 78 61 6d 70 6c 65 00 67 65 74 5f 4e 61 6d 65 00}  //weight: 1, accuracy: High
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "ToByteArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNC_2147796165_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNC!MTB"
        threat_id = "2147796165"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ae0c9791-be36-408f-99db-44585396a0b1" ascii //weight: 1
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "Trinity" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNC_2147796165_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNC!MTB"
        threat_id = "2147796165"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$6a4ea2ae-68ea-4369-bba1-b34b937deb76" ascii //weight: 20
        $x_20_2 = "$5612e0a2-bf5b-48ea-aaa8-47ed7bd92413" ascii //weight: 20
        $x_1_3 = "RC2CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "GetString" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 7 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LNE_2147796166_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNE!MTB"
        threat_id = "2147796166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://store2.gofile.io/download/" ascii //weight: 1
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "xample" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_1_7 = "GetBytes" ascii //weight: 1
        $x_1_8 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_9 = "GetMethods" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDZ_2147796211_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDZ!MTB"
        threat_id = "2147796211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 11 04 28 ?? ?? ?? 0a 23 00 00 00 00 00 80 73 40 59 28 ?? ?? ?? 0a b7 13 05 07 11 05 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = "IRnRvRoRkRe" wide //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDY_2147796212_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDY!MTB"
        threat_id = "2147796212"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IRnRvRoRkRe" wide //weight: 1
        $x_1_2 = "ToCharArray" ascii //weight: 1
        $x_1_3 = "G-e-t-M-e-t-h-o-d" wide //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = {00 54 6f 44 6f 75 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 4f 39 32 31 33 35 37 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 49 4f 39 32 31 33 36 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 49 4f 39 32 31 33 33 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNP_2147796245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNP!MTB"
        threat_id = "2147796245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SmartAssembly.SmartExceptionsCore.Resources.current.png" ascii //weight: 1
        $x_1_2 = "Aweiiwi.exe" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "GetMethods" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNS_2147796246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNS!MTB"
        threat_id = "2147796246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {04 0f 01 28 ?? ?? ?? 0a 07 6a 58 73 ?? ?? ?? 0a 28 ?? ?? ?? 0a 06 61 20 ?? ?? ?? 00 5f 95 06 1e 64 61 0a 07 17 58 0b 07 6a 04 6e}  //weight: 10, accuracy: Low
        $x_1_2 = "$ba2e6a09-fb53-4ee9-981e-335b7a21bc39" ascii //weight: 1
        $x_1_3 = "$6b31a7c3-3baa-47ac-abe1-902b27e0f9ac" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LBC_2147796270_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LBC!MTB"
        threat_id = "2147796270"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 33 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 08 09 11 04 11 05 6f ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 13 0a 08 07 11 0a 28 ?? ?? ?? 0a 9c 00 11 05 17 58 13 05 11 05 09 6f ?? ?? ?? 0a fe 04 13 0b 11 0b 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LBE_2147796277_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LBE!MTB"
        threat_id = "2147796277"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 11 04 28 ?? ?? ?? 0a 23 ?? ?? ?? ?? ?? ?? ?? 40 59 28 ?? ?? ?? 0a b7 13 05 07 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 8e 69 fe 04 13 06 11 06 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LBG_2147796278_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LBG!MTB"
        threat_id = "2147796278"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "G-e-t-M-e-t-h-o-d" ascii //weight: 1
        $x_1_2 = "IRnRvRoRkRe" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "IO921357" ascii //weight: 1
        $x_1_7 = "System.Convert" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
        $x_1_9 = "FromBase64" ascii //weight: 1
        $x_1_10 = "GetObjectValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMK_2147796508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMK!MTB"
        threat_id = "2147796508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 0a 03 0b 06 8e 69 0c 16 0d 2b 14 07 09 07 09 91 06 09 08 5d 91 28 ?? ?? ?? 06 9c 09 17 58 0d 09 07 8e 69 32 e6}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMK_2147796508_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMK!MTB"
        threat_id = "2147796508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 04 11 07 07 11 07 91 28 46 00 00 0a 11 07 17 58 13 07 11 07 07 8e 69 32 e6}  //weight: 2, accuracy: High
        $x_2_2 = "KukriBrainsCat" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMK_2147796508_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMK!MTB"
        threat_id = "2147796508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bin\\Debug\\SLN\\HotelManagementSystem\\obj\\Debug\\HotelManagementSystem.pdb" ascii //weight: 1
        $x_1_2 = "HotelManagementSystem.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDK_2147796519_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDK!MTB"
        threat_id = "2147796519"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a de 0a 08 2c 06 08 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 0d de 14 07 2c 06 07 6f ?? ?? ?? 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "CompressionMode" ascii //weight: 1
        $x_1_4 = "System.Reflection.Assembly" wide //weight: 1
        $x_1_5 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 53 6c 65 65 70 00 47 7a 69 70 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDE_2147796520_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDE!MTB"
        threat_id = "2147796520"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3fb6bb76-0f06-412f-8fdf-d73564d5713d" ascii //weight: 1
        $x_1_2 = "WinMixer.Properties.Resources" ascii //weight: 1
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDN_2147796521_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDN!MTB"
        threat_id = "2147796521"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$b287d027-3124-4673-b67e-936c97f04e72" ascii //weight: 10
        $x_10_2 = "$3a4308ff-a6f5-4328-baf5-fb678812a10c" ascii //weight: 10
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00 43 6f 6e 76 65 72 74 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DED_2147796532_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DED!MTB"
        threat_id = "2147796532"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 06 8e 69 33 02 16 0c 07 09 02 09 91 06 07 09 91 08 61 91 59 d2 9c 08 17 58 0c 09 17 58 0d 09 02 8e 69}  //weight: 1, accuracy: High
        $x_1_2 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_3 = "GetManifestResource" ascii //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DEC_2147796533_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DEC!MTB"
        threat_id = "2147796533"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 07 08 09 11 04 6f ?? ?? ?? 0a 13 08 11 08 28 ?? ?? ?? 0a 13 09 07 06 11 09 d2 9c 00 11 04 17 58 13 04 11 04 08 6f ?? ?? ?? 0a fe 04 13 0a 11 0a 2d c3}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HO_2147796545_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HO!MTB"
        threat_id = "2147796545"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$5ca4194e-f51b-4f07-ade8-351e5a400aab" ascii //weight: 20
        $x_20_2 = "$cd180ef7-cfed-410c-a29c-c51c93668416" ascii //weight: 20
        $x_20_3 = "$591188b8-5f22-4c3b-870e-893f32a69b96" ascii //weight: 20
        $x_20_4 = "$12e94e4d-28ff-4309-b2e5-a22afd2f6688" ascii //weight: 20
        $x_20_5 = "$dce40e3d-eb38-4ce6-8721-8353aefdecbf" ascii //weight: 20
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_10 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
        $x_1_13 = "FromBase64String" ascii //weight: 1
        $x_1_14 = "CreateInstance" ascii //weight: 1
        $x_1_15 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LAU_2147796561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAU!MTB"
        threat_id = "2147796561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "klinikdb.mdf" ascii //weight: 1
        $x_1_2 = "model1.context.tt" ascii //weight: 1
        $x_1_3 = "model1.tt" ascii //weight: 1
        $x_1_4 = "klinikdb_log.ldf" ascii //weight: 1
        $x_1_5 = "Model1.ssdl" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LAX_2147796562_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAX!MTB"
        threat_id = "2147796562"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ad17d918-efeb-4a12-b7ec-e005b8d55d77" ascii //weight: 1
        $x_1_2 = "Win UsbInit" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "GetPixel" ascii //weight: 1
        $x_1_9 = "SuspendLayout" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LBA_2147796563_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LBA!MTB"
        threat_id = "2147796563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "7c75bc1d-57d3-4322-8a7a-99c0093cb4ea" ascii //weight: 1
        $x_1_2 = "Gottschalks" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "GetPixel" ascii //weight: 1
        $x_1_8 = "SuspendLayout" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LBN_2147796564_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LBN!MTB"
        threat_id = "2147796564"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://store2.gofile.io/download/" ascii //weight: 1
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "System.Reflection.Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DFA_2147796630_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFA!MTB"
        threat_id = "2147796630"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 17 58 0b 07 20 00 01 00 00 5d 0b 09 11 07 07 94 58 0d 09 20 00 01 00 00 5d 0d 11 07 07 94 13 05 11 07 07 11 07 09 94 9e 11 07 09 11 05 9e 11 07 11 07 07 94 11 07 09 94 58 20 00 01 00 00 5d 94 13 04 11 08 08 02 08 91 11 04 61 d2 9c 08 17 58 0c}  //weight: 1, accuracy: High
        $x_1_2 = "GetExportedTypes" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "https://store2.gofile.io/download/" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DFC_2147796631_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFC!MTB"
        threat_id = "2147796631"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "InvokeMember" wide //weight: 1
        $x_1_2 = "System.Convert" wide //weight: 1
        $x_1_3 = "FromBase64String" wide //weight: 1
        $x_1_4 = "tf.dr" wide //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "IBnBvBoBkBe" wide //weight: 1
        $x_1_7 = {00 54 6f 44 6f 75 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 4f 39 32 31 33 31 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 49 4f 39 32 31 33 32 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 49 4f 39 32 31 33 33 00}  //weight: 1, accuracy: High
        $x_1_11 = {00 49 4f 39 32 31 33 34 00}  //weight: 1, accuracy: High
        $x_1_12 = {00 49 4f 39 32 31 33 35 00}  //weight: 1, accuracy: High
        $x_1_13 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DFD_2147796632_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFD!MTB"
        threat_id = "2147796632"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 06 07 6f ?? ?? ?? 0a 26 08 06 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 08 11 04 09 11 08 d2 9c 07 17 58 0b 07 08 6f ?? ?? ?? 0a 32 d4 09 17 58 0d 06 17 58 0a}  //weight: 10, accuracy: Low
        $x_10_2 = {16 13 05 2b 2f 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 08 09 11 04 11 05 6f ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 13 0a 08 07 11 0a d2 9c 00 11 05 17 58 13 05 11 05 09 6f ?? ?? ?? 0a fe 04 13 0b 11 0b 2d}  //weight: 10, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DFE_2147796633_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFE!MTB"
        threat_id = "2147796633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 7e ?? ?? ?? 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c 09 7e ?? ?? ?? 04 03 28 ?? ?? ?? 06 17 59 16}  //weight: 1, accuracy: Low
        $x_1_2 = {00 66 67 68 00 70 72 6f 6a 44 61 74 61 00 4b 31 00 78 79 7a 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 75 67 7a 31 00 75 67 7a 33 00 70 72 6f 6a 6e 61 6d 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DEF_2147796634_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DEF!MTB"
        threat_id = "2147796634"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 1f 2d 1f 2b 6f ?? ?? ?? 0a 10 00 02 1f 5f 1f 2f 6f ?? ?? ?? 0a 10 00 02 28 ?? ?? ?? 0a 0c 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 0d 1f 10}  //weight: 10, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
        $x_1_5 = {00 74 65 78 74 54 6f 44 65 63 72 79 70 74 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCA_2147796655_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCA!MTB"
        threat_id = "2147796655"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 26 09 11 04 11 05 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 08 08 07 11 08 d2 9c 11 05 17 58 13 05 11 05 09 6f ?? ?? ?? 0a 32}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCD_2147796675_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCD!MTB"
        threat_id = "2147796675"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 08 09 11 04 11 05 6f ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 13 0a 08 07 11 0a d2 9c 00 11 05 17 58 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "$ffbf50e0-f6ac-47a0-82c7-2a57c56e0497" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "zhwlWinFormT" ascii //weight: 1
        $x_1_5 = "ColorTranslator" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCE_2147796676_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCE!MTB"
        threat_id = "2147796676"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 08 6f ?? ?? ?? 0a fe 04 13 08 11 08 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DFN_2147796739_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFN!MTB"
        threat_id = "2147796739"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 06 07 6f ?? ?? ?? 0a 26 08 06 07 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 11 04 09 11 06 d2 9c 07 17 58 0b 07 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d ca}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCN_2147796764_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCN!MTB"
        threat_id = "2147796764"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "49e2907a-6d2a-4a4b-b4d8-35ae59468fc6" ascii //weight: 1
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "FSFSFSFF" ascii //weight: 1
        $x_1_5 = "Roguelike" ascii //weight: 1
        $x_1_6 = "ColorTranslator" ascii //weight: 1
        $x_1_7 = "GetPixel" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCM_2147796765_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCM!MTB"
        threat_id = "2147796765"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 11 09 6f ?? ?? ?? 0a 13 0a 11 0a 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 0b 11 0b 2c 2c 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 00 11 09 17 d6 13 09 11 09 11 08 fe 02 16 fe 01 13 0c 11 0c 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LBO_2147796826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LBO!MTB"
        threat_id = "2147796826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 07 08 6f ?? ?? ?? 0a 07 18 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 03 16 03 8e 69 6f ?? ?? ?? 0a 0d de}  //weight: 1, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "powershell" ascii //weight: 1
        $x_1_4 = "Test-NetConnection" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5f d2 13 0f 11 06 11 0f 95 d2 13 10 11 13 20 ?? ?? ?? ?? 5a 20 ?? ?? ?? ?? 61 38}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 17 8d 5d 00 00 01 25 16 1f 7c 9d 28 1f 01 00 06 0a 07 ?? ?? ?? ?? ?? 5a ?? ?? ?? ?? ?? 61}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 1f 09 8d 44 00 00 01 25 d0 dc 00 00 04 28 c6 00 00 0a 0a 1f 0a 8d 44 00 00 01 25 d0 dd 00 00 04 28 c6 00 00 0a 0b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 73 1a 00 00 06 0a 00 06 17 6f 26 00 00 06 00 06 17 6f 23 00 00 0a 00 00 de 0b 06 2c 07 06 6f 24 00 00 0a 00 dc 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 2b 0b 00 70 0b 28 df 00 00 0a 72 ?? ?? ?? 70 18 17 8d 21 00 00 01 25 16 07 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 00 70 6f ?? 00 00 0a 11 05 1f 16 5d 91 13 06 11 05 17 58 08 5d}  //weight: 1, accuracy: Low
        $x_1_2 = {02 07 11 05 91 11 06 61 11 08 28}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 1f 16 5d 91 61 07 11 06 91 59 20 00 01 00 00 58 13 07 07 11 05 11 07 20 ff 00 00 00 5f 28 86 00 00 0a 9c 00 11 05 17 58 13 05}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 0c 00 00 06 28 03 00 00 06 2a 00 13 30 06 00 ?? ?? 00 00 02 00 00 11 d0 01 00 00 02 28}  //weight: 1, accuracy: Low
        $x_1_2 = "set_Padding" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 17 58 09 5d 13 06 07 08 07 08 91 11 04 08 1f 16 5d 91 61 07 11 06 91 59 20 00 01 00 00 58 20 ff 00 00 00 5f 28 b4 00 00 0a 9c 08 17 58 0c 08 09 32 cd}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_9
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 08 17 58 13 06 07 08 07 08 91 28 06 00 00 06 08 1f 16 5d 91 61 07 11 06 07 8e 69 5d 91 59 20 00 01 00 00 58 d2 9c 08 17 58 0c 00 08 09 fe 04 13 07 11 07 2d ca}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_10
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 72 00 00 06 0a 06 02 7d 42 00 00 04 16 06 7b 42 00 00 04 6f 9d 00 00 0a 18 5b 28 a7 00 00 0a 06 fe 06 73 00 00 06 73 a8 00 00 0a 28 01 00 00 2b 28 02 00 00 2b 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_11
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 07 08 07 08 91 28 0e 00 00 06 08 1f 16 5d 91 61 07 08 17 58 07 8e 69 5d 91 59 20 00 01 00 00 58 20 ff 00 00 00 5f d2 9c 08 17 58 0c 00 08 07 8e 69 fe 04 13 05 11 05 2d c6}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_12
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 73 c7 00 00 06 25 6f c8 00 00 06 16 6a 6f 25 00 00 0a 25 25 6f c8 00 00 06 6f 2b 00 00 0a 69 6f c9 00 00 06 0a 6f cc 00 00 06 73 2b 00 00 06 28 4c 00 00 06 0b 73 2b 00 00 06 28 4b 00 00 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_13
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "get_Marca" ascii //weight: 1
        $x_1_2 = "set_Precio" ascii //weight: 1
        $x_1_3 = "get_Codigo" ascii //weight: 1
        $x_1_4 = "get_Nombre" ascii //weight: 1
        $x_1_5 = {02 07 11 05 91 11 06 61 11 08 28}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_14
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fe 09 01 00 20 1f 00 00 00 8f 0c 00 00 01 25 47 20 7f 00 00 00 5f d2 52 fe 09 01 00 20 1f 00 00 00 8f 0c 00 00 01 25 47 20 40 00 00 00 60 d2 52 fe 09 01 00 20 00 00 00 00 8f 0c 00 00 01 25 47 20 f8 00 00 00 5f d2 52 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_15
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7f 01 00 00 04 7e 01 00 00 04 8e 69 28 0d 00 00 06 73 03 00 00 06 7e 03 00 00 04 7e 02 00 00 04 6f 02 00 00 06 7e 01 00 00 04 16 8f 17 00 00 01 7e 01 00 00 04 8e 69 1f 40 12 00 28 0c 00 00 06 26 16 0b 20 88 01 00 00 0c 16 16}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RP_2147796841_16
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RP!MTB"
        threat_id = "2147796841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 8f 05 00 00 01 25 71 05 00 00 01 11 07 02 58 04 59 20 ff 00 00 00 5f d2 61 d2 81 05 00 00 01 11 12 1f 79 93 20 83 18 00 00 59 13 10 38}  //weight: 1, accuracy: High
        $x_1_2 = {61 02 61 0a 7e 1a 00 00 04 0c 08 74 03 00 00 1b 25 06 93 0b 06 18 58 93 07 61 0b 11 0f 20 a0 00 00 00 91 11 0f 1f 34 91 59 13 0e 38}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_LDA_2147796872_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LDA!MTB"
        threat_id = "2147796872"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 08 6f ?? ?? ?? 0a fe 04 13 08 11 08 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LDD_2147796873_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LDD!MTB"
        threat_id = "2147796873"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdghcggfsdfsd.dll#" ascii //weight: 1
        $x_1_2 = "#fsdhcfsdf.dll#" ascii //weight: 1
        $x_1_3 = "#fsdhhahffdsf.dll#" ascii //weight: 1
        $x_1_4 = "#fsdghhhhhhsdgfdsf.dll#" ascii //weight: 1
        $x_1_5 = "gfdffffffhfffg" ascii //weight: 1
        $x_1_6 = {00 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68 00}  //weight: 1, accuracy: High
        $x_1_7 = "hkkkkkkkkkkkkkkkkkkkkkkkkc" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "#fsdgfgffsdf#" ascii //weight: 1
        $x_1_10 = "#fsdhhaffdsf.dll#" ascii //weight: 1
        $x_1_11 = "#fshggdfsshgfhdfsdf.dll#" ascii //weight: 1
        $x_1_12 = "#fsdfsdggfdsf.dll#" ascii //weight: 1
        $x_1_13 = "ewafffsfasccfggggggggggggggggggggggggggasfw" ascii //weight: 1
        $x_1_14 = "fsafafwwwwwwwwaf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DFB_2147796905_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFB!MTB"
        threat_id = "2147796905"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "31"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 08 11 02 02 11 02 91 11 ?? 61 d2 9c}  //weight: 10, accuracy: Low
        $x_1_2 = "https://store2.gofile.io/download/" wide //weight: 1
        $x_1_3 = "https://cdn.discordapp.com/attachments/" wide //weight: 1
        $x_10_4 = "GetExportedTypes" ascii //weight: 10
        $x_10_5 = "DownloadData" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DFM_2147796906_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFM!MTB"
        threat_id = "2147796906"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 06 11 07 d2 9c}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DFO_2147796907_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFO!MTB"
        threat_id = "2147796907"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ffbf50e0-f6ac-47a0-82c7-2a57c56e0497" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "GetCallingAssembly" ascii //weight: 1
        $x_1_7 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCC_2147796931_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCC!MTB"
        threat_id = "2147796931"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$bfd30c25-ffc3-42b9-8ce8-7853e305c585" ascii //weight: 10
        $x_10_2 = "$d65e843b-be0f-4e3d-9814-ff6a00a20100" ascii //weight: 10
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "ColorTranslator" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DFZ_2147797021_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DFZ!MTB"
        threat_id = "2147797021"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e 08 2c 06 08 6f ?? ?? ?? 0a dc 07 2c 06 07 6f ?? ?? ?? 0a dc 06 2c 06 06 6f ?? ?? ?? 0a dc}  //weight: 10, accuracy: Low
        $x_10_2 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d dd ?? ?? ?? ?? 08 39 ?? ?? ?? ?? 08 6f ?? ?? ?? 0a dc 07 39 ?? ?? ?? ?? 07 6f ?? ?? ?? 0a dc 06 39 ?? ?? ?? ?? 06 6f ?? ?? ?? 0a dc}  //weight: 10, accuracy: Low
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DGB_2147797022_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DGB!MTB"
        threat_id = "2147797022"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$b84108ec-f25c-4fea-bec6-e12f57c4208b" ascii //weight: 10
        $x_10_2 = "$f5729aa4-129b-4e07-a30b-dc1eabb93d43" ascii //weight: 10
        $x_10_3 = "$13950a8f-c029-4c1f-8643-27f294ea9a76" ascii //weight: 10
        $x_10_4 = "$40d13378-9ad9-4cb3-9d26-5dcdc5f6bf47" ascii //weight: 10
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GZipStream" ascii //weight: 1
        $x_1_7 = "CompressionMode" ascii //weight: 1
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "GetMethod" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "DebuggableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DGQ_2147797043_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DGQ!MTB"
        threat_id = "2147797043"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 08 6f ?? ?? ?? 0a 13 09 12 09 28 ?? ?? ?? 0a fe 04 13 08 11 08 2d ba}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DGQ_2147797043_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DGQ!MTB"
        threat_id = "2147797043"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$05998a4c-1757-44e5-adb9-244666623746" ascii //weight: 10
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "ReadProcessMemory" wide //weight: 1
        $x_1_5 = "WriteProcessMemory" wide //weight: 1
        $x_1_6 = "SetThreadContext" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DGR_2147797044_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DGR!MTB"
        threat_id = "2147797044"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {06 02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 0a 84}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LCO_2147797045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LCO!MTB"
        threat_id = "2147797045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 0a 11 07 11 0b 6f ?? ?? ?? 0a 1d 62 d2 11 07 11 0b 17 d6 6f ?? ?? ?? 0a 1c 62 d2 58 86 11 07 11 0b 18 d6 6f ?? ?? ?? 0a 1b 62 d2 58 86 11 07 11 0b 19 d6 6f}  //weight: 1, accuracy: Low
        $x_1_2 = {1a 62 d2 58 86 11 07 11 0b 1a d6 6f ?? ?? ?? 0a 19 62 d2 58 86 11 07 11 0b 1b d6 6f ?? ?? ?? 0a 18 62 d2 58 86 11 07 11 0b 1c d6 6f}  //weight: 1, accuracy: Low
        $x_1_3 = "db38611-e9f6-47cd-8e2e-86beb13312" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LDB_2147797046_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LDB!MTB"
        threat_id = "2147797046"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 26 06 08 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 02 0d 06 6f ?? ?? ?? 0a 09 16 09 8e 69 6f ?? ?? ?? 0a 13 04 dd}  //weight: 1, accuracy: Low
        $x_10_2 = "https://store2.gofile.io/download/" ascii //weight: 10
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "Download" ascii //weight: 1
        $x_1_5 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_6 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_7 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LDC_2147797047_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LDC!MTB"
        threat_id = "2147797047"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 0a 11 07 11 0b 6f ?? ?? ?? 0a 1d 62 d2 11 07 11 0b 17 d6 6f ?? ?? ?? 0a 1c 62 d2 58 86 11 07 11 0b 18 d6 6f ?? ?? ?? 0a 1b 62 d2 58 86 11 07 11 0b 19 d6 6f}  //weight: 1, accuracy: Low
        $x_1_2 = {1a 62 d2 58 86 11 07 11 0b 1a d6 6f ?? ?? ?? 0a 19 62 d2 58 86 11 07 11 0b 1b d6 6f ?? ?? ?? 0a 18 62 d2 58 86 11 07 11 0b 1c d6 6f}  //weight: 1, accuracy: Low
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "Decode" ascii //weight: 1
        $x_1_5 = "NServer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LDE_2147797048_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LDE!MTB"
        threat_id = "2147797048"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$b1bface5-1baa-4a2a-b4d2-bb3e9019f7b8" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LDZ_2147797049_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LDZ!MTB"
        threat_id = "2147797049"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6398633d-a7e9-4403-b270-13ef97fbcd2b" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEB_2147797107_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEB!MTB"
        threat_id = "2147797107"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "asdadda" ascii //weight: 1
        $x_1_2 = "FHJ4324242" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = {00 58 58 58 58 58 58 58 58 58 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LED_2147797108_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LED!MTB"
        threat_id = "2147797108"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 06 07 6f ?? ?? ?? 0a 26 08 06 07 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 11 04 09 11 06 d2 9c 07 17 58 0b 07 08 6f ?? ?? ?? 0a 13 08 12 08 28 ?? ?? ?? 0a fe 04 13 07 11 07 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEO_2147797376_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEO!MTB"
        threat_id = "2147797376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEP_2147797377_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEP!MTB"
        threat_id = "2147797377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FromBase64" ascii //weight: 1
        $x_1_2 = "#dfgfg#" ascii //weight: 1
        $x_1_3 = "#gdfgdfg#" ascii //weight: 1
        $x_1_4 = "#sssssssss.dll#" ascii //weight: 1
        $x_1_5 = "#fshghhhgfgggghdfsdf.dll#" ascii //weight: 1
        $x_1_6 = "#fsdfgdddddfchafhghgsdf.dll#" ascii //weight: 1
        $x_1_7 = {00 66 73 68 64 64 64 64 64 64 64 64 64 67 68 64 00}  //weight: 1, accuracy: High
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LER_2147797378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LER!MTB"
        threat_id = "2147797378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "U8342523534" ascii //weight: 1
        $x_1_2 = "FHJ4324242" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = {00 58 58 58 58 58 58 58 58 58 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "CharToValue" ascii //weight: 1
        $x_1_9 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DGJ_2147797576_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DGJ!MTB"
        threat_id = "2147797576"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$096857f6-23c3-41e3-b964-0c0d02f6e183" ascii //weight: 10
        $x_1_2 = "GetTypes" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DGP_2147797578_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DGP!MTB"
        threat_id = "2147797578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 43 00 07 02 6f ?? ?? ?? 0a 18 5b 59 0d 02 6f ?? ?? ?? 0a 18 5b 08 59 13 04 02 07 08 6f ?? ?? ?? 0a 13 05 12 05 28 ?? ?? ?? 0a 13 06 06 09 11 04 22 ?? ?? ?? ?? 11 06 59 6c 6f ?? ?? ?? 06 00 00 08 17 58 0c 08 02 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "GetBrightness" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DHJ_2147797667_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DHJ!MTB"
        threat_id = "2147797667"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 17 58 0b 07 20 00 01 00 00 5d 0b 09 11 07 07 94 58 0d 09 20 00 01 00 00 5d 0d 11 07 07 94 13 05 11 07 07 11 07 09 94 9e 11 07 09 11 05 9e 11 07 11 07 07 94 11 07 09 94 58 20 00 01 00 00 5d 94 13 04 11 08 08 02 08 91 11 04 61 d2 9c 08 17 58 0c}  //weight: 1, accuracy: High
        $x_1_2 = {47 65 74 42 75 66 66 65 72 00 62 75 66 66 65 72}  //weight: 1, accuracy: High
        $x_1_3 = {6d 65 74 68 6f 64 4e 61 6d 65 00 74 79 70 65 4e 61 6d 65 00 47 74 70 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DIA_2147797668_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DIA!MTB"
        threat_id = "2147797668"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 08 07 11 08 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d c6}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DIB_2147797669_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DIB!MTB"
        threat_id = "2147797669"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEG_2147797740_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEG!MTB"
        threat_id = "2147797740"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 08 93 06 08 06 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 17 58 0c 08 02 8e 69}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEH_2147797741_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEH!MTB"
        threat_id = "2147797741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$940182c6-cb93-4080-9d3c-7aab7e988366" ascii //weight: 1
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "ToWin32" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "GetPixel" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEZ_2147797742_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEZ!MTB"
        threat_id = "2147797742"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 6f ?? ?? ?? 0a 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 07 17 58 0b 07 02 6f ?? ?? ?? 0a 32}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGA_2147797790_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGA!MTB"
        threat_id = "2147797790"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 36 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 16 13 07 02 11 06 28 ?? ?? ?? 06 13 07 17 13 08 00 07 06 11 07 d2 9c 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGB_2147797791_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGB!MTB"
        threat_id = "2147797791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 32 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 17 13 08 00 07 06 11 07 d2 9c 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGE_2147797792_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGE!MTB"
        threat_id = "2147797792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 38 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 16 13 08 02 11 07 28 ?? ?? ?? 06 13 08 17 13 09 00 08 07 11 08 d2 9c 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0a 11 0a 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGI_2147797867_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGI!MTB"
        threat_id = "2147797867"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FHJ4324242" ascii //weight: 1
        $x_1_2 = "GetObjectValue" ascii //weight: 1
        $x_1_3 = {00 58 58 58 58 58 58 58 58 58 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "CharToValue" ascii //weight: 1
        $x_1_7 = "I.n.v.o.k.e" ascii //weight: 1
        $x_1_8 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RA_2147797904_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RA!MTB"
        threat_id = "2147797904"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2d 03 26 2b 03 0a 2b 00 06 ?? 2d 49 26 06 17 58 ?? 2d 49 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJC_2147797905_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJC!MTB"
        threat_id = "2147797905"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 16 13 08 02 11 07 28 ?? ?? ?? 06 13 08 1b 13 09 11 09 13 0b 11 0b 13 0a 11 0a 1b 2e 02 2b 0d 17 13 0c 00 08 07 11 08 d2 9c 00 2b 02 2b 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0d 11 0d 2d a7}  //weight: 10, accuracy: Low
        $x_10_2 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 16 13 08 02 11 07 28 ?? ?? ?? 06 13 08 08 07 11 08 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d c2 07 17 58 0b 00 11 04 17 58 13 04}  //weight: 10, accuracy: Low
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DJB_2147797906_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJB!MTB"
        threat_id = "2147797906"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = "ToWin32" wide //weight: 1
        $x_1_5 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 77 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJD_2147797907_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJD!MTB"
        threat_id = "2147797907"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 02 11 08 02 11 08 91 11 01 61 11 00 11 03 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {11 05 02 11 02 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGD_2147798009_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGD!MTB"
        threat_id = "2147798009"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$47e6409a-13da-486d-9231-c2d74e237f8f" ascii //weight: 10
        $x_10_2 = "3fa58cc7-4cfb-4aee-9b1c-5e5b53df52af" ascii //weight: 10
        $x_10_3 = "$edc3cc08-efd8-42c7-bbd8-a26d8cb444b9" ascii //weight: 10
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LHA_2147798010_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHA!MTB"
        threat_id = "2147798010"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 4e 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 16 13 08 02 11 07 28 ?? ?? ?? 06 13 08 1b 13 09 11 09 13 0b 11 0b 13 0a 11 0a 1b 2e 02 2b 0d 17 13 0c 00 08 07 11 08 d2 9c 00 2b 02 2b 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0d 11 0d 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LHB_2147798011_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHB!MTB"
        threat_id = "2147798011"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "jjvvvvvvvflhhhhhhhhhfffffffffffffffsssssvhn" ascii //weight: 10
        $x_10_2 = "cxvxsssffffffffcvcgggggggv" ascii //weight: 10
        $x_1_3 = "fds.dll#" ascii //weight: 1
        $x_1_4 = "#ggggg" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LHC_2147798012_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHC!MTB"
        threat_id = "2147798012"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 26 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 16 13 07 02 11 06 28 ?? ?? ?? 06 13 07 08 07 11 07 d2 9c 11 05 17 58 13 05 11 05 17 32 cb}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "ColorTranslator" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LHD_2147798013_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHD!MTB"
        threat_id = "2147798013"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 31 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 58 58 58 58 58 58 58 58 58 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_3 = "FHJ4324242" ascii //weight: 1
        $x_1_4 = "GetObjectValue" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "CharToValue" ascii //weight: 1
        $x_1_8 = "NServer4" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LHL_2147798044_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHL!MTB"
        threat_id = "2147798044"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 05 2b 33 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 16 13 08 02 11 07 28 ?? ?? ?? 06 13 08 08 07 11 08 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d c2}  //weight: 10, accuracy: Low
        $x_10_2 = {13 04 2b 31 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 16 13 07 02 11 06 28 ?? ?? ?? 06 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d c4}  //weight: 10, accuracy: Low
        $x_5_3 = "ToWin32" ascii //weight: 5
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_5_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LHM_2147798045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHM!MTB"
        threat_id = "2147798045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 00 73 00 3a 00 2f 00 2f 00 6a 00 75 00 64 00 65 00 39 00 30 00 37 00 39 00 2e 00 30 00 30 00 30 00 77 00 65 00 62 00 68 00 6f 00 73 00 74 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 61 00 72 00 69 00 6f 00 72 00 69 00 67 00 69 00 6e 00 6c 00 6f 00 67 00 67 00 65 00 72 00 2e 00 65 00 78 00 65}  //weight: 1, accuracy: High
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "GetString" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DIR_2147798068_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DIR!MTB"
        threat_id = "2147798068"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 07 08 6f ?? ?? ?? 0a 07 18 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0d de 15 07 2c 06 07 6f ?? ?? ?? 0a dc 11 00 73 ?? ?? ?? 0a 0b 73 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 72 61 6e 73 66 6f 72 6d 46 69 6e 61 6c 42 6c 6f 63 6b 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJE_2147798070_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJE!MTB"
        threat_id = "2147798070"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$A14CE2C0-AB36-462F-9893-1729CEF35F27" ascii //weight: 1
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJM_2147798144_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJM!MTB"
        threat_id = "2147798144"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {19 62 d2 58 86 11 07 11 0b 1b d6 6f ?? ?? ?? 0a 18 62 d2 58 86 11 07 11 0b 1c d6 6f}  //weight: 1, accuracy: Low
        $x_1_2 = {00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 42 61 73 65 33 32 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_8 = "GetMethod" wide //weight: 1
        $x_1_9 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_10 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAQ_2147798150_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAQ!MTB"
        threat_id = "2147798150"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ClassicIRCBot\\src\\IrcBot.GUI\\bin" wide //weight: 1
        $x_1_2 = "zVBVmpePme0ebI7f6uX.c7ZoAXerow2pBEq3fKU.resources" ascii //weight: 1
        $x_1_3 = "466C75736857726974654173796E6364" wide //weight: 1
        $x_1_4 = "$2e0144e3-168a-4fa4-a16e-955b1002876b" ascii //weight: 1
        $x_1_5 = "#kakerock" wide //weight: 1
        $x_1_6 = "Rolling Thunder" ascii //weight: 1
        $x_1_7 = "Bg5xwv4QDY3EhY5WFU" ascii //weight: 1
        $x_1_8 = "YRcsxNKnsWvdHCsyte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAQ_2147798150_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAQ!MTB"
        threat_id = "2147798150"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "A0VV^A2^37^20^40VV^70^D7^A0VV^92^37^20^40" wide //weight: 1
        $x_1_2 = "27V^90^C2^70^B0^10^EF^61^E8^60^A0^A0VV^91^F6^61" wide //weight: 1
        $x_1_3 = "65V^47V^36V^57V^46V^F6V^27V^05V^10V^80V^43VVV^97V^" wide //weight: 1
        $x_1_4 = "81^46^23^C4^E4^CA^C5^70^CE^57^AA^7F^F5^5E^2E^5B" wide //weight: 1
        $x_1_5 = "9A^06^EB^C4^34^D7^F3^DE^D4^2C^E5^14^EB^27^4D^A6" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGP_2147798209_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGP!MTB"
        threat_id = "2147798209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$4d4bce83-52d4-4b59-8465-10b8903348cb" ascii //weight: 10
        $x_10_2 = "$8333121a-7b3e-4b23-ad75-5f53226aed83" ascii //weight: 10
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LGQ_2147798210_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGQ!MTB"
        threat_id = "2147798210"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "000webhostapp.com" ascii //weight: 1
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "Form1ASFFDSSFSF" ascii //weight: 1
        $x_1_6 = "FromArgb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LHE_2147798211_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHE!MTB"
        threat_id = "2147798211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 1, accuracy: Low
        $x_1_2 = "Encoder" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LGW_2147798212_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LGW!MTB"
        threat_id = "2147798212"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$db69524c-c4df-44f1-9318-3e022a462f42" ascii //weight: 10
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RAA_2147798218_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RAA!MTB"
        threat_id = "2147798218"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "InitializeComponent" ascii //weight: 1
        $x_1_2 = "X509Constants" ascii //weight: 1
        $x_1_3 = "Form_hashFunctions" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "ISupportInitialize" ascii //weight: 1
        $x_1_6 = "m_aiHashes" ascii //weight: 1
        $x_1_7 = "SelectorX" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMKOA_2147798239_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMKOA!MTB"
        threat_id = "2147798239"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#emanser#" ascii //weight: 1
        $x_1_2 = "coGjRNIaALuW" ascii //weight: 1
        $x_1_3 = "#ssap#" ascii //weight: 1
        $x_1_4 = "bxnyranwhOth" ascii //weight: 1
        $x_1_5 = "lld.tnemeganaM.metsyS" ascii //weight: 1
        $x_1_6 = "lld.metsyS" ascii //weight: 1
        $x_1_7 = "lld.gniwarD.metsyS" ascii //weight: 1
        $x_1_8 = "lld.eroC.metsyS" ascii //weight: 1
        $x_1_9 = "exeniw:tegrat/ +gubed/ 68X:mroftalp/ +ezimitpo/" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule Trojan_MSIL_AgentTesla_LIA_2147798244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LIA!MTB"
        threat_id = "2147798244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 04 2b 31 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 16 13 07 02 11 06 28 ?? ?? ?? 06 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d c4}  //weight: 10, accuracy: Low
        $x_10_2 = {13 05 2b 33 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 16 13 08 02 11 07 28 ?? ?? ?? 06 13 08 08 07 11 08 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d}  //weight: 10, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LIC_2147798245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LIC!MTB"
        threat_id = "2147798245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://buysrilankan.lk/k/" ascii //weight: 1
        $x_1_2 = "Reverse" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "GetExportedTypes" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAY_2147798260_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAY!MTB"
        threat_id = "2147798260"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$0e7da2f2-1f47-4afe-aa95-049859759b8d" ascii //weight: 1
        $x_1_2 = "mailto:FuhrerKingBradly@outlook.com" wide //weight: 1
        $x_1_3 = "http://winhostsmanager.codeplex.com" wide //weight: 1
        $x_1_4 = "ali.bahraminezhad@outlook.com" wide //weight: 1
        $x_1_5 = "WinHostsManager.Properties.Resources" wide //weight: 1
        $x_1_6 = "# Created by WinHostsManager" wide //weight: 1
        $x_1_7 = "InfiniteLoop.IR" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJN_2147798266_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJN!MTB"
        threat_id = "2147798266"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 42 61 73 65 33 32 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_7 = "GetMethod" wide //weight: 1
        $x_1_8 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_9 = "Invoke" wide //weight: 1
        $x_1_10 = {00 52 41 57 00 41 63 63 6f 75 6e 74 44 6f 6d 61 69 6e 53 69 64 00 49 4d 61 70 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKC_2147798269_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKC!MTB"
        threat_id = "2147798269"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 41 63 63 6f 75 6e 74 44 6f 6d 61 69 6e 53 69 64 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 42 61 73 65 33 32 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_7 = "ToLower" ascii //weight: 1
        $x_1_8 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_9 = "G-e-t-M-e-t-h-o-d" wide //weight: 1
        $x_1_10 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 30 39 38 37 36 35 34 33 32 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKN_2147798402_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKN!MTB"
        threat_id = "2147798402"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 2c 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 08 07 02 11 07 28 ?? ?? ?? 06 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d c9}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKL_2147798403_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKL!MTB"
        threat_id = "2147798403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 02 07 91 11 04 61 09 06 91 61 28 ?? ?? ?? 0a 9c 06 03 6f ?? ?? ?? 0a 17 59 fe 01 13 05 11 05 2c 04 16 0a 2b 04 06 17 58 0a 07 17 58 0b 07 02 8e 69 17 59}  //weight: 1, accuracy: Low
        $x_1_2 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LIB_2147798413_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LIB!MTB"
        threat_id = "2147798413"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$2e0144e3-168a-4fa4-a16e-955b1002876b" ascii //weight: 10
        $x_10_2 = "$db69524c-c4df-44f1-9318-3e022a462f42" ascii //weight: 10
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "ColorTranslator" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LID_2147798414_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LID!MTB"
        threat_id = "2147798414"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0a 06 17 58 0a 06 1f 0a 32 ed}  //weight: 1, accuracy: High
        $x_1_2 = "ab347fb6-27e6-446e-baeb-c3f1" ascii //weight: 1
        $x_1_3 = "Encoder" ascii //weight: 1
        $x_1_4 = "GetCurrentProcess" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "GetExportedTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKE_2147798517_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKE!MTB"
        threat_id = "2147798517"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 28 ?? ?? ?? 06 13 07 16}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 41 70 70 65 6e 64 4c 69 6e 65 00}  //weight: 1, accuracy: High
        $x_1_6 = "ToWin32" wide //weight: 1
        $x_1_7 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_8 = "InvokeMember" ascii //weight: 1
        $x_1_9 = {00 54 6f 44 6f 75 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 41 70 70 65 6e 64 54 65 78 74 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKF_2147798518_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKF!MTB"
        threat_id = "2147798518"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 41 70 70 65 6e 64 4c 69 6e 65 00}  //weight: 1, accuracy: High
        $x_1_6 = "ToWin32" wide //weight: 1
        $x_1_7 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 54 6f 44 6f 75 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 41 70 70 65 6e 64 54 65 78 74 00}  //weight: 1, accuracy: High
        $x_1_11 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKR_2147798519_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKR!MTB"
        threat_id = "2147798519"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 55 49 4f 44 53 31 32 33 34 31 31 34 31 34 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 55 49 4f 44 53 31 32 33 34 31 34 32 33 35 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 55 49 4f 44 53 31 32 34 36 35 37 35 37 35 36 37 35 36 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 42 61 73 65 33 32 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_7 = "G-e-t-M-e-t-h-o-d" wide //weight: 1
        $x_1_8 = "I-n-v-o-k-e" wide //weight: 1
        $x_1_9 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJA_2147798527_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJA!MTB"
        threat_id = "2147798527"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 2a 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 07 06 02 11 06 28 ?? ?? ?? 06 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d cb}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJA_2147798527_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJA!MTB"
        threat_id = "2147798527"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdfsd.dll#" ascii //weight: 1
        $x_1_2 = "#hdfffwtwfffffffgsssssdf.dll#" ascii //weight: 1
        $x_1_3 = "#gttttttwds#" ascii //weight: 1
        $x_1_4 = "#wwwwwwwww#" ascii //weight: 1
        $x_1_5 = "#fffswtf.dll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJA_2147798527_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJA!MTB"
        threat_id = "2147798527"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0d 09 2d dc}  //weight: 1, accuracy: Low
        $x_1_2 = {3f 0e 30 00 30 00 33 00 36 00 30 00 30 00 33 00 32 00 30 00 30 00 33 00 38 00 30 00 30 00 33 00 32 00 30 00 30 00 33 00 37 00 30 00 30 00 33 00 30 00 30 00 30 00 33 00 34 00 30 00 30 00 33 00 34 00 30 00 30 00 33 00}  //weight: 1, accuracy: High
        $x_1_3 = "DownloadData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKY_2147798546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKY!MTB"
        threat_id = "2147798546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 2c 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 08 07 02 11 07 28 ?? ?? ?? 06 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d c9 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKW_2147798547_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKW!MTB"
        threat_id = "2147798547"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 00 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c 09 03 6f ?? ?? ?? 0a 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKZ_2147798548_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKZ!MTB"
        threat_id = "2147798548"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 55 49 4f 44 53 31 32 34 36 35 37 35 37 35 36 37 35 36 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 55 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 42 61 73 65 33 32 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_7 = "G-e-t-M-e-t-h-o-d" wide //weight: 1
        $x_1_8 = "I-n-v-o-k-e" wide //weight: 1
        $x_1_9 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LIQ_2147798549_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LIQ!MTB"
        threat_id = "2147798549"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fe 0c 02 00 20 00 00 00 00 73 aa 00 00 0a fe 0e 03 00 fe 0c 03 00 73 ab 00 00 0a fe 0e 04 00 fe 0c 04 00 6f ac 00 00 0a fe 0e 01 00 dd 39}  //weight: 1, accuracy: High
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "DecompressString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLA_2147798606_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLA!MTB"
        threat_id = "2147798606"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://91.243.59.62/verify.php?" wide //weight: 1
        $x_1_2 = {00 44 6f 77 6e 6c 6f 61 64 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = "http://138.124.186.237/verify.php" wide //weight: 1
        $x_1_4 = "SELECT * FROM Win32_Process" wide //weight: 1
        $x_1_5 = "svchost.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HR_2147798702_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HR!MTB"
        threat_id = "2147798702"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "quick_screen_recorder.Properties.Resources" ascii //weight: 1
        $x_1_2 = "$739d3a11-1f74-40ef-8ca8-3789066d7e58" ascii //weight: 1
        $x_1_3 = "//github.com/ModuleArt/" ascii //weight: 1
        $x_1_4 = ".compressed" ascii //weight: 1
        $x_1_5 = "costura" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HS_2147798703_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HS!MTB"
        threat_id = "2147798703"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Nebula__Web_Browser_.Resources" ascii //weight: 1
        $x_1_2 = "BIG_DISCORD_LINK_STRING" ascii //weight: 1
        $x_1_3 = "WebBrowser1" ascii //weight: 1
        $x_1_4 = "DownloadString" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HT_2147798705_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HT!MTB"
        threat_id = "2147798705"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SubFrameCalculator.Resources" ascii //weight: 1
        $x_1_2 = "$38cec8bb-c013-475f-98b4-5ec05d41f46b" ascii //weight: 1
        $x_1_3 = "//cdn.discordapp.com/attachments/" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "DownloadString" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJD_2147798751_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJD!MTB"
        threat_id = "2147798751"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 2a 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 07 06 02 11 06 28 ?? ?? ?? 06 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d cb}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJH_2147798752_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJH!MTB"
        threat_id = "2147798752"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 00}  //weight: 1, accuracy: High
        $x_1_3 = "Base32String" ascii //weight: 1
        $x_1_4 = "G-e-t-M-e-t-h-o-d" ascii //weight: 1
        $x_1_5 = "ToLower" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = {00 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 00}  //weight: 1, accuracy: High
        $x_1_8 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_9 = "--I--n--v--o--k--e--" ascii //weight: 1
        $x_1_10 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
        $x_1_11 = "U8888888888888888888" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (11 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKM_2147798838_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKM!MTB"
        threat_id = "2147798838"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 24 65 32 34 61 33 66 37 66 2d 33 39 65 30 2d 34 30 64 64 2d 38 61 36 32 2d 62 34 34 66 63 65 39 37 63 33 33 62 00}  //weight: 10, accuracy: High
        $x_1_2 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKO_2147798839_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKO!MTB"
        threat_id = "2147798839"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$A14CE2C0-AB36-462F-9893-1729CEF35F27" ascii //weight: 10
        $x_1_2 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 65 6c 65 63 74 6f 72 58 00 66 67 68 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 70 72 6f 6a 44 61 74 61 00 4b 31 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKU_2147798840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKU!MTB"
        threat_id = "2147798840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3f52aae6-0173-4d77-9b9e-0ed0b02f68d7" ascii //weight: 1
        $x_1_2 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 72 69 6d 53 74 61 72 74 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DKV_2147798841_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DKV!MTB"
        threat_id = "2147798841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "com.mojang.escape" wide //weight: 1
        $x_1_2 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
        $x_1_3 = "Transactions.TxFileManager" wide //weight: 1
        $x_1_4 = "SelectorX" wide //weight: 1
        $x_1_5 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLB_2147798842_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLB!MTB"
        threat_id = "2147798842"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {fe 0c 02 00 20 00 00 00 00 73 ?? ?? ?? 0a fe 0e 03 00 fe 0c 03 00 73 ?? ?? ?? 0a fe 0e 04 00 fe 0c 04 00 6f ?? ?? ?? 0a fe 0e 01 00 dd ?? ?? ?? ?? fe 0c 04 00 39 ?? ?? ?? ?? fe 0c 04 00 6f ?? ?? ?? 0a dc fe 0c 03 00 39 ?? ?? ?? ?? fe 0c 03 00 6f ?? ?? ?? 0a dc}  //weight: 10, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 44 65 63 6f 6d 70 72 65 73 73 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 5a 69 70 53 74 72 65 61 6d 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6d 70 72 65 73 73 69 6f 6e 4d 6f 64 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLG_2147798843_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLG!MTB"
        threat_id = "2147798843"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = "SelectorX" wide //weight: 1
        $x_1_7 = "Transactions.TxFileManager" wide //weight: 1
        $x_1_8 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 4c 65 76 65 6c 00 69 73 4f 4b 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLN_2147798849_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLN!MTB"
        threat_id = "2147798849"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 2d 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 17 13 07 07 06 02 11 06 28 ?? ?? ?? 06 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d c8}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLM_2147798850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLM!MTB"
        threat_id = "2147798850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "-T-o-W-i-n-3-2-" wide //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = "PU.oo" wide //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "$0BFCAD74-1226-4EEA-88B0-9F810FF940F5" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLO_2147798851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLO!MTB"
        threat_id = "2147798851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 02 11 02 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 59 91 1f 70 61 13 01}  //weight: 1, accuracy: High
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LLA_2147799000_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLA!MTB"
        threat_id = "2147799000"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 17 62 d2 58 86 11 07 11 0b 1d d6 6f ?? ?? ?? 0a 58 86 6f ?? ?? ?? 0a 00 11 0b 1e d6 13 0b 00 11 0b 11 07 6f ?? ?? ?? 0a fe 04 13 18 11 18 3a 64 ff ff ff}  //weight: 1, accuracy: Low
        $x_1_2 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LHN_2147799029_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LHN!MTB"
        threat_id = "2147799029"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 08 6f ?? ?? ?? 0a 0d 02 16 16 6f ?? ?? ?? 0a 13 04 09 11 04 28 ?? ?? ?? 0a 13 05 11 05 2c 68 00 06 19 8d ?? ?? ?? 01 25 16 12 03 28 ?? ?? ?? 0a 9c 25 17 12 03 fe ?? ?? ?? ?? ?? 6f ?? ?? ?? ?? 72 ?? ?? ?? ?? 28}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 19 9a 72 ?? ?? ?? ?? 72 ?? ?? ?? ?? 6f ?? ?? ?? ?? 72 ?? ?? ?? ?? 72 ?? ?? ?? ?? 6f ?? ?? ?? ?? 28 ?? ?? ?? ?? d2 9c 25 18 12 03 28 ?? ?? ?? 0a 9c 6f ?? ?? ?? 0a 00 00 00 08 17 58 0c 08 02 6f ?? ?? ?? 0a 13 07 12 07 28 ?? ?? ?? 0a 17 59 fe 02 16 fe 01 13 06 11 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJB_2147799030_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJB!MTB"
        threat_id = "2147799030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "L23d32dLxdm#dedm23" ascii //weight: 1
        $x_1_2 = "LKsnzELKsnznLKsnztryPLKsnzoiLKsnznLKsnzt" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetProperty" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJB_2147799030_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJB!MTB"
        threat_id = "2147799030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0c 08 07 6f ?? ?? ?? 0a 00 08 18 6f ?? ?? ?? 0a 00 08 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0d 09 13 04 2b 00 11 04 2a}  //weight: 10, accuracy: Low
        $x_10_2 = "$02b69cd2-ef96-4d52-b4d9-214a22288d1b" ascii //weight: 10
        $x_1_3 = "GetDomain" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DualSnake" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DLQ_2147799045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLQ!MTB"
        threat_id = "2147799045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "-T-o-W-i-n-3-2-" wide //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = "PU.oo" wide //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DLQ_2147799045_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DLQ!MTB"
        threat_id = "2147799045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$4C086299-8C11-4FE1-94FE-647F364FF155" ascii //weight: 1
        $x_1_2 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_3 = "U8342523534" ascii //weight: 1
        $x_1_4 = "Invoke" wide //weight: 1
        $x_1_5 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 42 6f 6f 6c 65 61 6e 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 52 65 70 6c 61 63 65 00 54 6f 42 79 74 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 43 6f 6d 70 61 72 65 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HV_2147799118_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HV!MTB"
        threat_id = "2147799118"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "papworld.net" ascii //weight: 1
        $x_1_2 = "CaptureScreen" ascii //weight: 1
        $x_1_3 = "CopyFromScreen" ascii //weight: 1
        $x_1_4 = "SendPicBody" ascii //weight: 1
        $x_1_5 = "SendLogBody" ascii //weight: 1
        $x_1_6 = "SendScreenShot" ascii //weight: 1
        $x_1_7 = "HookKeyboard" ascii //weight: 1
        $x_1_8 = "get_CurrentDomain" ascii //weight: 1
        $x_1_9 = "ToBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HV_2147799118_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HV!MTB"
        threat_id = "2147799118"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$fb5aa52f-9f7e-4be4-bcad-866da1716403" ascii //weight: 20
        $x_20_2 = "$10d1161e-f7fe-4e8f-b7c9-518027beaa67" ascii //weight: 20
        $x_20_3 = "$1997c03f-aefa-4e31-9891-8c440661f168" ascii //weight: 20
        $x_20_4 = "$e7927630-ebd0-4a55-a4ff-44427ae66709" ascii //weight: 20
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
        $x_1_11 = "DebuggingModes" ascii //weight: 1
        $x_1_12 = "FromBase64String" ascii //weight: 1
        $x_1_13 = "CreateInstance" ascii //weight: 1
        $x_1_14 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 2 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LLN_2147799125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLN!MTB"
        threat_id = "2147799125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "102"
        strings_accuracy = "High"
    strings:
        $x_30_1 = "dsadfffwtwfffffffgsssssdf.dll#" ascii //weight: 30
        $x_30_2 = "FromBase64" ascii //weight: 30
        $x_30_3 = "GetMethod" ascii //weight: 30
        $x_10_4 = "#hsstadaaadwsssssg.dll#" ascii //weight: 10
        $x_10_5 = "#hsstaaadwsssssg.dll#" ascii //weight: 10
        $x_1_6 = "#fasdgsfsd.dll#" ascii //weight: 1
        $x_1_7 = "#afa.dll#" ascii //weight: 1
        $x_1_8 = "#ssstaaaaaawsssss.dll#" ascii //weight: 1
        $x_1_9 = "#fffdsaswtf.dll#" ascii //weight: 1
        $x_1_10 = "#fsdadsadsdaswdf.dll#" ascii //weight: 1
        $x_1_11 = "#adsadddddddadadaaws.dll#" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_30_*) and 1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((3 of ($x_30_*) and 2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DMD_2147799177_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DMD!MTB"
        threat_id = "2147799177"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 2f 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 08 09 11 04 6f ?? ?? ?? 0a 13 06 17 13 07 00 07 06 02 11 06 28 ?? ?? ?? 06 d2 9c 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d c6}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DMD_2147799177_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DMD!MTB"
        threat_id = "2147799177"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$7da9c783-ce4a-4d73-9c55-b13d11dc6f56" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LMA_2147799280_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LMA!MTB"
        threat_id = "2147799280"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 20 80 00 00 00 6f ?? ?? ?? ?? 1e 8d ?? ?? ?? 01 25 d0 ?? ?? ?? 04 28 ?? ?? ?? 0a 13 06 11 05 11 06 20 e8 03 00 00 73 ?? ?? ?? 0a 0c 06 08 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? ?? 06 08 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 0d 09 06 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LMB_2147799281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LMB!MTB"
        threat_id = "2147799281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$45893d10-b1aa-4de1-b6b5-c7e5a6a37f30" ascii //weight: 1
        $x_1_2 = "C__212314521" ascii //weight: 1
        $x_1_3 = "C__324321" ascii //weight: 1
        $x_1_4 = "ParamXArray" ascii //weight: 1
        $x_1_5 = "ParamXGroup" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "Form1" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LMC_2147799282_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LMC!MTB"
        threat_id = "2147799282"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 6f 6d 70 61 72 65 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "G-e-t-M-e-t-h-o-d" ascii //weight: 1
        $x_1_7 = "--I--n--v--o--k--e--" ascii //weight: 1
        $x_1_8 = "GetObjectValue" ascii //weight: 1
        $x_1_9 = "LateGet" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DMH_2147799362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DMH!MTB"
        threat_id = "2147799362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = " T  o W i n 3 2 " wide //weight: 1
        $x_1_6 = "Transactions.TxFileManager" wide //weight: 1
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 69 73 4f 4b 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DMI_2147799363_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DMI!MTB"
        threat_id = "2147799363"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26 00 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c 09}  //weight: 1, accuracy: Low
        $x_1_3 = {00 53 65 6c 65 63 74 6f 72 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJC_2147799367_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJC!MTB"
        threat_id = "2147799367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cbe2bb98-87bd-464b-b380-e4f41b6320c0" ascii //weight: 1
        $x_1_2 = "000webhostapp.com" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LJE_2147799368_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LJE!MTB"
        threat_id = "2147799368"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {19 62 d2 58 86 11 07 11 0b 1b d6 6f ?? ?? ?? 0a 18 62 d2 58 86 11 07 11 0b 1c d6 6f ?? ?? ?? 0a 17 62 d2 58 86 11 07 11 0b 1d d6 6f ?? ?? ?? 0a 58 86 6f ?? ?? ?? 0a 00 11 0b 1e d6 13 0b 00 11 0b 11 07 6f 6f ?? ?? ?? fe 04 13 18 11 18 3a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LLZ_2147799369_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLZ!MTB"
        threat_id = "2147799369"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 12 02 28 ?? ?? ?? 0a 69 28 ?? ?? ?? 0a 07 17 58 0b 07 02 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {70 00 6f 00 77 00 65 00 72 00 73 00 68 00 65 00 6c 00 6c 00 00 3d 54 00 65 00 73 00 74 00 2d 00 43 00 6f 00 6e 00 6e 00 65 00 63 00 74 00 69 00 6f 00 6e 00 20 00 77 00 77 00 77 00 2e 00 67 00 6f 00 6f}  //weight: 1, accuracy: High
        $x_1_3 = "System.Reflection.Assembly" ascii //weight: 1
        $x_1_4 = "Test-Connection www.bing.com" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LLC_2147799370_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLC!MTB"
        threat_id = "2147799370"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "B6824BD4-3E2A-4E2F-814F-D30DA3A3580A" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LLO_2147799371_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLO!MTB"
        threat_id = "2147799371"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "a077fb59-b64a-4605-b971-28cc63eb3211" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LLP_2147799372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLP!MTB"
        threat_id = "2147799372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 0b 07 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0b 06 07 16 07 8e 69 6f ?? ?? ?? 0a 06 0c de 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "edom SOD ni nur eb tonnac" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HQ_2147799395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HQ!MTB"
        threat_id = "2147799395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Stub.Resources" ascii //weight: 1
        $x_1_2 = "ClassLibrary1.RunPE" ascii //weight: 1
        $x_1_3 = "//pastebin.com/raw.php?i=" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "Inject" ascii //weight: 1
        $x_1_8 = "cmd.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SML_2147799421_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SML!MTB"
        threat_id = "2147799421"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 09 91 11 06 61 11 08 59 20 00 02 00 00 58 20 00 01 00 00 5d 20 00 04 00 00 58 20 00 02 00 00 5d 13 0a 16 13 10 2b 14 11 0a 11 10 5a 1d 58 20 00 01 00 00 5d 26 11 10 17 58 13 10 11 10 19 32 e7}  //weight: 1, accuracy: High
        $x_1_2 = "G5ZPEF865HC88G0GCD4GD0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SML_2147799421_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SML!MTB"
        threat_id = "2147799421"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HF44P78RZ48JUYIBGG54P4" ascii //weight: 1
        $x_1_2 = {08 5d 13 11 07 11 11 91 13 12 11 12 11 09 61 13 13 11 13 20 00 04 00 00 58 13 14 11 14 20 00 04 00 00 59 13 15 11 15 11 0f 59}  //weight: 1, accuracy: High
        $x_1_3 = {19 08 5d 13 1a 07 11 1a 91 13 1b 11 1b 11 12 61 13 1c 11 1c 20 00 04 00 00 58 13 1d 11 1d 20 00 04 00 00 59 13 1e 11 1e 11 18 59 13 1f 11 1f 20 00 02 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Trojan_MSIL_AgentTesla_SML_2147799421_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SML!MTB"
        threat_id = "2147799421"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5AXBJZ78H857Y54D77XJP8" ascii //weight: 1
        $x_1_2 = "CheckBoxStudio.WinForms.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = {00 02 09 11 06 28 21 00 00 06 13 07 02 11 06 08 28 22 00 00 06 13 08 02 07 11 08 08 28 23 00 00 06 13 09 02 07 11 06 08 11 07 11 09 28 24 00 00 06}  //weight: 1, accuracy: High
        $x_1_4 = "$cb0c8d54-14d1-4f55-b655-d846e757fe2f" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LMD_2147799493_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LMD!MTB"
        threat_id = "2147799493"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 33 07 08 6f ?? ?? ?? 0a 6c 23 ?? ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 13 04 12 04 28 ?? ?? ?? 0a 0d 06 09 6f ?? ?? ?? 0a 26 08 17 d6 0c 08 07 6f ?? ?? ?? 0a 32 c4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LNH_2147799494_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LNH!MTB"
        threat_id = "2147799494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_3 = "CompareString" ascii //weight: 1
        $x_1_4 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = {00 53 65 65 65 65 65 00}  //weight: 1, accuracy: High
        $x_1_7 = "ToString" ascii //weight: 1
        $x_1_8 = "GetObjectValue" ascii //weight: 1
        $x_1_9 = "LateGet" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPA_2147799506_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPA!MTB"
        threat_id = "2147799506"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 09 11 04 11 05 28 ?? ?? ?? 06 13 06 08 07 02 11 06 28 ?? ?? ?? 06 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 07 11 07 2d d4}  //weight: 1, accuracy: Low
        $x_1_2 = "T0o0Wi0n0302" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPC_2147799507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPC!MTB"
        threat_id = "2147799507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 20 00 02 08 09 11 04 28 ?? ?? ?? 06 13 05 07 06 02 11 05 28 ?? ?? ?? 06 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 06 11 06 2d d5}  //weight: 1, accuracy: Low
        $x_1_2 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DMA_2147799508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DMA!MTB"
        threat_id = "2147799508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = " T  o W i n 3 2 " wide //weight: 1
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = "PU.oo" wide //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DNC_2147799528_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNC!MTB"
        threat_id = "2147799528"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c 09 15}  //weight: 1, accuracy: Low
        $x_1_3 = {00 53 65 6c 65 63 74 6f 72 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPJ_2147799593_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPJ!MTB"
        threat_id = "2147799593"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#hdfsafaaaadadsadfffwtwfffffffgsssssdf.dll#" ascii //weight: 1
        $x_1_2 = "#ddshsstadaaadwsssssg.dll#" ascii //weight: 1
        $x_1_3 = "#agffa.dll#" ascii //weight: 1
        $x_1_4 = "#f.dgdddll#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPB_2147805114_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPB!MTB"
        threat_id = "2147805114"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "T0o0Wi0n0302" ascii //weight: 10
        $x_10_2 = "L0o0a0d0" ascii //weight: 10
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ColorTranslator" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LPN_2147805132_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPN!MTB"
        threat_id = "2147805132"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 1c 02 11 04 06 07 28 ?? ?? ?? 06 13 05 09 08 02 11 05 28 ?? ?? ?? 06 d2 9c 07 17 58 0b 07 17 fe 04 13 06 11 06 2d da}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DNV_2147805173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNV!MTB"
        threat_id = "2147805173"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "T0o0Wi0n0302" wide //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ColorTranslator" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DNZ_2147805174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNZ!MTB"
        threat_id = "2147805174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$b50d3fc9-dd48-48ed-a31f-d17a39344028" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "T0o0Wi0n0302" wide //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ColorTranslator" ascii //weight: 1
        $x_1_8 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HP_2147805213_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HP!MTB"
        threat_id = "2147805213"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 02 72 75 00 00 70 6f ?? ?? ?? 0a 2c 3e 06 02 6f ?? ?? ?? 0a 0b 07 16 73 ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 08 09 28 ?? ?? ?? 06 09 16 6a 6f ?? ?? ?? 0a 09 13 04 de 1c}  //weight: 1, accuracy: Low
        $x_1_2 = ".compressed" ascii //weight: 1
        $x_1_3 = "clientcore" ascii //weight: 1
        $x_1_4 = "costura" ascii //weight: 1
        $x_1_5 = "Dropbox.Api" ascii //weight: 1
        $x_1_6 = "DcSvc" ascii //weight: 1
        $x_1_7 = "RBSvc" ascii //weight: 1
        $x_1_8 = "RuntimeBroker" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPI_2147805234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPI!MTB"
        threat_id = "2147805234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 11 06 16 73 ?? ?? ?? 0a 13 08 00}  //weight: 1, accuracy: Low
        $x_1_2 = {03 8e 69 17 59 17 58 17 59 17 58 8d ?? ?? ?? 01 13 09 11 08 11 09 16 03 8e 69 6f ?? ?? ?? 0a 13 0a 11 09 11 0a 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0c 00 de 0d}  //weight: 1, accuracy: Low
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "cipher" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DOC_2147805253_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DOC!MTB"
        threat_id = "2147805253"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 1e 02 08 09 11 04 28 ?? ?? ?? 06 13 05 07 06 02 11 05 28 ?? ?? ?? 06 d2 9c 11 04 17 58 13 04 11 04 17 32 dd 06 17 58 0a 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DOB_2147805254_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DOB!MTB"
        threat_id = "2147805254"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 75 ?? ?? ?? 1b 09 91 61}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 59 91 1f 70 61 0b}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 65 6c 65 63 74 6f 72 58 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPA_2147805323_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPA!MTB"
        threat_id = "2147805323"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {16 0b 2b 2e 02 11 05 06 07 28 e1 00 00 06 13 07 11 06 13 09 11 09 13 08 11 08 1f 17 2e 02 2b 02 2b 0c 09 08 02 11 07 28 e0 00 00 06 d2 9c 07 17 58 0b 07 17 fe 04 13 0a 11 0a 2d c8 08 17 58 0c 06 17 58 0a 06 20 00 80 00 00 fe 04 13 0b 11 0b 2d ae}  //weight: 1, accuracy: High
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ColorTranslator" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPH_2147805351_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPH!MTB"
        threat_id = "2147805351"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$2973987a-52bf-4adf-b2df-ebcbbfc905f9" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPM_2147805352_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPM!MTB"
        threat_id = "2147805352"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$a7a8527c-37ae-443b-8daa-61001cbd2658" ascii //weight: 1
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "ColorTranslator" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPQ_2147805353_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPQ!MTB"
        threat_id = "2147805353"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 08 09 11 04 28 ?? ?? ?? 06 13 05 17 13 06 07 06 02 11 05 28 ?? ?? ?? 06 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d d2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQB_2147805354_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQB!MTB"
        threat_id = "2147805354"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#ddshsstadaaadwsssssg.dll#" ascii //weight: 1
        $x_1_2 = "#fasdfgsfsd.dll#" ascii //weight: 1
        $x_1_3 = "#hkkkkkh#" ascii //weight: 1
        $x_1_4 = "#fljgaf.dll#" ascii //weight: 1
        $x_1_5 = "#f.dgddjkdll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DOL_2147805374_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DOL!MTB"
        threat_id = "2147805374"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 24 00 02 09 11 04 11 05 28 ?? ?? ?? 06 13 06 17 13 07 08 07 02 11 06 28 ?? ?? ?? 06 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d d1 07 17 58 0b 00 11 04 17 58 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DOI_2147805375_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DOI!MTB"
        threat_id = "2147805375"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 42 53 54 52 4d 61 72 73 68 61 6c 65 72 00 63 79 7a 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 46 4c 75 78 43 65 6e 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 4f 62 6a 65 63 74 49 64 65 6e 74 69 66 69 65 72 00 78 73 61 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4c 65 76 65 6c 00 70 6f 00 4c 6f 61 64 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DOK_2147805376_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DOK!MTB"
        threat_id = "2147805376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 6c 23 00 ba f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DNA_2147805393_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNA!MTB"
        threat_id = "2147805393"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 6c 23 00 ba f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 13 05 07 11 05 6f ?? ?? ?? 0a 26 00 09 17 d6 0d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DNB_2147805394_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNB!MTB"
        threat_id = "2147805394"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 74 ?? ?? ?? 1b 09 91 61 d2 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "$9fb8206e-400f-4360-9579-09611a7bfa65" ascii //weight: 1
        $x_1_3 = "GZipStream" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DNG_2147805396_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNG!MTB"
        threat_id = "2147805396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 06 03 08 17 58 03 8e 69 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 08 17 58 0c 08 6a 03 8e 69 17 59 6a 06 17 58 6e 5a}  //weight: 1, accuracy: Low
        $x_1_2 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQA_2147805540_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQA!MTB"
        threat_id = "2147805540"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 6c 23 ?? ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQI_2147805638_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQI!MTB"
        threat_id = "2147805638"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 2b 35 00 02 09 11 04 11 05 28 ?? ?? ?? 06 13 07 11 06 13 09 11 09 13 08 11 08 1f 17 2e 02 2b 02 2b 0e 08 07 02 11 07 28 ?? ?? ?? 06 d2 9c 2b 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0a 11 0a 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQL_2147805639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQL!MTB"
        threat_id = "2147805639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 21 02 08 09 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 06 11 05 28 ?? ?? ?? 0a 9c 11 04 17 58 13 04 11 04 17 32 da}  //weight: 1, accuracy: Low
        $x_1_2 = "BSTRMarshaler" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQL_2147805639_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQL!MTB"
        threat_id = "2147805639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 1f 20 06 6f ?? ?? ?? 0a 8e 69 1f 20 59 6f ?? ?? ?? 0a 13 04 06 16 6a 6f ?? ?? ?? 0a 06 11 04 16 11 04 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 1f 10 6a 59 17 6a 58 d4 8d ?? ?? ?? 01 13 07 11 06 11 07 16 11 07 8e 69 6f ?? ?? ?? 0a 8d ?? ?? ?? 01 13 08 11 07 16 11 08 16 11 08 8e 69 28 ?? ?? ?? 0a 11 08 13 09}  //weight: 1, accuracy: Low
        $x_1_3 = "AesCryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "AreEqual" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQT_2147805738_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQT!MTB"
        threat_id = "2147805738"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 2b 1f 02 11 04 06 07 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 09 08 11 05 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 17 32 dd}  //weight: 10, accuracy: Low
        $x_10_2 = {16 13 04 2b 27 00 02 08 09 11 04 28 ?? ?? ?? 06 13 05 11 05 28 ?? ?? ?? 0a 13 06 07 06 11 06 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d ce}  //weight: 10, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DNX_2147805856_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DNX!MTB"
        threat_id = "2147805856"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 42 53 54 52 4d 61 72 73 68 61 6c 65 72 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 46 4c 75 78 43 65 6e 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 4f 62 6a 65 63 74 49 64 65 6e 74 69 66 69 65 72 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DOD_2147805857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DOD!MTB"
        threat_id = "2147805857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$727cef7b-753b-45ea-bae6-4920f9e954d3" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "ToInt32" ascii //weight: 1
        $x_1_6 = "AssemblyCopyright" ascii //weight: 1
        $x_1_7 = "AssemblyTrademark" ascii //weight: 1
        $x_1_8 = "AssemblyCompany" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DPC_2147805858_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DPC!MTB"
        threat_id = "2147805858"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 26 00 08 09 11 04 28 ?? ?? ?? 06 13 05 11 05 28 ?? ?? ?? 0a 13 06 07 06 11 06 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d cf 06 17 58 0a 00 09 17 58 0d 09 20 00 56 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DPA_2147805859_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DPA!MTB"
        threat_id = "2147805859"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 43 46 30 30 31 32 33 31 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 46 32 33 34 30 35 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 46 33 32 31 34 38 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 46 33 34 32 34 32 33 35 36 36 35 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_9 = "TxFileManager" wide //weight: 1
        $x_1_10 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DPB_2147805860_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DPB!MTB"
        threat_id = "2147805860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {08 07 02 07 91 11 04 61 09 06 91 61 28 ?? ?? ?? 0a 9c 06 03 6f ?? ?? ?? 0a 17 59 33 04 16 0a 2b 04 06 17 58 0a 07 17 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DPE_2147805861_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DPE!MTB"
        threat_id = "2147805861"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "G%e%t%M%e%t%h%o%d" wide //weight: 1
        $x_1_2 = "@I@n@v@o@k@e@" wide //weight: 1
        $x_1_3 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = "Bunifu_TextBox" wide //weight: 1
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 41 63 63 6f 75 6e 74 44 6f 6d 61 69 6e 53 69 64 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQD_2147805909_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQD!MTB"
        threat_id = "2147805909"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 6c 23 ?? ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 13 06 12 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b [0-2] 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQE_2147805910_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQE!MTB"
        threat_id = "2147805910"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_2 = {7b 00 7e 00 a6 00 77 00 5f 00 5f 00 71 00 5f 00 5f 00 5f 00 5f 00 65}  //weight: 1, accuracy: High
        $x_1_3 = {5f 00 45 00 45 00 52 00 5f 00 5f 00 70 00 97 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 77 00 5f 00 5f 00 5f 00 5f}  //weight: 1, accuracy: High
        $x_1_4 = {4c 00 96 00 ac 00 97 00 4c 00 5f 00 aa 00 5f 00 a2 00 73 00 6b 00 90 00 97 00 61 00 7b 00 71 00 47 00 99 00 7e 00 68 00 99 00 a5}  //weight: 1, accuracy: High
        $x_1_5 = {61 00 77 00 78 00 77 00 5f 00 5f 00 7b 00 5f 00 65 00 64 00 5f 00 68 00 49 00 6e 00 9f 00 80 00 65 00 5f}  //weight: 1, accuracy: High
        $x_1_6 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQJ_2147805911_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQJ!MTB"
        threat_id = "2147805911"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetPixel" ascii //weight: 1
        $x_1_2 = "FLuxCenter" ascii //weight: 1
        $x_1_3 = "ObjectIdentifier" ascii //weight: 1
        $x_1_4 = {00 78 73 61 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = "BSTRMarshaler" ascii //weight: 1
        $x_1_7 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_QP_2147806128_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.QP!MTB"
        threat_id = "2147806128"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0d 09 08 6f ?? ?? ?? 0a 00 09 18 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 06 16 06 8e 69 6f ?? ?? ?? 0a 13 04 11 04 02}  //weight: 10, accuracy: Low
        $x_1_2 = "H4FZTGCX87X48BF74GB588" ascii //weight: 1
        $x_1_3 = "ToBase64String" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WLD_2147806144_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WLD!MTB"
        threat_id = "2147806144"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 5d 91 07 06 1a 58 4a 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03 06 1a 58 4a 17 58 03 8e 69 5d 91 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 06 1a 58 06 1a 58 4a 17 58 54}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQC_2147806253_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQC!MTB"
        threat_id = "2147806253"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://pfsbankgroup.com/" ascii //weight: 1
        $x_1_2 = "UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBTAGUAYwBvAG4AZABzACAAMQAuADUA" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "powershell" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LQR_2147806254_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LQR!MTB"
        threat_id = "2147806254"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 5d 91 07 06 1a 58 4a 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03 06 1a 58 4a 17 58 03 8e 69 5d 91 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 06 1a 58 06 1a 58 4a 17 58 54}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRA_2147806255_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRA!MTB"
        threat_id = "2147806255"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 23 02 11 04 06 07 28 ?? ?? ?? 06 13 05 11 05 28 ?? ?? ?? 0a 13 06 09 08 11 06 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 17 fe 04 13 07 11 07 2d d3}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRB_2147806256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRB!MTB"
        threat_id = "2147806256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_2 = "ColorTranslator" ascii //weight: 1
        $x_1_3 = {00 43 46 33 34 32 34 32 33 35 36 36 35 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 46 30 30 31 32 33 31 00}  //weight: 1, accuracy: High
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = {00 43 46 32 33 34 30 35 32 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 43 46 33 32 31 34 38 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_10 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRC_2147806257_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRC!MTB"
        threat_id = "2147806257"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ae72b6b0-eae6-4c06-a212-e79eeccda8cd" ascii //weight: 1
        $x_1_2 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = "CompareString" ascii //weight: 1
        $x_1_5 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetObjectValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPD_2147806289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPD!MTB"
        threat_id = "2147806289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 07 09 8f 59 00 00 01 72 fd 01 00 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 17 58 0d 09 07 8e 69 32 de}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRH_2147806291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRH!MTB"
        threat_id = "2147806291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 27 00 08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 17 13 09 00 07 06 11 08 d2 9c 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d ce}  //weight: 1, accuracy: Low
        $x_1_2 = "EX00001" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRM_2147806411_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRM!MTB"
        threat_id = "2147806411"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 2b 4e 00 09 11 04 11 05 28 ?? ?? ?? 06 13 07 11 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 11 07 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 13 08 17 13 09 00 08 07 11 08 d2 9c 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0a 11 0a 2d a7}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRS_2147806412_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRS!MTB"
        threat_id = "2147806412"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "hfffafasrdadsatrfffffffffddf" ascii //weight: 1
        $x_1_2 = "#fasdfgsfffsd.dll#" ascii //weight: 1
        $x_1_3 = ".dgddjkdll#" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "CheckRemoteDebuggerPresent" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DQY_2147807202_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DQY!MTB"
        threat_id = "2147807202"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 17 13 0a 00 08 07 11 09 d2 9c 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0b 11 0b 2d cd}  //weight: 1, accuracy: Low
        $x_1_2 = {00 45 58 30 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 45 58 30 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DQZ_2147807203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DQZ!MTB"
        threat_id = "2147807203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 02 11 03 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = {11 02 11 04 02 11 04 91 11 05 61 11 00 11 03 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRI_2147807204_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRI!MTB"
        threat_id = "2147807204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = " GetMethod " wide //weight: 1
        $x_1_3 = " Invoke " wide //weight: 1
        $x_1_4 = " Bunifu_TextBox " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSC_2147807253_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSC!MTB"
        threat_id = "2147807253"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 1f 11 06 07 08 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 11 04 09 11 09 d2 9c 08 17 58 0c 08 17 fe 04 13 0a 11 0a 2d d7}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSB_2147807254_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSB!MTB"
        threat_id = "2147807254"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fshdfhkhfffdfdfafasrdadsatrfffffffffddf" ascii //weight: 1
        $x_1_2 = "mynamespvvvvvvvvvvvvvvvace" ascii //weight: 1
        $x_1_3 = "fsdsdfkhkhsfdfdaddddgaaaaadwreeegfsdf" ascii //weight: 1
        $x_1_4 = "Macccccccin" ascii //weight: 1
        $x_1_5 = "#fkasdfgffgsfffsd.dll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRH_2147807299_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRH!MTB"
        threat_id = "2147807299"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = " GetMethod " wide //weight: 1
        $x_1_2 = " Invoke " wide //weight: 1
        $x_1_3 = {00 54 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 30 30 30 34 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 30 30 30 35 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 00}  //weight: 1, accuracy: High
        $x_1_10 = " Bunifu_TextBox " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRM_2147807300_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRM!MTB"
        threat_id = "2147807300"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggingModes" ascii //weight: 1
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_7 = "$c27a2ae3-1cf3-473b-8f74-7d84fdeced17" ascii //weight: 1
        $x_1_8 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 65 72 42 72 6f 77 73 61 62 6c 65 53 74 61 74 65 00}  //weight: 1, accuracy: High
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRE_2147807332_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRE!MTB"
        threat_id = "2147807332"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 06 03 07 6f ?? ?? ?? 0a 0d 12 03 28 ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 0a 07 17 58 0b 00 17 13 04 2b d7}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 06 61 20 ?? ?? ?? 01 5a 0a 07 17 58 0b 07 02 6f}  //weight: 1, accuracy: Low
        $x_1_3 = "WPFlindao" ascii //weight: 1
        $x_1_4 = "CalcMatriz" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRI_2147807333_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRI!MTB"
        threat_id = "2147807333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_2 = "ColorTranslator" ascii //weight: 1
        $x_1_3 = {00 45 78 30 30 30 30 36 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 58 30 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 45 58 30 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_10 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRJ_2147807334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRJ!MTB"
        threat_id = "2147807334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 00 09 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 00 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 13 04 11 04 07 20 ?? ?? ?? 00 73 ?? ?? ?? 0a 13 05 09 11 05 09 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 09 11 05 09 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 09 17 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "hdfsdsf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRL_2147807335_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRL!MTB"
        threat_id = "2147807335"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 54 30 30 30 34 00}  //weight: 1, accuracy: High
        $x_1_3 = "CompareString" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = {00 54 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "GetObjectValue" ascii //weight: 1
        $x_1_9 = "CreateInstance" ascii //weight: 1
        $x_1_10 = {00 54 30 30 30 35 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRJ_2147807394_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRJ!MTB"
        threat_id = "2147807394"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = " GetMethod " wide //weight: 1
        $x_1_2 = " Invoke " wide //weight: 1
        $x_1_3 = {00 54 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 30 30 30 34 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 30 30 30 35 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 52 41 57 00 41 63 63 6f 75 6e 74 44 6f 6d 61 69 6e 53 69 64 00}  //weight: 1, accuracy: High
        $x_1_10 = " Bunifu_TextBox " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRQ_2147807395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRQ!MTB"
        threat_id = "2147807395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 22 00 08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 06 11 08 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d d3 06 17 58 0a 00 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRQ_2147807395_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRQ!MTB"
        threat_id = "2147807395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 04 2b 26 00 08 09 11 04 28 ?? ?? ?? 06 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 11 07 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d cf 06 17 58 0a 00 09 17 58 0d}  //weight: 10, accuracy: Low
        $x_10_2 = {16 0c 2b 1f 11 05 07 08 28 ?? ?? ?? 06 13 06 11 06 28 ?? ?? ?? 0a 13 07 11 04 09 11 07 d2 9c 08 17 58 0c 08 17 fe 04 13 08 11 08 2d d7 09 17 58 0d 07 17 58 0b}  //weight: 10, accuracy: Low
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DRR_2147807396_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRR!MTB"
        threat_id = "2147807396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c 09 03 6f ?? ?? ?? 0a 17 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRR_2147807396_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRR!MTB"
        threat_id = "2147807396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 06 11 08 d2 9c 00 11 04 17 58 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRP_2147807397_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRP!MTB"
        threat_id = "2147807397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 23 00 09 11 04 11 05 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 08 07 11 09 d2 9c 00 11 05 17 58 13 05 11 05 17 fe 04 13 0a 11 0a 2d d2 07 17 58 0b 00 11 04 17 58 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = {00 45 58 30 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 45 58 30 30 30 30 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRN_2147807413_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRN!MTB"
        threat_id = "2147807413"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_2 = "ColorTranslator" ascii //weight: 1
        $x_1_3 = {00 45 78 30 30 30 30 36 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 58 30 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 45 58 30 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRO_2147807414_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRO!MTB"
        threat_id = "2147807414"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 10, accuracy: High
        $x_1_2 = {00 54 30 30 30 34 00}  //weight: 1, accuracy: High
        $x_1_3 = "CompareString" ascii //weight: 1
        $x_1_4 = {00 54 30 30 30 35 00}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = {00 54 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "GetObjectValue" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LRQ_2147807415_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRQ!MTB"
        threat_id = "2147807415"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 1f 11 06 07 08 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 05 09 11 08 d2 9c 08 17 58 0c 08 17 fe 04 13 09 11 09 2d d7}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSA_2147807416_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSA!MTB"
        threat_id = "2147807416"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$5ee49b32-5c53-4d76-81e3-bb2f60db6ccc" ascii //weight: 1
        $x_1_2 = "SuspendLayout" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSL_2147807451_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSL!MTB"
        threat_id = "2147807451"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 0b 07 0a 2b 00 06 2a}  //weight: 1, accuracy: High
        $x_1_3 = {64 00 5f 00 ac 00 5f 00 5f 00 71 00 5f 00 4c 00 62 00 5f 00 b3 00 5f}  //weight: 1, accuracy: High
        $x_1_4 = "T0003" ascii //weight: 1
        $x_1_5 = "core981324" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRT_2147807554_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRT!MTB"
        threat_id = "2147807554"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 07 9a 13 08 00 02 11 08 28 ?? ?? ?? 06 17 fe 04 16 fe 01 13 09 11 09 2c 1e 00 11 08 28 ?? ?? ?? 0a 13 0a 11 0a 28 ?? ?? ?? 0a 13 0b 11 05 11 0b 6f ?? ?? ?? 0a 00 00 00 11 07 17 58 13 07 11 07 11 06 8e 69 32 b7}  //weight: 1, accuracy: Low
        $x_1_2 = "\\@@##G\\@@##e\\@@##t\\@@##T\\@@##y\\@@##p\\@@##e\\@@##" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSE_2147807577_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSE!MTB"
        threat_id = "2147807577"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BZXBZBVBBBVBBVZXBVBBBXVVBXVBXZVBXZVBXZ" ascii //weight: 1
        $x_1_2 = "VBXZVBXZVBXVBBVBXXVBXVBXZVXZWWWRWRWWEWEWSFSSSVBHHFHFHFHF" ascii //weight: 1
        $x_1_3 = {49 00 47 00 4e 00 68 00 62 00 6d 00 35 00 76 00 64 00 43 00 42 00 69 00 5a 00 53 00 42 00 79 00 64 00 57 00 34 00 67 00 61}  //weight: 1, accuracy: High
        $x_1_4 = {49 00 67 00 49 00 44 00 66 00 52 00 34 00 ae 00 60 00 ae 00 60 00 ae 00 60 00 51 00 71 00 ae 00 60 00 ae 00 60 00 ae 00 60 00 ae 00 60 00 4d 00 67}  //weight: 1, accuracy: High
        $x_1_5 = {b6 00 60 00 a9 00 60 00 71 00 51 00 ae 00 60 00 ae 00 60 00 4d 00 ae 00 60 00 ae 00 60 00 ae 00 60 00 ae 00 60 00 45 00 ae}  //weight: 1, accuracy: High
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSM_2147807579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSM!MTB"
        threat_id = "2147807579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 54 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 30 30 30 34 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 30 30 30 35 00}  //weight: 1, accuracy: High
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "Bunifu" ascii //weight: 1
        $x_1_9 = "extBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSQ_2147807638_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSQ!MTB"
        threat_id = "2147807638"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 0a 2b 00 06 2a}  //weight: 1, accuracy: High
        $x_1_2 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_3 = {00 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 00}  //weight: 1, accuracy: High
        $x_1_4 = {5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 64 00 5f 00 ac 00 5f 00 5f 00 71 00 5f 00 4c 00 62 00 5f 00 b3 00 5f 00 97 00 70 00 5f 00 65 00 64 00 5f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSP_2147807639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSP!MTB"
        threat_id = "2147807639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 27 00 09 11 04 11 05 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 08 11 08 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d ce 07 17 58 0b 00 11 04 17 58}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMSA_2147807693_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMSA!MTB"
        threat_id = "2147807693"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 17 d2 13 2f 11 17 1e 63 d1 13 17 11 1e 11 09 91 13 21 11 1e 11 09 11 24 11 21 61 19 11 18 58 61 11 2f 61 d2 9c 17 11 09 58 13 09 11 21 13 18 11 09 11 26 32 a4}  //weight: 5, accuracy: High
        $x_5_2 = {11 32 11 13 11 11 11 13 91 9d 17 11 13 58 13 13 11 13 11 1b 32 ea}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DSM_2147807724_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DSM!MTB"
        threat_id = "2147807724"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DSD_2147807725_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DSD!MTB"
        threat_id = "2147807725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0c 2b 22 11 06 07 08 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 04 11 08 d2 6f ?? ?? ?? 0a 08 17 58 0c 08 17 fe 04 13 09 11 09 2d d4 09 17 58 0d 07 17 58 0b}  //weight: 10, accuracy: Low
        $x_10_2 = {16 13 06 2b 28 00 11 04 11 05 11 06 28 ?? ?? ?? 06 13 09 11 09 28 ?? ?? ?? 0a 13 0a 09 11 0a d2 6f ?? ?? ?? 0a 00 00 11 06 17 58 13 06 11 06 17 fe 04 13 0b 11 0b 2d cd 08 17 58 0c 00 11 05 17 58 13 05}  //weight: 10, accuracy: Low
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LTA_2147807795_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTA!MTB"
        threat_id = "2147807795"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 06 2b 28 00 11 04 11 05 11 06 28 ?? ?? ?? 06 13 09 11 09 28 ?? ?? ?? 0a 13 0a 09 11 0a d2 6f ?? ?? ?? 0a 00 00 11 06 17 58 13 06 11 06 17 fe 04 13 0b 11 0b 2d cd}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTD_2147807796_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTD!MTB"
        threat_id = "2147807796"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Progrffffffffffam" ascii //weight: 1
        $x_1_2 = "#gsdggggggg#" ascii //weight: 1
        $x_1_3 = "afsfa#kjd#" ascii //weight: 1
        $x_1_4 = "#fasfsaf.dll#" ascii //weight: 1
        $x_1_5 = "#fasgag.dll#" ascii //weight: 1
        $x_1_6 = "#gdfsfds.dll#" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTE_2147807797_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTE!MTB"
        threat_id = "2147807797"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 2b 1f 11 06 07 08 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 04 09 11 08 d2 9c 08 17 58 0c 08 17 fe 04 13 09 11 09 2d d7}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTH_2147807901_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTH!MTB"
        threat_id = "2147807901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 26 00 08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d cf}  //weight: 1, accuracy: Low
        $x_1_2 = {00 4d 38 33 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 4d 38 34 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 4d 38 35 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTI_2147807902_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTI!MTB"
        threat_id = "2147807902"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = {02 6c 23 ff ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "Bunifu_T" ascii //weight: 1
        $x_1_5 = "extBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTK_2147807903_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTK!MTB"
        threat_id = "2147807903"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#gsdggdsadsadggggg#" ascii //weight: 1
        $x_1_2 = "#fsdgdsdsdsd.dll#" ascii //weight: 1
        $x_1_3 = "#fasfdddddddddssaf.dll#" ascii //weight: 1
        $x_1_4 = "#fasfddddddddssaf.dll#" ascii //weight: 1
        $x_1_5 = "#fasfdaaaaaaaadsssaf.dll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CHRM_2147807924_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CHRM!MTB"
        threat_id = "2147807924"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 16 13 05 2b 27 00 09 11 04 11 05 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 08 11 08 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d ce 07 17 58 0b 00 11 04 17 58 13 04 11 04 20 00 72 00 00 fe 04 13 0a 11 0a 2d ae}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DTO_2147808054_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DTO!MTB"
        threat_id = "2147808054"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 74 ?? ?? ?? 1b 09 91 61 20 9e 03 00 00 20 f0 03 00 00}  //weight: 1, accuracy: Low
        $x_1_2 = {02 08 18 20 96 00 00 00 20 a4 00 00 00 28 ?? ?? ?? 2b 1f 10 1f 3a 1f 26 28 ?? ?? ?? 2b 84}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DTN_2147808055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DTN!MTB"
        threat_id = "2147808055"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 05 2b 27 00 09 11 04 11 05 28 ?? ?? ?? 06 13 06 11 06 28 ?? ?? ?? 0a 13 07 08 11 07 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d ce 07 17 58 0b 00 11 04 17 58 13 04}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSN_2147808058_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSN!MTB"
        threat_id = "2147808058"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 1f 11 05 07 08 28 ?? ?? ?? 06 13 06 11 06 28 ?? ?? ?? 0a 13 07 11 04 09 11 07 d2 9c 08 17 58 0c 08 17 fe 04 13 08 11 08 2d d7}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LSR_2147808059_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LSR!MTB"
        threat_id = "2147808059"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 5a 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 5f 4a 4a 30 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 5f 4a 4a 31 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 5f 4a 4a 34 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 5f 4a 4a 35 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 5f 4a 4a 36 00}  //weight: 1, accuracy: High
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "Bunifu_T" ascii //weight: 1
        $x_1_9 = "extBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTC_2147808060_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTC!MTB"
        threat_id = "2147808060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$d7f84578-7a48-40f5-a225-b916dbf3d983" ascii //weight: 1
        $x_1_2 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTM_2147808079_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTM!MTB"
        threat_id = "2147808079"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 28 11 04 06 07 6f ?? ?? ?? 0a 26 11 04 06 07 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 09 08 11 06 d2 9c 07 17 58 0b 07 17 fe 04 13 07 11 07 2d ce}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTN_2147808080_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTN!MTB"
        threat_id = "2147808080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 2b 29 00 09 11 04 11 05 28 ?? ?? ?? 06 13 09 11 09 28 ?? ?? ?? 0a 13 0a 08 11 04 11 0a d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0b 11 0b 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTN_2147808080_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTN!MTB"
        threat_id = "2147808080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$c2808ccb-5ae8-48e8-add6-1570f353a9d0" ascii //weight: 1
        $x_1_2 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 65 72 4e 6f 6e 55 73 65 72 43 6f 64 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DRS_2147808167_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DRS!MTB"
        threat_id = "2147808167"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$407786d2-78b3-48aa-8a95-ed7a6df6560a" ascii //weight: 10
        $x_10_2 = "$020049f4-6dad-4ed4-b0d7-2bd651d2856f" ascii //weight: 10
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DSL_2147808168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DSL!MTB"
        threat_id = "2147808168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$c8a6f40c-fc98-41b3-b9b4-7a63f418ff12" ascii //weight: 10
        $x_10_2 = "$020049f4-6dad-4ed4-b0d7-2bd651d2856f" ascii //weight: 10
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_HDMI_2147808169_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HDMI!MTB"
        threat_id = "2147808169"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0e 0b b7 c7 cb 1e af 8f fc fb 19 4c d9 7f e0 05 f4 13 ef c4 50 a9 18 39 e9 4f fe b6 c7 fb 1e a3 bf ff ca bf 07 66 dc f0 9c 7e ec f7 1d 2f 10 6b a7 8e 27 7f 9d fe 0c b6 bd c4 fa 99 7f 0f 4c fd}  //weight: 1, accuracy: High
        $x_1_2 = {7e d3 f1 fc 51 10 ef 77 7c 9d b0 fd ad b6 7c f1 96 fe}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DTR_2147808170_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DTR!MTB"
        threat_id = "2147808170"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 53 74 72 52 65 76 65 72 73 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DTQ_2147808171_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DTQ!MTB"
        threat_id = "2147808171"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {72 84 6f c6 86 d4 9f fc 8c 67 91 2f f5 86 ee 0e dc 75 22 83 7a 5b a7 d1 47 ec 29 fc 23 57 ea 09 7f e3 ac e7 97 a5 27 fe 7b 92 27 7e fd ea 19 3f}  //weight: 1, accuracy: High
        $x_1_2 = {72 a7 ac f1 81 6f f9 78 86 6f 9e c6 26 cf c8 63 fc e9 67 da 11 f9 a3 97 d3 98 dd 90 ef 3a be 5b 9f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DTG_2147808172_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DTG!MTB"
        threat_id = "2147808172"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {d1 2f 7a 5f ab 8f 7d 9c d4 7a 5f 1a 7d 2e e5 03 d1 33 cf 05 44 ff 39 1e 62 a7 a9 6f ca d3 df 69 e7 b5 7e 30 eb 49 3a eb c9 7c 62 6f 21 4d bf 86}  //weight: 1, accuracy: High
        $x_1_2 = {ee da fe 8c 1d dc 1f 92 46 df a4 13 9c 99 4b a7 3f e6 bf 1c 52 7f e2 cc b4 c3 1c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XST_2147808175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XST!MTB"
        threat_id = "2147808175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 08 07 08 9a 1f 10 28 ?? ?? ?? 0a d2 9c 08 17 58 0c 08 06 8e 69 32 e8}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTR_2147808276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTR!MTB"
        threat_id = "2147808276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 04 2b 27 00 08 09 11 04 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 07 09 11 09 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d ce}  //weight: 5, accuracy: Low
        $x_5_2 = {47 00 65 00 74 00 50 00 69 00 78 00 65 00 6c}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUA_2147808349_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUA!MTB"
        threat_id = "2147808349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 2b 23 11 06 06 07 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 11 04 06 11 09 d2 6f ?? ?? ?? 0a 07 17 58 0b 07 17 fe 04 13 0a 11 0a 2d d3}  //weight: 1, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUB_2147808350_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUB!MTB"
        threat_id = "2147808350"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "gaknmkgadcccccccccccccccccccccccccccsasg" ascii //weight: 1
        $x_1_2 = "#gsdggdokosadsadggggg#" ascii //weight: 1
        $x_1_3 = "#gdfsfdllllllls.dll#" ascii //weight: 1
        $x_1_4 = "#fasfdddddoklpoddddssaf.dll#" ascii //weight: 1
        $x_1_5 = "#fasfdkioioaaaaaaaadsssaf.dll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XRT_2147808415_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XRT!MTB"
        threat_id = "2147808415"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 16 13 05 2b 27 00 09 11 04 11 05 28 ?? ?? ?? 06 13 06 11 06 28 ?? ?? ?? 0a 13 07 08 11 07 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d ce 07 17 58 0b 00 11 04 17 58 13 04 11 04 20 00 7a 00 00 fe 04 13 09 11 09 2d ae}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HU_2147808445_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HU!MTB"
        threat_id = "2147808445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BootsTrapper" ascii //weight: 1
        $x_1_2 = "Borland_Protector Cracked v1.0" ascii //weight: 1
        $x_1_3 = "BabelObfuscatorAttribute" ascii //weight: 1
        $x_1_4 = "IsLogging" ascii //weight: 1
        $x_1_5 = "get_IsAlive" ascii //weight: 1
        $x_1_6 = "DownloadFile" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "Sleep" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HU_2147808445_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HU!MTB"
        threat_id = "2147808445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WpfPdfUnblocker.My.Resources" ascii //weight: 1
        $x_1_2 = "//cdn.discordapp.com/attachments/" ascii //weight: 1
        $x_1_3 = "//github.com/" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "Activator" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HY_2147808447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HY!MTB"
        threat_id = "2147808447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "netsh advfirewall firewall delete rule name=\"Windows Host\"" ascii //weight: 1
        $x_1_2 = "//cdn.discordapp.com/attachments/" ascii //weight: 1
        $x_1_3 = "virustotalupload2" ascii //weight: 1
        $x_1_4 = "taskmgr" ascii //weight: 1
        $x_1_5 = "perfmon" ascii //weight: 1
        $x_1_6 = "process explorer" ascii //weight: 1
        $x_1_7 = "process hacker" ascii //weight: 1
        $x_1_8 = "DownloadFile" ascii //weight: 1
        $x_1_9 = "PSReadLine" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUE_2147808480_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUE!MTB"
        threat_id = "2147808480"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 2c 00 08 09 11 04 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 07 09 11 09 d2 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d c9}  //weight: 1, accuracy: Low
        $x_1_2 = "E3542345346" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUH_2147808481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUH!MTB"
        threat_id = "2147808481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 2e 00 09 11 04 11 05 28 ?? ?? ?? 06 13 09 11 09 28 ?? ?? ?? 0a 13 0a 08 11 04 11 0a d2 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0b 11 0b 2d c7 07 17 58 0b 00 11 04 17 58 13 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEN_2147808558_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEN!MTB"
        threat_id = "2147808558"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {35 00 34 00 92 21 35 00 36 00 92 21 37 00 31 00 92 21 35 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 44 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34}  //weight: 1, accuracy: High
        $x_1_2 = {31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 34 00 31 00 92 21 33 00 44 00 92 21 33 00 44}  //weight: 1, accuracy: High
        $x_1_3 = "Split" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "Windows.Update" ascii //weight: 1
        $x_1_9 = "Kill" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LRD_2147808559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LRD!MTB"
        threat_id = "2147808559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 7e ?? ?? ?? 04 06 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 18 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 80 ?? ?? ?? 04 02 28 ?? ?? ?? 06 0c 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 00 08 0d 2b}  //weight: 1, accuracy: Low
        $x_1_2 = "2c4ef12-4cee-483e-924b-880e4" ascii //weight: 1
        $x_1_3 = {00 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTL_2147808560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTL!MTB"
        threat_id = "2147808560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "r1c3rstrim/war/ten.nibtxet//:sptth" ascii //weight: 1
        $x_1_2 = "StrReverse" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
        $x_1_6 = "GetMethods" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTS_2147808561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTS!MTB"
        threat_id = "2147808561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {64 00 5f 00 ac 00 5f 00 5f 00 71 00 5f 00 4c 00 62 00 5f 00 b3 00 5f 00 97 00 70 00 5f 00 65 00 64 00 5f 00 5f}  //weight: 1, accuracy: High
        $x_1_2 = {68 00 5f 00 a5 00 61 00 af 00 91 00 5f 00 6b 00 6a 00 5f 00 9f 00 61 00 97 00 7e 00 5f 00 5f 00 62 00 5f 00 4e}  //weight: 1, accuracy: High
        $x_1_3 = "$2200f69e-7655-4d9b-a0dc-88959c6bdf64" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LTU_2147808562_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LTU!MTB"
        threat_id = "2147808562"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {6b 00 6a 00 5f 00 9f 00 61 00 97 00 7e 00 5f 00 5f 00 62 00 5f 00 4e 00 61 00 5f 00 90 00 5f 00 6b 00 68 00 5f 00 aa 00 61 00 77 00 84 00 5f 00 71 00 6a 00 5f}  //weight: 1, accuracy: High
        $x_1_2 = "$d9c8cf9c-7a1f-4fde-bc35-6506d3254350" ascii //weight: 1
        $x_1_3 = {42 00 75 00 6e 00 00 0b 69 00 66 00 75 00 5f 00 54 00 00 07 65 00 78 00 74 00 00 07 42 00 6f 00 78}  //weight: 1, accuracy: High
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = {49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65}  //weight: 1, accuracy: High
        $x_1_6 = {47 00 68 00 5f 00 99 00 61 00 97 00 7b 00 5f 00 77 00 6a 00 5f 00 9c 00 61 00 77 00 93 00 5f 00 77 00 68 00 5f 00 ad}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUD_2147808563_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUD!MTB"
        threat_id = "2147808563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$9dba96f1-33f8-4d54-86cf-d93dd77e278c" ascii //weight: 1
        $x_1_2 = "BC234242342" ascii //weight: 1
        $x_1_3 = "ColorTranslator" ascii //weight: 1
        $x_1_4 = "BC656234523542" ascii //weight: 1
        $x_1_5 = "E3542345346" ascii //weight: 1
        $x_1_6 = "ToWin32" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUN_2147808571_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUN!MTB"
        threat_id = "2147808571"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 2a 00 08 09 11 04 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 17 13 0a 07 09 11 09 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0b 11 0b 2d cb 06 17 58 0a 00 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUS_2147808572_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUS!MTB"
        threat_id = "2147808572"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fasfdkioioaaaaaoaaadsssaf.dll#" ascii //weight: 1
        $x_1_2 = "#gsdggdlllllllokosadsadggggg#" ascii //weight: 1
        $x_1_3 = "#fasfdkklljidddddddssaf.dll#" ascii //weight: 1
        $x_1_4 = "#gdfsfdlll;;;;llllls.dll#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUS_2147808572_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUS!MTB"
        threat_id = "2147808572"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "$6AEC1875-7803-4A31-BE22-996E8DB463D6" ascii //weight: 1
        $x_1_3 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cd}  //weight: 1, accuracy: Low
        $x_1_4 = "ToCharArray" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HX_2147808641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HX!MTB"
        threat_id = "2147808641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "nmsfmeaie" ascii //weight: 20
        $x_20_2 = "xascafgfg" ascii //weight: 20
        $x_20_3 = "xczdcsassd" ascii //weight: 20
        $x_20_4 = "fa3wfef" ascii //weight: 20
        $x_20_5 = "lasefew2" ascii //weight: 20
        $x_20_6 = "mxcvnswds" ascii //weight: 20
        $x_20_7 = "xczcecwewq2" ascii //weight: 20
        $x_20_8 = "zceqawd21" ascii //weight: 20
        $x_1_9 = "FromBase64String" ascii //weight: 1
        $x_1_10 = "ToString" ascii //weight: 1
        $x_1_11 = "Convert" ascii //weight: 1
        $x_1_12 = "Download" ascii //weight: 1
        $x_1_13 = "Replace" ascii //weight: 1
        $x_1_14 = "ShellExecute" ascii //weight: 1
        $x_1_15 = "DebuggingModes" ascii //weight: 1
        $x_1_16 = "ReadToEnd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 8 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_HZ_2147808643_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HZ!MTB"
        threat_id = "2147808643"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$1997c03f-aefa-4e31-9891-8c440661f168" ascii //weight: 20
        $x_20_2 = "$0bf92e1f-fdaa-439a-8455-da59ca7a333b" ascii //weight: 20
        $x_20_3 = "$b118808c-ce9d-4b17-b28f-dc68a69aa671" ascii //weight: 20
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "FromBase64String" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
        $x_1_13 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 4 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_LUC_2147808645_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUC!MTB"
        threat_id = "2147808645"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 0d 06 09 28 8b 00 00 0a 0a 08 17 d6 0c 08 07 6f 8c 00 00 0a 32 d9}  //weight: 1, accuracy: High
        $x_1_3 = {0a 0d 06 09 28 ?? ?? ?? 0a 0a 08 17 d6 0c 08 07 6f ?? ?? ?? 0a 32 d9}  //weight: 1, accuracy: Low
        $x_1_4 = {64 00 5f 00 ac 00 5f 00 5f 00 71 00 5f 00 4c 00 62 00 5f 00 b3 00 5f 00 97 00 70 00 5f 00 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUG_2147808646_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUG!MTB"
        threat_id = "2147808646"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_3 = {64 00 65 00 5f 00 5f 00 5f 00 5f 00 71 00 5f 00 5f 00 5f 00 77 00 61 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f}  //weight: 1, accuracy: High
        $x_1_4 = {71 00 5f 00 4c 00 62 00 5f 00 b3 00 5f 00 97 00 70 00 5f 00 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUI_2147808647_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUI!MTB"
        threat_id = "2147808647"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {62 00 5f 00 4e 00 61 00 5f 00 90 00 5f 00 6b 00 68 00 5f 00 aa 00 61 00 77 00 84 00 5f 00 71 00 6a 00 5f 00 b3 00 61 00 77 00 77 00 5f}  //weight: 1, accuracy: High
        $x_1_2 = {af 00 84 00 5f 00 9d 00 68 00 5f 00 b2 00 61 00 77 00 94 00 5f 00 5f 00 6a 00 5f 00 ad 00 61 00 af 00 77 00 5f 00 5f 00 5f 00 5f 00 47 00 61 00 5f}  //weight: 1, accuracy: High
        $x_1_3 = {5f 00 5f 00 6b 00 97 00 96 00 68 00 71 00 61 00 61 00 5f 00 5f 00 5f 00 61 00 3f 00 67 00 61 00 5f 00 5f 00 5f 00 61 00 5f 00 5f 00 65 00 af 00 5f 00 5f}  //weight: 1, accuracy: High
        $x_1_4 = {a0 00 90 00 99 00 73 00 68 00 6b 00 aa 00 67 00 a0 00 91 00 a2 00 54 00 a0 00 91 00 af 00 61 00 b2 00 91 00 a5 00 99 00 68 00 7e 00 99 00 47 00 71 00 7b}  //weight: 1, accuracy: High
        $x_1_5 = {51 00 6e 00 6d 00 71 00 b0 00 68 00 a0 00 a9 00 62 00 5f 00 5f 00 65 00 5f 00 6e 00 5f 00 5f 00 77 00 5f 00 62 00 64 00 62 00 5f 00 5f 00 65 00 97 00 51}  //weight: 1, accuracy: High
        $x_1_6 = {42 00 75 00 6e 00 00 0b 69 00 66 00 75 00 5f 00 54 00 00 07 65 00 78 00 74 00 00 07 42 00 6f 00 78}  //weight: 1, accuracy: High
        $x_1_7 = {49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUT_2147808668_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUT!MTB"
        threat_id = "2147808668"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 69 00 08 09 11 04 28 ?? ?? ?? 06 13 08 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 14 72 ?? ?? ?? 70 1b 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 a2 25 17 20}  //weight: 1, accuracy: Low
        $x_1_2 = {01 a2 25 1a 17 8d ?? ?? ?? 01 25 16 11 08 8c ?? ?? ?? 01 a2 a2 14 14 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 09 07 11 09 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d 8c}  //weight: 1, accuracy: Low
        $x_1_3 = "$e810d658-2053-4382-8e57-b2abf99916da" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVL_2147808802_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVL!MTB"
        threat_id = "2147808802"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c 09 03 6f ?? ?? ?? 0a 17 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVL_2147808802_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVL!MTB"
        threat_id = "2147808802"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c9 f9 4f 0e c0 ff f7 1f f0 65 ef e0 4b 1d f0 77 1d 30 ed dd f0 41 07 fc b3 e3 9a 8d 6c 2d ee df ef 80 cf 39 e0 57 1c 40 f7 e8 6e c1 67 de 1d f9}  //weight: 1, accuracy: High
        $x_1_2 = {f8 3f 82 72 44 4d d5 1f 59 62 25 1f f8 d2 3a 90 2d e6 50 73 b9 ba 62 1f 9b fd e6 73 75 19 9e 0c 73 14 9b ec fb f0 85 9a 80 9f 2c 73 9f 98 b0 d3}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVG_2147808803_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVG!MTB"
        threat_id = "2147808803"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 4c 65 76 65 6c 00 70 6f 00 42 56 42 5f 32 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 42 56 42 5f 36 00 74 79 70 65 5f 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 78 73 61 00 42 56 42 5f 33 00}  //weight: 1, accuracy: High
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = "GetExportedTypes" ascii //weight: 1
        $x_1_8 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUL_2147808807_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUL!MTB"
        threat_id = "2147808807"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3263583a-3e96-4cce-8c9b-e7a9a38adfa0" ascii //weight: 1
        $x_1_2 = "ColorTranslator" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUR_2147808808_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUR!MTB"
        threat_id = "2147808808"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 06 11 04 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 05 11 05 2d d5}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVP_2147808822_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVP!MTB"
        threat_id = "2147808822"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 04 2b 26 00 08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d cf}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPL_2147808914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPL!MTB"
        threat_id = "2147808914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "m_MyWebServicesObjectProvider" ascii //weight: 1
        $x_1_2 = "m_UserObjectProvider" ascii //weight: 1
        $x_1_3 = "system64x.exe|True|False|False|%Temp%|False|False" wide //weight: 1
        $x_1_4 = "xDS 1877last old.exe|True|False|False|%Temp%|False|False" wide //weight: 1
        $x_1_5 = "RuHrzz7RKy2bRYRwt" wide //weight: 1
        $x_1_6 = "fkavypqxlamrlj" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVD_2147808927_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVD!MTB"
        threat_id = "2147808927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 48 11 04 06 07 28 ?? ?? ?? 06 13 06 11 05 20 ?? ?? ?? 6a 28 ?? ?? ?? 06 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 11 06 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 13 07 09 08 11 07 28 ?? ?? ?? 0a 9c 07 17 58 0b 07 17 fe 04 13 08 11 08 2d ae 08}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVV_2147808956_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVV!MTB"
        threat_id = "2147808956"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {66 ee d9 f6 98 ff ea 89 3c f1 33 ad 87 6e 47 b1 bb b4 97 2e 77 f8 44 de c8 7f 04 47 ed e5 56 f9 8e fc 7a f4 13 fa d4 5f e2 93 3e ff 4d 74 e5 67}  //weight: 1, accuracy: High
        $x_1_2 = {5d d2 d3 e7 5c 80 df 67 59 90 34 ca 92 77 40 ce 19 9e f0 a5 17 fc da c2 29 f7 0c bf 7b 85 c1 b4 bb 4e ff 19 c7 7b db 77 c3 55 7c 40 19 f3 7e 46}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVG_2147808983_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVG!MTB"
        threat_id = "2147808983"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "IKJSUHFNIUFHIUFHIUSFHIUFHIUSFIUSFHIUSFH" ascii //weight: 1
        $x_1_3 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_4 = "Bunifu_TextBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVI_2147808984_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVI!MTB"
        threat_id = "2147808984"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdkafankkkasf#" ascii //weight: 1
        $x_1_2 = "#gsdggdllfsflllllokosadsadggggg#" ascii //weight: 1
        $x_1_3 = "#fasffasdddddokuijouilpoddddssaf.dll#" ascii //weight: 1
        $x_1_4 = "#ijfakkk.dll#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVL_2147808989_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVL!MTB"
        threat_id = "2147808989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$7a5b39a1-2f4b-479f-b697-28a3697efc8f" ascii //weight: 1
        $x_1_2 = {00 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 59 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 58 33 31 32 5f 36 37 35 37 35 34 36 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 58 33 31 32 5f 34 35 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 58 33 31 32 5f 33 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 58 33 31 32 5f 32 31 33 31 34 34 33 35 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 58 33 31 32 5f 32 00}  //weight: 1, accuracy: High
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_11 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVY_2147809020_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVY!MTB"
        threat_id = "2147809020"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 50 4f 45 52 43 58 5f 34 33 36 35 35 36 00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 70 6f 00 50 4f 45 52 43 58 5f 33 31 34 32 34 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 78 73 61 00 50 4f 45 52 43 58 5f 33 32 31 34 00}  //weight: 1, accuracy: High
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = "GetExportedTypes" ascii //weight: 1
        $x_1_8 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWA_2147809021_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWA!MTB"
        threat_id = "2147809021"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0b 2b 22 11 05 06 07 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 04 11 08 d2 6f ?? ?? ?? 0a 07 17 58 0b 07 17 fe 04 13 09 11 09 2d d4 09 17 58 0d 06 17 58 0a}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVA_2147809035_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVA!MTB"
        threat_id = "2147809035"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff ?? ?? ?? ?? ?? ?? 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cd}  //weight: 1, accuracy: Low
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "LateGet" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVB_2147809036_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVB!MTB"
        threat_id = "2147809036"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f}  //weight: 1, accuracy: High
        $x_1_2 = {64 00 5f 00 ac 00 5f 00 5f 00 71 00 5f 00 4c 00 62 00 5f 00 b3 00 5f 00 97 00 70 00 5f 00 65}  //weight: 1, accuracy: High
        $x_1_3 = {aa 00 61 00 af 00 90 00 5f 00 71 00 65 00 5f 00 61 00 5f 00 5f 00 67 00 5f 00 97 00 65 00 5f 00 5f 00 5f}  //weight: 1, accuracy: High
        $x_1_4 = {67 00 99 00 64 00 91 00 af 00 61 00 61 00 5f 00 9d 00 5f 00 6a 00 74 00 6b 00 97 00 62 00 65 00 71 00 77 00 6a 00 64 00 47 00 61 00 62 00 6b 00 af 00 61 00 6a}  //weight: 1, accuracy: High
        $x_1_5 = {71 00 5f 00 47 00 5f 00 5f 00 5f 00 5f 00 77 00 64 00 5f 00 5f 00 5f 00 71 00 6d 00 5f 00 5f 00 5f 00 af 00 a9 00 5f}  //weight: 1, accuracy: High
        $x_1_6 = {77 00 9c 00 8e 00 5f 00 5f 00 5f 00 5f 00 a3 00 62 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 5f 4a 4a 36 00}  //weight: 1, accuracy: High
        $x_1_8 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWB_2147809089_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWB!MTB"
        threat_id = "2147809089"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 04 2b 29 00 08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 17 13 09 07 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d cc 06 17 58 0a 00 09 17 58 0d}  //weight: 10, accuracy: Low
        $x_1_2 = "ToWin32" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LUP_2147809101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LUP!MTB"
        threat_id = "2147809101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$939b6d4f-6a2f-43ef-82f6-56e424585645" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = {54 00 6f 00 57 00 69 00 6e 00 33 00 32}  //weight: 1, accuracy: High
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVC_2147809102_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVC!MTB"
        threat_id = "2147809102"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$8404614e-20e7-4585-8f03-332c5b5db41f" ascii //weight: 1
        $x_1_2 = "YyozkfSrNWvfxYTHCmUMaNJPfROj" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToString" ascii //weight: 1
        $x_1_6 = "Klenex" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVE_2147809103_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVE!MTB"
        threat_id = "2147809103"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$c56eb08c-0055-49c6-9867-7b0b3681319a" ascii //weight: 1
        $x_1_2 = "Central Hardware" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "tocirpa" ascii //weight: 1
        $x_1_6 = "odacova" ascii //weight: 1
        $x_1_7 = "niatnalp" ascii //weight: 1
        $x_1_8 = "eehcyl" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVQ_2147809104_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVQ!MTB"
        threat_id = "2147809104"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a}  //weight: 1, accuracy: Low
        $x_1_3 = "AJDHIUJDHUIADHIUADHADIUHDUIHA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LPL_2147809179_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LPL!MTB"
        threat_id = "2147809179"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Xdrsbyaopb.dll" ascii //weight: 1
        $x_1_2 = "hquknivslqkb.dll" ascii //weight: 1
        $x_1_3 = "ljnhbumptxrwhhg" ascii //weight: 1
        $x_1_4 = "fckajmwqqsgtypmwn" ascii //weight: 1
        $x_1_5 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_6 = "GetTickCount64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVH_2147809180_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVH!MTB"
        threat_id = "2147809180"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 07 11 05 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 06 11 06 2d cc}  //weight: 1, accuracy: Low
        $x_1_2 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_3 = {42 00 75 00 6e 00 00 0b 69 00 66 00 75 00 5f 00 54 00 00 07 65 00 78 00 74 00 00 07 42 00 6f 00 78}  //weight: 1, accuracy: High
        $x_1_4 = {6d 00 2e 00 52 00 65 00 66 00 6c 00 65 00 63 00 74 00 69 00 6f 00 6e 00 2e 00 41 00 73 00 73 00 65 00 6d 00 62 00 6c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVJ_2147809181_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVJ!MTB"
        threat_id = "2147809181"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {56 00 61 00 67 00 69 00 6e 00 61 00 2e 00 4d 00 61 00 69 00 6e 00 00 0b 53 00 74 00 61 00 72 00 74}  //weight: 1, accuracy: High
        $x_1_2 = "C:\\Users\\LP\\Desktop\\loader\\loader\\obj\\Debug\\loader.pdb" ascii //weight: 1
        $x_1_3 = "Vagina.Main" ascii //weight: 1
        $x_1_4 = "loader.exe" ascii //weight: 1
        $x_1_5 = "g__GetLibrary" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "Invoke" ascii //weight: 1
        $x_1_10 = "Program" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVM_2147809182_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVM!MTB"
        threat_id = "2147809182"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 80 ?? ?? ?? 04 de 1e}  //weight: 1, accuracy: Low
        $x_1_2 = {16 0d 2b 30 08 09 9a 13 04 11 04 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 2c 14 11 04 14 14 6f ?? ?? ?? 0a 26 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 09 17 58 0d 09 08 8e 69 32 ca 07 17 58 0b 07 06 8e 69 32 b3}  //weight: 1, accuracy: Low
        $x_1_3 = "WindowsFormsApp1.Properties.Resources" ascii //weight: 1
        $x_1_4 = "Decoder" ascii //weight: 1
        $x_1_5 = "Program" ascii //weight: 1
        $x_1_6 = "GetExportedTypes" ascii //weight: 1
        $x_1_7 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVN_2147809183_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVN!MTB"
        threat_id = "2147809183"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0a 02 8e 69 8d ?? ?? ?? ?? 0b 16 0c 2b 17 00 08 06 8e 69 5d 0d 07 08 02 08 91 06 09 91 61 d2 9c 00 08 17 58 0c 08 02 8e 69 fe 04 13 05 11 05 2d dd}  //weight: 1, accuracy: Low
        $x_1_2 = "OpenProcess" ascii //weight: 1
        $x_1_3 = "VirtualAllocEx" ascii //weight: 1
        $x_1_4 = "WriteProcessMemory" ascii //weight: 1
        $x_1_5 = "VirtualMemoryWrite" ascii //weight: 1
        $x_1_6 = "THREAD_HIJACK" ascii //weight: 1
        $x_1_7 = {2d 00 2d 00 2d 00 20 00 5e 00 2e 00 2d 00 2d 00 2e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVP_2147809184_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVP!MTB"
        threat_id = "2147809184"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$b3d98734-f527-4889-8e9e-06260ecf7a8f" ascii //weight: 1
        $x_1_2 = "Florithmetic" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVS_2147809185_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVS!MTB"
        threat_id = "2147809185"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "POERCX_31424" ascii //weight: 1
        $x_1_2 = "POERCX_3214" ascii //weight: 1
        $x_1_3 = "POERCX_436556" ascii //weight: 1
        $x_1_4 = "POERCX_54936754" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "ToWin32" ascii //weight: 1
        $x_1_7 = "ToArray" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DVZ_2147809248_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DVZ!MTB"
        threat_id = "2147809248"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "yes.yes" wide //weight: 1
        $x_1_2 = "FUUNYANDHARD" wide //weight: 1
        $x_1_3 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_4 = "CryptoStreamMode" ascii //weight: 1
        $x_1_5 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 52 65 76 65 72 73 65 00}  //weight: 1, accuracy: High
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_9 = "power" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWE_2147809249_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWE!MTB"
        threat_id = "2147809249"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWK_2147809252_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWK!MTB"
        threat_id = "2147809252"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 06 11 07 11 08 28 ?? ?? ?? 06 13 0a d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 00 01 00 00 14 14 17 8d ?? ?? ?? 01 25 16 11 0a 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 0b 17 13 0c 11 05 11 0b d2 6f ?? ?? ?? 0a 00 00 11 08 17 58 13 08 11 08 17 fe 04 13 0d 11 0d 2d a0}  //weight: 10, accuracy: Low
        $x_10_2 = {16 0b 2b 50 11 09 06 07 28 ?? ?? ?? 06 13 0a d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 20 00 01 00 00 14 14 17 8d ?? ?? ?? 01 25 16 11 0a 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 0b 11 08 11 0b d2 6f ?? ?? ?? 0a 07 17 58 0b}  //weight: 10, accuracy: Low
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DWM_2147809253_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWM!MTB"
        threat_id = "2147809253"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c 16}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWM_2147809253_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWM!MTB"
        threat_id = "2147809253"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 08 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 84 28 ?? ?? ?? 06 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 7e ?? ?? ?? 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c 09 16}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWI_2147809254_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWI!MTB"
        threat_id = "2147809254"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 33 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 35 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 34 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 36 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 00}  //weight: 1, accuracy: High
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "ifu_Te" wide //weight: 1
        $x_1_9 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAD_2147809326_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAD!MTB"
        threat_id = "2147809326"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 1a 00 00 06 25 28 ?? 00 00 06 75 ?? 00 00 01 6f ?? 00 00 0a 16 a3 ?? 00 00 01 28 ?? 00 00 06}  //weight: 5, accuracy: Low
        $x_1_2 = "WindowsFormsApp41" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAD_2147809326_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAD!MTB"
        threat_id = "2147809326"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdsfdsfskahfhfankkkasf#" ascii //weight: 1
        $x_1_2 = "#fasfdsfffafgsdddddokuijouilpoddddssaf.dll#" ascii //weight: 1
        $x_1_3 = "fasdfdsffffffgs" ascii //weight: 1
        $x_1_4 = "#gdfsaffdsflfsafgflllls.dll#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAG_2147809327_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAG!MTB"
        threat_id = "2147809327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 0f 00 00 0a 72 ?? 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 13 01}  //weight: 5, accuracy: Low
        $x_1_2 = "hjkj.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAG_2147809327_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAG!MTB"
        threat_id = "2147809327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 72 23 00 00 70 6f ?? ?? ?? 0a 00 02 02 fe ?? ?? ?? ?? 06 73 ?? ?? ?? 0a 28 ?? ?? ?? 0a 00 02 16 28 ?? ?? ?? 0a 00 2a}  //weight: 5, accuracy: Low
        $x_1_2 = "GPT4_V2.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAG_2147809327_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAG!MTB"
        threat_id = "2147809327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 52 00 08 09 11 04 28 ?? ?? ?? 06 13 07 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 11 07 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 08 17 13 09 07 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d a3 06 17 58 0a 00 09}  //weight: 1, accuracy: Low
        $x_1_2 = "I_______I" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ST_2147809345_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ST!MTB"
        threat_id = "2147809345"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 20 00 01 00 00 13 11 11 10 17 58 13 12 11 10 20 00 9a 01 00 5d 13 13 11 12 20 00 9a 01 00 5d 13 14 11 0b 11 13 91 13 15 1f 16 8d 80 00 00 01 25 d0 27 01 00 04 28 c6 00 00 0a 11 10 1f 16 5d 91 13 16 11 0b 11 14 91 11 11 58 13 17 11 15 11 16 61 13 18 11 18 11 17 59 13 19 11 0b 11 13 11 19 11 11 5d d2 9c 00 11 10 17 58 13 10 11 10 20 00 9a 01 00 fe 04 13 1a 11 1a 2d 84}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWU_2147809382_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWU!MTB"
        threat_id = "2147809382"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 05 2b 2a 00 09 11 04 11 05 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 06 13 09 17 13 0a 08 11 09 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0b 11 0b 2d cb}  //weight: 10, accuracy: Low
        $x_10_2 = {16 13 05 2b 2a 00 09 11 04 11 05 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 17 13 0a 08 11 09 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0b 11 0b 2d cb 07 17 58 0b 00 11 04 17 58 13 04}  //weight: 10, accuracy: Low
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NAA_2147809436_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAA!MTB"
        threat_id = "2147809436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 02 00 00 0a 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0a dd ?? 00 00 00}  //weight: 5, accuracy: Low
        $x_1_2 = "C4PROLauncher" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAA_2147809436_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAA!MTB"
        threat_id = "2147809436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0b 7e 03 00 00 04 28 ?? 00 00 0a 0c 07 08 16 08 8e 69 73 ?? 00 00 0a 72 ?? 00 00 70 72 ?? 00 00 70 6f ?? 00 00 0a 00 06 7e ?? 00 00 04}  //weight: 5, accuracy: Low
        $x_1_2 = "GameMonPROKILL" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAA_2147809436_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAA!MTB"
        threat_id = "2147809436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 8e 69 5a 28 ?? 00 00 0a 0c 16 0d 06 6f ?? 00 00 0a 07 08 12 03 28 ?? 00 00 06 26 09 76 6c d0 ?? 00 00 01 28 ?? 00 00 0a 28 ?? 00 00 0a 6c 5b 28 ?? 00 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "1d2aa0a6-2c4b-4369-af19-ef03e43cbd78" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAA_2147809436_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAA!MTB"
        threat_id = "2147809436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {61 6a 77 66 64 61 69 64 77 61 00 41 73 73 65 6d 62 6c 79 54 72 61 64 65 6d 61 72 6b 41 74 74 72 69 62 75 74 65}  //weight: 1, accuracy: High
        $x_1_2 = {6b 6f 69 00 61 6a 77 66 64 61 69 64 77 61 2e 65 78 65 00 6d 73 63 6f 72 6c 69 62 00 53 75 70 70 72 65 73 73 49 6c 64 61 73 6d 41 74 74 72 69 62 75 74 65}  //weight: 1, accuracy: High
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "jsfeifeofewolf.exe" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ToBase64String" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAB_2147809437_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAB!MTB"
        threat_id = "2147809437"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = "SForStrring" ascii //weight: 10
        $x_10_2 = "Decoder" ascii //weight: 10
        $x_1_3 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 1, accuracy: Low
        $x_1_4 = "WindowsFormsApp1.Properties.Resources.resources" ascii //weight: 1
        $x_1_5 = "GetMethods" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NAO_2147809438_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAO!MTB"
        threat_id = "2147809438"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 27 00 08 09 11 04 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 07 09 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d ce 06 17 58}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAB_2147809465_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAB!MTB"
        threat_id = "2147809465"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "QzpcVXNlcnNcRmF0aWhcQXBwRGF0YVxMb2NhbFxUZW1wXHhyZWJ1MzZ3YXNk" ascii //weight: 1
        $x_1_2 = "aHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvMTEyODgwMTA2Mzg5MDMzMzg1OC8xMTI4ODAxNDUyMDA2MDY4MzU2L0luamVjdC5kbGw" ascii //weight: 1
        $x_1_3 = "Revolai.exe" ascii //weight: 1
        $x_1_4 = "Sworzy Baba Inc." ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMA_2147809466_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMA!MTB"
        threat_id = "2147809466"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 50 2b 51 2b 52 6f ?? 00 00 0a 0d 73 ?? 00 00 0a 13 04 11 04 09 17 73 ?? 00 00 0a 13 05 11 05 02 16 02 8e 69 6f ?? 00 00 0a 11 04 6f ?? 00 00 0a 10 00 de}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAE_2147809478_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAE!MTB"
        threat_id = "2147809478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 11 01 28 0d 00 00 06 13 02 38 ?? 00 00 00 28 ?? 00 00 0a 11 00 6f ?? 00 00 0a 28 ?? 00 00 0a 13 01 20 ?? 00 00 00}  //weight: 5, accuracy: Low
        $x_1_2 = "Puafowr" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAE_2147809478_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAE!MTB"
        threat_id = "2147809478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 36 00 00 0a 72 ?? ?? 00 70 6f ?? ?? 00 0a fe ?? ?? 00 fe ?? ?? 00 6f ?? ?? 00 0a d4 8d ?? ?? 00 01 fe ?? ?? 00 fe ?? ?? 00 fe ?? ?? 00 20 ?? ?? 00 00 fe ?? ?? 00 8e 69 6f ?? ?? 00 0a 26 14 fe ?? ?? 00 73 ?? ?? 00 0a fe ?? ?? 00 fe ?? ?? 00 73 ?? ?? 00 0a fe ?? ?? 00 fe ?? ?? 00 20 ?? ?? 00 00 73 ?? ?? 00 0a fe ?? ?? 00}  //weight: 5, accuracy: Low
        $x_1_2 = "unpackmee" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAE_2147809478_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAE!MTB"
        threat_id = "2147809478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetPixel" ascii //weight: 1
        $x_1_2 = "ToInt32" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = {00 49 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_9 = "GetExportedTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAQ_2147809500_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAQ!MTB"
        threat_id = "2147809500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 05 2b 29 00 09 11 04 11 05 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 08 11 04 11 09 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0a 11 0a 2d cc 07 17 58 0b}  //weight: 10, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_10_3 = {13 09 2b 2b 00 11 07 11 08 11 09 28 ?? ?? ?? 06 13 0b 11 0b 28 ?? ?? ?? 0a 13 0c 11 06 11 08 11 0c d2 6f ?? ?? ?? 0a 00 00 11 09 17 58 13 09 11 09 17 fe 04 13 0d 11 0d 2d ca}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NAX_2147809501_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAX!MTB"
        threat_id = "2147809501"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdsfdsffsdfskahfhfankkkasf#" ascii //weight: 1
        $x_1_2 = "#gsdggdllfsfsdffsflllfgfllokosadsadggggg#" ascii //weight: 1
        $x_1_3 = "#fsalluiijuidsfsdfffsdfdsfhfasaf.dll#" ascii //weight: 1
        $x_1_4 = "#fafdasgsffsdfdkgfioioaaaaaoaaadsssaf.dll#" ascii //weight: 1
        $x_1_5 = "#gdfsaffdsffsdfdslfsafgflllls.dll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAZ_2147809502_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAZ!MTB"
        threat_id = "2147809502"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "exe.ooc/ac.semohnemul//:sptth" ascii //weight: 1
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWJ_2147809544_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWJ!MTB"
        threat_id = "2147809544"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 49 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 49 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 49 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_8 = "ToInt32" ascii //weight: 1
        $x_1_9 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBC_2147809590_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBC!MTB"
        threat_id = "2147809590"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 27 00 08 09 11 04 28 ?? ?? ?? 06 13 06 11 06 28 ?? ?? ?? 0a 13 07 07 09 11 07 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d ce}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LVU_2147809790_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LVU!MTB"
        threat_id = "2147809790"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 32 00 30 00 2e 00 35 00 31 00 2e 00 32 00 31 00 37 00 2e 00 31 00 31 00 33 00 2f 00 6b 00 6d 00 6e 00 2f 00 43 00 6f 00 6e 00 73 00 6f 00 6c 00 65 00 41 00 70 00 70 00 31 00 33}  //weight: 1, accuracy: High
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "GetMethods" ascii //weight: 1
        $x_1_4 = "WebClient" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAI_2147809791_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAI!MTB"
        threat_id = "2147809791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$f90050b9-c721-4a12-b7dd-70c55fdf0cd1" ascii //weight: 1
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAL_2147809792_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAL!MTB"
        threat_id = "2147809792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 05 17 d6 13 05 00 11 05 09 8e 69 fe 04 13 0a 11 0a 2d d4}  //weight: 5, accuracy: High
        $x_1_2 = "Picimize" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAL_2147809792_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAL!MTB"
        threat_id = "2147809792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {2b 0a 2b 0b 2b 0c 2b 11 2b 16 de 24 06 2b f3 02 2b f2 73 ?? ?? ?? 0a 2b ed 6f ?? ?? ?? 0a 2b e8 0b 2b e7}  //weight: 5, accuracy: Low
        $x_5_2 = {73 27 00 00 0a 0b 2b 2e 16 2b 2e 2b 33 2b 38 16 2d 09 2b 09 2b 0a 6f ?? ?? ?? 0a de 10 08 2b f4 07 2b f3}  //weight: 5, accuracy: Low
        $x_1_3 = "Adobe Updater Utility" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAL_2147809792_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAL!MTB"
        threat_id = "2147809792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 6f ?? ?? ?? 0a 0c 06 08 28 ?? ?? ?? 0a 07 59 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 0a 11 04 17 58 13 04 11 04 09 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "StrReverse" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = {6a 00 65 00 4c 00 51 00 71 00 44 00 77 00 44 00 37 00 6a 00 78 00 69 00 37 00 44 00 44 00 44 00 44 00 44 00 6a 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44 00 44}  //weight: 1, accuracy: High
        $x_1_5 = {54 00 56 00 71 00 51 00 41 00 41 00 4d 00 41 00 41 00 41 00 41 00 45 00 41 00 41 00 41 00 41 00 2f 00 2f 00 38 00 41 00 41 00 4c 00 67 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 51 00 41 00 41 00 41 00 41}  //weight: 1, accuracy: High
        $x_1_6 = {41 00 41 00 41 00 67 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 4d 00 41 00 59 00 49 00 55 00 41 00 41 00 42 00 41 00 41 00 41 00 42 00 41 00 41 00 41 00 41 00 41 00 41 00 45 00 41 00 41 00 41 00 45 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 38}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAN_2147809793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAN!MTB"
        threat_id = "2147809793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 6f ?? ?? ?? 0a 7e ?? ?? ?? 04 07 1f 10 5d 91 61 07 20 ?? ?? ?? 00 5d d1 61 d1 9d 07 17 58 0b 07 02 6f ?? ?? ?? 0a 32 d4}  //weight: 1, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "Concat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAN_2147809793_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAN!MTB"
        threat_id = "2147809793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 d0 31 00 00 01 28 ?? 00 00 0a 06 17 8d ?? 00 00 01 25 16 d0 ?? 00 00 1b 28 ?? 00 00 0a a2 28 ?? 00 00 0a 14 17 8d ?? 00 00 01 25 16 28 ?? 00 00 06 a2 6f ?? 00 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "WindowsFormsApp21" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAT_2147809794_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAT!MTB"
        threat_id = "2147809794"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 2e 00 00 0a 02 72 ?? 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 19 2d 03 26 de 06 0a 2b fb}  //weight: 5, accuracy: Low
        $x_1_2 = "Cutsoggwg" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAT_2147809794_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAT!MTB"
        threat_id = "2147809794"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 6f ?? ?? ?? 0a 0c 06 08 28 ?? ?? ?? 0a 07 59 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 0a 11 04 17 58 13 04 11 04 09 6f ?? ?? ?? 0a 3f}  //weight: 1, accuracy: Low
        $x_1_2 = "2ab99cf-8e35-453e-88d6-43d16001ed5" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAT_2147809794_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAT!MTB"
        threat_id = "2147809794"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 82 0f 00 70 20 ?? ?? ?? 21 38 ?? ?? ?? 00 72 ?? ?? ?? 70 20 ?? ?? ?? 54 38 ?? ?? ?? 00 72 ?? ?? ?? 70 61 38 ?? ?? ?? 00 72 ?? ?? ?? 70 20 ?? ?? ?? 75 38 ?? ?? ?? 00 72 ?? ?? ?? 70 40 ?? ?? ?? 00 38 ?? ?? ?? 00 72 ?? ?? ?? 70}  //weight: 5, accuracy: Low
        $x_1_2 = "JITStarter" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBA_2147809795_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBA!MTB"
        threat_id = "2147809795"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$847932a3-3530-445a-a663-fb04c620a7d9" ascii //weight: 1
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBB_2147809796_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBB!MTB"
        threat_id = "2147809796"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 1e 07 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0d 06 09 28 ?? ?? ?? 0a 0a 08 17 d6 0c 08 07 6f ?? ?? ?? 0a 32 d9}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBB_2147809796_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBB!MTB"
        threat_id = "2147809796"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f 53 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 06 18 6f ?? 00 00 0a 06 6f ?? 00 00 0a 0c 02 0d 08 09 16 09 8e b7 6f ?? 00 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "taskshostw" ascii //weight: 1
        $x_1_3 = "X0KMDgd7DWnHTV0Aq" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBN_2147809823_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBN!MTB"
        threat_id = "2147809823"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsalluiijuidsxfsdfffsdfdsfhfasaf.dll#" ascii //weight: 1
        $x_1_2 = "#fasvxfdsfsdfffafgsdddddokuijouilpoddddssaf.dll#" ascii //weight: 1
        $x_1_3 = "#ijfakkgffsfvxdsfsgk.dll#" ascii //weight: 1
        $x_1_4 = "k#afsffasfa#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBP_2147809824_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBP!MTB"
        threat_id = "2147809824"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0c 2b 23 11 06 07 08 28 ?? ?? ?? 06 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 05 07 11 08 d2 6f ?? ?? ?? 0a 08 17 58 0c 08 17 fe 04 13 09 11 09 2d d3}  //weight: 10, accuracy: Low
        $x_10_2 = {16 13 05 2b 2c 00 09 11 04 11 05 28 ?? ?? ?? 06 13 08 11 08 28 ?? ?? ?? 0a 13 09 17 13 0a 08 11 04 11 09 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0b 11 0b 2d c9 07}  //weight: 10, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DWV_2147809877_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWV!MTB"
        threat_id = "2147809877"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$fb8d0d42-9d10-492d-89c3-faffbffc406c" ascii //weight: 10
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWS_2147809878_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWS!MTB"
        threat_id = "2147809878"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 06 b7 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0b 07 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "ifu_Te" wide //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DXD_2147809879_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DXD!MTB"
        threat_id = "2147809879"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 06 b7 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0b 07 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "ifu_Te" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DXE_2147809880_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DXE!MTB"
        threat_id = "2147809880"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 57 30 32 00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 70 6f 00 57 30 33 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 78 73 61 00 57 30 34 00 41 41 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = "ToWin32" ascii //weight: 1
        $x_1_8 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DXN_2147809881_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DXN!MTB"
        threat_id = "2147809881"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5f 71 88 e7 94 9e 59 c6 ef 9e 3c 65 8a 3b ca 57 2e 9d 94 9b 5c b1 8d 72 f4 37 f3 12 a0 9b 3c b2 c5 67 ca 26 db b3 75 b2 3c 8f f7 5c df 3e 1c 3a}  //weight: 1, accuracy: High
        $x_1_2 = {8f e0 b7 fe e2 e0 93 1c e7 75 26 fd 06 e3 cd 09 7f 9a f7 5d 17 17 da a7 96 8a 87 a5 da 26 9a 99 b6 fe 88 af b3 2a f1 19 1b a5 c6 0a 29 dd a5 f3}  //weight: 1, accuracy: High
        $x_1_3 = {b6 0f f7 df fd 01 d0 7d 9f 0b e4 7d 9b 0b be fd c3 35 be ef 7b 01 1a f7 ca e8 fa cb 5f f0 35 2f f8 ba 0f f7 64 93 f3 ed 2e c0 ff f9 2e f8 04 0f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DWL_2147809882_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DWL!MTB"
        threat_id = "2147809882"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$f01a2498-e776-4e7b-8fed-0ff9df5a1bc6" ascii //weight: 10
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYA_2147809887_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYA!MTB"
        threat_id = "2147809887"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e0 47 5d f0 cb 5c a0 8f 3f d3 05 bf 7b e5 fd 3e 17 fc 51 17 fc d1 17 fc 29 17 7c 8b 0b fe a4 0b be e3 05 7f e2 05 df e1 ed f7 1f 72 c1 1f 7f 81}  //weight: 1, accuracy: High
        $x_1_2 = {f1 bd 49 4f fa 51 af 79 d6 0f 7d 67 1b c9 a3 37 f6 12 19 b5 1c ec bd 5f 95 1e 90 be 7a 7f 96 7c fb 7d 57 f5 f9 ee d6 17 c7 c5 8e ec 93 e3 41 9f}  //weight: 1, accuracy: High
        $x_1_3 = {6b 23 f1 64 f9 07 e8 2a f7 ce 53 e3 a0 dd 7b 29 c1 f1 5b fb da f2 3b fc 37 e0 25 75 f2 74 e6 a5 4f be 0b 93 3b 68 d6 a3 ce b3 72 a7 db 19 da 7b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYB_2147809888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYB!MTB"
        threat_id = "2147809888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 08 18 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? 2b 1f 10 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? 2b 84 ?? ?? ?? ?? 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 75 ?? ?? ?? 1b 09 91 61 1f 48 1f 63 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYB_2147809888_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYB!MTB"
        threat_id = "2147809888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 06 8e 69 1e 5a 6f ?? ?? ?? 0a 00 09 06 6f ?? ?? ?? 0a 00 09 07 8e 69 1e 5a 6f ?? ?? ?? 0a 00 09 07 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 13 04 00 03 73 ?? ?? ?? 0a 13 05 00 11 05 11 04 16 73 ?? ?? ?? 0a 13 06 00 03 8e 69 8d ?? ?? ?? 01 13 07 11 06 11 07 16 03 8e 69 6f ?? ?? ?? 0a 13 08 11 07 11 08 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYF_2147809889_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYF!MTB"
        threat_id = "2147809889"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "Bu-ni--fu_T--ex--tBo---x" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBT_2147809921_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBT!MTB"
        threat_id = "2147809921"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {fe 0c 16 00 fe ?? ?? 00 58 4a 97 29 ?? ?? ?? 11 a2 fe ?? ?? 00 fe ?? ?? 00 20 ?? ?? ?? 00 9c fe ?? ?? 00 20 ?? ?? ?? 00}  //weight: 5, accuracy: Low
        $x_1_2 = "AntiAnalysis" ascii //weight: 1
        $x_1_3 = "nonSecretPayloadLength" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBT_2147809921_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBT!MTB"
        threat_id = "2147809921"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 62 00 08 09 11 04 28 ?? ?? ?? 06 13 07 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 ?? ?? ?? 00 70 ?? ?? ?? 00 70 ?? ?? ?? 00 0a 20 ?? ?? ?? 00 14 14 17 8d ?? ?? ?? 01 25 16 11 07 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 08 17 13 09 07 09 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d 93 06 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPT_2147809940_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPT!MTB"
        threat_id = "2147809940"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "8duanjin.net" wide //weight: 1
        $x_1_2 = "powershell" wide //weight: 1
        $x_1_3 = "DxownxloxadDxatxxax" wide //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "WebClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPT_2147809940_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPT!MTB"
        threat_id = "2147809940"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "3.71.39.224" wide //weight: 1
        $x_1_2 = "peace" wide //weight: 1
        $x_1_3 = "loader" wide //weight: 1
        $x_1_4 = "uploads" wide //weight: 1
        $x_1_5 = "Hrsriuaj.png" wide //weight: 1
        $x_1_6 = "Qedftlyicvfn" wide //weight: 1
        $x_1_7 = "get_Assembly" ascii //weight: 1
        $x_1_8 = "ReadBytes" ascii //weight: 1
        $x_1_9 = "WebResponse" ascii //weight: 1
        $x_1_10 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPT_2147809940_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPT!MTB"
        threat_id = "2147809940"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "Vwqxf.jpg" wide //weight: 1
        $x_1_3 = "Csguytotltkmaygfappg.Iiyqxtnpkcub" wide //weight: 1
        $x_1_4 = "Roayynrns" wide //weight: 1
        $x_1_5 = "Email Checker Pro" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYQ_2147809941_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYQ!MTB"
        threat_id = "2147809941"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {17 fc 5c 17 fc eb 17 fc 32 17 e8 e3 cf 72 c1 ef 52 79 bf d7 05 7f f4 05 7f cc 05 7f ea 05 bf f4 05 7f d2 05 7f ca 05 7f e2 05 7f d4 db ef 3f e4}  //weight: 1, accuracy: High
        $x_1_2 = {96 df ef 1e 24 3f 7d b5 ce 4b 99 f6 dc cb 65 5b 80 9c fa 0e 2c 5c 31 10 1f c2 cf ed 5e 30 3f 17 ff 82 cf 5e b7 47 fe 79 a7 ca dd 6d df ec f5 bb}  //weight: 1, accuracy: High
        $x_1_3 = {5a ab e7 ae 2a ff ea 0c 36 f7 d5 9c fb f2 55 af ee 62 a1 e5 1c 1d 0d 79 ee 28 39 a7 0d ff 69 b3 c1 5c 9d 7c f2 a3 e3 ee 3b 9b 53 f6 19 1c df 77}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYP_2147809942_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYP!MTB"
        threat_id = "2147809942"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 75 ?? ?? ?? 1b 09 91 61 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {01 02 08 18 ?? ?? ?? ?? 28 ?? ?? ?? 2b 1f 10 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? 2b 84 20 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYI_2147809943_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYI!MTB"
        threat_id = "2147809943"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 06 b7 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0b 07 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "Bu-ni--fu_T--ex--tBo---x" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBL_2147810017_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBL!MTB"
        threat_id = "2147810017"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 0a 2b 00 06 2a}  //weight: 5, accuracy: Low
        $x_5_2 = {42 00 75 00 6e 00 00 0d 69 00 66 00 75 00 5f 00 54 00 65 00 00 07 78 00 74 00 42 00 00 05 6f 00 78}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBL_2147810017_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBL!MTB"
        threat_id = "2147810017"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 18 7e 9f 00 00 04 1f 72 7e 9f 00 00 04 1f 72 93 7e 9f 00 00 04 20 00 01 00 00 93 61 20 cb 00 00 00 5f 9d 2e 09}  //weight: 1, accuracy: High
        $x_1_2 = {04 20 ab 52 e3 48 61 02 61 0a 7e b0 ?? ?? ?? 0c 08 74 44 ?? ?? ?? 25 06 93 0b 06 18 58 93 07 61 0b 18 13 0e 38 7c ff ff ff}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYC_2147810186_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYC!MTB"
        threat_id = "2147810186"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$d736c71a-8e38-4f80-b858-2435242fb297" ascii //weight: 10
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DXZ_2147810187_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DXZ!MTB"
        threat_id = "2147810187"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0d 00 00 09 6f ?? ?? ?? 0a 13 04 16 13 05 38 ?? ?? ?? ?? 11 04 11 05 a3 ?? ?? ?? 01 13 06 00 11 06 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 07 11 07 39 ?? ?? ?? ?? 00 11 06 14 14 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 13 08 38 ?? ?? ?? ?? 00 11 05 17 58 13 05 11 05 11 04 8e 69}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DXZ_2147810187_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DXZ!MTB"
        threat_id = "2147810187"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "SELECT * FROM Win32_PortConnector" wide //weight: 3
        $x_2_2 = "smakaf1.polycomusa.com/" wide //weight: 2
        $x_2_3 = "zvoracle.polycomusa.com/" wide //weight: 2
        $x_1_4 = "DownloadString" ascii //weight: 1
        $x_1_5 = "CreateRunspace" ascii //weight: 1
        $x_1_6 = "Invoke" ascii //weight: 1
        $x_1_7 = "CreatePipeline" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 1 of ($x_2_*) and 4 of ($x_1_*))) or
            ((1 of ($x_3_*) and 2 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DYX_2147810188_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYX!MTB"
        threat_id = "2147810188"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Bu-ni--fu_T--ex--tBo---x" wide //weight: 1
        $x_1_2 = {00 49 5f 30 30 30 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 49 5f 30 30 30 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 49 5f 30 30 30 30 30 30 38 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 49 5f 30 30 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 49 5f 30 39 33 31 32 33 31 32 33 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 49 5f 39 31 33 32 34 33 32 34 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 4d 65 74 68 6f 64}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCE_2147810223_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCE!MTB"
        threat_id = "2147810223"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {07 03 74 11 00 00 1b 09 91 6f ba 00 00 0a 00 09 17 d6 0d 09 08 31 e9}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCE_2147810223_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCE!MTB"
        threat_id = "2147810223"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 2a 00 08 09 11 04 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 17 13 09 07 09 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d cb}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DZO_2147810315_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZO!MTB"
        threat_id = "2147810315"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {3e e0 81 3f 7a e0 63 1e d0 c6 f7 75 e0 8b 0c dc 97 39 f0 0d 0e 7c c3 03 df fa c0 c7 38 f0 2d 0e 7c ab 03 df fc c0 d7 7f 7a ff 9a 07 be e9 01 f9}  //weight: 1, accuracy: High
        $x_1_2 = {e9 1d 8e af 08 a7 1c d8 7d e3 4c cf 3a 97 1f 33 9f e3 e7 de fe 2d fb af 3d ee f0 ca 73 06 c5 16 d3 8b a7 ba f6 70 ac 7d d3 8b f6 9b 2b c8 cf b6}  //weight: 1, accuracy: High
        $x_1_3 = {1b df bf 6e 3a 60 e6 ef 36 9a e7 d1 91 26 07 08 df 93 9c b3 cf e0 b4 d7 bb d8 70 f6 59 74 f1 f3 9d b6 7a f7 e2 4a b4 d3 2f e8 9b 65 b6 e4 9d 1e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_DZP_2147810316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZP!MTB"
        threat_id = "2147810316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$96cfa327-997a-41d9-b30e-ba6979bddc14" ascii //weight: 10
        $x_10_2 = "$CB3B33B2-6FDE-441A-B75B-B457E2D8CBFA" ascii //weight: 10
        $x_1_3 = {00 50 5f 30 30 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 73}  //weight: 1, accuracy: High
        $x_1_9 = {00 50 5f 30 30 30 30 30 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 50 5f 30 30 30 30 30 31 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DZQ_2147810317_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZQ!MTB"
        threat_id = "2147810317"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c 09 03 6f ?? ?? ?? 0a 17 59}  //weight: 1, accuracy: Low
        $x_1_2 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DZR_2147810318_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZR!MTB"
        threat_id = "2147810318"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 2e 00 08 09 11 04 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 17 13 09 07 11 08 d2 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 26 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d c7 06 17 58 0a 00 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAC_2147810492_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAC!MTB"
        threat_id = "2147810492"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 07 08 6f ?? ?? ?? 0a 07 18 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0d dd}  //weight: 1, accuracy: Low
        $x_1_2 = "c79f4c9-676b-427c-9159-6c0037b4c6" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAC_2147810492_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAC!MTB"
        threat_id = "2147810492"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f 17 00 00 0a 25 17 6f ?? 00 00 0a 13 06 73 ?? 00 00 0a 25 11 06 6f ?? 00 00 0a 25 6f ?? 00 00 0a 26 25}  //weight: 5, accuracy: Low
        $x_1_2 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_3 = "Default.g.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAR_2147810493_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAR!MTB"
        threat_id = "2147810493"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TVdGGuzqIKLWkhbazohupsYGTQJ" ascii //weight: 1
        $x_1_2 = "isfd0sd.exe" ascii //weight: 1
        $x_1_3 = "WebResponse" ascii //weight: 1
        $x_1_4 = "System.Runtime.InteropServices" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
        $x_1_7 = "WriteAllBytes" ascii //weight: 1
        $x_1_8 = "VirtualProtect" ascii //weight: 1
        $x_1_9 = "System.Text" ascii //weight: 1
        $x_1_10 = "CreateInstance" ascii //weight: 1
        $x_1_11 = "HttpWebRequest" ascii //weight: 1
        $x_1_12 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBS_2147810494_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBS!MTB"
        threat_id = "2147810494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 6c 23 ff b9 f4 ee 2a 81 f7 3f 5b 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {42 00 75 00 6e 00 00 0d 69 00 66 00 75 00 5f 00 54 00 65 00 00 07 78 00 74 00 42 00 00 05 6f 00 78}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBU_2147810495_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBU!MTB"
        threat_id = "2147810495"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Y7834214234234" ascii //weight: 1
        $x_1_2 = "Y827344274324324" ascii //weight: 1
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 63 79 7a 00}  //weight: 1, accuracy: High
        $x_1_5 = "Y895430534543534" ascii //weight: 1
        $x_1_6 = "GetExportedTypes" ascii //weight: 1
        $x_1_7 = "Y9234092542052" ascii //weight: 1
        $x_1_8 = "T-o-W-i-n-3-2" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCA_2147810496_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCA!MTB"
        threat_id = "2147810496"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {08 11 04 08 11 04 91 07 11 04 91 61 d2 9c 11 04 17 58 13 04 11 04 02 7b 03 00 00 04 32 e2}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCA_2147810496_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCA!MTB"
        threat_id = "2147810496"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 94 d1 0c 12 02 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 07 17 58 0b 07 02 8e 69 32}  //weight: 1, accuracy: Low
        $x_1_2 = {06 07 02 07 28 ?? ?? ?? 06 07 20 ?? ?? ?? 00 5d d1 61 d1 9d 07 17 58 0b 07 02 6f ?? ?? ?? 0a 32}  //weight: 1, accuracy: Low
        $x_1_3 = {04 03 1f 10 5d 91 61 2a}  //weight: 1, accuracy: High
        $x_1_4 = {2c 00 2e 00 2d 00 65 00 78 00 2c 00 2e 00 2d 00 65 00 2e 00 73 00 72 00 2c 00 2e 00 2d 00 65 00 73 00 77}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCA_2147810496_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCA!MTB"
        threat_id = "2147810496"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cmdaaaasssssssssssssssssssssssssssssssssssssssssssssssssaaaaa.exe" ascii //weight: 1
        $x_1_2 = "http://user:password@www.includehelp.com:8082/Article/CPrograms/" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "DESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCD_2147810498_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCD!MTB"
        threat_id = "2147810498"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 06 11 01 00 0c 20 b4 e7 00 00 0d 08 6c 09 6c 23 00 00 00 00 00 00 30 40 5b 58 28 64 00 00 0a b7 13 05 11 05 09 d8 08 d8 13 05 11 04 23 00 00 00 00 00 00 f0 3f 58 13 04 11 04 23 00 00 00 00 00 c2 e6 40 31 ba}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCD_2147810498_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCD!MTB"
        threat_id = "2147810498"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$e96e8c18-77e3-49cc-8f76-e264961bb5c1" ascii //weight: 10
        $x_10_2 = "$f886fced-320f-481b-8ed1-d1dae1d62932" ascii //weight: 10
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 49 6e 76 6f 6b 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NCG_2147810499_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCG!MTB"
        threat_id = "2147810499"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {16 13 05 2b 2b 02 11 04 11 05 6f 34 00 00 0a 13 08 12 08 28 35 00 00 0a 28 36 00 00 0a 16 08 09 1a 28 37 00 00 0a 09 1a 58 0d 11 05 17 58 13 05 11 05 06 32 d0}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCG_2147810499_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCG!MTB"
        threat_id = "2147810499"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$0f2409c3-88f0-4881-aa4d-49a41c01c985" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "RijndaelManaged" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCH_2147810500_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCH!MTB"
        threat_id = "2147810500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 00 20 ?? ?? ?? 00 8d ?? ?? ?? 01 0c 00 00 73 ?? ?? ?? 0a 0d 00 00 07 08 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 13 04 11 04 16 fe 02 13 05 11 05 2c 0d 00 09 08 16 11 04 6f ?? ?? ?? 0a 00 00 00 11 04 16 fe 02 13 06 11 06 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "73bc957-8501-44ad-9666-949813b7ef1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCI_2147810501_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCI!MTB"
        threat_id = "2147810501"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 7e ?? ?? ?? 04 06 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 18 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 80 ?? ?? ?? 04 02 28 ?? ?? ?? 06 0c 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 00 08 0d 2b 00 09 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {00 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MC_2147810507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MC!MTB"
        threat_id = "2147810507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 7d a2 dd 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 91 00 00 00 19 00 00 00 ad}  //weight: 10, accuracy: High
        $x_1_2 = "TraceLevel" ascii //weight: 1
        $x_1_3 = "LoadAutoRun" ascii //weight: 1
        $x_1_4 = "listView1_MouseDown" ascii //weight: 1
        $x_1_5 = "EffectiveKeySize" ascii //weight: 1
        $x_1_6 = "VirtualMemoryWrite" ascii //weight: 1
        $x_1_7 = "KillProcess" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MC_2147810507_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MC!MTB"
        threat_id = "2147810507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "WinExec" ascii //weight: 3
        $x_3_2 = "lpCmdLine" ascii //weight: 3
        $x_3_3 = "powershell" ascii //weight: 3
        $x_3_4 = "'Down' + 'load' + 'Str' + 'ing'" wide //weight: 3
        $x_3_5 = "test-connection -comp google.com -count 1 -Quiet" ascii //weight: 3
        $x_3_6 = "Users\\Eng Moha" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MC_2147810507_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MC!MTB"
        threat_id = "2147810507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 1e d8 6f ?? ?? ?? 0a 00 09 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 00 09 02 7b ?? ?? ?? 04 8e 69 1e d8 6f ?? ?? ?? 0a 00 09 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 00 00 09 6f ?? ?? ?? 0a 13 04 00 03 73 ?? ?? ?? 0a 13 05 00 11 05 11 04 16 73 ?? ?? ?? 0a 13 06 03 8e 69 17 da 17 d6 8d ?? ?? ?? 01 13 07 11 06 11 07 16 03 8e 69 6f ?? ?? ?? 0a 13 08 11 07 11 08 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0a de}  //weight: 1, accuracy: Low
        $x_1_2 = "VirtualProtect" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "CreateEncryptor" ascii //weight: 1
        $x_1_5 = "MemoryStream" ascii //weight: 1
        $x_1_6 = "FlushFinalBlock" ascii //weight: 1
        $x_1_7 = "ToArray" ascii //weight: 1
        $x_1_8 = "cipher" wide //weight: 1
        $x_1_9 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDA_2147810554_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDA!MTB"
        threat_id = "2147810554"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 29 00 08 09 11 04 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 17 13 08 07 11 07 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 09 11 09 2d cc}  //weight: 10, accuracy: Low
        $x_10_2 = {13 04 2b 29 00 08 09 11 04 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 17 13 09 07 11 08 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 0a 11 0a 2d cc}  //weight: 10, accuracy: Low
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NDD_2147810555_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDD!MTB"
        threat_id = "2147810555"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 2a 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 17 13 09 08 11 08 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 0a 11 0a 2d cb 07 17 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDD_2147810555_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDD!MTB"
        threat_id = "2147810555"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e 01 00 00 04 6f ?? ?? ?? 0a 17 33 2f 7e ?? ?? ?? 04 7e ?? ?? ?? 04 16 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 7e ?? ?? ?? 04 16 6f ?? ?? ?? 0a 28 ?? ?? ?? 06}  //weight: 5, accuracy: Low
        $x_5_2 = {06 03 07 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 18 58 0b 07 03 6f ?? ?? ?? 0a 32 de}  //weight: 5, accuracy: Low
        $x_1_3 = "StageInstruction_s" ascii //weight: 1
        $x_1_4 = "Qrkyctacqqofniomrukrkpx" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DYO_2147810558_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DYO!MTB"
        threat_id = "2147810558"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$A9DC88BE-9B45-43FA-98C3-1EE86A4CB870" ascii //weight: 10
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DZB_2147810559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZB!MTB"
        threat_id = "2147810559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Bu-ni--fu_T--ex--tBo---x" wide //weight: 1
        $x_1_2 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 49 6e 76 6f 6b 65}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 4d 65 74 68 6f 64}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DZD_2147810560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DZD!MTB"
        threat_id = "2147810560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$509fbe83-7ed5-4906-8694-7f5e99824968" ascii //weight: 10
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64}  //weight: 1, accuracy: High
        $x_1_8 = {00 49 6e 76 6f 6b 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEG_2147810592_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEG!MTB"
        threat_id = "2147810592"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 ff c4 06 f7 d1 84 ff a6 ae ff a6 05 9f 7f c1 cf 7e 3a 87 fb a9 0b 3e fb 82 4f 5a f0 77 2f 60 e3 5f b1 e0 5f 18 b8 af b5 e0 9b 2d f8 77 16 7c}  //weight: 1, accuracy: High
        $x_1_2 = {0c d3 2f 0d fa b4 63 b7 7b 9e 83 b8 a2 d3 6f d5 cb 73 10 ee 1b 93 e7 b9 ce a6 01 4d 97 e7 20 3c a7 8f ae bf c1 12 68 ba 3c 07 61 ff 14 5d de 3b}  //weight: 1, accuracy: High
        $x_1_3 = {75 b2 63 c0 be b5 63 ee a5 47 ff ce 1f 69 87 d6 b7 e3 2b 76 de db 6f d2 5f 52 2f 79 2a f5 52 de 72 e3 9f 96 1b bc 7b ae b3 fc 2a 8e 1e ed 37 d1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEF_2147810593_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEF!MTB"
        threat_id = "2147810593"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 06 b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEA_2147810594_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEA!MTB"
        threat_id = "2147810594"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ed2294c0-4783-4bcc-add3-e49c30a813f1" ascii //weight: 1
        $x_1_2 = {00 4c 65 76 65 6c 00 70 6f 00 4f 30 4f 30 4f 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 73}  //weight: 1, accuracy: High
        $x_1_8 = {00 4f 30 4f 30 00 4f 30 4f 30 4f 30 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDE_2147810619_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDE!MTB"
        threat_id = "2147810619"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 22 11 06 06 07 6f ?? ?? ?? 0a 13 07 11 07 28 ?? ?? ?? 0a 13 08 11 04 11 08 d2 6f ?? ?? ?? 0a 07 17 58 0b 07 17 fe 04 13 09 11 09 2d d4 09}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDG_2147810620_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDG!MTB"
        threat_id = "2147810620"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {df 02 ea 02 05 03 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 ef 02 df 02 df 02 df 02 df 02 df 02 df}  //weight: 1, accuracy: High
        $x_1_2 = {03 ec 02 e7 02 00 03 05 03 e0 02 f2 02 eb 02 ce 02 06 03 f4 02 e5 02 06 03 0e 03 01 03 17 03 e0}  //weight: 1, accuracy: High
        $x_1_3 = {02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 ed 02 df 02 df 02 df 02 07 03 e3 02 ea 02 df 02 ef 02 05 03 df 02 df 02 e2 02 0d 03 df 02 df 02 df}  //weight: 1, accuracy: High
        $x_1_4 = {02 ce 02 13 03 15 03 df 02 df 02 f5 02 f1 02 14 03 11 03 e1 02 f6 02 f3 02 e8 02 df 02 df 02 df 02 e0 02 00 03}  //weight: 1, accuracy: High
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "I_0000003" ascii //weight: 1
        $x_1_7 = "I_0000008" ascii //weight: 1
        $x_1_8 = "I_0203" ascii //weight: 1
        $x_1_9 = "I_093123123" ascii //weight: 1
        $x_1_10 = "Bu-ni--fu_T--ex--tBo---x" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDI_2147810621_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDI!MTB"
        threat_id = "2147810621"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#falkfskgdfgdfgdfgdfgsfkkksxvcxfgffkkuihiodsdgag.dll#" ascii //weight: 1
        $x_1_2 = "#fsdsfddfgdfgdsffsdxvfskahfhfankkkasf#" ascii //weight: 1
        $x_1_3 = "#fafdasgsffgdfgdfsdfdkgcfioioaaaaaoaaadsssaf.dll#" ascii //weight: 1
        $x_1_4 = "goioxgfdgvfsdffsfsfadkggfksdssgbsv" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAH_2147810707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAH!MTB"
        threat_id = "2147810707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 95 28 ?? ?? ?? 0a 0c 16 0d 2b 0e 06 07 1a 5a 09 58 08 09 91 9c 09 17 58 0d 09 08 8e 69 fe 04 13 04 11 04 2d e6 00 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 79 70 74 6f 53 74 72 65 61 6d 4d 6f 64 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAH_2147810707_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAH!MTB"
        threat_id = "2147810707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {13 11 08 11 04 07 11 04 9a 1f 10 28 ?? 00 00 0a d2 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 2a 11 2a 3a}  //weight: 2, accuracy: Low
        $x_2_2 = {16 13 05 11 05 16 fe 01 13 12 11 12 2c 05 17 13 05 2b 12 16 25 13 05 13 13 11 13 2c 05 17 13 05 2b 03 17 13 05 17 13 06 11 06 16 fe 01 13 14 11 14 2c 05 17 13 06 2b 12}  //weight: 2, accuracy: High
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAI_2147810708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAI!MTB"
        threat_id = "2147810708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {25 16 1f 25 9d 6f ?? 00 00 0a 0b 07 8e 69 8d ?? 00 00 01 0c 16 0d 2b 11 08 09 07 09 9a 1f 10 28 ?? 00 00 0a 9c 09 17 58 0d 09 07 8e 69 32 e9}  //weight: 3, accuracy: Low
        $x_1_2 = "GetObject" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAI_2147810708_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAI!MTB"
        threat_id = "2147810708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 0a 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b3 0c 00 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_3 = "Bunifu_TextBox" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAV_2147810709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAV!MTB"
        threat_id = "2147810709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0b 16 0c 2b 1f 00 07 08 02 08 91 6e 08 06 5d 28 ?? 00 00 06 6a 59 20 ff 00 00 00 6a 5f d2 9c 00 08 17 58 0c 08 02 8e 69 fe 04 13 04 11 04 2d d5}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAV_2147810709_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAV!MTB"
        threat_id = "2147810709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 21 11 04 06 07 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 09 11 06 d2 6f ?? ?? ?? 0a 07 17 58 0b 07 17 fe 04 13 07 11 07 2d d5 08 17 58 0c 06 17 58 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDB_2147810753_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDB!MTB"
        threat_id = "2147810753"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "MZAAAAAAAAAAAAAAAAAAA" ascii //weight: 10
        $x_1_2 = "O0O0O" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "ColorTranslator" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "ToArray" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_10 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NDC_2147810754_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDC!MTB"
        threat_id = "2147810754"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$607ED2F6-BED1-4030-BA37-55EBB83A2D73" ascii //weight: 10
        $x_10_2 = "$ed2294c0-4783-4bcc-add3-e49c30a813f1" ascii //weight: 10
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NDL_2147810773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDL!MTB"
        threat_id = "2147810773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 29 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 17 13 07 07 11 06 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d cc 06 17 58 0a 00 09 17 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDP_2147810774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDP!MTB"
        threat_id = "2147810774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 11 05 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 17 13 08 08 11 07 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d cb}  //weight: 1, accuracy: Low
        $x_1_2 = "O0O0O" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EREGA_2147810785_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EREGA!MTB"
        threat_id = "2147810785"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {d0 24 00 00 01 28 ?? ?? ?? 0a 72 a3 04 00 70 20 00 01 00 00 14 14 17 8d 10 00 00 01 25 16 02 a2 28 ?? ?? ?? 0a 74 24 00 00 01 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBF_2147810789_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBF!MTB"
        threat_id = "2147810789"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0b bf f2 5b 5f f0 77 5d f0 85 0b 7e 8d 97 63 f0 6b ae eb eb cf 57 40 d7 ff e2 38 3f c1 1f 74 c0 fd bf 09 df 63 5d ff 86 17 7c 9d 0b fe a5 97 73}  //weight: 1, accuracy: High
        $x_1_2 = {1d 9f 75 0e 3e e3 77 ea 33 8e 3a 3f f1 99 a7 f1 b9 9e 7c e6 db 3b 3e ef 80 e1 73 9f 3f f9 cc 0d 77 7c ea 04 be d6 83 d1 1a c7 77 7c ee 37 f1 ed}  //weight: 1, accuracy: High
        $x_1_3 = {3a 3e 1b 8f f2 74 cb cf 9e 67 fd 6d fc b9 c7 72 cc 9e 47 d7 9e 9b 39 06 de 4d 72 74 8f ec 98 fd bb 7e d4 0f db de 9d 5f f9 f9 ec b8 69 bc 44 57}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBE_2147810790_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBE!MTB"
        threat_id = "2147810790"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 06 b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBB_2147810791_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBB!MTB"
        threat_id = "2147810791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3e97c84d-6270-4238-966a-ad7cd0449c31" ascii //weight: 1
        $x_1_2 = {00 43 6c 61 73 73 35 5f 44 65 63 72 79 70 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 6c 61 73 73 38 5f 41 6e 74 69 56 4d 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 6c 61 73 73 39 5f 46 61 6b 65 4d 65 73 73 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 6c 61 73 73 31 5f 50 72 65 53 74 61 72 74 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDT_2147810901_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDT!MTB"
        threat_id = "2147810901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fasffssasfdsfsfgdffkklvcljigfdddddddssaf.dll#" ascii //weight: 1
        $x_1_2 = "#ijfakkgffsfdsfvxdsfsgk.dll#" ascii //weight: 1
        $x_1_3 = "favcxsgdsdfgdfdssfffffffgs" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBN_2147810926_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBN!MTB"
        threat_id = "2147810926"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 09 11 04 6f ?? ?? ?? 0a 13 05 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 20 00 01 00 00 14 14 17 8d ?? ?? ?? 01 25 16 11 05 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 06 07 09 11 06 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d a0}  //weight: 10, accuracy: Low
        $x_10_2 = {16 0b 2b 55 11 04 06 07 6f ?? ?? ?? 0a 13 05 d0 ?? ?? ?? 01 28 ?? ?? ?? 0a 20 ?? ?? ?? 8e 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 20 00 01 00 00 14 14 17 8d ?? ?? ?? 01 25 16 11 05 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 06 09 06 11 06 d2 6f ?? ?? ?? 0a 07 17 58 0b 07 17 fe 04 13 07 11 07 2d a1}  //weight: 10, accuracy: Low
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NDH_2147810957_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDH!MTB"
        threat_id = "2147810957"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$a12093be-6fda-48c1-9b1d-01d449a707fe" ascii //weight: 1
        $x_1_2 = "System.Windows.Forms.Form" ascii //weight: 1
        $x_1_3 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
        $x_1_9 = "FromBase64" ascii //weight: 1
        $x_1_10 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEA_2147810969_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEA!MTB"
        threat_id = "2147810969"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 29 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 08 11 04 11 07 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d cc 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {16 0c 2b 23 11 05 07 08 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 11 04 07 11 07 d2 6f ?? ?? ?? 0a 08 17 58 0c 08 17 fe 04 13 08 11 08 2d d3 09 17 58 0d 07 17 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEA_2147810969_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEA!MTB"
        threat_id = "2147810969"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "U09GVFdBUkVcUG9saWNpZXNcR29vZ2xlXENocm9tZQ==" wide //weight: 1
        $x_1_2 = "NjM5NTlmODgtNjBmYy00MTFmLTkzZWQtOGRmY2Q0Y2RmYjg2" wide //weight: 1
        $x_1_3 = "Q2xvdWRNYW5hZ2VtZW50RW5yb2xsbWVudFRva2Vu" wide //weight: 1
        $x_1_4 = "/C choice /C Y /N /D Y /T 3 & Del" wide //weight: 1
        $x_1_5 = "geti.php" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NED_2147810970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NED!MTB"
        threat_id = "2147810970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 05 2b 29 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 0f 11 0f 28 ?? ?? ?? 0a 13 10 08 11 04 11 10 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 11 11 11 2d cc 07 17 58 0b 00 11 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NED_2147810970_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NED!MTB"
        threat_id = "2147810970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Collor Palletes" ascii //weight: 1
        $x_1_2 = "v4.0.30319" ascii //weight: 1
        $x_1_3 = "remove_DoWork" ascii //weight: 1
        $x_1_4 = "b77a5c561934e089PADPA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDN_2147811059_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDN!MTB"
        threat_id = "2147811059"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 16 20 00 10 00 00 6f ?? ?? ?? 0a 0c 08 16 fe 02 13 05 11 05 2c 0a 06 11 04 16 08 6f ?? ?? ?? 0a 08 16 fe 02 13 06 11 06 2d d3}  //weight: 1, accuracy: Low
        $x_1_2 = "$573bc957-8501-44ad-6544-949813b7ef12" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDS_2147811060_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDS!MTB"
        threat_id = "2147811060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "t6zcg6hbpabegrpsuf8dh3bd9h4gf3sv" ascii //weight: 1
        $x_1_2 = "l11iIIlIi1iI1" ascii //weight: 1
        $x_1_3 = "ygmu3r9veejwjh7ja2pp2nyxk927suyl" ascii //weight: 1
        $x_1_4 = "iilIIiiiliIl" ascii //weight: 1
        $x_1_5 = "ii1i1i1IIlll" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ColorTranslator" ascii //weight: 1
        $x_1_8 = "ToWin32" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDU_2147811061_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDU!MTB"
        threat_id = "2147811061"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 08 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0b 08 6f ?? ?? ?? 0a 00 73 ?? ?? ?? 0a 0d 09 07 6f ?? ?? ?? 0a 00 09 04 6f ?? ?? ?? 0a 00 09 05 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 13 04 11 04 02 16 02 8e 69 6f ?? ?? ?? 0a 13 05 09 6f ?? ?? ?? 0a 00 11 05 0a 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {55 00 6c 00 58 00 49 00 6b 00 62 00 6e 00 70 00 30 00 56 00 4e 00 75 00 59 00 75 00 44 00 51 00 6f 00 2f 00 51 00 55 00 70 00 46 00 63 00 6c 00 42 00 70 00 57}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NDV_2147811062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NDV!MTB"
        threat_id = "2147811062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {42 00 75 00 6e 00 69 00 66 00 75 00 5f 00 54 00 65 00 78 00 74 00 42 00 6f 00 78}  //weight: 10, accuracy: High
        $x_10_2 = "fe53e141-8812-490f-ae7a-5627a794092e" ascii //weight: 10
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 5 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NEB_2147811063_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEB!MTB"
        threat_id = "2147811063"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 00 03 05 1f 16 5d 6f 65 00 00 0a 61 13 01 38 00 00 00 00 38 12 00 00 00 38 0d 00 00 00 00 02 05 04 5d 91 13 00 38 d5 ff ff ff}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEB_2147811063_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEB!MTB"
        threat_id = "2147811063"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "9283e31c-7829-4d6d-9ce6-7c6b0a70e4a7" ascii //weight: 10
        $x_10_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 10, accuracy: High
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NEC_2147811064_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEC!MTB"
        threat_id = "2147811064"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 0a 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b3}  //weight: 1, accuracy: Low
        $x_1_2 = {f4 02 0f 03 ef 02 df 02 df 02 eb 02 df 02 df 02 df 02 df 02 e3 02 df 02 df 02 df 02 df 02 cd 02 cd 02 d6 02 df 02 df 02 ea 02 05 03 df 02 df 02 df}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEC_2147811064_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEC!MTB"
        threat_id = "2147811064"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "/xC timexout /nobrxeak /t 19" wide //weight: 1
        $x_1_2 = "ScanDocument-pdf_Velfcvwi.jpg" wide //weight: 1
        $x_1_3 = "Kujgwd" wide //weight: 1
        $x_1_4 = "Iezdfqoyhca" wide //weight: 1
        $x_1_5 = "Tgauipmrxrkdjdyir" wide //weight: 1
        $x_1_6 = "Vqmgkp" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEM_2147811085_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEM!MTB"
        threat_id = "2147811085"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 27 00 08 09 11 04 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 07 09 11 06 d2 6f ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d ce 06 17 58 0a 00 09 17 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEM_2147811085_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEM!MTB"
        threat_id = "2147811085"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "VjJ0ak5XUkdiRmhpU0ZacVpXNW5kMXBWYUZKUVVUMDk=" wide //weight: 5
        $x_5_2 = "V1hwT1YyRldRa2xWYWxKclVWUXdPUT09" wide //weight: 5
        $x_5_3 = "V1ZSS1YwNVdRa2xWYWxKclVWUXdPUT09" wide //weight: 5
        $x_5_4 = "VjFab1MyRnRSa1ZsUkZwb1YwVkZPUT09" wide //weight: 5
        $x_5_5 = "V1dwT1EwMUhSbGhQV0ZacVpXNW5kMXBWYUZKUVVUMDk=" wide //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAX_2147811091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAX!MTB"
        threat_id = "2147811091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e0 02 e7 02 eb 02 e7 02 e2 02 df 02 df 02 df 02 05 03 0b 03 df 02 eb 02 df 02 df 02 e1 02 05 03 e6 02 df 02 df 02 df 02 10 03 e5 02 f7 02 ce 02 e7 02 df 02 df 02 df 02}  //weight: 1, accuracy: High
        $x_1_2 = "Bunifu_TextBox" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAX_2147811091_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAX!MTB"
        threat_id = "2147811091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 15 00 00 06 0a 28 ?? 00 00 0a 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0b dd 03 00 00 00 26 de db 07 2a}  //weight: 2, accuracy: Low
        $x_2_2 = "WindowsFormsApp87.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBA_2147811092_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBA!MTB"
        threat_id = "2147811092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 08 02 08 91 03 08 03 8e 69 5d 91 08 04 03 8e 69 5d d6 04 5f 61 b4 61 9c 08 17 d6 0c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBG_2147811093_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBG!MTB"
        threat_id = "2147811093"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 4c 65 76 65 6c 00 70 6f 00 4f 30 4f 30 4f 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 73}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 69 73 70 6c 61 79 4e 61 6d 65 00 4f 30 4f 30 00 4f 30 4f 30 4f 30 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBX_2147811125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBX!MTB"
        threat_id = "2147811125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {da f8 c1 0e 7c f9 81 fb ea 07 be f5 81 6f 73 e0 bb 1d f8 c4 07 be f3 81 ef 7a e0 3b 1d f8 56 4f cf df e4 c0 77 38 a0 fc 9b 3d e5 bf e3 13 a0 fb}  //weight: 1, accuracy: High
        $x_1_2 = {a5 d7 7e af 5f 1d 7c c9 da 86 ff e7 a7 62 d9 c4 a9 d7 1a c5 bc a8 7e f5 90 5b 3c e7 bf d5 45 1f f5 cf 71 a8 7e f6 d4 d7 f7 78 a6 1f d4 8e 7d 36}  //weight: 1, accuracy: High
        $x_1_3 = {c7 1a 27 c5 ab 6d 9f e4 e4 df 7b 5c bf ae 78 d5 7e 38 7f 2b 5f 1a 9d 73 19 69 ed 98 e7 33 a0 ff f7 d4 79 f6 4b ed 73 6b 5e df 71 33 7f ac 3c fa}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBY_2147811126_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBY!MTB"
        threat_id = "2147811126"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ECH_2147811127_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ECH!MTB"
        threat_id = "2147811127"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {14 74 fd 7d c6 f9 15 fc 75 17 b8 2f 4c f8 4f d6 f5 1f 74 e0 4f 38 f0 3f bd 3b 87 fb 1e 07 7e df 03 3f fe c0 9f 74 80 8d bf db 81 bf 73 e0 fe 81}  //weight: 1, accuracy: High
        $x_1_2 = {ac c3 5c 3b f6 bd 4e 6d d6 1b ce bd 07 e2 da 73 46 d7 ee 1f ac c5 bd d7 03 ef dc d1 fc 97 0c 7d 98 8f d1 aa b3 de 55 c1 4b e6 95 2c df 06 c0 5b}  //weight: 1, accuracy: High
        $x_1_3 = {97 e8 aa 53 d1 d5 be fb cd 3f bb df f0 9e 85 cf f6 e7 f2 e8 b5 e3 26 3d f2 6b e3 32 3d 3a 6e 68 3d d3 7b 4f f9 bb ff a9 92 fc fa db f6 ed 3a d6}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ECN_2147811245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ECN!MTB"
        threat_id = "2147811245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 0a 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8 0c 00 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "ifu_T" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ECM_2147811246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ECM!MTB"
        threat_id = "2147811246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e5 02 06 03 eb 02 e8 02 e9 02 d4 02 0d 03 05 03 01 03 df 02 e7 02 df 02 df 02 e1 02 df 02 e9 02 df 02 05 03 df 02 df 02 e9 02 e0 02 ef 02 df 02 df 02 df 02 f7 02 e2 02 e7 02 ea 02 d6 02}  //weight: 1, accuracy: High
        $x_1_2 = "ifu_T" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGA_2147811325_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGA!MTB"
        threat_id = "2147811325"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 2b 4b 00 08 14 72 ?? ?? ?? 70 18 8d ?? ?? ?? 01 25 16 09 8c ?? ?? ?? 01 a2 25 17 11 04 8c ?? ?? ?? 01 a2 14 14 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 05 11 05 28 ?? ?? ?? 0a 13 06 02 07 09 11 06 d2 28 ?? ?? ?? 06 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 07 11 07 2d aa 06 17 58 0a 00 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGD_2147811326_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGD!MTB"
        threat_id = "2147811326"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 2b 61 16 0b 2b 4b 11 04 14 20 ?? ?? ?? ?? 28 ?? ?? ?? ?? 18 8d ?? ?? ?? 01 25 16 06 8c ?? ?? ?? 01 a2 25 17 07 8c ?? ?? ?? 01 a2 14 14 28 ?? ?? ?? 0a a5 ?? ?? ?? 01 13 05 11 05 28 ?? ?? ?? 0a 13 06 02 09 06 11 06 d2 28 ?? ?? ?? 06 07 17 58 0b 07 17 fe 04 13 07 11 07 2d ab 08 17 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGD_2147811326_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGD!MTB"
        threat_id = "2147811326"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 0a 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
        $x_1_2 = "$0898E33D-CE5D-40A8-9657-4662416735AE" ascii //weight: 1
        $x_1_3 = {5f 41 00 5f 42 00 5f 43 00 5f 44 00 5f 45 00 5f 46}  //weight: 1, accuracy: High
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEL_2147811327_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEL!MTB"
        threat_id = "2147811327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "AuxiWeb_MSprt" ascii //weight: 3
        $x_3_2 = "HPZ3Rws_Web_Hfo32" ascii //weight: 3
        $x_3_3 = "kbd_Potca" ascii //weight: 3
        $x_3_4 = "ep0ices_PropdMtp" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEL_2147811327_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEL!MTB"
        threat_id = "2147811327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "A75A93C4-C664-4265-BAA5-C648B045F520" ascii //weight: 1
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEX_2147811328_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEX!MTB"
        threat_id = "2147811328"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "D333BAAC-0743-4F61-9C9C-368C4264BD75" ascii //weight: 10
        $x_10_2 = "Span Tag Remover" ascii //weight: 10
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 5 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EDD_2147811376_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EDD!MTB"
        threat_id = "2147811376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 09 07 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 09 17 58 0d 09 08 8e 69 fe 04 13 04 11 04 2d da}  //weight: 10, accuracy: Low
        $x_10_2 = {07 08 06 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 08 17 58 0c 08 07 8e 69 fe 04 0d 09 2d dc}  //weight: 10, accuracy: Low
        $x_1_3 = {00 44 69 73 70 6c 61 79 4e 61 6d 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EDE_2147811377_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EDE!MTB"
        threat_id = "2147811377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 06 b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 06 b7 28 ?? ?? ?? 06 84 28 30 00 00 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c 20 01 00 00 00 16}  //weight: 1, accuracy: Low
        $x_1_2 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 06 9c 09 03 28 ?? ?? ?? 06 17 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EDF_2147811378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EDF!MTB"
        threat_id = "2147811378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e7 02 e1 02 08 03 0b 03 09 03 f6 02 f5 02 f8 02 e3 02 04 03 01 03 e5 02 e3 02 ea 02 e6 02 15 03 11 03 f2 02 e1 02 f2 02 06 03 06 03 cd 02 cd 02 cd 02 cd 02 df 02 0d 03 d3 02 0e 03 e4 02 cf 02 07 03}  //weight: 1, accuracy: High
        $x_1_2 = "GetMethod" wide //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EDI_2147811379_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EDI!MTB"
        threat_id = "2147811379"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 06 08 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "O0.zC" wide //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGG_2147811441_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGG!MTB"
        threat_id = "2147811441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cmdaaaasssssssssssssssssssssssssssssssssssssssssssssssssaaaaa.exe" ascii //weight: 1
        $x_1_2 = "http://gffggfffffrograms/" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "DESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EBZ_2147811483_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EBZ!MTB"
        threat_id = "2147811483"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 4c 65 76 65 6c 00 70 6f 00 51 31 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 6f 6c 6f 72 54 72 61 6e 73 6c 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 57 69 6e 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 69 73 70 6c 61 79 4e 61 6d 65 00 51 32 00 51 33 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEP_2147811559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEP!MTB"
        threat_id = "2147811559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cABpAG4AZwAgAHkAYQBoAG8AbwAuAGMAbwBtADsAIABwA" ascii //weight: 1
        $x_1_2 = "AOwBwAGkAbgBnACAAeQBhAGgAbwBvAC4AYwBvAG0AOwA=" ascii //weight: 1
        $x_1_3 = "https://anarchyrsps.live/" ascii //weight: 1
        $x_1_4 = "$54e25b64-1d62-40ea-88cd-1720da0d4327" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "GetCurrentProcess" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HMDL_2147811560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HMDL!MTB"
        threat_id = "2147811560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 08 58 9e 08 17 58 0c 08 20 ?? ?? ?? 01 32}  //weight: 1, accuracy: Low
        $x_1_2 = "$4b6e78b5-7ac5-7a8a-25b8-3c5b718c85a2" ascii //weight: 1
        $x_1_3 = "timate System Pack64 by AxirtSoft" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGB_2147811561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGB!MTB"
        threat_id = "2147811561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "29"
        strings_accuracy = "High"
    strings:
        $x_20_1 = "$654F715E-B29A-477C-A0C3-861AB21804C7" ascii //weight: 20
        $x_20_2 = "$af2f89f8-7e62-4d93-bbfc-06d03addd89d" ascii //weight: 20
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "S_0000003" ascii //weight: 1
        $x_1_5 = "S_0000004" ascii //weight: 1
        $x_1_6 = "S_000001" ascii //weight: 1
        $x_1_7 = "S_000002" ascii //weight: 1
        $x_1_8 = "LateGet" ascii //weight: 1
        $x_1_9 = "ToWin32" ascii //weight: 1
        $x_1_10 = "ColorTranslator" ascii //weight: 1
        $x_1_11 = "ToArray" ascii //weight: 1
        $x_1_12 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 9 of ($x_1_*))) or
            ((2 of ($x_20_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NGC_2147811562_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGC!MTB"
        threat_id = "2147811562"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "0E1FBA0E00B409CD21B8014CCD21546869732070726F677261" ascii //weight: 1
        $x_1_2 = "2072756E20696E20444F53206D6F64652E0D0" ascii //weight: 1
        $x_1_3 = "2E7465787400000014410" ascii //weight: 1
        $x_1_4 = "4D5A90000300000004000000FFFF0000B8" ascii //weight: 1
        $x_1_5 = "4C015100E03E00000800930074095601510" ascii //weight: 1
        $x_1_6 = "0061006D0065000000530061006600650053" ascii //weight: 1
        $x_1_7 = "6F006E00000034002E0030002E0035002E003" ascii //weight: 1
        $x_1_8 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGC_2147811562_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGC!MTB"
        threat_id = "2147811562"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {f2 02 f4 02 0f 03 ef 02 df 02 df 02 eb 02 df 02 df 02 df 02 df 02 e3 02 df 02 df 02 df 02 df 02 cd 02 cd 02 d6 02 df 02 df 02 ea 02 05 03 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 ef}  //weight: 1, accuracy: High
        $x_1_2 = {03 05 03 d2 02 df 02 12 03 df 02 0c 03 ec 02 e7 02 00 03 05 03 e0 02 f2 02 eb 02 ce 02 06 03 f4 02 e5 02 06 03 0e 03 01 03 17 03 e0 02 15 03 01}  //weight: 1, accuracy: High
        $x_1_3 = {02 07 03 e3 02 ea 02 df 02 ef 02 05 03 df 02 df 02 e2 02 0d 03 df 02 df 02 df 02 df 02 e5 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 e2}  //weight: 1, accuracy: High
        $x_1_4 = {02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 e0 02 ef 02 df 02 df 02 df 02 eb 02 df 02 df 02 df 02 df 02 e3 02 e2 02 05 03 df 02 df 02 df 02 df 02 df 02}  //weight: 1, accuracy: High
        $x_1_5 = {12 03 df 02 e5 02 e7 02 df 02 00 03 df 02 e0 02 d3 02 df 02 e1 02 df 02 df 02 f4 02 05 03 e0 02 0a 03 df 02 e6 02 e7 02 df 02 01 03 15 03 e0 02 0e 03 df 02 e5}  //weight: 1, accuracy: High
        $x_1_6 = {5f 41 00 5f 42 00 5f 43 00 5f 44 00 5f 45 00 5f 46}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGE_2147811563_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGE!MTB"
        threat_id = "2147811563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {1f 10 8d 5b 00 00 01 13 14 11 09 28 ?? ?? 00 0a 16 11 14 16 1a 28 ?? ?? 00 0a 11 0a 28 ?? ?? 00 0a 16 11 14 1a 1a 28 ?? ?? 00 0a 11 0b 28 ?? ?? 00 0a 16 11 14 1e 1a 28 ?? ?? 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "PerfectScript 19" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGE_2147811563_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGE!MTB"
        threat_id = "2147811563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 95 00 00 0a 26 73 ?? 00 00 0a 26 08 28 ?? 00 00 0a 02 6f ?? 00 00 0a 6f ?? 00 00 0a 73 ?? 00 00 0a 26 73 ?? 00 00 0a 26 08 06 6f ?? 00 00 0a 08 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 6f ?? 00 00 0a 0d 73 ?? 00 00 0a 26 73 ?? 00 00 0a 26 73 ?? 00 00 0a 26 73 ?? 00 00 0a 26 07 73 ?? 00 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "Ww0x4_1pq2ATTjr" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGE_2147811563_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGE!MTB"
        threat_id = "2147811563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 8e 69 8d ?? ?? ?? 01 13 04 09 11 04 16 03 8e 69 6f ?? ?? ?? 0a 13 05 11 04 11 05 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 13 06 de 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {42 00 30 04 20 00 6c 00 6f 00 42 04 20 00 32 04 30 04 48 04 63 00 33 04 30 04 20 00 31 04 40 04 3e 04 32 04 6b 00 20 00 32 04 4b 04 20 00 53 00 43 04 34 04}  //weight: 1, accuracy: High
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = {4b 00 30 04 36 04 3d 04 65 00 20 00 30 04 34 04 37 04 3d 04 30 04 79 00 4b 04 46 04 4c 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGM_2147811572_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGM!MTB"
        threat_id = "2147811572"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 0a 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
        $x_1_2 = "BuVnVifVu_VTeVxtVBoVx" ascii //weight: 1
        $x_1_3 = {49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65}  //weight: 1, accuracy: High
        $x_1_4 = {df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 df 02 ef 02 df 02 df 02 df 02 df 02 df}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EEC_2147811587_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EEC!MTB"
        threat_id = "2147811587"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 09 17 58 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "W4.Hc" wide //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 69 73 70 6c 61 79 4e 61 6d 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EEA_2147811588_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EEA!MTB"
        threat_id = "2147811588"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$588CF8B1-6157-4CCE-9B26-EB41185918E2" ascii //weight: 1
        $x_1_2 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 49 6e 76 6f 6b 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 4d 61 74 68 00 53 71 72 74 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_COR_2147811642_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.COR!MTB"
        threat_id = "2147811642"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {73 46 00 00 0a 0c 28 ?? ?? ?? 06 0d 16 13 04 2b 46 00 16 13 05 2b 2a 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 17 13 08 08 11 07 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 09 11 09 2d cb 07 17 58 0b 00 11 04 17 58 13 04 11 04 20 00 56 00 00 fe 04 13 0a 11 0a 2d ab 02 73 42 00 00 0a 7d 0a 00 00 04 02 73 42 00 00 0a 7d 0b 00 00 04 02 7b 06 00 00 04 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 0a 00 02 7b 05 00 00 04 18 6f ?? ?? ?? 0a 00 02 7b 05 00 00 04 18 6f ?? ?? ?? 0a 00 02 7b 05 00 00 04 20 a2 01 00 00 20 cc 00 00 00 73 4d 00 00 0a 6f ?? ?? ?? 0a 00 08}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EEF_2147811672_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EEF!MTB"
        threat_id = "2147811672"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 09 11 0b 11 08 11 0b 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 11 0b 17 58 13 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "W4.Hc" wide //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 69 73 70 6c 61 79 4e 61 6d 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EEG_2147811673_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EEG!MTB"
        threat_id = "2147811673"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e3 02 e3 02 e1 02 04 03 d2 02 e1 02 e4 02 14 03 d2 02 e0 02 e3 02 15 03 01 03 f0 02 e0 02 17 03 ce 02 e7 02 e5 02 f0 02 eb 02 ea 02 ed 02 e2 02 ea 02 c9 02 cd 02 cd 02 d6 02 03 03 e9 02 cd 02 f7 02}  //weight: 1, accuracy: High
        $x_1_2 = "GetExportedTypes" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHA_2147811704_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHA!MTB"
        threat_id = "2147811704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e 1f 00 00 04 72 ?? ?? 00 70 73 ?? ?? 00 0a 28 ?? ?? 00 0a 72 ?? ?? 00 70 28 ?? ?? 00 0a 6f ?? ?? 00 0a 73 ?? ?? 00 0a 25 6f ?? ?? 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "LINCA.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHA_2147811704_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHA!MTB"
        threat_id = "2147811704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 20 10 0f 00 00 28 ?? ?? ?? 06 5a 20 ?? ?? ?? 00 28 ?? ?? ?? 06 61 38 ?? ?? ?? ff 02 20 ?? ?? ?? 00 28 ?? ?? ?? 06 2b 00 28 ?? ?? ?? 2b 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "TRFSGBVCXFD" ascii //weight: 1
        $x_1_3 = "MJCKVKLUIOR" ascii //weight: 1
        $x_1_4 = "ProcessInformationClass" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHA_2147811704_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHA!MTB"
        threat_id = "2147811704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "sssssssssssfasadsssssss" ascii //weight: 1
        $x_1_2 = "http://gffggfffffrograms/" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "DESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHB_2147811705_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHB!MTB"
        threat_id = "2147811705"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f 32 05 00 0a 06 07 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0c 08 02 16 02 8e 69 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "MG.Office.Diagram" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHB_2147811705_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHB!MTB"
        threat_id = "2147811705"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fasdasdadvxfafdfdsgdfgdffsdfffafgsdddddokuijouilpoddddssaf.dll#" ascii //weight: 1
        $x_1_2 = "#faadasdsffgssasfdsfddfsfgdffkklvcljigfdddddddssaf.dll#" ascii //weight: 1
        $x_1_3 = "favcxsfdsadgfgddasdfgdfdssfffffffgs" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGL_2147811837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGL!MTB"
        threat_id = "2147811837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {07 6f ab 00 00 0a b4 13 09 11 09 02 18 91 fe 01 13 1d 11 1d 39 fd 00 00 00}  //weight: 5, accuracy: High
        $x_1_2 = "VTVXVYVZBodyDiagnostics" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGL_2147811837_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGL!MTB"
        threat_id = "2147811837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "0E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D206361" ascii //weight: 1
        $x_1_2 = "6E6F742062652072756E20696E20444F53206D6F64652E0D0D" ascii //weight: 1
        $x_1_3 = "9FFFFFFF0211017D0B00000438CDFFFFFF027B" ascii //weight: 1
        $x_1_4 = "FFFFFE0C0B00200A000000FE0C1B009C20BE" ascii //weight: 1
        $x_1_5 = "0065006D0062006C0079002000560065007200730069006F006" ascii //weight: 1
        $x_1_6 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGP_2147811838_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGP!MTB"
        threat_id = "2147811838"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {78 00 32 00 32 00 33 00 32 00 31 00 33 00 31 00 32 00 78 00 30 00 30 00 30 00 32 00 33 00 33 00 32}  //weight: 1, accuracy: High
        $x_1_2 = "hdffdeefas" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "DownloadData" ascii //weight: 1
        $x_1_6 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGQ_2147811839_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGQ!MTB"
        threat_id = "2147811839"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 1, accuracy: Low
        $x_1_2 = {57 69 6e 64 6f 77 73 46 6f 72 6d 73 41 70 70 [0-2] 2e 50 72 6f 70 65 72 74 69 65 73 2e 52 65 73 6f 75 72 63 65 73 2e 72 65 73 6f 75 72 63 65 73}  //weight: 1, accuracy: Low
        $x_1_3 = "C0AUwBsAGUAZQBwACAALQBzACAAMQA1AA==" ascii //weight: 1
        $x_1_4 = "-enc UwB0AGEAcgB0A" ascii //weight: 1
        $x_1_5 = "powershell" ascii //weight: 1
        $x_1_6 = "GzipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGI_2147811917_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGI!MTB"
        threat_id = "2147811917"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "integralbd.com/inquiry-cim.jpg" ascii //weight: 1
        $x_1_2 = "ZtmbDowZtmbnlZtmboadDZtmbataZtmb" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "WebClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EEY_2147812037_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EEY!MTB"
        threat_id = "2147812037"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 09 17 58 0d 09 20 00 58 00 00 fe 04 13 04 11 04 2d d8}  //weight: 1, accuracy: Low
        $x_1_2 = "`Load" wide //weight: 1
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EEZ_2147812038_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EEZ!MTB"
        threat_id = "2147812038"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {08 07 02 07 91 11 04 61 09 06 91 61 28 ?? ?? ?? 0a 9c 06 03 6f ?? ?? ?? 0a 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WIMB_2147812164_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WIMB!MTB"
        threat_id = "2147812164"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 13 05 2b 29 00 09 11 04 11 05 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 08 11 04 11 07 d2 6f ?? ?? ?? 0a 00 00 11 05 17 58 13 05 11 05 17 fe 04 13 08 11 08 2d cc 07 17 58 0b 00 11 04 17 58 13 04 11 04 20 00 56 00 00 fe 04 13 09 11 09 2d ac}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGK_2147812191_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGK!MTB"
        threat_id = "2147812191"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {42 00 61 00 63 00 6b 00 67 00 72 00 6f 00 75 00 6e 00 64 00 57 00 69 00 6e 00 64 00 6f 00 77 00 2e 00 78 00 61 00 6d 00 6c}  //weight: 10, accuracy: High
        $x_10_2 = "glgln79jp5gzgye68gp5tkfqqwtzv7qd" ascii //weight: 10
        $x_1_3 = "MotivateDesktop.aspx.ASPX.resources" ascii //weight: 1
        $x_1_4 = "MotivateDesktop.Properties.Resources" ascii //weight: 1
        $x_1_5 = "YuAo 2012" ascii //weight: 1
        $x_1_6 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NHC_2147812192_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHC!MTB"
        threat_id = "2147812192"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$0898E33D-CE5D-40A8-9657-4662416735AE" ascii //weight: 10
        $x_10_2 = "$b4be97f2-e443-49cc-9380-85f6460341dc" ascii //weight: 10
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 41 73 63 57 00}  //weight: 1, accuracy: High
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
        $x_1_10 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 8 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NHD_2147812193_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHD!MTB"
        threat_id = "2147812193"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 7e ?? ?? ?? 04 06 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 18 6f ?? ?? ?? 0a 00 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 80 ?? ?? ?? 04 02 28 ?? ?? ?? 06 0c 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 00 08 0d 2b 00 09 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "Helper_Classes" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHE_2147812194_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHE!MTB"
        threat_id = "2147812194"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 6e 11 08 6a 59 d4 11 04 1e 11 08 59 1e 5a 1f 3f 5f 64 20 ?? ?? ?? 00 6a 5f d2 9c 11 08 17 59 13 08}  //weight: 1, accuracy: Low
        $x_1_2 = "MotivateDesktop.Properties.Resources" ascii //weight: 1
        $x_1_3 = "YuAo 2012" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_9 = "DownloadFileAsync" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHG_2147812195_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHG!MTB"
        threat_id = "2147812195"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 8e 69 8d ?? ?? ?? 01 13 04 09 11 04 16 03 8e 69 6f ?? ?? ?? 0a 13 05 11 04 11 05 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 13 06 de 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {49 00 ce 03 c3 03 b5 03 20 00 c4 03 bf 03 bd 03 20 00 b4 03 c1 03 cc 03 bc 03 bf 03 20 00 c3 03 bf 03 c5 03 20 00 c3}  //weight: 1, accuracy: High
        $x_1_3 = "get_puppy_bark" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHI_2147812196_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHI!MTB"
        threat_id = "2147812196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$509411fe-bd7f-4b27-b242-aa541a98d0c4" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "GUI_Class.QQQQQ.resource" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFH_2147812229_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFH!MTB"
        threat_id = "2147812229"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 20 00 58 00 00 32 e0}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFF_2147812230_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFF!MTB"
        threat_id = "2147812230"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 04 11 04 28 ?? ?? ?? 0a 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 0c 00 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 10, accuracy: Low
        $x_1_2 = "Bu~~n~~if~~u_~~Te~~xt~~Bo~~x" wide //weight: 1
        $x_1_3 = "xoBtxeT_ufinuB" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EFE_2147812231_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFE!MTB"
        threat_id = "2147812231"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 11 04 07 11 04 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 20 00 58 00 00 fe 04}  //weight: 10, accuracy: Low
        $x_10_2 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 09 17 58 0d 09 20 00 58 00 00 fe 04}  //weight: 10, accuracy: Low
        $x_1_3 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NHM_2147812263_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHM!MTB"
        threat_id = "2147812263"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 20 00 58 00 00 fe 04 13 04 11 04 2d da}  //weight: 1, accuracy: Low
        $x_1_2 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFP_2147812313_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFP!MTB"
        threat_id = "2147812313"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 20 00 58 00 00}  //weight: 10, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFQ_2147812314_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFQ!MTB"
        threat_id = "2147812314"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$C4A72607-FEF6-49E7-B267-0EDE8699CCEF" ascii //weight: 10
        $x_10_2 = {00 43 68 61 72 41 72 72 61 79 00 4c 65 76 65 6c 00 70 6f 00 43 6f 6e 74 65 78 74 41 64 64 00}  //weight: 10, accuracy: High
        $x_1_3 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFO_2147812367_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFO!MTB"
        threat_id = "2147812367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "$9ba4b4f4-d51f-45a9-9e1d-1ae4b31edfd9" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "CreateEncryptor" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
        $x_1_8 = "ToBase64String" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPF_2147812383_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPF!MTB"
        threat_id = "2147812383"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0a 02 8e 69 0b 2b 0a 00 06 02 07 91 2b 18 00 2b 0b 07 25 17 59 0b 16 fe 02 0c 2b 03 00 2b f2 08 2d 02 2b 09 2b e1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPF_2147812383_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPF!MTB"
        threat_id = "2147812383"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "OfjhGetByOfjhteArrOfjhayAsyOfjhnc" wide //weight: 1
        $x_1_2 = "185.222.58.56" wide //weight: 1
        $x_1_3 = "Bufgj.png" wide //weight: 1
        $x_1_4 = "Sleep" wide //weight: 1
        $x_1_5 = "Gyecscnhkbyvjbgvrf" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFS_2147812395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFS!MTB"
        threat_id = "2147812395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 00 09 17 58 0d 09 20 00 58 00 00}  //weight: 10, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMDD502_2147812408_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMDD502!MTB"
        threat_id = "2147812408"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "9CD21B8014CCD21546869732070726F6" ascii //weight: 1
        $x_1_2 = "500FB0700000900001120F7FFEFE80A0" ascii //weight: 1
        $x_1_3 = "30516112FFE01035F2C3F1105282C00000A13057E1900000" ascii //weight: 1
        $x_1_4 = "C08162F0F2A04062517580A04082517580C919C110517592" ascii //weight: 1
        $x_1_5 = "A002E733100000680210000042A1B3004008801000011000" ascii //weight: 1
        $x_1_6 = "965904666666565666566656666659E061820A0B7AC62666" ascii //weight: 1
        $x_1_7 = "F945861580C11051758130511051F2033C41613042B0B061" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPI_2147812422_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPI!MTB"
        threat_id = "2147812422"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SrdsGetBySrdsteArrSrdsayAsySrdsnc" wide //weight: 1
        $x_1_2 = "185.222.58.56" wide //weight: 1
        $x_1_3 = "try.png" wide //weight: 1
        $x_1_4 = "powershell" wide //weight: 1
        $x_1_5 = "Qddywbxavgtbjaukcldrpmcm" wide //weight: 1
        $x_1_6 = "HttpClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPI_2147812422_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPI!MTB"
        threat_id = "2147812422"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "Alupol.png" wide //weight: 1
        $x_1_3 = "GetByteArrayAsync" wide //weight: 1
        $x_1_4 = "Sleep" wide //weight: 1
        $x_1_5 = "System.Threading.Thread" wide //weight: 1
        $x_1_6 = "Footecadibwhtsphnaavyon" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPI_2147812422_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPI!MTB"
        threat_id = "2147812422"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 00 00 00 02 00 00 01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00}  //weight: 10, accuracy: High
        $x_1_2 = "FileStream" ascii //weight: 1
        $x_1_3 = "get_Length" ascii //weight: 1
        $x_1_4 = "GetFiles" ascii //weight: 1
        $x_1_5 = "GetDirectories" ascii //weight: 1
        $x_1_6 = "Marshal" ascii //weight: 1
        $x_1_7 = "System.Text" ascii //weight: 1
        $x_1_8 = "Encoding" ascii //weight: 1
        $x_1_9 = "GetString" ascii //weight: 1
        $x_1_10 = "Environment" ascii //weight: 1
        $x_1_11 = "SpecialFolder" ascii //weight: 1
        $x_1_12 = "InitializeArray" ascii //weight: 1
        $x_1_13 = "Split" ascii //weight: 1
        $x_1_14 = "Concat" ascii //weight: 1
        $x_1_15 = "get_ASCII" ascii //weight: 1
        $x_1_16 = "get_Unicode" ascii //weight: 1
        $x_1_17 = "Remove" ascii //weight: 1
        $x_1_18 = "ValueType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIA_2147812433_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIA!MTB"
        threat_id = "2147812433"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Play splitscreen games over the internet" ascii //weight: 1
        $x_1_2 = "SplitPlay.Resources.resources" ascii //weight: 1
        $x_1_3 = "$de301ac4-4f07-402e-9a17-c71412e1906c" ascii //weight: 1
        $x_1_4 = "SplitPlay.My" ascii //weight: 1
        $x_1_5 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_6 = "Substring" ascii //weight: 1
        $x_1_7 = "ToCharArray" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFW_2147812477_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFW!MTB"
        threat_id = "2147812477"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03 08 17 58 03 8e 69 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 08 17 58 0c 08 6a 03 8e 69 17 59 6a 06 17 58 6e 5a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFV_2147812478_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFV!MTB"
        threat_id = "2147812478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {43 00 c5 03 bb 03 bf 03 b3 03 72 00 bc 03 ad 03 bd 03 bf 03 c2 03 20 00 bf 03 20 00 9a 03 cd 03 c1 03 b9 03 65 00 c2 03 2c 00 20 00 bf 03 20 00 b2 03 c1 03 ac 03 c7 03 61 00 c2 03}  //weight: 1, accuracy: High
        $x_1_2 = {4b 00 bd 03 b1 03 b8 03 65 00 c3 03 c4 03 b5 03 20 00 c4 03 b9 03 79 00}  //weight: 1, accuracy: High
        $x_1_3 = "trump" wide //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "ToUInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFX_2147812479_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFX!MTB"
        threat_id = "2147812479"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 04 91 13 05 08 04 03 8e 69 5d d6 04 5f 13 06 03 08 03 8e 69 5d 91 13 07 11 07 11 06 28 ?? ?? ?? 06 13 08 11 05 11 08 28 ?? ?? ?? 06 13 09 07 11 09 b4 6f ?? ?? ?? 0a 00 08 17 d6 0c 00 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = "System." wide //weight: 1
        $x_1_3 = "GetMethods" wide //weight: 1
        $x_1_4 = "GetTypes" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFR_2147812480_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFR!MTB"
        threat_id = "2147812480"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "NBCBCXNBNCBNCBMBNCXNCXNCNXBCNBX" wide //weight: 1
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Aspnet_compiler.exe" wide //weight: 1
        $x_1_4 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_5 = "transfer.sh" wide //weight: 1
        $x_1_6 = "Skidomoney.Money" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NHN_2147812481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHN!MTB"
        threat_id = "2147812481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "52"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$951006a7-b02f-43b0-9313-f948f28ab5fa" ascii //weight: 10
        $x_10_2 = "SmtpClient" ascii //weight: 10
        $x_10_3 = "NetworkCredential" ascii //weight: 10
        $x_10_4 = "get_Attachments" ascii //weight: 10
        $x_10_5 = "Host Process for Windows Services" ascii //weight: 10
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_9 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NHP_2147812482_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHP!MTB"
        threat_id = "2147812482"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "75"
        strings_accuracy = "High"
    strings:
        $x_50_1 = "$a54caa6e-92e4-40ed-815a-32074109236e" ascii //weight: 50
        $x_50_2 = "$C4A72607-FEF6-49E7-B267-0EDE8699CCEF" ascii //weight: 50
        $x_20_3 = "FreshFoodExpress.Resources" ascii //weight: 20
        $x_20_4 = "GetPixel" ascii //weight: 20
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_50_*) and 1 of ($x_20_*) and 5 of ($x_1_*))) or
            ((1 of ($x_50_*) and 2 of ($x_20_*))) or
            ((2 of ($x_50_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NHQ_2147812483_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NHQ!MTB"
        threat_id = "2147812483"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_2 = ":a:cbdbebfbgbhbib" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "MD5CryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFT_2147812489_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFT!MTB"
        threat_id = "2147812489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 0a 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 0c 00 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EFU_2147812490_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EFU!MTB"
        threat_id = "2147812490"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {df 02 df 02 e0 02 e0 02 0c 03 ef 02 ee 02 df 02 df 02 df 02 e0 02 e7 02 eb 02 e7 02 e2 02 df 02 df 02 df 02 05 03 0b 03 df 02 eb 02 df 02 df 02 e1 02 05 03 e6 02 df 02 df 02 df 02 10 03 e5 02}  //weight: 1, accuracy: High
        $x_1_2 = {e6 02 02 03 e0 02 e3 02 df 02 df 02 df 02 e3 02 0f 03 e3 02 18 03 df 02 e6 02 df 02 e3 02 e7 02 e0 02 df 02 df 02 df 02 e4 02 df 02 df 02 df 02}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SAMO_2147812492_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SAMO!MTB"
        threat_id = "2147812492"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 8d 4e 00 00 01 25 16 1f 60 9d 28 ?? ?? ?? 0a 20 00 01 00 00 14 14 17 8d 12 00 00 01 25 16 02 a2 28 ?? ?? ?? 0a 74 33 00 00 01 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VAMO_2147812493_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VAMO!MTB"
        threat_id = "2147812493"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {d0 1f 00 00 01 28 ?? ?? ?? 0a 72 25 02 00 70 17 8d 47 00 00 01 25 16 1f 60 9d 28 ?? ?? ?? 0a 20 00 01 00 00 14 14 17 8d 1b 00 00 01 25 16 02 a2 28 ?? ?? ?? 0a 74 1f 00 00 01 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAMO_2147812494_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAMO!MTB"
        threat_id = "2147812494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {17 8d 79 00 00 01 25 16 1f 60 9d 28 ?? ?? ?? 0a 20 00 01 00 00 14 14 17 8d 10 00 00 01 25 16 02 a2 28 ?? ?? ?? 0a 74 33 00 00 01 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIB_2147812515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIB!MTB"
        threat_id = "2147812515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 06 09 18 5a 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 20 00 58 00 00 fe 04 13 04 11 04 2d da}  //weight: 1, accuracy: Low
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIC_2147812516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIC!MTB"
        threat_id = "2147812516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 0d 08 28 ?? ?? ?? 0a 72 6a 09 00 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 07 11 04 6f ?? ?? ?? 0a 00 07 18 6f ?? ?? ?? 0a 00 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 13 05 28 ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 11 05 16 11 05 8e 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "9fee6971-1302-4b58-9a8d-a2f6d16beca8" ascii //weight: 1
        $x_1_3 = "LinkMaker.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "H8R8788G" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
        $x_1_6 = "RC2CryptoServiceProvider" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NID_2147812517_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NID!MTB"
        threat_id = "2147812517"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 08 06 8e 69 5d 06 08 06 8e 69 5d 91 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 08 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 06 08 17 58 06 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d 28 ?? ?? ?? 0a 9c 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d 99}  //weight: 1, accuracy: Low
        $x_1_2 = "ba281e-3a99-482d-9b04-703a662e5d" ascii //weight: 1
        $x_1_3 = "OIUTERSWBAJHGFFDSAFHKOIMNYHGTTRFGDRCFESEWD" ascii //weight: 1
        $x_1_4 = "SharpStructures.Sorting.SortHelper" ascii //weight: 1
        $x_1_5 = "MyWebeSocket.Properties.Resources.resources" ascii //weight: 1
        $x_1_6 = "PLOKNMJIUHBVGYTFCXDRESZAWQAZADFGFTFGYCTYYTRDEXG" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIE_2147812518_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIE!MTB"
        threat_id = "2147812518"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "FromBase64" ascii //weight: 10
        $x_10_2 = "GetMethod" ascii //weight: 10
        $x_1_3 = "#fasvxfafdfdsgdfgdffsdfffafgsdddddokuijouilpoddddssaf.dll#" ascii //weight: 1
        $x_1_4 = "#fafdafssggdsffgdfgdfsdfdkgcfioioaaaaaoaaadsssaf.dll#" ascii //weight: 1
        $x_1_5 = "#ijfakkgdfggffsfdsfvxdsfsgk.dll#" ascii //weight: 1
        $x_1_6 = "#sfgds.dll#" ascii //weight: 1
        $x_1_7 = "#faaxvdaasdsffgssasfdsfddfsfgdffkklvcljigfdddddddssaf.dll#" ascii //weight: 1
        $x_1_8 = "#fasvddddxdasdadvxfafdfdsgdfgdffsdfffafgsdddddokuijouilpoddddssaf.dll#" ascii //weight: 1
        $x_1_9 = "#afadxvaddadfssffassdddddfgvxcddfgdffssgsf.dll#" ascii //weight: 1
        $x_1_10 = "k#savaaaaaaxcvdaadsfss#" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EGB_2147812620_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGB!MTB"
        threat_id = "2147812620"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 07 8e 69 5d 07 08 07 8e 69 5d 91 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 08 02 7b ?? ?? ?? 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 08 17 58 07 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 00 08 15 58 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGC_2147812621_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGC!MTB"
        threat_id = "2147812621"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {66 3e f0 b3 09 4c 34 48 06 2d 00 3d 2f 2e 7c 69 0e 64 04 42 20 60 3a c4 fc f5 42 e4 cd 6c cb 02 66 22 68 49 e1 53 65 2f ac bd dd a8 df 33 f2 1d}  //weight: 1, accuracy: High
        $x_1_2 = {48 1d dd ae df 31 22 b0 d0 4d db df f8 a8 0d 39 34 37 d0 4e 10 39 48 bd ed a8 2f c3 22 40 d0 4d d8 d9 55 2b d5 a4 c4 d7 e0 be 30 29 48 bd a5 a9}  //weight: 1, accuracy: High
        $x_1_3 = {dd a8 df 33 22 b0 d0 4d d8 d9 45 2b c5 a4 c4 d7 e0 be 30 29 48 bd dd a8 df 33 22 b0 d0 4d d8 d9 45 2b c5 a4 c4 d7 e0 be 30 29 48 bd dd a8 df 33}  //weight: 1, accuracy: High
        $x_1_4 = {30 29 48 bd dd a8 df 33 22 b0 d0 4d d8 d9 45 2b c5 a4 c4 d7 e0 be 30 29 48 bd dd a8 df 33 22 b0 d0 4d d8 d9 45 2b c5 a4 c4 d7 e0 be 30 29 48 bd}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGD_2147812622_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGD!MTB"
        threat_id = "2147812622"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 00 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {02 11 04 91 07 61 06 09 91 61 13 05 08 11 04 11 05 d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGD_2147812622_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGD!MTB"
        threat_id = "2147812622"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 73 3a 2f 2f ?? ?? ?? ?? ?? ?? ?? 20 64 69 76 6f ?? ?? ?? ?? ?? ?? ?? 20 72 63 65 72 ?? ?? ?? ?? ?? ?? ?? 20 68 74 74 70 ?? ?? ?? ?? ?? ?? ?? 20 2e 63 6f 6d ?? ?? ?? ?? ?? ?? ?? 20 61 64 69 6f}  //weight: 1, accuracy: Low
        $x_1_2 = {22 00 73 00 79 00 73 00 74 00 65 00 6d 00 5f 00 69 00 6e 00 66 00 6f 00 22 00 3a}  //weight: 1, accuracy: High
        $x_1_3 = {22 00 6e 00 65 00 74 00 77 00 6f 00 72 00 6b 00 5f 00 69 00 6e 00 66 00 6f 00 22 00 3a 00 20 00 22}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGE_2147812636_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGE!MTB"
        threat_id = "2147812636"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 50 4c 4f 4b 4e 4d 4a 49 55 48 42 56 47 59 54 46 43 58 44 52 45 53 5a 41 57 51 41 5a 41 44 46 47 46 54 46 47 59 43 54 59 59 54 52 44 45 58 47 59 55 56 55 49 47 48 48 55 49 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 4f 49 55 54 45 52 53 57 42 41 4a 48 47 46 46 44 53 41 46 48 4b 4f 49 4d 4e 59 48 47 54 54 52 46 47 44 52 43 46 45 53 45 57 44 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 4c 65 76 65 6c 00 70 6f 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 50 6f 73 69 74 69 6f 6e 00 50 65 72 66 6f 72 6d 54 61 62 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIM_2147812655_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIM!MTB"
        threat_id = "2147812655"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#faaxvdasdsffgssasfdsfddfsfgdffkklvcljigfdddddddssaf.dll#" ascii //weight: 1
        $x_1_2 = "#sdadaxvxcsfdss#" ascii //weight: 1
        $x_1_3 = "#afadxvaddadfssffassfgvxcddfgdffssgsf.dll#" ascii //weight: 1
        $x_1_4 = "#ijfakdsxaddkgdfggffsfdsfvxdsfsgk.dll#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIP_2147812656_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIP!MTB"
        threat_id = "2147812656"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0b 2b 22 11 04 06 07 6f ?? ?? ?? 0a 13 05 11 05 28 ?? ?? ?? 0a 13 06 09 06 11 06 d2 6f ?? ?? ?? 0a 07 17 58 0b 07 17 fe 04 13 07 11 07 2d d4 08 17 58 0c 06}  //weight: 1, accuracy: Low
        $x_1_2 = "ToArray" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIH_2147812755_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIH!MTB"
        threat_id = "2147812755"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$99a12630-5169-4b3f-9bb5-ec14e7724d3a" ascii //weight: 10
        $x_10_2 = "$15ba281e-3a99-482d-9b04-703a662e5d5b" ascii //weight: 10
        $x_1_3 = "PLOKNMJIUHBVGYTFCXDRESZAWQAZADFGFTFGYCTYYTRDEXGYUVUIGHHUI" ascii //weight: 1
        $x_1_4 = "OIUTERSWBAJHGFFDSAFHKOIMNYHGTTRFGDRCFESEWD" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NIK_2147812756_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIK!MTB"
        threat_id = "2147812756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "81"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 7b 00 22 00 73 00 74 00 61 00 74 00 75 00 73 00 22 00 3a 00 74 00 72 00 75 00 65 00 2c 00 22 00 64 00 61 00 74 00 61 00 22 00 3a 00 30 00 2e 00 30 00 30 00 30 00 30 00 34 00 31 00 33 00 30 00 32 00 34 00 34 00 39 00 32 00 35 00 38 00 35 00 36 00 34 00 7d}  //weight: 10, accuracy: High
        $x_10_2 = "System.Resources.Tools.StronglyTypedResourceBuilder" ascii //weight: 10
        $x_10_3 = "GetType" ascii //weight: 10
        $x_10_4 = "GetMethod" ascii //weight: 10
        $x_10_5 = "Substring" ascii //weight: 10
        $x_10_6 = "Replace" ascii //weight: 10
        $x_10_7 = "Invoke" ascii //weight: 10
        $x_10_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 10
        $x_1_9 = "Sleep" ascii //weight: 1
        $x_1_10 = "Deserialize" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((8 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NIQ_2147812769_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIQ!MTB"
        threat_id = "2147812769"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "%'B\"pp|pppptpppp^^gpp{8ppppppppp\"pppppp" ascii //weight: 1
        $x_1_2 = "pc7F8cpEp?}x38q%|_9'v9A4JqH4>h?4>uExv}93>dG5rq:+$qJ5(" ascii //weight: 1
        $x_1_3 = "s\"_zypppppppppq\"#\"pp%ptspsr2r(xpppppppppp~pps:t{p\"*pp" ascii //weight: 1
        $x_1_4 = "dpv5=5uh*pv5=5uh+pt'I5(uD4HqG5v9=48qG*>@p#a'_$vuK" ascii //weight: 1
        $x_1_5 = "r?b8pppzq8}hbHppr8*s6H4qppAhqHtpr8|)7\"4qpp@sp8}fcp" ascii //weight: 1
        $x_1_6 = "x&xpt't@s\"p9|ptHt't@s\"p9|ptHt|xptru" ascii //weight: 1
        $x_1_7 = "|8bppppppppppppppppppppppppppppppppppppp" ascii //weight: 1
        $x_1_8 = {08 07 1f 21 08 07 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d}  //weight: 1, accuracy: Low
        $x_1_9 = "Cradiator.Properties.Resources.resources" ascii //weight: 1
        $x_1_10 = "Cradiator.Config.ChangeHandlers" ascii //weight: 1
        $x_1_11 = "SharpStructures.Sorting.SortHelper" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGJ_2147812770_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGJ!MTB"
        threat_id = "2147812770"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 95 28 ?? ?? ?? 0a 0c 16 0d 2b 14 00 7e ?? ?? ?? 04 07 1a 5a 09 58 08 09 91 9c 00 09 17 58 0d 09 08 8e 69 fe 04 13 04 11 04 2d e0 00 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPQ_2147812791_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPQ!MTB"
        threat_id = "2147812791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {61 00 6d 00 61 00 7a 00 6f 00 6e 00 61 00 77 00 73 00 2e 00 63 00 6f 00 6d}  //weight: 1, accuracy: High
        $x_1_2 = {4b 00 65 00 66 00 70 00 61 00 62 00 7a 00 2e 00 70 00 6e 00 67}  //weight: 1, accuracy: High
        $x_1_3 = {52 00 65 00 66 00 6c 00 65 00 63 00 74 00 69 00 6f 00 6e 00 2e 00 41 00 73 00 73 00 65 00 6d 00 62 00 6c 00 79}  //weight: 1, accuracy: High
        $x_1_4 = {53 00 6c 00 65 00 65 00 70}  //weight: 1, accuracy: High
        $x_1_5 = {45 00 63 00 67 00 78 00 6e 00 62}  //weight: 1, accuracy: High
        $x_1_6 = {47 00 65 00 74 00 42 00 79 00 74 00 65 00 41 00 72 00 72 00 61 00 79 00 41 00 73 00 79 00 6e 00 63}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPQ_2147812791_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPQ!MTB"
        threat_id = "2147812791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 04 09 6f af 00 00 0a 6f a4 00 00 06 0c 02 04 09 6f af 00 00 0a 6f 9b 00 00 06 07 5a 07 18 5b 58 6c 05 09 9a 6f ce 00 00 0a 23 00 00 00 00 00 00 00 40 5b 59 04 09 6f af 00 00 0a 6f 9d 00 00 06 07 5a 07 18 5b 58 6c 05 09 9a 6f cf 00 00 0a 23 00 00 00 00 00 00 00 40 5b 59 08 06 05 09 9a 28 76 00 00 06 00 00 09 17 58 0d 09 04 6f b0 00 00 0a fe 04 13 04 11 04 2d 86}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPQ_2147812791_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPQ!MTB"
        threat_id = "2147812791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "armavipgenesh.com/skido/mydll.txt" wide //weight: 1
        $x_1_2 = "RUNRUNRUN" wide //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "WebResponse" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "Binder" ascii //weight: 1
        $x_1_8 = "Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPQ_2147812791_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPQ!MTB"
        threat_id = "2147812791"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 0c 00 00 fe 0c 06 00 28 ?? ?? 00 0a 28 ?? ?? 00 0a fe 0c 03 00 fe 0c 06 00 6f ?? ?? 00 0a 67 52 fe 0c 06 00 20 01 00 00 00 58 fe 0e 06 00 fe 0c 06 00 fe 0c 03 00 6f ?? ?? 00 0a 3f bf ff ff ff}  //weight: 1, accuracy: Low
        $x_1_2 = "WriteLine" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "ConvertFromUtf32" ascii //weight: 1
        $x_1_5 = "ToChar" ascii //weight: 1
        $x_1_6 = "Convert" ascii //weight: 1
        $x_1_7 = "Length" ascii //weight: 1
        $x_1_8 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIR_2147812811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIR!MTB"
        threat_id = "2147812811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "%'B\"pp|pppptpppp^^gpp{8ppppppppp\"pppppp" ascii //weight: 1
        $x_1_2 = "pc7F8cpEp?}x38q%|_9'v9A4JqH4>h?4>uExv}93>dG5rq:+$qJ5(" ascii //weight: 1
        $x_1_3 = "s\"_zypppppppppq\"#\"pp%ptspsr2r(xpppppppppp~pps:t{p\"*pp" ascii //weight: 1
        $x_1_4 = "dpv5=5uh*pv5=5uh+pt'I5(uD4HqG5v9=48qG*>@p#a'_$vuK" ascii //weight: 1
        $x_1_5 = "$09e7472e-9f28-45ed-b39e-f9f77c18b593" ascii //weight: 1
        $x_1_6 = "r?b8pppzq8}hbHppr8*s6H4qppAhqHtpr8|)7\"4qpp@sp8}fcp" ascii //weight: 1
        $x_1_7 = "x&xpt't@s\"p9|ptHt't@s\"p9|ptHt|xptru" ascii //weight: 1
        $x_1_8 = "|8bppppppppppppppppppppppppppppppppppppp" ascii //weight: 1
        $x_1_9 = "Kora.Visual" ascii //weight: 1
        $x_1_10 = "FromBase64String" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KRIMI_2147812861_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KRIMI!MTB"
        threat_id = "2147812861"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 08 07 8e 69 5d 07 08 07 8e 69 5d 91 02 7b e7 00 00 04 6f ?? ?? ?? 0a 08 02 7b e7 00 00 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 08 17 58 07 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d 99}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMMC_2147812869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMMC!MTB"
        threat_id = "2147812869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 25 18 6f ?? 00 00 0a 25 18 6f ?? 00 00 0a 25 03 28 ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 28 ?? 00 00 0a 07 06 16 06 8e 69 6f ?? 00 00 0a 6f ?? 00 00 0a 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGY_2147812880_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGY!MTB"
        threat_id = "2147812880"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 08 1f 21 09 08 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d}  //weight: 1, accuracy: Low
        $x_1_2 = "$7E4EBA64-8562-4EE0-ACA6-A60AB09A52B3" ascii //weight: 1
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGZ_2147812881_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGZ!MTB"
        threat_id = "2147812881"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {02 07 91 11 04 61 09 06 91 61 13 05 08 07 11 05 d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGX_2147812882_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGX!MTB"
        threat_id = "2147812882"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 0a 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 0c 00 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "gnirtS46esaBmorF" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIS_2147812929_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIS!MTB"
        threat_id = "2147812929"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 67 00 66 00 66 00 67 00 67 00 66 00 66 00 66 00 66 00 66 00 72 00 6f 00 67 00 72 00 61 00 6d 00 73 00 2f}  //weight: 1, accuracy: High
        $x_1_2 = "sssssddddddddddddddddddddddddddssssssfasadsssssss" ascii //weight: 1
        $x_1_3 = "addddddf.exe" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "RijndaelManaged" ascii //weight: 1
        $x_1_7 = "DESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIT_2147812930_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIT!MTB"
        threat_id = "2147812930"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 08 93 28 ?? ?? ?? 0a 1f 21 32 11 09 08 93 28 ?? ?? ?? 0a 1f 7e fe 02 16 fe 01 2b 01 16 13 04 11 04 2c 16 00 09 08 1f 21 09 08 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d 00 00 08 17 58 0c 08 07 6f ?? ?? ?? 0a fe 04 13 05 11 05 2d b1}  //weight: 1, accuracy: Low
        $x_1_2 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EHA_2147812996_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EHA!MTB"
        threat_id = "2147812996"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 93 28 ?? ?? ?? 0a 1f 21 32 11 08 07 93 28 ?? ?? ?? 0a 1f 7e fe 02 16 fe 01 2b 01 16 0d 09 2c 16 00 08 07 1f 21 08 07 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d 00 00 07 17 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGH_2147812997_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGH!MTB"
        threat_id = "2147812997"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 1f 21 08 07 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d}  //weight: 1, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RTA_2147813100_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RTA!MTB"
        threat_id = "2147813100"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "FromBase64String" ascii //weight: 1
        $x_1_2 = "$64001B13-7085-4B33-884A-BA0B1CD218F6" ascii //weight: 1
        $x_1_3 = {08 07 93 28 ?? ?? ?? 0a 1f 21 32 11 08 07 93 28 ?? ?? ?? 0a 1f 7e fe 02 16 fe 01 2b 01 16 0d 09 2c 14 08 07 1f 21 08 07 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d 07 17 58 0b 07 06 6f ?? ?? ?? 0a fe 04 13 04 11 04 2d b7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RTA_2147813100_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RTA!MTB"
        threat_id = "2147813100"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "52"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_2 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_3 = "SuppressIldasmAttribute" ascii //weight: 1
        $x_1_4 = "get_KeyCode" ascii //weight: 1
        $x_10_5 = "$d0263248-8e8b-4fd4-854f-f0f586aa919e" ascii //weight: 10
        $x_10_6 = "nNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJ" ascii //weight: 10
        $x_10_7 = "U3RhcnRJbnN0cnVjdGlvbgBUaWxlQXR0cmlidXRlcwBUdXBsZW" ascii //weight: 10
        $x_10_8 = "Qa+v+sDM1VkZnxKxwH0dJdQgMPfgKmqySl4V0w2xYDMgKmqif5aU07DgKmqSkgxLCYJfT+Bqapq2arN7mBIoyqBqapBLmN" ascii //weight: 10
        $x_10_9 = "qap9WgWU7XnuamDlEj8GgKmqKf0Nz8+mztcCGnu" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_10_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RTB_2147813101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RTB!MTB"
        threat_id = "2147813101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "/c ping yahoo.com" ascii //weight: 10
        $x_10_2 = "DebuggingModes" ascii //weight: 10
        $x_10_3 = "GetAssemblies" ascii //weight: 10
        $x_1_4 = "transfer.sh" ascii //weight: 1
        $x_1_5 = "Ykgbgkdfpgaurwfgat" ascii //weight: 1
        $x_1_6 = "Qhpap.Properties.Resources" ascii //weight: 1
        $x_1_7 = "0mc-global.com" ascii //weight: 1
        $x_1_8 = "Yelfivikljxsxgxhx" ascii //weight: 1
        $x_1_9 = "Vwfdxdn.Properties.Resources" ascii //weight: 1
        $x_1_10 = "cdn.discordapp.com" ascii //weight: 1
        $x_1_11 = "Uswatrfxtuvwbvqw" ascii //weight: 1
        $x_1_12 = "Jjxpa.Properties.Resources" ascii //weight: 1
        $x_1_13 = "Tvwragmrkubqw" ascii //weight: 1
        $x_1_14 = "Qpchk.Properties.Resources" ascii //weight: 1
        $x_1_15 = "Fomykczxoezuvjpw" ascii //weight: 1
        $x_1_16 = "Bhailh.Properties.Resources" ascii //weight: 1
        $x_1_17 = "Iesiyinnewn" ascii //weight: 1
        $x_1_18 = "Fgewph.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 13 of ($x_1_*))) or
            ((3 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RTC_2147813102_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RTC!MTB"
        threat_id = "2147813102"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Delphi-the best. Fuck off all the rest" ascii //weight: 1
        $x_1_2 = "RmJ37K7jNgdAds4OhZ.ejfWpD5ZEiPTOpJbRC" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "91.243.44.22" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKA_2147813141_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKA!MTB"
        threat_id = "2147813141"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 07 08 1b 5b 93 28 ?? ?? ?? 0a 1f 0a 62 0d 08 1b 5b 17 58 07 8e 69 fe 04 13 04 11 04 2c 16}  //weight: 1, accuracy: Low
        $x_1_2 = {09 1f 0f 08 1b 5d 59 1e 59 1f 1f 5f 63 5f 0d 06 09 d2 6f b2 00 00 0a 00 00 08 1e 58 0c 08 02 6f 2b 00 00 0a 1b 5a fe 04 13 06 11 06 3a 6c ff ff ff}  //weight: 1, accuracy: High
        $x_1_3 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 42 61 72 62 61 72 61 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 50 72 69 65 6e 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKB_2147813142_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKB!MTB"
        threat_id = "2147813142"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 0a 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8 07 0a 2b}  //weight: 1, accuracy: Low
        $x_1_2 = {f2 02 f4 02 0f 03 ef 02 0c 20 22 06 eb 02 0c 20 22 06 0c 20 22 06 e3 02 0c 20 22 06 0c 20 22 06 cd 02 cd 02 d6 02 0c 20 22 06 ea 02 05 03 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 df 02 ef 02 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22}  //weight: 1, accuracy: High
        $x_1_3 = {df 02 eb 02 df 02 ef 02 df 02 e6 02 eb 02 f1 02 d2 02 18 03 ea 02 08 03 df 02 13 03 eb 02 0c 20 22 06 df 02 e0 02 df 02 e3 02 0c 20 22 06 df 02 e2 02 09 03 f4 02 15 03 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 0c 20 22 06 e2 02}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKC_2147813143_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKC!MTB"
        threat_id = "2147813143"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 1f 0f 08 1b 5d 59 1e 59 1f 1f 5f 63 5f 0d 06 09 d2 6f 6c 00 00 0a 08 1e 58 0c 08 02 6f 1e 00 00 0a 1b 5a fe 04 13 06 11 06 3a 60 ff ff ff}  //weight: 1, accuracy: High
        $x_1_2 = {06 07 08 1b 5b 93 28 ?? ?? ?? 0a 1f 0a 62 0d 08 1b 5b 17 58 07 8e 69 fe 04 13 04 11 04 2c 1b 09 20 ?? ?? ?? ?? 28 2c 00 00 06 07 08 1b 5b 17 58 93 28 ?? ?? ?? 0a 1b 62 60 0d 08 1b 5b 18 58 07 8e 69 fe 04 13 05 11 05 2c 19}  //weight: 1, accuracy: Low
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "IndexOf" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IKIN_2147813199_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IKIN!MTB"
        threat_id = "2147813199"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "52"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "GetMethod" ascii //weight: 10
        $x_10_2 = "GetType" ascii //weight: 10
        $x_10_3 = "Reverse" ascii //weight: 10
        $x_10_4 = "Invoke" ascii //weight: 10
        $x_10_5 = "ToArray" ascii //weight: 10
        $x_2_6 = "ec2-54-163-171-189.compute-1.amazonaws.com/file/Kefpabz.png" ascii //weight: 2
        $x_2_7 = "transfer.sh/get/MiToFC/Pbrdehm.log" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_10_*) and 1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_HEBBAR_2147813203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HEBBAR!MTB"
        threat_id = "2147813203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0d 16 0c 2b 40 00 09 08 93 28 ?? ?? ?? 0a 1f 21 32 11 09 08 93 28 ?? ?? ?? 0a 1f 7e fe 02 16 fe 01 2b 01 16 13 04 11 04 2c 16 00 09 08 1f 21 09 08 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d 00 00 08 17 58 0c 08 07 6f ?? ?? ?? 0a fe 04 13 05 11 05 2d b1}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKH_2147813208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKH!MTB"
        threat_id = "2147813208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "41"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {63 00 64 00 6e 00 2e 00 64 00 69 00 73 00 63 00 6f 00 72 00 64 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 61 00 74 00 74 00 61 00 63 00 68 00 6d 00 65 00 6e 00 74 00 73 00 2f 00 39 00 34 00 33 00 [0-32] 2f 00 39 00 34 00 33 00}  //weight: 10, accuracy: Low
        $x_10_2 = {63 64 6e 2e 64 69 73 63 6f 72 64 61 70 70 2e 63 6f 6d 2f 61 74 74 61 63 68 6d 65 6e 74 73 2f 39 34 33 [0-32] 2f 39 34 33}  //weight: 10, accuracy: Low
        $x_10_3 = {63 00 6d 00 64 00 00 21 2f 00 63 00 20 00 70 00 69 00 6e 00 67 00 20 00 62 00 69 00 6e 00 67 00 2e 00 63 00 6f 00 6d}  //weight: 10, accuracy: High
        $x_10_4 = "GetMethods" ascii //weight: 10
        $x_10_5 = "Reverse" ascii //weight: 10
        $x_1_6 = "Sqwliqpzhpetux" ascii //weight: 1
        $x_1_7 = "Lkipedszsyvmmtggujruv" ascii //weight: 1
        $x_1_8 = "Jczxenczxbcnbysevt" ascii //weight: 1
        $x_1_9 = "Rbltlahh" ascii //weight: 1
        $x_1_10 = "Bahkvagueazlxugijua" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_10_*) and 1 of ($x_1_*))) or
            ((5 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NKI_2147813218_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKI!MTB"
        threat_id = "2147813218"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03 08 19 58 18 59 03 8e 69 5d 91 59 20 ?? ?? ?? 00 58 17 58 20 00 01 00 00 5d d2 9c 08 17 58 0c 08 6a 03 8e 69 17 59 6a 06 17 58 6e 5a 31 b7}  //weight: 1, accuracy: Low
        $x_1_2 = {72 00 77 00 65 00 73 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 61 00 73 00 73 00 73 00 72 00 77 00 65 00 72}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKJ_2147813219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKJ!MTB"
        threat_id = "2147813219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#ffgfgfa.dll#" ascii //weight: 1
        $x_1_2 = "#fagdfgfd#" ascii //weight: 1
        $x_1_3 = "kgdfgdff#" ascii //weight: 1
        $x_1_4 = "#gdhfdsgsdg.dll#" ascii //weight: 1
        $x_1_5 = "#sadaaaagfdgadaaadvcxvadaadfgds.dll#" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MD_2147813226_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MD!MTB"
        threat_id = "2147813226"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0d 2b 26 06 09 08 09 08 8e 69 5d 91 07 09 91 61 d2 6f ?? ?? ?? 0a 09 13 04 2b 03 0c 2b e1 11 04 17 58 0d 2b 04 2c 0f 2b c5 09 07 8e 69 32 02 2b 05}  //weight: 10, accuracy: Low
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MD_2147813226_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MD!MTB"
        threat_id = "2147813226"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {01 57 1f a2 0b 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 6f 00 00 00 66 00 00 00 a3 00 00 00 9b 01}  //weight: 3, accuracy: High
        $x_3_2 = "TwitDuel" ascii //weight: 3
        $x_3_3 = "Price's Electronics" ascii //weight: 3
        $x_3_4 = "irontwit/tree/master" ascii //weight: 3
        $x_3_5 = "This is really BAD!" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NII_2147813264_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NII!MTB"
        threat_id = "2147813264"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$f01727f6-25f8-4253-937f-8a97d060aaff" ascii //weight: 10
        $x_10_2 = "$11060129-58d9-43ec-8cb2-4457c1a05409" ascii //weight: 10
        $x_1_3 = {57 7b 00 22 00 73 00 74 00 61 00 74 00 75 00 73 00 22 00 3a 00 74 00 72 00 75 00 65 00 2c 00 22 00 64 00 61 00 74 00 61 00 22 00 3a 00 30 00 2e 00 30 00 30 00 30 00 30 00 34 00 31 00 33 00 30 00 32 00 34 00 34 00 39 00 32 00 35 00 38 00 35 00 36 00 34 00 7d}  //weight: 1, accuracy: High
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "Substring" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NIU_2147813265_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIU!MTB"
        threat_id = "2147813265"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 50 4c 4f 4b 4e 4d 4a 49 55 48 42 56 47 59 54 46 43 58 44 52 45 53 5a 41 57 51 41 5a 41 44 46 47 46 54 46 47 59 43 54 59 59 54 52 44 45 58 47 59 55 56 55 49 47 48 48 55 49 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 4f 49 55 54 45 52 53 57 42 41 4a 48 47 46 46 44 53 41 46 48 4b 4f 49 4d 4e 59 48 47 54 54 52 46 47 44 52 43 46 45 53 45 57 44 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 50 65 72 66 6f 72 6d 54 61 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 50 6f 73 69 74 69 6f 6e 00}  //weight: 1, accuracy: High
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKL_2147813266_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKL!MTB"
        threat_id = "2147813266"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$2e95f836-46ed-4429-af82-89b57c02644b" ascii //weight: 1
        $x_1_2 = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1" ascii //weight: 1
        $x_1_3 = "Taurus.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "Waccamaw's Homeplace" ascii //weight: 1
        $x_1_5 = "Private Household" ascii //weight: 1
        $x_1_6 = "2014 Audi RS 7" ascii //weight: 1
        $x_1_7 = {50 00 72 00 6f 00 6d 00 6f 00 74 00 69 00 6f 00 6e 00 20 00 74 00 79 00 70 00 65 00 20 00 69 00 73 00 20 00 6e 00 6f 00 74 00 20 00 64 00 65 00 66 00 69 00 6e}  //weight: 1, accuracy: High
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKD_2147813288_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKD!MTB"
        threat_id = "2147813288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 03 16 03 8e 69 6f ?? ?? ?? 0a 00 11 06 6f ?? ?? ?? 0a 00 00 de 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "dsfgdsfsdfsd" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "Sys.Sys" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKE_2147813289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKE!MTB"
        threat_id = "2147813289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e6f75381-8d38-4ddd-8e03-d75a0f6e7740" ascii //weight: 1
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 53 70 6c 69 74 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_8 = "DebuggerStepThroughAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKF_2147813290_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKF!MTB"
        threat_id = "2147813290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$818a33a0-3c2a-43f3-9e0a-a8395344ce0a" ascii //weight: 1
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "trevnoC.metsyS" ascii //weight: 1
        $x_1_5 = "gnirtS46esaBmorF" ascii //weight: 1
        $x_1_6 = "rebmeMekovnI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKG_2147813291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKG!MTB"
        threat_id = "2147813291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 00 06 0c 08 20 ?? ?? ?? ?? 28 ?? ?? ?? 0a fe 04 0d 09 2c 15 06 20 ?? ?? ?? ?? d6 0a 07 16 06 17 d6 8d ?? ?? ?? 01 a2 2b d6}  //weight: 10, accuracy: Low
        $x_10_2 = {00 07 16 fe 02 16 fe 01 0c 08 2c 1c 07 17 d6 0b 06 72 0e 05 00 70 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 2b d8}  //weight: 10, accuracy: Low
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "GetObjectValue" ascii //weight: 1
        $x_1_5 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NKN_2147813305_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKN!MTB"
        threat_id = "2147813305"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$1c2e5f9e-958b-4b36-80b3-c79d9d2a9657" ascii //weight: 1
        $x_1_2 = "DProcessorSE.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = {41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 3d 00 3d}  //weight: 1, accuracy: High
        $x_1_4 = {44 00 47 00 53 00 20 00 48 00 6f 00 6d 00 65 00 53 00 6f 00 75 00 72 00 63 00 65 00 20 00 32 00 30 00 30 00 39}  //weight: 1, accuracy: High
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKO_2147813306_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKO!MTB"
        threat_id = "2147813306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {f2 02 f4 02 0f 03 ef 02 0c 20 2a 06 eb 02 0c 20 2a 06 0c 20 2a 06 e3 02 0c 20 2a 06 0c 20 2a 06 cd 02 cd 02 d6 02 0c 20}  //weight: 1, accuracy: High
        $x_1_2 = {02 df 02 e3 02 0c 20 2a 06 e1 02 11 03 0b 03 e5 02 06 03 eb 02 ea 02 e9 02 d5 02 f3 02 f0 02 e0 02 e6 02 f3 02 e0 02 0c 20 2a 06 df 02 00 03}  //weight: 1, accuracy: High
        $x_1_3 = {e1 02 df 02 05 03 ef 02 df 02 ef 02 eb 02 e7 02 e6 02 05 03 df 02 e2 02 df 02 15 03 11 03 e6 02 e1 02 df 02 05 03 e7 02 e1 02 df 02 05 03 e7 02 e6 02 ef}  //weight: 1, accuracy: High
        $x_1_4 = {2a 06 e0 02 f8 02 e2 02 e2 02 05 03 d2 02 cd 02 cd 02 cd 02 cd 02 e0 02 0c 03 f3 02 e2 02 0c 20 2a 06 df 02 00 03 e5 02 e1 02 e0 02 12 03 df 02 ef 02}  //weight: 1, accuracy: High
        $x_1_5 = {00 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKP_2147813307_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKP!MTB"
        threat_id = "2147813307"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {70 07 08 1b 5b 93 28 69 00 00 0a 1f 0a 62 0d 08 1b 5b 17 58 07 8e 69 fe 04 13 04 11 04 2c 16}  //weight: 1, accuracy: High
        $x_1_2 = {70 07 08 1b 5b 17 58 93 28 69 00 00 0a 1b 62 60 0d 08 1b 5b 18 58 07 8e 69 fe 04 13 05 11 05 2c 14}  //weight: 1, accuracy: High
        $x_1_3 = {07 08 1b 5b 18 58 93 28 69 00 00 0a 60 0d 20 ff 00 00 00 09 1f 0f 08 1b 5d 59 1e 59 1f 1f 5f 63 5f 0d 06 09 d2 6f 6a 00 00 0a 00 00 08 1e 58 0c 08 02 6f 53 00 00 0a 1b 5a fe 04 13 06 11 06 3a 6c ff ff ff}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKS_2147813333_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKS!MTB"
        threat_id = "2147813333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$c2cd00f8-087d-4d95-acb2-811a27989a15" ascii //weight: 1
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "PlaylistPanda.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = {55 00 6c 00 62 00 72 00 69 00 63 00 68 00 27 00 73}  //weight: 1, accuracy: High
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLA_2147813388_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLA!MTB"
        threat_id = "2147813388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {2b 17 11 09 28 89 00 00 06 11 0d 20 ?? ?? ?? 4f 5a 20 13 20 04 f7 61 2b cb}  //weight: 5, accuracy: Low
        $x_1_2 = "ProgramInstaller.Interface.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLA_2147813388_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLA!MTB"
        threat_id = "2147813388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {12 02 22 00 00 61 43 11 00 58 6c 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 38 ?? ?? ?? ff 02 6f ?? ?? ?? 06 02 7b ?? ?? ?? 04 6c 02 7b ?? ?? ?? 04 6c 5b 28 ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "Aune.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLA_2147813388_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLA!MTB"
        threat_id = "2147813388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 0a 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b9 07 0a 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "$ddc1b900-4128-44c0-9946-6703f4fd93d" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLB_2147813389_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLB!MTB"
        threat_id = "2147813389"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 4a 06 4a 06 4d 00 4a 06 4a 06 4a 06 4a 06 45 00 4a 06 4a 06 4a 06 4a 06 2f 00 2f}  //weight: 1, accuracy: High
        $x_1_2 = {4a 06 4a 06 45 00 43 00 67 00 59 00 66 00 2f 00 53 00 34 00 45 00 42 00 68 00 63 00 7a 00 43 00 67 00 44 00 65}  //weight: 1, accuracy: High
        $x_1_3 = {4a 06 4a 06 45 00 4a 06 33 00 73 00 72 00 4a 06 4a 06 4a 06 45 00 4b 00 4b 00 51 00 4a 06 4a 06 4a 06 59 00 71 00 4a}  //weight: 1, accuracy: High
        $x_1_4 = "2d9ce8e-9f8c-4cde-b525-226b664d94" ascii //weight: 1
        $x_1_5 = {42 00 57 00 67 00 4b 00 45 00 51 00 2f 00 4a 06 56 00 57 00 67 00 4b 00 77 00 51 00 2f 00 4a 06 56 00 57 00 67 00 4c 00 67 00 51 00 2f 00 4a 06 56 00 57 00 67 00 4d}  //weight: 1, accuracy: High
        $x_1_6 = {68 00 68 00 56 00 47 00 46 00 79 00 5a 00 32 00 56 00 30 00 4a 06 45 00 4a 00 6c 00 64 00 47 00 46 00 55 00 59 00 58 00 4a 00 6e 00 5a 00 58 00 51 00 4a 06 55}  //weight: 1, accuracy: High
        $x_1_7 = {4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 73 00 4a 06 4a 06 4a}  //weight: 1, accuracy: High
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLC_2147813390_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLC!MTB"
        threat_id = "2147813390"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {75 00 70 00 6c 00 6f 00 6f 00 64 00 65 00 72 00 2e 00 6e 00 65 00 74 00 2f 00 69 00 6d 00 67 00 2f 00 69 00 6d 00 61 00 67 00 65 00 2f}  //weight: 1, accuracy: High
        $x_1_2 = "$dee6b344-5e42-41fa-8c49-ba25b22bed97" ascii //weight: 1
        $x_1_3 = "GetByteArrayAsync" ascii //weight: 1
        $x_1_4 = "Hohcxvpzw.Sofxcaofbpu" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "Reverse" ascii //weight: 1
        $x_1_7 = "GetMethods" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLD_2147813398_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLD!MTB"
        threat_id = "2147813398"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "filetransfer.io/data-package/FudX7hsG/download" ascii //weight: 1
        $x_1_2 = "a680-4cc1-8ff4" ascii //weight: 1
        $x_1_3 = "GetByteArrayAsync" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "Sbixsmxfzjevgvget.Oxhdshwkefstmcy" ascii //weight: 1
        $x_1_6 = "Elgruzdcvouzkanujl" ascii //weight: 1
        $x_1_7 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLE_2147813399_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLE!MTB"
        threat_id = "2147813399"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "PlaylistPanda.Properties.Resources.resources" ascii //weight: 1
        $x_1_2 = "$c2cd00f8-087d-4d95-acb2-811a27989a15" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GDR_2147813427_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GDR!MTB"
        threat_id = "2147813427"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "rwesaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaasssrwer" wide //weight: 1
        $x_1_2 = "rwssssaaaaaaasssssadade" wide //weight: 1
        $x_1_3 = "Select * from Win32_ComputerSystem" wide //weight: 1
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
        $x_1_9 = "D:\\Ext.txt" ascii //weight: 1
        $x_1_10 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_11 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_12 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_13 = "BabelObfuscatorAttribute" ascii //weight: 1
        $x_1_14 = "DotNetPatcherObfuscatorAttribute" ascii //weight: 1
        $x_1_15 = "DotfuscatorAttribute" ascii //weight: 1
        $x_1_16 = "CryptoObfuscator.ProtectedWithCryptoObfuscatorAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLF_2147813445_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLF!MTB"
        threat_id = "2147813445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7b 1a 00 00 04 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0d 09 07 16 07 8e 69 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "1fsixdt" ascii //weight: 1
        $x_1_3 = "downloadZametka" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLF_2147813445_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLF!MTB"
        threat_id = "2147813445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$5bb5e25a-58a8-4c6b-8a89-312c6e276907" ascii //weight: 1
        $x_1_2 = "investigation.g.resources" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "fraudulent or misleading" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLG_2147813469_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLG!MTB"
        threat_id = "2147813469"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 1b 5b 93 28 94 00 00 0a 1f 0a 62 0d 08 1b 5b 17 58 07 8e 69 fe 04 13 04 11 04 2c 1b 09 20 ?? ?? ?? ?? 28 36 00 00 06 07 08 1b 5b 17 58 93 28 94 00 00 0a 1b 62 60 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {08 1b 5b 18 58 07 8e 69 fe 04 13 05 11 05 2c 19 09 20 ?? ?? ?? ?? 28 ?? ?? ?? 06 07 08 1b 5b 18 58 93 28 94 00 00 0a 60 0d}  //weight: 1, accuracy: Low
        $x_1_3 = {09 1f 0f 08 1b 5d 59 1e 59 1f 1f 5f 63 5f 0d 06 09 d2 6f 65 00 00 0a 08 1e 58 0c 08 02 6f 95 00 00 0a 1b 5a fe 04 13 06 11 06 3a 60 ff ff ff}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLH_2147813470_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLH!MTB"
        threat_id = "2147813470"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {f2 02 f4 02 0f 03 ef 02 0c 20 0c 06 eb 02 0c 20 0c 06 0c 20 0c 06 e3 02 0c 20 0c 06 0c 20 0c 06 cd 02 cd 02 d6 02 0c 20 0c 06 ea 02 05 03 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 df 02}  //weight: 1, accuracy: High
        $x_1_2 = {d6 02 f0 02 e0 02 e0 02 02 03 f7 02 e3 02 15 03 ef 02 f0 02 e1 02 16 03 d7 02 d6 02 09 03 17 03 e0 02 01 03 d2 02 15 03 0c 20 0c 06 f5 02 f0 02 eb 02 e8 02 ed 02 ea 02 04 03 c9 02 cd 02 cd 02 d6 02 f0 02 e0 02 df 02 e9 02 ed 02 ff 02 f0 02 02 03 f8}  //weight: 1, accuracy: High
        $x_1_3 = {06 e1 02 f2 02 f5 02 e1 02 e1 02 d1 02 0c 20 0c 06 0c 20 0c 06 f6 02 d3 02 cf 02 06 03 e6 02 d1 02 d7 02 f8 02 e0 02 0b 03 e4 02 e4 02 df 02 ef 02 0c 20 0c 06 0c 20 0c 06 05 03 0c 20 0c 06 0c 20 0c 06 f8 02 e3 02 15 03 f3 02 d2 02 00 03 ee 02 cd 02}  //weight: 1, accuracy: High
        $x_1_4 = {eb 02 df 02 e8 02 ef 02 ef 02 e7 02 df 02 15 03 09 03 0c 20 0c 06 0c 20 0c 06 e0 02 df 02 e3 02 05 03 e0 02 0c 20 0c 06 df 02 e0 02 df 02 e6 02 e7 02 e0}  //weight: 1, accuracy: High
        $x_1_5 = {df 02 e7 02 e3 02 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c}  //weight: 1, accuracy: High
        $x_1_6 = "CSP_Ticketing.Resources.resources" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLI_2147813471_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLI!MTB"
        threat_id = "2147813471"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 15 00 00 0a 0b 07 28 16 00 00 0a 03 6f 17 00 00 0a 6f 18 00 00 0a 0a 7e 37 00 00 04 06 6f 19 00 00 0a 00 7e 37 00 00 04 18 6f 1a 00 00 0a 00 7e 37 00 00 04 6f 1b 00 00 0a 80 38 00 00 04 02 28 15 00 00 06 0c 08 0d 7e 37 00 00 04 6f 1c 00 00 0a 00 09 13 04 2b 00 11 04 2a}  //weight: 1, accuracy: High
        $x_1_2 = "$3b1ec763-e6ba-4a6f-b3c1-ec054c8b6271" ascii //weight: 1
        $x_1_3 = "hauhauwe" ascii //weight: 1
        $x_1_4 = "%InJ%ector%" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLL_2147813492_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLL!MTB"
        threat_id = "2147813492"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 4a 06 4a 06 4d 00 4a 06 4a 06 4a 06 4a 06 45 00 4a 06 4a 06 4a 06 4a 06 2f 00 2f 00 38 00 4a 06 4a 06 4c 00 67 00 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 51 00 4a}  //weight: 1, accuracy: High
        $x_1_2 = {4a 06 4a 06 4a 06 6f 00 54 00 42 00 42 00 45 00 45 00 4b 00 67 00 49 00 47 00 49 00 46 00 31 00 42 00 77 00 4a 06 78 00 68 00 42 00 31 00 68 00 68 00 43}  //weight: 1, accuracy: High
        $x_1_3 = {4b 00 46 00 76 00 34 00 44 00 45 00 77 00 59 00 52 00 42 00 69 00 77 00 4a 00 42 00 68 00 38 00 74 00 62 00 79 00 67 00 4a 06}  //weight: 1, accuracy: High
        $x_1_4 = {42 00 57 00 67 00 4b 00 45 00 51 00 2f 00 4a 06 56 00 57 00 67 00 4b 00 77 00 51 00 2f 00 4a 06 56 00 57 00 67 00 4c 00 67 00 51 00 2f 00 4a 06 56 00 57}  //weight: 1, accuracy: High
        $x_1_5 = {77 00 67 00 49 00 43 00 4a 06 67 00 49 00 43 00 4a 06 67 00 45 00 42 00 77 00 49 00 49 00 43 00 4a 06 63 00 67 00 4a 06 77 00 67 00 64 00 42 00 51}  //weight: 1, accuracy: High
        $x_1_6 = {4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 4a 06 73 00 4a 06 4a 06 4a 06 44 00 4a 06 4a 06 4a 06 4a 06}  //weight: 1, accuracy: High
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLM_2147813493_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLM!MTB"
        threat_id = "2147813493"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$4c53915a-1f05-4e5c-8dcf-2f4e2291b3b4" ascii //weight: 1
        $x_1_2 = "CC.Common.Utils" ascii //weight: 1
        $x_1_3 = "BoardExample.Form1.resources" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "EventListener" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "DebuggableAttribute" ascii //weight: 1
        $x_1_9 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_10 = "FromBase64String" ascii //weight: 1
        $x_1_11 = "Replace" ascii //weight: 1
        $x_1_12 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HYTL_2147813524_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HYTL!MTB"
        threat_id = "2147813524"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Star_Admiral" ascii //weight: 1
        $x_1_2 = "Barbara" ascii //weight: 1
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "Prien" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Springfield" ascii //weight: 1
        $x_1_8 = {00 50 6f 73 69 74 69 6f 6e 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 4c 65 76 65 6c 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLP_2147813550_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLP!MTB"
        threat_id = "2147813550"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 7e 00 7e 00 4d 00 7e 00 7e 00 7e 00 7e 00 45 00 7e 00 7e 00 7e 00 7e 00 2f 00 2f 00 38 00 7e 00 7e 00 4c 00 67 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e}  //weight: 1, accuracy: High
        $x_1_2 = {7e 00 7e 00 7e 00 52 00 7e 00 6e 00 74 00 7a 00 7e 00 7e 00 7e 00 45 00 62 00 2f 00 67 00 7e 00 7e 00 7e 00 59 00 4b 00 42 00 69 00 6f 00 7e 00 7e 00 42 00 73 00 77 00 7e}  //weight: 1, accuracy: High
        $x_1_3 = {68 00 68 00 56 00 47 00 46 00 79 00 5a 00 32 00 56 00 30 00 7e 00 45 00 4a 00 6c 00 64 00 47 00 46 00 55 00 59 00 58 00 4a 00 6e 00 5a 00 58 00 51 00 7e 00 55 00 48 00 4a}  //weight: 1, accuracy: High
        $x_1_4 = "556e9660-fa3b-4329-bc1b-c85193ec749b" ascii //weight: 1
        $x_1_5 = {7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 73 00 7e 00 7e 00 7e 00 44}  //weight: 1, accuracy: High
        $x_1_6 = "EventListener" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NKQ_2147813559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NKQ!MTB"
        threat_id = "2147813559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 04 8e 69 1e 5a 6f ?? ?? ?? 0a 00 07 04 6f ?? ?? ?? 0a 00 07 05 8e 69 1e 5a 6f ?? ?? ?? 0a 00 07 05 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 0c 00 03 73 ?? ?? ?? 0a 0d 00 09 08 16 73 ?? ?? ?? 0a 13 04 00 03 8e 69 8d ?? ?? ?? 01 13 05 11 04 11 05 16 03 8e 69 6f ?? ?? ?? 0a 13 06 11 05 11 06 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0a 00 de 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "QW1zaVNjYW5CdWZmZXI=" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Probability density function" ascii //weight: 1
        $x_1_5 = "/pages/page_chart.xaml" ascii //weight: 1
        $x_1_6 = "78t79|89T55|698y986|" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLV_2147813611_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLV!MTB"
        threat_id = "2147813611"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 08 06 08 18 5a 18 6f 30 00 00 0a 1f 10 28 b0 00 00 0a 9c 08 17 58 0c 08 20 00 58 00 00 fe 04 2d de}  //weight: 1, accuracy: High
        $x_1_2 = {2f 00 61 00 70 00 70 00 2e 00 78 00 61 00 6d 00 6c}  //weight: 1, accuracy: High
        $x_1_3 = {59 00 75 00 41 00 6f 00 20 00 32 00 30 00 31 00 32}  //weight: 1, accuracy: High
        $x_1_4 = "BackgroundWindow.xaml" ascii //weight: 1
        $x_1_5 = "IRemotingFormatter.ContinuationWrapper" ascii //weight: 1
        $x_1_6 = "XCreateInstance" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "MotivateDesktop.Properties.Resources.resources" ascii //weight: 1
        $x_1_9 = "Val3" ascii //weight: 1
        $x_1_10 = "Val1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KJS_2147813641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KJS!MTB"
        threat_id = "2147813641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "+k~~~KLeDeCgY" wide //weight: 1
        $x_1_2 = "cm9ncmFtIGN" wide //weight: 1
        $x_1_3 = "+Gw~~BBkRFF8Z" wide //weight: 1
        $x_1_4 = "Ub1Q~~~omKg~TM~I~Dg" wide //weight: 1
        $x_1_5 = "+n~~~Gb5c" wide //weight: 1
        $x_1_6 = "EventListener" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMA_2147813681_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMA!MTB"
        threat_id = "2147813681"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 31 00 00 0a 2b d5 28 ?? 00 00 06 2b d5 6f ?? 00 00 0a 2b d0 28 ?? 00 00 0a 2b cb 0b 2b ca 07 2b c9 07 2b c9 28 ?? 00 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "Pwjhhi.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMA_2147813681_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMA!MTB"
        threat_id = "2147813681"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 00 73 00 3a 00 23 00 24 00 40 00 40 00 23 00 24 00 40 00 40 00 74 00 72 00 61 00 6e 00 73 00 66 00 65 00 72 00 2e 00 73 00 68 00 2f 00 67 00 65 00 74 00 2f ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 2e 00 74 00 78 00 74}  //weight: 1, accuracy: Low
        $x_1_2 = {33 00 30 00 33 00 31 00 39 00 5c 00 61 00 73 00 70 00 6e 00 65 00 74 00 5f 00 63 00 6f 00 6d 00 70 00 69 00 6c 00 65 00 72 00 2e 00 65 00 78 00 65}  //weight: 1, accuracy: High
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "HttpWebRequest" ascii //weight: 1
        $x_1_7 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMB_2147813682_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMB!MTB"
        threat_id = "2147813682"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "kotadiainc.com/Vficclsin.jpg" ascii //weight: 1
        $x_1_2 = {2f 00 63 00 20 00 74 00 69 00 6d 00 65 00 6f 00 75 00 74 00 20 00 32 00 30}  //weight: 1, accuracy: High
        $x_1_3 = "GetMethods" ascii //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMC_2147813683_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMC!MTB"
        threat_id = "2147813683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 39 00 31 00 2e 00 32 00 34 00 33 00 2e 00 34 00 34 00 2e 00 31 00 34 00 32 00 2f}  //weight: 1, accuracy: High
        $x_1_2 = {52 00 65 00 76 00 65 00 72 00 73 00 65 00 00 07 63 00 6d 00 64}  //weight: 1, accuracy: High
        $x_1_3 = {2f 00 63 00 20 00 74 00 69 00 6d 00 65 00 6f 00 75 00 74 00 20 00 32 00 30}  //weight: 1, accuracy: High
        $x_1_4 = "WebRequest" ascii //weight: 1
        $x_1_5 = "GetExportedTypes" ascii //weight: 1
        $x_1_6 = "GetMethods" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMD_2147813684_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMD!MTB"
        threat_id = "2147813684"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {63 00 20 00 74 00 69 00 6d 00 65 00 6f 00 75 00 74 00 20 00 32 00 30}  //weight: 1, accuracy: High
        $x_1_2 = "185.222.58.56/cousin.png" ascii //weight: 1
        $x_1_3 = "GetByteArrayAsync" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "Mxlcipiyomkjax.Qzwpzbhka" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NME_2147813685_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NME!MTB"
        threat_id = "2147813685"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$5d663ad2-d6e2-43bf-a4ba-39383338364b" ascii //weight: 1
        $x_1_2 = {6f 0a 00 00 0a 0d 09 6f 37 00 00 0a 17 8d 09 00 00 01 25 16 1f 26 9d 6f 38 00 00 0a}  //weight: 1, accuracy: High
        $x_1_3 = "ClocktowersCurse.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "ToString" ascii //weight: 1
        $x_1_10 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJM_2147813717_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJM!MTB"
        threat_id = "2147813717"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 06 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 06 28 ?? ?? ?? 06 13 06 07 11 06 28 ?? ?? ?? 06 0b 00 09 17 d6 0d 0c 00 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJN_2147813718_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJN!MTB"
        threat_id = "2147813718"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0c 06 e3 02 0c 20 0c 06 0c 20 0c 06 df 02 d5 02 df 02 ef 02 0c 20 0c 06 f4 02 0c 20 0c 06 0c 20 0c 06 e5 02 ef 02 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 0c 20 0c 06 df 02 11 03 15 03 0c 20 0c 06 df 02 e8 02 eb 02 0c 20 0c 06 df 02 e2 02 ef 02 0c 20}  //weight: 1, accuracy: High
        $x_1_2 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJO_2147813736_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJO!MTB"
        threat_id = "2147813736"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a de 03 26 de 08 07 17 58 0b 07 03 31 df}  //weight: 1, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 67 65 74 5f 73 39 39 39 39 39 39 39 39 00}  //weight: 1, accuracy: High
        $x_1_4 = "s99999999" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJU_2147813737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJU!MTB"
        threat_id = "2147813737"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BFgCewQ~~~RYII074HwCewk~~~RYYX0H~~~" wide //weight: 1
        $x_1_2 = "Lo------ad" wide //weight: 1
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJP_2147813738_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJP!MTB"
        threat_id = "2147813738"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 06 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 13 05 12 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 06 18 d6 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {02 07 91 11 04 61 09 06 91 61 13 05 08 07 11 05 d2 9c 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLS_2147813773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLS!MTB"
        threat_id = "2147813773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 16 fe 02 16 fe 01 0c 08 2c 1c 07 17 d6 0b 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 2b d8}  //weight: 1, accuracy: Low
        $x_1_2 = "ToInt32" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMH_2147813787_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMH!MTB"
        threat_id = "2147813787"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 7e 00 7e 00 4d 00 7e 00 7e 00 7e 00 7e 00 45 00 7e 00 7e 00 7e 00 7e 00 2f 00 2f 00 38 00 7e 00 7e 00 4c 00 67 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 51 00 7e 00 7e}  //weight: 1, accuracy: High
        $x_1_2 = {62 00 7a 00 63 00 7e 00 7e 00 7e 00 59 00 74 00 6a 00 77 00 49 00 6f 00 46 00 51 00 7e 00 7e 00 42 00 69 00 73 00 49 00 7e 00 69 00 67 00 56 00 7e 00 7e 00 7e 00 47 00 33 00 68 00 49 00 43 00 46 00 48 00 30 00 55 00 7e 00 7e 00 7e 00 45 00 46}  //weight: 1, accuracy: High
        $x_1_3 = "$fe4922f0-79ae-48a1-9017-b46f8399fa9e" ascii //weight: 1
        $x_1_4 = "Super Saver" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMI_2147813788_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMI!MTB"
        threat_id = "2147813788"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://gffggfffffrograms/" wide //weight: 1
        $x_1_2 = {23 43 00 3a 00 5c 00 73 00 6f 00 6d 00 65 00 64 00 69 00 72 00 65 00 63 00 74 00 6f 00 72 00 79 00 5c}  //weight: 1, accuracy: High
        $x_1_3 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetFolderPath" ascii //weight: 1
        $x_1_6 = "faf.exe" ascii //weight: 1
        $x_1_7 = "/sfsf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMJ_2147813789_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMJ!MTB"
        threat_id = "2147813789"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#gdsgdhfdggggggdkksg.dll#" ascii //weight: 1
        $x_1_2 = "#dfg.dpolpll#" ascii //weight: 1
        $x_1_3 = "#gsdfggfgsd.dll#" ascii //weight: 1
        $x_1_4 = "#fd.pdll#" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPU_2147813866_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPU!MTB"
        threat_id = "2147813866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2b 1b 0a 2b db 7d 01 00 00 04 2b e7 0b 2b f1 20 d0 07 00 00 38 aa 00 00 00 07 17 58 0b 07 1b fe 04 0c 08 2c 03 17 2b 03 16 2b 00 2d e2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPU_2147813866_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPU!MTB"
        threat_id = "2147813866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "example.com" wide //weight: 1
        $x_1_2 = "Ttzyzat.png" wide //weight: 1
        $x_1_3 = "Mmayqxstemwa" wide //weight: 1
        $x_1_4 = "Wohhshm.Properties" wide //weight: 1
        $x_1_5 = "WriteLine" ascii //weight: 1
        $x_1_6 = "Reverse" ascii //weight: 1
        $x_1_7 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPU_2147813866_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPU!MTB"
        threat_id = "2147813866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "4040086543456789098765422.png" wide //weight: 1
        $x_1_3 = "Yodyuucdtshnqffxgjppyi.Xupkapxwtcye" wide //weight: 1
        $x_1_4 = "Bpjakqmn" wide //weight: 1
        $x_1_5 = "Email Checker Pro" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPM_2147813867_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPM!MTB"
        threat_id = "2147813867"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "142.132.176.217" wide //weight: 1
        $x_1_2 = "People.zip" wide //weight: 1
        $x_1_3 = "BillyBoy" wide //weight: 1
        $x_1_4 = "LinkCriate.exe" wide //weight: 1
        $x_1_5 = "JKAsbh128736NJB" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPN_2147813868_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPN!MTB"
        threat_id = "2147813868"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 07 08 06 08 06 8e 69 5d 91 02 08 91 61 d2 9c 00 08 17 58 0c 08 02 8e 69 fe 04 0d 09 2d e1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPN_2147813868_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPN!MTB"
        threat_id = "2147813868"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {05 49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65 00 00 09 4c 00 6f 00 61 00 64 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "NewLateBinding" ascii //weight: 1
        $x_1_4 = "System.Threading" ascii //weight: 1
        $x_1_5 = "Activator" ascii //weight: 1
        $x_1_6 = "LateGet" ascii //weight: 1
        $x_1_7 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPN_2147813868_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPN!MTB"
        threat_id = "2147813868"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "18.193.102.232" wide //weight: 1
        $x_1_2 = "874093401023.jpg" wide //weight: 1
        $x_1_3 = "/c timeout 19" wide //weight: 1
        $x_1_4 = "Malwarebytes" wide //weight: 1
        $x_1_5 = "Ytvvqzpvowsqaydomooqwt" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPO_2147813869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPO!MTB"
        threat_id = "2147813869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "Ppcmhx.png" wide //weight: 1
        $x_1_3 = "Fohaasgczksbcgoxrvvdxm" wide //weight: 1
        $x_1_4 = "Roeuatxrkjyfjmmcirht" wide //weight: 1
        $x_1_5 = "Iwxttrllaidvbjveq" wide //weight: 1
        $x_1_6 = "Email Checker Pro" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 11 14 1f 16 5d 91 61 07 11 16 11 04 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 04 0d 11 05 17 58 13 05 11 05 04 3f de ff ff ff 16 13 06 38 1b 00 00 00 06 09 5a 07 58 08 5d 13 04 0e 04 11 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 06 07 7e 04 00 00 04 07 91 02 07 02 8e 69 5d 91 61 d2 9c 00 07 17 58 0b 07 7e 04 00 00 04 8e 69 fe 04 0c 08 2d d9}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 06 1a 58 0a 00 11 07 17 58 13 07 11 07 07 fe 04 13 09 11 09 2d c7 00 11 06 17 58 13 06 11 06 07 fe 04 13 0a 11 0a 2d af}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 09 18 6f 13 00 00 0a 1f 10 28 14 00 00 0a 13 04 11 04 16 3f 08 00 00 00 08 11 04 6f 15 00 00 0a 09 18 58 0d 09 07 6f 16 00 00 0a 32 d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 03 00 00 0a 18 2c 03 17 2b 03 16 2b 00 2d 0d 26 7e 01 00 00 04 6f 04 00 00 0a 2b 07 80 01 00 00 04 2b ed 2a}  //weight: 1, accuracy: High
        $x_1_2 = "Stopwatch" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {04 17 59 13 07 11 12 20 31 01 00 00 91 1f 68 59 13 10 38 5f fe ff ff 11 06 74 05 00 00 1b 11 07 8f 01 00 00 01 25 71 01 00 00 01 11 07 04 58 05 59 20 ff 00 00 00 5f d2 61 d2 81 01 00 00 01 11 12 20 9c 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 11 04 1a 11 07 5a 09 19 1a 11 07 5a 58 91 9c 11 04 17 1a 11 07 5a 58 09 18 1a 11 07 5a 58 91 9c 11 04 18 1a 11 07 5a 58 09 17 1a 11 07 5a 58 91 9c 11 04 19 1a 11 07 5a 58 09 1a 11 07 5a 91 9c 00 11 07 17 58 13 07 11 07 1f 10 fe 04 13 08 11 08 2d ac}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {16 0b 2b 22 11 04 06 07 28 bb 00 00 06 13 05 11 05 28 e0 00 00 0a 13 06 09 08 11 06 28 e1 00 00 0a 9c 07 17 58 0b 07 17 fe 04 13 07 11 07 2d d4}  //weight: 1, accuracy: High
        $x_1_2 = "ColorTranslator" ascii //weight: 1
        $x_1_3 = "ToWin32" ascii //weight: 1
        $x_1_4 = "ToByte" ascii //weight: 1
        $x_1_5 = "Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPY_2147813884_9
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPY!MTB"
        threat_id = "2147813884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "107.172.206.120/000/" wide //weight: 1
        $x_1_2 = "Jyeguvzxa.png" wide //weight: 1
        $x_1_3 = "GetExportedTypes" wide //weight: 1
        $x_1_4 = "HttpClient" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "FileStream" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
        $x_1_8 = "Encoding" ascii //weight: 1
        $x_1_9 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 06 11 04 5d 13 07 11 06 11 05 5d 13 08 11 06 17 58 11 04 5d 13 09 07 11 07 91 08 11 08 91 61}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0a 06 18 5b 8d 6d 00 00 01 0b 16 0c 2b 1a 00 07 08 18 5b 02 08 18 6f a2 00 00 0a 1f 10 28 a3 00 00 0a 9c 00 08 18 58 0c 08 06 fe 04 0d 09 2d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 1f 19 fe 04 16 fe 01 0b 07 2c 17 02 7b 09 00 00 04 7b 1e 00 00 04 06 8f 04 00 00 02 17 7d 12 00 00 04 06 17 58 0a 06 1f 1e fe 04 0c 08 3a 26 ff ff ff}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {13 0d 07 11 09 17 58 09 5d 91 13 0e 11 0c 11 0d 61 11 0e 59 20 00 01 00 00 58 13 0f 07 11 0a 11 0f 20 00 01 00 00 5d d2 9c 00 11 09 17 59 13 09 11 09 16 fe 04 16 fe 01 13 10 11 10 2d a6}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 1e 00 00 04 0a 06 28 31 00 00 0a 7e 1e 00 00 04 02 12 02 6f 32 00 00 0a 2c 04 08 0b de 11 02 17 28 21 00 00 06 0b de 07 06 28 33 00 00 0a dc 07 2a}  //weight: 1, accuracy: High
        $x_1_2 = "Dictionary" ascii //weight: 1
        $x_1_3 = "Concat" ascii //weight: 1
        $x_1_4 = "TryGetValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 16 13 04 2b 21 00 07 09 11 04 6f 96 00 00 0a 13 06 08 12 06 28 97 00 00 0a 6f 98 00 00 0a 00 11 04 17 58 13 04 00 11 04 07 6f 99 00 00 0a 13 08 12 08 28 9a 00 00 0a fe 04 13 07 11 07 2d c6 09 17 58 0d 00 09 07 6f 99 00 00 0a 13 08 12 08 28 9b 00 00 0a fe 04 13 09 11 09 2d a3}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPZ_2147813885_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPZ!MTB"
        threat_id = "2147813885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "80.66.75.37" wide //weight: 1
        $x_1_2 = "a-Bdmkwzqec.bmp" wide //weight: 1
        $x_1_3 = "Replace" wide //weight: 1
        $x_1_4 = "ToArray" wide //weight: 1
        $x_1_5 = "ReadChar" wide //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "HttpWebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMO_2147813952_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMO!MTB"
        threat_id = "2147813952"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$d0263248-8e8b-4fd4-854f-f0f586aa919e" ascii //weight: 1
        $x_1_2 = "SharpStructures.Main.SortHelper" ascii //weight: 1
        $x_1_3 = "Cycle_Jump_Game.Properties.Resources.resource" ascii //weight: 1
        $x_1_4 = "IbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJ" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJQ_2147813975_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJQ!MTB"
        threat_id = "2147813975"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a de 03 26 de 08 07 17 58 0b 07 03 31 df}  //weight: 1, accuracy: Low
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = "matejpg" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EJR_2147813976_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EJR!MTB"
        threat_id = "2147813976"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "powershell" wide //weight: 1
        $x_1_2 = "-enc YwBtAGQAIAAvAGMAIAB0AGkAbQBlAG8AdQB0ACAAMgAwAA==" wide //weight: 1
        $x_1_3 = {00 54 6f 41 72 72 61 79 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 72 6f 6d 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = "GetTypes" ascii //weight: 1
        $x_1_6 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKI_2147813981_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKI!MTB"
        threat_id = "2147813981"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {45 00 43 00 67 00 59 00 66 00 2f 00 53 00 34 00 45 00 42 00 68 00 63 00 7a 00 43 00 67 00 44 00 65 00 42 00 77 00 49 00 6f 00 42 00 28 06 27 06 28 06 27 06 28 06 27 06 42 00 74 00 77 00 71 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 00}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" wide //weight: 1
        $x_1_4 = "SharpStructures.Main.SortHelper" wide //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKA_2147813982_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKA!MTB"
        threat_id = "2147813982"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 0a 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 0c 00 08 09 6f c0 00 00 0a 28 c1 00 00 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {00 5a 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5a 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMP_2147814032_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMP!MTB"
        threat_id = "2147814032"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {07 16 fe 02 16 fe 01 0c 08 2c 1c 07 17 d6 0b 06 72 e9 08 00 70 28 bf 00 00 0a 8c 82 00 00 01 6f c0 00 00 0a 00 2b d8}  //weight: 10, accuracy: High
        $x_10_2 = {07 16 fe 02 16 fe 01 0c 08 2c 1c 07 17 d6 0b 06 72 e9 08 00 70 28 bf 00 00 0a 8c 3c 00 00 01 6f c0 00 00 0a 00 2b d8}  //weight: 10, accuracy: High
        $x_10_3 = {07 16 fe 02 16 fe 01 0c 08 2c 1c 07 17 d6 0b 06 72 04 3d 00 70 28 73 01 00 0a 8c 66 00 00 01 6f c8 00 00 0a 00 2b d8}  //weight: 10, accuracy: High
        $x_1_4 = "ToInt32" ascii //weight: 1
        $x_1_5 = "GetObjectValue" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NMQ_2147814033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMQ!MTB"
        threat_id = "2147814033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "Vsrrp.Properties.Resources.resources" ascii //weight: 10
        $x_10_2 = {58 00 6a 00 61 00 70 00 72 00 69 00 78 00 6b 00 62 00 72 00 70 00 6d 00 73 00 79 00 7a 00 66 00 6c 00 69 00 64 00 6e 00 73 00 79 00 69 00 73}  //weight: 10, accuracy: High
        $x_1_3 = "powershell" wide //weight: 1
        $x_1_4 = "-enc YwBtAGQAIAAvAGMAIAB0AGkAbQBlAG8AdQB0ACAAMgAwAA==" wide //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MF_2147814040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MF!MTB"
        threat_id = "2147814040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {57 1d a2 1d 09 0b 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 31 00 00 00 09 00 00 00 2b 00 00 00 38 00 00 00 1d}  //weight: 1, accuracy: High
        $x_1_2 = {0d 08 09 28 ?? ?? ?? 06 09 16 6a 6f ?? ?? ?? 0a 09 13 04 dd 2d 01 00 00 20 00 00 af 0d fe 0e 06 00 00 fe 0d 06 00 48 68 d3 13 05 2b 0a}  //weight: 1, accuracy: Low
        $x_1_3 = "apimit" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MF_2147814040_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MF!MTB"
        threat_id = "2147814040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 2b f3 72 ?? 00 00 70 28 ?? ?? ?? 0a 13 07 11 07 14 fe 03 13 08 11 08 2c 57 11 07 6f ?? ?? ?? 0a 0a 06 14 fe 03 13 09 11 09 2c 45 06 6f ?? ?? ?? 0a 0b 73 ?? 00 00 0a 0c 20 00 04 00 00 8d 03 00 00 01 13 04 07 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 13 05 08 11 04 16 11 05 6f ?? ?? ?? 0a 11 06 11 05 58 13 06 11 05 16 fe 02 13 0a 11 0a 2d d4}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "Exception" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MG_2147814041_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MG!MTB"
        threat_id = "2147814041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 11 0a 74 09 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 74 09 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f 45 00 00 0a 26 1f 0b 13 0e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MG_2147814041_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MG!MTB"
        threat_id = "2147814041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0a 2b 27 7e 13 00 00 04 06 7e 13 00 00 04 06 9a 19 28 ?? ?? ?? 0a 72 cf 00 00 70 72 d3 00 00 70 6f ?? ?? ?? 0a a2 06 17 58 0a 06 7e 13 00 00 04 8e 69 32 cf}  //weight: 10, accuracy: Low
        $x_1_2 = "GetTempPath" ascii //weight: 1
        $x_1_3 = "KillProcs" ascii //weight: 1
        $x_1_4 = "RunClient" ascii //weight: 1
        $x_1_5 = "Password" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "DownloadFile" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MG_2147814041_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MG!MTB"
        threat_id = "2147814041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 ff b6 ff 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 1f 02 00 00 41 01 00 00 23 06}  //weight: 10, accuracy: High
        $x_1_2 = "StopThread" ascii //weight: 1
        $x_1_3 = "add_PasswordChanged" ascii //weight: 1
        $x_1_4 = "Clipboard" ascii //weight: 1
        $x_1_5 = "get_Password" ascii //weight: 1
        $x_1_6 = "_sendEmote" ascii //weight: 1
        $x_1_7 = "IsBotRunning" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "TakeScreenshotToPath" ascii //weight: 1
        $x_1_10 = "get_VirtualScreen" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MG_2147814041_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MG!MTB"
        threat_id = "2147814041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 14 13 04 00 72 ?? 00 00 70 28 ?? ?? ?? 0a 13 05 11 05 14 fe 03 13 06 11 06 2c 5f 00 11 05 6f ?? ?? ?? 0a 13 04 11 04 14 fe 03 13 07 11 07 2c 49 00 11 04 6f ?? ?? ?? 0a 0c 73 ?? 00 00 0a 0d 20 00 04 00 00 8d 2b 00 00 01 13 08 00 08 11 08 16 11 08 8e 69 6f ?? ?? ?? 0a 13 09 09 11 08 16 11 09 6f ?? ?? ?? 0a 00 07 11 09 58 0b 00 11 09 16 fe 02 13 0a 11 0a 2d d3}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "Exception" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKB_2147814095_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKB!MTB"
        threat_id = "2147814095"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 9a 0d 00 09 6f ?? ?? ?? 0a 13 04 16 13 05 2b 60 11 04 11 05 9a 13 06 00 11 06 6f ?? ?? ?? 0a 13 07 16 13 08 2b 3c 11 07 11 08 9a 13 09 00 00 28 ?? ?? ?? 06 11 06 72 ?? ?? ?? 70 20 00 01 00 00 14 14 14}  //weight: 1, accuracy: Low
        $x_1_2 = "/c timeout 19" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKC_2147814096_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKC!MTB"
        threat_id = "2147814096"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 16 fe 01 0c 08 2c 0c 06 07 b4 6f ?? ?? ?? 0a 00 00 2b 18 00 06 07 18 32 07 20 ff 00 00 00 2b 03 03 07 d8 b4 6f ?? ?? ?? 0a 00 00 07 17 d6 0b 00 07 1f 10 fe 04 0d 09}  //weight: 1, accuracy: Low
        $x_1_2 = "System.Reflection.Assembly" wide //weight: 1
        $x_1_3 = "GetTypes" wide //weight: 1
        $x_1_4 = "GetMethods" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKM_2147814097_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKM!MTB"
        threat_id = "2147814097"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 8e 69 17 da 17 d6 8d ?? ?? ?? 01 0c 08 07 08 16 02 8e 69 6f ?? ?? ?? 0a 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0a de 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {0a ca ed b8 28 26 11 22 5b 70 2a 48 7e f2 e0 43 a3 08 54 d1 ed 9f b6 1c 21 de 51 bb 79 79 dd fb 1b e4 96 fb bd da 02 cf 8c e5 a5 82 c2 75 23 bf}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKD_2147814154_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKD!MTB"
        threat_id = "2147814154"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 9a 0c 00 08 6f ?? ?? ?? 0a 0d 16 13 04 [0-5] 09 11 04 9a 13 05 00 11 05 6f ?? ?? ?? 0a 13 06 16 13 07 [0-5] 11 06 11 07 9a 13 08 11 08 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 09 11 09 [0-5] 11 08 14 14}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKX_2147814155_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKX!MTB"
        threat_id = "2147814155"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 08 09 6f ?? ?? ?? 0a 13 0a 11 0a 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 0b 11 0b 2c 27 07 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 09 17 d6 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 41 72 67 62 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKX_2147814155_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKX!MTB"
        threat_id = "2147814155"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 9a 0c 00 00 08 6f ?? ?? ?? 0a 0d 16 13 04 2b 2f 09 11 04 9a 13 05 00 11 05 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 06 11 06 2c 0a 00 11 05 28 ?? ?? ?? 06 00 00 00 11 04 17 58 13 04 11 04 09 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPH_2147814164_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPH!MTB"
        threat_id = "2147814164"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "Ecybat.png" wide //weight: 1
        $x_1_3 = "Vugccipjmoqdpmd" wide //weight: 1
        $x_1_4 = "WriteLine" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "HttpClient" ascii //weight: 1
        $x_1_7 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPH_2147814164_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPH!MTB"
        threat_id = "2147814164"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {31 00 33 00 2e 00 35 00 31 00 2e 00 31 00 37 00 33 00 2e 00 32 00 30 00 36 00 2f 00 [0-64] 2f 00 6c 00 6f 00 61 00 64 00 65 00 72 00 2f 00 75 00 70 00 6c 00 6f 00 61 00 64 00 73 00 [0-64] 2e 00 62 00 6d 00 70 00}  //weight: 10, accuracy: Low
        $x_10_2 = {31 00 33 00 2e 00 35 00 31 00 2e 00 31 00 37 00 33 00 2e 00 32 00 30 00 36 00 2f 00 [0-64] 2f 00 6c 00 6f 00 61 00 64 00 65 00 72 00 2f 00 75 00 70 00 6c 00 6f 00 61 00 64 00 73 00 [0-64] 2e 00 6a 00 70 00 67 00}  //weight: 10, accuracy: Low
        $x_10_3 = {31 00 33 00 2e 00 35 00 31 00 2e 00 31 00 37 00 33 00 2e 00 32 00 30 00 36 00 2f 00 [0-64] 2f 00 6c 00 6f 00 61 00 64 00 65 00 72 00 2f 00 75 00 70 00 6c 00 6f 00 61 00 64 00 73 00 [0-64] 2e 00 70 00 6e 00 67 00}  //weight: 10, accuracy: Low
        $x_10_4 = {31 00 33 00 2e 00 35 00 31 00 2e 00 31 00 37 00 33 00 2e 00 32 00 30 00 36 00 2f 00 [0-64] 2f 00 6c 00 6f 00 61 00 64 00 65 00 72 00 2f 00 75 00 70 00 6c 00 6f 00 61 00 64 00 73 00 [0-64] 2e 00 62 00 61 00 74 00}  //weight: 10, accuracy: Low
        $x_10_5 = {32 00 2e 00 35 00 38 00 2e 00 31 00 34 00 39 00 2e 00 32 00 2f 00 [0-64] 2e 00 70 00 6e 00 67 00}  //weight: 10, accuracy: Low
        $x_10_6 = {32 00 2e 00 35 00 38 00 2e 00 31 00 34 00 39 00 2e 00 32 00 2f 00 [0-64] 2e 00 6a 00 70 00 67 00}  //weight: 10, accuracy: Low
        $x_10_7 = {32 00 2e 00 35 00 38 00 2e 00 31 00 34 00 39 00 2e 00 32 00 2f 00 [0-64] 2e 00 62 00 6d 00 70 00}  //weight: 10, accuracy: Low
        $x_10_8 = {36 00 32 00 2e 00 31 00 39 00 37 00 2e 00 31 00 33 00 36 00 2e 00 33 00 2f 00 [0-64] 2e 00 62 00 6d 00 70 00}  //weight: 10, accuracy: Low
        $x_10_9 = {36 00 32 00 2e 00 31 00 39 00 37 00 2e 00 31 00 33 00 36 00 2e 00 33 00 2f 00 [0-64] 2e 00 70 00 6e 00 67 00}  //weight: 10, accuracy: Low
        $x_10_10 = {36 00 32 00 2e 00 31 00 39 00 37 00 2e 00 31 00 33 00 36 00 2e 00 33 00 2f 00 [0-64] 2e 00 6a 00 70 00 67 00}  //weight: 10, accuracy: Low
        $x_1_11 = "ToArray" ascii //weight: 1
        $x_1_12 = "WebClient" ascii //weight: 1
        $x_1_13 = "GetType" ascii //weight: 1
        $x_1_14 = "DynamicInvoke" ascii //weight: 1
        $x_1_15 = "DownloadData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RPJ_2147814165_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPJ!MTB"
        threat_id = "2147814165"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 23 00 00 00 00 00 88 d3 40 73 1f 00 00 0a 0a 06 02 fe 06 06 00 00 06 73 20 00 00 0a 6f 21 00 00 0a 00 06 17 6f 22 00 00 0a 00 06 16 6f 23 00 00 0a 00 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPJ_2147814165_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPJ!MTB"
        threat_id = "2147814165"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {7e 01 00 00 04 18 9a 20 d4 01 00 00 95 80 0a 00 00 04 7e 01 00 00 04 19 ?? ?? 9a 1f 2c 8f 05 00 00 01 25 71 05 00 00 01 ?? ?? 7e 01 00 00 04 18 9a 20 9b 02 00 00 95 61 81 05 00 00 01 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPJ_2147814165_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPJ!MTB"
        threat_id = "2147814165"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "dera_crypted.jpg" wide //weight: 1
        $x_1_3 = "Fzqqeqtnosrcasbpkr" wide //weight: 1
        $x_1_4 = "-enc YwBtAGQAIAAvAGMAIAB0AGkAbQBlAG8AdQB0ACAAMgAwAA" wide //weight: 1
        $x_1_5 = "powershell" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNA_2147814211_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNA!MTB"
        threat_id = "2147814211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://185.222.58.56/" wide //weight: 1
        $x_1_2 = {28 05 00 00 06 00 28 06 00 00 06 00 28 08 00 00 06 00 2a}  //weight: 1, accuracy: High
        $x_1_3 = "GetByteArrayAsync" ascii //weight: 1
        $x_1_4 = "Start-Sleep -s 19" ascii //weight: 1
        $x_1_5 = "powershell" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MJ_2147814215_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MJ!MTB"
        threat_id = "2147814215"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 14 13 04 00 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 05 11 05 14 fe 03 13 06 11 06 39 ?? ?? ?? ?? ?? 11 05 6f ?? ?? ?? 0a 13 04 11 04 14 fe 03 13 07 11 07 39 ?? ?? ?? ?? ?? 11 04 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 20 00 04 00 00 8d ?? 00 00 01 13 08 00 08 11 08 16 11 08 8e 69 6f ?? ?? ?? 0a 13 09 09 11 08 16 11 09 6f ?? ?? ?? 0a 00 07 11 09 58 0b 00 11 09 16 fe 02 13 0a 11 0a 3a}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "Exception" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNB_2147814238_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNB!MTB"
        threat_id = "2147814238"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {a2 25 18 7e 00 3a 00 04 a2 25 19 17 8c ?? ?? ?? 01 a2 13 01}  //weight: 5, accuracy: Low
        $x_1_2 = "WindowsFormsApp3.Form1.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNB_2147814238_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNB!MTB"
        threat_id = "2147814238"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 16 fe 02 16 fe 01 0c 08 2c 1c 07 17 d6 0b 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 2b d8}  //weight: 1, accuracy: Low
        $x_1_2 = "ToInt32" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNC_2147814239_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNC!MTB"
        threat_id = "2147814239"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 1d 09 1d 09 4d 00 1d 09 1d 09 1d 09 1d 09 45 00 1d 09 1d 09 1d 09 1d 09 2f 00 2f 00 38 00 1d 09 1d 09 4c 00 67 00 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 51}  //weight: 1, accuracy: High
        $x_1_2 = {1d 09 1d 09 42 00 43 00 73 00 52 00 4b 00 77 00 1d 09 72 00 45 00 43 00 6f 00 43 00 4b 00 39 00 77 00 4b 00 4b 00 2b 00 4d 00 47 00 4b 00 2b 00 55 00 43 00 4b 00 2b 00 67 00 4c}  //weight: 1, accuracy: High
        $x_1_3 = {68 00 68 00 77 00 43 00 61 00 38 00 48 00 7a 00 77 00 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 77 00 42 00 47 00 1d 09 47 00 63 00 47 00 30 00 51}  //weight: 1, accuracy: High
        $x_1_4 = {1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 3d 00 3d}  //weight: 1, accuracy: High
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKV_2147814257_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKV!MTB"
        threat_id = "2147814257"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 28 ?? ?? ?? 06 20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 06 28 ?? ?? ?? 06 13 06 07 11 06 28 ?? ?? ?? 06 0b 00 09 17 d6 0d 09 08 28 ?? ?? ?? 06 fe 04 13 07 11 07 2d b8 0c 00 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKV_2147814257_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKV!MTB"
        threat_id = "2147814257"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 42 00 42 00 45 00 45 00 4b 00 67 00 49 00 47 00 49 00 46 00 31 00 42 00 77 00 28 06 27 06 78 00 68 00 42 00 31 00 68 00 68 00 43 00 57 00 45 00 54 00 45 00 68 00 45 00 53 00 42 00 69 00 43 00 43 00 57 00}  //weight: 1, accuracy: High
        $x_1_2 = "System.Convert" wide //weight: 1
        $x_1_3 = "FromBase64String" wide //weight: 1
        $x_1_4 = "SharpStructures.Main.SortHelper" wide //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPK_2147814261_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPK!MTB"
        threat_id = "2147814261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {17 59 7e 28 00 00 04 11 07 13 0a 18 9a 20 a0 0d 00 00 11 0d 13 07 95 5f 7e 28 00 00 04 18 9a 20 de 07 00 00 95 61 59 81 06 00 00 01 38 76 07 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPK_2147814261_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPK!MTB"
        threat_id = "2147814261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 17 8d 6c 00 00 01 25 16 08 17 8d 17 00 00 01 25 16 11 04 8c 59 00 00 01 a2 14 28 a8 00 00 0a 28 87 00 00 0a 1f 10 28 ae 00 00 0a 9c 6f af 00 00 0a 00 11 04 17 d6 13 04 00 11 04 20 00 7c 00 00 fe 04 13 06 11 06 2d b7}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPK_2147814261_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPK!MTB"
        threat_id = "2147814261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 11 0a 11 06 11 0a 9a 1f 10 28 4f 01 00 0a d2 9c 11 0a 17 58 13 0a 11 0a 11 06 8e 69 fe 04 13 0b 11 0b 2d da}  //weight: 1, accuracy: High
        $x_1_2 = "Melvin.White" wide //weight: 1
        $x_1_3 = "AmirCalendar" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPK_2147814261_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPK!MTB"
        threat_id = "2147814261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {72 00 61 00 64 00 69 00 6f 00 2d 00 68 00 69 00 74 00 2e 00 72 00 6f 00 2f 00 47 00 6e 00 63 00 6e 00 66 00 2e 00 70 00 6e 00 67}  //weight: 1, accuracy: High
        $x_1_2 = "WebRequest" ascii //weight: 1
        $x_1_3 = "GetResponse" ascii //weight: 1
        $x_1_4 = "GetResponseStream" ascii //weight: 1
        $x_1_5 = "ReadBytes" ascii //weight: 1
        $x_1_6 = "BinaryReader" ascii //weight: 1
        $x_1_7 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPK_2147814261_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPK!MTB"
        threat_id = "2147814261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "powershell" wide //weight: 1
        $x_1_3 = "-enc YwBtAGQAIAAvAGMAIAB0AGkAbQBlAG8AdQB0ACAAMgAwAA" wide //weight: 1
        $x_1_4 = "Bank_Report_000225.jpg" wide //weight: 1
        $x_1_5 = "Pqskjgbpagr" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPL_2147814262_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPL!MTB"
        threat_id = "2147814262"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 17 13 07 16 13 08 2b 10 11 07 20 00 01 00 00 5a 13 07 11 08 17 58 13 08 11 08 11 06 fe 04 13 0b 11 0b 2d e4 11 05 11 07 07 11 06 91 5a 58 13}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPL_2147814262_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPL!MTB"
        threat_id = "2147814262"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Xtzoolgejoscbxxji" wide //weight: 1
        $x_1_2 = "cdn.discordapp.com" wide //weight: 1
        $x_1_3 = "powershell" wide //weight: 1
        $x_1_4 = "-enc YwBtAGQAIAAvAGMAIAB0AGkAbQBlAG8AdQB0ACAAMgAwAA" wide //weight: 1
        $x_1_5 = "ENQUIRY_02032022.jpg" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ELC_2147814278_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELC!MTB"
        threat_id = "2147814278"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 49 44 65 66 65 72 72 65 64 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 6c 65 61 6e 75 70 00 57 6f 72 6b 4c 69 73 74 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 59 66 00 59 67 00 59 68 00 59 69 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 4d 65 73 73 61 67 65 44 61 74 61 00 54 77 6f 44 69 67 69 74 59 65 61 72 4d 61 78 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ELA_2147814279_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELA!MTB"
        threat_id = "2147814279"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 11 04 91 07 61 19 2c 3b 06 09 91 61}  //weight: 1, accuracy: High
        $x_1_2 = {8e 69 17 59 91 1f 70 61}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ELD_2147814280_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELD!MTB"
        threat_id = "2147814280"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 02 09 91 03 09 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 9c 09 17 d6 0d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NND_2147814335_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NND!MTB"
        threat_id = "2147814335"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 93 28 ?? ?? ?? 0a 1f 21 32 11 08 09 93 28 ?? ?? ?? 0a 1f 7e fe 02 16 fe 01 2b 01 16 2c 14 08 09 1f 21 08 09 93 1f 0e 58 1f 5e 5d 58 28 ?? ?? ?? 0a 9d 09 17 58 0d 09 07 6f ?? ?? ?? 0a fe 04 2d bd}  //weight: 1, accuracy: Low
        $x_1_2 = "5FGJ8XR44G5TFW4A4PA8P" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "SharpStructures.Sorting.SortHelper" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNE_2147814336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNE!MTB"
        threat_id = "2147814336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 39 08 09 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 04 28 ?? ?? ?? 06 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
        $x_1_2 = "Alpha.Beta" ascii //weight: 1
        $x_1_3 = "1Bu4ni5fu_TextBox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNG_2147814337_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNG!MTB"
        threat_id = "2147814337"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "63"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "cdn.discordapp.com/attachments/94" ascii //weight: 10
        $x_10_2 = "Reverse" ascii //weight: 10
        $x_10_3 = "GetExportedTypes" ascii //weight: 10
        $x_10_4 = "GetMethod" ascii //weight: 10
        $x_10_5 = "Runtine" ascii //weight: 10
        $x_10_6 = "InvokeMember" ascii //weight: 10
        $x_3_7 = "Ewpdebffkmooliledu.Qqiuktavojbspbc" ascii //weight: 3
        $x_3_8 = "Ghsouordm.Rxviadqxhuozven" ascii //weight: 3
        $x_3_9 = "Owmghuesewtwpnda.Zuuukpxlassklpmk" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((6 of ($x_10_*) and 1 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NNH_2147814354_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNH!MTB"
        threat_id = "2147814354"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Efffffsdfsdfsdffffffffsdfsdfffffffffff" ascii //weight: 1
        $x_1_2 = "aaaaaapfsdfdsfkpaagdfgdaaaaaaaaaaaaa" ascii //weight: 1
        $x_1_3 = "SFASGGGGGGGGGGGGGG" ascii //weight: 1
        $x_1_4 = "jfsddaaaaaaaaaaaaaaaaaagsdk" ascii //weight: 1
        $x_1_5 = "Masssssin" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ELF_2147814395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELF!MTB"
        threat_id = "2147814395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "6a611983-651c-4f4a-8e88-39ca244da0cd" ascii //weight: 1
        $x_1_2 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 68 72 57 00 54 6f 43 68 61 72 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 4d 65 74 68 6f 64}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ELK_2147814396_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELK!MTB"
        threat_id = "2147814396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 9e 02 00 00 da 13 05 11 05 28 ?? ?? ?? 06 28 ?? ?? ?? 06 13 06 07 11 06 28 ?? ?? ?? 06 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "#Get#Met#hod" wide //weight: 1
        $x_1_3 = "B#un#ifu#_Tex#tBo#x" wide //weight: 1
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ELK_2147814396_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELK!MTB"
        threat_id = "2147814396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 43 6c 65 61 6e 75 70 00 49 44 65 66 65 72 72 65 64 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 59 66 00 59 67 00 59 68 00 59 69 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 4d 65 73 73 61 67 65 44 61 74 61 00 54 77 6f 44 69 67 69 74 59 65 61 72 4d 61 78 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKL_2147814397_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKL!MTB"
        threat_id = "2147814397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1d 09 1d 09 1d 09 1d 09 1d 09 45 00 1d 09 1d 09 1d 09 52 00 1d 09 44 00 69 00 45 00 1d 09 1d 09 1d 09 1d 09 4f 00 49 00 55 00 1d 09 1d 09 1d 09 1d 09}  //weight: 1, accuracy: High
        $x_1_2 = {47 00 79 00 77 00 78 00 4b 00 77 00 45 00 57 00 43 00 77 00 4e 00 76 00 38 00 67 00 1d 09 1d 09 42 00 69 00 77 00 67 00 42 00 6d 00 2f 00 79 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LKG_2147814442_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LKG!MTB"
        threat_id = "2147814442"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "+k~~~KLeDeCgY" wide //weight: 1
        $x_1_2 = "cm9ncmFtIGN" wide //weight: 1
        $x_1_3 = "+Gw~~BBkRFF8Z" wide //weight: 1
        $x_1_4 = "Ub1Q~~~omKg~TM~I~Dg" wide //weight: 1
        $x_1_5 = "D~GRCCI~F~G" wide //weight: 1
        $x_1_6 = "EventListener" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKY_2147814456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKY!MTB"
        threat_id = "2147814456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {6a 00 6d 00 6b 00 58 00 57 00 49 00 30 00 5a 00 41 00 41 00 41 00 13 01 44 00 13 01 59 00 4e 00 46 00 68 00 4d 00 45 00 4f 00 45 00 45 00 41 00 41 00 41 00 41 00 41 00 41 00 68 00 45 00 45 00 6b 00}  //weight: 1, accuracy: High
        $x_1_2 = {01 45 00 45 00 41 00 6f 00 35 00 70 00 46 00 31 00 6e 00 2b 00 41 00 68 00 62 00 2b 00 41 00 52 00 4d 00 48 00 45 00 51 00 63 00 36 00 71 00 76}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKZ_2147814457_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKZ!MTB"
        threat_id = "2147814457"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 09 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 07 09 02 09 91 11 04 b4 61 9c 09 17 d6 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNI_2147814489_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNI!MTB"
        threat_id = "2147814489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$d8b1a107-4698-4382-b9cd-2c12bba4d06a" ascii //weight: 1
        $x_1_2 = {00 53 74 72 52 65 76 65 72 73 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
        $x_1_4 = "coffee_machine_control.Properties.Resources.resources" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = {00 4f 41 49 51 55 45 51 45 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 4f 41 49 51 45 48 47 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 4f 41 49 45 4a 58 43 5a 41 48 58 00}  //weight: 1, accuracy: High
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggingModes" ascii //weight: 1
        $x_1_11 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNJ_2147814490_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNJ!MTB"
        threat_id = "2147814490"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 2c 5b 16 13 07 16 13 08 09 6f 62 01 00 06 13 0a 11 0a 2c 1d 09 6f 64 01 00 06 6f 95 01 00 06 13 07 11 06 6f 64 01 00 06 6f 97 01 00 06 13 08 2b 1b 11 06 6f 64 01 00 06}  //weight: 1, accuracy: High
        $x_1_2 = "$968e7bd0-050e-4c77-9607-8803f13ae31f" ascii //weight: 1
        $x_1_3 = "Lytro.Windows.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_6 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EKW_2147814498_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EKW!MTB"
        threat_id = "2147814498"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 06 9a 1e 2d 0e 26 11 07 6f ?? ?? ?? 0a 13 04 16 0b 2b 4b 13 07 2b ef 11 04 07 9a 13 08 11 08 6f ?? ?? ?? 0a 13 05 16 0c 2b 29 11 05 08 9a 13 06 11 06 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 09 11 09 2c 08 11 06 28 ?? ?? ?? 06 26 08 17 58 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_3 = "-enc " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNL_2147814541_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNL!MTB"
        threat_id = "2147814541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f 3f 05 00 0a 17 73 ?? ?? ?? 0a 0c 08 02 16 02 8e 69 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "MG.Office.Editor.frmMain.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNL_2147814541_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNL!MTB"
        threat_id = "2147814541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1d 09 1d 09 67 00 4c 00 1d 09 1d 09 38 00 2f 00 2f 00 1d 09 1d 09 1d 09 1d 09 45 00 1d 09 1d 09 1d 09 1d 09 4d 00 1d 09 1d 09 51 00 71 00 56 00 54 00 01}  //weight: 1, accuracy: High
        $x_1_2 = {4e 00 49 00 66 00 4c 00 6c 00 59 00 42 00 1d 09 1d 09 1d 09 77 00 73 00 34 00 45 00 1d 09 1d 09 1d 09 4d 00 55 00 6a 00 59 00 64 00 52 00 61 00 4f 00 43 00 1d 09}  //weight: 1, accuracy: High
        $x_1_3 = {66 00 77 00 44 00 57 00 1d 09 1d 09 45 00 1d 09 45 00 1d 09 43 00 49 00 1d 09 64 00 77 00 42 00 42 00 51 00 43 00 48 00 1d 09 4e 00 67 00 1d 09 1d 09 51 00 1d 09 51 00 1d 09}  //weight: 1, accuracy: High
        $x_1_4 = {1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 1d 09 3d 00 3d}  //weight: 1, accuracy: High
        $x_1_5 = {53 00 68 00 61 00 72 00 70 00 53 00 74 00 72 00 75 00 63 00 74 00 75 00 72 00 65 00 73 00 2e 00 4d 00 61 00 69 00 6e 00 2e 00 53 00 6f 00 72 00 74 00 48 00 65 00 6c 00 70 00 65 00 72}  //weight: 1, accuracy: High
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNM_2147814542_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNM!MTB"
        threat_id = "2147814542"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "/hs.refsnart//:sptth" ascii //weight: 1
        $x_1_2 = "makefil.Frenc" ascii //weight: 1
        $x_1_3 = "PPoosege22222fwrwefwe" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "GFFQFFDSFWQFWQFWQ" ascii //weight: 1
        $x_1_7 = "GFFQFWQFWQFWQ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MH_2147814546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MH!MTB"
        threat_id = "2147814546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 2b f3 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 13 07 11 07 14 fe 03 13 08 11 08 2c 57 11 07 6f ?? ?? ?? 0a 0a 06 14 fe 03 13 09 11 09 2c 45 06 6f ?? ?? ?? 0a 0b 73 ?? ?? ?? 0a 0c 20 00 04 00 00 8d 03 00 00 01 13 04 07 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 13 05 08 11 04 16 11 05 6f ?? ?? ?? 0a 11 06 11 05 58 13 06 11 05 16 fe 02 13 0a 11 0a 2d d4}  //weight: 1, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "Exception" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPV_2147814578_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPV!MTB"
        threat_id = "2147814578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com" wide //weight: 1
        $x_1_2 = "attachments" wide //weight: 1
        $x_1_3 = "Jamckybf.bmp" wide //weight: 1
        $x_1_4 = "Xlotxfosrzkozy" wide //weight: 1
        $x_1_5 = "forums.txt" wide //weight: 1
        $x_1_6 = "get_Assembly" ascii //weight: 1
        $x_1_7 = "GetBytes" ascii //weight: 1
        $x_1_8 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPV_2147814578_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPV!MTB"
        threat_id = "2147814578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetByteArrayAsync" wide //weight: 1
        $x_1_2 = "185.222.58.56" wide //weight: 1
        $x_1_3 = "Edkpjv.jpg" wide //weight: 1
        $x_1_4 = "Pvzpdfh.Properties.Resources" wide //weight: 1
        $x_1_5 = "Rmjtnzgqbzqgxmjnrhkpdbhj" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPW_2147814579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPW!MTB"
        threat_id = "2147814579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "52.78.165.165" wide //weight: 1
        $x_1_2 = "RF02136000031.png" wide //weight: 1
        $x_1_3 = "Goaadfd.Properties.Resources" wide //weight: 1
        $x_1_4 = "Malware Scanner" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNO_2147814589_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNO!MTB"
        threat_id = "2147814589"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? ?? ?? 06 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
        $x_1_2 = {f2 02 f4 02 0f 03 ef 02 3d 72 eb 02 3d 72 3d 72 e3 02 3d 72 3d 72 cd 02 cd 02 d6 02 3d 72 ea 02 05 03 3d 72 3d 72 3d 72}  //weight: 1, accuracy: High
        $x_1_3 = {df 02 e5 02 d6 02 df 02 00 03 05 03 3d 72 df 02 e2 02 e3 02 df 02 ea 02 05 03 df 02 18 03 df 02 e1 02 d2 02 df 02 eb 02}  //weight: 1, accuracy: High
        $x_1_4 = "Alpha.Beta" ascii //weight: 1
        $x_1_5 = "B#un#ifu#_Tex#tBo#x" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNP_2147814590_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNP!MTB"
        threat_id = "2147814590"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 16 fe 02 16 fe 01 0c 08 2c 17 07 17 d6 0b 06 20 ?? ?? ?? 00 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 2b dd}  //weight: 1, accuracy: Low
        $x_1_2 = "ToInt32" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EMA_2147814610_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EMA!MTB"
        threat_id = "2147814610"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 1f 23 9d 28 ?? ?? ?? 0a 20 00 01 00 00 14 14 17 8d ?? ?? ?? 01 25 16 02 a2 28 ?? ?? ?? 0a 74 ?? ?? ?? 01 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {00 49 44 65 66 65 72 72 65 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 77 6f 44 69 67 69 74 59 65 61 72 4d 61 78 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4d 65 73 73 61 67 65 44 61 74 61 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 6c 65 61 6e 75 70 00}  //weight: 1, accuracy: High
        $x_1_8 = "#Load" wide //weight: 1
        $x_1_9 = "about" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EMB_2147814611_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EMB!MTB"
        threat_id = "2147814611"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 04 91 07 61 06 09 91 61 13 05 08 11 04 11 05 d2 9c 09 03 7e ?? ?? ?? 04 28 ?? ?? ?? 06 18 58 19 59 fe 01 13 06 11 06 39 ?? ?? ?? ?? 16 0d 38 ?? ?? ?? ?? 09 17 58 0d 00 11 04 17 58 13 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EMC_2147814612_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EMC!MTB"
        threat_id = "2147814612"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 02 8e 69 5d 02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 28 ?? ?? ?? 06 02 07 17 58 02 8e 69 5d 91 28 ?? ?? ?? 06 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = {02 11 01 02 8e 69 5d 02 11 01 02 8e 69 5d 91 11 04 11 01 11 04 8e 69 5d 91 61 7e ?? ?? ?? 04 28 ?? ?? ?? 06 02 11 01 17 58 02 8e 69 5d 91 7e ?? ?? ?? 04 28 ?? ?? ?? 06 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNQ_2147814639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNQ!MTB"
        threat_id = "2147814639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {23 44 00 72 00 61 00 67 00 6f 00 6e 00 62 00 61 00 6c 00 6c 00 2e 00 56 00 69 00 63 00 74 00 69 00 6d 00 00 0b 77 00 6f 00 72 00 6c 00 64 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "0.30319\\aspnet_compiler.exe" wide //weight: 1
        $x_1_3 = "transfer.sh/get/" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNR_2147814650_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNR!MTB"
        threat_id = "2147814650"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e0 02 0e 03 df 02 e5 02 15 03 df 02 f8 02 ef 02 e0 02 e8 02 df 02 e5 02 d2 02 df 02 f8 02 05 03 e0 02 14 03 3d 72 3d 72 3d 72 df 02 09 03 3d 72 ef 02 3d 72}  //weight: 1, accuracy: High
        $x_1_2 = {f5 02 f0 02 eb 02 ec 02 e9 02 d3 02 0c 03 01 03 e5 02 e0 02 eb 02 ef 02 e3 02 f0 02 e0 02 e4 02 e0 02 15 03 3d 72 df 02 e0 02 ce 02 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72}  //weight: 1, accuracy: High
        $x_1_3 = "$7297e18f-9458-4897-ac98-e5cd3eccc72e" ascii //weight: 1
        $x_1_4 = "SmartPotion.Resources.resources" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNS_2147814651_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNS!MTB"
        threat_id = "2147814651"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TagMp3Saito_WindowsFormsApplication.Properties.Resources.resources" ascii //weight: 1
        $x_1_2 = "$fbf91683-fadb-4e93-addf-47458b47b790" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
        $x_1_9 = "GetDelegateForFunctionPointer" ascii //weight: 1
        $x_1_10 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EMN_2147814682_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EMN!MTB"
        threat_id = "2147814682"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {b6 c5 9f c3 b6 c5 9f c3 b6 c5 9f c3 b6 c5 9f 43 c3 b6 c5 9f c4 93 c3 b6 c5 9f c3 b6 c5 9f 77 c3 b6 c5 9f c3 b6 c5 9f c3 b6 c5 9f 43 77 4d 51 c3}  //weight: 1, accuracy: High
        $x_1_2 = {c5 9f c3 b6 c5 9f c3 b6 c5 9f 4a 4d c3 b6 c5 9f 48 53 c3 b6 c5 9f 34 44 65 77 c3 b6 c5 9f 57 46 6b c3 b6 c5 9f c3 b6 c5 9f c3 b6 c5 9f c3 b6 c5}  //weight: 1, accuracy: High
        $x_1_3 = {c5 9f 6e 4e 49 62 67 c4 93 54 4d 30 68 56 47 68 70 63 79 c4 93 77 63 6d 39 6e 63 6d 46 74 49 47 4e 68 62 6d 35 76 64 43 c4 93 69 5a 53 c4 93 79}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EMM_2147814683_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EMM!MTB"
        threat_id = "2147814683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0b 07 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0b 07 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 0c 08}  //weight: 1, accuracy: Low
        $x_1_2 = {00 49 44 65 66 65 72 72 65 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 77 6f 44 69 67 69 74 59 65 61 72 4d 61 78 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4d 65 73 73 61 67 65 44 61 74 61 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 6c 65 61 6e 75 70 00}  //weight: 1, accuracy: High
        $x_1_8 = "about" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EMO_2147814684_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EMO!MTB"
        threat_id = "2147814684"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {78 6b a9 31 36 39 31 64 75 31 64 35 8e 9b 31 71 cf 64 31 35 71 77 39 35 71 39 31 35 39 31 64 71 31 64 35 71 64 31 71 77 64 31 35 71 77 39 35 31 39 31 35 39 31 64 71 31}  //weight: 1, accuracy: High
        $x_1_2 = {10 8d 38 7d a9 50 65 0c 5c 02 44 41 03 18 03 43 54 1c 57 5a 54 5f 57 5e 41 19 53 01 51 43 11 5b 51 0d 5f 51 33 2b 62 15 1c 18 5d 50 1f 34 3c 3f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOA_2147814772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOA!MTB"
        threat_id = "2147814772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 43 00 00 06 20 ?? ?? ?? 00 da 13 05 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 07 11 06 28 ?? ?? ?? 0a 0b 00 09 17 d6 0d 09 08 6f ?? ?? ?? 0a fe 04 13 07 11 07 2d b8}  //weight: 1, accuracy: Low
        $x_1_2 = "B#un#ifu#_Tex#tBo#x" ascii //weight: 1
        $x_1_3 = {3d 72 df 02 10 03 e1 02 e0 02 eb 02 e6 02 e6 02 15 03 0d 03 f2 02 e1 02 f2 02 06 03 d4 02 cd 02 14 03 cd 02 cd 02 e3 02 ef 02 02 03 cf 02 df 02 ef 02 3d 72 e5 02 17 03 0d 03 3d 72 e0 02 eb 02 15 03 e1 02 3d 72 d1 02 df 02 05 03 3d 72 df 02 15 03 3d 72}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOB_2147814773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOB!MTB"
        threat_id = "2147814773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$9748dded-e76a-4dc6-9061-c56935c24fb6" ascii //weight: 1
        $x_1_2 = "VendingMachineMk2.Properties.Resources.resource" ascii //weight: 1
        $x_1_3 = "IDeferred" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_9 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOD_2147814774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOD!MTB"
        threat_id = "2147814774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$5f8f1384-33cd-4b70-a9c1-1ca4bdebc21f" ascii //weight: 1
        $x_1_2 = "HCVQuestionnaire.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "IDeferred" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_8 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOE_2147814775_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOE!MTB"
        threat_id = "2147814775"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 f4 02 0f 03 ef 02 3d 72 eb 02 3d 72 3d 72 e3 02 3d 72 3d 72 cd 02 cd 02 d6 02 3d 72 ea 02 05 03 3d 72 3d 72 3d 72 3d 72 df 02 ef}  //weight: 1, accuracy: High
        $x_1_2 = {02 18 03 df 02 e1 02 d2 02 df 02 eb 02 3d 72 13 03 df 02 e2 02 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72 3d 72}  //weight: 1, accuracy: High
        $x_1_3 = "#Get#Met#hod" wide //weight: 1
        $x_1_4 = "$aa0c45b8-cc58-4fd7-92b7-df1943d53df" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOG_2147814776_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOG!MTB"
        threat_id = "2147814776"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 0b 06 16 73 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 0d de 1e}  //weight: 10, accuracy: Low
        $x_1_2 = "xNYLEq6LoTjDq7Ifk4c.GW5dSw6H5RTJ9qpMFLn" ascii //weight: 1
        $x_1_3 = "E8yX0cfAfZcIOBbq20T.fHItoQfoc1xSykgyGOk" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ELL_2147814825_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ELL!MTB"
        threat_id = "2147814825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 0a 06 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0b 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 20 00 01 00 00 14 14 14 6f ?? ?? ?? 0a 75 ?? ?? ?? 01 28 ?? ?? ?? 0a 26 00 2a 09 00 7e ?? ?? ?? 04 75}  //weight: 1, accuracy: Low
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 52 65 73 70 6f 6e 73 65 53 74 72 65 61 6d 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENA_2147814826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENA!MTB"
        threat_id = "2147814826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 00 06 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0c 08 72 ?? ?? ?? 70 20 00 01 00 00 14 14 14 6f ?? ?? ?? 0a 26 00 de 00}  //weight: 1, accuracy: Low
        $x_1_2 = {20 00 0c 00 00 28 14 00 00 0a 00 00 de 05}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 57 65 62 52 65 71 75 65 73 74 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENB_2147814827_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENB!MTB"
        threat_id = "2147814827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {8e 65 51 d1 8e 67 d1 8e 46 59 d1 8e 5a 51 42 79 d1 8e 48 4d d1 8e 61 51 42 76 d1 8e 47 34 d1 8e d1 8e d1 8e d1 8e 78 d1 8e 43 34 d1 8e 4d d1 8e}  //weight: 1, accuracy: High
        $x_1_2 = {8e 42 63 35 46 52 59 54 d1 8e 43 49 35 4d 78 59 54 d1 8e 43 30 35 53 52 59 54 d1 8e 44 67 35 59 52 59 54 d1 8e 45 4d 35 65 52 59 54 d1 8e 45 34}  //weight: 1, accuracy: High
        $x_1_3 = {42 69 5a 53 42 79 64 57 34 67 61 57 34 67 52 45 39 54 49 47 31 76 5a 47 55 75 44 51 30 4b 4a d1 8e d1 8e d1 8e d1 8e d1 8e d1 8e d1 8e d1 8e d1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENC_2147814828_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENC!MTB"
        threat_id = "2147814828"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5f 5a 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 49 44 65 66 65 72 72 65 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 77 6f 44 69 67 69 74 59 65 61 72 4d 61 78 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 6c 65 61 6e 75 70 00}  //weight: 1, accuracy: High
        $x_1_8 = " Load" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_END_2147814829_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.END!MTB"
        threat_id = "2147814829"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 04 91 11 01 61 11 09 11 03 91 61 13 05 20 03 00 00 00 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 59 91 1f 70 61 13 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOI_2147814889_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOI!MTB"
        threat_id = "2147814889"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$d3a79b3f-a324-4f1d-ac47-8204f42f7914" ascii //weight: 10
        $x_10_2 = "$8612c230-bab8-4826-b1a8-f1cc98c56431" ascii //weight: 10
        $x_1_3 = {74 00 70 00 00 05 73 00 3a 00 00 05 2f 00 2f 00 00 05 63 00 64 00 00 05 6e 00 2e 00 00 05 64 00 69 00 00 05 73 00 63 00 00 05 6f 00 72 00 00 05 64 00 61 00 00 05 70 00}  //weight: 1, accuracy: High
        $x_1_4 = {70 00 00 05 2e 00 63 00 00 05 6f 00 6d 00 00 05 2f 00 61 00 00 05 74 00 74 00 00 05 61 00 63 00 00 05 68 00 6d 00 00 05 65 00 6e 00 00 05 74 00 73 00 00 05 2f 00 39}  //weight: 1, accuracy: High
        $x_1_5 = "cHVzaHByb3h5LnB1c2hwcm94eQ==" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "DownloadData" ascii //weight: 1
        $x_1_8 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NOJ_2147814890_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOJ!MTB"
        threat_id = "2147814890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 16 fe 02 16 fe 01 0c 08 2c 17 07 17 d6 0b 06 20 ?? ?? ?? 00 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 2b dd}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToInteger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOK_2147814891_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOK!MTB"
        threat_id = "2147814891"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6ef8f107-c4d2-4b4d-a732-32c20732374a" ascii //weight: 1
        $x_1_2 = "_Z_________________________________________" ascii //weight: 1
        $x_1_3 = "IDeferred" ascii //weight: 1
        $x_1_4 = {00 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 00}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NOL_2147814905_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NOL!MTB"
        threat_id = "2147814905"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$fec8efb3-d55d-4104-b9f0-0aebbf34133a" ascii //weight: 1
        $x_1_2 = "Pyrite.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "DebuggerBrowsableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMM_2147814914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMM!MTB"
        threat_id = "2147814914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdfl.dll#" ascii //weight: 1
        $x_1_2 = "dfsdffffffffsdfsdfffffffffff" ascii //weight: 1
        $x_1_3 = "eddff.dll#" ascii //weight: 1
        $x_1_4 = "fdfsdd.pdll#" ascii //weight: 1
        $x_1_5 = "#gdsdfsdfs" ascii //weight: 1
        $x_1_6 = "FromBase64" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPE_2147814958_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPE!MTB"
        threat_id = "2147814958"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 04 93 28 13 00 00 0a 06 59 13 05 11 05 07 31 08 11 05 07 59 13 05 2b 0b 11 05 08 2f 06 11 05 07 58 13 05 09 11 04 11 05 28 15 00 00 0a 9d 11 04 17 58 13 04 11 04 09 8e 69 32 c3 09 73 16 00 00 0a 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENE_2147814970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENE!MTB"
        threat_id = "2147814970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 06 11 04 17 58 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 00 00 11 04 17 58 13 04 11 04 1b fe 04 13 05 11 05 2d d1}  //weight: 1, accuracy: Low
        $x_1_2 = {06 00 02 02 28 ?? ?? ?? 06 75 ?? ?? ?? 1b 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 00 72 ?? ?? ?? 70 06 28 ?? ?? ?? 06 00 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 00 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 00 72 ?? ?? ?? 70 06 28 ?? ?? ?? 06 00 02 28 ?? ?? ?? 06 00 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENF_2147814971_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENF!MTB"
        threat_id = "2147814971"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 8e 69 5d 7e ?? ?? ?? 04 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 06 03 08 17 58 03 8e 69 5d 91 59 20 fa 00 00 00 58 1e 58 18 59 20 00 01 00 00 5d d2 9c 08}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 3a 03 08 03 8e 69 5d 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03 08 17 58 03 8e 69 5d 91 59 20 fa 00 00 00 58 1e 58 18 59 20 00 01 00 00 5d d2 9c 08 17 58 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENG_2147814972_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENG!MTB"
        threat_id = "2147814972"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 20 00 38 01 00 5d 07 11 04 20 00 38 01 00 5d 91 08 11 04 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 11 04 17 58 20 00 38 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 00 11 04 15 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENH_2147814973_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENH!MTB"
        threat_id = "2147814973"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {ba 21 3d de cc 4b 9c e1 64 17 de 58 bb f0 d4 3b 4f 9d d6 29 14 44 02 1b 3d fe cc 49 3e 40 93 e4 db b8 bb d0 d4 db 44 bd d1 29 d4 c4 42 3b 3d 7e}  //weight: 1, accuracy: High
        $x_1_2 = {f5 00 fb cd a7 53 7b 79 0e ee ae 69 93 5a 33 15 79 5c cd 68 ea 90 c6 8a de 0a 68 40 6b 67 da c9 b2 c6 c1 e9 86 f9 c5 73 b2 8b 09 74 47 05 cc 8a}  //weight: 1, accuracy: High
        $x_1_3 = {40 bd d5 29 d4 c4 42 3b 3d de cc 4b 3e 4e 97 e4 df b8 bb d0 d4 db 40 bd d5 29 d4 c4 42 3b 3d de cc 4b 3e 4e 97 e4 df b8 bb d0 d4 db 40 bd d5 29}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENI_2147814974_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENI!MTB"
        threat_id = "2147814974"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 02 8e 69 17 59 91 1f 70 61 13 01}  //weight: 1, accuracy: High
        $x_1_2 = {02 11 09 91 11 01 61 11 00 11 03 91 61 13 05}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENJ_2147815012_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENJ!MTB"
        threat_id = "2147815012"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5f 5a 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 49 44 65 66 65 72 72 65 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 77 6f 44 69 67 69 74 59 65 61 72 4d 61 78 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 69 65 6c 64 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 54 79 70 65}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 6c 65 61 6e 75 70 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENK_2147815013_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENK!MTB"
        threat_id = "2147815013"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 08 20 00 38 01 00 5d 06 08 20 00 38 01 00 5d 91 07 08 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 06 08 17 58 20 00 38 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 08 15 58 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENL_2147815014_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENL!MTB"
        threat_id = "2147815014"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "6ef8f107-c4d2-4b4d-a732-32c20732374a" ascii //weight: 10
        $x_1_2 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 52 65 70 6c 61 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 74 61 73 6b 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NON_2147815038_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NON!MTB"
        threat_id = "2147815038"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "_Z_________________________________________" ascii //weight: 1
        $x_1_2 = "$fec8efb3-d89d-4104-b9f0-0aebbf34188a" ascii //weight: 1
        $x_1_3 = "AutoJack.Properties.Resources.resource" ascii //weight: 1
        $x_1_4 = "IDeferred" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
        $x_1_8 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMS_2147815050_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMS!MTB"
        threat_id = "2147815050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "Ltwbdjwjjuzxufa.Knjecun" ascii //weight: 10
        $x_10_2 = "Xhfqddgclmqyruymwtncgx.Lopjyqf" ascii //weight: 10
        $x_1_3 = "cdn.discordapp.com/attachments/9" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
        $x_1_5 = "Drama" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "ReadBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NMT_2147815051_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMT!MTB"
        threat_id = "2147815051"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Abuhcqdzfej.Ogaotrhptsjfsvp" ascii //weight: 1
        $x_1_2 = "Bpjymt.Properties.Resources" ascii //weight: 1
        $x_1_3 = "Jdnkgaxqram" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "GetByteArrayAsync" ascii //weight: 1
        $x_1_6 = "86226-0ae4-4677-a5" ascii //weight: 1
        $x_1_7 = "Reverse" ascii //weight: 1
        $x_1_8 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPA_2147815107_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPA!MTB"
        threat_id = "2147815107"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e7441eda-a67f-4fa7-b43e-19c766606fa7" ascii //weight: 1
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Polo.Properties.Resources.resources" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_7 = "Reverse" ascii //weight: 1
        $x_1_8 = "GetDelegateForFunctionPointer" ascii //weight: 1
        $x_1_9 = "DebuggableAttribute" ascii //weight: 1
        $x_1_10 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPB_2147815119_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPB!MTB"
        threat_id = "2147815119"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {75 00 88 25 88 25 44 00 88 25 88 25 88 25 88 25 4c 00 67 00 88 25 88 25 77 00 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25}  //weight: 1, accuracy: High
        $x_1_2 = {39 00 b6 00 b6 00 60 00 49 00 47 00 31 00 76 00 5a 00 47 00 55 00 75 00 44 00 51 00 30 00 4b 00 93 25 93 25 93 25 93 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88}  //weight: 1, accuracy: High
        $x_1_3 = {43 00 34 00 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 46 00 88 25 88 25 88 25 88 25 88 25 88 25 52 00 46 00 67 00 73 00 72 00 47 00 77 00 88 25 88 25 48 00 46 00 2f 00 34 00 92 25 4c 00 88 25 88 25 49 00 59}  //weight: 1, accuracy: High
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPC_2147815120_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPC!MTB"
        threat_id = "2147815120"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 16 fe 02 16 fe 01 0c 08 2c 17 07 17 d6 0b 06 20 ?? ?? ?? 00 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 00 2b dd}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToInteger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENM_2147815158_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENM!MTB"
        threat_id = "2147815158"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 20 00 14 01 00 5d 07 11 04 20 00 14 01 00 5d 91 08 11 04 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 11 04 17 58 20 00 14 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 04 15 58 13 04}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENN_2147815159_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENN!MTB"
        threat_id = "2147815159"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 11 04 91 11 01 61 11 00 11 03 91 61 13 05}  //weight: 1, accuracy: High
        $x_1_2 = {02 02 8e 69 17 59 91 1f 70 61 13 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENO_2147815160_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENO!MTB"
        threat_id = "2147815160"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 07 06 11 07 91 7e ?? ?? ?? 04 11 07 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 9c 11 07 17 d6 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPD_2147815194_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPD!MTB"
        threat_id = "2147815194"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {35 00 34 00 35 00 36 00 37 00 31 00 35 00 31 00 4b 22 4b 22 34 00 44 00 4b 22 4b 22 4b 22 4b 22 34 00 35 00 4b 22 4b 22 4b 22 4b 22 32 00 46 00 32 00 46 00 33 00 38}  //weight: 1, accuracy: High
        $x_1_2 = {34 00 38 00 35 00 35 00 34 00 32 00 4b 22 4b 22 4b 22 36 00 32 00 34 00 36 00 36 00 37 00 36 00 37 00 36 00 37 00 36 00 41 00 36 00 37 00 34 00 35 00 4b 22 4b 22 34 00 33 00 34 00 33}  //weight: 1, accuracy: High
        $x_1_3 = {33 00 33 00 34 00 4b 22 34 00 44 00 4b 22 4b 22 37 00 35 00 4b 22 34 00 34 00 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22}  //weight: 1, accuracy: High
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
        $x_1_6 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPF_2147815203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPF!MTB"
        threat_id = "2147815203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e7441eda-a67f-4fa7-b43e-19c766606fa7" ascii //weight: 1
        $x_1_2 = "g6pwWQ44xKhCXHsvSne.CN4qcq4MclarttE1ndg" ascii //weight: 1
        $x_1_3 = "Polo.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerStepThroughAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENP_2147815231_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENP!MTB"
        threat_id = "2147815231"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 20 00 14 01 00 5d 07 11 04 20 00 14 01 00 5d 91 08 11 04 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 11 04 17 58 20 00 14 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENQ_2147815232_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENQ!MTB"
        threat_id = "2147815232"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$8930e58d-317e-47c5-a5f9-5244b24db315" ascii //weight: 1
        $x_1_2 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 74 61 73 6b 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NMU_2147815294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NMU!MTB"
        threat_id = "2147815294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "18.156.82.84/ting/0/loader/uploads/" ascii //weight: 1
        $x_1_2 = "Reverse" ascii //weight: 1
        $x_1_3 = "GetResponseStream" ascii //weight: 1
        $x_1_4 = "ReadBytes" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "Program" ascii //weight: 1
        $x_1_8 = "Drama" ascii //weight: 1
        $x_1_9 = "Comedy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OQ_2147815295_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OQ!MTB"
        threat_id = "2147815295"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "_Z_________________________________________" ascii //weight: 1
        $x_1_2 = "IDeferred" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPG_2147815296_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPG!MTB"
        threat_id = "2147815296"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 07 06 20 ?? ?? ?? 00 5d 91 08 06 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 06 17 58 20 ?? ?? ?? 00 5d 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 06 15 58 0a 06 16 fe 04 16 fe 01 13 05 11 05 2d af}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPH_2147815309_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPH!MTB"
        threat_id = "2147815309"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 02 09 18 6f 78 00 00 0a 1f 10 28 c7 00 00 0a 28 c8 00 00 0a 6f c9 00 00 0a 26 09 18 d6 0d 09 08 31 dd}  //weight: 1, accuracy: High
        $x_1_2 = "_00000000005" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPJ_2147815310_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPJ!MTB"
        threat_id = "2147815310"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 20 00 14 01 00 5d 07 11 04 20 00 14 01 00 5d 91 08 11 04 1f 16 5d 6f ?? ?? ?? 0a 61 07 11 04 17 58 20 00 14 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 04 15 58 13 04 11 04 16 fe 04 16 fe 01 13 05 11 05 2d b0}  //weight: 1, accuracy: Low
        $x_1_2 = "GetObject" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPL_2147815311_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPL!MTB"
        threat_id = "2147815311"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6de75ca7-98dd-4c3f-9374-1c8fe4f053a4" ascii //weight: 1
        $x_1_2 = "newnewF454.Resources.resources" ascii //weight: 1
        $x_1_3 = "Substring" ascii //weight: 1
        $x_1_4 = {4c 00 6f 00 20 00 00 05 61 00 64}  //weight: 1, accuracy: High
        $x_1_5 = {35 00 36 00 37 00 31 00 35 00 31}  //weight: 1, accuracy: High
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPM_2147815312_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPM!MTB"
        threat_id = "2147815312"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 00 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 06 08 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 0d 06 6f ?? ?? ?? 0a 09 16 09 8e 69 6f ?? ?? ?? 0a 13 04 de 16}  //weight: 1, accuracy: Low
        $x_1_2 = "cdn.discordapp.com/attachments/95" ascii //weight: 1
        $x_1_3 = {28 02 00 00 06 0a 06 1f 09 18 28 05 00 00 06 0a 06 1d 19 28 05 00 00 06}  //weight: 1, accuracy: High
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "newNode" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "ToBuffer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPN_2147815313_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPN!MTB"
        threat_id = "2147815313"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 20 00 14 01 00 5d 07 06 20 00 14 01 00 5d 91 08 06 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 06 17 58 20 00 14 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 d2 9c 06 15 58 0a 06 16 fe 04 16 fe 01 13 05 11 05 2d b5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LFA_2147815345_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LFA!MTB"
        threat_id = "2147815345"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 08 20 00 38 01 00 5d 06 08 20 00 38 01 00 5d 91 07 08 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 06 08 17 58 20 00 38 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 08 15 58 0c 08 16 2f b4}  //weight: 10, accuracy: Low
        $x_1_2 = "C4Y97JB87GGH70GYUH8TCP" wide //weight: 1
        $x_1_3 = "TagClient" wide //weight: 1
        $x_1_4 = "ifcX5gLET" wide //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VEND_2147815347_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VEND!MTB"
        threat_id = "2147815347"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 04 20 00 14 01 00 5d 07 11 04 20 00 14 01 00 5d 91 08 11 04 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 11 04 17 58 20 00 14 01 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 04 15 58 13 04 11 04 16 fe 04 16 fe 01 13 05 11 05 2d a6}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "WFX.Showcase" wide //weight: 1
        $x_1_6 = "HTH444FC5FV8WA5A78887E" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENR_2147815359_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENR!MTB"
        threat_id = "2147815359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 20 00 14 01 00 5d 07 06 20 00 14 01 00 5d 91 08 06 1f 16 5d 6f ?? ?? ?? 0a 61 07 06 17 58 20 00 14 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENR_2147815359_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENR!MTB"
        threat_id = "2147815359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 0a 01 00 5d 07 09 20 00 0a 01 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 0a 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENR_2147815359_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENR!MTB"
        threat_id = "2147815359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 07 07 11 07 91 7e ?? ?? ?? 04 11 07 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 9c 11 07 17 d6 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENS_2147815360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENS!MTB"
        threat_id = "2147815360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 02 8e 69 17 59 91 1f 70 61}  //weight: 1, accuracy: High
        $x_1_2 = {02 11 04 91 11 01 61 11 09 11 03 91 61 13 05}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENS_2147815360_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENS!MTB"
        threat_id = "2147815360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 20 00 14 01 00 5d 07 11 04 20 00 14 01 00 5d 91 08 11 04 1f 16 5d 6f ?? ?? ?? 0a 61 07 11 04 17 58 20 00 14 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENS_2147815360_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENS!MTB"
        threat_id = "2147815360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {78 30 fe 68 37 47 41 30 4a 78 76 66 8e ae 76 44 f7 35 6a 6e 68 34 47 41 70 4e 78 76 66 71 51 76 44 4f 35 6a 6e 68 34 47 41 30 4e 78 76 66 71 51}  //weight: 1, accuracy: High
        $x_1_2 = {4e 70 7e 6e b0 94 73 80 5c 36 79 7e a9 f9 4a 8d b2 c8 7e f2 d7 f8 68 ce b7 80 0a 96 1f 25 09 3b 80 f1 4f b8 47 67 40 61 87 81 7a c1 e8 e4 62 bc}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPP_2147815365_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPP!MTB"
        threat_id = "2147815365"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2c 03 17 2b 03 16 2b 00 2d 03 26 2b 07 28 1a 00 00 0a 2b 00 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPP_2147815365_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPP!MTB"
        threat_id = "2147815365"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {39 00 31 00 2e 00 32 00 34 00 33 00 2e 00 34 00 34 00 2e 00 31 00 34 00 32 00 2f 00 [0-48] 2e 00 6a 00 70 00 67 00}  //weight: 10, accuracy: Low
        $x_1_2 = "WebRequest" ascii //weight: 1
        $x_1_3 = "Sleep" ascii //weight: 1
        $x_1_4 = "GetResponse" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "WebClient" ascii //weight: 1
        $x_1_8 = "DownloadData" ascii //weight: 1
        $x_1_9 = "DynamicInvoke" ascii //weight: 1
        $x_1_10 = "AddSeconds" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RPP_2147815365_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPP!MTB"
        threat_id = "2147815365"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {62 00 6c 00 75 00 65 00 63 00 6f 00 76 00 65 00 72 00 74 00 72 00 61 00 64 00 69 00 6e 00 67 00 2e 00 63 00 6f 00 6d 00 [0-16] 2e 00 74 00 78 00 74 00}  //weight: 1, accuracy: Low
        $x_1_2 = "dll.txt" wide //weight: 1
        $x_1_3 = "RUNRUNRUNRUNRUN" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "Convert" ascii //weight: 1
        $x_1_7 = "GetResponseStream" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPS_2147815366_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPS!MTB"
        threat_id = "2147815366"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 6f 5e 00 00 06 2d 06 73 a0 00 00 0a 7a 20 e8 03 00 00 28 9f 00 00 0a 06 12 02 6f 60 00 00 06 2c de}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPS_2147815366_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPS!MTB"
        threat_id = "2147815366"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cdn.discordapp.com/attachments" wide //weight: 1
        $x_1_2 = "Roblox_Error_Fixer.exe" wide //weight: 1
        $x_1_3 = "Delta.exe" wide //weight: 1
        $x_1_4 = "deltavers.txt" wide //weight: 1
        $x_1_5 = "randomstuff" ascii //weight: 1
        $x_1_6 = "WebClient" ascii //weight: 1
        $x_1_7 = "DownloadString" ascii //weight: 1
        $x_1_8 = "ZipFile" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {72 4d 01 00 70 28 04 01 00 0a 0b 07 72 51 01 00 70 28 04 01 00 0a 0b 07 72 51 01 00 70 28 04 01 00 0a 0b 07 72 55 01 00 70 28 04 01 00 0a 0b 07 72 59 01 00 70 28 04 01 00 0a 0b 07 72 5d 01 00 70 28 04 01 00 0a 0b 07 72 5d 01 00 70 28 04 01 00 0a 0b 07 72 61 01 00 70 28 04 01 00 0a 0b 07 72 65 01 00 70 28 04 01 00 0a 0b 07}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 06 11 05 11 1f 9a 1f 10 28 03 01 00 0a 86 6f 04 01 00 0a 00 11 1f 17 d6 13 1f 11 1f 11 1e 31 df}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 08 11 04 07 11 04 18 5a 18 6f 76 00 00 0a 1f 10 28 77 00 00 0a d2 9c 00 11 04 17 58 13 04 11 04 08 8e 69 fe 04 13 05 11 05 2d d4 d0}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 31 01 2a 20 dc 05 00 00 28 ?? 00 00 0a 11 07 17 58 13 07 11 07 1b 32 cc}  //weight: 1, accuracy: Low
        $x_1_2 = "Blissmosquito" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0c 2b 18 07 08 18 5b 02 08 18 ?? ?? 00 00 0a 1f 10 ?? ?? 00 00 0a 9c 08 18 58 0c 08 06 fe 04 0d 09 2d e0 07 13 04 11 04 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_5
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {d2 13 08 07 09 17 58 07 8e 69 5d 91 13 09 11 07 11 08 61 11 09 20 00 01 00 00 58 20 00 01 00 00 5d 59 13 0a 07 11 06 11 0a d2 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 0b 11 0b 2d ab}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_6
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 16 13 06 2b 5c 00 16 13 07 2b 44 00 16 13 08 2b 2c 00 09 11 04 11 07 58 11 06 11 08 58}  //weight: 1, accuracy: High
        $x_1_2 = {13 0a 08 07 11 0a 9c 07 17 58 0b 11 08 17 58 13 08 00 11 08 17 fe 04 13 0b 11 0b 2d c9}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_7
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 11 08 11 04 5d 13 09 11 08 11 05 5d 13 0a 11 08 17 58 11 04 5d 13 0b 07 11 09 91 08 11 0a 91 61 13 0c 11 0c 07 11 0b 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 13 0d 07 11 09 11 0d d2 9c 00 11 08 17 58 13 08 11 08 11 04 09 17 58 5a fe 04 13 0e 11 0e 2d aa}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_8
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {46 00 72 00 6f 00 6d 00 42 00 61 00 00 15 73 00 65 00 36 00 34 00 53 00 74 00 72 00 69 00 6e 00 67}  //weight: 1, accuracy: High
        $x_1_2 = "toyscenter.cl" wide //weight: 1
        $x_1_3 = "Yetbyrz.png" wide //weight: 1
        $x_1_4 = "HttpClient" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "Concat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_9
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bitbucket.org" wide //weight: 1
        $x_1_2 = "Rexx9674" wide //weight: 1
        $x_1_3 = "deadguy" wide //weight: 1
        $x_1_4 = "Xxoeb.png" wide //weight: 1
        $x_1_5 = "powershell" wide //weight: 1
        $x_1_6 = "-enc YwBtAGQAIAAvAGMAIAB0AGkAbQBlAG8AdQB0ACAAMgAwAA==" wide //weight: 1
        $x_1_7 = "Reverse" ascii //weight: 1
        $x_1_8 = "ToArray" ascii //weight: 1
        $x_1_9 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_10
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "clearrep@mymobileorder.com" wide //weight: 1
        $x_1_2 = "signons3.txt" wide //weight: 1
        $x_1_3 = "FileZilla" wide //weight: 1
        $x_1_4 = "FTP Navigator\\Ftplist.txt" wide //weight: 1
        $x_1_5 = "Network\\Cookies" wide //weight: 1
        $x_1_6 = "GetForegroundWindow" ascii //weight: 1
        $x_1_7 = "EnableClipboardLogger" ascii //weight: 1
        $x_1_8 = "EnableKeylogger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPX_2147815367_11
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPX!MTB"
        threat_id = "2147815367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Q29yb25vdmlydXMuQ29yb25vdmlydXM=" wide //weight: 1
        $x_1_2 = "QWN0aXZpdHk=" wide //weight: 1
        $x_1_3 = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce" wide //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetString" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "Invoke" ascii //weight: 1
        $x_1_9 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_10 = "SpecialFolder" ascii //weight: 1
        $x_1_11 = "GetFolderPath" ascii //weight: 1
        $x_1_12 = "Concat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPO_2147815403_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPO!MTB"
        threat_id = "2147815403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "Efffffsdfsdfsddffsdffffffffsdfsdfffffffffff" ascii //weight: 10
        $x_10_2 = "FromBase64" ascii //weight: 10
        $x_10_3 = "GetMethod" ascii //weight: 10
        $x_1_4 = "#gfsddfsdffdllsfsfd.dll#" ascii //weight: 1
        $x_1_5 = "#fsdfvsdfdsfdfsdsllvfedsfddgd#" ascii //weight: 1
        $x_1_6 = "#gdsdfsdfsfdseedfsldfdssgdhfdggggggdkksg.dll#" ascii //weight: 1
        $x_1_7 = "#fsdsfvsdfdsfdfsdsllvfedsfddgd#" ascii //weight: 1
        $x_1_8 = "#gffdssdfsfsssedkjdff.dll#" ascii //weight: 1
        $x_1_9 = "#gdsdfdfsdfsfdseedfsldfdssgdhfdggggggdkksg.dll#" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NPP_2147815418_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPP!MTB"
        threat_id = "2147815418"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 07 07 11 07 91 7e ?? ?? ?? 04 11 07 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 9c 11 07 17 d6 13 07 11 07 11 06 31 ca}  //weight: 1, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPQ_2147815419_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPQ!MTB"
        threat_id = "2147815419"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 04 20 00 14 01 00 5d 07 11 04 20 00 14 01 00 5d 91 08 11 04 1f 16 5d 28 f2 00 00 06 61 07 11 04 17 58 20 00 14 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: High
        $x_1_2 = "HTH444FC5FV8WA5A78887E" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENT_2147815458_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENT!MTB"
        threat_id = "2147815458"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c4 d2 c0 d3 af ad 91 04 22 ee 59 a2 43 00 49 89 d6 ed 2f 45 e1 bf fc f0 c0 33 af af cf a5 95 cf 52 42 43 20 49 49 49 2f 2a 45 21 3f 3c d0 c0 53}  //weight: 1, accuracy: High
        $x_1_2 = {5e 42 21 ed 45 b8 c0 61 09 47 39 3f 3c d0 c0 d3 e9 16 72 64 ed 33 bc be 4a 20 49 49 55 2f 90 b4 68 02 9e 25 a3 26 a1 ad cf bb a9 cf 10 41 41 93}  //weight: 1, accuracy: High
        $x_1_3 = {a9 cf 5e 42 43 20 49 49 55 2f 2e 45 21 3f 3c d0 c0 d3 af ad cf bb a9 cf 5e 42 43 20 49 49 55 2f 2e 45 21 3f 3c d0 c0 d3 af ad cf bb a9 cf 5e 42}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENT_2147815458_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENT!MTB"
        threat_id = "2147815458"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Ivakkwpa" wide //weight: 1
        $x_1_2 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 54 72 61 6e 73 66 6f 72 6d 46 69 6e 61 6c 42 6c 6f 63 6b 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 57 65 62 52 65 71 75 65 73 74 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 72 69 70 6c 65 44 45 53 43 72 79 70 74 6f 53 65 72 76 69 63 65 50 72 6f 76 69 64 65 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 53 79 6d 6d 65 74 72 69 63 41 6c 67 6f 72 69 74 68 6d 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPI_2147815486_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPI!MTB"
        threat_id = "2147815486"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {35 00 34 00 35 00 36 00 37 00 31 00 35 00 31 00 4b 22 4b 22 34 00 44 00 4b 22 4b 22 4b 22 4b 22 34 00 35 00 4b 22 4b 22 4b 22 4b 22 32 00 46 00 32 00 46}  //weight: 1, accuracy: High
        $x_1_2 = {34 00 34 00 35 00 37 00 38 00 34 00 35 00 35 00 34 00 35 00 32 00 35 00 31 00 35 00 35 00 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22}  //weight: 1, accuracy: High
        $x_1_3 = {37 00 41 00 4b 22 34 00 33 00 33 00 34 00 4b 22 34 00 44 00 4b 22 4b 22 37 00 35 00 4b 22 34 00 34 00 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22 4b 22}  //weight: 1, accuracy: High
        $x_1_4 = "ToCharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMID_2147815507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMID!MTB"
        threat_id = "2147815507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fsddddsfsfffsfsfsddfdf" ascii //weight: 1
        $x_1_2 = "drdfeffssdddfslosfsdfeg" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "OutputDebugString" ascii //weight: 1
        $x_1_5 = "ToString" ascii //weight: 1
        $x_1_6 = "gddgdlsffsdfsdsfdlsgsdsdfhsg" ascii //weight: 1
        $x_1_7 = "ShortProcdfffhess Started" ascii //weight: 1
        $x_1_8 = "ShortPdddddddjfjfddddddddddddrocess Completed" ascii //weight: 1
        $x_1_9 = "ShortProcdess Started" ascii //weight: 1
        $x_1_10 = "ShortPddddddddddddddddfdddrocess Completed" ascii //weight: 1
        $x_1_11 = "ShortProscdess Started" ascii //weight: 1
        $x_1_12 = "ShorsfsftPdddddddddddddddhfghgddddrocess Completed" ascii //weight: 1
        $x_1_13 = "ShortPdddddddddddddddddddrocess Completed" ascii //weight: 1
        $x_1_14 = "ShorfPdddddddddddddddddddrocess Completed" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMID_2147815507_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMID!MTB"
        threat_id = "2147815507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FromBase64String" ascii //weight: 1
        $x_1_2 = "OutputDebugString" ascii //weight: 1
        $x_1_3 = "drdfeffssdddfslofsdfeg" ascii //weight: 1
        $x_1_4 = "dddfdffdssdfhfg" ascii //weight: 1
        $x_1_5 = "ShortProcdfffhess Started" ascii //weight: 1
        $x_1_6 = "ShortPdddddddjfjfddddddddddddrocess Completed" ascii //weight: 1
        $x_1_7 = "ShortProcdess Started" ascii //weight: 1
        $x_1_8 = "ShortPddddddddddddddddfdddrocess Completed" ascii //weight: 1
        $x_1_9 = "ShortProscdess Started" ascii //weight: 1
        $x_1_10 = "ShorsfsftPdddddddddddddddhfghgddddrocess Completed" ascii //weight: 1
        $x_1_11 = "ShortPdddddddddddddddddddrocess Completed" ascii //weight: 1
        $x_1_12 = "ShorfPdddddddddddddddddddrocess Completed" ascii //weight: 1
        $x_1_13 = "ShortPddskjddddddddddrocess Compfsfleted" ascii //weight: 1
        $x_1_14 = "ShortdsasdsfsdsProcdess Started" ascii //weight: 1
        $x_1_15 = "ShortPddsaddddddddddddddddddrocess Completed" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPR_2147815509_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPR!MTB"
        threat_id = "2147815509"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 07 07 11 07 91 06 11 07 06 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a b4 61 9c 11 07 17 d6 13 07 11 07 11 06 31 d1}  //weight: 1, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPS_2147815510_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPS!MTB"
        threat_id = "2147815510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {b6 00 b6 00 60 00 6c 25 71 00 51 00 88 25 88 25 88 25 88 25 4d 00 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 45 00 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 2f 00 2f 00 38 00 88 25 88 25 88 25 88 25 4c 00 67}  //weight: 1, accuracy: High
        $x_1_2 = {88 25 88 25 88 25 88 25 88 25 43 00 88 25 88 25 88 25 88 25 88 25 88 25 52 00 4b 00 77 00 55 00 6f 00 7a 00 7a 00 68 00 6c 00 55 00 77 00 92 25 2b 00 88 25 88 25 67 00 88 25 88 25 88 25 88 25 92 25 47 00 38 00 57 00 88}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENU_2147815536_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENU!MTB"
        threat_id = "2147815536"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 09 95 28 ?? ?? ?? 0a 13 04 11 04 8e 69 17 da 13 05 16 13 06 2b 13 07 09 1a d8 11 06 d6 11 04 11 06 91 9c 11 06 17 d6 13 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENV_2147815537_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENV!MTB"
        threat_id = "2147815537"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 b4 00 00 5d 07 09 20 00 b4 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 b4 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENW_2147815538_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENW!MTB"
        threat_id = "2147815538"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 61 06 09 91 61 1e 2c d8}  //weight: 1, accuracy: High
        $x_1_2 = {02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENX_2147815539_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENX!MTB"
        threat_id = "2147815539"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c7 db f7 5d 8f be a2 e4 f9 ab e2 bd 4c b8 05 a7 77 ed f3 d5 09 3b c8 52 50 e0 b8 69 45 b2 d5 ab e2 bd 2c b8 57 ff ba 08 32 d7 d6 6e c6 f5 3f db}  //weight: 1, accuracy: High
        $x_1_2 = {1c 11 2e 48 99 d3 b5 d4 f7 ea 86 5b 40 7e 96 b9 93 11 26 79 46 05 fc d5 10 4b 40 b2 da bc f5 5a 55 ec 97 0a 59 2d 3f a6 2f 59 2f e6 8a 35 53 85}  //weight: 1, accuracy: High
        $x_1_3 = {4c b8 f5 da 47 28 2f c6 de 32 36 51 3f d5 d2 4b 45 b2 d5 ab e2 bd 4c b8 f5 da 47 28 2f c6 de 32 36 51 3f d5 d2 4b 45 b2 d5 ab e2 bd 4c b8 f5 da}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPU_2147815559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPU!MTB"
        threat_id = "2147815559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#fsdsffvsdfdsfdfsdsllvfedsfddgd#" ascii //weight: 1
        $x_1_2 = "#gffdsdsdfsfsssedkjdff.dll#" ascii //weight: 1
        $x_1_3 = "#ddsfdfdsfdsfgsdvsd;eodflpll#" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NPV_2147815567_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NPV!MTB"
        threat_id = "2147815567"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "transfer.sh/get/" ascii //weight: 1
        $x_1_2 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resource" ascii //weight: 1
        $x_1_3 = "KJLDKSDHSDKUI.VECTOR" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = ".30319\\aspnet_co" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "TRASH" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ENY_2147815606_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ENY!MTB"
        threat_id = "2147815606"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 b4 00 00 5d 07 09 20 00 b4 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 07 09 17 58 20 00 b4 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOA_2147815607_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOA!MTB"
        threat_id = "2147815607"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$bf2196ab-b309-4277-b5df-557f1683361c" ascii //weight: 1
        $x_1_2 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 52 65 6e 65 77 4f 6e 43 61 6c 6c 54 69 6d 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOC_2147815612_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOC!MTB"
        threat_id = "2147815612"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {ba 00 ea 00 cf 00 ce 00 dd 00 ab 00 b9 00 bc 00 ee 00 cc 00 dd 00 bb 00 df 00 c4 00 c1 00 c6 00 b8 00 c3 00 a6 00 a6 00 a6 00 af 00 c9 00 b9 00 ca 00 ee 00 c1 00 bf 00 ef 00}  //weight: 1, accuracy: High
        $x_1_2 = {a6 00 bc 00 c8 00 ea 00 de 00 d8 00 ee 00 bc 00 b8 00 b8 00 c1 00 c4 00 de 00 ad 00 e0 00 e6 00 b8 00 b8 00 bd 00 e2 00 e9 00 ad 00 c9 00 d0 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOD_2147815676_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOD!MTB"
        threat_id = "2147815676"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 b4 00 00 5d 07 09 20 00 b4 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 6a 07 09 17 58 20 00 b4 00 00 5d 91 ?? ?? ?? ?? ?? 6e 59 20 00 01 00 00 6a 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOE_2147815677_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOE!MTB"
        threat_id = "2147815677"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7d 45 27 1d b6 81 85 c7 01 32 f1 d2 b6 2a 7e 64 4b 79 1b a6 39 65 6d a7 33 0f 2d b9 00 f9 84 11 c7 db f7 5d 8f be a2 e4 f9 ab e2 bd 4c b8 05 a7}  //weight: 1, accuracy: High
        $x_1_2 = {22 b8 81 bd fd 80 21 75 ce 7a 8e a9 b7 d5 c4 f3 23 5a 71 ab f4 87 29 27 02 d8 7d a1 2f e8 86 b3 7e da 3f e1 bd 93 56 b5 e6 60 6b a7 3d 1f 0e 7f}  //weight: 1, accuracy: High
        $x_1_3 = {2f c6 de 32 36 51 3f d5 d2 4b 45 b2 d5 ab e2 bd 4c b8 f5 da 47 28 2f c6 de 32 36 51 3f d5 d2 4b 45 b2 d5 ab e2 bd 4c b8 f5 da 47 28 2f c6 de 32}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQA_2147815725_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQA!MTB"
        threat_id = "2147815725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 00 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 06 08 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 02 0d 06 6f ?? ?? ?? 0a 09 16 09 8e 69 6f ?? ?? ?? 0a 13 04 de 16}  //weight: 1, accuracy: Low
        $x_1_2 = "ToBuffer" ascii //weight: 1
        $x_1_3 = "newNode" ascii //weight: 1
        $x_1_4 = "isEmpty" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQB_2147815726_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQB!MTB"
        threat_id = "2147815726"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 28 ?? ?? ?? 06 07 28 ?? ?? ?? 06 61 d1 9d 07 17 58 0b 07 02 6f ?? ?? ?? 0a 32 e1}  //weight: 1, accuracy: Low
        $x_1_2 = "refactor" ascii //weight: 1
        $x_1_3 = "study.study" ascii //weight: 1
        $x_1_4 = {01 25 16 1f 40 9d 6f}  //weight: 1, accuracy: High
        $x_1_5 = "DownloadData" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "splitter" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQC_2147815727_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQC!MTB"
        threat_id = "2147815727"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0d 09 14 72 ?? ?? ?? 70 16 8d ?? ?? ?? 01 14 14 14 28 ?? ?? ?? 0a 20 00 0c 02 00 8c ?? ?? ?? 01 16 28}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "ToInteger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQD_2147815728_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQD!MTB"
        threat_id = "2147815728"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "190.123.44.138/loader/uploads/" ascii //weight: 1
        $x_1_2 = "-enc UwB0AGEAcgB0AC0AUwBsAGUAZQBwAC" ascii //weight: 1
        $x_1_3 = "powershell" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQE_2147815736_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQE!MTB"
        threat_id = "2147815736"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BoggleServer.Properties.Resources.resources" ascii //weight: 1
        $x_1_2 = "$ea0dad8b-8882-4135-b11b-a829654f734f" ascii //weight: 1
        $x_1_3 = "DebuggerBrowsableState" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerBrowsableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQF_2147815737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQF!MTB"
        threat_id = "2147815737"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "amtechprinting.com" ascii //weight: 1
        $x_1_2 = "Epogagcsgyfbkbmhpzy" ascii //weight: 1
        $x_1_3 = "qwerty_Ftlvqeca" ascii //weight: 1
        $x_1_4 = "Kndgditsvimlmytdhbigzel.Umpepxei" ascii //weight: 1
        $x_1_5 = "Diplbtlbbvxyqfscsv" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQG_2147815738_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQG!MTB"
        threat_id = "2147815738"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "exe.xarc/9089:901.13.9.671//:ptth" wide //weight: 1
        $x_1_2 = "FSA.FSA" ascii //weight: 1
        $x_1_3 = "SASAWDSAFSAFWQFWQ" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SUZ_2147815746_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SUZ!MTB"
        threat_id = "2147815746"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 06 20 00 14 01 00 5d 07 06 20 00 14 01 00 5d 91 08 06 1f 16 5d 6f ?? ?? ?? 0a 61 07 06 17 58 20 00 14 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 06 15 58 0a 06 16 fe 04 16 fe 01 13 05 11 05 2d b9}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CRX_2147815748_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CRX!MTB"
        threat_id = "2147815748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 20 00 0a 01 00 5d 07 09 20 00 0a 01 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 0a 01 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d b7}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "LittleGameBox" wide //weight: 1
        $x_1_6 = "584H548CR8HSGEJS47C44H" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MRA_2147815751_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MRA!MTB"
        threat_id = "2147815751"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 20 00 b4 00 00 5d 07 09 20 00 b4 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 b4 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d b7}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "etlgen" wide //weight: 1
        $x_1_6 = "P7C455RF8EBCYHA8URJ585" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NIN_2147815752_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NIN!MTB"
        threat_id = "2147815752"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {cb 00 cd 00 e8 00 c8 00 b8 00 b8 00 c4 00 b8 00 b8 00 b8 00 b8 00 bc 00}  //weight: 1, accuracy: High
        $x_1_2 = {e5 00 da 00 e4 00 bd 00 eb 00 c0 00 be 00 c5 00 df 00 d9 00 e4 00 ac 00}  //weight: 1, accuracy: High
        $x_1_3 = {c2 00 b8 00 bc 00 b8 00 b8 00 ba 00 ea 00 e4 00 be 00 df 00 c4 00 c3 00 c2 00 ae 00 cc 00 c9 00 b9 00}  //weight: 1, accuracy: High
        $x_1_4 = {cd 00 e2 00 f0 00 ba 00 db 00 bd 00 c8 00 b8 00 b8 00 ce 00 c9 00 c4 00 c5 00}  //weight: 1, accuracy: High
        $x_1_5 = {a6 00 a6 00 af 00 c9 00 b9 00 b8 00 c2 00 c6 00 d8 00 c9 00 db 00 d1 00 a6 00 de 00 c0 00}  //weight: 1, accuracy: High
        $x_1_6 = "FromBase64CharArray" ascii //weight: 1
        $x_1_7 = "I__________________5" ascii //weight: 1
        $x_1_8 = "GetExportedTypes" ascii //weight: 1
        $x_1_9 = "ToCharArray" ascii //weight: 1
        $x_1_10 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KRE_2147815754_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KRE!MTB"
        threat_id = "2147815754"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 20 00 b4 00 00 5d 07 09 20 00 b4 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 6a 07 09 17 58 20 00 b4 00 00 5d 91 28 ?? ?? ?? 0a 6e 59 20 00 01 00 00 6a 58 20 00 01 00 00 6a 5d d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d ae}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = "RiskGame" wide //weight: 1
        $x_1_5 = "P7C455RF8EBCYHA8URJ585" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SRE_2147815755_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SRE!MTB"
        threat_id = "2147815755"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "ocpi.com.my/smoke/loader/uploads/" ascii //weight: 10
        $x_10_2 = "transfer.sh/get/1gg80l/Nxiisn_Vtcxjhlp.bmp" ascii //weight: 10
        $x_10_3 = "inox-smart.com/wp-admin/Nzacczb.png" ascii //weight: 10
        $x_10_4 = "transfer.sh/get/5WzkVr/Zvhiaxpms_Uwfisikb.bmp" ascii //weight: 10
        $x_3_5 = "GetAssemblies" ascii //weight: 3
        $x_3_6 = "ToString" ascii //weight: 3
        $x_2_7 = "InvokeMember" ascii //weight: 2
        $x_2_8 = "GetTypes" ascii //weight: 2
        $x_1_9 = "GetType" ascii //weight: 1
        $x_1_10 = "Invoke" ascii //weight: 1
        $x_1_11 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_3_*) and 2 of ($x_2_*) and 2 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_3_*) and 3 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_3_*) and 1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_3_*) and 2 of ($x_2_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NQI_2147815765_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQI!MTB"
        threat_id = "2147815765"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 32 00 00 5d 07 09 20 00 32 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 09 17 58 20 00 32 00 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5e d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d ad}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXZ_2147815797_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXZ!MTB"
        threat_id = "2147815797"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 06 20 00 b4 00 00 5d 07 06 20 00 b4 00 00 5d 91 09 06 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 06 17 58 20 00 b4 00 00 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 d2 9c}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXZ_2147815797_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXZ!MTB"
        threat_id = "2147815797"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {15 d1 1c 2b b8 62 e5 82 08 b2 26 07 31 b3 c6 ca 29 dd ca 6e a0 df bc 1c 5a c8 23 6b c5 7c 77 b2 db 43 76 74 71 5a 75 bd 3d e9 0c 77 8d 4e 9a 62}  //weight: 1, accuracy: High
        $x_1_2 = {f9 45 7b a2 84 fe 89 3a bd 4c 29 5e 67 b2 70 dd 4f 90 8c a8 9c ab 3b 63 f1 55 96 32 89 ac 29 5a 17 8f ba ce a3 06 f1 18 7e 1f bf 9b 13 d1 2e ed}  //weight: 1, accuracy: High
        $x_1_3 = {db 43 76 74 71 5a 75 bd 3d e9 0c 77 8d 4e 9a 62 94 4d e1 65 85 c2 19 82 b6 a5 ae 2d 46 d3 fc 46 db 43 76 74 71 5a 75 bd 3d e9 0c 77 8d 4e 9a 62}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQJ_2147815825_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQJ!MTB"
        threat_id = "2147815825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 08 11 04 07 11 04 07 8e 69 5d 91 06 11 04 91 61 d2 9c 00 11 04 17 58 13 04 11 04 06 8e 69 fe 04 13 05 11 05 2d d9}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQJ_2147815825_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQJ!MTB"
        threat_id = "2147815825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "18.179.111.240/1b1/loader/uploads/" ascii //weight: 1
        $x_1_2 = "GetResponseStream" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "GetResponse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQK_2147815826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQK!MTB"
        threat_id = "2147815826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "Xlksyuxtcvbqwnb.Bvfcxrciykakvxanxsbftkj" ascii //weight: 10
        $x_10_2 = "Hpranx.Mtlxclkhseirgwne" ascii //weight: 10
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "cdn.discordapp.com/attachments/9" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NQM_2147815830_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQM!MTB"
        threat_id = "2147815830"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$93c33dcf-f5f0-4ac9-afc5-d602860c557f" ascii //weight: 1
        $x_1_2 = "MASTERMIND.Properties.Resources.resource" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "ToUInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOG_2147815851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOG!MTB"
        threat_id = "2147815851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 32 00 00 5d 07 09 20 00 32 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 07 09 17 58 20 00 32 00 00 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOH_2147815852_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOH!MTB"
        threat_id = "2147815852"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4c cb 4f 20 2f 69 5d e7 4b 67 5a 2f cf 42 43 44 c0 38 42 43 c8 df 40 2b 4b 20 2f 59 bd d7 4b e7 1a 8d c3 42 43 46 cc 38 42 43 cd d1 81 34 f1 ab}  //weight: 1, accuracy: High
        $x_1_2 = {cd dd a4 1d 7c 19 40 2d 1e ba 6a 42 6a 38 c9 bd 87 a9 32 73 ec d6 20 03 b3 95 ea d9 e8 2d 7d b8 9b ba b2 38 b0 4b d9 a3 58 57 0f d0 44 60 99 a7}  //weight: 1, accuracy: High
        $x_1_3 = {2f 59 bd d7 4b 47 5a 2d c3 40 47 44 cc 38 42 43 c8 df 4c 2b 4f 20 2f 59 bd d7 4b 47 5a 2d c3 40 47 44 cc 38 42 43 c8 df 4c 2b 4f 20 2f 59 bd d7}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOI_2147815853_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOI!MTB"
        threat_id = "2147815853"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 04 91 07 61 06 09 91 61 13 05 09}  //weight: 1, accuracy: High
        $x_1_2 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOK_2147815854_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOK!MTB"
        threat_id = "2147815854"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 02 8e 69 5d 02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 28 ?? ?? ?? 06 02 07 17 58 02 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQO_2147815888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQO!MTB"
        threat_id = "2147815888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {76 78 75 75 75 78 75 75 75 78 74 74 74 78 73 73 73 72 6e 6e 6e 6b 6b 6b 6b 5f 60 60 60 50 5d 5d 5d 2e 54 54 54 0f 54 54 54 07}  //weight: 1, accuracy: High
        $x_1_2 = "ShortPdddddddddddddddddddrocess" ascii //weight: 1
        $x_1_3 = "drdfefsdddfslofsdfeg" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "fsddddffsddfdf" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQN_2147815889_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQN!MTB"
        threat_id = "2147815889"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$aba82036-e139-40c5-b74e-e2a0aae77f9f" ascii //weight: 1
        $x_1_2 = "Koahoh.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
        $x_1_5 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQR_2147815906_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQR!MTB"
        threat_id = "2147815906"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "transfer.sh/get/RqVezw/" ascii //weight: 1
        $x_1_2 = "/c ping google.com && timeout 10" ascii //weight: 1
        $x_1_3 = "Idiwpctoyyiycrhsdbnj" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "DynamicInvoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIK_2147815927_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIK!MTB"
        threat_id = "2147815927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 07 11 0c 17 6a 58 11 08 6a 5d d4 91 13 0d 11 0d 13 0e 07 11 0c 11 08 6a 5d d4 91 13 0f 08 11 0c 69 1f 16 5d 6f 28 00 00 0a 13 10 11 0f 11 10 61 13 11 11 11 11 0e 59 13 12 11 12 20 00 01 00 00 58 20 ff 00 00 00 5f 13 12 07 11 0c 11 08 6a 5d d4 11 12 28 29 00 00 0a 9c 00 11 0c 17 6a 58 13 0c 11 0c 11 08 17 59 6a fe 02 16 fe 01 13 13 11 13 2d 8c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIK_2147815927_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIK!MTB"
        threat_id = "2147815927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 11 05 6f 3e 00 00 0a 13 06 08 12 06 28 ?? ?? ?? ?? 6f 40 00 00 0a 08 6f 41 00 00 0a 20 00 40 01 00 2f 0d 08 12 06 28 ?? ?? ?? ?? 6f 40 00 00 0a 08 6f 41 00 00 0a 20 00 40 01 00 2f 0d 08 12 06 28 ?? ?? ?? ?? 6f 40 00 00 0a 11 05 17 58 13 05 11 05 07 6f 44 00 00 0a 32 a3}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIK_2147815927_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIK!MTB"
        threat_id = "2147815927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 00 1e 01 00 0d 16 13 06 2b 77 00 16 13 07 2b 5a 00 07 11 06 11 07 6f af 00 00 0a 13 08 08 6f b0 00 00 0a 19 58 09 fe 02 16 fe 01 13 09 11 09 2c 0d}  //weight: 1, accuracy: High
        $x_1_2 = {00 00 2b 25 00 09 08 6f b0 00 00 0a 59 13 0a 11 0a 16 fe 02 13 0b 11 0b 2c 0d 00 08 11 08 11 0a 28 63 00 00 06 00 00 2b 17 00 11 07 17 58 13 07 11 07 07 6f b1 00 00 0a fe 04 13 0c 11 0c 2d 96}  //weight: 1, accuracy: High
        $x_1_3 = "MineSweeper.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIK_2147815927_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIK!MTB"
        threat_id = "2147815927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {1f 16 13 04 20 00 01 00 00 13 05 09 20 00 56 00 00 5d 13 06 07 11 06 91 08 09 11 04 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 13 07 07 09 19 58 18 59 20 00 56 00 00 5d 91 28 ?? ?? ?? 0a 13 08 11 07 11 08 59 6e 11 05 6a 58 13 09 07 11 06 11 09 11 05 6a 5d 1f 19 6a 58 1f 19 6a 59 d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 0a 11 0a}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = "HeavyDuck" wide //weight: 1
        $x_1_5 = "795HC8CJ1QF1BT24HGWH55" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIL_2147815928_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIL!MTB"
        threat_id = "2147815928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {cb 00 cd 00 e8 00 c8 00 b8 00 b8 00 c4 00 b8 00 b8 00 b8 00 b8 00 bc 00 b8 00 b8 00 b8 00 b8 00}  //weight: 1, accuracy: High
        $x_1_2 = {e5 00 da 00 e4 00 bd 00 eb 00 c0 00 be 00 c5 00 df 00 d9 00 e4 00 ac 00}  //weight: 1, accuracy: High
        $x_1_3 = {bc 00 c1 00 c9 00 c8 00 d0 00 b8 00 b8 00 b8 00 b8 00 e8 00 b8 00}  //weight: 1, accuracy: High
        $x_1_4 = {d0 00 c4 00 bf 00 ee 00 e6 00 cb 00 ba 00 f1 00 de 00 e0 00 a6 00 ed 00}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "I______________________2" ascii //weight: 1
        $x_1_7 = "DetectCPU" wide //weight: 1
        $x_1_8 = "ToCharArray" ascii //weight: 1
        $x_1_9 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOL_2147815937_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOL!MTB"
        threat_id = "2147815937"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {dd 00 a6 00 a6 00 a6 00 ee 00 c0 00 ba 00 e1 00 e4 00 e2 00 cf 00 ce 00 d1 00 bc 00 dd 00 da 00 be 00 bc 00 c3 00 bf 00 ee 00 ea 00 cb 00 ba 00}  //weight: 1, accuracy: High
        $x_1_2 = {c9 00 c4 00 c1 00 c6 00 c4 00 a6 00 a2 00 a6 00 a6 00 af 00 c9 00 b9 00 b9 00 db 00 d0 00 bc 00 ee 00 c8 00 c9 00 ba 00 ef 00 b0 00 af 00 e2 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOM_2147815938_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOM!MTB"
        threat_id = "2147815938"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0d 06 20 00 56 00 00 5d 13 04 07 11 04 91 08 06 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 13 06 07 06 19 58 18 59 20 00 56 00 00 5d 91 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EON_2147815939_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EON!MTB"
        threat_id = "2147815939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 91 11 04 61 09 06 91 61 13 05 06}  //weight: 1, accuracy: High
        $x_1_2 = {06 02 08 23 00 00 00 00 00 00 10 40 28 ?? ?? ?? 0a b7 6f ?? ?? ?? 0a 23 00 00 00 00 00 00 70 40 28 ?? ?? ?? 0a b7 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQS_2147815970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQS!MTB"
        threat_id = "2147815970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 16 73 ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 08 09 28 ?? ?? ?? 06 09 16 6a 6f ?? ?? ?? 0a 09 13 04 de 1c}  //weight: 1, accuracy: Low
        $x_1_2 = "costura.costura.dll.compressed" ascii //weight: 1
        $x_10_3 = {57 1f 02 0a 09 0b 00 00 00 fa 01 33 00 16 c4 00 01 00 00 00 44 00 00 00 07 00 00 00 2b 00 00 00 15 00 00 00 11 00 00 00 01 00 00 00 7c 00 00 00 02 00 00 00 14}  //weight: 10, accuracy: High
        $x_10_4 = {57 1f a2 1f 09 0b 00 00 00 fa 01 33 00 16 c4 00 01 00 00 00 79 00 00 00 11 00 00 00 34 00 00 00 77 00 00 00 80 00 00 00 01 00 00 00 aa 00 00 00 0a 00 00 00 67}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AXZ_2147815975_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AXZ!MTB"
        threat_id = "2147815975"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 5f 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4a 00 20 07 8f fb 0e 0b 17 13 04 d0 6b 00 00 01 28 ?? ?? ?? 0a 72 11 cc 00 70 18 1b 8d 17 00 00 01 25 16 72 2b cc 00 70 a2 25 17 20 00 01 00 00 8c 65 00 00 01 a2 25 1a 17 8d 17 00 00 01 25 16 02 a2 a2 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethods" ascii //weight: 1
        $x_1_3 = "I__________________5" ascii //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "ToCharArray" ascii //weight: 1
        $x_1_6 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXZ_2147815976_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXZ!MTB"
        threat_id = "2147815976"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 61 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4c 00 20 07 8f fb 0e 0b 17 13 04 d0 99 00 00 01 28 ?? ?? ?? 0a 14 72 2d bc 00 70 1b 8d 19 00 00 01 25 16 72 47 bc 00 70 a2 25 17 20 00 01 00 00 8c 82 00 00 01 a2 25 1a 17 8d 19 00 00 01 25 16 02 a2 a2 14 14 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "FlappyBird" ascii //weight: 1
        $x_1_3 = "I______________________2" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOF_2147815985_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOF!MTB"
        threat_id = "2147815985"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$53b6a8c4-b2e4-48fd-9975-c97bfa8093e4" ascii //weight: 1
        $x_1_2 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOO_2147815986_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOO!MTB"
        threat_id = "2147815986"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 32 00 00 5d 07 09 20 00 32 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 07 09 17 58 20 00 32 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQL_2147815995_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQL!MTB"
        threat_id = "2147815995"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 09 09 01 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 2c 00 00 00 06 00 00 00 05 00 00 00 0f 00 00 00 03 00 00 00 32 00 00 00 16 00 00 00 08 00 00 00 02 00 00 00 03 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_2 = "iscordapp.com/attachments/9" wide //weight: 1
        $x_1_3 = "Cnstructor" ascii //weight: 1
        $x_1_4 = "Virtualization" ascii //weight: 1
        $x_1_5 = "IsNullOrWhiteSpace" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOS_2147816050_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOS!MTB"
        threat_id = "2147816050"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 09 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 03 09 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a da 13 04 07 11 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 09 17 d6 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "wwwwwwwww" wide //weight: 1
        $x_1_3 = "ToCharArray" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAT_2147816058_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAT!MTB"
        threat_id = "2147816058"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 61 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4c 00 20 07 8f fb 0e 0b 17 13 04 d0 71 00 00 01 28 ?? ?? ?? 0a 14 72 50 1b 00 70 1b 8d 19 00 00 01 25 16 72 a7 cb 00 70 a2 25 17 20 00 01 00 00 8c 6d 00 00 01 a2 25 1a 17 8d 19 00 00 01 25 16 02 a2 a2 14 14 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "Born_Wind" ascii //weight: 1
        $x_1_3 = "I______________________2" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LAT_2147816059_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LAT!MTB"
        threat_id = "2147816059"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 61 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4c 00 20 07 8f fb 0e 0b 17 13 04 d0 71 00 00 01 28 ?? ?? ?? 0a 14 72 52 1b 00 70 1b 8d 19 00 00 01 25 16 72 a9 cb 00 70 a2 25 17 20 00 01 00 00 8c 6d 00 00 01 a2 25 1a 17 8d 19 00 00 01 25 16 02 a2 a2 14 14 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "Born_Wind" ascii //weight: 1
        $x_1_3 = "I______________________2" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAT_2147816060_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAT!MTB"
        threat_id = "2147816060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 16 13 05 16 13 06 2b 31 00 11 05 09 5d 13 0a 11 05 09 5b 13 0b 08 11 0a 11 0b 6f ?? 00 00 0a 13 0c 07 11 06 12 0c 28 ?? 00 00 0a 9c 11 06 17 58 13 06 11 05 17 58 13 05 00 11 05 09 11 04 5a fe 04 13 0d 11 0d 2d c1}  //weight: 5, accuracy: Low
        $x_5_2 = {13 04 16 13 05 16 13 06 2b 31 00 11 05 09 5d 13 08 11 05 09 5b 13 09 08 11 08 11 09 6f ?? 00 00 0a 13 0a 07 11 06 12 0a 28 ?? 00 00 0a 9c 11 06 17 58 13 06 11 05 17 58 13 05 00 11 05 09 11 04 5a fe 04 13 0b 11 0b 2d c1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAT_2147816060_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAT!MTB"
        threat_id = "2147816060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 61 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4c 00 20 07 8f fb 0e 0b 17 13 04 d0 99 00 00 01 28 ?? ?? ?? 0a 14 72 27 bc 00 70 1b 8d 19 00 00 01 25 16 72 41 bc 00 70 a2 25 17 20 00 01 00 00 8c 82 00 00 01 a2 25 1a 17 8d 19 00 00 01 25 16 02 a2 a2 14 14 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "FlappyBird" ascii //weight: 1
        $x_1_3 = "I______________________2" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
        $x_1_5 = "Invoke" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQT_2147816084_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQT!MTB"
        threat_id = "2147816084"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 08 20 00 60 00 00 5d 06 08 20 00 60 00 00 5d 91 07 08 1f 16 5d 6f ?? ?? ?? 0a 61 06 08 17 58 20 00 60 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 08 15 58 0c 08 16 2f c2}  //weight: 1, accuracy: Low
        $x_1_2 = "System.Reflection.Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQV_2147816085_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQV!MTB"
        threat_id = "2147816085"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 07 09 20 00 32 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 32 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 09 15 58}  //weight: 1, accuracy: Low
        $x_1_2 = "WASWDDDDDDDDDDDDDDDDDDDDDDDDDDDD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOJ_2147816160_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOJ!MTB"
        threat_id = "2147816160"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$b25c3285-3758-4ba6-a04f-6d899730b8b8" ascii //weight: 1
        $x_1_2 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOP_2147816161_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOP!MTB"
        threat_id = "2147816161"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 07 09 e0 58 0b 07 1f 10 58 4b 07 1f 14 58 4b 13 04 07 09 e0 59 0b 8d ?? ?? ?? 01 0a 07 11 04 e0 58 0b 06 16 8f ?? ?? ?? 01}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOU_2147816181_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOU!MTB"
        threat_id = "2147816181"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 11 03 20 00 60 00 00 5d 11 01 11 03 20 00 60 00 00 5d 91 11 02 11 03 1f 16 5d ?? ?? ?? ?? ?? 61 11 01 11 03 17 58 20 00 60 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOU_2147816181_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOU!MTB"
        threat_id = "2147816181"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 7e ?? ?? ?? 04 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 06 03 08 18 58 17 59 03 8e 69 5d 91 59 20 fa 00 00 00 58 1b 58 17 58 20 00 01 00 00 5d d2 9c 08 17 58 0c}  //weight: 1, accuracy: Low
        $x_1_2 = "sssssrrrrrrrrrsdas.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQQ_2147816200_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQQ!MTB"
        threat_id = "2147816200"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0b 11 0c 58 09 11 0c 58 47 52 00 11 0c 17 58 13 0c 11 0c 07 8e 69 fe 04 13 0d 11 0d 2d e0}  //weight: 1, accuracy: High
        $x_1_2 = {1f 53 00 79 00 73 00 74 00 65 00 6d 00 20 00 54 00 72 00 61 00 79 00 20 00 41 00 70 00 70 00 00 09 45 00 78 00 69 00 74}  //weight: 1, accuracy: High
        $x_1_3 = "BareAmsMetaliScBareanBuMetalffer" ascii //weight: 1
        $x_1_4 = "BareamMetalsi.Baredll" ascii //weight: 1
        $x_1_5 = "GetBareTypeMetal" ascii //weight: 1
        $x_1_6 = "BareAsseMetalmbly" ascii //weight: 1
        $x_1_7 = "MetalLoBaread" ascii //weight: 1
        $x_1_8 = "MetalEntryBarePoint" ascii //weight: 1
        $x_1_9 = "MetalInBarevoke" ascii //weight: 1
        $x_1_10 = "PRIYATNO" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQU_2147816201_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQU!MTB"
        threat_id = "2147816201"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Evercraft_model.Character" ascii //weight: 1
        $x_1_2 = "Sys32_24344" ascii //weight: 1
        $x_1_3 = "Sys32_24384" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = {4c 00 6f 00 61 00 64}  //weight: 1, accuracy: High
        $x_1_6 = "GetType" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOV_2147816206_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOV!MTB"
        threat_id = "2147816206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 0b 11 08 11 0b e0 58 13 08 11 08 1f 10 58 4b 13 0c 11 08 1f 14 58 4b 13 0d 11 08 11 0b e0 59 13 08 11 0c}  //weight: 1, accuracy: High
        $x_1_2 = {06 07 02 07 91 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d2 9c 00 07 17 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOV_2147816206_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOV!MTB"
        threat_id = "2147816206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 60 00 00 5d 07 09 20 00 60 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 07 09 17 58 20 00 60 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
        $x_1_2 = {07 09 20 00 36 00 00 5d 07 09 20 00 36 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 07 09 17 58 20 00 36 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 09 15 58 0d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRA_2147816231_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRA!MTB"
        threat_id = "2147816231"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 60 00 00 5d 07 09 20 00 60 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 60 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d b7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRA_2147816231_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRA!MTB"
        threat_id = "2147816231"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {d0 00 b8 00 b8 00 b8 00 e2 00 b9 00 a7 00 b8 00 b8 00 b8 00 b8 00 ea 00 b8 00 b8 00 b8 00 b8 00 ee 00 ba 00 b8 00 b8 00 b8 00 b8 00 e0 00}  //weight: 1, accuracy: High
        $x_1_2 = {b8 00 ee 00 be 00 b8 00 e7 00 b9 00 de 00 c9 00 b8 00 c0 00 bf 00 b8 00 df 00 b9 00 de 00 cd 00 b8 00 bc 00 b8 00 b8 00 b8 00 b8 00 b8 00 c9 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00}  //weight: 1, accuracy: High
        $x_1_3 = {d9 00 c0 00 c5 00 e5 00 b8 00 eb 00 b8 00 ab 00 de 00 ec 00 dd 00 ab 00 b8 00 b8 00 b8 00 b8 00 b8 00 de 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00 b8 00}  //weight: 1, accuracy: High
        $x_1_4 = "GZipStream" ascii //weight: 1
        $x_1_5 = "wwwwwwwww" wide //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRB_2147816237_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRB!MTB"
        threat_id = "2147816237"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 60 00 00 5d 91 08 09 1f 16 5d 28 ?? ?? ?? 06 61 07 09 17 58 20 00 60 00 00 5d 91 59 20 00 01 00 00 58}  //weight: 1, accuracy: Low
        $x_1_2 = "Q___________________" ascii //weight: 1
        $x_1_3 = "WASWDDDDDDDDDDDDDDDDDDDDDDDDDDDD" ascii //weight: 1
        $x_1_4 = "WRECCCCCCCCCCCCCCCCCCCCCCC" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMI_2147816266_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMI!MTB"
        threat_id = "2147816266"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\Users\\Administrator\\Desktop\\New folder\\bin\\Debug\\SLN\\Diary\\obj\\Debug\\Diary.pdb" ascii //weight: 1
        $x_1_2 = "Library Management App" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOW_2147816273_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOW!MTB"
        threat_id = "2147816273"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 59 55 2b 39 bd 30 42 34 37 dc ad c4 34 b7 c7 29 c4 9c df be bf 54 59 55 2b b9 bd b0 42 ca ea b6 2c 86 66 d0 a4 c1 61 5c 0d f0 14 2f f0 50 8e}  //weight: 1, accuracy: High
        $x_1_2 = {a3 f7 29 c4 16 27 9a b8 50 82 c3 7d 23 bd 30 42 35 cb 59 a9 80 a6 97 cb 14 86 f9 df be bf 57 47 16 b4 3d b1 8c 4f 9b 35 e5 ad c4 34 aa c1 ea 4b}  //weight: 1, accuracy: High
        $x_1_3 = {39 bd 30 42 34 37 dc ad c4 34 b7 c7 29 c4 9c df be bf 54 59 55 2b 39 bd 30 42 34 37 dc ad c4 34 b7 c7 29 c4 9c df be bf 54 59 55 2b 39 bd 30 42}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOX_2147816274_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOX!MTB"
        threat_id = "2147816274"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 09 17 da 6f ?? ?? ?? 0a 03 09 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a da 13 04 07 11 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 09 17 d6 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "wwwwwwwww" wide //weight: 1
        $x_1_3 = "ToCharArray" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOY_2147816275_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOY!MTB"
        threat_id = "2147816275"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {d0 00 cb 00 d0 00 e4 00 c1 00 a9 00 c5 00 df 00 bd 00 cb 00 c4 00 a9 00 e2 00 bb 00 c4 00 eb 00 e2 00 f1 00 c5 00 a8 00 e2 00 cb 00 c3 00 ee 00 d0 00 f1}  //weight: 1, accuracy: High
        $x_1_2 = {ee 00 da 00 e3 00 e3 00 a9 00 d1 00 ed 00 ef 00 a9 00 d9 00 ec 00 df 00 a9 00 d0 00 e3 00 c9 00 bd 00 c0 00 a8 00 d1 00 ce 00 d8 00 ec 00 cd 00 e5 00 c8}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EOZ_2147816276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EOZ!MTB"
        threat_id = "2147816276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {64 29 f5 8b 24 bd 3c 85 fa 1b 91 e1 d1 0c c2 4a f1 48 48 fb 8c 47 42 3d 0e 5b 00 2f 23 8b 94 1a 6f 77 08 b2 32 43 d1 4c a2 cb 5d 0f 47 89 c3 94}  //weight: 1, accuracy: High
        $x_1_2 = {06 ee d1 bb 9f cb 4f bf dc a9 7b 8a dc 34 98 49 75 a1 9f b2 db 48 04 a5 0c b2 41 df 0b ed 8d 97 4e 37 25 d6 2d 44 71 46 15 40 31 4b a1 39 6b b9}  //weight: 1, accuracy: High
        $x_1_3 = {55 4a 4a 45 c7 49 34 4b 5a 3c 27 b8 48 de b3 5d c5 aa c8 2a ba d7 55 4a 4a 45 c7 49 34 4b 5a 3c 27 b8 48 de b3 5d c5 aa c8 2a ba d7 55 4a 4a 45}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPA_2147816277_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPA!MTB"
        threat_id = "2147816277"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 04 91 07 61 06 09 91 61 13 05 08 11 04 11 05 d2 9c 09 03}  //weight: 1, accuracy: High
        $x_1_2 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 00 08 18 d6 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRE_2147816339_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRE!MTB"
        threat_id = "2147816339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 07 17 58 13 07 11 07 11 06 8e 69 fe 04 13 08 11}  //weight: 5, accuracy: High
        $x_1_2 = "Xider" ascii //weight: 1
        $x_1_3 = "Ultraviolet" ascii //weight: 1
        $x_1_4 = "Recolar" ascii //weight: 1
        $x_1_5 = "CyberXide" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRE_2147816339_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRE!MTB"
        threat_id = "2147816339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$68009357-AAFE-4F5D-8417-CF925415E0D2" ascii //weight: 1
        $x_1_2 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_3 = "Beatems.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "Club Wholesale" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAL_2147816348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAL!MTB"
        threat_id = "2147816348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 0b 16 0a 2b 3b 16 0a 2b 1b 08 07 06 6f ?? 00 00 0a 13 09 09 12 09 28 ?? 00 00 0a 6f ?? 00 00 0a 06 17 58 0a 06 08 6f ?? 00 00 0a 13 07 12 07 28 ?? 00 00 0a fe 04 13 06 11 06 2d cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAL_2147816348_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAL!MTB"
        threat_id = "2147816348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {d0 3f 00 00 01 28 33 00 00 0a 14 72 01 03 00 70 1b 8d 19 00 00 01 25 16 72 1b 03 00 70 7e 48 00 00 0a 72 21 03 00 70 28 ?? ?? ?? 0a a2 25 17 20 00 01 00 00 8c 55 00 00 01 a2 25 1a 17 8d 19 00 00 01 25 16 02 a2 a2 14 14 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAL_2147816348_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAL!MTB"
        threat_id = "2147816348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {13 04 16 13 05 16 13 0d 2b 31 00 11 0d 09 5d 13 0e 11 0d 09 5b 13 0f 08 11 0e 11 0f 6f ?? 00 00 0a 13 10 07 11 05 12 10 28 ?? 00 00 0a 9c 11 05 17 58 13 05 00 11 0d 17 58 13 0d 11 0d 09 11 04 5a fe 04 13 11 11 11 2d c1}  //weight: 3, accuracy: Low
        $x_2_2 = "Pizza_Project.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAJ_2147816349_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAJ!MTB"
        threat_id = "2147816349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 24 00 00 0a 0a 73 25 00 00 0a 0c 06 08 28 ?? ?? ?? 0a 72 5d 00 00 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 13 04 02 0d 11 04 09 16 09 8e b7 6f ?? ?? ?? 0a 0b de 11 de 0f 25 28 ?? ?? ?? 0a 13 05 28 ?? ?? ?? 0a de 00 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAJ_2147816349_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAJ!MTB"
        threat_id = "2147816349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "~D0~E2~56~46~F6~D6~02~35~F4~44~02~E6~96~02~" wide //weight: 2
        $x_2_2 = "E6~57~27~02~56~26~02~47~F6~E6~E6~16~36~02~D6~16" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAB_2147816350_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAB!MTB"
        threat_id = "2147816350"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {2b 36 2b 37 de 3e 0a 2b de 0b 2b e7 28 ?? 00 00 0a 2b ed 28 ?? 00 00 06 2b c9 28 ?? 00 00 0a 2b c8 06 2b c7 6f ?? 00 00 0a 2b c2 28 ?? 00 00 0a 2b bd 07 2b c0 07 2b c0 07 2b c7 0c 2b c6}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAB_2147816350_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAB!MTB"
        threat_id = "2147816350"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Fluence.Fluence" wide //weight: 1
        $x_1_2 = "Fluences" wide //weight: 1
        $x_1_3 = "BIGBOSS" wide //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "Invoke" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
        $x_1_8 = "ToArray" ascii //weight: 1
        $x_1_9 = "RijndaelManaged" ascii //weight: 1
        $x_1_10 = "GetBytes" ascii //weight: 1
        $x_1_11 = "Reverse" ascii //weight: 1
        $x_1_12 = "DownloadData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPC_2147816384_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPC!MTB"
        threat_id = "2147816384"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 11 06 20 00 5c 00 00 5d 11 01 11 06 20 00 5c 00 00 5d 91 11 02 11 06 1f 16 5d ?? ?? ?? ?? ?? 61 11 01 11 06 17 58 20 00 5c 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPE_2147816385_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPE!MTB"
        threat_id = "2147816385"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {6a 2e 35 a3 a8 83 e6 d5 88 b9 6b 20 a2 17 31 41 59 8a 95 1e bc d2 b2 ca e1 f7 13 b7 09 ef 3d 92 2d df f5 70 f8 65 b6 45 71 27 57 ca 97 c9 d3 0d}  //weight: 1, accuracy: High
        $x_1_2 = {db d0 5d b4 30 79 b6 48 6d 21 5c 3b a8 26 11 a6 4d 77 72 65 46 b3 cb 2e 43 81 d5 5e 86 4a 1a 1a 65 ca 84 28 6e 5f 4b 24 55 63 4d 46 21 25 a3 fb}  //weight: 1, accuracy: High
        $x_1_3 = {b5 bb 2a 25 4f b4 27 5e b7 b7 5d 27 57 ca 97 c9 23 a6 a5 22 5c 5e b5 bb 2a 25 4f b4 27 5e b7 b7 5d 27 57 ca 97 c9 23 a6 a5 22 5c 5e b5 bb 2a 25}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPF_2147816386_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPF!MTB"
        threat_id = "2147816386"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 91 11 04 61 09 06 91 61 13 05 08 07 11 05 d2 9c 06 03}  //weight: 1, accuracy: High
        $x_1_2 = {06 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 08 18 d6 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPG_2147816387_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPG!MTB"
        threat_id = "2147816387"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {97 64 71 96 c1 f9 70 1c 18 b8 6c a8 ba 47 ca 70 b4 e2 34 95 8b a4 c7 a3 e6 8d d3 22 15 59 4f 45 da 4b be fe c2 55 49 2c 34 70 8d e9 e2 58 7c fe}  //weight: 1, accuracy: High
        $x_1_2 = {83 85 fa 6f de 82 a3 4a 72 55 bc ed e2 12 3a bb c9 14 81 fe b8 d1 cf 0a 7f eb c7 fb c6 84 b8 3f 00 e5 1c 1f 94 47 f6 57 5e e7 7c ea c7 3e c1 f3}  //weight: 1, accuracy: High
        $x_1_3 = {3a cf 24 ba e7 9c 74 50 4e e1 f9 fc d7 ee 63 05 6e 00 7f ca 99 fb 1e 51 b5 92 ed e2 87 1d 41 ac d0 90 26 a2 3c 37 73 68 ae e6 f0 85 73 19 1a 23}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPH_2147816388_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPH!MTB"
        threat_id = "2147816388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {ed 75 79 e7 93 88 90 fd 10 e4 5f a2 b0 d9 46 e2 a5 9d ca ce 52 62 e6 a4 d7 24 9d 2e 07 38 d3 18 66 eb 72 4e 34 9d ca e8 dc 2b 05 8e d7 23 bd 84}  //weight: 1, accuracy: High
        $x_1_2 = {7f f1 5d d4 76 3c 1d 01 dc 25 76 85 ed 2c fa e6 39 62 19 fa de 77 33 3f 7a 14 f5 a3 69 a8 54 36 fe 66 82 59 ec fe 55 be 9f 78 ac 78 dd bf 0f 2e}  //weight: 1, accuracy: High
        $x_1_3 = {45 81 09 fa b5 5c a5 e4 26 1d 6c bd 00 80 83 a6 c2 49 69 42 9c 9b 2f 50 cf 7b 5d f0 fc 37 8c 31 73 59 a8 e5 9f 0d 36 65 24 75 65 d8 81 ed b6 dd}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRG_2147816411_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRG!MTB"
        threat_id = "2147816411"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Bovlbhaxjdt" ascii //weight: 1
        $x_1_2 = "GetTypes" ascii //weight: 1
        $x_1_3 = "Kdplppvugyosmbtlxjclzra.Mzjlaieiosvosnhbmf" ascii //weight: 1
        $x_1_4 = "cdn.discordapp.com" ascii //weight: 1
        $x_1_5 = "54690241_Xyrgockt.bmp" ascii //weight: 1
        $x_1_6 = "71eea5b5-1196" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPJ_2147816456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPJ!MTB"
        threat_id = "2147816456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 5c 00 00 5d 07 09 20 00 5c 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 07 09 17 58 20 00 5c 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
        $x_1_2 = {11 01 11 03 20 00 36 00 00 5d 11 01 11 03 20 00 36 00 00 5d 91 11 02 11 03 1f 16 5d ?? ?? ?? ?? ?? 61 11 01 11 03 17 58 20 00 36 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPK_2147816457_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPK!MTB"
        threat_id = "2147816457"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "O56WH85Z76H5HG5F8478H5" wide //weight: 1
        $x_1_2 = "Sketch" wide //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRD_2147816523_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRD!MTB"
        threat_id = "2147816523"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {68 00 74 00 74 00 70 [0-152] 00 74 00 72 00 61 00 6e 00 73 00 66 00 65 00 72 00 2e 00 73 00 68 00 2f 00 67 00 65 00 74 00 2f 00 [0-48] 2e 00 74 00 78 00 74}  //weight: 1, accuracy: Low
        $x_1_2 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = ".30319\\aspnet_co" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "ResolveType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRH_2147816524_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRH!MTB"
        threat_id = "2147816524"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 17 da 6f ?? ?? ?? 0a 08 11 05 08 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a da 13 06 09 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0d 11 05 17 d6 13 05 11 05 11 04 31 c5}  //weight: 1, accuracy: Low
        $x_1_2 = "wwwwwwwww" wide //weight: 1
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRI_2147816525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRI!MTB"
        threat_id = "2147816525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$71d2d588-0a54-403e-be25-814b84cceb22" ascii //weight: 1
        $x_1_2 = "LILITHAGUESTHOUSE.Resources.resources" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPB_2147816526_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPB!MTB"
        threat_id = "2147816526"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$a29093f9-0b5c-45cd-83a7-bd632075de50" ascii //weight: 1
        $x_1_2 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPM_2147816527_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPM!MTB"
        threat_id = "2147816527"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 36 00 00 5d 07 09 20 00 36 00 00 5d 91 08 09 1f 16 5d [0-5] 61 07 09 17 58 20 00 36 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPN_2147816528_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPN!MTB"
        threat_id = "2147816528"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "E5Z845S5AHDAE5HGGO4H51" wide //weight: 1
        $x_1_2 = "Carnila" wide //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPO_2147816529_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPO!MTB"
        threat_id = "2147816529"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 91 03 07 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d2 9c 00 07 17 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "@@@@@@@@L@@@@@@@@@@@@@@o@@@@@@@@@@@@@a@@@@@@@@@d@@@@@@@" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRJ_2147816568_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRJ!MTB"
        threat_id = "2147816568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e7eba332-745e-4139-995f-ca15666ec1a3" ascii //weight: 1
        $x_1_2 = "DailyNotes.Resources.resources" ascii //weight: 1
        $x_1_3 = "System.Convert" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRL_2147816569_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRL!MTB"
        threat_id = "2147816569"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 11 09 6f ?? ?? ?? 0a 13 0a 11 0a 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 0b 11 0b 2c 2c 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 00 11 09}  //weight: 1, accuracy: Low
        $x_1_2 = "$298EF135-71DD-4056-A3F0-7811156D4DD3" ascii //weight: 1
        $x_1_3 = "Oral Pathologist" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SW_2147816600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SW!MTB"
        threat_id = "2147816600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 20 00 01 00 00 13 07 11 06 17 58 13 08 11 06 20 00 cc 00 00 5d 13 09 11 08 20 00 cc 00 00 5d 13 0a 07 11 09 91 13 0b 1f 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SW_2147816600_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SW!MTB"
        threat_id = "2147816600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 5c 00 00 5d 07 09 20 00 5c 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 5c 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d b3}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "Lucidity.WinForms" wide //weight: 1
        $x_1_6 = "7K8G8EH54N5578UZ29Z754" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LW_2147816601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LW!MTB"
        threat_id = "2147816601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 24 00 00 0a 0a 73 25 00 00 0a 0c 06 08 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 13 04 02 0d 11 04 09 16 09 8e b7 6f ?? ?? ?? 0a 0b de 11 de 0f 25 28 ?? ?? ?? 0a 13 05 28 ?? ?? ?? 0a de 00 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LR_2147816603_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LR!MTB"
        threat_id = "2147816603"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 20 00 36 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 07 09 17 58 20 00 36 00 00 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d b3}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "STDSPackageBrowser" wide //weight: 1
        $x_1_6 = "E5Z845S5AHDAE5HGGO4H51" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UR_2147816604_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UR!MTB"
        threat_id = "2147816604"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "transfer.sh/get/YgWclY/efax-07042022_Vhzlhxid.png" wide //weight: 10
        $x_10_2 = "trieutin.com/loader/uploads/NEW_ORDER_8086A_461A_Evfwdepn.jpg" wide //weight: 10
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "DynamicInvoke" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "ToString" ascii //weight: 1
        $x_1_7 = "GetResponseStream" ascii //weight: 1
        $x_1_8 = "WebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 6 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AMID35_2147816609_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMID35!MTB"
        threat_id = "2147816609"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {50 41 73 50 00 00 0a 28 51 00 00 0a 00 02 17 28 52 00 00 0a 00 02 20 70 02 00 00 20 ba 01 00 00 73 53 00 00 0a 28 54 00 00 0a 00 02 06 72}  //weight: 1, accuracy: High
        $x_5_2 = {01 00 70 6f 55 00 00 0a 74 4f 00 00 01 28 56 00 00 0a 00 02 72 e7 01 00 70 28 57 00 00 0a 00 02 17 28 58 00 00 0a 00 02 72 f9 01 00 70 6f 59}  //weight: 5, accuracy: High
        $x_1_3 = {70 72 8f 00 00 70 15 15 28 40 00 00 0a 28 41 00 00 0a 0b 72 91 00 00 70 72 8f 00 00 70 72 8f 00 00 70 15 15 28 40 00 00 0a 28 41 00 00 0a 0c 72}  //weight: 1, accuracy: High
        $x_1_4 = {df 00 00 70 72 8f 00 00 70 72 8f 00 00 70 15 15 28 40 00 00 0a 28 41 00 00 0a 0d 72 2d 01 00 70 72 8f 00 00 70 72 8f 00 00 70 15 15 28 40 00 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 06 72 27 00 00 70 7e 07 00 00 04 6f 34 00 00 0a 28 35 00 00 0a 0b 07 74 26 00 00 01 0a 2b 00 06 2a 92 73 10 00 00 06 28 36 00 00 0a 74 06 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EPI_2147816612_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPI!MTB"
        threat_id = "2147816612"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {62 00 cc 06 59 00 46 06 86 06}  //weight: 1, accuracy: High
        $x_1_2 = "get_Helper_Classes" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "Hasenda" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "TransformFinalBlock" ascii //weight: 1
        $x_1_8 = "ComputeHash" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPL_2147816613_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPL!MTB"
        threat_id = "2147816613"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 02 07 91 6f ?? ?? ?? 0a 00 00 07 25 17 59 0b 16 fe 02 0c 08 2d e8}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 0e 00 07 11 05 16 11 06 6f ?? ?? ?? 0a 00 00 09 11 05 16 11 04 6f ?? ?? ?? 0a 25 13 06 16 fe 03 13 08 11 08 2d db}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPQ_2147816614_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPQ!MTB"
        threat_id = "2147816614"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "wZQ==GwZQ==ewZQ==twZQ==TwZQ==ywZQ==pwZQ==e/AssewZQ==mwZQ==bwZQ==lwZQ==y/LowZQ==ad/EntrywZQ==Point/wZQ==InvwZQ==oke" wide //weight: 1
        $x_1_2 = "@XAREAms@xetaliSc@XAREanBu@xetalffer" wide //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "StartsWith" ascii //weight: 1
        $x_1_5 = "ResolveMethod" ascii //weight: 1
        $x_1_6 = "get_MKortz" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPR_2147816615_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPR!MTB"
        threat_id = "2147816615"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 36 00 00 5d 07 09 20 00 36 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 07 09 17 58 20 00 36 00 00 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPS_2147816616_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPS!MTB"
        threat_id = "2147816616"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "12DY45FF54SEY8QKYGBA5R" wide //weight: 1
        $x_1_2 = "Envoi" wide //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPT_2147816617_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPT!MTB"
        threat_id = "2147816617"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1f 10 0d 06 02 08 18 6f ?? ?? ?? 0a 09 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 00 08 18 d6 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {02 11 04 91 07 61 06 09 91 61 13 05 08 11 04 11 05 d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRK_2147816635_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRK!MTB"
        threat_id = "2147816635"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 aa 02 00 8c ?? 00 00 01 16 28 7d 00 00 0a 13 05 ?? 13 0b 2b 93 11 05 2c 05 ?? 13 0b 2b 8a}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_3 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_4 = "GetObjectValue" ascii //weight: 1
        $x_1_5 = "ToInteger" ascii //weight: 1
        $x_1_6 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRM_2147816645_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRM!MTB"
        threat_id = "2147816645"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "08b25c62-408a-4de4-8ec6-7419e083ed93" ascii //weight: 1
        $x_1_2 = "vbStripe.Resources.resources" ascii //weight: 1
        $x_1_3 = "ToBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRN_2147816658_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRN!MTB"
        threat_id = "2147816658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 06 6f 29 00 00 0a 09 16 09 8e 69 6f ?? ?? ?? 0a 13 04}  //weight: 5, accuracy: Low
        $x_1_2 = "://185.246.220.65/pee/Ijzqjd.jpeg" wide //weight: 1
        $x_1_3 = "PO11795400" wide //weight: 1
        $x_1_4 = "Mnwenvozbboih" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRN_2147816658_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRN!MTB"
        threat_id = "2147816658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 ff b6 3f 09 0f 00 00 00 fa 00 33 00 06 00 00 01 00 00 00 cd 00 00 00 14 01 00 00 09 03 00 00 6b 03 00 00 31 02 00 00 02 00 00 00 e9 01 00 00 51 00 00 00 29 00 00 00 01 00 00 00 01 00 00 00 0b}  //weight: 1, accuracy: High
        $x_1_2 = "sssssrrrrrrrrrddsdas.exe" ascii //weight: 1
        $x_1_3 = "http://gffggfffffrograms/" wide //weight: 1
        $x_1_4 = "C:\\somedirectory" ascii //weight: 1
        $x_1_5 = "Reporting.asmx" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRO_2147816670_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRO!MTB"
        threat_id = "2147816670"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 1f 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 05 01 00 00 17 00 00 00 03 02 00 00 08 0e 00 00 6e 04 00 00 05 03 00 00 e2 09 00 00 bf 00 00 00 13}  //weight: 1, accuracy: High
        $x_1_2 = "900-4128-44c0-994" ascii //weight: 1
        $x_1_3 = "RecopierBox.Resources.resource" ascii //weight: 1
        $x_1_4 = "DebuggerStepThroughAttribute" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMJ_2147816697_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMJ!MTB"
        threat_id = "2147816697"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\Users\\Administrator\\Desktop\\New folder\\bin\\Debug\\SLN\\hastane\\obj\\Debug\\hastane.pdb" ascii //weight: 1
        $x_1_2 = "C:\\Users\\Administrator\\Desktop\\New folder\\bin\\Debug\\SLN\\BillingSystemm\\obj\\Debug\\BillingSystemm.pdb" ascii //weight: 1
        $x_1_3 = "BillingSystemm.exe" ascii //weight: 1
        $x_1_4 = "hastane.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPX_2147816714_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPX!MTB"
        threat_id = "2147816714"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 17 da 6f ?? ?? ?? 0a 07 11 04 07 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a da 13 05 08 11 05 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c 11 04 17 d6 13 04}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRQ_2147816715_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRQ!MTB"
        threat_id = "2147816715"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 88 00 00 5d 07 09 20 00 88 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 06 07 09 17 58 20 00 88 00 00 5d 91 28 ?? ?? ?? 06 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 06 9c 00 09 15 58 0d 09}  //weight: 1, accuracy: Low
        $x_1_2 = "3c94-44e6-adf3-" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPU_2147816766_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPU!MTB"
        threat_id = "2147816766"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$E3868EFA-816C-42CA-851C-3A807A1B547F" ascii //weight: 1
        $x_1_2 = {00 54 6f 55 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 75 62 73 74 72 69 6e 67 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EPV_2147816767_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EPV!MTB"
        threat_id = "2147816767"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 08 91 6f ?? ?? ?? 0a 00 00 08 25 17 59 0c 16 fe 02 0d 09 2d e8}  //weight: 1, accuracy: Low
        $x_1_2 = {07 11 05 16 11 06 6f ?? ?? ?? 0a 00 00 09 11 05 16 11 04 6f ?? ?? ?? 0a 25 13 06 16 fe 03 13 07 11 07 2d db}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQB_2147816770_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQB!MTB"
        threat_id = "2147816770"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 20 00 84 00 00 5d 07 09 20 00 84 00 00 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 07 09 17 58 20 00 84 00 00 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQC_2147816771_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQC!MTB"
        threat_id = "2147816771"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "3V52HTB4H5Q5NFB49G58C5" wide //weight: 1
        $x_1_2 = "Spectra2" wide //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPB_2147816772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPB!MTB"
        threat_id = "2147816772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "45.137.22.163" wide //weight: 10
        $x_10_2 = "185.222.57.199" wide //weight: 10
        $x_3_3 = "Sandboxie Start" ascii //weight: 3
        $x_1_4 = "HttpWebRequest" ascii //weight: 1
        $x_1_5 = "get_Assembly" ascii //weight: 1
        $x_1_6 = "ToArray" ascii //weight: 1
        $x_1_7 = "GetResponseStream" ascii //weight: 1
        $x_1_8 = "Write" ascii //weight: 1
        $x_1_9 = "Invoke" ascii //weight: 1
        $x_1_10 = "Stopwatch" ascii //weight: 1
        $x_1_11 = "Sleep" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_3_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_RPB_2147816772_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPB!MTB"
        threat_id = "2147816772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 00 06 6f 17 00 00 0a 0d 12 03 28 18 00 00 0a 23 00 00 00 00 00 00 34 40 fe 04 0c 08 2d e1}  //weight: 1, accuracy: High
        $x_1_2 = "Reverse" wide //weight: 1
        $x_1_3 = {63 00 64 00 6e 00 2e 00 64 00 69 00 73 00 63 00 6f 00 72 00 64 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 61 00 74 00 74 00 61 00 63 00 68 00 6d 00 65 00 6e 00 74 00 73 00 [0-112] 2e 00 70 00 6e 00 67 00}  //weight: 1, accuracy: Low
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "HttpWebResponse" ascii //weight: 1
        $x_1_6 = "Stopwatch" ascii //weight: 1
        $x_1_7 = "ToArray" ascii //weight: 1
        $x_1_8 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPB_2147816772_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPB!MTB"
        threat_id = "2147816772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 00 64 00 6e 00 2e 00 64 00 69 00 73 00 63 00 6f 00 72 00 64 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 61 00 74 00 74 00 61 00 63 00 68 00 6d 00 65 00 6e 00 74 00 73 00 [0-112] 2e 00 65 00 78 00 65 00}  //weight: 1, accuracy: Low
        $x_1_2 = "Antimalware.exe" wide //weight: 1
        $x_1_3 = "DownloadFile" ascii //weight: 1
        $x_1_4 = "NeverLose" ascii //weight: 1
        $x_1_5 = "GetFolderPath" ascii //weight: 1
        $x_1_6 = "GoldenHack" ascii //weight: 1
        $x_1_7 = "SpecialFolder" ascii //weight: 1
        $x_1_8 = "WebClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UEB_2147816776_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UEB!MTB"
        threat_id = "2147816776"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 5f 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4a 00 20 07 8f fb 0e 0b 17 13 04 72 9a b4 00 70 28 ?? ?? ?? 0a 72 b8 b4 00 70 18 1b 8d 17 00 00 01 25 16 72 d2 b4 00 70 a2 25 17 20 00 01 00 00 8c 4c 00 00 01 a2 25 1a 17 8d 17 00 00 01 25 16 02 a2 a2 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UED_2147816787_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UED!MTB"
        threat_id = "2147816787"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 20 00 84 00 00 5d 07 09 20 00 84 00 00 5d 91 08 09 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 06 07 09 17 58 20 00 84 00 00 5d 91 28 ?? ?? ?? 06 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 06 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d a9}  //weight: 10, accuracy: Low
        $x_1_2 = "GetMethod" wide //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "SpectraCyber" wide //weight: 1
        $x_1_6 = "3V52HTB4H5Q5NFB49G58C5" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRU_2147816813_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRU!MTB"
        threat_id = "2147816813"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7f 5e 59 cf 7f 4e 59 83 52 4e 59 4e 59}  //weight: 1, accuracy: High
        $x_1_2 = "$ca194915-441c-4bf8-9f1d-249baebb5b02" ascii //weight: 1
        $x_1_3 = "Cell_Phone_Packages.Resources.resources" ascii //weight: 1
        $x_1_4 = "System.Convert" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQF_2147816916_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQF!MTB"
        threat_id = "2147816916"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 08 11 05 e0 58 0c 08 1f 10 58 4b 13 06 08 1f 14 58 4b 13 07 08 11 05 e0 59 0c 11 06 8d ?? ?? ?? 01 0a 08 11 07 e0 58 0c 06 16 8f ?? ?? ?? 01}  //weight: 1, accuracy: Low
        $x_1_2 = {11 0c 11 0d 58 08 11 0d 58 47 52 00 11 0d 17 58 13 0d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UEC_2147817028_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UEC!MTB"
        threat_id = "2147817028"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {38 05 00 00 00 38 00 00 00 00 11 00 2a 00 02 28 ?? ?? ?? 06 13 00 38 e5 ff ff ff}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = "BinaryFileSchemaGUI" wide //weight: 1
        $x_1_5 = "DictionaryEnumerator" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQG_2147817042_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQG!MTB"
        threat_id = "2147817042"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 20 00 84 00 00 5d 03 04 20 00 84 00 00 5d 91 02 04 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 03 04 17 58 20 00 84 00 00 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQI_2147817048_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQI!MTB"
        threat_id = "2147817048"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 20 00 36 00 00 5d 03 04 20 00 36 00 00 5d 91 02 04 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 03 04 17 58 20 00 36 00 00 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQH_2147817054_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQH!MTB"
        threat_id = "2147817054"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "5C85G94BFN5Q5H4BTH25V3" wide //weight: 10
        $x_10_2 = "7H75FP5C8YSU15478G8V5G" wide //weight: 10
        $x_5_3 = "Spectra2" wide //weight: 5
        $x_5_4 = "Xena" wide //weight: 5
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_5_*) and 3 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_5_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EQL_2147817127_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQL!MTB"
        threat_id = "2147817127"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 06 02 06 91 11 05 18 d6 18 da 61 11 04 07 19 d6 19 da 91 61}  //weight: 1, accuracy: High
        $x_1_2 = {07 02 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 0d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQM_2147817130_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQM!MTB"
        threat_id = "2147817130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d ?? ?? ?? ?? ?? 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 ?? ?? ?? ?? ?? 03 08 18 58 17 59 03 8e 69 5d 91 59 20 fa 00 00 00 58 1b 58 17 58 20 00 01 00 00 5d d2 9c 08 17 58 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {03 08 03 8e 69 5d 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 ?? ?? ?? ?? ?? 03 08 18 58 17 59 03 8e 69 5d 91 59 20 fa 00 00 00 58 1b 58 17 58 20 00 01 00 00 5d d2 9c 08 17 58 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQJ_2147817135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQJ!MTB"
        threat_id = "2147817135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "4A7FCG8D7TJZD4Y5AS0B7G" wide //weight: 10
        $x_5_2 = "Struct" wide //weight: 5
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRP_2147817141_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRP!MTB"
        threat_id = "2147817141"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 fd a3 3d 09 0e 00 00 00 00 00 00 00 00 00 00 01 00 00 00 40 00 00 00 25 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {c2 86 c2 86 c2 86 c2 86 c2 86 c2 86 c2 86 c2 86 c2 87 c2 8e}  //weight: 1, accuracy: High
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "cbReserved2" ascii //weight: 1
        $x_1_6 = "System.Text" ascii //weight: 1
        $x_1_7 = "lpDesktop" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
        $x_1_9 = "base64EncodedData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NRT_2147817142_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NRT!MTB"
        threat_id = "2147817142"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "trieutin.com/loader/uploads/" ascii //weight: 1
        $x_1_2 = "System.CodeDom.Compiler" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "System.Reflection" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSA_2147817147_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSA!MTB"
        threat_id = "2147817147"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 66 05 00 70 28 ?? ?? 00 0a 72 ?? ?? 00 70 6f ?? ?? 00 0a 1f 64 73 ?? ?? 00 0a 1f 10 6f ?? ?? 00 0a 0a 28 ?? ?? 00 0a 0b 73 ?? ?? 00 0a 0c 08 03 2d 18 07 06 28 ?? ?? 00 0a 72 ?? ?? 00 70 6f ?? ?? 00 0a 6f ?? ?? 00 0a 2b 16 07 06 28 ?? ?? 00 0a 72 ?? ?? 00 70 6f ?? ?? 00 0a 6f ?? ?? 00 0a 17 73 ?? ?? 00 0a 0d 09 02 16 02 8e 69 6f ?? ?? 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "aqaygd.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSA_2147817147_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSA!MTB"
        threat_id = "2147817147"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$73e46e73-b923-49e4-ab3b-a6141bdad318" ascii //weight: 1
        $x_1_2 = "Pong_fr.Resources.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSD_2147817223_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSD!MTB"
        threat_id = "2147817223"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$7b0d15ff-59c0-4007-82aa-e741186531cb" ascii //weight: 1
        $x_1_2 = "Visual_N_Queens_Solver.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSG_2147817244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSG!MTB"
        threat_id = "2147817244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$717a9a67-b41a-45af-a862-0b3b8993071a" ascii //weight: 1
        $x_1_2 = "DeCrypt" ascii //weight: 1
        $x_1_3 = "MatrixEditor.Form1.resources" ascii //weight: 1
        $x_1_4 = "ASDadADadAD" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerBrowsableState" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQS_2147817360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQS!MTB"
        threat_id = "2147817360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "88YCQO9GHHPGDYH4ZGHBQ8" wide //weight: 10
        $x_5_2 = "FireLamp" wide //weight: 5
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQS_2147817360_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQS!MTB"
        threat_id = "2147817360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 08 95 28 ?? ?? ?? 0a 0d 09 8e 69 17 da 13 04 16 13 05 2b 12 06 08 1a d8 11 05 d6 09 11 05 91 9c 11 05 17 d6 13 05 11 05 11 04 31 e8 08 17 d6 0c}  //weight: 10, accuracy: Low
        $x_10_2 = {06 08 02 08 91 03 08 03 6f ?? ?? ?? 30 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 9c 08 17 d6 0c}  //weight: 10, accuracy: Low
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EQT_2147817361_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQT!MTB"
        threat_id = "2147817361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 02 11 03 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26}  //weight: 1, accuracy: Low
        $x_1_2 = {11 03 11 06 02 11 06 91 11 02 18 d6 18 da 61 11 01 11 07 19 d6 19 da 91 61}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQU_2147817362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQU!MTB"
        threat_id = "2147817362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 11 05 17 da 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 08 11 05 08 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a da 07 00 07 17 8d ?? ?? ?? 01}  //weight: 1, accuracy: Low
        $x_1_2 = {0d 59 8e 7f 3d 4e 8e 7f 0d 59 8e 7f 0d 59 36 52 0d 59}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SBC_2147817372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SBC!MTB"
        threat_id = "2147817372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 09 20 00 c4 00 00 28 ?? ?? ?? 06 0b 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d df}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "Invoke" ascii //weight: 1
        $x_1_5 = "LastFmSnarls" wide //weight: 1
        $x_1_6 = "GH45GJ14G4E5GYQD4SGO87" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ITU_2147817411_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ITU!MTB"
        threat_id = "2147817411"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 04 11 05 7e e5 01 00 04 11 05 91 7e e6 01 00 04 61 d2 9c 11 05 17 58 13 05 11 05 11 04 8e 69 32 de}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DDV_2147817412_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DDV!MTB"
        threat_id = "2147817412"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "sRakE16hA6V" wide //weight: 1
        $x_1_2 = "+4P9NcxK52M" wide //weight: 1
        $x_1_3 = "+fuuDrXspR8" wide //weight: 1
        $x_1_4 = "hrqAA9HV1Aq" wide //weight: 1
        $x_1_5 = "+jF1GlmU9YQ" wide //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "ToArray" ascii //weight: 1
        $x_1_8 = "CreateDecryptor" ascii //weight: 1
        $x_1_9 = "ToString" ascii //weight: 1
        $x_1_10 = "ToInt32" ascii //weight: 1
        $x_1_11 = "SELECT TotalPhysicalMemory FROM Win32_ComputerSystem" wide //weight: 1
        $x_1_12 = "SELECT AdapterRam FROM Win32_VideoController" wide //weight: 1
        $x_1_13 = "GetEnumerator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQK_2147817418_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQK!MTB"
        threat_id = "2147817418"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 03 04 20 ?? ?? ?? ?? 5d 91 02 04 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 03 04 17 58 20 ?? ?? ?? ?? 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00 07 00 03 04 20}  //weight: 1, accuracy: Low
        $x_1_2 = {5d 07 09 20 ?? ?? ?? ?? 5d 91 08 09 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 07 09 17 58 20 ?? ?? ?? ?? 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00 07 00 07 09 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQX_2147817421_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQX!MTB"
        threat_id = "2147817421"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 05 5d 03 04 05 5d 91 02 04 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 03 04 17 58 05 5d 91 ?? ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQY_2147817428_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQY!MTB"
        threat_id = "2147817428"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "GH45GJ14G4E5GYQD4SGO87" wide //weight: 10
        $x_5_2 = "PdYV" wide //weight: 5
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSB_2147817441_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSB!MTB"
        threat_id = "2147817441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {e2 7f 93 4e ff 7f 5e 59 cf 7f 4e 59 83 52 4e 59 4e 59 cf 7f 7e 4e d3 7f 4e 59 cf 7f 4e 59 77 52 3c 59 3c}  //weight: 1, accuracy: High
        $x_1_2 = {0d 59 8e 7f 3d 4e 8e 7f 0d 59 8e 7f 0d 59 36 52 0d 59}  //weight: 1, accuracy: High
        $x_1_3 = {cf 7f 54 59 ad 52 7a 59 5f 59 e7 7f a1 4e d9 7f 70 59 d6 7f 84 59 6e 52 61 59 50 59 e2 7f a4 4e f7 7f 3c 59 bd 7f 3c 59 65 52}  //weight: 1, accuracy: High
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSC_2147817442_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSC!MTB"
        threat_id = "2147817442"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 1a 00 00 0a 0b 06 16 73 1b 00 00 0a 73 1c 00 00 0a 0c 08 07 6f 1d 00 00 0a 07 6f 1e 00 00 0a 0d de 1e}  //weight: 1, accuracy: High
        $x_1_2 = "WindowsFormsApp1.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSE_2147817443_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSE!MTB"
        threat_id = "2147817443"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ShortPdddddddddddddddddddrocess" ascii //weight: 1
        $x_1_2 = "ShorsfsftPdddddddddddddddhfghgddddrocess" ascii //weight: 1
        $x_1_3 = "ShortPdddddddjfjfddddddddddddrocess" ascii //weight: 1
        $x_1_4 = "ShortPddddddddddddddddfdddrocess" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSE_2147817443_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSE!MTB"
        threat_id = "2147817443"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 03 00 00 0a 02 03 28 ?? ?? ?? 0a 00 03 1c 28 ?? ?? ?? 0a 00 03 17 8d ?? ?? ?? 01 0a 06 16 1f 5c 9d 06 6f ?? ?? ?? 0a 03 17 8d ?? ?? ?? 01 0a 06 16 1f 5c 9d 06 6f ?? ?? ?? 0a 8e 69 18 59 9a 1f 16 28 ?? ?? ?? 0a 00 03 28 ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_5_2 = {73 0a 00 00 0a 0a 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 17 6f ?? ?? ?? 0a 00 06 17 6f ?? ?? ?? 0a 00 06 72 ?? ?? ?? 70}  //weight: 5, accuracy: Low
        $x_1_3 = "sihost64" wide //weight: 1
        $x_1_4 = "Filmora11Crack" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSH_2147817444_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSH!MTB"
        threat_id = "2147817444"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 08 02 08 91 03 08 03 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 9c 08 17 d6 0c 08 07 31 de}  //weight: 1, accuracy: Low
        $x_1_2 = {02 08 95 28 ?? ?? ?? 0a 0d 09 8e 69 17 da 13 04 16 13 05 2b 12 06 08 1a d8 11 05 d6 09 11 05 91 9c 11 05 17 d6 13 05 11 05 11 04 31 e8 08 17 d6 0c 08 07 31 cb}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSI_2147817445_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSI!MTB"
        threat_id = "2147817445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "3.70.247.229" ascii //weight: 1
        $x_1_2 = "ToArray" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSJ_2147817446_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSJ!MTB"
        threat_id = "2147817446"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 09 20 00 c4 00 00 28 ?? ?? ?? 06 0b 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d e1}  //weight: 1, accuracy: Low
        $x_1_2 = {03 04 05 5d 03 04 05 5d 91 02 04 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 06 03 04 17 58 05 5d 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSK_2147817447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSK!MTB"
        threat_id = "2147817447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 03 11 06 02 11 06 91 11 02 18 d6 18 da 61 11 01 11 07 19 d6 19 da 91 61 b4 9c 20}  //weight: 1, accuracy: High
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToArgb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSL_2147817448_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSL!MTB"
        threat_id = "2147817448"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 0b 09 09 00 00 00 10 00 03 00 00 00 00 01 00 00 00 3f 00 00 00 0c 00 00 00 0c 00 00 00 1f 00 00 00 0a 00 00 00 4e 00 00 00 17 00 00 00 07 00 00 00 02 00 00 00 03 00 00 00 04 00 00 00 06 00 00 00 04 00 00 00 01 00 00 00 05 00 00 00 06 00 00 00 04 00 00 00 00 00 01 00 01 00 00 00 00 00 06}  //weight: 1, accuracy: High
        $x_1_2 = {6c 00 00 00 60 08 00 00 23 7e 00 00 cc 08}  //weight: 1, accuracy: High
        $x_1_3 = "HttpWebRequest" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "ResumeLayout" ascii //weight: 1
        $x_1_6 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSM_2147817449_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSM!MTB"
        threat_id = "2147817449"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 17 da 6f ?? ?? ?? 0a 08 11 05 08 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a da 13 06 09 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0d 11 05 17 d6 13 05 11 05 11 04 31 c5}  //weight: 1, accuracy: Low
        $x_1_2 = "PEDOIWDEJUIJD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EQZ_2147817459_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EQZ!MTB"
        threat_id = "2147817459"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 17 da 28 ?? ?? ?? 06 08 11 05 08 28 ?? ?? ?? 06 5d 28 ?? ?? ?? 06 da 13 06 09 11 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 0d 11 05 17 d6 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "GetTypeFromHandle" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSN_2147817461_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSN!MTB"
        threat_id = "2147817461"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 7b 6b 00 00 04 7e ?? ?? ?? 04 20 ?? ?? ?? 4a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "AMAZINGNEWWORLD_LAUNCHER" ascii //weight: 1
        $x_1_3 = "$6d45305a-801f-4c66-87b7-80f523158c4a" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSN_2147817461_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSN!MTB"
        threat_id = "2147817461"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$bd1b12ee-513d-45e4-8b1b-9fb3ab6ba456" ascii //weight: 1
        $x_1_2 = "INFS3160Final.Resources.resources" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSQ_2147817486_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSQ!MTB"
        threat_id = "2147817486"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$150be75a-4e56-4d02-b836-f53938d04bd6" ascii //weight: 1
        $x_1_2 = "Timebox.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UUEE_2147817513_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UUEE!MTB"
        threat_id = "2147817513"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 72 01 00 00 70 6f ?? ?? ?? 0a 0b 00 07 14 fe 01 16 fe 01 0d 09 2d 02 de 56 07 6f ?? ?? ?? 0a d4 8d 13 00 00 01 0c 07 08 16 08 8e 69 6f ?? ?? ?? 0a 26 08 28 ?? ?? ?? 0a 72 13 00 00 70 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 0c 08 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 14 14 6f ?? ?? ?? 0a 26 00 de 10}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GNL_2147817515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GNL!MTB"
        threat_id = "2147817515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 08 91 6f ?? ?? ?? 0a 00 00 08 25 17 59 0c 16 fe 02 0d 09 2d e8}  //weight: 1, accuracy: Low
        $x_1_2 = "Progressive" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AML_2147817526_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AML!MTB"
        threat_id = "2147817526"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bin\\Debug\\SLN\\Application_Development\\obj\\Debug\\Application_Development.pdb" ascii //weight: 1
        $x_1_2 = {67 65 74 5f 41 64 64 72 65 73 73 00 73 65 74 5f 41 64 64 72 65 73 73 00 74 78 74 41 64 64 72 65 73 73}  //weight: 1, accuracy: High
        $x_1_3 = {53 79 73 74 65 6d 2e 44 61 74 61 00 44 6f 77 6e 6c 6f 61 64 44 61 74 61 00 64 61 74 61}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LXEA_2147817532_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LXEA!MTB"
        threat_id = "2147817532"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 09 20 00 c4 00 00 28 ?? ?? ?? 06 0b 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d df}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = "WinFormProjects" wide //weight: 1
        $x_1_5 = "UD7E78DO6PY8H7SXZR58SZ" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERA_2147817535_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERA!MTB"
        threat_id = "2147817535"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 05 5d 03 02 05 04 28 ?? ?? ?? 06 03 04 17 58 05 5d 91 28 ?? ?? ?? 06 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = {02 05 04 5d 91 03 05 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERC_2147817536_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERC!MTB"
        threat_id = "2147817536"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 03 11 06 02 11 06 91 11 02 18 d6 18 da 61 11 01 11 07 19 d6 19 da 91 61 b4 9c}  //weight: 1, accuracy: High
        $x_1_2 = {11 01 02 11 03 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERB_2147817541_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERB!MTB"
        threat_id = "2147817541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "UD7E78DO6PY8H7SXZR58SZ" wide //weight: 10
        $x_5_2 = "T0OvGG6kukiwGuOCpX" wide //weight: 5
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSS_2147817591_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSS!MTB"
        threat_id = "2147817591"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 1b 00 00 06 0a 28 ?? 00 00 0a 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0b dd 03}  //weight: 5, accuracy: Low
        $x_1_2 = "WindowsFormsApp27.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSS_2147817591_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSS!MTB"
        threat_id = "2147817591"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 08 11 05 07 11 05 18 5a 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 9c 00 11 05 17 58 13 05 11 05 08 8e 69 fe 04 13 06 11 06 2d d5}  //weight: 1, accuracy: Low
        $x_1_2 = "18b5-beee-4201-b5a0-8b7854e" ascii //weight: 1
        $x_1_3 = "Substring" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NST_2147817600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NST!MTB"
        threat_id = "2147817600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 5d a2 cb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 73 00 00 00 13 00 00 00 23 00 00 00 0f 01 00 00 32 00 00 00 c0 00 00 00 01 00 00 00 7d 00 00 00 01 00 00 00 25 00 00 00 0a 00 00 00 17}  //weight: 1, accuracy: High
        $x_1_2 = "5d911e00eaf1" ascii //weight: 1
        $x_1_3 = "b8328297" ascii //weight: 1
        $x_1_4 = "FromBase64CharArray" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERF_2147817638_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERF!MTB"
        threat_id = "2147817638"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0d 59 8e 7f 3d 4e 8e 7f 0d 59 8e 7f 0d 59 36 52 0d 59}  //weight: 1, accuracy: High
        $x_1_2 = "AccountDomainSid" ascii //weight: 1
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "YASUSUAHBN_925" ascii //weight: 1
        $x_1_5 = "YASUSUAHBN_927" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSV_2147817677_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSV!MTB"
        threat_id = "2147817677"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CU0mxh8nSOsmJDWZHj.MrjSg7KR80F4fcrGf4" ascii //weight: 1
        $x_1_2 = "5S3Z5C2H5489RFE7855Z8H" ascii //weight: 1
        $x_1_3 = "UnderlyingSystemType" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSX_2147817700_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSX!MTB"
        threat_id = "2147817700"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$c82b8eef-dc74-491e-bca1-794b1606ea10" ascii //weight: 1
        $x_1_2 = "FromBase64CharArray" ascii //weight: 1
        $x_1_3 = "MatchNumberDelegate.Resources.resources" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSY_2147817707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSY!MTB"
        threat_id = "2147817707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://dafa.fa" wide //weight: 1
        $x_1_2 = "saencryptedreport" ascii //weight: 1
        $x_1_3 = "C:\\somedirectory" ascii //weight: 1
        $x_1_4 = "wswsws" ascii //weight: 1
        $x_1_5 = "ssffffffsdddffddd " ascii //weight: 1
        $x_1_6 = "seddfffffffffffffffffdffexe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERD_2147817722_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERD!MTB"
        threat_id = "2147817722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$EDBFDE51-C76F-4E61-A91C-314CF0B49E5A" ascii //weight: 1
        $x_1_2 = "Substring" wide //weight: 1
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERH_2147817723_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERH!MTB"
        threat_id = "2147817723"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0a 03 04 20 00 c0 00 00 5d 03 02 20 00 c0 00 00 04 ?? ?? ?? ?? ?? 03 04 17 58 20 00 c0 00 00 5d 91 ?? ?? ?? ?? ?? 59 06 58 06 5d ?? ?? ?? ?? ?? 9c 03}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LLD_2147817725_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LLD!MTB"
        threat_id = "2147817725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 0c 00 00 fe 0c 01 00 fe 09 00 00 fe 0c 01 00 91 fe 09 01 00 fe 0c 01 00 fe 09 01 00 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 9c fe 0c 01 00 20 01 00 00 00 58 fe 0e 01 00 fe 0c 01 00 fe 09 00 00 8e 69 20 01 00 00 00 59 fe 02 20 00 00 00 00 fe 01 fe 0e 02 00 fe 0c 02 00 3a 98 ff ff ff}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSZ_2147817753_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSZ!MTB"
        threat_id = "2147817753"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 f1 00 00 06 13 06 11 06 7e ?? ?? ?? 04 28 ?? ?? ?? 0a 2c 02 19 2a 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 13 07 11 05 11 06 11 07 03 6f ?? ?? ?? 0a 17 58 16 28 ?? ?? ?? 06 13 08 11 08 2c 07 11 08 6a 1c 6a 33 02 1b 2a 11 05 7e ?? ?? ?? 04 7e ?? ?? ?? 04 72 ?? ?? ?? 70 28 ?? ?? ?? 06 72 ?? ?? ?? 70 28 ?? ?? ?? 06 11 06 16 7e ?? ?? ?? 04 28 ?? ?? ?? 06}  //weight: 5, accuracy: Low
        $x_1_2 = "Fluxus IDE" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSZ_2147817753_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSZ!MTB"
        threat_id = "2147817753"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 07 03 17 da 93 0d 08 03 04 6f ?? ?? ?? 0a 5d 93 13 04 09 11 04 da 13 05 11 05 8c ?? ?? ?? 01 0a 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = "YASUSUAHBN_925" ascii //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = {42 00 75 00 6e 00 00 0b 69 00 66 00 75 00 5f 00 54 00 00 07 65 00 78 00 74 00 00 07 42 00 6f 00 78}  //weight: 1, accuracy: High
        $x_1_5 = {47 00 65 00 74 00 4d 00 00 0d 65 00 74 00 68 00 6f 00 64}  //weight: 1, accuracy: High
        $x_1_6 = "BusinessModel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSO_2147817758_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSO!MTB"
        threat_id = "2147817758"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 aa 02 00 8d ?? ?? ?? 01 6f ?? ?? ?? 0a 00 11 04 14 72 ?? ?? ?? 70 1b 8d ?? ?? ?? 01 25 16 02 25 13 09 19 6f ?? ?? ?? 0a a2 25 17 16}  //weight: 1, accuracy: Low
        $x_1_2 = "GetManifestResourceNames" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSR_2147817759_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSR!MTB"
        threat_id = "2147817759"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 09 00 00 fe 0c 01 00 6f ?? ?? ?? 0a 20 ?? ?? ?? 00 61 fe 0e 02 00 fe 0c 00 00 fe 0c 02 00 20 ?? ?? ?? 00 61 fe 09 01 00 fe 0c 01 00 fe 09 01 00 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 61 d1 fe 0e 03 00 fe 0d 03 00 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a fe 0e 00 00 fe 0c 01 00 20 ?? ?? ?? 00 58 fe 0e 01 00 fe 0c 01 00 fe 09 00 00 6f ?? ?? ?? 0a 3f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NSU_2147817761_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NSU!MTB"
        threat_id = "2147817761"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "klhjfpo[jhffsdartulupopohgtrsrtytyui[]zxcvjhu7ygop" ascii //weight: 1
        $x_1_2 = "System.Reflection.Assembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTC_2147817776_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTC!MTB"
        threat_id = "2147817776"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$54703343-adf0-4942-9d5a-17b16d490051" ascii //weight: 1
        $x_1_2 = "Project.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "GetMethods" ascii //weight: 1
        $x_1_4 = "GetTypes" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JDH_2147817780_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JDH!MTB"
        threat_id = "2147817780"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 8d 17 00 00 01 25 16 02 a2 25 0b 14 14 17 8d 83 00 00 01 25 16 17 9c 25 0c 28 ?? ?? ?? 0a 0d 08 16 91 2d 02 2b 1e 07 16 9a 28 ?? ?? ?? 0a d0 06 00 00 1b 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 74 06 00 00 1b 10 00 09 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERI_2147817787_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERI!MTB"
        threat_id = "2147817787"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 09 28 ?? ?? ?? 06 26 08 07 06 09 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c 06 17 d6 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {0c 07 03 17 da 93 0d 08 03 04 6f ?? ?? ?? 0a 5d 93 13 04 09 11 04 da 0d 00 02 6f ?? ?? ?? 0a 0b 04 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JDI_2147817805_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JDI!MTB"
        threat_id = "2147817805"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 2b 0f 00 08 07 09 28 ?? ?? ?? 06 0b 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 04 11 04 2d e4}  //weight: 1, accuracy: Low
        $x_1_2 = "GetMethods" ascii //weight: 1
        $x_1_3 = "Invoke" wide //weight: 1
        $x_1_4 = "Fsha" wide //weight: 1
        $x_1_5 = "CF4T454AC805ZP7AGFE074" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERK_2147817813_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERK!MTB"
        threat_id = "2147817813"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 20 00 3e 00 00 5d 03 02 20 00 3e 00 00 04 ?? ?? ?? ?? ?? 03 04 17 58 20 00 3e 00 00 5d 91 ?? ?? ?? ?? ?? 59 11 00 58 11 00 5d ?? ?? ?? ?? ?? 9c ?? ?? ?? ?? ?? 03 13 01 ?? ?? ?? ?? ?? 00 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERL_2147817814_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERL!MTB"
        threat_id = "2147817814"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "CF4T454AC805ZP7AGFE074" wide //weight: 10
        $x_5_2 = "PaddingHelpers.MyBinarySearchTree" wide //weight: 5
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERM_2147817815_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERM!MTB"
        threat_id = "2147817815"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 09 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 0d}  //weight: 1, accuracy: Low
        $x_1_2 = {09 11 06 02 11 06 91 08 18 d6 18 da 61 07 11 07 19 d6 19 da 91 61 b4 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTD_2147817823_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTD!MTB"
        threat_id = "2147817823"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fsdsddfdssffffd" ascii //weight: 1
        $x_1_2 = "seddfffffffffffffffffdffexe" ascii //weight: 1
        $x_1_3 = "ShortPddddddddddddddddfdddrocess Completed" ascii //weight: 1
        $x_1_4 = "gddgdlsffsdfsdsfdlsgsdsdfhsg" ascii //weight: 1
        $x_1_5 = "drdfeffssdddfslosfsdfeg" ascii //weight: 1
        $x_1_6 = "fsddddsfsfffsfsfsddfdf" ascii //weight: 1
        $x_1_7 = "lpfsdfAddsadress" ascii //weight: 1
        $x_1_8 = "hPfdsfrodscess" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTH_2147817835_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTH!MTB"
        threat_id = "2147817835"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$975ba743-7e6f-4569-ba50-747d4200c392" ascii //weight: 1
        $x_1_2 = "Laboratoire_4.Resources.resources" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "GetExportedTypes" ascii //weight: 1
        $x_1_6 = "GetObjectValue" ascii //weight: 1
        $x_1_7 = "LateGet" ascii //weight: 1
        $x_1_8 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTI_2147817837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTI!MTB"
        threat_id = "2147817837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 b5 a2 3d 09 1f 00 00 00 00 00 00 00 00 00 00 02 00 00 00 96 00 00 00 81 00 00 00 d4 00 00 00 ae 02 00 00 11 01 00 00 0e 01 00 00 6b 00 00 00 04 00 00 00 07 00 00 00 33}  //weight: 1, accuracy: High
        $x_1_2 = "dfghrtdbg.Resources.resources" ascii //weight: 1
        $x_1_3 = "fc83b6b1-9161-4815-be1c-9060d752b1dd" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTA_2147817913_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTA!MTB"
        threat_id = "2147817913"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {03 28 18 00 00 06 26 7e ?? ?? ?? 04 18 6f ?? ?? ?? 0a 00 02 28 ?? ?? ?? 06 0a 2b 00 06 2a}  //weight: 5, accuracy: Low
        $x_1_2 = "SplashTest.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTA_2147817913_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTA!MTB"
        threat_id = "2147817913"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AsSsMmB" wide //weight: 1
        $x_1_2 = "@System@.@Reflection@.@Assembly@" wide //weight: 1
        $x_1_3 = "@Load@" ascii //weight: 1
        $x_1_4 = "Method0" ascii //weight: 1
        $x_1_5 = "ToInteger" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTB_2147817914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTB!MTB"
        threat_id = "2147817914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "nJvrMAc9DUl2v5CQMY7LcJ9aAOuo7g7Qr" wide //weight: 1
        $x_1_2 = {5a 00 6e 00 76 00 39 00 69 00 75 00 36 00 6f 00 34 00 4d 00 59 00 78 00 2b 00 54 00 58 00 77 00 34 00 64 00 66 00 4a 00 59 00 6a 00 77 00 41 00 42 00 6a 00 58 00 77 00 32 00 63 00 2b 00 4a 00 70 00 34 00 35 00 6c 00 75 00 2f 00 6e 00 4a}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTJ_2147817940_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTJ!MTB"
        threat_id = "2147817940"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 05 17 da 6f ?? ?? ?? 0a 08 11 05 08 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a da 13 06 09 11 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0d 11 05 17 d6 13 05 11 05 11 04 31 c5}  //weight: 1, accuracy: Low
        $x_1_2 = {49 00 33 06 6e 00 76 00 33 06 6f 00 6b 00 33 06 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {42 00 75 00 6e 00 00 0b 69 00 66 00 75 00 5f 00 54 00 00 07 65 00 78 00 74 00 00 07 42 00 6f 00 78}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PCH_2147817941_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PCH!MTB"
        threat_id = "2147817941"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 8d 19 00 00 01 25 16 02 a2 25 0b 14 14 17 8d 59 00 00 01 25 16 17 9c 25 0c 28 ?? ?? ?? 0a 0d 08 16 91 2d 02 2b 1e 07 16 9a 28 ?? ?? ?? 0a d0 0a 00 00 1b 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 74 0a 00 00 1b 10 00 09 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MHG_2147817943_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MHG!MTB"
        threat_id = "2147817943"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 8d 19 00 00 01 25 16 02 a2 25 0b 14 14 17 8d 53 00 00 01 25 16 17 9c 25 0c 28 ?? ?? ?? 0a 0d 08 16 91 2d 02 2b 1e 07 16 9a 28 ?? ?? ?? 0a d0 06 00 00 1b 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 74 06 00 00 1b 10 00 09 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZQEA_2147817945_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZQEA!MTB"
        threat_id = "2147817945"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 11 09 6f ?? ?? ?? 0a 13 0a 11 0a 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 0b 11 0b 2c 2c 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 08 12 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 00 11 09 17 d6 13 09 11 09 11 08 fe 02 16 fe 01 13 0c 11 0c 2d 9b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FYEA_2147817947_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FYEA!MTB"
        threat_id = "2147817947"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 2b 0d 07 06 08 28 ?? ?? ?? 06 0a 08 15 58 0c 08 16 2f ef}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZIRF_2147817948_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZIRF!MTB"
        threat_id = "2147817948"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 02 8e 69 6a 5d d4 02 06 02 8e 69 6a 5d d4 91 03 06 03 8e 69 6a 5d d4 91 61 28 ?? ?? ?? 0a 02 06 17 6a 58 02 8e 69 6a 5d d4 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 00 06 17 6a 58 0a 06 02 8e 69 17 59 6a 04 17 58 6e 5a fe 02 16 fe 01 0b 07 2d a0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERO_2147817980_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERO!MTB"
        threat_id = "2147817980"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$15d61077-816e-4a64-b485-56a1fd07be5d" ascii //weight: 1
        $x_1_2 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_3 = "VirtualProtect" ascii //weight: 1
        $x_1_4 = "GetTypeFromHandle" ascii //weight: 1
        $x_1_5 = "GetHINSTANCE" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "Substring" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERP_2147817993_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERP!MTB"
        threat_id = "2147817993"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0d 59 8e 7f 3d 4e 8e 7f 0d 59 8e 7f 0d 59 36 52 0d 59}  //weight: 1, accuracy: High
        $x_1_2 = {49 00 33 06 6e 00 76 00 33 06 6f 00 6b 00 33 06 65 00}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "ifu_T" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTN_2147818030_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTN!MTB"
        threat_id = "2147818030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 7e 43 01 00 04 6f ?? ?? ?? 0a 00 07 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 00 07 7e ?? ?? ?? 04 7e ?? ?? ?? 04 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "zc4v2EO" ascii //weight: 1
        $x_1_3 = "WinForms_RecursiveFormCreate" wide //weight: 1
        $x_1_4 = "BookClubManager.My.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTN_2147818030_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTN!MTB"
        threat_id = "2147818030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$8D562DF2-4732-4884-95EA-D8A31E5A42D9" ascii //weight: 1
        $x_1_2 = "Paraeducator.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "ToBase64String" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTN_2147818030_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTN!MTB"
        threat_id = "2147818030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "8f9eb8c0-3c86-4dfd-8104-e479739e41b8" ascii //weight: 10
        $x_10_2 = "Concours_Sup.Resources.resources" ascii //weight: 10
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
        $x_1_8 = "ToString" ascii //weight: 1
        $x_1_9 = "FromBase64CharArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 6 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NTM_2147818034_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTM!MTB"
        threat_id = "2147818034"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2b 02 26 16 73 42 00 00 0a 0a 06 28 43 00 00 0a 03 50 6f 44 00 00 0a 6f 45 00 00 0a 0b 73 46 00 00 0a 0c 08 07 6f 47 00 00 0a 08 28 62 00 00 06 6f 48 00 00 0a 08 6f 49 00 00 0a 02 50 28 63 00 00 06 02 50 8e 69 6f 4a 00 00 0a 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTM_2147818034_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTM!MTB"
        threat_id = "2147818034"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 09 00 00 fe 0c 04 00 6f ?? ?? ?? 0a fe 0c 00 00 61 fe 0e 05 00 fe 0c 02 00 fe 0c 05 00 fe 0c 01 00 61 fe 09 01 00 fe 0c 04 00 fe 0c 03 00 5d 6f ?? ?? ?? 0a 61 d1 fe 0e 06 00 fe 0d 06 00 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a fe 0e 02 00 fe 0c 04 00 20 01 00 00 00 58 fe 0e 04 00 fe 0c 04 00 fe 09 00 00 6f ?? ?? ?? 0a 3f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERQ_2147818044_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERQ!MTB"
        threat_id = "2147818044"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 05 04 5d 91 03 05 1f 16 5d ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {20 00 01 00 00 0a 03 04 20 00 14 01 00 5d 03 02 20 00 14 01 00 04 ?? ?? ?? ?? ?? 03 04 17 58 20 00 14 01 00 5d 91 ?? ?? ?? ?? ?? 59 06 58 06 5d ?? ?? ?? ?? ?? 9c 03 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERR_2147818045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERR!MTB"
        threat_id = "2147818045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "TZQVO557GCBAZHPTB4GZG5" wide //weight: 10
        $x_5_2 = "Athlete" wide //weight: 5
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ERS_2147818046_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ERS!MTB"
        threat_id = "2147818046"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 06 02 11 06 91 08 18 d6 18 da 61 07 11 07 19 d6 19 da 91 61 b4 9c}  //weight: 1, accuracy: High
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 02 8e 69 17 d6 17 da}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FGH_2147818086_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FGH!MTB"
        threat_id = "2147818086"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HMR_DBDataSet" ascii //weight: 1
        $x_1_2 = "HRM_SUB" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "Socket" ascii //weight: 1
        $x_1_5 = "NetworkCredential" ascii //weight: 1
        $x_1_6 = "MemoryStream" ascii //weight: 1
        $x_1_7 = "password_keydown" ascii //weight: 1
        $x_1_8 = "StringReader" ascii //weight: 1
        $x_1_9 = "http://" ascii //weight: 1
        $x_1_10 = "HRM_SUB\\obj\\Debug\\HRM_SUB.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTK_2147818161_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTK!MTB"
        threat_id = "2147818161"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 05 04 5d 91 03 05 1f 16 5d 6f ?? ?? ?? 0a 61}  //weight: 1, accuracy: Low
        $x_1_2 = {06 03 04 17 58 20}  //weight: 1, accuracy: High
        $x_1_3 = {06 03 04 17 58 20 00 3e 00 00 5d 91 28}  //weight: 1, accuracy: High
        $x_1_4 = {5d 03 02 20 00 3e 00 00 04 28}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTL_2147818162_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTL!MTB"
        threat_id = "2147818162"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 fd a3 3d 09 0e 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 3a 00 00 00 24 00 00 00 39 00 00 00 4e 00 00 00 b1 00 00 00 47 00 00 00 01 00 00 00 0f 00 00 00 40 00 00 00 01 00 00 00 07 00 00 00 11 00 00 00 07}  //weight: 1, accuracy: High
        $x_1_2 = "base64EncodedData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTP_2147818178_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTP!MTB"
        threat_id = "2147818178"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$59960a0b-021a-449c-900f-ecc0d0202ec9" ascii //weight: 1
        $x_1_2 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
        $x_1_3 = "Client.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPC_2147818232_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPC!MTB"
        threat_id = "2147818232"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 00 64 00 6e 00 2e 00 64 00 69 00 73 00 63 00 6f 00 72 00 64 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 61 00 74 00 74 00 61 00 63 00 68 00 6d 00 65 00 6e 00 74 00 73 00 [0-112] 2e 00 70 00 6e 00 67 00}  //weight: 1, accuracy: Low
        $x_1_2 = "Invoke" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "WebResponse" ascii //weight: 1
        $x_1_5 = "Reverse" ascii //weight: 1
        $x_1_6 = "Write" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
        $x_1_8 = "ReadBytes" ascii //weight: 1
        $x_1_9 = "WebRequest" ascii //weight: 1
        $x_1_10 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTR_2147818244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTR!MTB"
        threat_id = "2147818244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0a 03 04 20 00 04 01 00 5d 03 02 20 00 04 01 00 04 28 ?? ?? ?? 06 03 04 17 58 20 00 04 01 00 5d 91 28 ?? ?? ?? 06 59 06 58 06 5d 28 ?? ?? ?? 06 9c 03 0b 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {02 05 04 5d 91 03 05 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 06 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTR_2147818244_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTR!MTB"
        threat_id = "2147818244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$46f28a29-80c0-498d-bdf4-cf1a5db1c447" ascii //weight: 1
        $x_1_2 = "Comunication.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 00}  //weight: 1, accuracy: High
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESB_2147818265_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESB!MTB"
        threat_id = "2147818265"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 07 17 da 28 ?? ?? ?? 06 28 ?? ?? ?? 06 11 04 11 07 11 04 28 ?? ?? ?? 06 5d 28 ?? ?? ?? 06 28 ?? ?? ?? 06 da 13 08 11 05 11 08 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 13 05 11 07 17 d6 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = "String1" wide //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTE_2147818320_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTE!MTB"
        threat_id = "2147818320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 d4 02 e8 c9 0e 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 26 00 00 00 16 00 00 00 57 00 00 00 70 00 00 00 3c 00 00 00 06 00 00 00 01 00 00 00 03 00 00 00 15 00 00 00 02 00 00 00 02}  //weight: 1, accuracy: High
        $x_1_2 = "System.Text" ascii //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "GetExecutingAssembly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTE_2147818320_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTE!MTB"
        threat_id = "2147818320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 0f 00 00 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 06 19 17 73 ?? ?? ?? 0a 0b 07 6f ?? ?? ?? 0a d4 8d ?? ?? ?? 01 0c 07 08 16 08 8e 69 6f ?? ?? ?? 0a 26 07 6f ?? ?? ?? 0a 00 00 72 ?? ?? ?? 70 72 ?? ?? ?? 70 17 28 ?? ?? ?? 0a 13 04 16 13 05 2b 34 11 04 11 05 9a 0d 00 00 09 19 18 73 ?? ?? ?? 0a 0b 07 08 16 08 8e 69 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "RozbehRv" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTG_2147818321_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTG!MTB"
        threat_id = "2147818321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 0a 11 0a 20 08 56 4b 12 20 ?? ?? ?? 68 66 61 58 20 ?? ?? ?? 5f 5a 66 25 13 09 1f 0f 5e}  //weight: 5, accuracy: Low
        $x_1_2 = "Nisgcke Mankarin" ascii //weight: 1
        $x_1_3 = "ScreenToGif Application" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTG_2147818321_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTG!MTB"
        threat_id = "2147818321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 d5 02 fc 09 0e 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 38 00 00 00 10 00 00 00 2f 00 00 00 47 00 00 00 0e 00 00 00 55 00 00 00 0e 00 00 00 01 00 00 00 01 00 00 00 14 00 00 00 02 00 00 00 01 00 00 00 02 00 00 00 01 00 00 00 0a}  //weight: 1, accuracy: High
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Substring" ascii //weight: 1
        $x_1_4 = "HttpWebResponse" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTO_2147818322_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTO!MTB"
        threat_id = "2147818322"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 05 04 5d 91 03 05 1f 16 5d 28 ?? ?? ?? 06 61 28 ?? ?? ?? 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTQ_2147818323_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTQ!MTB"
        threat_id = "2147818323"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 0c 00 00 fe 0c 03 00 6f ?? ?? ?? 0a fe 0e 02 00 fe 0c 02 00 20 ?? 00 00 00 61 d1 fe 0e 02 00 fe 0c 01 00 fe 0c 02 00 6f ?? ?? ?? 0a 26 fe 0c 03 00 20 ?? 00 00 00 58 fe 0e 03 00 fe 0c 03 00 fe 09 00 00 6f ?? ?? ?? 0a 3f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTS_2147818324_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTS!MTB"
        threat_id = "2147818324"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e 05 00 00 04 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 39 ?? ?? ?? 00 7e ?? ?? ?? 04 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 2c 38 7e ?? ?? ?? 04 7e ?? ?? ?? 04 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 26 38 ?? ?? ?? 00 7e ?? ?? ?? 04}  //weight: 5, accuracy: Low
        $x_1_2 = "AbaddonDropper-main" ascii //weight: 1
        $x_1_3 = "Krsto" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTS_2147818324_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTS!MTB"
        threat_id = "2147818324"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$79172B13-EDBA-4096-B725-8E92B730B2BA" ascii //weight: 1
        $x_1_2 = "ClassLibrary3.Resources.resources" ascii //weight: 1
        $x_1_3 = "DownloadString" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTT_2147818328_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTT!MTB"
        threat_id = "2147818328"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {20 ee db d0 24 25 26 fe ?? ?? 00 20 ?? ?? ?? 38 5b 61 38 ?? ?? ?? ff 00 fe ?? ?? 00 fe ?? ?? 00 20 ?? ?? ?? 00 8d ?? ?? ?? 01 fe ?? ?? 00 fe ?? ?? 00 20 ?? ?? ?? 00}  //weight: 5, accuracy: Low
        $x_1_2 = "RayX.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTT_2147818328_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTT!MTB"
        threat_id = "2147818328"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0a 03 02 20 00 14 01 00 04 28 ?? 00 00 06 03 04 17 58 20 00 14 01 00 5d 91 59 06 58 06 5d 0b 03 04 20 00 14 01 00 5d 07 d2 9c 03 0c 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {02 05 04 5d 91 03 05 1f 16 5d 6f ?? ?? ?? 0a 61 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTU_2147818333_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTU!MTB"
        threat_id = "2147818333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\sadasd" ascii //weight: 1
        $x_1_2 = "____________________________________________________________________" wide //weight: 1
        $x_1_3 = "get_daiofjhoawbfuabfskakjfdlf" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "get_aidoaisdpaodijwdn" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GCUF_2147818342_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GCUF!MTB"
        threat_id = "2147818342"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AsSsMmB" wide //weight: 1
        $x_1_2 = "GetManifestResourceNames" wide //weight: 1
        $x_1_3 = "@System@.@Reflection@.@Assembly@" wide //weight: 1
        $x_1_4 = "GetManifestResourceStream" wide //weight: 1
        $x_1_5 = "@Load@" wide //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "ToInteger" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SAA_2147818343_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SAA!MTB"
        threat_id = "2147818343"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 28 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 13 00 20 07 8f fb 0e 0b 17 13 04 02 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBC_2147818368_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBC!MTB"
        threat_id = "2147818368"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {91 61 07 11 ?? 20 ?? ?? ?? ?? 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBC_2147818368_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBC!MTB"
        threat_id = "2147818368"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {36 00 36 00 37 00 39 00 36 00 34 00 37 00 39 00 36 00 33 00 37 00 46 00 36 00 5a 00 37 00 43 00 5a 00 33 00 37 00 35 00 36 00 41 00 37 00 39 00 36 00 33 00 35 00 5a 00 37 00 35 00 37 00 46 00 36 00 32 00 37 00 37 00 34 00 34 00 37 00 45 00 36 00 35 00 36 00 33 00 36 00 32 00 37 00 35 00 36 00 5a 00 37 00 31 00 31 00 33 00 37 00 35 00 36 00 41 00 37}  //weight: 1, accuracy: High
        $x_1_2 = "Xu_Ly_Da_Thuc.FormMain.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBA_2147818370_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBA!MTB"
        threat_id = "2147818370"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0d 02 07 6f ?? 00 00 0a 08 59 09 59 20 00 01 00 00 5d 13}  //weight: 1, accuracy: Low
        $x_1_2 = {8e 69 5d 91 61 d2 52 00 11 ?? 17 58 13}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBA_2147818370_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBA!MTB"
        threat_id = "2147818370"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 1b 09 5d 13 1c 11 1b 11 04 5d 13 1d 07 11 1c 91 13 1e 08 11 1d 6f ?? 00 00 0a 13 1f 02 07 11 1b 28 ?? 00 00 06 13 20 02 11 1e 11 1f 11 20 28 ?? 00 00 06 13 21 07 11 1c 11 21 20 00 01 00 00 5d d2 9c 00 11 1b 17 59 13 1b 11 1b 16 fe 04 16 fe 01 13 22 11 22 2d a7}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPG_2147818373_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPG!MTB"
        threat_id = "2147818373"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {62 00 6d 00 6e 00 2e 00 6c 00 70 00 6d 00 70 00 62 00 61 00 6e 00 74 00 65 00 6e 00 2e 00 69 00 64 00 [0-64] 2e 00 70 00 6e 00 67 00}  //weight: 1, accuracy: Low
        $x_1_2 = "Kaspersky" ascii //weight: 1
        $x_1_3 = "Anti-Virus" ascii //weight: 1
        $x_1_4 = "WebRequest" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
        $x_1_6 = "ToArray" ascii //weight: 1
        $x_1_7 = "String" ascii //weight: 1
        $x_1_8 = "DynamicInvoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTV_2147818421_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTV!MTB"
        threat_id = "2147818421"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 05 04 5d 91 03 05 1f 16 5d 6f ?? ?? ?? 0a 61 0a 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {20 00 01 00 00 0a 03 02 20 00 7a 00 00 04 28 ?? ?? ?? 06 03 04 17 58 20 00 7a 00 00 5d 91 59 06 58 06 5d 0b 03 04 20 00 7a 00 00 5d 07 d2 9c 03 0c 08 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTX_2147818447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTX!MTB"
        threat_id = "2147818447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 05 04 5d 91 03 05 1f 16 5d 28 ?? ?? ?? ?? 61}  //weight: 1, accuracy: Low
        $x_1_2 = "f36d9317da0e" ascii //weight: 1
        $x_1_3 = "4e663fae-91de" ascii //weight: 1
        $x_1_4 = "Oversikt.Propertie" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAK_2147818505_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAK!MTB"
        threat_id = "2147818505"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 0e 04 28 ?? 00 00 06 00 7e ?? 00 00 04 6f ?? 00 00 0a 05 16 03 8e 69 6f ?? 00 00 0a 0a 06 0b 2b 00 07 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "enginepollutionfriendly" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAE_2147818515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAE!MTB"
        threat_id = "2147818515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a d2 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 07 11 07 2d aa}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAF_2147818531_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAF!MTB"
        threat_id = "2147818531"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 11 04 28 ?? 00 00 0a 13 05 11 05 2c 55 11 04 28 ?? 00 00 0a 1f 41 8c ?? 00 00 01 1f 61 8c ?? 00 00 01 28 ?? 00 00 0a 28 ?? 00 00 0a 13 06 11 04 28 ?? 00 00 0a 11 06 28 ?? 00 00 0a da 04 d6 1f 1a 5d 13 07 07 11 06 28 ?? 00 00 0a 11 07 d6 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a 0b 00 2b 10 00 07 11 04 28 ?? 00 00 0a 28 ?? 00 00 0a 0b 00 00 09 17 d6 0d 09 08 6f ?? 00 00 0a fe 04 13 08 11 08 3a}  //weight: 1, accuracy: Low
        $x_1_2 = {11 06 11 10 17 8d ?? 00 00 01 25 16 11 05 11 10 9a 1f 10 28 ?? 00 00 0a 9c 6f ?? 00 00 0a 00 11 10 17 d6 13 10 11 10 11 0f 31 d5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUD_2147818559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUD!MTB"
        threat_id = "2147818559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {db 9a db 9c db b7 db 97 db 87 db 87 db 93 db 87 db 87 db 87 db 87 db 8b db 87 db 87 db 87 db 87 da b5 da b5 da be db 87 db 87 db 92 db ad db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 97}  //weight: 1, accuracy: High
        $x_1_2 = {db 87 db 87 db 87 db 8d db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 8a db b2 db ad db 87 db 87 db 87 db 87 db ad db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 88 db 87 db 87}  //weight: 1, accuracy: High
        $x_1_3 = {87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db 87 db}  //weight: 1, accuracy: High
        $x_1_4 = "i~~n~~v~~o~~k~~e" wide //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DJUF_2147818574_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DJUF!MTB"
        threat_id = "2147818574"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 f4 00 00 0c 2b 13 00 72 ?? ?? ?? 70 07 08 28 ?? ?? ?? 06 0b 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d e2}  //weight: 1, accuracy: Low
        $x_1_2 = "Oversikt" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUG_2147818578_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUG!MTB"
        threat_id = "2147818578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8d 17 00 00 01 25 16 11 07 17 da 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 11 04 11 07 11 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 08 11 05 11 08 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 11 07 17 d6 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = "i~~n~~v~~o~~k~~e" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "StrReverse" ascii //weight: 1
        $x_1_5 = "System.Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESJ_2147818584_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESJ!MTB"
        threat_id = "2147818584"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {58 d5 3e 87 f9 e5 7f 44 6a c9 06 04 07 03 c4 32 75 94 2a 0e a3 09 7d 77 19 dc 87 9a b1 c1 79 70 49 87 3b e3 97 c1 dd ed f0 c0 bc ad 98 f7 6e 1f}  //weight: 1, accuracy: High
        $x_1_2 = {15 1c ee 39 8e ca d8 61 bc e5 9f 1d 3a 29 00 95 ca 6a e4 17 7b f0 d2 69 b4 fa 29 2c ce b7 a1 6f 4b 95 d7 e7 3d 46 1c 86 dc b6 68 3b 5a 67 db d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESK_2147818585_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESK!MTB"
        threat_id = "2147818585"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 02 11 04 91 07 61 06 09 91 61 28 ?? ?? ?? 0a 9c 09 15 2c 15}  //weight: 1, accuracy: Low
        $x_1_2 = {02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 84 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 16}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESN_2147818612_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESN!MTB"
        threat_id = "2147818612"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 06 02 11 06 91 08 18 d6 18 da 61 07 11 07 19 d6 19 da 91 61 b4 9c 11 07}  //weight: 1, accuracy: High
        $x_1_2 = {2b 6e 02 09 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESN_2147818612_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESN!MTB"
        threat_id = "2147818612"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 03 05 1f 16 5d 7e ?? ?? ?? 04 28 ?? ?? ?? 06 61 13 01}  //weight: 1, accuracy: Low
        $x_1_2 = {03 02 20 00 22 00 00 04 7e ?? ?? ?? 04 28 ?? ?? ?? 06 03 04 17 58 20 00 22 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_3 = "$3d6d76ec-407f-47ff-91be-cdc5b728d583" ascii //weight: 1
        $x_1_4 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTW_2147818638_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTW!MTB"
        threat_id = "2147818638"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fb da 81 27 6e df fa d5 e4 59 8e 32 6d 44 76 51 38 ba cc 51 a4 e3 74 60 aa c6 ef 6e a5 37 a4 57 6f bf 0b c9 0e c8 95 de d3 fa 47 1c 71 3b d7 7e 4d}  //weight: 1, accuracy: High
        $x_1_2 = "314CF0B49E5A" ascii //weight: 1
        $x_1_3 = "Fort.dll" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "BlockCopy" ascii //weight: 1
        $x_1_7 = "ToArgb" ascii //weight: 1
        $x_1_8 = "BitConverter" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NTZ_2147818639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NTZ!MTB"
        threat_id = "2147818639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BeginRead" ascii //weight: 1
        $x_1_2 = "@System@.@Reflection@.@Assembly@" ascii //weight: 1
        $x_1_3 = "@@@Load@@@" ascii //weight: 1
        $x_1_4 = "WA1.Resources" ascii //weight: 1
        $x_1_5 = "AsSsMmB" ascii //weight: 1
        $x_1_6 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_7 = "Invoke" ascii //weight: 1
        $x_1_8 = "ComboBoxItem1" ascii //weight: 1
        $x_1_9 = "VS_VERSION_INFO" ascii //weight: 1
        $x_1_10 = "VarFileInfo" ascii //weight: 1
        $x_1_11 = "StringFileInfo" ascii //weight: 1
        $x_1_12 = "GetMethods" ascii //weight: 1
        $x_1_13 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUI_2147818649_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUI!MTB"
        threat_id = "2147818649"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 1d 02 08 09 08 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 56 00 00 00 08 00 00 00 13 00 00 00 30 00 00 00 37 00 00 00 9e 00 00 00 03 00 00 00 0f 00 00 00 13 00 00 00 06 00 00 00 01 00 00 00 0a 00 00 00 01 00 00 00 00 00 ab 04 01 00 00 00 00 00 06}  //weight: 1, accuracy: High
        $x_1_2 = {68 00 6a 00 73 00 72 00 66 00 74 00 74 00 6a 00 73 00 72 00 66 00 70 00 73 00 3a 00 2f 00 6a 00 73 00 72 00 66 00 2f 00 00 09 6a 00 73 00 72 00 66}  //weight: 1, accuracy: High
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "GetDirectories" ascii //weight: 1
        $x_1_5 = "GetTempPath" ascii //weight: 1
        $x_1_6 = "Chrome\\Application\\chrome.#$%" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUJ_2147818650_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUJ!MTB"
        threat_id = "2147818650"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$1ceb4264-6335-4ce1-8eb7-99ad8a1ebed8" ascii //weight: 1
        $x_1_2 = "bostonbeancafe.Resources.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KFH_2147818768_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KFH!MTB"
        threat_id = "2147818768"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 47 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 32 00 20 07 8f fb 0e 0b 17 13 04 d0 68 00 00 01 28 ?? ?? ?? 0a 72 bb e8 01 70 20 00 01 00 00 14 14 17 8d 17 00 00 01 25 16 02 a2 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "Translator" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RCC_2147818773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RCC!MTB"
        threat_id = "2147818773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 09 20 1f 8f fb 0e 0b 00 2b 61 07 20 f1 8e fb 0e fe 01 0d 09 2c 09 20 18 8f fb 0e 0b 00 2b 4c 00 20 07 8f fb 0e 0b 17 13 04 72 6f 0f 00 70 28 ?? ?? ?? 0a 14 72 8d 0f 00 70 1b 8d 17 00 00 01 25 16 72 a7 0f 00 70 a2 25 17 20 00 01 00 00 8c 5d 00 00 01 a2 25 1a 17 8d 17 00 00 01 25 16 02 a2 a2 14 14 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFA_2147818774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFA!MTB"
        threat_id = "2147818774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0b 08 11 08 1f 16 5d 91 61 07 11 0a 91 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: High
        $x_1_2 = "QuanlyNhahang.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFA_2147818774_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFA!MTB"
        threat_id = "2147818774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {62 00 cc 06 59 00 46 06 86 06}  //weight: 1, accuracy: High
        $x_1_2 = "Helper_Classes" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "ComputeHash" ascii //weight: 1
        $x_1_7 = "Jambo" ascii //weight: 1
        $x_1_8 = "Pantole" ascii //weight: 1
        $x_1_9 = "Ozuo" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESP_2147818793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESP!MTB"
        threat_id = "2147818793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "YCzhLWEt4m5uruWvb+/wcGOw6HFocepyabLmM28z7HRttOx1" ascii //weight: 1
        $x_1_2 = "Zv7kP24/2kBbgNhBWgHaQlnC2kNDg9KEXMTfxVkF2EZbhtlH" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESQ_2147818794_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESQ!MTB"
        threat_id = "2147818794"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0a 03 02 ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? 03 04 17 58 ?? ?? ?? ?? ?? 5d 91 ?? ?? ?? ?? ?? 59 06 58 06 5d 0b 03 04 ?? ?? ?? ?? ?? 5d 07 d2 9c 03 0c}  //weight: 1, accuracy: Low
        $x_1_2 = {02 05 04 5d 91 0a 06 03 05 1f 16 5d ?? ?? ?? ?? ?? 61 0b 2b 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESF_2147818840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESF!MTB"
        threat_id = "2147818840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AsSsMmB" wide //weight: 1
        $x_1_2 = "@System@.@Reflection@.@Assembly@" wide //weight: 1
        $x_1_3 = "@@@Load@@@" wide //weight: 1
        $x_1_4 = "Invoke" wide //weight: 1
        $x_1_5 = "GetMethods" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESO_2147818843_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESO!MTB"
        threat_id = "2147818843"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$EDB44351-C76F-4E61-A91C-314CF0B49E5" ascii //weight: 1
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUB_2147818849_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUB!MTB"
        threat_id = "2147818849"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FDSSSSSSSSSSSSW" ascii //weight: 1
        $x_1_2 = "WDCWCFDRR" ascii //weight: 1
        $x_1_3 = {57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 00}  //weight: 1, accuracy: High
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUC_2147818850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUC!MTB"
        threat_id = "2147818850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 ed 06 c7 06 c7 06 c7 06 c7 06 c7 06 ba 06 ec 06 fb 06 ed 06 ba 06 c7 06 fa 06 c7 06 f4 06}  //weight: 1, accuracy: High
        $x_1_2 = {c7 06 d7 06 b1 06 fd 06 c7 06 c7 06 dd 06 d8 06 d3 06 d4 06 d1 06 be 06 d3 06 d8 06 ca 06 ef 06 c8 06 f0 06 c7 06 d7 06 c7 06 c7 06 f1 06 ff 06 c9 06 b6 06 fb 06 fd 06 c7 06 c7 06 dd 06 d9 06 fc 06 f9 06}  //weight: 1, accuracy: High
        $x_1_3 = {00 07 c7 06 c9 06 ba 06 c7 06 d3 06 c7 06 c7 06 fb 06 c7 06 ca 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06 c7 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUH_2147818851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUH!MTB"
        threat_id = "2147818851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {57 ff 03 3e 09 1f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 ?? 01 00 00 ?? 01 00 00 ?? 04 00 00 ?? 0f 00 00 ?? 09 00 00 3c 00 00 00 ?? 03 00 00 ?? 00 00 00 3d 00 00 00 0e 00 00 00 01 00 00 00 15}  //weight: 1, accuracy: Low
        $x_1_2 = {66 00 69 00 6c 00 65 00 3a 00 2f 00 2f 00 2f 00 00 11 4c 00 6f 00 63 00 61 00 74 00 69 00 6f 00 6e 00 00 33 7b 00 31 00 31}  //weight: 1, accuracy: High
        $x_1_3 = "System.Security.Cryptography.AesCryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "GetDelegateForFunctionPointer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUL_2147818866_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUL!MTB"
        threat_id = "2147818866"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3934d3a9-e2d9-450d-ad4c-c25f647bb770" ascii //weight: 1
        $x_1_2 = "APCD.PeopleLibrary.Resources.resources" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUM_2147818895_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUM!MTB"
        threat_id = "2147818895"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 00 07 28 ?? ?? ?? 0a 72 70 01 00 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 06 08 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 03 0d 06 6f ?? 00 00 0a 09 16 09 8e 69 6f ?? 00 00 0a 13 04 de 16}  //weight: 1, accuracy: Low
        $x_1_2 = "Rueuaurslenfzqu.Bporhsjbogngrq" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPD_2147818919_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPD!MTB"
        threat_id = "2147818919"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {32 00 2e 00 35 00 38 00 2e 00 31 00 34 00 39 00 2e 00 32 00 2f 00 [0-64] 2e 00 6a 00 70 00 67 00}  //weight: 1, accuracy: Low
        $x_1_2 = "ToArray" ascii //weight: 1
        $x_1_3 = "WebClient" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPD_2147818919_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPD!MTB"
        threat_id = "2147818919"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "190.123.44.138/943" wide //weight: 1
        $x_1_2 = "Assets" wide //weight: 1
        $x_1_3 = "Rocket.wav" wide //weight: 1
        $x_1_4 = "Circle.png" wide //weight: 1
        $x_1_5 = "CreateInstance" wide //weight: 1
        $x_1_6 = "GetExportedTypes" wide //weight: 1
        $x_1_7 = "Space.jpg" wide //weight: 1
        $x_1_8 = "HttpWebResponse" ascii //weight: 1
        $x_1_9 = "GetRandomNumber" ascii //weight: 1
        $x_1_10 = "Activator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUN_2147818968_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUN!MTB"
        threat_id = "2147818968"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 08 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 11 04 11 08 11 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 09 11 05 11 09 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 11 08 17 d6 13 08 11 08 11 07 31 b7}  //weight: 1, accuracy: Low
        $x_1_2 = {49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65 00 00 0f 53 00 74 00 72 00 69 00 6e 00 67}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCD_2147818988_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCD!MTB"
        threat_id = "2147818988"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0a 91 11 07 58 13 0b 07 11 09 91 13 0c 08 09 1f 16 5d 91 13 0d 11 0c 11 0d 61 13 0e 11 0e 11 0b 59 13 0f 07 11 09 11 0f 11 07 5d d2 9c 09 17 58 0d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESW_2147818997_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESW!MTB"
        threat_id = "2147818997"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 01 00 00 0a 03 04 ?? ?? ?? ?? ?? 03 04 17 58 ?? ?? ?? ?? ?? 5d 91 ?? ?? ?? ?? ?? 59 06 58 06 5d 0b 03 04 ?? ?? ?? ?? ?? 5d 07 d2 9c 03 0c 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {91 0b 07 06 03 1f 16 5d 6f ?? ?? ?? 0a 61 0c 2b 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESX_2147818998_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESX!MTB"
        threat_id = "2147818998"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 06 17 da 17 d6 02 11 06 91 08 1f 0a d6 1f 0a da 61 07 11 07 91 61 b4 9c 11 07 03}  //weight: 1, accuracy: High
        $x_1_2 = {07 02 09 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 26 09 18 d6 0d 09 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUO_2147819030_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUO!MTB"
        threat_id = "2147819030"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 df a2 eb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 bb 00 00 00 57 00 00 00 c4 01 00 00 4c 04 00 00 13 02 00 00 23 00 00 00 3e 02 00 00 21 00 00 00 e2 01 00 00 01 00 00 00 01 00 00 00 95 00 00 00 20}  //weight: 1, accuracy: High
        $x_1_2 = "Run\\FANNY_MOVES\\Turn145.txt" wide //weight: 1
        $x_1_3 = "BatchRunner.Propertie" ascii //weight: 1
        $x_1_4 = "96036dd9dd0e" ascii //weight: 1
        $x_1_5 = "9d475974" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GZD_2147819044_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GZD!MTB"
        threat_id = "2147819044"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 df 8e fb 0e 0b 07 20 e7 8e fb 0e fe 01 0c 08 2c 0c 20 1f 8f fb 0e 0b 00 38 9a 00 00 00 07 20 f1 8e fb 0e fe 01 0d 09 2c 0c 20 18 8f fb 0e 0b 00 38 82 00 00 00 00 20 07 8f fb 0e 0b 17 13 04}  //weight: 1, accuracy: High
        $x_1_2 = "System.Convert" wide //weight: 1
        $x_1_3 = "Fr`o" wide //weight: 1
        $x_1_4 = "m`Bas" wide //weight: 1
        $x_1_5 = "e64`St" wide //weight: 1
        $x_1_6 = "ri`ng" wide //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
        $x_1_9 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MCFA_2147819045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MCFA!MTB"
        threat_id = "2147819045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fe 0c 00 00 fe 0c 01 00 fe 0c 00 00 fe 0c 01 00 91 fe 0c 01 00 61 d2 9c 00 fe 0c 01 00 20 01 00 00 00 58 fe 0e 01 00 fe 0c 01 00 fe 0c 00 00 8e 69 fe 04 fe 0e 02 00 fe 0c 02 00 3a bf ff ff ff}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCE_2147819135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCE!MTB"
        threat_id = "2147819135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {13 08 07 11 08 91 11 06 58 13 09 07 11 07 91 08 09 1f 16 5d 91 13 0a 11 0a 61 11 09 59 13 0b 07 11 07 11 0b 11 06 5d d2 9c 09 17 58 0d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETD_2147819158_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETD!MTB"
        threat_id = "2147819158"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 17 58 ?? ?? ?? ?? ?? 5d 91 28 3f 00 00 0a 59 05 58 05 5d 0a 03 04 ?? ?? ?? ?? ?? 5d 06 d2 9c 03 0b 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {5d 91 0a 06 7e ?? ?? ?? 04 03 1f 16 5d 6f ?? ?? ?? 0a 61 0b 2b 00 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETE_2147819159_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETE!MTB"
        threat_id = "2147819159"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "44CZ5744FTDG477P4B8355" wide //weight: 1
        $x_1_2 = {5d 91 0a 06 7e ?? ?? ?? 04 03 1f 16 5d 6f ?? ?? ?? 0a 61 0b 2b 00 07 2a}  //weight: 1, accuracy: Low
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETF_2147819160_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETF!MTB"
        threat_id = "2147819160"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 da 17 d6 02 11 06 91 08 1f 0a d6 1f 0a da 61 07 ?? ?? ?? ?? ?? 11 07 91 61 b4 9c}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 0c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETF_2147819160_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETF!MTB"
        threat_id = "2147819160"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 da 17 d6 02 11 06 91 08 1f 0a d6 1f 0a da 61 07 74 ?? ?? ?? 1b 11 07 91 61 b4 9c 1d}  //weight: 1, accuracy: Low
        $x_1_2 = {02 02 8e 69 17 da 91 1f 70 61 0c 19}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCF_2147819162_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCF!MTB"
        threat_id = "2147819162"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 11 09 91 13 0c 08 09 1f 16 5d 91 13 0d 11 0c 11 0d 61 13 0e 11 0e 11 0b 59}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUQ_2147819200_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUQ!MTB"
        threat_id = "2147819200"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 03 1f 16 5d 28 ?? ?? ?? ?? 61 0b 08 20}  //weight: 1, accuracy: Low
        $x_1_2 = {06 03 04 17 58 20 00 78 00 00 5d 91 28 ?? 00 00 06 59 05 58 05 5d 0a}  //weight: 1, accuracy: Low
        $x_1_3 = "a0341703dcfe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUR_2147819203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUR!MTB"
        threat_id = "2147819203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 df b6 eb 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 da 00 00 00 6e 00 00 00 17 01 00 00 90 03 00 00 85 01 00 00 23 00 00 00 9b 01 00 00 09}  //weight: 1, accuracy: High
        $x_1_2 = "TFlow.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "VUWUedfdkjljmjnj" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUS_2147819206_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUS!MTB"
        threat_id = "2147819206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 0c 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 11 04 11 0c 11 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 0d 11 05 11 0d 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 11 0c 17 d6 13 0c 11 0c 11 0b 31 b7}  //weight: 1, accuracy: Low
        $x_1_2 = {86 06 2d 00 86 06 2d 00 86 06 2d 00 86 06 2d}  //weight: 1, accuracy: High
        $x_1_3 = "ProgDraw" wide //weight: 1
        $x_1_4 = "Bunifu_TextBox" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WDFA_2147819213_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WDFA!MTB"
        threat_id = "2147819213"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {fe 0c 04 00 fe 0c 06 00 fe 0c 04 00 fe 0c 06 00 91 fe 0c 06 00 61 d2 9c fe 0c 06 00 20 01 00 00 00 58 fe 0e 06 00 fe 0c 06 00 fe 0c 04 00 8e 69 3f cb ff ff ff}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GDC_2147819214_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GDC!MTB"
        threat_id = "2147819214"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 f0 00 00 0c 2b 18 00 7e ?? ?? ?? 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d dd}  //weight: 1, accuracy: Low
        $x_1_2 = "PlinqOnStackOverflow" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GDD_2147819215_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GDD!MTB"
        threat_id = "2147819215"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 f0 00 00 0c 2b 18 00 7e ?? ?? ?? 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d dd}  //weight: 1, accuracy: Low
        $x_1_2 = "TFlow" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LEFA_2147819217_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LEFA!MTB"
        threat_id = "2147819217"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 f0 00 00 0c 2b 16 7e ?? ?? ?? 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d df}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUT_2147819219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUT!MTB"
        threat_id = "2147819219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {40 01 57 55 a2 cb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 a8 00 00 00 18 00 00 00 94 00 00 00 3c 01 00 00 d0 00 00 00 3e 01 00 00 45 02 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = "$5e8ead6b-1c8c-4d7c-bd1f-253bf0933889" ascii //weight: 1
        $x_1_3 = "MULTIJUGADOR" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESL_2147819234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESL!MTB"
        threat_id = "2147819234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 0c 00 00 fe 0c 01 00 93 28 ?? ?? ?? 0a fe 0e 02 00 fe 09 01 00 28 ?? ?? ?? 0a fe 0e 03 00 fe 0c 02 00 fe 0c 03 00 58 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 58 3c 30 00 00 00 fe 0c 02 00 fe 0c 03 00 59 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 58 3e 17 00 00 00 fe 0c 00 00 fe 0c 01 00 fe 0c 02 00 fe 0c 03 00 59 28 ?? ?? ?? 0a 9d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETH_2147819274_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETH!MTB"
        threat_id = "2147819274"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 17 58 ?? ?? ?? ?? ?? 5d 91 59 05 58 05 5d 0a 03 04 ?? ?? ?? ?? ?? 5d 06 d2 9c 03 0b 2b 00}  //weight: 1, accuracy: Low
        $x_1_2 = {5d 91 0a 06 7e ?? ?? ?? 04 03 1f 16 5d 6f ?? ?? ?? 0a 61 0b 2b 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUU_2147819312_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUU!MTB"
        threat_id = "2147819312"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 03 20 00 7e 00 00 5d 91 0a 06 7e}  //weight: 1, accuracy: High
        $x_1_2 = {06 03 04 17 58 20 00 7e 00 00 5d 91 59 05 58 05 5d 0a 03 04 20 00 7e 00 00 5d 06 d2 9c 03 0b 07 2a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUV_2147819395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUV!MTB"
        threat_id = "2147819395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 55 a2 cb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 ac 00 00 00 16 00 00 00 5a 00 00 00 92 00 00 00 7b 00 00 00 43 01 00 00 9a 00 00 00 01 00 00 00 31 00 00 00 08 00 00 00 1d 00 00 00 30}  //weight: 1, accuracy: High
        $x_1_2 = "Basic Molder" wide //weight: 1
        $x_1_3 = "spawnnewobject" wide //weight: 1
        $x_1_4 = "Basic_Commands.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUW_2147819448_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUW!MTB"
        threat_id = "2147819448"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 55 a2 cb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 75 00 00 00 13 00 00 00 97 00 00 00 90 01 00 00 18 01 00 00 c3 00 00 00 d8 02 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = "WindowsApplication1.Resource" ascii //weight: 1
        $x_1_3 = "e9ed1a580003" ascii //weight: 1
        $x_1_4 = "FromBase64String" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EGFA_2147819481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EGFA!MTB"
        threat_id = "2147819481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5a 1f 16 58 0c 2b 18 00 7e 26 00 00 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d dd}  //weight: 1, accuracy: Low
        $x_1_2 = "IODSIFDS" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETK_2147819533_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETK!MTB"
        threat_id = "2147819533"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 07 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 11 04 11 07 11 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 08 11 05 11 08 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05 11 07 17 d6 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = {86 06 2d 00 86 06 2d 00 86 06 2d 00 86 06 2d 00 86}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETL_2147819534_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETL!MTB"
        threat_id = "2147819534"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Gear" wide //weight: 1
        $x_1_2 = "785JHG45457SCA7AS5B497" wide //weight: 1
        $x_1_3 = "DebuggableAttribute" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "GetExportedTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETM_2147819535_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETM!MTB"
        threat_id = "2147819535"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 17 58 7e ?? ?? ?? 04 5d 91 0a 16 0b 03 04 28 ?? ?? ?? 06 0c 06 05 58 0d 08 09 59 05 5d 0b 03 04 7e ?? ?? ?? 04 5d 07 d2 9c 03 13 04 11 04 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {5d 91 0a 06 7e ?? ?? ?? 04 03 1f 16 5d 6f ?? ?? ?? 0a 61 0b 07 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETN_2147819536_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETN!MTB"
        threat_id = "2147819536"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "41G8VHDHH84CCC554DFB55" wide //weight: 1
        $x_1_2 = {5d 91 0a 06 7e ?? ?? ?? 04 03 1f 16 5d 28 ?? ?? ?? 06 61 0b 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUY_2147819589_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUY!MTB"
        threat_id = "2147819589"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 5d 91 0a 06 7e ?? ?? ?? 04 03 1f 16 5d 6f ?? ?? ?? 0a 61 0b 2b 00 07}  //weight: 1, accuracy: Low
        $x_1_2 = {02 03 17 58 7e ?? ?? ?? 04 5d 91 0a 16 0b 17 0c 00 02 03 28 ?? ?? ?? 06 0d 06 04 58 13 04 09 11 04 59 04 5d 0b 00 02 03 7e ?? ?? ?? 04 5d 07 d2 9c 02 13 05 2b 00}  //weight: 1, accuracy: Low
        $x_1_3 = {57 1f a2 09 09 03 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 6b 00 00 00 13 00 00 00 70 00 00 00 9e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUF_2147819624_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUF!MTB"
        threat_id = "2147819624"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 3d a2 1d 09 1f 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = "c:\\temp\\Decrypted.txt" wide //weight: 1
        $x_1_3 = "\\ini\\mod.ini" wide //weight: 1
        $x_1_4 = "\\CoJ2\\Data\\Player\\" wide //weight: 1
        $x_1_5 = "Gunslinger" wide //weight: 1
        $x_1_6 = "AsSsMmB" wide //weight: 1
        $x_1_7 = "@System@.@Reflection@.@Assembly@" wide //weight: 1
        $x_1_8 = "@@@Method0@@@" wide //weight: 1
        $x_1_9 = "\\CoJ2\\ServerAdmins.ini" wide //weight: 1
        $x_1_10 = "\\setup_ModsCoj.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ESY_2147819630_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ESY!MTB"
        threat_id = "2147819630"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$D10B6B1F-021F-4DA0-BFB9-2F253DF67815" ascii //weight: 1
        $x_1_2 = "Substring" ascii //weight: 1
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETQ_2147819665_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETQ!MTB"
        threat_id = "2147819665"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 03 17 58 ?? ?? ?? ?? ?? 5d 91 0a 16 0b 17 0c 00 02 03 28 5d 00 00 06 0d 06 04 58 13 04 09 11 04 59 04 5d 0b 00 02 03 ?? ?? ?? ?? ?? 5d 07 d2 9c 02}  //weight: 1, accuracy: Low
        $x_1_2 = {5d 91 0a 06 ?? ?? ?? ?? ?? 03 1f 16 5d ?? ?? ?? ?? ?? 61 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUX_2147819704_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUX!MTB"
        threat_id = "2147819704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {fe 0c 01 00 fe 0c 00 00 fe 0c 02 00 91 fe 0c 02 00 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 61 d1 fe 0e 03 00 fe 0d 03 00 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a fe 0e 01 00 00 fe 0c 02 00 20 01 00 00 00 58 fe 0e 02 00 fe 0c 02 00 fe 0c 00 00 8e 69 fe 04 fe 0e 04 00 fe 0c 04 00 3a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NUZ_2147819705_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NUZ!MTB"
        threat_id = "2147819705"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 06 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 09 06 09 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 08 07 11 08 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 06 17 d6 0a 06}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETR_2147819734_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETR!MTB"
        threat_id = "2147819734"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "16a94c74-1c71-4ebe-96f1-a8cf368346f3" ascii //weight: 1
        $x_1_2 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETR_2147819734_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETR!MTB"
        threat_id = "2147819734"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 43 6f 6e 73 74 61 6e 74 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 48 61 73 68 74 61 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 6f 72 65 56 69 65 77 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 73 79 6e 63 4c 6f 63 61 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 76 65 6e 74 53 6c 69 6d 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 6f 6e 73 74 72 75 63 74 69 6f 6e 43 61 6c 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 43 6f 6e 74 65 78 74 4d 61 6e 61 67 65 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 64 65 50 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XEFA_2147819757_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XEFA!MTB"
        threat_id = "2147819757"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 fc 00 00 0c 2b 16 7e ?? ?? ?? 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d df}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AFFA_2147819758_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFFA!MTB"
        threat_id = "2147819758"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1e fe 0f e0 38 a8 00 00 00 38 a9 00 00 00 16 54 38 a8 00 00 00 38 ad 00 00 00 38 ae 00 00 00 38 b3 00 00 00 38 b4 00 00 00 1a 58 16 54 38 b1 00 00 00 1a 58 16 54 2b 52 38 ac 00 00 00 06 1a 58 4a 03 8e 69 5d 03 06 1a 58 4a 03 8e 69 5d 91 07 06 1a 58 4a 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 03}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RFFA_2147819762_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RFFA!MTB"
        threat_id = "2147819762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {58 0c 2b 16 7e 4d 00 00 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d df}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WFFA_2147819763_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WFFA!MTB"
        threat_id = "2147819763"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {7e 1d 00 00 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 08 15 58 0c 08 16 fe 04 16 fe 01}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_IAVF_2147819764_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.IAVF!MTB"
        threat_id = "2147819764"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5a 1f 16 58 0c 2b 16 7e 31 00 00 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d df}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PA12_2147819777_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PA12!MTB"
        threat_id = "2147819777"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "https://radio-hit.ro/" ascii //weight: 2
        $x_2_2 = "$b1a1fc08-fa1c-47f8-af3d-1823166091a5" ascii //weight: 2
        $x_1_3 = "Vibiiqzukklmgm" ascii //weight: 1
        $x_1_4 = "BinaryReader" ascii //weight: 1
        $x_1_5 = "GetResponseStream" ascii //weight: 1
        $x_1_6 = "Seaxvgs.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 4 of ($x_1_*))) or
            ((2 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ETV_2147819901_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETV!MTB"
        threat_id = "2147819901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 03 17 58 ?? ?? ?? ?? ?? 5d 91 0a 16 0b 02 03 1f 16 ?? ?? ?? ?? ?? 0c 06 04 58 0d 08 09 59 04 5d 0b 02 03 ?? ?? ?? ?? ?? 5d 07 d2 9c 02}  //weight: 1, accuracy: Low
        $x_1_2 = {5d 91 0a 06 ?? ?? ?? ?? ?? 03 04 5d ?? ?? ?? ?? ?? 61 0b 2b 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETY_2147819915_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETY!MTB"
        threat_id = "2147819915"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 09 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 11 04 11 09 11 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 0a 11 05 11 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 05}  //weight: 10, accuracy: Low
        $x_10_2 = {09 11 09 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 11 04 11 09 11 04 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da}  //weight: 10, accuracy: Low
        $x_1_3 = {86 06 2d 00 86 06 2d 00 86 06 2d 00 86 06 2d 00 86}  //weight: 1, accuracy: High
        $x_1_4 = "String1" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NVA_2147819983_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVA!MTB"
        threat_id = "2147819983"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$291549b5-d09b-425b-8e52-4187f33f6d02" ascii //weight: 1
        $x_1_2 = {50 00 6c 00 61 00 6e 00 74 00 73 00 5f 00 76 00 73 00 2e 00 50 00 72 00 6f 00 70 00 65 00 72 00 74 00 69 00 65 00 73 00 2e 00 52 00 65 00 73 00 6f}  //weight: 1, accuracy: High
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVC_2147819984_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVC!MTB"
        threat_id = "2147819984"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 07 03 6f ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 06 00 09 03 6f ?? ?? ?? 06 03 6f ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 07 28 ?? ?? ?? 0a 6f ?? ?? ?? 06 00 09 02 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 06 00 09 02 28 ?? ?? ?? 06 6f ?? ?? ?? 06 00 09 13 08 2b 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPY_2147820111_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPY!MTB"
        threat_id = "2147820111"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 8d bc 00 00 01 0a 06 16 d0 0b 00 00 1b 28 ?? ?? ?? 0a a2 06 28 ?? ?? ?? 0a 14 17 8d 16 00 00 01 0b 07 16 02 a2 07 6f ?? ?? ?? 0a 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUE_2147820134_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUE!MTB"
        threat_id = "2147820134"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 42 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 43 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 46 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 4f 00}  //weight: 1, accuracy: High
        $x_1_5 = {86 06 45 00 86 06 45 00 86 06 45 00 86 06 45 00 86 06}  //weight: 1, accuracy: High
        $x_1_6 = "Bunifu_TextBox" wide //weight: 1
        $x_1_7 = "GetExportedTypes" ascii //weight: 1
        $x_1_8 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETS_2147820143_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETS!MTB"
        threat_id = "2147820143"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$D10B6B1F-021F-4DA0-BFB9-2F253DF67815" ascii //weight: 1
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 50 69 78 65 6c 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 54 6f 41 72 67 62 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 54 79 70 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETW_2147820144_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETW!MTB"
        threat_id = "2147820144"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 43 72 6f 73 73 43 6f 6e 74 65 78 74 43 68 61 6e 6e 65 6c 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 48 61 73 68 74 61 62 6c 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 41 73 79 6e 63 4c 6f 63 61 6c 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 45 76 65 6e 74 53 6c 69 6d 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 43 6f 6e 73 74 72 75 63 74 69 6f 6e 43 61 6c 6c 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 64 65 50 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ETX_2147820145_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ETX!MTB"
        threat_id = "2147820145"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$2b8ee2f4-4b61-4a1c-a7e4-1286aa1e1d27" ascii //weight: 1
        $x_1_2 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 72 79 70 74 6f 53 74 72 65 61 6d 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 54 6f 49 6e 74 33 32 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVD_2147820219_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVD!MTB"
        threat_id = "2147820219"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 0b 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 b6 00 00 00 18 00 00 00 31 01 00 00 fc 02 00 00 18 02 00 00 75 01 00 00 ca 05 00 00 49 00 00 00 10}  //weight: 1, accuracy: High
        $x_1_2 = "Bunifu_TextBox" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVE_2147820221_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVE!MTB"
        threat_id = "2147820221"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 1d a2 0b 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 68 00 00 00 12 00 00 00 d2 02 00 00 8c 05 00 00 ce 02 00 00 b5 00 00 00 01 00 00 00 b5}  //weight: 1, accuracy: High
        $x_1_2 = "Purvile.Resources.r" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVE_2147820221_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVE!MTB"
        threat_id = "2147820221"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f 38 00 00 0a 25 26 26 11 0a 11 0d 16 06 6f ?? ?? ?? 0a 25 26 11 0e 6a 59 69 6f ?? ?? ?? 0a 25 26 13 10 7e ?? ?? ?? 04 11 10 16 11 10 28 ?? ?? ?? 06 25 26 69 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "BVNBMHJG" ascii //weight: 1
        $x_1_3 = "add_ResourceResolve" ascii //weight: 1
        $x_1_4 = "ProcessInformationClass" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUK_2147820276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUK!MTB"
        threat_id = "2147820276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 45 5f 30 30 30 30 30 30 30 31 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 45 5f 30 30 30 30 30 30 30 32 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 45 5f 30 30 30 30 30 30 30 33 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 45 5f 30 30 30 30 30 30 30 38 00}  //weight: 1, accuracy: High
        $x_1_5 = {86 06 45 00 86 06 45 00 86 06 45 00 86 06 45 00 86 06}  //weight: 1, accuracy: High
        $x_1_6 = "Bunifu_TextBox" wide //weight: 1
        $x_1_7 = "GetExportedTypes" ascii //weight: 1
        $x_1_8 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUL_2147820287_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUL!MTB"
        threat_id = "2147820287"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 0b 00 00 0a 0a 03 8e 69 0b 2b 0b 00 06 07 03 07 91 2b 18 00 2b 0b 07 25 17 59 0b 16 fe 02 0c 2b 03 00 2b f2 08 2d 02 2b 09 2b e0 6f ?? ?? ?? 0a 2b e1 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUL_2147820287_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUL!MTB"
        threat_id = "2147820287"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {53 00 74 00 72 00 00 09 69 00 6e 00 67 00 31}  //weight: 1, accuracy: High
        $x_1_2 = {86 06 45 00 86 06 45 00 86 06 45 00 86 06 45 00 86 06}  //weight: 1, accuracy: High
        $x_1_3 = "Bunifu_TextBox" wide //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FVR_2147820292_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FVR!MTB"
        threat_id = "2147820292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {25 47 02 08 1f 10 5d 91 61 d2 52 00 08 17 d6 0c 08 07 fe 02 16 fe 01 0d 09 2d dd}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIFA_2147820296_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIFA!MTB"
        threat_id = "2147820296"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 20 16 70 01 00 0b 2b 1d 00 06 07 23 00 00 00 00 00 00 f0 40 28 ?? ?? ?? 0a 69 28 ?? ?? ?? 06 0a 00 07 15 58 0b 07 16 fe 04 16 fe 01 0c 08 2d d8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VV_2147820358_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VV!MTB"
        threat_id = "2147820358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {95 58 d2 13 1b 06 11 1b 20 ff 00 00 00 5f 95 d2 13 0f 11 1a 11 0f 61 13 10 11 0a 11 06 d4 11 10 d2 9c 16 13 09 2b 23}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VV_2147820358_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VV!MTB"
        threat_id = "2147820358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "37.0.11.164" ascii //weight: 1
        $x_1_2 = "Renevct_Kmehrfme.png" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "get_Buff" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUV_2147821062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUV!MTB"
        threat_id = "2147821062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "H85H4F8SS54UPR8H454QSZ" wide //weight: 1
        $x_1_2 = "Converter" wide //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUY_2147821376_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUY!MTB"
        threat_id = "2147821376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5D8FHEGGB4GGHF55HA74VC" wide //weight: 1
        $x_1_2 = "Coffee" wide //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVH_2147821811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVH!MTB"
        threat_id = "2147821811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 49 52 65 73 6f 75 72 63 65 57 72 69 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 70 61 73 73 00 74 74 00 69 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 44 65 62 75 67 56 69 65 77 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 4d 73 63 6f 72 6c 69 62 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 4b 65 79 65 64 43 6f 6c 6c 65 63 74 69 6f 6e 00 4f 50 54 53 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 50 69 6e 6e 61 62 6c 65 42 75 66 66 65 72 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 43 6f 64 65 50 61 67 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUD_2147822265_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUD!MTB"
        threat_id = "2147822265"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$d3ab4400-36a4-41ca-8019-eb6a1a410f47" ascii //weight: 1
        $x_1_2 = "Sistema_de_loja" wide //weight: 1
        $x_1_3 = "Bunifu_TextBox" wide //weight: 1
        $x_1_4 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EUN_2147822267_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EUN!MTB"
        threat_id = "2147822267"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$112cf6e1-814e-4344-a183-ada77eb582be" ascii //weight: 1
        $x_1_2 = {00 47 65 74 45 78 70 6f 72 74 65 64 54 79 70 65 73 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 49 6e 76 6f 6b 65 4d 65 6d 62 65 72 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 52 65 73 6f 75 72 63 65 4d 61 6e 61 67 65 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVJ_2147822270_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVJ!MTB"
        threat_id = "2147822270"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$7c0440e5-3b5e-41e7-8252-3a728aad3d89" ascii //weight: 1
        $x_1_2 = {00 47 65 74 54 79 70 65 46 72 6f 6d 48 61 6e 64 6c 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 44 65 62 75 67 67 69 6e 67 4d 6f 64 65 73 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 43 72 65 61 74 65 49 6e 73 74 61 6e 63 65 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 48 49 4e 53 54 41 4e 43 45 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVN_2147822292_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVN!MTB"
        threat_id = "2147822292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0e 04 0b 07 17 2e 06 07 18 2e 0a 2b 2d 02 03 5d 0c 08 0a 2b 25}  //weight: 1, accuracy: High
        $x_1_2 = "ASAMethod0ASA" wide //weight: 1
        $x_1_3 = "KkKMethod0KkK" wide //weight: 1
        $x_1_4 = "GetMethods" wide //weight: 1
        $x_1_5 = "GetTypes" wide //weight: 1
        $x_1_6 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVN_2147822292_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVN!MTB"
        threat_id = "2147822292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$$MLKjclkdsjfklsdfkghfdkhgfhmjlyil$$" wide //weight: 1
        $x_1_2 = "ASAMethod0ASA" wide //weight: 1
        $x_1_3 = "KkKMethod0KkK" wide //weight: 1
        $x_1_4 = "GetMethods" wide //weight: 1
        $x_1_5 = "GetTypes" wide //weight: 1
        $x_1_6 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVQ_2147822436_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVQ!MTB"
        threat_id = "2147822436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4FZT9OS05XPR2G80585SHG" wide //weight: 1
        $x_1_2 = "Queue" wide //weight: 1
        $x_1_3 = "ConstructionCall" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVR_2147822437_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVR!MTB"
        threat_id = "2147822437"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 44 69 63 74 69 6f 6e 61 72 79 45 6e 75 6d 65 72 61 74 6f 72 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 53 74 72 69 6e 67 54 79 70 65 49 6e 66 6f 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 49 6e 70 75 74 42 6c 6f 63 6b 53 69 7a 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 45 73 63 61 70 65 64 49 52 65 6d 6f 74 69 6e 67 46 6f 72 6d 61 74 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 42 69 6e 61 72 79 43 6f 6d 70 61 74 69 62 69 6c 69 74 79 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 4f 70 63 6f 64 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 53 65 61 72 63 68 52 65 73 75 6c 74 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 44 61 74 61 4d 69 73 61 6c 69 67 6e 65 64 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 44 69 72 65 63 74 6f 72 79 49 6e 66 6f 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 45 6e 75 6d 43 61 74 65 67 6f 72 69 65 73 46 6c 61 67 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LMFA_2147822811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LMFA!MTB"
        threat_id = "2147822811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 f8 00 00 0b 2b 11 06 07 20 00 01 00 00 28 ?? ?? ?? 06 0a 07 15 58 0b 07 16 fe 04 16 fe 01 0c 08 2d e4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVS_2147822825_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVS!MTB"
        threat_id = "2147822825"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "E55BU44R2GH44U6FA5A5F4" wide //weight: 1
        $x_1_2 = "XamarinStudio" wide //weight: 1
        $x_1_3 = "ConstructionCall" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EVT_2147822826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EVT!MTB"
        threat_id = "2147822826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 08 6f ?? ?? ?? 0a 13 0b 12 0b 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 16 11 04 09 1a 28 ?? ?? ?? 0a 09 1a 58 0d 08 17 58 0c 08 06 fe 04 13 08 11 08 2d ce}  //weight: 1, accuracy: Low
        $x_1_2 = "ToArgb" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMZZ_2147822959_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMZZ!MTB"
        threat_id = "2147822959"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "lpfsdfAfdsddsadress" ascii //weight: 1
        $x_1_2 = "dwSfsdsaddshize" ascii //weight: 1
        $x_1_3 = "hPfdsfhdsdrodscess" ascii //weight: 1
        $x_1_4 = "lpBasfsdsdfeddfhsAddress" ascii //weight: 1
        $x_1_5 = "lpBfdsdhsdsdsfuffer" ascii //weight: 1
        $x_1_6 = "thrhfdsdsfsdfead" ascii //weight: 1
        $x_1_7 = "hThrehfdfssddfad" ascii //weight: 1
        $x_1_8 = "hTokdsehfdfssdfn" ascii //weight: 1
        $x_1_9 = "lpApplicathfsdfsdsionName" ascii //weight: 1
        $x_1_10 = "lpProcdesdhsAttdsdfsdfributes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EWB_2147823120_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EWB!MTB"
        threat_id = "2147823120"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0e 04 0b 07 17 2e 06 07 18 2e 0a 2b 2d 02 03 5d 0c 08 0a 2b 27}  //weight: 1, accuracy: High
        $x_1_2 = "ASAMethod0ASA" wide //weight: 1
        $x_1_3 = "!M!e!t!h!o!d!0!" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EWD_2147823150_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EWD!MTB"
        threat_id = "2147823150"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 11 06 17 da 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 09 11 06 09 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 07 11 04 11 07 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 06 17 d6 13 06}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = {86 06 20 00 86 06 20 00 86 06 20 00 86 06 20 00 86 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KNY_2147823555_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KNY!MTB"
        threat_id = "2147823555"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {58 20 00 01 00 00 5d 94 13 08 11 07 06 02 06 91 11 08 61 d2 9c 06 17 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KNY_2147823555_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KNY!MTB"
        threat_id = "2147823555"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {58 4a 17 6f 1f 01 00 0a 6f 20 01 00 0a 26 06 1e 58 06 1e 58 4a 17 d6 54 06 1e 58 4a 1f 46 31 cc 11 04 6f 21 01 00 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XI_2147823560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XI!MTB"
        threat_id = "2147823560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "113.212.88.126" ascii //weight: 1
        $x_1_2 = "127.0.0.1" ascii //weight: 1
        $x_1_3 = ".pdb" ascii //weight: 1
        $x_1_4 = "Roaming\\Microsoft\\Windows\\system32" ascii //weight: 1
        $x_1_5 = "system.bin" ascii //weight: 1
        $x_1_6 = "BeginInvoke" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EWF_2147823604_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EWF!MTB"
        threat_id = "2147823604"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$$MLKjclkdsjfklsdfkghfdkhgfhmjlyil$$" wide //weight: 1
        $x_1_2 = "ASAMethod0ASA" wide //weight: 1
        $x_1_3 = "$$NoBodyCanGetIt$$" wide //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
        $x_1_6 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EWJ_2147823810_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EWJ!MTB"
        threat_id = "2147823810"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 06 17 da 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 09 11 06 09 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 da 13 07 11 04 11 07 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 11 06 17 d6 13 06}  //weight: 1, accuracy: Low
        $x_1_2 = {86 06 20 00 86 06 20 00 86 06 20 00 86 06 20 00 86 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SLS_2147824272_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SLS"
        threat_id = "2147824272"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "800"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "System.Reflection" ascii //weight: 1
        $x_1_2 = "System.Runtime.CompilerServices" ascii //weight: 1
        $x_1_3 = "CompilationRelaxationsAttribute" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
        $x_1_5 = "BitConverter" ascii //weight: 1
        $x_1_6 = "BeginInvoke" ascii //weight: 1
        $x_1_7 = "processInformation" ascii //weight: 1
        $x_1_8 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_9 = "add_AssemblyResolve" ascii //weight: 1
        $x_1_10 = "add_ResourceResolve" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JKFA_2147824713_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JKFA!MTB"
        threat_id = "2147824713"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 68 00 00 0b 2b 1d 00 06 07 23 33 33 33 33 33 e3 6f 40 28 ?? ?? ?? 0a 69 28 ?? ?? ?? 06 0a 00 07 15 58 0b 07 16 fe 04 16 fe 01 0c 08 2d d8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZZ_2147824729_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZZ!MTB"
        threat_id = "2147824729"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "   Pi@s.Whit@ " ascii //weight: 10
        $x_1_2 = "ToByte" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZZ_2147824729_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZZ!MTB"
        threat_id = "2147824729"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 0f 00 28 02 00 00 06 [0-9] d0 01 00 00 1b 28 14 00 00 0a 25 26 28 15 00 00 0a 25 26 a5 01 00 00 1b 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {11 00 0f 00 28 [0-19] d0 01 00 00 1b 28 ?? 00 00 0a 28 ?? 00 00 0a 25 26 a5 01 00 00 1b 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_10_3 = "GetDelegateForFunctionPointer" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NZY_2147824731_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZY!MTB"
        threat_id = "2147824731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TVqQ$$$$M$$$$$$$$E$$$$$$$$//8$$$$Lg$$$$$$$$$$$$$$$$$$Q$$$" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZY_2147824731_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZY!MTB"
        threat_id = "2147824731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 07 1c 8d ?? 00 00 01 25 16 72 ?? 01 00 70 a2 25 17 7e ?? 00 00 04 a2 25 18 72 ?? 01 00 70 a2 25 19 7e}  //weight: 1, accuracy: Low
        $x_1_2 = {3f a2 1d 09 02 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 44 00 00 00 0a 00 00 00 0e 00 00 00 24}  //weight: 1, accuracy: High
        $x_1_3 = "\\Temp\\y3iho40m.vbf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXC_2147824961_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXC!MTB"
        threat_id = "2147824961"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 44 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 45 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 46 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 5f 47 00}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GetExportedTypes" ascii //weight: 1
        $x_1_7 = "GetMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VPH_2147825091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VPH!MTB"
        threat_id = "2147825091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {7e 11 00 00 04 73 be 00 00 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 74 0f 00 00 1b 0a 06 28 ?? ?? ?? 06 0b 07 72 ?? ?? ?? 70 28 ?? ?? ?? 06 74 4d 00 00 01 6f ?? ?? ?? 0a 1a 9a 80 10 00 00 04 23 d1 37 b7 3b 43 62 20 40}  //weight: 1, accuracy: Low
        $x_1_2 = "Kalcium" ascii //weight: 1
        $x_1_3 = "IKMNJUHBVGYTFCXDRESZAWQ" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXG_2147825123_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXG!MTB"
        threat_id = "2147825123"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$$MLKjclkdsjfklsdfkghfdkhgfhmjlyil$$" wide //weight: 1
        $x_1_2 = "ASAMethod0ASA" wide //weight: 1
        $x_1_3 = "$$NoBodyCanGetIt$$" wide //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXK_2147825276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXK!MTB"
        threat_id = "2147825276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {42 00 41 00 56 00 41 00 77 00 47 00 41 00 68 00 42 00 77 00 5a 00 41 00 55 00 47 00 41 00 4d 00 42 00 51 00 22 06 45 00 22 06 71 00 22 06 22 06 59 00 44 00 41 00 78 00 22 06 4d 00 41 00 49 00}  //weight: 1, accuracy: High
        $x_1_2 = "nifu_Te" wide //weight: 1
        $x_1_3 = "ToCharArray" wide //weight: 1
        $x_1_4 = {00 46 72 6f 6d 42 61 73 65 36 34 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 56 30 30 30 30 30 30 30 30 30 30 30 30 30 35 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NQFA_2147825430_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NQFA!MTB"
        threat_id = "2147825430"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 03 07 03 28 ?? ?? ?? 06 5d 6f ?? ?? ?? 0a 06 07 91 61 28 ?? ?? ?? 06 9c 00 07 17 58 0b 07 06 8e 69 fe 04 0c 08 2d d6}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXL_2147825468_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXL!MTB"
        threat_id = "2147825468"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 00 04 03 04 5d ?? ?? ?? ?? ?? 61}  //weight: 1, accuracy: Low
        $x_1_2 = {02 03 17 58 ?? ?? ?? ?? ?? 5d 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NH_2147825862_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NH!MTB"
        threat_id = "2147825862"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 7b 16 00 00 04 0a 06 0b 07 03 28 ?? ?? ?? 0a 74 ?? ?? ?? 02 0c 02 7c ?? ?? ?? 04 08 07 28 ?? ?? ?? 2b 0a 06 07 38}  //weight: 5, accuracy: Low
        $x_1_2 = "WriteProcessMemory" ascii //weight: 1
        $x_1_3 = "HuraForm1" ascii //weight: 1
        $x_1_4 = "$b37fd018-fdba-454c-bf3e-e0d6dc1375fc" ascii //weight: 1
        $x_1_5 = "LOGO_COMPLETA_VETORIZADA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NH_2147825862_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NH!MTB"
        threat_id = "2147825862"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$6fa3edb5-8258-49ec-9cbb-e5eee3d0ec57" ascii //weight: 10
        $x_1_2 = "HelperOne.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "rOne.Form1.re" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EXO_2147825887_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXO!MTB"
        threat_id = "2147825887"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 03 66 5f 02 66 03 5f 60}  //weight: 1, accuracy: High
        $x_1_2 = {02 03 5d 0b 07 0a}  //weight: 1, accuracy: High
        $x_1_3 = "@System@.@Reflection@.@Assembly@" wide //weight: 1
        $x_1_4 = "@@@Method0@@@" wide //weight: 1
        $x_1_5 = "AsSsMmB" wide //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "GetType" ascii //weight: 1
        $x_1_8 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXP_2147825888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXP!MTB"
        threat_id = "2147825888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 17 58 20 00 3a 00 00 5d 91 59 11 03 58 11 03 5d 13 01 20 00 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {11 01 11 00 03 1f 16 5d ?? ?? ?? ?? ?? 61 13 02}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OLFA_2147825889_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OLFA!MTB"
        threat_id = "2147825889"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {25 47 06 07 06 8e 69 5d 91 07 1f 63 58 06 8e 69 58 1f 1f 5f 63 d2 61 d2 52 07 17 58 0b 07 02 8e 69 fe 04 0c 08 2d d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZAFF_2147825916_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZAFF!MTB"
        threat_id = "2147825916"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {7e 12 00 00 04 07 08 20 00 01 00 00 28 ?? ?? ?? 06 0b 00 08 15 58 0c 08 16 fe 04 16 fe 01 0d 09 2d dd}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXQ_2147825933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXQ!MTB"
        threat_id = "2147825933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "H8C8Q5854CRGHH5445GQ8G" ascii //weight: 10
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXS_2147825934_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXS!MTB"
        threat_id = "2147825934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$e0350b7b-5392-4759-8231-280ab1ed5ed4" ascii //weight: 10
        $x_10_2 = "$ec6f55e1-1d54-45c5-bfdc-a49fa3cf7f7d" ascii //weight: 10
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EXS_2147825934_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXS!MTB"
        threat_id = "2147825934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CsCewEAAAQggQIAACCuAgAAKAIAACsKEQY" wide //weight: 1
        $x_1_2 = "kAAAAWwAAANAVAAAGJhEFHzSRIPAAAAB+F" wide //weight: 1
        $x_1_3 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXT_2147826124_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXT!MTB"
        threat_id = "2147826124"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "7648H28F5EJ48FFGHU55T6" ascii //weight: 10
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXU_2147826161_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXU!MTB"
        threat_id = "2147826161"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "lBAbAkGAGBAbAEGAuBQaAcGApBgcA8" wide //weight: 1
        $x_1_2 = {41 00 79 00 42 00 77 00 62 00 41 00 63 00 48 00 41 00 6c 00 42 00 51 00 62 00 41 00 45 00 47 00 41 00 79 00 42 00 67 00 52 00 22 06 43 00 41 00 31 00 42 00 67 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 53 74 72 52 65 76 65 72 73 65 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXW_2147826163_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXW!MTB"
        threat_id = "2147826163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0e 04 0b 07 17 2e 06 07 18 2e 0a 2b 2d 02 03 5d 0c 08 0a 2b 27}  //weight: 1, accuracy: High
        $x_1_2 = "MczjfkjOADJofQJFLODJCLXK" wide //weight: 1
        $x_1_3 = "C ksdjgfdslogpojgijdsiaf" wide //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XSFA_2147826447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XSFA!MTB"
        threat_id = "2147826447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 1f 5a 1f 61 6f ?? ?? ?? 0a 0a 7e 69 00 00 04 06 20 00 01 00 00 14 14 17 8d 3f 00 00 01 25 16 02 a2 6f ?? ?? ?? 0a 0b 07 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "ComputeHash" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXY_2147826451_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXY!MTB"
        threat_id = "2147826451"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "7648H28" ascii //weight: 1
        $x_1_2 = "F5EJ48FFGHU55T6" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYB_2147826546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYB!MTB"
        threat_id = "2147826546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "GIT9ERg4Wag4WdyBSZiBCdv5mbhNGItFmcn9mcwBy" wide //weight: 10
        $x_10_2 = {22 06 41 00 51 00 5a 00 41 00 30 00 47 00 41 00 68 00 42 00 67 00 54 00 41 00 77 00 47 00 41 00 68 00 42 00 67 00 62 00 41 00 49 00 48 00 41 00 6c 00 42 00 41 00 64 00 41 00 34 00 47 00 41 00 4a 00 42 00 51 00 22 06 34 00 22 06 38 00 22 06 22 06}  //weight: 10, accuracy: High
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "FromBase64String" wide //weight: 1
        $x_1_5 = "InvokeMember" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NYA_2147826547_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYA!MTB"
        threat_id = "2147826547"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 3f b6 1f 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 05 01 00 00 3d 00 00 00 c4 01 00 00 a9 07 00 00 c2}  //weight: 1, accuracy: High
        $x_1_2 = {02 00 00 04 00 00 00 2e 02 00 00 b4 00 00 00 b0 05 00 00 06 00 00 00 85 00 00 00 03 00 00 00 0c 00 00 00 1f 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYC_2147826832_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYC!MTB"
        threat_id = "2147826832"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {22 06 22 06 22 06 22 06 22 06 22 06 4d 00 41 00 34 00 43 00 41 00 77 00 41 00 67 00 4c 00 41 00 4d 00 44 00 41 00 75 00 41 00}  //weight: 1, accuracy: High
        $x_1_2 = {42 00 75 00 00 0f 6e 00 69 00 66 00 75 00 5f 00 54 00 65 00 00 09 78 00 74 00 42 00 6f 00 00 03 78}  //weight: 1, accuracy: High
        $x_1_3 = {73 00 74 00 65 00 6d 00 00 09 2e 00 43 00 6f 00 6e 00 00 05 76 00 65 00 00 05 72 00 74}  //weight: 1, accuracy: High
        $x_1_4 = {69 00 33 06 6e 00 76 00 33 06 6f 00 6b 00 33 06 65 00}  //weight: 1, accuracy: High
        $x_1_5 = "V000000000000" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYH_2147826837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYH!MTB"
        threat_id = "2147826837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6a3dea0f-0911-4f70-be1c-5c8c4904403a" ascii //weight: 1
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "GetTypes" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UYLL_2147826853_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UYLL!MTB"
        threat_id = "2147826853"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 a1 ce d2 c4 28 ?? ?? ?? 06 07 08 28 ?? ?? ?? 06 0b 08 15 58 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXN_2147826913_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXN!MTB"
        threat_id = "2147826913"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 1f 16 5d 6f ?? ?? ?? 0a 61 13 01}  //weight: 1, accuracy: Low
        $x_1_2 = {02 03 17 58 7e ?? ?? ?? 04 5d 91 13 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EXR_2147826914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXR!MTB"
        threat_id = "2147826914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$EA954B56-B894-4EA6-ACB4-BC1886DFBD74" ascii //weight: 10
        $x_10_2 = "$02C52A16-B242-4990-AF23-F3E574FC217B" ascii //weight: 10
        $x_1_3 = "Egra.dll" ascii //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = {00 47 65 74 54 79 70 65 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 47 65 74 4d 65 74 68 6f 64 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_EXX_2147826915_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EXX!MTB"
        threat_id = "2147826915"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$25d90ba6-d376-4a84-975f-92b286b983fe" ascii //weight: 10
        $x_1_2 = "DebuggableAttribute" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
        $x_1_4 = "CheckRemoteDebuggerPresent" ascii //weight: 1
        $x_1_5 = "VirtualProtect" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYA_2147826916_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYA!MTB"
        threat_id = "2147826916"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 8e 69 1a 5a ?? ?? ?? ?? ?? 0b 06 16 07 16 07 8e 69 ?? ?? ?? ?? ?? 00 07}  //weight: 1, accuracy: Low
        $x_1_2 = "Justin Timberlake" wide //weight: 1
        $x_1_3 = "get_Chars" wide //weight: 1
        $x_1_4 = "get_Length" wide //weight: 1
        $x_1_5 = "FromBase64String" wide //weight: 1
        $x_1_6 = "GetString" wide //weight: 1
        $x_1_7 = "Decrypt" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FRXF_2147826917_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FRXF!MTB"
        threat_id = "2147826917"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 8d 19 00 00 01 25 16 07 a2 25 0c 14 14 17 8d 73 00 00 01 25 16 17 9c 25 0d 28 ?? ?? ?? 0a 09 16 91 2d 02 2b 09 08 16 9a 28 ?? ?? ?? 0a 0b 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26 07 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "Fr0mBase64String" wide //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "System.C0nvert" wide //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "Concat" ascii //weight: 1
        $x_1_8 = "Bu" wide //weight: 1
        $x_1_9 = "nifu_Te" wide //weight: 1
        $x_1_10 = "xtBo" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYG_2147826947_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYG!MTB"
        threat_id = "2147826947"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 45 6e 75 6d 43 61 74 65 67 6f 72 69 65 73 46 6c 61 67 73 00}  //weight: 1, accuracy: High
        $x_1_2 = {00 44 61 74 61 4d 69 73 61 6c 69 67 6e 65 64 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 44 69 72 65 63 74 6f 72 79 49 6e 66 6f 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 4c 6f 6e 67 50 61 74 68 44 69 72 65 63 74 6f 72 79 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 53 74 72 69 6e 67 54 79 70 65 49 6e 66 6f 00}  //weight: 1, accuracy: High
        $x_1_6 = {00 49 6e 70 75 74 42 6c 6f 63 6b 53 69 7a 65 00}  //weight: 1, accuracy: High
        $x_1_7 = {00 45 73 63 61 70 65 64 49 52 65 6d 6f 74 69 6e 67 46 6f 72 6d 61 74 74 65 72 00}  //weight: 1, accuracy: High
        $x_1_8 = {00 70 72 6f 6a 65 63 74 6e 61 6d 65 00}  //weight: 1, accuracy: High
        $x_1_9 = {00 54 75 63 73 6f 6e 00}  //weight: 1, accuracy: High
        $x_1_10 = {00 50 61 72 65 74 68 65 72 66 6c 65 6e 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_OSXF_2147827062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.OSXF!MTB"
        threat_id = "2147827062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 8d 19 00 00 01 25 16 07 a2 25 0c 14 14 17 8d 77 00 00 01 25 16 17 9c 25 0d 28 ?? ?? ?? 0a 09 16 91 2d 02 2b 09 08 16 9a 28 ?? ?? ?? 0a 0b 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26 07 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "Fr0mBase64String" wide //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "System.C0nvert" wide //weight: 1
        $x_1_6 = "GetMethod" ascii //weight: 1
        $x_1_7 = "V00000000000003" ascii //weight: 1
        $x_1_8 = "OS20003" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYH_2147827077_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYH!MTB"
        threat_id = "2147827077"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 06 08 06 8e 69 5d 91 ?? ?? ?? ?? ?? 08 91 61 d2 9c 00 08 17 58 0c 08 ?? ?? ?? ?? ?? 8e 69 fe 04 0d 09 2d d9}  //weight: 1, accuracy: Low
        $x_1_2 = {00 54 6f 43 68 61 72 41 72 72 61 79 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 46 72 6f 6d 42 61 73 65 36 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYI_2147827078_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYI!MTB"
        threat_id = "2147827078"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ZOo0Ho5qHCVdJhcjIjwqNzNYciAqJiNbIRcxNXM/MDwVOy1r" ascii //weight: 1
        $x_1_2 = "UwFVcv59OzHpVWUKThEypBWJxGjVigHilt4UEGLZ+5fYvyn9" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYK_2147827080_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYK!MTB"
        threat_id = "2147827080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "I~~~K~Cpi~gQoLg~~Bg~~~gN9~g~" wide //weight: 1
        $x_1_2 = "TM~I~DQ~~~~M~~BE~~gMoGQ~~Cg" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MW_2147827125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MW!MTB"
        threat_id = "2147827125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 ff a2 ff 09 0e 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 9b 00 00 00 72 00 00 00 79 02 00 00 c5 04 00 00 7c}  //weight: 10, accuracy: High
        $x_1_2 = "embedder_download_data" ascii //weight: 1
        $x_1_3 = "timePasswordChanged" ascii //weight: 1
        $x_1_4 = "CookiesNotFound" ascii //weight: 1
        $x_1_5 = "encryptedPassword" ascii //weight: 1
        $x_1_6 = "DownloadFile" ascii //weight: 1
        $x_1_7 = "set_UseZip64WhenSaving" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYE_2147827129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYE!MTB"
        threat_id = "2147827129"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 00 01 00 00 13 00 38 00 00 00 00 03 04 28 1f 00 00 06 03 04 17 58 20 00 3a 00 00 5d 91 59 11 00 58 11 00 5d 13}  //weight: 1, accuracy: High
        $x_1_2 = "$8e21f76f-d2a0-482f-92f2-5f4684d169e3" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYJ_2147827130_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYJ!MTB"
        threat_id = "2147827130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 06 5d 0d 03 11 04 9a 0b 03 11 04 03 09 9a a2 03 09 07 a2 00 11 04 17 58 13 04 11 04 06 fe 02 16 fe 01 13 05 11 05 2d d1}  //weight: 1, accuracy: High
        $x_1_2 = {1f a2 0b 09 03 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a8 00 00 00 33 00 00 00 4c 01 00 00 79}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYJ_2147827130_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYJ!MTB"
        threat_id = "2147827130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fffffffdhsdhsdhshdfhfsdffffff" ascii //weight: 1
        $x_1_2 = "ffassfsddhsdfhdffsdff" ascii //weight: 1
        $x_1_3 = "faffffgffffff ssssssssssssssss" ascii //weight: 1
        $x_1_4 = "adsssssssssssa" ascii //weight: 1
        $x_1_5 = "C:\\NewhTemp" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYJ_2147827130_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYJ!MTB"
        threat_id = "2147827130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 cf 8e fb 0e 13 1a 11 1a 20 0d 8f fb 0e fe 02 13 54 11 54 2c 09 20 cf 8e fb 0e 13 1a 2b 1d 11 1a 20 10 8f fb 0e fe 02 16 fe 01 13 55 11 55 2c 08 11 1a 17 58 13 1a 2b 03 16 13 1a 20 dc 8e fb 0e 13 1b 11 1b 20 c0 8e fb 0e fe 02 13 56 11 56}  //weight: 1, accuracy: High
        $x_1_2 = "CompilationRelaxations" ascii //weight: 1
        $x_1_3 = "CategoryMembership" ascii //weight: 1
        $x_1_4 = "CompressionMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EYM_2147827197_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EYM!MTB"
        threat_id = "2147827197"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {55 00 57 00 44 00 52 00 45 00 4c 00 48 00 78 00 65 00 55 00 49 00 42 00 56 00 70 00 22 06 42 00 5a 00 45 00 77 00 6b 00 34 00 75 00 66 00 37 00}  //weight: 1, accuracy: High
        $x_1_2 = {77 00 73 00 34 00 66 00 2f 00 2f 00 2f 00 2f 00 33 00 4d 00 47 00 41 00 22 06 4b 00 43 00 67 00 49 00 67 00 70 00 67 00 49 00 22 06 43 00 44 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABK_2147827403_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABK!MTB"
        threat_id = "2147827403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 18 5d 3a 09 00 00 00 06 02 58 0a 38 04 00 00 00 06 02 59 0a 07 17 58 0b 07 03 32 e3}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABK_2147827403_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABK!MTB"
        threat_id = "2147827403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 03 11 07 11 0a 11 0d 94 91 6f 41 00 00 0a 00 11 0b 11 0d 58 13 0b 00 11 0d 17 58 13 0d 11 0d 11 0c fe 04 13 0e 11 0e 2d d6}  //weight: 2, accuracy: High
        $x_2_2 = "System_CoreInfo.Properties.Resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABK_2147827403_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABK!MTB"
        threat_id = "2147827403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 28 00 00 0a 0a 06 03 16 03 8e 69 6f ?? 00 00 0a 00 06 6f 2a 00 00 0a 00 00 de 05}  //weight: 2, accuracy: Low
        $x_1_2 = "socketprograming.Resource1" ascii //weight: 1
        $x_1_3 = "c348339d-1424-445f-af35-91ba3a034c8e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABK_2147827403_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABK!MTB"
        threat_id = "2147827403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 08 2a 28 0a ?? ?? 06 2b f6 28 05 ?? ?? 06 2b f1 18 00 72 13 ?? ?? 70 2b 03}  //weight: 1, accuracy: Low
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = "MemoryStream" ascii //weight: 1
        $x_1_4 = "CompressionMode" ascii //weight: 1
        $x_1_5 = "CreateDelegate" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYF_2147827605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYF!MTB"
        threat_id = "2147827605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 b5 a2 3f 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 4b 00 00 00 28 00 00 00 57 00 00 00 8a 00 00 00 cd 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {6a 00 00 00 18 00 00 00 03 00 00 00 04 00 00 00 1a 00 00 00 02 00 00 00 03 00 00 00 04 00 00 00 01 00 00 00 01 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYI_2147827606_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYI!MTB"
        threat_id = "2147827606"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 05 11 05 16 fe 02 13 06 11 06 2c 0e 00 11 04 09 16 11 05 6f ?? ?? ?? 0a 00 00 00 11 05 16 fe 02 13 07 11 07 2d cb}  //weight: 1, accuracy: Low
        $x_1_2 = "$e98e49bc-f213-413b-bc90-dc55cdce46c3" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYK_2147827609_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYK!MTB"
        threat_id = "2147827609"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 2c 00 00 0a 0a 73 2d 00 00 0a 0b 06 16 73 2e 00 00 0a 73 2f 00 00 0a 0c 08 07 6f 30 00 00 0a de 0a}  //weight: 1, accuracy: High
        $x_1_2 = {57 95 b6 21 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 38 00 00 00 0a 00 00 00 08 00 00 00 19 00 00 00 0d 00 00 00 39 00 00 00 20 00 00 00 01 00 00 00 05 00 00 00 01 00 00 00 02 00 00 00 02}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BH_2147827615_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BH!MTB"
        threat_id = "2147827615"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 09 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 59 00 00 00 0e 00 00 00 14 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "taskkill /f /IM syskey.exe >nul" wide //weight: 1
        $x_1_3 = "svchost.Form1.resources" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MUFA_2147827682_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MUFA!MTB"
        threat_id = "2147827682"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 06 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 07 91 73 ?? ?? ?? 0a 0c 28 ?? ?? ?? 06 07 08 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 9c 00 07 17 58 0b 07 28 ?? ?? ?? 06 8e 69 fe 04 0d 09 2d b8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABW_2147827748_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABW!MTB"
        threat_id = "2147827748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 1f 0a 00 00 95 2e 03 16 2b 01 17 7e 25 00 00 04 20 f0 09 00 00 95 5a 7e 25 00 00 04 20 35 0d 00 00 95 58 61 80 26 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABW_2147827748_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABW!MTB"
        threat_id = "2147827748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {1f 28 28 38 ?? ?? 0a 0c 08 72 7d ?? ?? 70 28 ?? ?? ?? 0a 0d 09 28 ?? ?? ?? 0a 16 fe 01 13 09 11 09 3a ?? ?? ?? 00 00 09 28 ?? ?? ?? 0a 16 9a 0d 09 09}  //weight: 4, accuracy: Low
        $x_1_2 = "GetDirectories" ascii //weight: 1
        $x_1_3 = "SmtpClient" ascii //weight: 1
        $x_1_4 = "NetworkCredential" ascii //weight: 1
        $x_1_5 = "FireFix" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABW_2147827748_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABW!MTB"
        threat_id = "2147827748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0d 2b 31 00 07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 00 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c5}  //weight: 5, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "NetworkArithmeticGame.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABW_2147827748_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABW!MTB"
        threat_id = "2147827748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {06 07 16 20 00 ?? ?? 00 6f 8c ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 00 08 07 16 09 6f 8d ?? ?? 0a 00 00 00 09 16 fe 02 13 05 11 05 2d d0 08 6f 8e ?? ?? 0a 13 06 de 16}  //weight: 3, accuracy: Low
        $x_1_2 = "GZipStream" ascii //weight: 1
        $x_1_3 = "MemoryStream" ascii //weight: 1
        $x_1_4 = "DecompressGZip" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
        $x_1_6 = "GetEnumerator" ascii //weight: 1
        $x_1_7 = "DebuggingModes" ascii //weight: 1
        $x_1_8 = "bytesToDecompress" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYL_2147827821_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYL!MTB"
        threat_id = "2147827821"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$a47fa15e-e997-4e96-9329-8bcea48ec378" ascii //weight: 10
        $x_10_2 = "$98ec7af9-bfad-4fa7-ab9b-4eac5102c9f3" ascii //weight: 10
        $x_1_3 = "GetObject" ascii //weight: 1
        $x_1_4 = "GZipStream" ascii //weight: 1
        $x_1_5 = "CompressionMode" ascii //weight: 1
        $x_1_6 = "GetTypes" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NYL_2147827821_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYL!MTB"
        threat_id = "2147827821"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {05 00 00 73 02 00 00 43 0c 00 00 09 00 00 00 01 00 00 00 02 00 00 00 73 00 00 00 0d 00 00 00 1b 03 00 00 13 06}  //weight: 1, accuracy: High
        $x_1_2 = {57 f5 a2 ff 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 02 01 00 00 22 00 00 00 7a 03 00 00 82 0b 00 00 f2}  //weight: 1, accuracy: High
        $x_1_3 = {91 32 e9 87 8d e5 88 b6 e5 bc 95 e5 af bc e5 99 a8 2e 52 65 73 6f 75 72 63 65 73 2e 72 65 73 6f 75 72 63 65 73}  //weight: 1, accuracy: High
        $x_1_4 = "$f533ee75-cd4a-455e-8996-2ce565885d2c" ascii //weight: 1
        $x_1_5 = "ConfuserEx v1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYM_2147827850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYM!MTB"
        threat_id = "2147827850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fdsffffhhhhhhhhhhhhhhhhhhhhhhhhdffsdf" wide //weight: 1
        $x_1_2 = "adsssssssssssa" wide //weight: 1
        $x_1_3 = "C:\\NewhTemp" wide //weight: 1
        $x_1_4 = "C:\\Themp" wide //weight: 1
        $x_1_5 = "/home/janhbodnar/" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYQ_2147828074_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYQ!MTB"
        threat_id = "2147828074"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 9f b6 3f 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 d5 00 00 00 33 00 00 00 31 01 00 00 6c 05 00 00 be 02 00 00 01 00 00 00 f1 01 00 00 29 00 00 00 b5 02}  //weight: 1, accuracy: High
        $x_1_2 = {58 4a fc 59 23 19 14 4c 93 79 36 e2 6a f3 a0 01 00 16 01 00 11 43 6f 6e 66 75 73 65 72 45 78 20 76 31 2e}  //weight: 1, accuracy: High
        $x_1_3 = "$24773ec9-4205-437a-8478-c7c1a53b1d4e" ascii //weight: 1
        $x_1_4 = "WLPX_HACK_PRO.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EWFA_2147828291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EWFA!MTB"
        threat_id = "2147828291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 d4 00 00 0a 0b 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 73 d8 00 00 0a 0d 09 08 6f ?? ?? ?? 0a 00 09 18 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 06 16 06 8e 69 6f ?? ?? ?? 0a 13 04 11 04 17 28 ?? ?? ?? 06 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 1f 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "ComputeHash" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYN_2147828354_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYN!MTB"
        threat_id = "2147828354"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$2e02a4b9-2c06-4ff0-bfcb-dda857cbe7e1" ascii //weight: 1
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYN_2147828354_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYN!MTB"
        threat_id = "2147828354"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 0b 07 16 fe 02 13 06 11 06 2c 2e 06}  //weight: 1, accuracy: Low
        $x_1_2 = {17 02 1e 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 af 00 00 00 40 00 00 00 bd 00 00 00 55 01 00 00 20 01 00 00 12 00 00 00 6a 01 00 00 58}  //weight: 1, accuracy: High
        $x_1_3 = "$43819014-ba3b-4639-82cf-d3b7b09420f8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYO_2147828355_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYO!MTB"
        threat_id = "2147828355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$88f81b66-5bec-4e59-862a-1dbf0d7b9005" ascii //weight: 1
        $x_1_2 = {15 b6 0b 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 92 00 00 00 13}  //weight: 1, accuracy: High
        $x_1_3 = "Girlfriend_Is_Horny_Step_11" ascii //weight: 1
        $x_1_4 = "DSHSADJUFAHGYF XUYFG" ascii //weight: 1
        $x_1_5 = "Buni1fu_Te1xtB1ox" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYO_2147828355_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYO!MTB"
        threat_id = "2147828355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 b5 a2 3f 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 4b 00 00 00 28 00 00 00 55 00 00 00 8a 00 00 00 cc 00 00 00 6a 00 00 00 19 00 00 00 03 00 00 00 04 00 00 00 1c 00 00 00 02 00 00 00 03 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_2 = "DeflateStream" ascii //weight: 1
        $x_1_3 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_4 = "FDFDKLFDKDFLKERERRGDFDF" ascii //weight: 1
        $x_1_5 = "Confuser.Core 1.6.0+447341964f" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYP_2147828356_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYP!MTB"
        threat_id = "2147828356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WHGDFHKDLHDJD.dll" ascii //weight: 1
        $x_1_2 = "Wow64GetThreadContext" ascii //weight: 1
        $x_1_3 = "WriteProcessMemory" ascii //weight: 1
        $x_1_4 = "UnmapViewOfSection" ascii //weight: 1
        $x_1_5 = "VirtualAllocEx" ascii //weight: 1
        $x_1_6 = "ResumeThread" ascii //weight: 1
        $x_1_7 = "c2065d8b7cbc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYP_2147828356_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYP!MTB"
        threat_id = "2147828356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 00 69 00 6e 00 64 00 6f 00 77 00 31 00 2e 00 78 00 61 00 6d 00 6c 00 00 57 43 00 61 00 6e 00 6e 00 6f 00 74 00 20 00 6f 00 70 00 65}  //weight: 1, accuracy: High
        $x_1_2 = {17 b6 0b 09 1f 00 00 00 fa 01 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_3 = {30 00 22 00 31 00 23 00 33 00 24 00 36 00 25 00 39 00 26 00 3a 00 29 00 3b}  //weight: 1, accuracy: High
        $x_1_4 = "RS55Q74D7H7GH" ascii //weight: 1
        $x_1_5 = "GetObject" ascii //weight: 1
        $x_1_6 = "System.Design.Diagram.QM.r" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RTS_2147828420_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RTS!MTB"
        threat_id = "2147828420"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {19 8d 18 00 00 01 25 16 72 01 00 00 70 28 16 00 00 0a 73 17 00 00 0a a2 25 17 72 13 00 00 70 28 16 00 00 0a 73 17 00 00 0a a2 25 18 72 21 00 00 70}  //weight: 2, accuracy: High
        $x_1_2 = "sEOq.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_THS_2147828532_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.THS!MTB"
        threat_id = "2147828532"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0d 09 09 47 02 08 1f 10 5d 91 61 d2 52}  //weight: 1, accuracy: High
        $x_1_2 = {08 17 d6 0c 08 07}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ATT_2147828535_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATT!MTB"
        threat_id = "2147828535"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {18 19 8d 17 00 00 01 25 16 09 a2 25 17 16 8c ?? ?? ?? 01 a2 25 18 11 05 8c ?? ?? ?? 01 a2 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "GZipStream" ascii //weight: 1
        $x_1_6 = "CompressionMode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_QG_2147828575_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.QG!MTB"
        threat_id = "2147828575"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 02 11 03 11 01 11 03 11 01 8e 69 5d 91 11 00 11 03 91 61 d2 9c}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_QH_2147828653_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.QH!MTB"
        threat_id = "2147828653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 08 07 08 07 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 06 08 91 61 d2 9c 00 08 17 58 0c 08 06 8e 69 fe 04 0d 09 2d}  //weight: 10, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYW_2147828683_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYW!MTB"
        threat_id = "2147828683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 30 06 4d 00 30 06 30 06 45 00 30 06 30 06 2f 00 2f 00 38 00 30 06 4c 00 67 00 41 00}  //weight: 1, accuracy: High
        $x_1_2 = {6f 00 59 00 45 00 77 00 67 00 52 00 43 00 45 00 55 00 49 00 30 06 30 06 44 00 67 00 45 00 30 06 43 00 45 00 41 00 30 06 30 06 30 06 30 06 71 00}  //weight: 1, accuracy: High
        $x_1_3 = {41 00 42 00 6c 00 41 00 47 00 34 00 41 00 59 00 51 00 42 00 74 00 41 00 47 00 55 00 41 00 30 06 42 00 43 00}  //weight: 1, accuracy: High
        $x_1_4 = "Buni555fu_Te5555xtB555ox" ascii //weight: 1
        $x_1_5 = "Alpha.Beta" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYV_2147828689_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYV!MTB"
        threat_id = "2147828689"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$A94802F8-7A7E-4D48-836E-0530449AF533" ascii //weight: 1
        $x_1_2 = "RijndaelManaged" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "KoenigseggCCX.Properties.Resources.resource" ascii //weight: 1
        $x_1_5 = "GetDelegateForFunctionPointer" ascii //weight: 1
        $x_1_6 = {57 bf a2 3d 09 0f 00 00 00 00 00 00 00 00 00 00 01 00 00 00 f4 00 00 00 3d 00 00 00 f3}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ATS_2147828738_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATS!MTB"
        threat_id = "2147828738"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 52 a8 00 70 17 8d 17 00 00 01 25 16 07 a2 25 0c 14 14 17 8d 88 00 00 01 25 16 17 9c 25 0d 28 ?? ?? ?? 0a 09 16 91 2d 02 2b 09 08 16 9a 28 ?? ?? ?? 0a 0b 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 26 07 28 ?? ?? ?? 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "ToCharArray" wide //weight: 1
        $x_1_3 = "FromBase64CharArray" ascii //weight: 1
        $x_1_4 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEE_2147828744_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEE!MTB"
        threat_id = "2147828744"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {da 17 d6 8d 15 00 00 01 13 05 02 02 8e b7 17 da 91 0a 28 ?? 00 00 0a 72 ?? 00 00 70 6f ?? 00 00 0a 0c 12 05}  //weight: 5, accuracy: Low
        $x_1_2 = "ADIn.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEE_2147828744_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEE!MTB"
        threat_id = "2147828744"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "26"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "MJCKVKLUIOR" ascii //weight: 5
        $x_5_2 = "NMCXNCNMXCNXCMFDKLFDFDKLF" ascii //weight: 5
        $x_5_3 = "CXCCXHJCXCYUXYU" ascii //weight: 5
        $x_5_4 = "Confuser.Core 1.6.0" ascii //weight: 5
        $x_5_5 = "v4.0.30319" ascii //weight: 5
        $x_1_6 = "&GRAPHICRATING-KOLORIA" wide //weight: 1
        $x_1_7 = "+%&oA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_5_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NEF_2147828745_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEF!MTB"
        threat_id = "2147828745"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "X l.dlT" ascii //weight: 1
        $x_1_2 = "Vjsofo.exe" ascii //weight: 1
        $x_1_3 = "goas.exe" wide //weight: 1
        $x_1_4 = "040904B0" wide //weight: 1
        $x_1_5 = "Goasdo" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEG_2147828746_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEG!MTB"
        threat_id = "2147828746"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 9a 13 04 06 07 11 04 1d 28 ?? 00 00 0a 9c 07 17 58 0b 09 17 58 0d 09 08 8e 69}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEH_2147828749_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEH!MTB"
        threat_id = "2147828749"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "1f676c76-80e1-4239-95bb-83d0f6d0da78" ascii //weight: 1
        $x_1_2 = "fhddsdshfddfhhs" ascii //weight: 1
        $x_1_3 = "sdgfssfhsahfdp" ascii //weight: 1
        $x_1_4 = "gjjjjjsfjdjjjd" ascii //weight: 1
        $x_1_5 = "JR.Inno.Setup" ascii //weight: 1
        $x_1_6 = "ObfuscatedByGoliath" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_YUH_2147828888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.YUH!MTB"
        threat_id = "2147828888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0b 07 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 09 08 6f ?? ?? ?? 0a 00 09 18 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 06 16 06 8e 69 6f ?? ?? ?? 0a 13 04 17 13 06 12 06 28 ?? ?? ?? 0a}  //weight: 2, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "ComputeHash" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
        $x_1_6 = "H4FZTGCX87X48BF74GB588" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEI_2147828928_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEI!MTB"
        threat_id = "2147828928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 00 0a 16 9a 72 ?? 05 00 70 18 17 8d ?? 00 00 01 25 16 02 a2 28 ?? 00 00 0a 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAGA_2147828940_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAGA!MTB"
        threat_id = "2147828940"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0b 07 72 ?? ?? ?? 70 28 ?? ?? ?? 06 74 ?? ?? ?? 1b 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 09 08 6f ?? ?? ?? 0a 00 09 18 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 06 16 06 8e 69 6f ?? ?? ?? 0a 13 04 11 04 02 28 ?? ?? ?? 06 28 ?? ?? ?? 06 6f ?? ?? ?? 0a}  //weight: 2, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "FR57AHQY8DBFBA54DG45Y5" wide //weight: 1
        $x_1_5 = "ComputeHash" ascii //weight: 1
        $x_1_6 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BZFA_2147828947_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BZFA!MTB"
        threat_id = "2147828947"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 09 07 09 07 6f ?? ?? ?? 0a 5d 6f ?? ?? ?? 0a 06 09 91 61 d2 9c 00 09 17 58 0d 09 06 8e 69}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMMQ_2147829249_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMMQ!MTB"
        threat_id = "2147829249"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TransformFinalBlock" ascii //weight: 1
        $x_1_2 = "GetObject" ascii //weight: 1
        $x_1_3 = "ComputeHash" ascii //weight: 1
        $x_1_4 = "ConstArray" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "ZeroOrMinus" ascii //weight: 1
        $x_1_7 = "MulticastSupport" ascii //weight: 1
        $x_1_8 = "8f554f54-ef93-401c-a74f-2af23d7ba65c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABS_2147829261_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABS!MTB"
        threat_id = "2147829261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 05 11 09 8f ?? ?? ?? 01 25 47 11 08 61 d2 52 11 05 11 09 91 13 08 00 11 09 17 58 13 09 11 09 11 05 8e 69 fe 04 13 0a 11 0a 2d d3}  //weight: 10, accuracy: Low
        $x_1_2 = "get_encrypted" ascii //weight: 1
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABS_2147829261_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABS!MTB"
        threat_id = "2147829261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 e0 11 0b 13 0b 95 2d 03 16 2b 01 17 17 59 7e 1d 00 00 04 19 9a 20 f4 03 00 00 95 5f 7e 1d 00 00 04 19 06 0a 9a 20 73 02 00 00 95 61 58 81 05 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {58 7e 0e 00 00 04 35 03 16 2b 01 17 17 59 7e 19 00 00 04 19 9a 20 13 05 00 00 95 5f 7e 19 00 00 04 19 9a 20 16 05 00 00 95 61 58 81 06 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABS_2147829261_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABS!MTB"
        threat_id = "2147829261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2e 00 72 00 00 05 65 00 73 00 00 05 6f 00 75 00 00 05 72 00 63 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_3 = "VMNVIJSF" ascii //weight: 1
        $x_1_4 = "@DFSFEHGHHDT@fse3" ascii //weight: 1
        $x_1_5 = "9999S9999y999s9t9e9m9" ascii //weight: 1
        $x_1_6 = "999999999R9e9f9l9e9c9t9i9o9n9" ascii //weight: 1
        $x_1_7 = "9999999999999999999As9s9e9m9b9l9y9" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYZ_2147829279_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYZ!MTB"
        threat_id = "2147829279"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ec8e0c29-496c-4f8a-b4fe-a956f06c254f" ascii //weight: 1
        $x_1_2 = {57 95 a2 2b 09 1f 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYY_2147829280_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYY!MTB"
        threat_id = "2147829280"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 05 11 05 16 fe 02 13 06 11 06 2c 0e 00 11 04 09 16 11 05 6f ?? ?? ?? 0a 00 00 00 11 05}  //weight: 1, accuracy: Low
        $x_1_2 = "$23b5f191-513a-454f-bbbe-e8c1502ac717" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYX_2147829281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYX!MTB"
        threat_id = "2147829281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BD_Olympiads.Properties.Resource" ascii //weight: 1
        $x_1_2 = "bindingNavigatorMoveNextItem" wide //weight: 1
        $x_1_3 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "$b096716e-ed0f-4dd3-90ce-148681345cbf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYS_2147829289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYS!MTB"
        threat_id = "2147829289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5ZT448H8UD5JJG9ZBG" ascii //weight: 1
        $x_1_2 = "Lt.LE" ascii //weight: 1
        $x_1_3 = "Lira" ascii //weight: 1
        $x_1_4 = "GetObject" ascii //weight: 1
        $x_1_5 = "DZ5B" ascii //weight: 1
        $x_1_6 = "ConstArray" ascii //weight: 1
        $x_1_7 = "ZeroOrMinus" ascii //weight: 1
        $x_1_8 = "MulticastSupport" ascii //weight: 1
        $x_1_9 = "SafeHandle" ascii //weight: 1
        $x_1_10 = "ComputeHash" ascii //weight: 1
        $x_1_11 = "CreateDecryptor" ascii //weight: 1
        $x_1_12 = "GetBytes" ascii //weight: 1
        $x_1_13 = "MD5CryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYT_2147829487_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYT!MTB"
        threat_id = "2147829487"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xMxextxhxoxdx0x" ascii //weight: 1
        $x_1_2 = {2e 00 72 00 65 00 73 00 6f 00 00 07 75 00 72 00 63 00 00 05 65 00 73 00 00 1f 78 00 4d 00 78 00 65}  //weight: 1, accuracy: High
        $x_1_3 = "MczjfkjOADJofQJFLODJCLXK" wide //weight: 1
        $x_1_4 = "C ksdjgfdslogpojgijdsiaf" wide //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXB_2147829497_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXB!MTB"
        threat_id = "2147829497"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 35 00 41 00 41 00 5a 00 00 0d 52 00 5a 00 35 00 38 00 35 00 38 00 00 17 4a 00 39 00 34 00 54 00 52 00 34 00 34 00 50 00 56 00 34 00 47}  //weight: 1, accuracy: High
        $x_1_2 = {00 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 00}  //weight: 1, accuracy: High
        $x_1_3 = {00 43 53 4a 4e 43 42 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 58 43 43 56 56 00}  //weight: 1, accuracy: High
        $x_1_5 = "SafeHandle" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
        $x_1_7 = "ComputeHash" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BG_2147829561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BG!MTB"
        threat_id = "2147829561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "program1tannot bv1run in U`S mode" ascii //weight: 1
        $x_1_2 = "kernel3C?dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BG_2147829561_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BG!MTB"
        threat_id = "2147829561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "icanhazip.com" wide //weight: 1
        $x_1_2 = "Moolive.exe" wide //weight: 1
        $x_1_3 = "Findviru.exe" wide //weight: 1
        $x_1_4 = "vmware" wide //weight: 1
        $x_1_5 = "VirtualBox" wide //weight: 1
        $x_1_6 = "Jedi.exe" wide //weight: 1
        $x_1_7 = "$3C374A42-BAE4-11CF-BF7D-00AA006946EE" ascii //weight: 1
        $x_1_8 = "Select * from Win32_ComputerSystem" wide //weight: 1
        $x_1_9 = "PK11SDR_Decrypt" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEJ_2147829566_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEJ!MTB"
        threat_id = "2147829566"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "3b0eb763-2f3f-459b-a87b-7655a25c0b65" ascii //weight: 1
        $x_2_2 = "Kinomaniak Library" ascii //weight: 2
        $x_2_3 = "KomediaRomantyczna" ascii //weight: 2
        $x_2_4 = "FullInfoWyszukaj" ascii //weight: 2
        $x_1_5 = "Akcja" ascii //weight: 1
        $x_1_6 = "Wojenny" ascii //weight: 1
        $x_1_7 = "Animowany" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEK_2147829568_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEK!MTB"
        threat_id = "2147829568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "U3lzdGVtXEN1cnJlbnRDb250cm9sU2V0XFNlcnZpY2VzXERpc2tcRW51bVw=" wide //weight: 5
        $x_5_2 = "Y21kLmV4ZSAvYyBwaW5nIDAgLW4gMiAmIGRlbCA=" wide //weight: 5
        $x_2_3 = "Wservices.exe" wide //weight: 2
        $x_2_4 = "Win32_BaseBoard" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABR_2147829605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABR!MTB"
        threat_id = "2147829605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 5a 7e 20 00 00 04 20 66 0e 00 00 95 2e 03 16 2b 01 17 17 59 7e 20 00 00 04 20 81 03 00 00 95 5f 7e 20 00 00 04 20 4c 0d 00 00 95 61 58 81 08 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABR_2147829605_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABR!MTB"
        threat_id = "2147829605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {06 13 08 11 07 11 08 16 11 08 8e 69 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 09 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 05 de 16 2e 00 72 ?? ?? ?? 70 28 03}  //weight: 6, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "Jiswmuhknfh" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABR_2147829605_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABR!MTB"
        threat_id = "2147829605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 1f 10 8d ?? ?? ?? 01 25 d0 ?? ?? ?? 04 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 06 07 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0c 08 02 16 02 8e 69 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 06 28 ?? ?? ?? 06 0d 28 ?? ?? ?? 06 09 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "TransformBlock" ascii //weight: 1
        $x_1_4 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXC_2147829612_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXC!MTB"
        threat_id = "2147829612"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 9b 00 00 0a 0d 09 08 6f 9c 00 00 0a 09 18 6f 9d 00 00 0a 09 6f 9e 00 00 0a 06 16 06 8e 69 6f 9f 00 00 0a 13 04 11 04}  //weight: 1, accuracy: High
        $x_1_2 = {97 a2 2b 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 99 00 00 00 30 00 00 00 b5 00 00 00 4b}  //weight: 1, accuracy: High
        $x_1_3 = "RandomNumberGame.Properties" ascii //weight: 1
        $x_1_4 = "3228d1e52f0b" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UUI_2147829688_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UUI!MTB"
        threat_id = "2147829688"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 07 02 07 28 ?? ?? ?? 06 07 20 ff 00 00 00 5d}  //weight: 2, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "FB64S" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXA_2147829818_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXA!MTB"
        threat_id = "2147829818"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 3f 00 21 00 3f 00 21 00 4d 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 45 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f}  //weight: 1, accuracy: High
        $x_1_2 = {53 00 49 00 3f 00 21 00 42 00 67 00 44 00 77 00 3f 00 21 00 51 00 3f 00 21 00 43 00 42 00 67 00 3f 00 21 00 52 00 3f 00 21 00 68 00 6f 00 43 00 45}  //weight: 1, accuracy: High
        $x_1_3 = {76 00 74 00 72 00 78 00 69 00 2f 00 50 00 4a 00 54 00 3f 00 21 00 58 00 65 00 38 00 52 00 4d 00 44 00 33 00 35 00 6c 00 66 00 37 00 50 00 35 00 64}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABL_2147829922_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABL!MTB"
        threat_id = "2147829922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0c 6e 31 03 16 2b 01 17 7e 05 00 00 04 20 8b 09 00 00 95 5a 7e 05 00 00 04 20 97 0c 00 00 95 58 61 80 33 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABL_2147829922_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABL!MTB"
        threat_id = "2147829922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 dd b6 fd 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 9f 00 00 00 41 00 00 00 dc 01 00 00 19 06 00 00 65 01 00 00}  //weight: 5, accuracy: High
        $x_1_2 = "MemoryStream" ascii //weight: 1
        $x_1_3 = "Infusion" ascii //weight: 1
        $x_1_4 = "Card Puncher" ascii //weight: 1
        $x_1_5 = "Landskip Yard Care" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXE_2147830013_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXE!MTB"
        threat_id = "2147830013"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6c0da49c-ffe7-4cd6-b02e-874c5a9b8ee8" ascii //weight: 1
        $x_1_2 = "GamespyMasterServer.Resources" ascii //weight: 1
        $x_1_3 = {9f b6 3f 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 c1 00 00 00 4d 00 00 00 73 01 00 00 c5}  //weight: 1, accuracy: High
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXF_2147830031_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXF!MTB"
        threat_id = "2147830031"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\somfffffffffffedirectory\\" ascii //weight: 1
        $x_1_2 = "niudddddddddddddddddhiu" ascii //weight: 1
        $x_1_3 = "fdsffffhhhhhhhhhhhhhhhhhhhhhhhhdffsdf" ascii //weight: 1
        $x_1_4 = "sddkffshdjfffgjhkdksgcafp" ascii //weight: 1
        $x_1_5 = "fsdhfhfdf f" ascii //weight: 1
        $x_1_6 = "adsssssssssssa" ascii //weight: 1
        $x_1_7 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXH_2147830061_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXH!MTB"
        threat_id = "2147830061"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "55R7SPC4B54JQGN4C547H4" ascii //weight: 1
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "GetObject" ascii //weight: 1
        $x_1_4 = "Rfc2898DeriveBytes" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABG_2147830117_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABG!MTB"
        threat_id = "2147830117"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1b 9a 20 ba 04 00 00 95 2e 03 16 2b 01 17 7e 03 00 00 04 1b 9a 20 d8 04 00 00 95 5a 7e 03 00 00 04 1b 9a 1f 46 95 58 61 81 07 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABG_2147830117_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABG!MTB"
        threat_id = "2147830117"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {25 07 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 25 07 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 16 06 8e 69 6f ?? ?? ?? 0a 0c 08 8e 69 1f 10 59 8d ?? ?? ?? 01 0d 08 1f 10 09 16 08 8e 69 1f 10 59 28 ?? ?? ?? 0a 09 03 6b}  //weight: 5, accuracy: Low
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "MemoryStream" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXJ_2147830149_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXJ!MTB"
        threat_id = "2147830149"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$9a366d86-260d-4eed-9373-4d965a667d6e" ascii //weight: 1
        $x_1_2 = "GoodVsEvil.Properties.Resource" ascii //weight: 1
        $x_1_3 = {15 a2 09 09 01 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 2b 00 00 00 08 00 00 00 1c 00 00 00 43}  //weight: 1, accuracy: High
        $x_1_4 = {62 00 cc 06 59 00 46 06 86 06}  //weight: 1, accuracy: High
        $x_1_5 = "Jambo" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXD_2147830279_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXD!MTB"
        threat_id = "2147830279"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 3f 00 21 00 3f 00 21 00 4d 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 00 81 97 45 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 2f 00 2f 00 38 00 3f 00 21 00 3f 00 21 00}  //weight: 1, accuracy: High
        $x_1_2 = {21 00 67 00 3f 00 21 00 3f 00 21 00 4b 00 3f 00 21 00 55 00 3f 00 21 00 3f 00 21 00 43 00 73 00 58 00 32 00 67 00 73 00 66 00 43 00 78 00 4d 00 4c 00 4f 00 46 00 33 00 2f 00 2f 00 2f 00 38 00 57 00 44 00 42}  //weight: 1, accuracy: High
        $x_1_3 = {43 00 34 00 3f 00 21 00 4d 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21 00 3f 00 21}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXL_2147830288_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXL!MTB"
        threat_id = "2147830288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$72b48a22-274b-42ab-b1dc-eb253a78961c" ascii //weight: 1
        $x_1_2 = "SetSprite" ascii //weight: 1
        $x_1_3 = "ParseFailure" ascii //weight: 1
        $x_1_4 = "StructuralEqualityComparer" ascii //weight: 1
        $x_1_5 = "Rfc2898DeriveBytes" ascii //weight: 1
        $x_1_6 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXL_2147830288_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXL!MTB"
        threat_id = "2147830288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 07 11 07 2c 40 11 04 1f 21 8c ?? 00 00 01 09 1f 0e 8c ?? 00 00 01 28 ?? 00 00 0a 1f 5e}  //weight: 1, accuracy: Low
        $x_1_2 = "CompareObjectGreaterEqual" ascii //weight: 1
        $x_1_3 = "QuestKingdom.WorkerHelper" ascii //weight: 1
        $x_1_4 = "QQQ00" ascii //weight: 1
        $x_1_5 = "ConcatenateObject" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = {00 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 00}  //weight: 1, accuracy: High
        $x_1_8 = "OIKMNJUYHBVGT01" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXK_2147830418_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXK!MTB"
        threat_id = "2147830418"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "545BGGP79TP5ND87G5XQ88" ascii //weight: 1
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABO_2147830423_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABO!MTB"
        threat_id = "2147830423"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 9a 20 bf 08 00 00 95 6e 31 03 16 2b 01 17 7e 3c 00 00 04 16 9a 20 97 0e 00 00 95 5a 7e 3c 00 00 04 16 9a 20 24 0e 00 00 95 58 61 81 07 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {95 61 7e 21 00 00 04 20 35 09 00 00 95 2e 03 16 2b 01 17 17 59 7e 21 00 00 04 20 1a 13 00 00 95 5f 7e 21 00 00 04 20 a1 0d 00 00 95 61 58 81 05 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABO_2147830423_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABO!MTB"
        threat_id = "2147830423"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateInstance" ascii //weight: 1
        $x_1_2 = "GetObject" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
        $x_1_5 = "55R7SPC4B54JQGN4C547H4" wide //weight: 1
        $x_1_6 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_7 = "$72b48a81-274b-42ab-b1dc-eb253a78961c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABD_2147830426_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABD!MTB"
        threat_id = "2147830426"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {20 b0 0b 00 00 95 2e 03 16 2b 01 17 7e 22 00 00 04 20 e4 0a 00 00 95 5a 7e 22 00 00 04 20 d9 08 00 00 95 58 61 81}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABD_2147830426_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABD!MTB"
        threat_id = "2147830426"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {25 07 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 16 06 8e 69 6f ?? ?? ?? 0a 0c 08 8e 69 1f 10 59 8d ?? ?? ?? 01 0d 08 1f 10 09 16 08 8e 69 1f 10 59 1f 10 58 1f 10 59 28 ?? ?? ?? 0a 09}  //weight: 5, accuracy: Low
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXN_2147830445_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXN!MTB"
        threat_id = "2147830445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HZV0BG5CH5GRDEG8G55B78" ascii //weight: 1
        $x_1_2 = "OE.PS" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "Rfc2898DeriveBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXU_2147830713_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXU!MTB"
        threat_id = "2147830713"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2e 00 72 00 65 00 73 00 00 09 6f 00 75 00 72 00 63 00 00 05 65 00 73 00 00 1b 6b 00 63 00 6a 00 69}  //weight: 1, accuracy: High
        $x_1_2 = "kcjijiwoefuw9" ascii //weight: 1
        $x_1_3 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_4 = "vdfge" ascii //weight: 1
        $x_1_5 = "XXRXeXfXlXeXcXXXtXXXiXXoXXnX" ascii //weight: 1
        $x_1_6 = "XXAXsXsXeXmXbXlXXXyXX" ascii //weight: 1
        $x_1_7 = "XXSXXyXsXtXXXeXXmX" ascii //weight: 1
        $x_1_8 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXS_2147830719_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXS!MTB"
        threat_id = "2147830719"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 13 00 00 04 06 7e 13 00 00 04 06 9a 1a 28 42 00 00 0a 72 cf 00 00 70 72 d3 00 00 70 6f 11 00 00 0a a2 06 17 58 0a 06 7e 13 00 00 04 8e 69 32 cf}  //weight: 1, accuracy: High
        $x_1_2 = {7b 0d 00 00 04 06 02 7b 0d 00 00 04 06 9a 1a 28 62 00 00 0a 72 d5 02 00 70 72 d9 02 00 70 6f 1e 00 00 0a a2 06 17 58 0a 06 02 7b 0d 00 00 04 8e 69 32 cc}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXM_2147830734_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXM!MTB"
        threat_id = "2147830734"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e3547c59-47ef-437d-8bf1-5d80146ece1f" ascii //weight: 1
        $x_1_2 = "KYOIKU.Resources.resources" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXO_2147830735_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXO!MTB"
        threat_id = "2147830735"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$1e609f28-ba57-425c-848f-9ac576d12139" ascii //weight: 1
        $x_1_2 = "QuestKingdom" wide //weight: 1
        $x_1_3 = ".WorkerHelper" wide //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXQ_2147830826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXQ!MTB"
        threat_id = "2147830826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ea01dce7-dd7b-42d3-bfff-b8ee9f304d19" ascii //weight: 1
        $x_1_2 = "Friedman.Resources.resource" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CompareObjectGreaterEqual" ascii //weight: 1
        $x_1_5 = "ForNextCheckObj" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXR_2147830827_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXR!MTB"
        threat_id = "2147830827"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {51 00 75 00 65 00 73 00 74 00 4b 00 69 00 6e 00 67 00 64 00 6f 00 6d 00 00 1b 2e 00 57 00 6f 00 72 00 6b 00 65 00 72 00 48 00 65 00 6c 00 70 00 65 00 72}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXT_2147830828_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXT!MTB"
        threat_id = "2147830828"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e70c1306-d12e-4d3e-9b66-fcbd47ca5af6" ascii //weight: 1
        $x_1_2 = {5d a2 df 09 1f 00 00 00 fa 25 33 00 16 00 00 02}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "GetObjectValue" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXV_2147830829_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXV!MTB"
        threat_id = "2147830829"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 df a2 eb 09 1f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 1c 01 00 00 29 01 00 00 7c 03 00 00 ce 0d 00 00 8c 09 00 00 ad 00 00 00 11 05 00 00 32}  //weight: 1, accuracy: High
        $x_1_2 = "DESCryptoServiceProvider" ascii //weight: 1
        $x_1_3 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "b65aeb620296" ascii //weight: 1
        $x_1_5 = "ccda5248" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXX_2147830936_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXX!MTB"
        threat_id = "2147830936"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {2e 00 72 00 00 05 65 00 73 00 00 05 6f 00 75 00 00 05 72 00 63 00 00 11 64 00 78 00 66 00 68 00 74 00 79 00 79 00 37 00 00 0f 64 00 67 00 64 00 68 00 53 00 44 00 46}  //weight: 2, accuracy: High
        $x_2_2 = "xcvcx" ascii //weight: 2
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "GetObjectValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXX_2147830936_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXX!MTB"
        threat_id = "2147830936"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "48mCOBkPTMWGhJhTSe7dR1gmjxqh" ascii //weight: 1
        $x_1_2 = "MK5KGXo6oEkCQRBRBbv/a" ascii //weight: 1
        $x_1_3 = "whDyO2NTkdL7/SqKevO7+irjoUy5" ascii //weight: 1
        $x_1_4 = "4tpIuqqFZgsseIZO8pfKgo/2PSa" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXZ_2147831267_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXZ!MTB"
        threat_id = "2147831267"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 3f 09 1f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 9f 00 00 00 16 00 00 00 64 00 00 00 82 01 00 00 42}  //weight: 1, accuracy: High
        $x_1_2 = "_(-V/sc31f37qk27L_^|2FA9<.resources" ascii //weight: 1
        $x_1_3 = "$44B5FD47-F2BA-4CF0-AC99-C412D70EE4DA" ascii //weight: 1
        $x_1_4 = "Confuser.Core 1.5.0+b5197549e4" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "ConfusedByAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XW_2147831282_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XW!MTB"
        threat_id = "2147831282"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$cfedd164-003e-4714-b9d8-68ee9f609bea" ascii //weight: 10
        $x_1_2 = "ParseFailure" ascii //weight: 1
        $x_1_3 = "NextActivator" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "Rfc2898DeriveBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXW_2147831283_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXW!MTB"
        threat_id = "2147831283"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 ff a2 ff 09 0e 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 99 00 00 00 70 00 00 00 7a 02 00 00 af 04 00 00 7c 02 00 00 0a 00 00 00 86 01 00 00 bf}  //weight: 3, accuracy: High
        $x_3_2 = "Ionic.Zip" ascii //weight: 3
        $x_3_3 = "build.exe" ascii //weight: 3
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "DownloadString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NXY_2147831284_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NXY!MTB"
        threat_id = "2147831284"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 08 12 08 28 ?? 00 00 0a 28 ?? 00 00 0a 16 09 06 1a 28 ?? 00 00 0a 00 06 1a 58 0a 16 2d cb 00 11 07 17 58 16 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "BitConverter" ascii //weight: 1
        $x_1_3 = "ToInt32" ascii //weight: 1
        $x_1_4 = "KeysNormalize.d" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BI_2147831346_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BI!MTB"
        threat_id = "2147831346"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RKchSwDM0acCB093G1" ascii //weight: 1
        $x_1_2 = "i0fpVtwme2FIB2dss5" ascii //weight: 1
        $x_1_3 = "dIK3LYY3tfaN9OFSKw" ascii //weight: 1
        $x_1_4 = "WebjGlKTAHH5rWCDl7" ascii //weight: 1
        $x_1_5 = "J2tk4J8m792GtvDFV9" ascii //weight: 1
        $x_1_6 = "pjak1vk9WX3PPfSWtt" ascii //weight: 1
        $x_1_7 = "fHZkD1r1a9cVtSbhvZ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFB_2147831349_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFB!MTB"
        threat_id = "2147831349"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 06 07 28 ?? 00 00 06 26 11 04 06 07 6f ?? 00 00 0a 13 05 11 05 28 ?? 00 00 0a 13 06 09 08 11 06 d2 9c 07 17 58 0b 07 17 fe 04 13 07 11 07 2d ce 08 17 58 0c}  //weight: 1, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFD_2147831388_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFD!MTB"
        threat_id = "2147831388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {1f 28 95 5f 7e 32 00 00 04 16 9a 20 b3 09 00 00 95 61 61 80 45 00 00 04 7e 26 00 00 04 39 6a 08 00 00 7e 26 00 00 04 8e 69 0a}  //weight: 10, accuracy: High
        $x_10_2 = {20 5e 05 00 00 95 5a 7e 13 00 00 04 18 9a 20 08 10 00 00 95 58 61 80 33 00 00 04 38 a6 00 00 00 7e 33 00 00 04 7e 13 00 00 04 11 04 0c 18 9a 20 1a 0c 00 00 95 33 1a 7e 33 00 00 04}  //weight: 10, accuracy: High
        $x_1_3 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_4 = "get_CurrentDomain" ascii //weight: 1
        $x_1_5 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NFG_2147831489_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFG!MTB"
        threat_id = "2147831489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "$acf48fb0-6498-4c20-b651-3ffae17c7ad1" ascii //weight: 3
        $x_3_2 = "DlImageParsr.Properties" ascii //weight: 3
        $x_3_3 = {57 b7 a2 3d 09 0f 00 00 00 00 00 00 00 00 00 00 01}  //weight: 3, accuracy: High
        $x_3_4 = {20 00 32 01 00 8d}  //weight: 3, accuracy: High
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
        $x_1_7 = "ColorTranslator" ascii //weight: 1
        $x_1_8 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFG_2147831489_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFG!MTB"
        threat_id = "2147831489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = "WS2eb_Managus3" ascii //weight: 10
        $x_10_2 = "ir3ws_0c0a" ascii //weight: 10
        $x_10_3 = "mmcboft_Gsrsrv" ascii //weight: 10
        $x_10_4 = "Vaultcrosoft_svc" ascii //weight: 10
        $x_10_5 = "CNBs_Handlers" ascii //weight: 10
        $x_10_6 = "KBSCZsoft_Idsxt" ascii //weight: 10
        $x_1_7 = "GetFolderPath" ascii //weight: 1
        $x_1_8 = "GetCurrentDirectory" ascii //weight: 1
        $x_1_9 = "get_CurrentDomain" ascii //weight: 1
        $x_1_10 = "get_BaseDirectory" ascii //weight: 1
        $x_1_11 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 ?? 00 00 00 04 00 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NFC_2147831529_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFC!MTB"
        threat_id = "2147831529"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 05 0d 00 00 95 5a 11 04 0b 7e 28 00 00 04 20 79 09 00 00 95 58 61 81 06 00 00 01 2b 69 7e 1d 00 00 04 1d 95 7e 28 00 00 04 20 46 05 00 00 95 33 55 06 2d 29}  //weight: 10, accuracy: High
        $x_10_2 = {19 9a 20 ad 04 00 00 95 5f 7e 04 00 00 04 19 9a 20 1d 11 00 00 95 61 58 81 09 00 00 01 7e 25 00 00 04 1f 37 95 7e 04 00 00 04 19 9a 20 10 0d 00 00}  //weight: 10, accuracy: High
        $x_10_3 = {20 b6 09 00 00 95 2e 03 16 2b 01 17 17 59 7e 1d 00 00 04 18 9a 20 86 0a 00 00 06 0a 95 5f 7e 1d 00 00 04 18 9a 20 09 04 00 00 95 61 58}  //weight: 10, accuracy: High
        $x_1_4 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_5 = "get_CurrentDomain" ascii //weight: 1
        $x_1_6 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NFE_2147831530_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFE!MTB"
        threat_id = "2147831530"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "xilecurity_ApplicationId_PolicyManagement_Cmdlets" ascii //weight: 10
        $x_10_2 = "rasindows_Dxagnosis_TroubleshootingPack" ascii //weight: 10
        $x_10_3 = "fp4attors_Ho900P" ascii //weight: 10
        $x_10_4 = "IMJPDm_DataXSAPI" ascii //weight: 10
        $x_10_5 = "mqdy_singleres" ascii //weight: 10
        $x_10_6 = "SWDIRsoft_Weehvid" ascii //weight: 10
        $x_10_7 = "CNN0nt_CmNEAPI" ascii //weight: 10
        $x_10_8 = "XRPsoft_B30J" ascii //weight: 10
        $x_10_9 = "muto_Bluetotup" ascii //weight: 10
        $x_10_10 = "adprom_Gjey40" ascii //weight: 10
        $x_1_11 = "GetFolderPath" ascii //weight: 1
        $x_1_12 = "GetCurrentDirectory" ascii //weight: 1
        $x_1_13 = "get_CurrentDomain" ascii //weight: 1
        $x_1_14 = "get_BaseDirectory" ascii //weight: 1
        $x_1_15 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NFA_2147831729_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFA!MTB"
        threat_id = "2147831729"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "source\\repos\\sync\\sync\\bin\\Debug\\Confused\\sync_enc.pdb" ascii //weight: 1
        $x_1_2 = "fstatvfs@openssh.com" ascii //weight: 1
        $x_1_3 = "Private key is encrypted but passphrase is empty" ascii //weight: 1
        $x_1_4 = "sync.exe" ascii //weight: 1
        $x_1_5 = "Confuser.Core 1.6.0+447341964f" ascii //weight: 1
        $x_1_6 = {57 bf b6 3f 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFH_2147831730_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFH!MTB"
        threat_id = "2147831730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 07 11 07 2c 40 11 04 1f 21 8c ?? 00 00 01 09 1f 0e 8c ?? 00 00 01 28 ?? 00 00 0a 1f 5e 8c [0-64] 0a 13 04 00 2b 1b 00 11 04}  //weight: 1, accuracy: Low
        $x_1_2 = "ITITITITIITITITITITITTIITIT" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFH_2147831730_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFH!MTB"
        threat_id = "2147831730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {3e 00 3e 00 3e 00 44 00 41 00 75 00 3e 00 4d 00 41 00 34 00 43 00 41 00 77 00 41 00 67 00 4c 00 41 00 45 00 44 00 3e 00 41 00 67 00 62 00 41 00 38 00 47 00 41}  //weight: 1, accuracy: High
        $x_1_2 = {78 00 43 00 48 00 51 00 52 00 42 00 42 00 6f 00 77 00 41 00 49 00 41 00 67 00 48 00 64 00 41 00 52 00 41 00 43 00 45 00 41 00 45 00 4a 00 67 00 3e 00 67 00 4d}  //weight: 1, accuracy: High
        $x_1_3 = {42 00 41 00 61 00 41 00 4d 00 47 00 41 00 79 00 42 00 51 00 64 00 3e 00 46 00 41 00 67 00 3e 00 64 00 41 00 4d 00 48 00 41 00 79 00 42 00 51 00 61 00 41 00 59}  //weight: 1, accuracy: High
        $x_1_4 = {3d 00 3d 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e}  //weight: 1, accuracy: High
        $x_1_5 = "FromBase64" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFI_2147831731_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFI!MTB"
        threat_id = "2147831731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$e1a9881c-7887-4cd1-af17-f5b9da0fbdd6" ascii //weight: 1
        $x_1_2 = {57 5d b6 c1 09 0b 00 00 00 fa 25 33 00 16 00 00 02}  //weight: 1, accuracy: High
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFI_2147831731_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFI!MTB"
        threat_id = "2147831731"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 1f 7e 8c ?? ?? ?? 01 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 07 11 07 2c 3b 11 04 1f 21 8c ?? ?? ?? 01 09 1f 0e 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 1f 5e 8c ?? ?? ?? 01 28 [0-38] 0a 13 04 00 2b 16 00 11 04 09 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 00 07 11 05 12 01}  //weight: 1, accuracy: Low
        $x_1_2 = {57 1d b6 09 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00}  //weight: 1, accuracy: High
        $x_1_3 = "ConvertFromUtf32" ascii //weight: 1
        $x_1_4 = "CompareObjectGreaterEqual" ascii //weight: 1
        $x_1_5 = "ForNextCheckObj" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFJ_2147831732_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFJ!MTB"
        threat_id = "2147831732"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1f 1d 93 61 1f 7c 5f 9d 2a}  //weight: 1, accuracy: High
        $x_1_2 = {1f 64 91 03 5f 20 ?? 00 00 00 5f 9c 59 13 05}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFJ_2147831732_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFJ!MTB"
        threat_id = "2147831732"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "W2352535345" ascii //weight: 1
        $x_1_2 = "W253353" ascii //weight: 1
        $x_1_3 = "W3424265" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
        $x_1_6 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFK_2147831733_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFK!MTB"
        threat_id = "2147831733"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$131463c8-0124-489c-923c-4e8fb8ca61f7" ascii //weight: 1
        $x_1_2 = {57 5d b6 cb 09 1f 00 00 00 fa 25 33 00 16 00 00 02}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFK_2147831733_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFK!MTB"
        threat_id = "2147831733"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2e 00 72 00 00 05 65 00 73 00 00 05 6f 00 75 00 00 05 72 00 63 00 00 19 57 00 5b 00 4f 00 50 00 4e 00 4d 00 4e 00 44 00 56 00 38 00 59 00 39 00 00 19 78 00 63 00 76 00 78}  //weight: 1, accuracy: High
        $x_1_2 = {76 00 65 00 67 00 65 00 74 00 32 00 31 00 71 00 00 13 49 00 6e 00 63 00 72 00 65 00 6d 00 65 00 6e 00 74}  //weight: 1, accuracy: High
        $x_1_3 = "VCXMU99" ascii //weight: 1
        $x_1_4 = "GetManifestResourceNames" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFL_2147831737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFL!MTB"
        threat_id = "2147831737"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {2b 01 17 17 59 7e 1c 00 00 04 18 9a 20 6b 0a 00 00 95 5f 7e 1c 00 00 04 18 9a 20 c6 10 00 00 95 61 61 81 05 00 00 01 7e 2a 00 00 04 1f 46 95 7e 1c 00 00 04 18 9a 20 bd 00 00 00 95 33 25 7e 2a 00 00 04 1f 46}  //weight: 10, accuracy: High
        $x_10_2 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04}  //weight: 10, accuracy: High
        $x_1_3 = "AppDomain" ascii //weight: 1
        $x_1_4 = "GetFolderPath" ascii //weight: 1
        $x_1_5 = "get_CurrentDomain" ascii //weight: 1
        $x_1_6 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFM_2147831776_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFM!MTB"
        threat_id = "2147831776"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2e 00 72 00 00 05 65 00 73 00 00 05 6f 00 75 00 00 05 72 00 63 00 00 1d 64 00 44 00 46 00 48 00 20 00 45 00 52 00 59 00 45 00 35 00 59 00 48 00 5a 00 4e 00 00 1f 41 00 47 00 34 00 54}  //weight: 1, accuracy: High
        $x_1_2 = "ZKCEIE SG GFDHFDH9" ascii //weight: 1
        $x_1_3 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_4 = "WEQPEOIWHFJNBVGUESF78E8R" ascii //weight: 1
        $x_1_5 = "55S55y5s5t5e55m" ascii //weight: 1
        $x_1_6 = "5Re55fle555cti55on" ascii //weight: 1
        $x_1_7 = "55As55se5m5b5l5y5" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFM_2147831776_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFM!MTB"
        threat_id = "2147831776"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 6b 0e 00 00 95 2e 03 16 2b 01 17 17 59 7e 09 00 00 04 20 4a 0b 00 00 06 0a 95 5f 7e 09 00 00 04 20 9e 12 00 00 95 61 59 80 38 00 00 04 7e 38 00 00 04 7e 09 00 00 04 20 43 0a 00 00 95 33 0f}  //weight: 10, accuracy: High
        $x_10_2 = {c8 0e 00 00 95 5a 7e 1d 00 00 04 1b 06 0c 9a 20 19 03 00 00 95 2e 03 16 2b 01 17 17 59 7e 1d 00 00 04 1b 9a 20 35 07 00 00 95 5f 7e 1d 00 00 04 1b 9a 20 60 02 00 00 95 61 58 81 05 00 00 01 38 fb 05 00 00}  //weight: 10, accuracy: High
        $x_1_3 = "AppDomain" ascii //weight: 1
        $x_1_4 = "GetFolderPath" ascii //weight: 1
        $x_1_5 = "get_CurrentDomain" ascii //weight: 1
        $x_1_6 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ABY_2147831799_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABY!MTB"
        threat_id = "2147831799"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {17 9a 20 90 04 00 00 95 6e 31 03 16 2b 01 17 17 59 7e 08 00 00 04 17 9a 20 93 0e 00 00 95 5f 7e 08 00 00 04 17 9a 20 12 0a 00 00 95 61 58 81 06 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {20 b4 0b 00 00 95 2e 03 16 2b 01 17 17 59 7e 02 00 00 04 20 63 09 00 00 95 5f 7e 02 00 00 04 20 02 0b 00 00 95 61 58 81 07 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABY_2147831799_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABY!MTB"
        threat_id = "2147831799"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {35 00 41 00 34 00 41 00 34 00 42 00 36 00 43 00 00 0d 36 00 38 00 37 00 36 00 36 00 39 00 00 13 59 00 35 00 74 00 46 00 76 00 55 00 38 00 45 00 59}  //weight: 1, accuracy: High
        $x_1_2 = "IZHs.g.resources" ascii //weight: 1
        $x_1_3 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 1
        $x_1_4 = "Y5tFvU8EY" wide //weight: 1
        $x_1_5 = "Davis11.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABV_2147831800_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABV!MTB"
        threat_id = "2147831800"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 7e 0f 00 00 95 2e 03 17 2b 01 16 58 7e 2d 00 00 04 17 9a 7e 2d 00 00 04 19 9a 20 7c 04 00 00 95 e0 95 7e 2d 00 00 04 19 9a 20 5f 09 00 00 95 61 7e 2d 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABV_2147831800_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABV!MTB"
        threat_id = "2147831800"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {11 09 11 0e 8f ?? ?? ?? 01 25 71 ?? ?? ?? 01 11 0c 11 0e 91 61 d2 81 ?? ?? ?? 01 11 0e 17 58 13 0e 11 0e 11 08 32 d9}  //weight: 6, accuracy: Low
        $x_1_2 = "GetTempPath" ascii //weight: 1
        $x_1_3 = "DownloadData" ascii //weight: 1
        $x_1_4 = "GetDrives" ascii //weight: 1
        $x_1_5 = "$5f27e92a-6118-4bc7-ac94-354b27f1e80f" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABV_2147831800_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABV!MTB"
        threat_id = "2147831800"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {37 00 41 00 37 00 39 00 37 00 32 00 36 00 35 00 34 00 32 00 34 00 37 00 00 0d 36 00 31 00 36 00 31 00 36 00 31 00 00 29 70 00 61 00 6c 00 2e 00 45 00 76 00 65 00 6e 00 74 00 4c 00 6f 00 67 00 41 00 6e 00 61 00 6c 00 79 00 7a 00 65 00 72}  //weight: 1, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "85HNqHIeQdRZsuSbkw.KlNobTsUiSkXW7WXH9" ascii //weight: 1
        $x_1_5 = "$02bedfb9-c173-423a-b0a4-def5668bbd4d" ascii //weight: 1
        $x_1_6 = "YaYbYcYdYeYfYgYhYkjljnmompmqmrmsmtm" wide //weight: 1
        $x_1_7 = "JON6nZGYxV56Gvdto6.FhhXBgdFS0AvstHj3c" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFO_2147831912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFO!MTB"
        threat_id = "2147831912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {04 04 02 7b}  //weight: 1, accuracy: High
        $x_1_2 = {04 8e 69 5d 93 03 61 d2 2a}  //weight: 1, accuracy: High
        $x_1_3 = "ToCharArray" ascii //weight: 1
        $x_1_4 = "<Main>g__Babo|1" ascii //weight: 1
        $x_1_5 = "<>c__DisplayClass0_0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFO_2147831912_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFO!MTB"
        threat_id = "2147831912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 05 0e 00 00 95 6e 31 03 16 2b 01 17 17 59 7e 15 00 00 04 17 9a 20 a4 0c 00 00 95 5f 7e 15 00 00 04 17 9a 20 9c 02 00 00 95 61 61 81 09 00 00 01 23 9a 99 99 99 99 99 c9 3f 80 32 01 00 04 2b 0b 17 6a}  //weight: 1, accuracy: High
        $x_1_2 = {20 ec 04 00 00 95 e0 95 7e 1a 00 00 04 1b 9a 20 6d 12 00 00 95 61 7e 1a 00 00 04 1b 9a 20 0f 03 00 00 95 2e 03 17 2b 01 16 58 11 04 ?? 7e 1a 00 00 04 19 9a 17 95 7e 1a 00 00 04 1b 9a 20 f7 0d 00 00}  //weight: 1, accuracy: Low
        $x_1_3 = {20 a6 0b 00 00 95 5a 7e 10 00 00 04 1a 9a 20 73 12 00 00 95 58 61 81 08 00 00 01 2b 74 7e 28 00 00 04 2c 0d 7e 28 00 00 04 8e 69 d2 80 0b 00 00 04 7e 06 00 00 04 1f 41 95 7e 10 00 00 04 1a 9a 20 ec 07 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFO_2147831912_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFO!MTB"
        threat_id = "2147831912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {45 00 6e 00 74 00 65 00 72 00 20 00 6e 00 75 00 67 00 66 00 67 00 66 00 67 00 66 00 6d 00 62 00 65 00 72 00 20 00 31 00 73 00 74 00 2e 00 09 00 73 00 73 00 64 00}  //weight: 1, accuracy: High
        $x_1_2 = "DynamicDllInvokeType" ascii //weight: 1
        $x_1_3 = "fhdfcdadssssdsssfsssssssssssdsssssssssassdgggggggggggddgdsddddddfddgggfsf" ascii //weight: 1
        $x_1_4 = "sadhhsssdsfsssssggggggggdsdgsdddddd" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "Fasssgilhhdd" ascii //weight: 1
        $x_1_7 = "GetMethods" ascii //weight: 1
        $x_1_8 = "NineRays.Obfuscator.Evaluation" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFN_2147831928_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFN!MTB"
        threat_id = "2147831928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 28 ?? 00 00 06 13 05 08 09 11 04 6f ?? 00 00 0a 13 06 11 06 28 ?? 00 00 0a 13 07 07 06 11 07 d2 9c 00 11 04 17 58 13 04 11 04 17 fe 04 13 08 11 08 2d c8}  //weight: 1, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFN_2147831928_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFN!MTB"
        threat_id = "2147831928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 7d 00 00 0a 13 06 11 06 2c 38 06 1f 21 8c 54 00 00 01 07 1f 0e 8c 54 00 00 01 28 7e 00 00 0a 1f 5e 8c 54 00 00 01 28 7f 00 00 0a 28 7e 00 00 0a 28 77 00 00 0a 28 80 00 00 0a 28 81 00 00 0a 0a 2b 12 06 07 28 77 00 00 0a 28 80 00 00 0a 28 81 00 00 0a 0a 08 11 08 12 02 28 82 00 00 0a 13 07 11 07}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFN_2147831928_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFN!MTB"
        threat_id = "2147831928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 44 00 41 00 75 00 3e 00 4d 00 41 00 34 00 43 00 41 00 77 00 41 00 67 00 4c 00 41 00 45 00 44}  //weight: 1, accuracy: High
        $x_1_2 = {3d 00 3d 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e}  //weight: 1, accuracy: High
        $x_1_3 = "AlBAIAYGAvBAIAUGAuBwb>CA0BwcAEGA" wide //weight: 1
        $x_1_4 = "FromBase64" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFR_2147832020_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFR!MTB"
        threat_id = "2147832020"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 d0 00 00 8d ?? 00 00 01}  //weight: 1, accuracy: Low
        $x_1_2 = "$26e0a7d6-dd59-47d0-92b4-5219ad185e38" ascii //weight: 1
        $x_1_3 = "System.Activator" ascii //weight: 1
        $x_1_4 = "iO.fo" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "CreateInstance" ascii //weight: 1
        $x_1_7 = "InvokeMember" ascii //weight: 1
        $x_1_8 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFR_2147832020_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFR!MTB"
        threat_id = "2147832020"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2e 00 72 00 00 05 65 00 73 00 00 05 6f 00 75 00 00 05 72 00 63 00 00 0d 48 00 4e 00 48 00 4a 00 47 00 35 00 00 0f 6b 00 6a 00 68 00 79 00 75 00 37 00 69 00 00 09 67 00 68 00 68 00 67 00 00 09 6a 00 72 00 77}  //weight: 1, accuracy: High
        $x_1_2 = "####Sys##tem####" ascii //weight: 1
        $x_1_3 = "####Re##fl##ec##ti##on####" ascii //weight: 1
        $x_1_4 = "GetManifestResourceName" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RPR_2147832124_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RPR!MTB"
        threat_id = "2147832124"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "studioarc.co.in" wide //weight: 1
        $x_1_2 = "Videos/aa%d.exe" wide //weight: 1
        $x_1_3 = "2runas" wide //weight: 1
        $x_1_4 = "explorer.exe" wide //weight: 1
        $x_1_5 = "HTTP/1.1 200" ascii //weight: 1
        $x_1_6 = "Host: %s" ascii //weight: 1
        $x_1_7 = "WinHttpConnect" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFZ_2147832137_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFZ!MTB"
        threat_id = "2147832137"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 28 00 00 04 18 9a 20 14 11 00 00 95 5f 7e 28 00 00 04 18 9a 20 9f 08 00 00 95 61 59 81 06 00 00 01 7e 24 00 00 04 7e 2d 00 00 04 36 07 7e 31 00 00 04}  //weight: 1, accuracy: High
        $x_1_2 = {20 ef 05 00 00 95 2e 03 17 2b 01 16 58 7e 0d 00 00 04 17 9a 1b 95 7e 0d 00 00 04 16 9a 20 88 0b 00 00 95 61 7e 0d 00 00 04 16 9a 20 03 0c 00 00 95}  //weight: 1, accuracy: High
        $x_1_3 = {57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFZ_2147832137_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFZ!MTB"
        threat_id = "2147832137"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 14 0d 00 00 95 6e 31 03 16 2b 01 17 17 59 7e 24 00 00 04 20 e4 02 00 00 95 5f 7e 24 00 00 04 20 5b 0d 00 00 95 61 59 81 05 00 00 01 2b 5c 7e 02 00 00 04 1f 47 95 7e 24 00 00 04 20 a6 0f 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {01 57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_3 = "AppDomain" ascii //weight: 1
        $x_1_4 = "GetFolderPath" ascii //weight: 1
        $x_1_5 = "get_CurrentDomain" ascii //weight: 1
        $x_1_6 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFS_2147832226_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFS!MTB"
        threat_id = "2147832226"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$928028cc-6b3c-4961-b214-3aa866b196e9" ascii //weight: 1
        $x_1_2 = "GetDomain" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFS_2147832226_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFS!MTB"
        threat_id = "2147832226"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "H4sIAAAAAAAEAO18CXgUx7Fwzcze" ascii //weight: 1
        $x_1_2 = "eAFvtpLONQhnuolXJuxLDVWWhAiD" ascii //weight: 1
        $x_1_3 = "5IyhXRlDFzqHvk2MM4opzQRBtUs8" ascii //weight: 1
        $x_1_4 = "yeyZzWydwKSFKS2cEMU51BFdS6JQ" ascii //weight: 1
        $x_1_5 = "FromBase64" ascii //weight: 1
        $x_1_6 = "GZipStream" ascii //weight: 1
        $x_1_7 = "EW.YK" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFY_2147832234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFY!MTB"
        threat_id = "2147832234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 91 09 00 00 95 61 7e 08 00 00 04 1a 9a 20 3f 0c 00 00 95 2e 03 17 2b 01 16 58 7e 08 00 00 04 17 9a 7e 08 00 00 04 1a 9a 20 6c 0a 00 00 95 e0 95 7e 08 00 00 04 1a 9a 20 8b 05 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {20 68 08 00 00 95 61 7e 11 00 00 04 18 9a 20 d0 00 00 00 95 2e 03 17 2b 01 16 58 7e 21 00 00 04 7e 11 00 00 04 18 9a 20 50 02 00 00 95 e0 95 7e 11 00 00 04 18 9a 20 89 08 00 00 95 59 7e 11 00 00 04 18 11 04 13 04 9a 20 1c 05 00 00}  //weight: 1, accuracy: High
        $x_1_3 = {20 ce 09 00 00 95 e0 95 7e 16 00 00 04 20 68 01 00 00 95 61 7e 16 00 00 04 20 5f 05 00 00 95 2e 03 17 2b 01 16 58 7e 09 00 00 04 19 9a 17 95 7e 16 00 00 04 20 a2 09 00 00 95 59 7e 16 00 00 04 20 4e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFY_2147832234_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFY!MTB"
        threat_id = "2147832234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {1f 15 95 7e 07 00 00 04 19 9a 20 9e 03 00 00 95 33 2e 7e 07 00 00 04 18 9a 1f 15 8f 07 00 00 01 25 71 07 00 00 01 7e 07 00 00 04 19 07 0a 9a 20 6f 04 00 00 95 61 81 07 00 00 01 38 bf 00 00 00 7e 07 00 00 04 18 9a 1f 15 95 7e 07 00 00 04 19 9a 20 ce 02 00 00 95 33 2f}  //weight: 10, accuracy: High
        $x_10_2 = {0a 7e 1e 00 00 04 16 9a 20 4b 0e 00 00 95 5a 7e 1e 00 00 04 16 9a 20 a1 12 00 00 95 58 61 81 06 00 00 01 11 04 0b 7e 1e 00 00 04 1b 9a 1f 3f 95 7e 1e 00 00 04 16 9a 20 e9 0a 00 00 95 33 4c 7e 08 00 00 04 16 8f 0a 00 00 01 25 71 0a}  //weight: 10, accuracy: High
        $x_10_3 = {20 49 09 00 00 95 2e 03 17 2b 01 16 58 6a 7e 05 00 00 04 1a 9a 20 68 0f 00 00 95 6e 31 03 16 2b 01 17 17 59 7e 05 00 00 04 1a 9a 20 b1 0b 00 00 95 5f 7e 05 00 00 04 1a 9a 20 d1 07 00 00 95 61 61 81 08 00 00 01 38 56 11 00 00 7e 05 00 00 04}  //weight: 10, accuracy: High
        $x_1_4 = {57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_5 = "GetFolderPath" ascii //weight: 1
        $x_1_6 = "get_CurrentDomain" ascii //weight: 1
        $x_1_7 = "AppDomain" ascii //weight: 1
        $x_1_8 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NFW_2147832244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFW!MTB"
        threat_id = "2147832244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$9d9037fc-b54c-4066-9184-b4d7293445fd" ascii //weight: 1
        $x_1_2 = "Reverse" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFW_2147832244_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFW!MTB"
        threat_id = "2147832244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Syst        em.Acti        vator" wide //weight: 1
        $x_1_2 = "Creat     eInsta    nce" wide //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFX_2147832245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFX!MTB"
        threat_id = "2147832245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 61 02 00 00 95 61 9e 7e 09 00 00 04 1f 32 8f 08 00 00 01 25 71 08 00 00 01 7e 2e 00 00 04 19 9a 20 09 05 00 00 95 61 81 08 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = {11 05 13 05 7e 27 00 00 04 18 9a 20 e0 11 00 00 95 61 7e 27 00 00 04 18 9a 20 2b 07 00 00 95 2e 03 17 2b 01 16 58}  //weight: 1, accuracy: High
        $x_1_3 = {7e 08 00 00 04 17 9a 20 33 04 00 00 95 61 81 05 00 00 01 38 ef 01 00 00 7e 08 00 00 04 1a 9a 1e 95 7e 08 00 00 04 17 9a 20 72 01 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFX_2147832245_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFX!MTB"
        threat_id = "2147832245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1f 3b 8f 05 00 00 01 25 71 05 00 00 01 7e 25 00 00 04 1f 3a 95 61 81 05 00 00 01 38 80 00 00 00 7e 20 00 00 04 1f 3b 95 7e 25 00 00 04 20 17 01 00 00 95 33 47 7e 32 00 00 04 7e 25 00 00 04 20 f3 03 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {7e 25 00 00 04 20 80 02 00 00 95 5f 7e 25 00 00 04 20 ff 00 00 00 95 61 59 81 05 00 00 01 38 d0 02 00 00 7e 20 00 00 04 1f 3b 95 7e 25 00 00 04 20 ed 01 00 00 95 33 61 7e 06 00 00 04 16 9a 17 9a 7e 20 00 00 04 1f 13}  //weight: 1, accuracy: High
        $x_1_3 = {57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_4 = "get_BaseDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWB_2147832329_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWB!MTB"
        threat_id = "2147832329"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1f 61 95 2e 03 17 2b 01 16 7e 19 00 00 04 7e 21 00 00 04 19 9a 20 4f 09 00 00 95 e0 95 7e 21 00 00 04 19 9a 20 9f 08 00 00 95 61 7e 21 00 00 04 19 9a 20 40 10 00 00 95 2e 09}  //weight: 1, accuracy: High
        $x_1_2 = {57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_3 = "GetFolderPath" ascii //weight: 1
        $x_1_4 = "get_CurrentDomain" ascii //weight: 1
        $x_1_5 = "AppDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWD_2147832348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWD!MTB"
        threat_id = "2147832348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1f 2d 7e 30 00 00 04 20 a3 02 00 00 95 9e 7e 39 00 00 04 1f 42 8f 07 00 00 01 25 71 07 00 00 01 7e 30 00 00 04 20 4c 03 00 00 95 61 81 07 00 00 01 2a 7e 39 00 00 04 1f 42 95 7e 30 00 00 04 20 25 03 00 00 95 40 c1 00 00 00 7e 0d 00 00 04 19}  //weight: 1, accuracy: High
        $x_1_2 = {57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_3 = "GetFolderPath" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWE_2147832446_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWE!MTB"
        threat_id = "2147832446"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2e 00 72 00 00 05 65 00 73 00 00 05 6f 00 75 00 00 05 72 00 63 00 00 1d 76 00 64 00 6e 00 6b 00 61 00 64 00 77 00 70 00 69 00 71 00 38 00 79 00 79 00 74 00 00 1d 42 00 5a 00 43 00 42 00 5a}  //weight: 1, accuracy: High
        $x_1_2 = "vcnkchafsfoiu90" ascii //weight: 1
        $x_1_3 = "GetManifestResourceNames" ascii //weight: 1
        $x_1_4 = "BZCBZDVIUAFW89" ascii //weight: 1
        $x_1_5 = "S00y0000s0t0e0m0000" ascii //weight: 1
        $x_1_6 = "R0e0f00000l0e0c0t0i00000o00000n" ascii //weight: 1
        $x_1_7 = "00s00sem00000bly00000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWA_2147832605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWA!MTB"
        threat_id = "2147832605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$f346e55f-46d3-43a8-91e9-50f87e0cd5cb" ascii //weight: 1
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "DebuggableAttribute" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWC_2147832606_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWC!MTB"
        threat_id = "2147832606"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 07 11 07 2c 3b 11 04 1f 21 8c ?? ?? ?? 01 09 1f 0e 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 1f 5e 8c ?? ?? ?? 01 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 04 00 2b 16 00 11 04 09}  //weight: 1, accuracy: Low
        $x_1_2 = "ITITITITIITITITITITITTIITIT" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFV_2147832832_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFV!MTB"
        threat_id = "2147832832"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 00 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c5}  //weight: 10, accuracy: Low
        $x_10_2 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c9}  //weight: 10, accuracy: Low
        $x_1_3 = "3a14dc6c47d7" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NFU_2147832859_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFU!MTB"
        threat_id = "2147832859"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {03 02 7b 6f 00 00 04 04 02 7b 6f 00 00 04 6f 32 01 00 0a 5d 6f 33 01 00 0a 61 d2 2a}  //weight: 1, accuracy: High
        $x_1_2 = {57 d7 a2 3f 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 af 00 00 00 14 00 00 00 8e 00 00 00 7a 00 00 00 6c 00 00 00 02 00 00 00 4c 01 00 00 13}  //weight: 1, accuracy: High
        $x_1_3 = "Options|*.bulkpdf" ascii //weight: 1
        $x_1_4 = "rtbLibraries.Text" ascii //weight: 1
        $x_1_5 = "options.txt" ascii //weight: 1
        $x_1_6 = "BulkPDF.exe" ascii //weight: 1
        $x_1_7 = "ExceptionPDFFileAlreadyExistsAndInUse" ascii //weight: 1
        $x_1_8 = "BulkPDF.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AZ_2147832869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AZ!MTB"
        threat_id = "2147832869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 9a 20 72 0d 00 00 95 e0 7e 1a 00 00 04 16 9a 20 88 0e 00 00 95 d2 9c 7e 2a 00 00 04 7e 1a 00 00 04 16 9a 20 c5 06 00 00 95 61}  //weight: 2, accuracy: High
        $x_2_2 = {16 9a 20 b1 07 00 00 95 e0 95 7e 1a 00 00 04 16 9a 20 38 10 00 00 95 61 7e 1a 00 00 04 16 9a 20 69 11 00 00 95 2e 03 17 2b 01 16 58}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AHM_2147832872_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AHM!MTB"
        threat_id = "2147832872"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7e 1a 00 00 04 19 9a 1f 16 07 0c 95 7e 1a 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFT_2147832945_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFT!MTB"
        threat_id = "2147832945"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 00 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c5}  //weight: 1, accuracy: Low
        $x_1_2 = "uG.B1" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NFQ_2147832959_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NFQ!MTB"
        threat_id = "2147832959"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1f 2a 8f 07 00 00 01 25 71 07 00 00 01 7e 2e 00 00 04 20 33 04 00 00 95 61 81 07 00 00 01 7e 2e 00 00 04 2c 08 7e 2e 00 00 04 8e 69 0a 7e 31 00 00 04 17 9a 1f 2a 95 7e 2e 00 00 04 20 64 03 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AY_2147833013_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AY!MTB"
        threat_id = "2147833013"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 07 06 07 91 03 17 91 61 d2 9c 06 07 06 07 91 1f 18 61 d2 9c 06 07 03 08 91 03 16 91 03 17 91 61 d2 61 d2 9c 07 17 58 0b 08 17 58 0c 08 03 8e 69 32 cd}  //weight: 2, accuracy: High
        $x_2_2 = "r2resurrection.ru" wide //weight: 2
        $x_1_3 = "XorDecode" ascii //weight: 1
        $x_1_4 = "XorEncode" ascii //weight: 1
        $x_1_5 = "Base64DecodeEx" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJB_2147833034_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJB!MTB"
        threat_id = "2147833034"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 11 04 93 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 11 04 15 d6 13 04 11 04 16 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "FromBase64" ascii //weight: 1
        $x_1_3 = {00 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 00}  //weight: 1, accuracy: High
        $x_1_4 = {00 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 64 00}  //weight: 1, accuracy: High
        $x_1_5 = {00 73 73 73 73 73 73 73 73 73 73 73 73 73 73 73 73 73 73 73 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJC_2147833035_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJC!MTB"
        threat_id = "2147833035"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 08 05 00 00 07 0d 95 60 7e 2f 00 00 04 19 9a 20 76 04 00 00 95 61 11 06 0d 7e 2f 00 00 04 19 9a 20 80 02 00 00 95 2e 03 16 2b 01 17 17 59 7e 2f 00 00 04 19 9a 20 9e 04 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABA_2147833105_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABA!MTB"
        threat_id = "2147833105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2b 1d 09 6f [0-3] 0a 13 07 08 11 07 07 02 11 07 18 5a 18 6f [0-3] 0a 6f [0-3] 0a 9c 09 6f}  //weight: 2, accuracy: Low
        $x_1_2 = "Elredkccjrnemqqqidohk" ascii //weight: 1
        $x_1_3 = "GetBuffer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABA_2147833105_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABA!MTB"
        threat_id = "2147833105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {16 0d 2b 31 00 07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 00 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c5 06 17 58 0a 00 08 17 58 0c 08 20 ?? ?? ?? 00 fe 04 13 05 11 05 2d a9 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 80 ?? ?? ?? 04 2a}  //weight: 6, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "Grey" wide //weight: 1
        $x_1_4 = "AppKataCsvViewer.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAB_2147833106_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAB!MTB"
        threat_id = "2147833106"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c9 06 17 58 0a 08 17 58 0c 08 20 ?? ?? ?? 00 fe 04 13 05 11 05 2d af}  //weight: 4, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJA_2147833122_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJA!MTB"
        threat_id = "2147833122"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JgHqQ>AQQfDIgIqQ>AQwe" wide //weight: 1
        $x_1_2 = "$cb5a56df-be49-4c50-a10d-a3a141a5cf27" ascii //weight: 1
        $x_1_3 = "HBRS.Resources.resource" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJD_2147833123_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJD!MTB"
        threat_id = "2147833123"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$42fe5296-e09c-4e64-a713-5d2012c9a9ee" ascii //weight: 1
        $x_1_2 = "GameNetwork.Properties" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "ColorTranslator" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJE_2147833136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJE!MTB"
        threat_id = "2147833136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 24 04 00 00 95 2e 03 16 2b 01 17 7e 1e 00 00 04 1a 9a 1f 72 95 5a 7e 1e 00 00 04 1a 9a 20 c6 00 00 00 95 07 0c 58 61 81 07 00 00 01 7e 09 00 00 04 18 95 7e 1e 00 00 04 1a 9a 20 bc 00 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {1f 4f 7e 0a 00 00 04 17 9a 1f 4f 95 7e 0a 00 00 04 17 9a 1f 3d 95 61 7e 35 00 00 04 20 3e 09 00 00 95 5a 9e 7e 0a 00 00 04 17 9a 1f 3b 8f 09 00 00 01 25 71 09 00 00 01 7e 35 00 00 04 20 38 06}  //weight: 1, accuracy: High
        $x_1_3 = {2e 03 17 2b 01 16 58 7e 2c 00 00 04 7e 1e 00 00 04 16 9a 20 88 04 00 00 95 e0 95 7e 1e 00 00 04 16 9a 20 94 0e 00 00 95 61 7e 1e 00 00 04 16 09 0a 9a 20 8a 0e 00 00 95}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJF_2147833144_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJF!MTB"
        threat_id = "2147833144"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 36 03 00 00 95 9e 7e 07 00 00 04 7e 21 00 00 04 1c 9a 20 68 04 00 00 95 61 80 07 00 00 04 7e 07 00 00 04 7e 21 00 00 04 1c 9a 20 d5 01 00 00 07 0b 95 40 eb 00 00 00 7e 05 00 00 04 17 9a 18 9a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJG_2147833186_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJG!MTB"
        threat_id = "2147833186"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 e8 06 00 00 95 5f 7e 07 00 00 04 18 9a 20 78 02 00 00 95 61 59 81 05 00 00 01 38 5a 03 00 00 7e 04 00 00 04 1f 4c 95 7e 07 00 00 04 18 9a 20 87 03 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {20 f6 04 00 00 95 33 27 7e 38 00 00 04 18 9a 1f 34 8f 06 00 00 01 25 71 06 00 00 01 7e 38 00 00 04 17 9a 20 cd 04 00 00 95 61 81 06 00 00 01 7e 38 00 00 04 18 9a 1f 34 95 7e 38 00 00 04 17 9a 20 95 03 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJH_2147833216_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJH!MTB"
        threat_id = "2147833216"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 27 00 00 04 18 9a 7e 07 00 00 04 20 97 12 00 00 95 e0 95 7e 07 00 00 04 20 ce 00 00 00 95 61 7e 07 00 00 04 20 a5 04 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJJ_2147833316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJJ!MTB"
        threat_id = "2147833316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 45 04 00 00 95 5f 7e 60 00 00 04 1a 9a 20 fa 03 00 00 95 61 59 81 06 00 00 01 7e 60 00 00 04 11 08 13 0e 16 9a 1f 3e 95 7e 60 00 00 04 1a 9a 20 90 01 00 00 95 40 cc 00 00 00 7e 60 00 00 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJL_2147833317_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJL!MTB"
        threat_id = "2147833317"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {3d 00 3d 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e}  //weight: 1, accuracy: High
        $x_1_2 = {41 00 34 00 43 00 41 00 77 00 41 00 67 00 4c 00 41 00 45 00 44 00 3e 00 41 00 67 00 62 00 41 00 38 00 47 00 41 00 70 00 3b 00 77}  //weight: 1, accuracy: High
        $x_1_3 = "UHDFSWIFGBHIUSY22413546534" ascii //weight: 1
        $x_1_4 = "UHDFSWIFGBHIUSY235431245" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJN_2147833372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJN!MTB"
        threat_id = "2147833372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {ae 55 ba 4e 16 62 1a 59 ba 4e 28 00 23 90 da 7d 29 00 84 76 21 7c 13 66 41 53 6d 51 35 5f bb 9e 07 5c 4a 90 32 62}  //weight: 1, accuracy: High
        $x_1_2 = "Mahjong.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "$33da840a-7133-4f5a-9749-c0b5b5928867" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
        $x_1_6 = "ToWin32" ascii //weight: 1
        $x_1_7 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJP_2147833393_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJP!MTB"
        threat_id = "2147833393"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {7e 2a 00 00 04 ?? 0a 16 9a 1f 44 95 7e 2a 00 00 04 17 9a 20 a0 0d 00 00 95 61 09 0a 7e 2a 00 00 04 17 9a 20 be 0a 00 00 95 2e 03 16 2b 01 17 7e 2a 00 00 04 17 9a 20 bb 02 00 00 20}  //weight: 1, accuracy: Low
        $x_1_2 = {7e 06 00 00 04 20 13 02 00 00 95 e0 95 7e 06 00 00 04 11 05 13 05 20 2b 08 00 00 95 61 7e 06 00 00 04 20 12 06 00 00 95 2e 05 08 0c 17 2b 08 16}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJQ_2147833436_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJQ!MTB"
        threat_id = "2147833436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1f 30 11 08 0d 8f 08 00 00 01 25 71 08 00 00 01 7e 33 00 00 04 17 9a 20 65 04 00 00 95 61 81 08 00 00 01 38 3a 01 00 00 7e 33 00 00 04 1a 9a 1f 30 95 7e 33 00 00 04 17 9a 20 20 04 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {7e 2b 00 00 04 7e 04 00 00 04 17 9a 20 25 08 00 00 95 61 80 2b 00 00 04 2b 61 7e 2b 00 00 04 7e 04 00 00 04 17 9a 20 56 0b 00 00}  //weight: 1, accuracy: High
        $x_1_3 = {1f 5f 95 58 81 0a 00 00 01 7e 09 00 00 04 7e 12 00 00 04 20 91 02 00 00 95 61 80 09 00 00 04 7e 09 00 00 04 7e 12 00 00 04 20 5e 04 00 00 95 33 30 7e 2d 00 00 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJI_2147833438_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJI!MTB"
        threat_id = "2147833438"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$070ad16e-bf82-4d9b-a800-d2c8bd52760a" ascii //weight: 10
        $x_10_2 = "$7af47a03-fabf-458b-be6f-4f8bef89a7e6" ascii //weight: 10
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AHY_2147833494_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AHY!MTB"
        threat_id = "2147833494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 16 0b 2b 0d 00 06 6f ?? ?? ?? 06 00 00 07 17 58 0b 07 20 a0 86 01 00 fe 04 0c 08 2d e7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEN_2147833500_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEN!MTB"
        threat_id = "2147833500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "33"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "Select * from Win32_ComputerSystem" wide //weight: 5
        $x_5_2 = "/c @echo off & echo const" wide //weight: 5
        $x_5_3 = "root\\CIMV2" wide //weight: 5
        $x_5_4 = "Connected to the server" wide //weight: 5
        $x_5_5 = "/c taskkill /F /PID {0} & exit" wide //weight: 5
        $x_2_6 = "snxhk.dll" wide //weight: 2
        $x_2_7 = "set_PcName" ascii //weight: 2
        $x_2_8 = "set_CreateNoWindow" ascii //weight: 2
        $x_2_9 = "ProcessWindowStyle" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAJ_2147833556_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAJ!MTB"
        threat_id = "2147833556"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 08 18 5b 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 08 18 58 0c 08 06 32 e4 07 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "Rxniqvtbcytropjkof.Fxrgxuczflcrzdv" wide //weight: 1
        $x_1_3 = "Aguqbletfus" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAK_2147833557_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAK!MTB"
        threat_id = "2147833557"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 08 18 5b 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 08 18 58 0c 08 06 32 e4 07 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "Epvftcumsmbrt.Qbllyyionpldi" wide //weight: 1
        $x_1_3 = "Gmvhxvznbama" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAM_2147833558_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAM!MTB"
        threat_id = "2147833558"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 7e ?? ?? ?? 04 06 28 ?? ?? ?? 06 d2 9c 00 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c5 06 17 58 0a 00 08 17 58 0c 08 20 ?? ?? ?? 00 fe 04 13 05 11 05 2d a9}  //weight: 5, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "HarmonyEditor.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAN_2147833559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAN!MTB"
        threat_id = "2147833559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {fe 04 13 05 20 ?? ?? ?? 00 28 ?? ?? ?? 06 3a ?? ?? ?? ff 26 20 ?? ?? ?? 00 38 ?? ?? ?? ff 00 11 01 11 02 11 03 28 ?? ?? ?? 06 28 ?? ?? ?? 06 20 ?? ?? ?? 00 28 ?? ?? ?? 06 3a ?? ?? ?? ff 26 38 ?? ?? ?? ff 38 ?? ?? ?? ff 38 ?? ?? ?? 00 38 ?? ?? ?? 00 38 ?? ?? ?? ff 00 16 13 03 20 ?? ?? ?? 00 38 ?? ?? ?? ff 38 ?? ?? ?? 00 38 ?? ?? ?? ff 00 11 03 17 58 13 03 20 ?? ?? ?? 00 38 ?? ?? ?? ff 11 00 17 58 13 00 20 ?? ?? ?? 00 38 ?? ?? ?? ff 2a}  //weight: 2, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "F4.tA" wide //weight: 1
        $x_1_4 = "HarmonyEditor.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAY_2147833565_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAY!MTB"
        threat_id = "2147833565"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0c 08 39 28 01 00 00 00 28 06 00 00 06 00 28 04 00 00 06 0d 12 03 28 1e 00 00 0a 12 03 28 1f 00 00 0a 20 0a 20 26 00 73 20 00 00 0a 13 04 11 04 28 21 00 00 0a 13 06 00 11 06 12 03 28 22 00 00 0a 7e 23 00 00 0a 11 04 6f 24 00 00 0a 6f 25 00 00 0a 00 00 de 0d}  //weight: 1, accuracy: High
        $x_1_2 = "GetRequestStream" ascii //weight: 1
        $x_1_3 = "CaptureMyScreen" ascii //weight: 1
        $x_1_4 = "CaptureDesktop" ascii //weight: 1
        $x_1_5 = "$54c9a740-9bda-441f-a215-ad8db00d485d" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJK_2147833573_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJK!MTB"
        threat_id = "2147833573"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$d546fbff-0255-440f-9bdb-7f9e98b66b69" ascii //weight: 10
        $x_10_2 = "$b28353ec-a8d7-4d03-a916-c013b8c663ae" ascii //weight: 10
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NJS_2147833580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJS!MTB"
        threat_id = "2147833580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {1f 4e 33 05 14 13 05 de 36 06 07 1f 10 6f 24 00 00 0a 25 26 0c 08 20 03 02 00 00}  //weight: 1, accuracy: High
        $x_1_2 = "$e645e574-8672-46f0-bd84-9782b1e92d38" ascii //weight: 1
        $x_1_3 = {48 55 50 4b 4f 4d 4e 4c 42 59 2e 65 78 65 00 6d 73 63 6f 72 6c 69 62 00 53 79 73 74 65 6d 00 48 55 50 4b 4f 4d 4e 4c 42 59 26 26}  //weight: 1, accuracy: High
        $x_1_4 = "SFVQS09NTkxCWSU=" ascii //weight: 1
        $x_1_5 = {57 15 02 08 09 01 00 00 00 fa 01 33 00 02 00 00 01 00 00 00 33 00 00 00 07 00 00 00 0c 00 00 00 1b 00 00 00 14 00 00 00 49 00 00 00 11 00 00 00 0d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJT_2147833594_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJT!MTB"
        threat_id = "2147833594"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 73 0e 00 00 95 5f 7e 0e 00 00 04 20 4f 0a 00 00 95 61 61 81 07 00 00 01 7e 14 00 00 04 19 9a 1f 4f 95 7e 0e 00 00 04 20 51 04 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {7e 0c 00 00 04 18 9a 7e 2b 00 00 04 20 e7 11 00 00 95 e0 95 7e 2b 00 00 04 20 77 08 00 00 95 61 7e 2b 00 00 04 20 8e 10 00 00 95 2e 07 11 04 13 05 17 2b 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAA_2147833618_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAA!MTB"
        threat_id = "2147833618"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0c 16 0d 38 16 00 00 00 08 07 09 07 8e 69 5d 91 02 09 91 61 d2 6f ?? ?? ?? 0a 09 17 58 0d 09 02 8e}  //weight: 10, accuracy: Low
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJW_2147833649_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJW!MTB"
        threat_id = "2147833649"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 d7 0b 00 00 95 e0 95 7e 2a 00 00 04 17 9a 20 9c 0e 00 00 95 61 7e 2a 00 00 04 17 9a 20 26 0e 00 00 95 2e 03 17 2b 07 16}  //weight: 1, accuracy: High
        $x_1_2 = {7e 1d 00 00 04 18 9a 20 c5 0f 00 00 95 e0 11 05 13 07 95 7e 1d 00 00 04 18 9a 20 32 0d 00 00 95 61 7e 1d 00 00 04 18 9a 20 0a 09 00 00 95 2e 03}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJX_2147833663_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJX!MTB"
        threat_id = "2147833663"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 3d 00 00 04 18 9a 7e 3d 00 00 04 17 9a 20 de 07 00 00 95 e0 95 7e 3d 00 00 04 17 9a 20 71 0a 00 00 95 61 7e 3d 00 00 04 09 0d 17 9a 20 16 11 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJX_2147833663_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJX!MTB"
        threat_id = "2147833663"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "45"
        strings_accuracy = "High"
    strings:
        $x_30_1 = "$ed1f40e6-a004-4d58-8451-1873e9817c07" ascii //weight: 30
        $x_10_2 = {08 17 58 0c 06 17 58 0a 06 20 00 24 01 00 fe 04 13 06 11 06 2d a6}  //weight: 10, accuracy: High
        $x_10_3 = {50 4c 4f 4b 4d 34 30 00 63 63 63 00 50 4c 4f 4b 4d 34 31 00 42 69 74 6d 61 70 00 50 4c 4f 4b 4d 34 32 00 78 00 79 00 50 4c 4f 4b 4d 33 33 00 41 73 73 65 6d}  //weight: 10, accuracy: High
        $x_1_4 = "kuliSAP1.Properties.Resources.resource" ascii //weight: 1
        $x_1_5 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_6 = "ColorTranslator" ascii //weight: 1
        $x_1_7 = "GetPixel" ascii //weight: 1
        $x_1_8 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_30_*) and 1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((1 of ($x_30_*) and 2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NJZ_2147833729_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJZ!MTB"
        threat_id = "2147833729"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 28 ?? ?? ?? 06 28 ?? 00 00 06 00 28 ?? 00 00 06 28 ?? 00 00 06 28 ?? 00 00 06 00 07 28 ?? 00 00 06 d2 6f ?? 00 00 0a 00 00 11 04 17 58 13 04 11 04 17 fe 04 13 05 11 05 2d c1}  //weight: 1, accuracy: Low
        $x_1_2 = "SDDSDDSDUJHDGUHIJSGD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABB_2147833749_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABB!MTB"
        threat_id = "2147833749"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {95 6e 31 03 16 2b 01 17 7e 11 00 00 04 18 9a 20 5d 0e 00 00 95 5a 7e 11 00 00 04 18 9a 20 34 07 00 00 95 58 61 81 07 00 00 01}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ACIX_2147833822_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ACIX!MTB"
        threat_id = "2147833822"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {8c 6c 00 00 01 0d 09 1f 21 8c 6c 00 00 01 16 28 ?? ?? ?? 0a 09 1f 7e 8c 6c 00 00 01 16 28}  //weight: 2, accuracy: Low
        $x_1_2 = "GameSense01" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABC_2147833865_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABC!MTB"
        threat_id = "2147833865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 5a 58 9e 11 08 7e ?? ?? ?? 04 59 7e ?? ?? ?? 04 20 aa 04 00 00 95 7e ?? ?? ?? 04 7e ?? ?? ?? 04 20 cd 01 00 00 95 61 11 08 58 7e ?? ?? ?? 04 20 4f 0a 00 00 95 5f 5a 58}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJV_2147833876_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJV!MTB"
        threat_id = "2147833876"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {3d 00 3d 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e}  //weight: 1, accuracy: High
        $x_1_2 = {41 00 6c 00 3b 00 67 00 64 00 41 00 45 00 47 00 41 00 49 00 4e 00 45 00 3e 00 67 00 47 00 41 00 6a 00 3b 00 51 00 59 00 41 00 55}  //weight: 1, accuracy: High
        $x_1_3 = {3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 3e 00 44 00 41 00 75 00 3e 00 4d 00 41 00 34 00 43 00 41 00 77 00 41 00 67 00 4c 00 41}  //weight: 1, accuracy: High
        $x_1_4 = {34 00 67 00 2f 00 76 00 59 00 39 00 41 00 38 00 2f 00 3b 00 46 00 43 00 77 00 2f 00 37 00 45 00 4c 00 41 00 2f 00 48 00 31 00 79 00 41 00 38 00 66}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJY_2147833932_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJY!MTB"
        threat_id = "2147833932"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "42"
        strings_accuracy = "High"
    strings:
        $x_30_1 = "$2c77b6f7-282a-4bc9-a510-a7feae276d4d" ascii //weight: 30
        $x_30_2 = "$a206969e-1dcb-4799-992f-dfe429b8f9e8" ascii //weight: 30
        $x_10_3 = "Thumbnail_Handler.Resource" ascii //weight: 10
        $x_10_4 = "RainbowUI.Properties.Resource" ascii //weight: 10
        $x_1_5 = "DebuggableAttribute" ascii //weight: 1
        $x_1_6 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_30_*) and 1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((1 of ($x_30_*) and 2 of ($x_10_*))) or
            ((2 of ($x_30_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NVK_2147833933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVK!MTB"
        threat_id = "2147833933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fhfssddssdfhfddfhhs" ascii //weight: 1
        $x_1_2 = "gasdsfdfshsg" ascii //weight: 1
        $x_1_3 = "sddddffshhdjfffffgjskdgsfacsafp" ascii //weight: 1
        $x_1_4 = "nhffskdskdaffddhscffdf" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
        $x_1_6 = "GetMethods" ascii //weight: 1
        $x_1_7 = "Rfc2898DeriveBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDB_2147834169_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDB!MTB"
        threat_id = "2147834169"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Moserware2022 2022-2023" ascii //weight: 1
        $x_1_2 = "Sailor A" ascii //weight: 1
        $x_1_3 = "ColorTranslator" ascii //weight: 1
        $x_1_4 = "ToWin32" ascii //weight: 1
        $x_1_5 = "GetPixel" ascii //weight: 1
        $x_1_6 = "bc5850dc-8d05-4fd8-92ff-62de0dfb8466" ascii //weight: 1
        $x_1_7 = "Activator" ascii //weight: 1
        $x_1_8 = "CreateInstance" ascii //weight: 1
        $x_1_9 = "User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABE_2147834238_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABE!MTB"
        threat_id = "2147834238"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0b 95 2e 03 16 2b 01 17 17 59 7e 02 00 00 04 20 33 09 00 00 07 0b 95 5f 7e 02 00 00 04 07 0b 20 d6 0e 00 00 95 61 59 80 1a 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAD_2147834248_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAD!MTB"
        threat_id = "2147834248"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "27"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 07 02 8e 69 5d 02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 07 17 58 02 8e 69 5d 91}  //weight: 10, accuracy: Low
        $x_5_2 = "Abz_002" ascii //weight: 5
        $x_5_3 = {41 62 7a 5f 30 30 32 00 64 61 74 61 32 00 4d 61 78 69 6d 69 7a 65 00 4d 69 6e 69 6d 69 7a 65 00 4f 6e 53 74 61 74 65 43 68 61 6e 67 65 64}  //weight: 5, accuracy: High
        $x_1_4 = "TrayClient" ascii //weight: 1
        $x_1_5 = "IndicatorServer" ascii //weight: 1
        $x_1_6 = "GetIndicatorStates" ascii //weight: 1
        $x_1_7 = "Deserialize" ascii //weight: 1
        $x_1_8 = "StartTimer" ascii //weight: 1
        $x_1_9 = "GetDomain" ascii //weight: 1
        $x_1_10 = "Qupla.IndicatorServer.TrayClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAB_2147834306_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAB!MTB"
        threat_id = "2147834306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 17 a2 0b 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 cf 00 00 00 2b 00 00 00 d0 00 00 00 06 02 00 00 52 01 00 00 12 00 00 00 8a 01 00 00 82 00 00 00 36 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00 15}  //weight: 5, accuracy: High
        $x_5_2 = "2bc6e22b-231a-4b73-a0ea-57df3aea8ee5" ascii //weight: 5
        $x_5_3 = "Strickler.Resources.resources" ascii //weight: 5
        $x_1_4 = "HideModuleNameAttribute" ascii //weight: 1
        $x_1_5 = "set_ShortcutKeys" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAC_2147834307_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAC!MTB"
        threat_id = "2147834307"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {57 94 02 28 09 02 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 1b 00 00 00 04 00 00 00 3f 00 00 00 1c 00 00 00 21 00 00 00 04 00 00 00 01 00 00 00 1b 00 00 00 06 00 00 00 01 00 00 00 01 00 00 00 01 00}  //weight: 5, accuracy: High
        $x_5_2 = {0b 01 0b 00 00 fc 02 00 00 08 00 00 00 00 00 00 9e 1b 03 00 00 20 00 00 00 20 03}  //weight: 5, accuracy: High
        $x_2_3 = ".sdata" ascii //weight: 2
        $x_2_4 = "_ComCTL" ascii //weight: 2
        $x_2_5 = {4d 69 63 67 5f 4d [0-6] 6f 78 79}  //weight: 2, accuracy: Low
        $x_2_6 = "_3D_Flyingrees" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABBM_2147834311_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABBM!MTB"
        threat_id = "2147834311"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateInstance" ascii //weight: 1
        $x_1_2 = "ColorTranslator" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "$bc5850dc-8d05-4fd8-92ff-62de0dfb8466" ascii //weight: 1
        $x_1_5 = "Moserware20222022.Properties.Resources" wide //weight: 1
        $x_1_6 = "BWTopC" wide //weight: 1
        $x_1_7 = "cheese" wide //weight: 1
        $x_1_8 = "DesertGuy" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABBP_2147834314_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABBP!MTB"
        threat_id = "2147834314"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 04 03 8e 69 14 14 17 28 ?? ?? ?? 06 d6 13 07 11 07 04 5f 13 08 03 11 06 03 8e 69 14 14 17 28 ?? ?? ?? 06 91 13 09 08 74 ?? ?? ?? 1b 11 06 16 16 02 17 8d ?? ?? ?? 01 25 16 11 06 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 16 16 11 09 8c ?? ?? ?? 01 11 08 8c ?? ?? ?? 01 18 28 ?? ?? ?? 06 8c ?? ?? ?? 01 18 28 ?? ?? ?? 06 b4 9c 11 06 17 d6 13 06}  //weight: 1, accuracy: Low
        $x_1_2 = "WindowsApp1.Resources" wide //weight: 1
        $x_1_3 = "njhuh77676" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABH_2147834320_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABH!MTB"
        threat_id = "2147834320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1b 9a 20 e1 01 00 00 95 2e 03 16 2b 01 17 7e 0d 00 00 04 1b 9a 20 69 01 00 00 95 5a 7e 0d 00 00 04 1b 9a 20 c5 00 00 00 95 58 61 80 1d 00 00 04}  //weight: 2, accuracy: High
        $x_2_2 = {1a 9a 20 70 06 00 00 95 6e 09 0d 31 03 16 2b 01 17 7e 09 00 00 04 1a 9a 20 64 10 00 00 95 5a 7e 09 00 00 04 1a 9a 20 8d 0c 00 00 95 58 61 80 0c 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABH_2147834320_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABH!MTB"
        threat_id = "2147834320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 b5 a2 3d 09 0f 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 40 00 00 00 25 00 00 00 53 00 00 00 84 00 00 00 ca 00 00 00}  //weight: 5, accuracy: High
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "MemoryStream" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "GetRuntimeDirectory" ascii //weight: 1
        $x_1_7 = "Confuser" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDG_2147834348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDG!MTB"
        threat_id = "2147834348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ImageTracer" ascii //weight: 1
        $x_1_2 = "84ee293e-b938-4512-8a39-86ffc00ed267" ascii //weight: 1
        $x_1_3 = "NetZad1" ascii //weight: 1
        $x_1_4 = "Hyves" wide //weight: 1
        $x_1_5 = "PLOKM42" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_8 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_9 = "ToWin32" ascii //weight: 1
        $x_1_10 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJU_2147834358_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJU!MTB"
        threat_id = "2147834358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$e5573b1e-02ca-41b8-b12f-6bbc9aeb0d04" ascii //weight: 10
        $x_1_2 = "Martinsville.Resources.resource" ascii //weight: 1
        $x_1_3 = {57 dd a2 ff 09 1f 00 00 00 fa 25 33 00 16 00 00 02}  //weight: 1, accuracy: High
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVG_2147834359_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVG!MTB"
        threat_id = "2147834359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$bc5850dc-8d05-4fd8-92ff-62de0dfb8466" ascii //weight: 10
        $x_10_2 = "$10777fd4-c40a-4d3e-9ce6-bd8e8139e254" ascii //weight: 10
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
        $x_1_6 = "DebuggableAttribute" ascii //weight: 1
        $x_1_7 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NVH_2147834360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVH!MTB"
        threat_id = "2147834360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? 00 06 00 28 ?? ?? ?? 06 28 ?? ?? 00 06 28 ?? ?? 00 06 00 28 ?? ?? 00 06 d2 06 28 ?? ?? 00 06 00 00 09 17 58 0d 09 17 fe 04 13 04 11 04 2d c5}  //weight: 1, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVI_2147834361_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVI!MTB"
        threat_id = "2147834361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65}  //weight: 1, accuracy: High
        $x_1_2 = {53 00 79 00 73 00 74 00 65 00 6d 00 2e 00 00 0f 43 00 6f 00 6e 00 76 00 65 00 72 00 74}  //weight: 1, accuracy: High
        $x_1_3 = {11 46 00 72 00 6f 00 6d 00 42 00 61 00 73 00 65 00 00 11 36 00 34 00 53 00 74 00 72 00 69 00 6e 00 67}  //weight: 1, accuracy: High
        $x_1_4 = "sfdas" ascii //weight: 1
        $x_1_5 = "_ddd" ascii //weight: 1
        $x_1_6 = "_iiiiiiii" ascii //weight: 1
        $x_1_7 = "sadfasf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVJ_2147834362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVJ!MTB"
        threat_id = "2147834362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 3f b6 3f 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 9f 00 00 00 5c 00 00 00 7f 02 00 00 c8 02 00 00 29 02 00 00 25 00 00 00 4c 01 00 00 39}  //weight: 1, accuracy: High
        $x_1_2 = "Sanford.Multimedia.Midi.Properties.Resources" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVN_2147834363_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVN!MTB"
        threat_id = "2147834363"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 17 13 04 00 28 ?? ?? ?? 06 d2 06 28 ?? ?? ?? 06 00 00 00 09 17 58 0d 09 17 fe 04 13 05 11 05 2d c0}  //weight: 3, accuracy: Low
        $x_3_2 = "OIWDHDJWDCHX" ascii //weight: 3
        $x_3_3 = "IOUHFSHFIHYUGBCS" ascii //weight: 3
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABI_2147834365_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABI!MTB"
        threat_id = "2147834365"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1a 9a 20 13 04 00 00 95 2e 03 16 2b 01 17 17 59 7e 3b 00 00 04 1a 9a 20 04 04 00 00 95 5f 7e 3b 00 00 04 1a 9a 20 3c 03 00 00 95 20 01 01 01 01 13 0e 61 58 81 0a 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {1f 40 95 7e 2e 00 00 04 37 03 16 2b 01 17 17 11 04 13 04 59 7e 16 00 00 04 16 9a 20 ab 12 00 00 95 5f 7e 16 00 00 04 16 9a 20 f3 12 00 00 95 61 58 81 05 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVO_2147834381_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVO!MTB"
        threat_id = "2147834381"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 04 00 00 04 1a 9a 20 b2 0a 00 00 95 e0 95 7e 04 00 00 04 1a 9a 20 8d 07 00 00 95 61 7e 04 00 00 04 1a 9a 20 57 12 00 00 95 2e 03 17 2b 01 16 58 7e 04 00 00 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVP_2147834382_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVP!MTB"
        threat_id = "2147834382"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "sfhjfkfhfhjsrfhdhffadsfsfhsscfgdb" ascii //weight: 3
        $x_3_2 = "fhhfgsfrfkfcdshhfdasdfh" ascii //weight: 3
        $x_3_3 = "hfskfdhfshsefafffdch" ascii //weight: 3
        $x_3_4 = "gdddfdsfdhfssfdgh" ascii //weight: 3
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJ_2147834432_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJ!MTB"
        threat_id = "2147834432"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {18 9a 1f 39 95 2c 03 16 2b 01 17 17 59 7e 0e 00 00 04 20 f3 06 00 00 95 5f 7e 0e 00 00 04 1f 5e 95 61 58 81 05 00 00 01}  //weight: 2, accuracy: High
        $x_2_2 = {1f 11 95 7e 0e 00 00 04 20 cf 03 00 00 95 37 03 16 2b 01 17 17 59 7e 0e 00 00 04 20 96 01 00 00 95 5f 7e 0e 00 00 04 20 90 01 00 00 95 61 58 81 08 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVU_2147834524_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVU!MTB"
        threat_id = "2147834524"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 29 00 00 04 17 9a 7e 29 00 00 04 16 9a 20 a3 0b 00 00 95 e0 95 7e 29 00 00 04 16 9a 20 23 07 00 00 95 61 7e 29 00 00 04 16 9a 20 ea 01 00 00 95 2e 03 17 2b 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVV_2147834525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVV!MTB"
        threat_id = "2147834525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 07 06 9a 20 f0 00 00 00 06 5a 07 06 9a 7b 06 01 00 04 2d 04 1f 1b 2b 01 16 73 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 06 9a 20 f0 00 00 00}  //weight: 1, accuracy: Low
        $x_1_2 = {1f a2 0b 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 fc 00 00 00 4a 00 00 00 1d 01 00 00 8e 01 00 00 53 01 00 00 12 00 00 00 3e 02 00 00 03}  //weight: 1, accuracy: High
        $x_1_3 = "9e03-806dae53adea" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVW_2147834526_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVW!MTB"
        threat_id = "2147834526"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 16 11 04 6f ?? 00 00 0a 08 09 16 09 8e 69 6f ?? 00 00 0a 25 13 04 16 30 e5}  //weight: 1, accuracy: Low
        $x_1_2 = "Twkzidbtf.Btszakvlc" wide //weight: 1
        $x_1_3 = "80.66.75.25/pl-Ufbzyarn_Usbqhaee.bmp" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVL_2147834649_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVL!MTB"
        threat_id = "2147834649"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 67 06 51 00 4f 00 73 00 41 00 67 06 77 00 41 00 67 06 4e 00}  //weight: 1, accuracy: High
        $x_1_2 = {41 00 57 00 42 00 51 00 41 00 41 00 67 06 45 00 42 00 41 00 67 06 67 06 67 06 67 06 67 06 67 06 49 00 41 00 41 00 67 06 42 00 67 06 67 06 67 06 38 00 44 00}  //weight: 1, accuracy: High
        $x_1_3 = "bWMztb0keao5Pi/bc/f+1H2H3/v" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVM_2147834650_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVM!MTB"
        threat_id = "2147834650"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "H8J8HHBD55C88C752F4NEG" ascii //weight: 10
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetDomain" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVQ_2147834651_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVQ!MTB"
        threat_id = "2147834651"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "IOUHFSHFIHYUGBCS" ascii //weight: 3
        $x_3_2 = "OIWDHDJWDCHX" ascii //weight: 3
        $x_1_3 = "ColorTranslator" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVT_2147834652_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVT!MTB"
        threat_id = "2147834652"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$d1336805-603a-448c-a521-8f4c491ab449" ascii //weight: 10
        $x_1_2 = {57 9f a2 29 09 1e 00 00 00 fa 01 33 00 16 00 00 01}  //weight: 1, accuracy: High
        $x_1_3 = "GetPixel" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVX_2147834653_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVX!MTB"
        threat_id = "2147834653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 00 2b 31 16 2b 31 2b 36 2b 3b 00 09 08 6f ?? 00 00 0a 00 00 de 11}  //weight: 1, accuracy: Low
        $x_1_2 = {15 a2 09 09 0b 00 00 00 10 00 01 00 02 00 00 01}  //weight: 1, accuracy: High
        $x_1_3 = "$088e15fe-afdb-471c-8a80-7e84b390401c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABM_2147834654_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABM!MTB"
        threat_id = "2147834654"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {95 2e 03 16 2b 03 17 09 0d 17 59 09 0d 7e 0e 00 00 04 20 b6 00 00 00 95 5f 7e 0e 00 00 04 06 0a 20 79 01 00 00 95 61 58 81 07 00 00 01}  //weight: 4, accuracy: High
        $x_4_2 = {95 6e 31 03 16 2b 01 17 7e 32 00 00 04 16 9a 20 c2 11 00 00 95 5a 7e 32 00 00 04 16 9a 20 aa 0d 00 00 95 58 61 80 38 00 00 04}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWH_2147834656_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWH!MTB"
        threat_id = "2147834656"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 1a 00 00 04 16 9a 20 15 07 00 00 95 e0 95 7e 1a 00 00 04 16 9a 20 a3 05 00 00 95 61 7e 1a 00 00 04 16 9a 20 34 06 00 00 95 2e 03 17 2b 01 16}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDF_2147834657_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDF!MTB"
        threat_id = "2147834657"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 07 8f 01 00 00 01 25 71 01 00 00 01 11 07 [0-2] 58 ?? 59 20 ff 00 00 00 5f d2 61 d2 81 01 00 00 01 1f 0a 13 10}  //weight: 2, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "ColorTranslator" ascii //weight: 1
        $x_1_5 = "ToWin32" ascii //weight: 1
        $x_1_6 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYA_2147834696_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYA!MTB"
        threat_id = "2147834696"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 28 07 00 00 0a 6f 08 00 00 0a 6f 09 00 00 0a 28 0a 00 00 0a 26 00 2b e7}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWI_2147834709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWI!MTB"
        threat_id = "2147834709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 0c 00 00 04 20 02 0a 00 00 95 e0 95 7e 0c 00 00 04 20 b7 13 00 00 95 61 7e 0c 00 00 04 20 3d 03 00 00 95 2e 03 17 2b 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWJ_2147834772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWJ!MTB"
        threat_id = "2147834772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 09 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 00 28 ?? ?? ?? 06 d2 06 28 ?? ?? ?? 06 00 00 09 1b 59 1c 58 0d 09 17 fe 04 13 0a 11 0a 2d c3}  //weight: 1, accuracy: Low
        $x_1_2 = "PP00006" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWK_2147834773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWK!MTB"
        threat_id = "2147834773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {7e 24 00 00 04 16 9a 20 99 0e 00 00 95 e0 95 7e 24 00 00 04 16 9a 20 6b 08 00 00 95 61 7e 24 00 00 04 16 9a 20 cf 09 00 00 95 2e 09}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABN_2147834833_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABN!MTB"
        threat_id = "2147834833"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {1b 9a 20 31 11 00 00 95 36 03 16 2b 01 17 17 59 7e 2f 00 00 04 1b 9a 20 76 10 00 00 95 5f 09 0a 7e 2f 00 00 04 1b 9a 20 d2 10 00 00 95 61 58 81 0a 00 00 01}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABN_2147834833_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABN!MTB"
        threat_id = "2147834833"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 06 1f 10 8d ?? ?? ?? 01 6f ?? ?? ?? 0a 06 06 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0b 02 28 ?? ?? ?? 06 73 ?? ?? ?? 0a 0c 3c 00 06 72 01 ?? ?? 70 28 05 ?? ?? 06 6f 05}  //weight: 5, accuracy: Low
        $x_1_2 = "DownloadData" ascii //weight: 1
        $x_1_3 = "UploadData" ascii //weight: 1
        $x_1_4 = "GetResponseStream" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "HttpWebRequest" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWM_2147834849_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWM!MTB"
        threat_id = "2147834849"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 36 09 00 00 95 e0 95 7e 31 00 00 04 1a 9a 20 e4 04 00 00 95 61 7e 31 00 00 04 1a 9a 20 7c 0b 00 00 95 2e 03 17}  //weight: 1, accuracy: High
        $x_1_2 = {20 d9 09 00 00 95 e0 95 7e 2f 00 00 04 1b 9a 20 e4 07 00 00 95 61 7e 2f 00 00 04 1b 9a 20 f6 0c 00 00 95 2e 03 17 2b 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABAC_2147834851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABAC!MTB"
        threat_id = "2147834851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 8e 69 6f ?? ?? ?? 0a 8d ?? ?? ?? 01 0d 07 02 16 02 8e 69 09 16 6f ?? ?? ?? 0a 13 04 07 09 11 04 6f ?? ?? ?? 0a 26 28 ?? ?? ?? 0a 09 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 05 de 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "GcmBlockCipher" ascii //weight: 1
        $x_1_3 = "MAXCARE.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABBX_2147834853_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABBX!MTB"
        threat_id = "2147834853"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateInstance" ascii //weight: 1
        $x_1_2 = "IsLogging" ascii //weight: 1
        $x_1_3 = "FlushFinalBlock" ascii //weight: 1
        $x_1_4 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "Avalon.g.resources" ascii //weight: 1
        $x_1_7 = "IsDebuggerPresent" ascii //weight: 1
        $x_1_8 = "$1344c268-c895-4a09-8147-4ca8adb394da" ascii //weight: 1
        $x_1_9 = "Runner" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABBZ_2147834854_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABBZ!MTB"
        threat_id = "2147834854"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "pbDebuggerPresent" ascii //weight: 1
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetManifestResourceStream" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
        $x_1_6 = "TransformFinalBlock" ascii //weight: 1
        $x_3_7 = "Qk5DTlZDVkNYSEok" wide //weight: 3
        $x_3_8 = "BNCNVCVCXHJ$" wide //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCE_2147834857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCE!MTB"
        threat_id = "2147834857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {18 9a 20 b3 0b 00 00 95 9e 7e 26 00 00 04 7e 20 00 00 04 18 9a 20 84 0e 00 00 95 61 80 26 00 00 04 38 6a 09 00 00 7e 26 00 00 04 7e 20 00 00 04 18 9a 20 f0 10 00 00 07 0c 95 40 7c 02 00 00 7e 26 00 00 04 7e 05 00 00 04 7e 20 00 00 04 18 9a 20 67 11 00 00 95 e0 95}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AIIW_2147834900_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AIIW!MTB"
        threat_id = "2147834900"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {a2 25 17 07 a2 25 0c 14 14 18 8d a2 00 00 01 25 17 17 9c 25 0d 17 28}  //weight: 2, accuracy: High
        $x_1_2 = "Rental.Data" wide //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NVS_2147834930_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NVS!MTB"
        threat_id = "2147834930"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 02 11 04 02 11 04 91 11 01 61 11 08 11 03 91 61}  //weight: 1, accuracy: High
        $x_1_2 = "69e7ca2eee15" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWG_2147834931_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWG!MTB"
        threat_id = "2147834931"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 d5 02 20 09 02 00 00 00 da a4 20 00 16 00 00 01 00 00 00 2c 00 00 00 05 00 00 00 01 00 00 00 0a 00 00 00 01 00 00 00 2a 00 00 00 0f 00 00 00 01}  //weight: 10, accuracy: High
        $x_1_2 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_3 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "TransformFinalBlock" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWP_2147834932_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWP!MTB"
        threat_id = "2147834932"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 42 06 00 00 95 61 7e 1d 00 00 04 19 9a 20 3e 0c 00 00 95 2e 03 17 2b 01 16 58 06 13 05 7e 1d 00 00 04 16 9a 7e 1d 00 00 04 19 9a 20 b6 0d 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWS_2147834950_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWS!MTB"
        threat_id = "2147834950"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 73 01 00 00 95 5f 7e 1d 00 00 04 19 9a 20 ac 00 00 00 95 61 59 81 05 00 00 01 38 97 04 00 00 7e 1d 00 00 04 18 9a 1f 20 95 7e 1d 00 00 04 19 9a 07 0b 20 3b 03 00 00 95 40 84 00 00 00 7e 11 00 00 04 16 32 28}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWT_2147835004_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWT!MTB"
        threat_id = "2147835004"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 75 0f 00 00 95 e0 95 7e 31 00 00 04 20 7b 0a 00 00 95 61 7e 31 00 00 04 20 46 04 00 00 95 2e 03 17 2b 01 16 58 7e 21 00 00 04 7e 31 00 00 04 20 86 0a 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABQ_2147835026_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABQ!MTB"
        threat_id = "2147835026"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 6e 31 03 16 2b 01 17 7e 2a 00 00 04 19 9a 20 b1 00 00 00 95 5a 7e 2a 00 00 04 19 9a 20 22 0e 00 00 95 58 61 06 0a 81 05 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWW_2147835115_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWW!MTB"
        threat_id = "2147835115"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 0f 10 00 00 95 5f 7e 07 00 00 04 17 9a 20 8a 0c 00 00 95 61 61 80 05 00 00 04 38 64 11 00 00 7e 05 00 00 04 7e 07 00 00 04 17 9a 20 cf 09 00 00}  //weight: 1, accuracy: High
        $x_1_2 = {20 1a 0f 00 00 95 e0 95 7e 24 00 00 04 20 73 0e 00 00 95 61 7e 24 00 00 04 20 22 12 00 00 95 2e 03 17 2b 01 16 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWN_2147835146_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWN!MTB"
        threat_id = "2147835146"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {25 16 16 8c ?? 00 00 01 a2 25 17 07 a2 25 13 04 14 14 18 8d ?? 00 00 01 25 17 17 9c 25}  //weight: 3, accuracy: Low
        $x_3_2 = "9e15-0887b12947b4" ascii //weight: 3
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWO_2147835148_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWO!MTB"
        threat_id = "2147835148"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "D774Z478V4S7392GGBH54G" ascii //weight: 5
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWY_2147835232_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWY!MTB"
        threat_id = "2147835232"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 21 0a 00 00 95 e0 95 7e 1f 00 00 04 17 9a 20 99 0d 00 00 95 61 7e 1f 00 00 04 17 9a 20 e4 07 00 00 95 2e 03 17 2b 01 16 58 7e 02 00 00 04 7e 1f 00 00 04 17 9a 20 26 05 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCN_2147835241_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCN!MTB"
        threat_id = "2147835241"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 28 ?? ?? ?? 0a 6e 02 07 17 58 02 8e 69 5d 91 28 ?? ?? ?? 0a 6a 59 20 ?? ?? ?? 00 6a 58 20 ?? ?? ?? 00 6a 5d d2 9c 07 15 58 0b}  //weight: 5, accuracy: Low
        $x_1_2 = "SimFarm.EcoFarm.resources" ascii //weight: 1
        $x_1_3 = "Electro" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCU_2147835243_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCU!MTB"
        threat_id = "2147835243"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "InvokeMember" ascii //weight: 1
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_2_3 = "QuanLyCuaHangTivi.Properties.Resources" wide //weight: 2
        $x_2_4 = "Luis1" wide //weight: 2
        $x_2_5 = "QuanLyCuaHangTivi" wide //weight: 2
        $x_2_6 = "OIY54Y55ZBEQ44GF4F57N5" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCV_2147835244_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCV!MTB"
        threat_id = "2147835244"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 13 04 11 04 09 16 09 8e 69 6f ?? ?? ?? 0a de 0b 15 2c 07 11 04 6f ?? ?? ?? 0a dc 07 6f ?? ?? ?? 0a 13 07 de 38 32 00 07 06 6f ?? ?? ?? 0a 17 73}  //weight: 2, accuracy: Low
        $x_1_2 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCY_2147835247_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCY!MTB"
        threat_id = "2147835247"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {17 59 7e 0b 00 00 04 20 16 02 00 00 95 5f 7e 0b 00 00 04 20 dd 04 00 00 95 61 58 80 15 00 00 04 38 ae 06 00 00 7e 15 00 00 04 7e 0b 00 00 04 20 3c 02 00 00 95 33 61 7e 15 00 00 04 7e 2b 00 00 04 17 9a 1c 95 7e 0b 00 00 04 20 ac 03 00 00 95 58}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABT_2147835332_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABT!MTB"
        threat_id = "2147835332"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 53 04 00 00 95 2e 03 16 2b 01 17 7e 08 00 00 04 20 ef 01 00 00 95 5a 7e 08 00 00 04 20 bc 04 00 00 95 58 61 81 07 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = {95 2e 03 16 2b 01 17 17 59 7e 1d 00 00 04 20 e7 06 00 00 95 5f 7e 1d 00 00 04 20 ca 0f 00 00 95 61 59 81 07 00 00 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABU_2147835333_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABU!MTB"
        threat_id = "2147835333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {95 2e 03 16 2b 01 17 17 59 7e 2e 00 00 04 17 9a 20 ae 02 00 00 95 5f 7e 2e 00 00 04 17 9a 20 08 02 00 00 95 61 58 81 0c 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABU_2147835333_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABU!MTB"
        threat_id = "2147835333"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1b 9a 20 9f 0c 00 00 95 6e 31 03 16 2b 01 17 7e 1e 00 00 04 1b 9a 20 e8 0a 00 00 95 5a 7e 1e 00 00 04 1b 9a 20 a0 04 00 00 95 58 61 81 05 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWZ_2147835401_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWZ!MTB"
        threat_id = "2147835401"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 a8 01 00 00 95 9e 7e ?? ?? ?? 04 7e 1e 00 00 04 18 9a 20 c5 04 00 00 95 61 80 23 00 00 04 2b 52 7e 23 00 00 04 7e 1e 00 00 04 18 9a 20 5f 04 00 00 95 33 3e 7e 06 00 00 04 16 9a 19 9a 7e 27 00 00 04 25 17 58 80 27 00 00 04 e0 7e 1e 00 00 04 18 9a 20 37 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NWZ_2147835401_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWZ!MTB"
        threat_id = "2147835401"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 07 17 58 02 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 07}  //weight: 1, accuracy: Low
        $x_1_2 = "P53YSCYRBVHHUP8G47B75Y" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GKS_2147835449_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GKS!MTB"
        threat_id = "2147835449"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VjFkd1QxRXdNVWhTYkdoUVYwWmFjVlJYZUV0TmJIQkdZVVpPVDFJeFNrTlZSbEYzVUZFOVBRPT0=" ascii //weight: 1
        $x_1_2 = "VjFaU1MxWXdOVmRqUldoUVZrVktjbFV3Wkc1a2R6MDk=" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAE_2147835518_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAE!MTB"
        threat_id = "2147835518"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {1d 2c 03 17 2b 03 16 2b 00 2d 1c 2b 14 06 74 04 00 00 1b 18 2c 03 17 2b 03 16 2b 00 2d 0c 26 2b 03 26 2b e9 07 2b 06 0a 2b e3 0b 2b f7}  //weight: 10, accuracy: High
        $x_5_2 = "Bpgvukp.Properties" ascii //weight: 5
        $x_2_3 = "CreateDecryptor" ascii //weight: 2
        $x_2_4 = "lld.jnyscbgdrsxncckbpjzqdxK" wide //weight: 2
        $x_2_5 = "noitalsnarT" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDI_2147835523_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDI!MTB"
        threat_id = "2147835523"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 02 7b 03 ?? ?? ?? 04 02 7b ?? ?? ?? ?? 6f ?? ?? ?? ?? 5d 6f ?? ?? ?? ?? 03 61 d2 2a}  //weight: 2, accuracy: Low
        $x_1_2 = "Kampf" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZA_2147835574_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZA!MTB"
        threat_id = "2147835574"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 bb 0f 00 00 95 7e ?? ?? ?? 04 19 9a 20 28 0f 00 00 95 11 04 61 7e 1d 00 00 04 19 9a 20 ce 0d 00 00 95 59 7e 1d 00 00 04 1a 9a 19 95 61 7e 1d 00 00 04 19 9a 20 7d 04 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZA_2147835574_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZA!MTB"
        threat_id = "2147835574"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$b654eeb3-1bf2-40b8-93ff-5266e7c42600" ascii //weight: 10
        $x_10_2 = "$a00c2fda-b4b9-44b1-ac61-5bb9c9847ae0" ascii //weight: 10
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "CryptoStream" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
        $x_1_6 = "MD5CryptoServiceProvider" ascii //weight: 1
        $x_1_7 = "TransformBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NWX_2147835580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NWX!MTB"
        threat_id = "2147835580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 11 06 06 11 06 9a 1f 10 28 ?? ?? ?? 0a 9c 11 06 17 58 13 06 11 06 06 8e 69 fe 04 13 07 11 07 2d de}  //weight: 10, accuracy: Low
        $x_1_2 = "$aaac1679-1e6c-47eb-a326-39905fc75b33" ascii //weight: 1
        $x_1_3 = "$1e2e38b7-33cb-4384-885c-1e11ccbd2144" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NYB_2147835583_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYB!MTB"
        threat_id = "2147835583"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 15 a2 1d 09 01 00 00 00 fa 25 33 00 16 00 00 01 00 00 00 81 00 00 00 17 00 00 00 dd 01 00 00 1d 01 00 00 6f 01 00 00 f3}  //weight: 1, accuracy: High
        $x_1_2 = "QuanLyNhaDat.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AIJY_2147835610_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AIJY!MTB"
        threat_id = "2147835610"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 11 0c 11 06 11 0c 9a 1f 10}  //weight: 2, accuracy: High
        $x_2_2 = {9c 11 0c 17 58 13 0c 11 0c 11 06 8e 69 fe 04 13 0d 11 0d}  //weight: 2, accuracy: High
        $x_1_3 = "MainPlayerManagementForm" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABX_2147835688_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABX!MTB"
        threat_id = "2147835688"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 7b 0c 00 00 95 2e 03 17 2b 01 16 58 19 31 03 16 2b 01 17 7e 20 00 00 04 20 b2 0a 00 00 95 5a 7e 20 00 00 04 20 98 0e 00 00 95 58 61 81 07 00 00 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABDA_2147835711_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABDA!MTB"
        threat_id = "2147835711"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {16 0b 09 20 ?? ?? ?? 12 5a 20 ?? ?? ?? a5 61 38 ?? ?? ?? ff 00 06 07 02 07 18 5a 18 28 ?? ?? ?? 06 1f 10 28 ?? ?? ?? 06 9c}  //weight: 3, accuracy: Low
        $x_1_2 = "Parrott.Red.resources" ascii //weight: 1
        $x_1_3 = "Parrott" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABDL_2147835717_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABDL!MTB"
        threat_id = "2147835717"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 28 19 01 ?? 0a 28 ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 2, accuracy: Low
        $x_2_2 = {11 04 16 91 2d 02 2b 09 09 16 9a 28 ?? ?? ?? 0a 0c 74 ?? ?? ?? 01 28 ?? ?? ?? 06 00 06 2a}  //weight: 2, accuracy: Low
        $x_1_3 = "BookClubManager.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZC_2147835772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZC!MTB"
        threat_id = "2147835772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 e7 08 00 00 95 e0 95 7e 6c 00 00 04 20 94 0a 00 00 95 61 7e ?? 00 00 04 20 46 09 00 00 95 20 01 01 01 01 13 2e 2e 03 17 2b 01}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANOT_2147835871_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANOT!MTB"
        threat_id = "2147835871"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 06 11 04 11 05 a2 07 11 05 11 04 d2 6f ?? ?? ?? 0a 07 11 05 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCT_2147835891_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCT!MTB"
        threat_id = "2147835891"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {04 08 04 8e 69 5d 7e ?? ?? ?? 04 04 08 04 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 06 04 08 17 58 04 8e 69 5d 91 59 20 ?? ?? ?? 00 58 17 58 20 ?? ?? ?? 00 5d d2 9c 08 17 58 0c 08 6a 04 8e 69 17 59 6a 06 17 58 6e 5a 31 b4}  //weight: 5, accuracy: Low
        $x_1_2 = "dmkIbl" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABDJ_2147835892_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABDJ!MTB"
        threat_id = "2147835892"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {17 59 7e 21 00 00 04 16 9a 20 99 00 00 00 95 5f 7e 21 00 00 04 16 9a 20 af 04 00 00 95 61 59 81 05 00 00 01 7e 21 00 00 04 19 9a 1f 47 95 7e 21 00 00 04 16 9a 20 ce 01 00 00 95 33 7a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZH_2147835933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZH!MTB"
        threat_id = "2147835933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 52 0f 00 70 72 56 0f 00 70 6f ?? ?? ?? 0a 17 8d ?? ?? ?? 01 25 16 1f 26 9d 6f ?? ?? ?? 0a 0a 73 ?? ?? ?? 0a 0b 16 13 08 2b 1d 07 06 11 08 9a 1f 10 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 26 11 08 17 58 13 08}  //weight: 1, accuracy: Low
        $x_1_2 = "SCUIYGTDIUYDSG.r" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZB_2147836035_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZB!MTB"
        threat_id = "2147836035"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 17 58 13 01 ?? ?? ?? ?? 00 11 00 7e ?? ?? ?? 04 11 01 7e ?? ?? ?? 04 8e 69 5d 91 02 11 01 91 61 d2 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZB_2147836035_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZB!MTB"
        threat_id = "2147836035"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 24 00 24 00 24 00 24 00 4d 00 24 00 24 00 24 00 24 00 24 00 24 00 24 00 24 00 45 00 24 00 24 00 24 00 24 00 24 00 24 00 24 00 24 00 2f 00 2f 00 38 00 24 00 24 00 24}  //weight: 1, accuracy: High
        $x_1_2 = {24 00 24 00 51 00 43 00 46 00 6e 00 30 00 6b 00 24 00 24 00 24 00 24 00 24 00 24 00 45 00 24 00 24 00 68 00 38 00 4f 00 66 00 53 00 55 00 24 00 24 00 24 00 24 00 24 00 24 00 51 00 43 00 4b}  //weight: 1, accuracy: High
        $x_1_3 = {51 00 24 00 24 00 24 00 24 00 24 00 24 00 45 00 6c 00 4a 00 53 00 54 00 24 00 24 00 24 00 24 00 50 00 48 00 52 00 34 00 64 00 46 00 4e 00 6c 00 59 00 58 00 4a 00 6a 00 61 00 46 00 39 00 55}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZD_2147836038_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZD!MTB"
        threat_id = "2147836038"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 11 09 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 09 17 58 13 09 11 09 07 8e 69 fe 04 13 0a 11 0a}  //weight: 1, accuracy: Low
        $x_1_2 = {72 8b 01 00 70 72 8f 01 00 70 6f ?? ?? ?? 0a 17 ?? ?? ?? ?? ?? 25 16 1f 40 9d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZF_2147836039_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZF!MTB"
        threat_id = "2147836039"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 03 20 00 87 93 03 6f ?? ?? ?? 0a 80 ?? ?? ?? ?? 38}  //weight: 1, accuracy: Low
        $x_1_2 = "185.246.220.65" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZF_2147836039_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZF!MTB"
        threat_id = "2147836039"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 5d 91 7e ?? 00 00 04 07 91 61 d2 6f ?? 00 00 0a 07 17 58}  //weight: 1, accuracy: Low
        $x_1_2 = {07 7e 01 00 00 04 8e 69 32}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZF_2147836039_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZF!MTB"
        threat_id = "2147836039"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {5f 95 02 3c 09 0a 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 26 00 00 00 07 00 00 00 08 00 00 00 08 00 00 00 11 00 00 00 15 00 00 00 28 00 00 00 06 00 00 00 02 00 00 00 05}  //weight: 5, accuracy: High
        $x_1_2 = "CryptoStream" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "NtWriteVirtualMemory" ascii //weight: 1
        $x_1_5 = "Rfc2898DeriveBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZI_2147836040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZI!MTB"
        threat_id = "2147836040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D&5A&90~&03~~~&04~~~&FF&FF~~&B8~~~~~~~&40~~~~~~~~~~~~~~~~~~~~~~~~~" ascii //weight: 1
        $x_1_2 = "3&F7&35&F2&3A&BD&BB&D2&D7&2A&91&D3&86&EB&48&B8~~~~~~~~&49&39&40&08&" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZJ_2147836047_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZJ!MTB"
        threat_id = "2147836047"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 12 06 00 00 95 e0 95 7e ?? 00 00 04 18 9a 20 e7 0f 00 00 95 61 7e 92 00 00 04 18 9a 20 59 12 00 00 95 2e 03 17 2b 01}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYH_2147836196_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYH!MTB"
        threat_id = "2147836196"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 6f 5e 00 00 0a 16 6a 6f 5f 00 00 0a 08 08 6f 5e 00 00 0a 6f 65 00 00 0a 69 6f 66 00 00 0a 0d 08 6f 67 00 00 0a 09}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYL_2147836197_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYL!MTB"
        threat_id = "2147836197"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 7b 3f 00 00 04 20 80 30 86 f3 28 ?? 00 00 2b 28 ?? 00 00 06 00 11 0f 20 6f f0 6c be 5a}  //weight: 2, accuracy: Low
        $x_2_2 = {7e 01 00 00 04 02 09 16 fe 1c 01 00 00 1b 28 24 00 00 0a 11 07 20 f8 30 12 6a 5a 20 eb 87 ed 72 61}  //weight: 2, accuracy: High
        $x_2_3 = {fe 0c 00 00 20 10 00 00 00 28 ?? 00 00 0a 20 00 00 00 00 28 ?? 00 00 0a fe 0c 06 00 28 17 00 00 06 26}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYM_2147836198_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYM!MTB"
        threat_id = "2147836198"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {26 06 72 4d 01 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 06 6f ?? 00 00 0a 02 16 02 8e 69 6f ?? 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAA_2147836258_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAA!MTB"
        threat_id = "2147836258"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {08 09 08 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 73 ?? ?? ?? 0a 13 04 11 04 08 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 13 05 00 11 05 02 16 02 8e 69 6f ?? ?? ?? 0a 00 11 05 6f ?? ?? ?? 0a 00 00 de}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZL_2147836291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZL!MTB"
        threat_id = "2147836291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {58 fe 0e 16 00 fe 0c 12 00 fe 0c 12 00 59 fe 0c 16 00 61 fe 0c 12 00 58 fe 0e 15 00 fe 0c 11 00 fe 0c 11 00 20 0b}  //weight: 1, accuracy: High
        $x_1_2 = "SUc69TNWUOnZBRaQqQ.kcpIYRZI0B6W9uIfSw" ascii //weight: 1
        $x_1_3 = {52 6b 4d 52 6a 4a 5a 49 5a 5a 72 57 42 61 39 57 56 52 64 00 50 51 62 5a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZL_2147836291_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZL!MTB"
        threat_id = "2147836291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 97 a2 0b 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 90 00 00 00 20 00 00 00 80 00 00 00 16 01 00 00 9f}  //weight: 10, accuracy: High
        $x_1_2 = "XCXCXCXCXCXCCXCXX" ascii //weight: 1
        $x_1_3 = "FFKFFKFFK" ascii //weight: 1
        $x_1_4 = "XCXCXCXCXCXCXCXCXCC" ascii //weight: 1
        $x_1_5 = "XCXCXCXCXCXCXC" ascii //weight: 1
        $x_1_6 = "set_AAAAAAAAAAAAAAAAAAAAA" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZO_2147836456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZO!MTB"
        threat_id = "2147836456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 11 07 09 11 07 09 8e 69 5d 91 08 11 07 91 61 9c 11 07 17 d6 13 07 11 07 11 06 31 e3}  //weight: 1, accuracy: High
        $x_1_2 = {53 00 74 00 00 03 61 00 00 05 72 00 74}  //weight: 1, accuracy: High
        $x_1_3 = "aCKZCIW9kjJFSIOJ90" wide //weight: 1
        $x_1_4 = "postimg.cc/qMm4wK8p" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABDM_2147836472_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABDM!MTB"
        threat_id = "2147836472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0d 09 6f ?? ?? ?? 0a 17 9a 13 04 7e ?? ?? ?? 04 17 8d ?? ?? ?? 01 25 16 1f 25 9d 6f ?? ?? ?? 0a 13 05 11 09 2a 00 08 28}  //weight: 2, accuracy: Low
        $x_1_2 = "CreateInstance" wide //weight: 1
        $x_1_3 = "Game_of_Pig.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABDS_2147836473_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABDS!MTB"
        threat_id = "2147836473"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 05 11 0a 74 ?? ?? ?? 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 75 ?? ?? ?? 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? ?? ?? 0a 26 1f 0c 13 0e}  //weight: 2, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "86a14ad3b7cb44.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABDU_2147836474_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABDU!MTB"
        threat_id = "2147836474"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {07 06 11 08 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 08 17 58 13 08 11 08 06 8e 69 fe 04 13 09 11 09 2d db 07 6f ?? ?? ?? 0a 0c}  //weight: 4, accuracy: Low
        $x_1_2 = "PrisonerManagementSystem_.UIHOJDS" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZM_2147836544_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZM!MTB"
        threat_id = "2147836544"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 11 04 91 11 01 61 11 00 11 03 91 61 13 09}  //weight: 1, accuracy: High
        $x_1_2 = "9c8d7cfeeeda" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZM_2147836544_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZM!MTB"
        threat_id = "2147836544"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Pies.White" wide //weight: 1
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "GetType" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZM_2147836544_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZM!MTB"
        threat_id = "2147836544"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$d9c20f80-818a-4a05-bcb6-c796ab286409" ascii //weight: 10
        $x_1_2 = "GetTypes" ascii //weight: 1
        $x_1_3 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
        $x_1_4 = "GetMethods" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZN_2147836545_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZN!MTB"
        threat_id = "2147836545"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 11 08 9a 1f 10 28 ?? 00 00 0a 8c ?? 00 00 01 6f ?? 00 00 0a 26 11 08 17 58 13 08 11 08 06 8e 69 fe 04 13 09 11 09 2d d6}  //weight: 1, accuracy: Low
        $x_1_2 = {01 25 16 1f 25 9d 6f ?? 00 00 0a 13 05 19 8d ?? 00 00 01 25 16 11 05 16 9a a2 25 17 11 05 17 9a a2 25 18}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABEU_2147836678_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABEU!MTB"
        threat_id = "2147836678"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0a 06 18 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 13 04 02 0d 11 04 09 16 09 8e b7 6f ?? ?? ?? 0a 0b de 11 de 0f 3d 00 06 08 28 ?? ?? ?? 0a 7e ?? ?? ?? 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f}  //weight: 4, accuracy: Low
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFE_2147836681_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFE!MTB"
        threat_id = "2147836681"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 11 04 08 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 13 05 11 05 02 28 ?? ?? ?? 06 00 11 04 6f ?? ?? ?? 0a 10 00 02 13 06 de 0d 11 05 2c 08 11 05 6f ?? ?? ?? 0a 00 dc 11 06 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "vWIWjYHhQJUHUC" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAD_2147836767_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAD!MTB"
        threat_id = "2147836767"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {16 2b 01 17 17 59 7e ac 00 00 04 19 9a 20 22 13 00 00 95 5f 7e ac 00 00 04 19 9a 20 60 05 00 00 95 61 58 81 09 00 00 01}  //weight: 10, accuracy: High
        $x_10_2 = {95 2e 03 16 2b 01 17 17 59 7e 79 00 00 04 19 9a 20 25 0f 00 00 95 5f 7e 79 00 00 04 19 9a 20 c2 0a 00 00 95 61 58 81 09 00 00 01}  //weight: 10, accuracy: High
        $x_10_3 = {16 58 19 08 0c 31 03 16 2b 01 17 17 59 7e 2a 00 00 04 16 9a 20 e3 08 00 00 95 5f 7e 2a 00 00 04 16 9a 20 c9 0b 00 00 95 61 61 81 09 00 00 01}  //weight: 10, accuracy: High
        $x_10_4 = {95 2e 03 16 2b 01 17 7e 91 00 00 04 1a 9a 20 4a 08 00 00 95 5a 7e 91 00 00 04 1a 9a 20 06 04 00 00 95 58 61 80 d1 00 00 04}  //weight: 10, accuracy: High
        $x_10_5 = {95 6e 31 03 16 2b 01 17 17 59 7e 9a 00 00 04 17 9a 20 14 0e 00 00 95 5f 7e 9a 00 00 04 17 9a 20 c3 0c 00 00 95 61 58 80 c5 00 00 04}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AXK_2147836840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AXK!MTB"
        threat_id = "2147836840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "WinForMono.Properties.Resources" ascii //weight: 2
        $x_2_2 = "Sachy_Obrazky" ascii //weight: 2
        $x_2_3 = "$adc711a8-d61e-436a-b1c9-2aadd848ad74" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZU_2147836851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZU!MTB"
        threat_id = "2147836851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 06 8e 69 5d 06 08 06 8e 69 5d 91 07 08 1f 16 5d 91 61 28 ?? ?? ?? 0a 06 08 17 58 06 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2}  //weight: 10, accuracy: Low
        $x_1_2 = "C8AEDHAUVH75I47RR7RD5H" ascii //weight: 1
        $x_1_3 = "JEP45WJ8E9Z7H775487JQ8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_NZV_2147836903_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZV!MTB"
        threat_id = "2147836903"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 02 8e 69 5d 02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 07 17 58 02 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = "G4D54C7D48A57E47Y87HB4" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZV_2147836903_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZV!MTB"
        threat_id = "2147836903"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VOOOO01" ascii //weight: 1
        $x_1_2 = "VOOOO03" ascii //weight: 1
        $x_1_3 = {43 00 6f 00 6e 00 74 00 72 00 00 0d 6f 00 6c 00 5f 00 52 00 75 00 6e}  //weight: 1, accuracy: High
        $x_1_4 = {49 00 6e 00 00 05 76 00 6f 00 00 05 6b 00 65}  //weight: 1, accuracy: High
        $x_1_5 = "System.Reflection.Assembly" ascii //weight: 1
        $x_1_6 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GBH_2147836912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GBH!MTB"
        threat_id = "2147836912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {7e e0 00 00 04 e0 16 9c 7e 2f 00 00 04 1f 15 8f 06 00 00 01 25 71 06 00 00 01 7e 06 00 00 04 16 9a 20 3a 01 00 00 95 61 81 06 00 00 01 08 2c 2a}  //weight: 10, accuracy: High
        $x_10_2 = {20 f1 0b 00 00 95 9e 7e bd 00 00 04 7e f8 00 00 04 18 9a 20 b3 03 00 00 20 01 01 01 01 13 04 95 61 80 bd 00 00 04 11 04 13 07 2b 76}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NJO_2147836915_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NJO!MTB"
        threat_id = "2147836915"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AAAAAAAPY4dTz6NHY8/jx+/Po4" wide //weight: 1
        $x_1_2 = "QAAABoAAAAbAAAAGwAAABwAAAA" wide //weight: 1
        $x_1_3 = "AAAEQSA4uYGAS0/xgEtP8" wide //weight: 1
        $x_1_4 = "5UpNGN7RXEuyo3XW5nHbGvzquZIVhrl9LPMG6ZNrnpk=" ascii //weight: 1
        $x_1_5 = "AAABAAEAICAAAAAAAACoEAAAFg" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZR_2147836918_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZR!MTB"
        threat_id = "2147836918"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 00 ea 00 00 fe 04 13 08 11 08 2d}  //weight: 10, accuracy: High
        $x_1_2 = "Split" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZS_2147836920_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZS!MTB"
        threat_id = "2147836920"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D'5A'90>]'03>}}]'04>}}]'FF'FF>}]'B8>}}}}}}]'40" ascii //weight: 1
        $x_1_2 = "0>}}]'E2>}}]'02>}}}}}}}}}}}}}]'20>}]'60'2E'72'7" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEO_2147836970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEO!MTB"
        threat_id = "2147836970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "usbhu_AdmTmplart" ascii //weight: 2
        $x_2_2 = "smtpbDAV_move" ascii //weight: 2
        $x_2_3 = "DDAsoft_BuiL600" ascii //weight: 2
        $x_2_4 = "recovws_Medonfig" ascii //weight: 2
        $x_2_5 = "imkn_Fordisc" ascii //weight: 2
        $x_2_6 = "WinCds_GetDisv1_0" ascii //weight: 2
        $x_2_7 = "wmim_drawinMdRes" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GBN_2147836994_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GBN!MTB"
        threat_id = "2147836994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 1f 16 5d 91 61 28 ?? ?? ?? 0a 07 09 17 58 07 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 08 11 08 2d b7}  //weight: 10, accuracy: Low
        $x_1_2 = "JEP45WJ8E9Z7H775487JQ8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAB_2147837071_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAB!MTB"
        threat_id = "2147837071"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {13 04 09 11 04 16 11 04 8e 69 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 13 05 28 ?? ?? ?? 0a 11 05 16 11 05 8e 69}  //weight: 2, accuracy: Low
        $x_1_2 = "UmVnaXN0ZXIgaGFzIGJlZW4gc3VjY2Vzc2Z1bCE" wide //weight: 1
        $x_1_3 = "FUCK_IS_ALWAYS_REAL" ascii //weight: 1
        $x_1_4 = "decrypt_string" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFL_2147837168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFL!MTB"
        threat_id = "2147837168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7e f8 00 00 04 18 06 0c 9a 20 9a 11 00 00 95 5a 7e f8 00 00 04 18 9a 20 9c 00 00 00 95 58 61 80 bd 00 00 04 2a 7e bd 00 00 04 7e f8 00 00 04 18 9a 09 0c 20 b7 01 00 00 95 40 11 03 00 00 7e bd 00 00 04 7e f8 00 00 04 1b 9a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFM_2147837169_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFM!MTB"
        threat_id = "2147837169"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 09 07 6f ?? ?? ?? 0a 00 09 18 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 13 04 11 04 03 16 03 8e 69 6f ?? ?? ?? 0a 13 05 09 6f ?? ?? ?? 0a 00 11 05 0a 2b 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "CoolerMaster.Resources" wide //weight: 1
        $x_1_3 = "HSlWVxGer" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFN_2147837170_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFN!MTB"
        threat_id = "2147837170"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1a 9a 11 0b 13 07 1b 95 7e e4 00 00 04 20 c7 02 00 00 95 5a 7e e4 00 00 04 20 2a 04 00 00 95 2e 05 16 06 0a 2b 01 17 17 59 7e e4 00 00 04 20 97 03 00 00 95 11 0b 13 0b 5f 7e e4 00 00 04 20 15 03 00 00 95 61 61 81 07 00 00 01 38 51 03 00 00}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAA_2147837210_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAA!MTB"
        threat_id = "2147837210"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 04 17 58 13 04 11 04 20 00 01 00 00 5d 13 04 11 06 11 0a 11 04 94 58 13 06 11 06 20 00 01 00 00 5d 13 06 11 0a 11 04 94 13 08 11 0a 11 04 11 0a 11 06 94 9e 11 0a 11 06 11 08 9e 11 0a 11 0a 11 04 94 11 0a 11 06 94 58 20 00 01 00 00 5d 94 13 07 09 11 05 08 11 05 91 11 07 61 d2 9c 11 05 17 58 13 05 11 05 08 8e 69 32 95}  //weight: 10, accuracy: High
        $x_6_2 = "ignitenews24.com" wide //weight: 6
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFQ_2147837421_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFQ!MTB"
        threat_id = "2147837421"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 07 06 9a 1f 10 28 ?? ?? ?? 0a 8c ?? ?? ?? 01 6f ?? ?? ?? 0a 26 06 17 58 0a 06 07 8e 69 fe 04 13 09 11 09 2d da}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFX_2147837423_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFX!MTB"
        threat_id = "2147837423"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 07 11 08 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 08 17 58 13 08 11 08 20 ?? ?? ?? 00 fe 04 13 09 11 09 2d d9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABGG_2147837428_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABGG!MTB"
        threat_id = "2147837428"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 11 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d ?? ?? ?? 01 25 16 06 11 06 9a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 9c 11 06 17 58 13 06 11 06 06 8e 69 fe 04 13 07 11 07 2d b2}  //weight: 3, accuracy: Low
        $x_1_2 = "Color_Memory.VVVC" wide //weight: 1
        $x_1_3 = "Color_Memory.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASWAT_2147837444_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASWAT!MTB"
        threat_id = "2147837444"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 02 7b 02 00 00 04 6f 4a 00 00 0a 6f 4b 00 00 0a 0b 02 07 72 dd 06 00 70 28 16 00 00 06 02 7b 01 00 00 04 6f 34 00 00 0a 2d 56 28 4c 00 00 0a}  //weight: 2, accuracy: High
        $x_1_2 = "DownloadString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANMO_2147837448_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANMO!MTB"
        threat_id = "2147837448"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 16 72 ?? ?? ?? 70 a2 11 04 17 7e ?? ?? ?? 0a a2 11 04 18 06 a2 11 04 0c 07 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZW_2147837487_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZW!MTB"
        threat_id = "2147837487"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 03 11 06 91 07 11 06 07 8e 69 5d 91 61 08 61 d2 6f ?? 00 00 0a 00 00 11 06 17 58 13 06 11 06 03 8e 69 fe 04 13 07 11 07 2d d4}  //weight: 1, accuracy: Low
        $x_1_2 = "yessure12321" ascii //weight: 1
        $x_1_3 = "makefil.makefil" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABEH_2147837559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABEH!MTB"
        threat_id = "2147837559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 02 11 01 02 11 07 18 5a 18 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 38 ?? ?? ?? ff dd ?? ?? ?? ff 11 03}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDelegate" ascii //weight: 1
        $x_1_3 = "GetResponseStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABEO_2147837560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABEO!MTB"
        threat_id = "2147837560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 28 7f 00 00 0a 28 ?? ?? ?? 0a 2a}  //weight: 2, accuracy: Low
        $x_2_2 = {01 25 16 20 ?? ?? ?? aa 28 ?? ?? ?? 06 a2 25 17 20 ?? ?? ?? aa 28 ?? ?? ?? 06 a2 14 14 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0b 14}  //weight: 2, accuracy: Low
        $x_1_3 = "Excerestint.Resources.resources" ascii //weight: 1
        $x_1_4 = "Excerestint" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABEP_2147837561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABEP!MTB"
        threat_id = "2147837561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {01 25 16 20 ?? ?? ?? 88 28 ?? ?? ?? 06 a2 25 17 20 ?? ?? ?? 88 28 ?? ?? ?? 06 a2 14 14 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0b 14}  //weight: 2, accuracy: Low
        $x_1_2 = "Excerestint.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABGC_2147837563_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABGC!MTB"
        threat_id = "2147837563"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {09 13 05 08 13 06 11 05 11 06 3d ?? ?? ?? 00 72 ?? ?? ?? 70 02 09 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 03 11 04 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6a 61 69 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 07 06 11 07 6f ?? ?? ?? 0a 26 11 04 03 6f ?? ?? ?? 0a 17 59 40 ?? ?? ?? 00 16 13 04 38 ?? ?? ?? 00 11 04 17 58 13 04}  //weight: 2, accuracy: Low
        $x_1_2 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABGL_2147837565_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABGL!MTB"
        threat_id = "2147837565"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d ?? ?? ?? 01 25 16 06 11 06 9a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 9c 11 06 17 58 13 06 11 06 06 8e 69 fe 04 13 07 11 07 2d b2}  //weight: 5, accuracy: Low
        $x_1_2 = "StudentClass.VSFV" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NGH_2147837609_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NGH!MTB"
        threat_id = "2147837609"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 01 00 00 70 16 8d ?? ?? ?? 01 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 7a 73 ?? ?? ?? 0a 80 ?? ?? ?? 04 7e ?? ?? ?? 04}  //weight: 5, accuracy: Low
        $x_1_2 = "WinForms_SeeInnerException" wide //weight: 1
        $x_1_3 = "Bedford.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GBX_2147837773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GBX!MTB"
        threat_id = "2147837773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 07 02 8e 69 5d 02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 07 17 58 02 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NZX_2147837793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NZX!MTB"
        threat_id = "2147837793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 0d 16 11 0b 6f ?? ?? ?? 0a 25 26 26 11 0a 11 0d 16 11 0b 11 0c 16 6f ?? ?? ?? 0a 25 26 13 0f}  //weight: 1, accuracy: Low
        $x_1_2 = "TkJoSGhISEgk" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBA_2147837794_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBA!MTB"
        threat_id = "2147837794"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D`5A`90`&`03`&`&`&`04`&`&`&`FF`FF`&`&`B8`&`&`&`&`&`&`&`40`&`&`&`&`&`&`&`&`" ascii //weight: 1
        $x_1_2 = {34 00 44 00 7e 00 35 00 41 00 7e 00 39 00 30 00 7e 00 30 00 30 00 7e 00 30 00 33 00 7e 00 2b 00 30 00 30 00 7e 00 30 00 34 00 7e 00 2b 00 30 00 30 00 7e 00 46 00 46 00 7e 00 46 00 46 00 7e 00 2b 00 42 00 38 00 7e 00 2b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEIS_2147837820_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEIS!MTB"
        threat_id = "2147837820"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {25 16 16 8c 6a 00 00 01 a2 25 17 08 a2 25 13 05 14 14 18 8d 6b 00 00 01 25 17 17 9c 25 13 06 17 28}  //weight: 2, accuracy: High
        $x_1_2 = "BookmakerFeedParseService" wide //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JZ_2147837873_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JZ!MTB"
        threat_id = "2147837873"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {a0 00 00 00 9d 28 ?? 00 00 06 16 9a 0c 00 00 00 2b 17 8d ?? 00 00 01 25 16 20}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABGS_2147837957_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABGS!MTB"
        threat_id = "2147837957"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 06 06 11 06 9a 1f 10 28 ?? ?? ?? 0a 9c 11 06 17 58 13 06 11 06 06 8e 69 fe 04 13 07 11 07 2d de}  //weight: 5, accuracy: Low
        $x_1_2 = "LightsOut.FVWSFW" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABHD_2147837963_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABHD!MTB"
        threat_id = "2147837963"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 08 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d ?? ?? ?? 01 25 16 06 11 08 9a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a5 ?? ?? ?? 01 9c 11 08 17 58 13 08 11 08 06 8e 69 fe 04 13 09 11 09 2d b2}  //weight: 5, accuracy: Low
        $x_1_2 = "Jumper.DCCC" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBR_2147838054_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBR!MTB"
        threat_id = "2147838054"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D!5A!90!,!03!,!,!,!04!,!,!,!FF!FF!,!,!B8" ascii //weight: 1
        $x_1_2 = "!40!2E!72!65!6C!6F!63!,!,!0C!,!,!,!,!,!01" ascii //weight: 1
        $x_1_3 = "System.Reflection.Assembly" ascii //weight: 1
        $x_1_4 = "System.Activator" ascii //weight: 1
        $x_1_5 = "AAAAAAAAAAAAA.r" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GCD_2147838083_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GCD!MTB"
        threat_id = "2147838083"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {16 0a 2b 1b 7e 18 01 00 04 06 7e 18 01 00 04 06 91 06 61 20 aa 00 00 00 61 d2 9c 06 17 58 0a 06 7e 18 01 00 04 8e 69 fe 04 2d d9 2a}  //weight: 10, accuracy: High
        $x_1_2 = "TripleDESCryptoServiceProvider" ascii //weight: 1
        $x_1_3 = "BCryptDecrypt" ascii //weight: 1
        $n_10_4 = "CryptoLibrary.dll" ascii //weight: -10
    condition:
        (filesize < 20MB) and
        (not (any of ($n*))) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBN_2147838096_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBN!MTB"
        threat_id = "2147838096"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 00 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 0b 02 28 ?? 00 00 0a 0c 07 08 16 08 8e 69 6f ?? 00 00 0a 0d 09 13 04 de 0b}  //weight: 1, accuracy: Low
        $x_1_2 = {6c 00 62 00 6c 00 41 00 62 00 6f 00 75 00 74 00 43 00 48 00 54 00 2e 00 54 00 65 00 78 00 74}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDK_2147838102_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDK!MTB"
        threat_id = "2147838102"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5331bd34-4027-4657-b2bf-b1a696b1b1b7" ascii //weight: 1
        $x_1_2 = "Usermode Font Driver Host" wide //weight: 1
        $x_2_3 = {11 05 25 4b 11 0c 11 0f 1f 0f 5f 95 61 54}  //weight: 2, accuracy: High
        $x_2_4 = {25 1a 58 13 12 4b 61 11 09 58 11 0a 11 0b 5a 58}  //weight: 2, accuracy: High
        $x_1_5 = "kernel32" ascii //weight: 1
        $x_1_6 = "VirtualProtect" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBP_2147838135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBP!MTB"
        threat_id = "2147838135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {b6 00 b6 00 60 00 6c 25 71 00 51 00 88 25 88 25 88 25 88 25 4d 00 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 45 00 88 25 88 25 88 25 88 25 88 25 88 25 88 25 88 25 2f 00 2f 00 38 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBP_2147838135_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBP!MTB"
        threat_id = "2147838135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 68 2b 69 08 06 8e 69 5d 91 7e ?? 00 00 04 08 91 61 d2 6f ?? 00 00 0a 08 17 58 0c 08 16 2d b4}  //weight: 1, accuracy: Low
        $x_1_2 = "485fa6b5-7391-4d74-8656-33d9f14faf88" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMMA_2147838168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMMA!MTB"
        threat_id = "2147838168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 09 07 16 73 ?? 00 00 0a 13 04 11 04 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 13 05 dd}  //weight: 5, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "TripleDESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NATN_2147838205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NATN!MTB"
        threat_id = "2147838205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 2b 01 00 0a 0b 1f 24 28 ?? ?? ?? 0a 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0a 06 28 ?? ?? ?? 0a 26 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 06 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 20 ?? ?? ?? 00 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 07 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 06 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 2c 22 07 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 06 20 ?? ?? ?? 6f 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "RdpArt.Loader" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAG_2147838214_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAG!MTB"
        threat_id = "2147838214"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 9a 20 0f 09 00 00 95 2e 03 16 2b 01 17 17 59 11 42 16 9a 20 32 04 00 00 95 5f 11 42 16 9a 20 64 04 00 00 95 61 59 80 08 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDL_2147838228_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDL!MTB"
        threat_id = "2147838228"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "09a53681-2d75-440c-9de6-cc0044815477" ascii //weight: 1
        $x_1_2 = "kernel32" ascii //weight: 1
        $x_1_3 = "LoadLibrary" ascii //weight: 1
        $x_1_4 = "GetProcAddress" ascii //weight: 1
        $x_2_5 = {6e 11 08 6a 59 d4 11 04 1e 11 08 59 1e 5a 1f 3f 5f 64 20 ?? ?? ?? ?? 6a 5f d2 9c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAB_2147838267_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAB!MTB"
        threat_id = "2147838267"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_7_1 = {02 6f 15 00 00 0a 0a 06 18 5b 8d 18 00 00 01 0b 16 0c 2b 18 07 08 18 5b 02 08 18 6f 16 00 00 0a 1f 10 28 17 00 00 0a 9c 08 18 58 0c 08 06 32 e4}  //weight: 7, accuracy: High
        $x_3_2 = "185.216.71.120" wide //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAC_2147838269_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAC!MTB"
        threat_id = "2147838269"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 19 11 1a 9a 13 09 11 09 72 53 02 00 70 72 61 02 00 70 72 69 02 00 70 6f ba 00 00 0a 17 28 bb 00 00 0a 2d 07 17 0b 38 ae 00 00 00 11 09 72 6f 02 00 70 72 83 02 00 70 72 8d 02 00 70 6f ba 00 00 0a 19 6f bc 00 00 0a 2c 62 11 09 17 8d 35 00 00 01 13 1b 11 1b 16 72 95 02 00 70 a2 11 1b 18 17 6f bd 00 00 0a 13 0a 11 0a 8e 69 18 2e 21}  //weight: 10, accuracy: High
        $x_2_2 = "-extdummt" wide //weight: 2
        $x_2_3 = "-whatt" wide //weight: 2
        $x_2_4 = "-debug" wide //weight: 2
        $x_2_5 = "gg.exe" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBU_2147838293_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBU!MTB"
        threat_id = "2147838293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "4D-5A-9O-OO-O3-OO-OO-OO-O4-OO-OO-OO-FF-FF-OO-OO-B8-OO-OO-OO-OO-OO-OO-OO-4O" ascii //weight: 10
        $x_1_2 = "System.Convert" wide //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
        $x_1_4 = "ToByte" wide //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBV_2147838294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBV!MTB"
        threat_id = "2147838294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 1f 06 35 00 41 00 1f 06 39 00 21 00 1f 06 21 00 21 00 1f 06 21 00 33 00 1f 06 2b 00 21 00 21 00 1f 06 21 00 34 00 1f 06 2b 00 21 00 21 00 1f 06 46 00 46 00 1f 06 46 00 46 00 1f 06 2b 00 42 00 38 00 1f}  //weight: 1, accuracy: High
        $x_1_2 = "II0000006" ascii //weight: 1
        $x_1_3 = "CXXAC" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RJ_2147838420_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RJ!MTB"
        threat_id = "2147838420"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {18 8d 09 00 00 01 25 16 11 01 a2 25 17 11 02 a2 13 04 38}  //weight: 1, accuracy: High
        $x_1_2 = {03 14 fe 03 39 28 00 00 00 38 13 00 00 00 03 02 7b ?? 00 00 04 fe 01 39 e4 ff ff ff 38 ?? ?? ?? ?? 20 ?? ?? ?? ?? 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFK_2147838437_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFK!MTB"
        threat_id = "2147838437"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 09 07 09 9a 1f 10 28 ?? ?? ?? 0a 9c 09 17 d6 0d 00 09 20 ?? ?? ?? 00 fe 04 13 05 11 05 2d e0}  //weight: 5, accuracy: Low
        $x_1_2 = "Practica1.Resources" wide //weight: 1
        $x_1_3 = "Practica1.Res21" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABFW_2147838439_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABFW!MTB"
        threat_id = "2147838439"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 07 07 11 07 9a 1f 10 28 ?? ?? ?? 0a 9c 11 07 17 58 13 07 11 07 07 8e 69 fe 04 13 08 11 08 2d de}  //weight: 5, accuracy: Low
        $x_1_2 = "Smart_Quarantine.ResDSDS" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABHL_2147838442_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABHL!MTB"
        threat_id = "2147838442"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {1b 08 18 5b 02 08 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 17 13 04 2b a4 08 18 58 0c 16 13 04 2b 9b 27 00 07 75}  //weight: 4, accuracy: Low
        $x_1_2 = "DesktopApp1.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDM_2147838456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDM!MTB"
        threat_id = "2147838456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sma2t" ascii //weight: 1
        $x_1_2 = "Ess6ntial" ascii //weight: 1
        $x_1_3 = "A88oint" ascii //weight: 1
        $x_1_4 = "Qo7DkXzoKU3+MOmwf4lb9w==" wide //weight: 1
        $x_1_5 = "5kUdEhxY/9Ui7uaX76RxSA==" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAC_2147838483_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAC!MTB"
        threat_id = "2147838483"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 00 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 0b 02 28 ?? 00 00 0a 0c 07 08 16 08 8e 69 6f ?? 00 00 0a 0d 09 13 04 de 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAE_2147838488_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAE!MTB"
        threat_id = "2147838488"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "4D-5A-90O-03OOO-04OOO-FF-FFOO-B8OOOOOO" ascii //weight: 5
        $x_5_2 = "0E-1F-BA-0EO-B4-09-CD-21-B8-01-4C-CD-2" ascii //weight: 5
        $x_1_3 = "ToSByte" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAG_2147838490_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAG!MTB"
        threat_id = "2147838490"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4DO5AO9!O!!O!3O+!!O!4O+!!OFFOFFO+B8O+++" wide //weight: 1
        $x_1_2 = "CLC03" ascii //weight: 1
        $x_1_3 = "K00002" ascii //weight: 1
        $x_1_4 = "System.Convert" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPQP_2147838492_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPQP!MTB"
        threat_id = "2147838492"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {17 2d 06 d0 07 00 00 06 26 28 ?? ?? ?? 0a 72 97 00 00 70 6f ?? ?? ?? 0a 25 26 0b 73 1d 00 00 0a 0c}  //weight: 2, accuracy: Low
        $x_1_2 = "Btjes.png" wide //weight: 1
        $x_1_3 = "public.class.Main.HelloWorld.module2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RB_2147838510_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RB!MTB"
        threat_id = "2147838510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {25 17 1e 9e 25 18 1f 09 9e 25 19 1f 11 9e 25 1a 1f 12 9e 25 1b 1f 1a 9e 80}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RB_2147838510_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RB!MTB"
        threat_id = "2147838510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 17 da 06 1e d8 b4 9c 1e 13 0a 38 ?? ?? ?? ?? 11 05 1e fe 02 13 07 11 07 2c 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RB_2147838510_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RB!MTB"
        threat_id = "2147838510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 08 03 8e 69 5d 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? 00 00 0a 03 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RB_2147838510_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RB!MTB"
        threat_id = "2147838510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 08 02 8e 69 5d 02 08 02 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 08 1e 58 1d 59 02 8e 69 5d 91 59 20 ?? ?? ?? 00 58 18 58 20 ?? ?? ?? 00 5d d2 9c 08 16 2d 02 17 58}  //weight: 5, accuracy: Low
        $x_1_2 = "TripleDESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAF_2147838617_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAF!MTB"
        threat_id = "2147838617"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0c 07 16 73 ?? 00 00 0a 73 ?? 00 00 0a 0d 09 08 6f ?? 00 00 0a de 0a 09 2c 06 09 6f ?? 00 00 0a dc 08 6f ?? 00 00 0a 13 04 de 34}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAH_2147838618_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAH!MTB"
        threat_id = "2147838618"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {17 9a 13 06 7e ?? 00 00 04 17 8d ?? 00 00 01 25 16 1f 23 9d 6f ?? 00 00 0a 0d 19 8d ?? 00 00 01 25 16 09 16 9a a2 25 17 09 17 9a a2 25 18}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAP_2147838766_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAP!MTB"
        threat_id = "2147838766"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 03 8e 69 5d 91 06 04 1f 16 5d 91 61 28 ?? ?? ?? 0a 03 04 17 58 03 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAP_2147838766_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAP!MTB"
        threat_id = "2147838766"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 07 8e 69 5d 07 11 07 07 8e 69 5d 91 08 11 07 1f 16 5d 91 61 28 ?? 00 00 0a 07 11 07 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2}  //weight: 1, accuracy: Low
        $x_1_2 = "857H487ZSH97Q4HZB874CC" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GCW_2147838816_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GCW!MTB"
        threat_id = "2147838816"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 1f 2d 9d 6f ?? ?? ?? 0a 0a 06 8e 69 8d ?? ?? ?? ?? 0b 16 13 06 2b 15 07 11 06 06 11 06 9a 1f 10 28 ?? ?? ?? 0a 9c 11 06 17 58 13 06 11 06 06 8e 69 fe 04 13 07 11 07 2d de}  //weight: 10, accuracy: Low
        $x_1_2 = "UFUEYHI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAR_2147838836_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAR!MTB"
        threat_id = "2147838836"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 16 13 07 2b 15 08 11 07 07 11 07 9a 1f 10 28 ?? 00 00 0a 9c 11 07 17 58 13 07}  //weight: 1, accuracy: Low
        $x_1_2 = "4D~5A~90O~03OOO~04OOO~FF~FFOO~B8OOOOOOO~4" ascii //weight: 1
        $x_1_3 = "FWSFDW" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIQ_2147838867_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIQ!MTB"
        threat_id = "2147838867"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {02 11 02 02 8e 69 5d 02 11 02 02 8e 69 5d 91 11 00 11 02 11 00 8e 69 5d 91 61 02 11 02 17 d6 02 8e 69 5d 91 da 20 ?? ?? ?? 00 d6 20 ?? ?? ?? 00 5d b4 9c}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "_________.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIY_2147838869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIY!MTB"
        threat_id = "2147838869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 9c 06 17 d6 0a 06 07 8e 69 fe 04 13 08 11 08 2d e3}  //weight: 5, accuracy: Low
        $x_1_2 = "TabControlExtra.XLLL.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIZ_2147838870_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIZ!MTB"
        threat_id = "2147838870"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04 00 11 04 20 ?? ?? ?? 00 fe 04 13 06 11 06 2d c0}  //weight: 5, accuracy: Low
        $x_1_2 = "CorePerform.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAH_2147838884_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAH!MTB"
        threat_id = "2147838884"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "uZSi/Pjh1Z/95kRmaeAVukTUfcn5Lc1" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAI_2147838885_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAI!MTB"
        threat_id = "2147838885"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 8e 69 5d 07 11 06 07 8e 69 5d 91 08 11 06 1f 16 5d 91 61 28 ?? 00 00 0a 07 11 06 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAN_2147838886_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAN!MTB"
        threat_id = "2147838886"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 03 8e 69 5d 91 06 04 1f 16 5d 91 61 28 ?? ?? ?? 06 03 04 17 58 03 8e 69 5d 91 28 ?? 00 00 06 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAN_2147838886_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAN!MTB"
        threat_id = "2147838886"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 05 06 8e 69 5d 06 11 05 06 8e 69 5d 91 07 11 05 1f 16 5d 91 61 28 ?? ?? ?? 0a 06 11 05 17 58 06 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAF_2147838891_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAF!MTB"
        threat_id = "2147838891"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {11 05 6f 48 00 00 0a 25 26 13 0a 11 0a 6f 49 00 00 0a 25 26 13 0b 11 0a 6f 4a 00 00 0a 25 26 26 11 0a 6f 4a 00 00 0a 25 26 28 1b 00 00 06 25 26 13 0c 11 0a}  //weight: 10, accuracy: High
        $x_5_2 = "NEWDRIOD" ascii //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAT_2147838923_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAT!MTB"
        threat_id = "2147838923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "4D~5A~90O~03OOO~04OOO~FF~FFOO~B" ascii //weight: 2
        $x_2_2 = {74 00 72 00 69 00 6e 00 67 00 31 00 00 00 00 00 01 fb e6 09 34 44 7e 35 41 7e 39 30 4f 7e 30}  //weight: 2, accuracy: High
        $x_2_3 = "~1F~BA~0EO~B4~09~CD~21~B8~01~4C" ascii //weight: 2
        $x_2_4 = "OOO~40~01O~0COOOOOOOOOOOOOOOOOO" ascii //weight: 2
        $x_1_5 = "Replace" ascii //weight: 1
        $x_1_6 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAE_2147838930_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAE!MTB"
        threat_id = "2147838930"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {13 11 20 e8 03 00 00 13 12 20 e8 03 00 00 8d ?? ?? ?? 01 13 14 2b 19 11 13 11 12 2f 13 2b 26 7e ?? ?? ?? 04 11 14 16 11 13 6f ?? ?? ?? 0a 2b e7 11 11 11 14 16 11 12 6f ?? ?? ?? 0a 13 13 11 13 16 31 d4 2b da}  //weight: 2, accuracy: Low
        $x_2_2 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAJ_2147838932_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAJ!MTB"
        threat_id = "2147838932"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {25 16 1f 2d 9d 6f ?? 00 00 0a 0a 06 8e 69 8d ?? 00 00 01 0b 16 13 05 2b 16 07 11 05 06 11 05 9a 1f 10 28 ?? 00 00 0a d2 9c 11 05 17 58 13 05 11 05 06 8e 69}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAW_2147838985_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAW!MTB"
        threat_id = "2147838985"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_4_1 = "4D-5A-9[~-[3~~~-[4~~~-FF-FF~~-B8~~" wide //weight: 4
        $x_4_2 = "1F-1E-2[-DA~~~-73-34~~-[A-" wide //weight: 4
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MKV_2147838990_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MKV!MTB"
        threat_id = "2147838990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 86 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04 00 11 04 8c ?? ?? ?? 01 08 14 72 ?? ?? ?? 70 16 8d ?? ?? ?? 01 14 14 14 28 ?? ?? ?? 0a 16 28 ?? ?? ?? 0a 13 06 11 06 2d a6}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJP_2147839038_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJP!MTB"
        threat_id = "2147839038"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = "NetworkAssassin.ResoCS" wide //weight: 4
        $x_1_2 = "NetworkAssassin.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJQ_2147839039_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJQ!MTB"
        threat_id = "2147839039"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {70 00 6f 00 64 00 7a 00 69 00 61 00 6c 00 79 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73 00 00 49 41 00 73 00 68 00 6c 00 65 00 79 00 5f 00 4e 00 69 00 63 00 6f 00 6c 00 65 00 5f 00 5f 00 31 00 30 00 37 00 5f 00 4e 00 75 00 64 00 65 00 5f 00 50 00 68 00 6f 00 74 00 6f 00 73 00 5f 00 5f 00 5f 00 36 00 34 00 5f 00 00 47 44 00 65 00 61 00 6e 00 6e 00 61 00 5f 00 42 00 72 00 6f 00 6f 00 6b 00 73 00 5f 00}  //weight: 4, accuracy: High
        $x_1_2 = "podzialy.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJR_2147839040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJR!MTB"
        threat_id = "2147839040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 05 06 11 05 9a 1f 10 28 ?? ?? ?? 0a d2 9c 11 05 17 58 13 05 11 05 06 8e 69 fe 04 13 06 11 06 2d dd}  //weight: 5, accuracy: Low
        $x_1_2 = "Cardgame.ResourceK" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIL_2147839118_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIL!MTB"
        threat_id = "2147839118"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0c 06 08 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 06 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0d 09 13 04 2b 00 11 04 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "RIdjFadwvrdEqwDYeaTjKsOYiYAIsNwGLXo" wide //weight: 1
        $x_1_3 = "TetrisPro.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIM_2147839119_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIM!MTB"
        threat_id = "2147839119"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {06 07 16 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 0d 09 16 fe 02 13 04 11 04 2c 0c 3b 00 02 73 ?? ?? ?? 0a 16 73 ?? ?? ?? 0a 0a 00 20 ?? ?? ?? 00 8d ?? ?? ?? 01 0b 00 00 73 ?? ?? ?? 0a 0c}  //weight: 4, accuracy: Low
        $x_1_2 = "FibonacciClock.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBB_2147839182_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBB!MTB"
        threat_id = "2147839182"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 07 07 11 07 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 07 17 58 13 07 11 07 07 8e 69 fe 04 13 08 11 08}  //weight: 1, accuracy: Low
        $x_1_2 = "8004-3afb5aa80c44" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBC_2147839189_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBC!MTB"
        threat_id = "2147839189"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {20 8f 0f 00 00 95 5f 11 23 20 3b 0a 00 00 95 61 59 13 45 11 45 11 23 20 1a 05 00 00 95 33 25 7e 0e 00 00 04 17 11 43 13 43 16 9e}  //weight: 10, accuracy: High
        $x_10_2 = {20 bc 09 00 00 95 5f 11 18 13 18 11 41 20 e6 0d 00 00 95 61 59 80 18 00 00 04 38 e3 00 00 00 7e 18 00 00 04 11 41 20 94 01 00 00 95 33 63 7e 24 00 00 04 11 41 20 77 05 00 00 95 e0 11 41 20 7b 0e 00 00}  //weight: 10, accuracy: High
        $x_1_3 = "sm89mqDraa_0311" ascii //weight: 1
        $x_1_4 = "IphwsJS0AL" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ABJK_2147839200_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJK!MTB"
        threat_id = "2147839200"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {01 25 16 72 ?? ?? ?? 70 a2 25 17 72 ?? ?? ?? 70 a2 14 14 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b 07 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0c 3b 00 7e ?? ?? ?? 04 14 72 ?? ?? ?? 70 18 8d}  //weight: 2, accuracy: Low
        $x_2_2 = {0a 0a 2b 00 06 2a 10 00 02 28 ?? ?? ?? 0a 28}  //weight: 2, accuracy: Low
        $x_1_3 = "Perpustakaan.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJO_2147839201_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJO!MTB"
        threat_id = "2147839201"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 05 07 8e 69 5d 07 11 05 07 8e 69 5d 91 08 11 05 1f 16 5d 91 61 28 ?? ?? ?? 0a 07 11 05 17 58 07 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 11 05 15 58 13 05 11 05 16 2f bb}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJT_2147839202_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJT!MTB"
        threat_id = "2147839202"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {50 00 6f 00 74 00 65 00 6e 00 63 00 69 00 6f 00 6d 00 65 00 74 00 72 00 6f 00 4d 00 37 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73 00 1a 00 00 00 41 00 73 00 68 00 6c 00 65 00 79 00 5f 00 4e 00 69 00 63 00 6f 00 6c 00 65 00 18 00 00 00 44 00 69 00 61 00 6e 00 61 00 5f 00 4e 00 69 00 63 00 6f 00 6c 00 65 00 0e 00 00 00 4c 00 6b 00 78 00 68 00 62 00 4a 00}  //weight: 4, accuracy: High
        $x_1_2 = "PotenciometroM7" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAO_2147839234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAO!MTB"
        threat_id = "2147839234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 9a 20 ff 06 00 00 95 34 03 16 2b 01 17 17 59 11 34 16 9a 20 d3 10 00 00 95 5f 11 34 16 9a 20 88 08 00 00 95 61 58 13 2a 38}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAU_2147839238_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAU!MTB"
        threat_id = "2147839238"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 07 07 11 07 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 07 17 58 13 07 11 07 07 8e 69 fe 04 13 08 11 08 2d d9}  //weight: 1, accuracy: Low
        $x_1_2 = {08 07 11 07 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 07 17 58 13 07 11 07 07 8e 69 fe 04 13 08 11 08 2d db}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAX_2147839239_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAX!MTB"
        threat_id = "2147839239"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 08 08 11 08 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 08 17 58 13 08 11 08 08 8e 69 fe 04 13 09 11 09 2d d9}  //weight: 1, accuracy: Low
        $x_1_2 = {72 01 03 00 70 72 05 03 00 70}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAZ_2147839241_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAZ!MTB"
        threat_id = "2147839241"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 08 08 11 08 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 08 17 58 13 08 11 08 08 8e 69 fe 04 13 09 11 09 2d d9}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAK_2147839248_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAK!MTB"
        threat_id = "2147839248"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 16 13 07 2b 1a 08 11 07 07 11 07 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 07 17 58 13 07 11 07 07 8e 69 fe 04 13 08 11 08 2d d9}  //weight: 1, accuracy: Low
        $x_1_2 = "FlipFlop.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_APT_2147839256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.APT!MTB"
        threat_id = "2147839256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {72 5b 02 00 70 72 5f 02 00 70 6f 50 00 00 0a 72 67 02 00 70 72 6b 02 00 70 6f 50 00 00 0a 72 6f 02 00 70 72 73 02 00 70 6f 50 00 00 0a 0a 06 17 8d 45 00 00 01 25 16 1f 2d 9d 6f 51 00 00 0a 0b}  //weight: 1, accuracy: High
        $x_1_2 = {08 11 07 07 11 07 9a 1f 10 28 53 00 00 0a d2 6f 54 00 00 0a 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WMP_2147839299_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WMP!MTB"
        threat_id = "2147839299"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 07 17 8d ?? ?? ?? 01 25 16 1f 2d 9d 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 16 13 08 2b 1b 09 11 08 08 11 08 9a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 00 11 08 17 58 13 08 11 08 08 8e 69 fe 04 13 09 11 09 2d d8 78 00 28 ?? ?? ?? 06 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBG_2147839323_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBG!MTB"
        threat_id = "2147839323"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 02 0b 00 00 95 5f 11 3c 20 76 04 00 00 95 61 58 80 08 00 00 04 38 ef 00 00 00 7e 08 00 00 04 11 3c 20 e6 08 00 00 95 40 95 00 00 00 11 41 11 3c 20 cc 04 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBA_2147839335_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBA!MTB"
        threat_id = "2147839335"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {47 00 65 00 74 00 4d 00 65 00 74 00 68 00 6f 00 64 00 00 0b 44 00 6f 00 64 00 67 00 65}  //weight: 1, accuracy: High
        $x_1_2 = "$445a98f1-5bfd-4ec9-af3d-bc1c04ec5692" ascii //weight: 1
        $x_1_3 = "BuildEvent.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBD_2147839336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBD!MTB"
        threat_id = "2147839336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 2d 00 35 00 41 00 2d 00 39 00 7d 00 7e 00 2d 00 7d 00 33 00 7e 00 7e 00 7e 00 2d 00 7d 00 34 00 7e 00 7e 00 7e 00 2d 00 46 00 46 00 2d 00 46 00 46 00 7e 00 7e 00 2d 00 42 00 38 00 7e 00 7e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBF_2147839338_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBF!MTB"
        threat_id = "2147839338"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$abb16e15-f9df-4470-b8db-25c3b4069583" ascii //weight: 10
        $x_1_2 = "Dodge" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
        $x_1_5 = "StrReverse" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAP_2147839341_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAP!MTB"
        threat_id = "2147839341"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 14 72 4a 4b 02 70 18 8d ?? 00 00 01 25 16 72 5a 4b 02 70 a2 25 17 72 5e 4b 02 70 a2 14 14 14 28 [0-3] 0a 14 72 4a 4b 02 70 18 8d ?? 00 00 01 25 16 72 66 4b 02 70 a2 25 17 72}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAQ_2147839342_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAQ!MTB"
        threat_id = "2147839342"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 2b 34 8e 69 17 2d 32 26 26 26 1d 2c 02 07 0c 16 2d dc de 55 28 ?? 00 00 0a 2b d5 28 ?? 00 00 06 2b d5 6f ?? 00 00 0a 2b d0 28 ?? 00 00 0a 2b cb 0b 2b ca 07 2b c9 07 2b c9 28 ?? 00 00 0a 2b ca}  //weight: 2, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBH_2147839355_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBH!MTB"
        threat_id = "2147839355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 6d 03 00 00 95 5f 7e 45 00 00 04 20 87 09 00 00 95 61 58 13 39 38 a8 04 00 00 11 39 7e 45 00 00 04 20 6f 10 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBH_2147839355_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBH!MTB"
        threat_id = "2147839355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 5d 11 ?? 11 ?? 11 ?? 8e 69 5d 91 11 ?? 11 ?? 1f ?? 5d 91 61 7e ?? ?? ?? 04 28 ?? ?? ?? 06 11 ?? 11 ?? 17 58 11 ?? 8e 69 5d 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBH_2147839355_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBH!MTB"
        threat_id = "2147839355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 2f 00 00 0a 00 06 72 f8 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 01 72 fe 02 00 70 72 02 03 00 70 6f ?? 00 00 0a 17 8d ?? 00 00 01 25 16 1f 2d 9d 6f ?? 00 00 0a 0b 07 8e 69 8d ?? 00 00 01 0c 16 13 05 2b 18 00 08 11 05 07 11 05 9a 1f 10 28 ?? 00 00 0a d2 9c 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKK_2147839356_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKK!MTB"
        threat_id = "2147839356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 09 11 09 2d df}  //weight: 4, accuracy: Low
        $x_1_2 = "Game2048Form.SFDDWED.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKR_2147839360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKR!MTB"
        threat_id = "2147839360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {01 25 16 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 04 53 00 09 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAG_2147839467_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAG!MTB"
        threat_id = "2147839467"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "wshsoftAimon" ascii //weight: 2
        $x_2_2 = "CNBBinvoker1proxystub" ascii //weight: 2
        $x_2_3 = "EXPerogni" ascii //weight: 2
        $x_2_4 = "wmcotationBuildTasks0ni" ascii //weight: 2
        $x_2_5 = "ntio4tRMedsaext" ascii //weight: 2
        $x_2_6 = "ComSvcCoibers1l1o100" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAW_2147839546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAW!MTB"
        threat_id = "2147839546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {95 5a 11 3d 20 af 06 00 00 95 2e 03 16 2b 01 17 17 59 11 3d 20 22 0e 00 00 95 5f 11 3d 20 d1 0a 00 00 95 61 58 80 08 00 00 04}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAX_2147839564_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAX!MTB"
        threat_id = "2147839564"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 04 15 58 13 04 11 04 16 fe 04 16 fe 01 13 05 11 05 2d b0}  //weight: 3, accuracy: High
        $x_1_2 = "G2D5H7R5ER47588857G754" wide //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAZ_2147839623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAZ!MTB"
        threat_id = "2147839623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 11 05 07 8e 69 5d 07 11 05 07 8e 69 5d 91 08 11 05 1f 16 5d 91 61 28 ?? 00 00 0a 07 11 05 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 05 15 58 13 05 11 05 16 fe 04 16 fe 01 13 06 11 06 2d b0}  //weight: 3, accuracy: Low
        $x_1_2 = "7GF8TPE69B55874FYZC72Y" wide //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAA_2147839628_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAA!MTB"
        threat_id = "2147839628"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 16 18 58 e0 91 20 c7 00 00 00 2e 03 16 2b 01 17 17 59 7e 11 00 00 04 20 db 00 00 00 95 5f 7e 11 00 00 04 20 7f 02 00 00 95 61 58 80 20 00 00 04}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAG_2147839629_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAG!MTB"
        threat_id = "2147839629"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {26 09 06 6f ?? ?? ?? 0a 08 07 6f ?? ?? ?? 0a 11 0f 17 58 13 0f 02 28 ?? ?? ?? 06 11 06 11 0c 5d}  //weight: 5, accuracy: Low
        $x_5_2 = {57 37 a2 0b 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a4 00 00 00 32 00 00 00 8e}  //weight: 5, accuracy: High
        $x_1_3 = "2ca64cb5-95e4-4640-a1af-478efe5b71da" ascii //weight: 1
        $x_1_4 = "GecikmeHesapla.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAJ_2147839630_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAJ!MTB"
        threat_id = "2147839630"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 9f a2 2b 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 95 00 00 00 34 00 00 00 73 01 00 00 49}  //weight: 5, accuracy: High
        $x_5_2 = "e01b8035-5434-48f9-995c-ff599bcae300" ascii //weight: 5
        $x_5_3 = {07 17 58 0b 07 1f 09 fe 04 13 04 11 04 2d 9d 06 17 58 0a 06 1f 09 fe 04 13 05 11 05 2d 8a}  //weight: 5, accuracy: High
        $x_5_4 = "cyylhg4z86ama52vb69t2nc7de6y7lxk" ascii //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBL_2147839703_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBL!MTB"
        threat_id = "2147839703"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {05 03 05 8e 69 5d 91 04 03 1f 16 5d 91 61 28 ?? ?? ?? 0a 05 03 17 58 05 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = "HIG8444HZA0878O59ZZ7GF" wide //weight: 1
        $x_1_3 = "System.Reflection.Assembly" wide //weight: 1
        $x_1_4 = "CreateInstance" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPEQ_2147839706_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPEQ!MTB"
        threat_id = "2147839706"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 01 72 01 00 00 70 20 00 01 00 00 14 14 14 6f ?? ?? ?? 0a 13 02 38 0f 00 00 00 7e 03 00 00 04 6f ?? ?? ?? 0a 38 0c 00 00 00 11 02 39 05 00 00 00 38 e5 ff ff ff}  //weight: 4, accuracy: Low
        $x_1_2 = "kedaiorangmelayu.xyz" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPAD_2147839708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPAD!MTB"
        threat_id = "2147839708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 16 9a 17 8d 21 00 00 01 13 1d 11 1d 16 1f 20 9d 11 1d 6f ?? ?? ?? 0a 13 15 de 03}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPAR_2147839709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPAR!MTB"
        threat_id = "2147839709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_8_1 = {02 08 02 08 91 03 08 06 5d 91 61 9c 08 17 d6 0c 08 09 31 ec}  //weight: 8, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAB_2147839792_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAB!MTB"
        threat_id = "2147839792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {16 9a 20 56 0b 00 00 95 6e 31 03 16 2b 01 17 17 59 11 34 16 9a 20 10 0d 00 00 95 5f 11 34 16 9a 20 64 03 00 00 95 61 58 80 43 00 00 04}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBN_2147839801_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBN!MTB"
        threat_id = "2147839801"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D+5A+9}@+}3@@@+}4@@@+FF+FF@@+B8@@@@@@@+4}@@" wide //weight: 1
        $x_1_2 = "9@@+}6+}A+18+72+}1@@+7}+16+73+1" wide //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBM_2147839803_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBM!MTB"
        threat_id = "2147839803"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D-5A-90?-03???-04???-FF-FF??-B8???????-40???????????????????????????????????-80" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAT_2147839807_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAT!MTB"
        threat_id = "2147839807"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "185.246.220.121/vik/dlll.txt" wide //weight: 2
        $x_1_2 = "S0j~t#n5F#fRdPU5Mkp" ascii //weight: 1
        $x_1_3 = "HAWK.HAWK" wide //weight: 1
        $x_1_4 = "vik/bruno.txt" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAU_2147839808_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAU!MTB"
        threat_id = "2147839808"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {09 94 13 07 11 09 09 11 09 11 05 94 9e 11 09 11 05 11 07 9e 11 09 11 09 09 94 11 09 11 05 94 58 20 00 01 00 00 5d 94 13 06 11 0a 11 04 07 11 04 91 11 06 61 d2 9c 11 04 13 0b 11 0b 17 58 13 04 11 04 07 8e 69 32}  //weight: 3, accuracy: High
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAF_2147839834_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAF!MTB"
        threat_id = "2147839834"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 09 11 09 09 94 11 09 11 05 94 58 20 00 01 00 00 5d 94 13 06 11 0a 11 04 07 11 04 91 11 06 61 d2 9c 11 04}  //weight: 5, accuracy: High
        $x_2_2 = "3c370b96-c774-4bc2-99a4-c91507534b3d" ascii //weight: 2
        $x_1_3 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAH_2147839835_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAH!MTB"
        threat_id = "2147839835"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "22"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {57 97 a2 2b 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a3 00 00 00 38 00 00 00 94 00 00 00 2e}  //weight: 10, accuracy: High
        $x_10_2 = {57 97 a2 2b 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a4 00 00 00 38 00 00 00 94 00 00 00 2d}  //weight: 10, accuracy: High
        $x_5_3 = "abb16e15-f9df-4470-b8db-25c3b4069583" ascii //weight: 5
        $x_5_4 = {4f 6e 4d 6f 75 73 65 43 6c 69 63 6b 00 4f 6e 4b 65 79 44 6f 77 6e 00 49 6e 76 6f 6b 65 00 42 65 67 69 6e 49 6e 76 6f 6b 65 00 45 6e 64 49 6e 76 6f 6b 65 00 44 69 73 70 6f 73 65}  //weight: 5, accuracy: High
        $x_2_5 = "f0659e5905454a5e99b9752afc78b700" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_5_*) and 1 of ($x_2_*))) or
            ((2 of ($x_10_*) and 1 of ($x_2_*))) or
            ((2 of ($x_10_*) and 1 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MAI_2147839836_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAI!MTB"
        threat_id = "2147839836"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 09 11 09 2d df}  //weight: 5, accuracy: Low
        $x_5_2 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a d2 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 08 11 08 2d de}  //weight: 5, accuracy: Low
        $x_1_3 = "StrReverse" ascii //weight: 1
        $x_1_4 = "get_ManagedThreadId" ascii //weight: 1
        $x_1_5 = "ContainerControl" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_5_*) and 3 of ($x_1_*))) or
            ((2 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CAD_2147839837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAD!MTB"
        threat_id = "2147839837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {05 03 05 8e 69 5d 91 04 03 1f 16 5d 91 61 28 ?? 00 00 0a 05 03 17 58 05 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 0a 2b 00 06 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "4KBXS84E9F4Q5XBHGXB554" wide //weight: 1
        $x_1_3 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GDS_2147839840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GDS!MTB"
        threat_id = "2147839840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cc79534359493a987535e681a581ee58d" ascii //weight: 1
        $x_1_2 = "ca028b7699f84d1a27ac0c8d4438ed131" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
        $x_1_5 = "DESCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAH_2147839872_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAH!MTB"
        threat_id = "2147839872"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "afRyVQDGxtA" ascii //weight: 5
        $x_5_2 = "MSRGcyMpj" ascii //weight: 5
        $x_5_3 = "DKvzKp" ascii //weight: 5
        $x_2_4 = "Confuser.Core 1.6.0+447341964f" ascii //weight: 2
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAE_2147839915_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAE!MTB"
        threat_id = "2147839915"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {05 03 05 8e 69 5d 91 04 03 1f 16 5d 91 61 28 ?? 00 00 0a 05 03 17 58 05 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 0a 2b 00 06 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDN_2147839950_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDN!MTB"
        threat_id = "2147839950"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "07706690-5292-4a9a-bc5a-4931c7421380" ascii //weight: 1
        $x_1_2 = "NHGGFuI" ascii //weight: 1
        $x_1_3 = "A.cfcba541a3cee3d8e12280a110e82cdda" ascii //weight: 1
        $x_1_4 = "cc68a141b147869083afc269177a1209c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAI_2147839967_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAI!MTB"
        threat_id = "2147839967"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {07 11 08 06 11 08 9a 1f 10 28 fe 00 00 0a 9c 11 08 17 58 13 08 11 08 06 8e 69 fe 04 13 09 11 09 2d de 28 ff 00 00 0a 07 6f 00 01 00 0a}  //weight: 10, accuracy: High
        $x_5_2 = "P!es.Wh!te" wide //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAE_2147839970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAE!MTB"
        threat_id = "2147839970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "4397490b-33f3-4eea-a0bd-5ba475db18bd" ascii //weight: 5
        $x_4_2 = "HvGJoP.My" ascii //weight: 4
        $x_2_3 = "Confuser.Core 1.6.0+447341964f" ascii //weight: 2
        $x_1_4 = "ProcessWindowStyle" ascii //weight: 1
        $x_1_5 = "SpecialFolder" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NER_2147840038_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NER!MTB"
        threat_id = "2147840038"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 06 72 01 00 00 70 6f ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a de 07}  //weight: 5, accuracy: Low
        $x_5_2 = {07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 08 18 58 0c 08 06 32 e4}  //weight: 5, accuracy: Low
        $x_1_3 = "Nfhszmcsdk" wide //weight: 1
        $x_1_4 = "KDE Softwares" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAJ_2147840110_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAJ!MTB"
        threat_id = "2147840110"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 18 5d 16 fe 01 08 06 8e b7 17 da fe 01 16 fe 01 5f 08 16 fe 02 5f 2c 0c 09 28 ?? 01 00 06 6f ?? 00 00 0a 26 09 06 08}  //weight: 10, accuracy: Low
        $x_1_2 = "vaultcli.dll" ascii //weight: 1
        $x_1_3 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_4 = "get_OSVersion" ascii //weight: 1
        $x_1_5 = "ChangeClipboardChain" ascii //weight: 1
        $x_1_6 = "RegOpenKeyEx" ascii //weight: 1
        $x_1_7 = "GetProcessById" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAC_2147840124_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAC!MTB"
        threat_id = "2147840124"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 11 05 07 11 05 9a 1f 10 28 ?? 00 00 0a d2 6f ?? 00 00 0a 00 11 05 17 58 13 05 11 05 07 8e 69 fe 04 13 06 11 06 2d d8}  //weight: 4, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAM_2147840365_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAM!MTB"
        threat_id = "2147840365"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 03 8e 69 5d 91 06 04 1f 16 5d 91 61 28 ?? ?? ?? 0a 03 04 17 58 03 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = "EBQ8O558EFJB8448FTA7G5" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAA_2147840454_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAA!MTB"
        threat_id = "2147840454"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 13 0a 2b 1b 00 11 04 11 0a 08 11 0a 91 09 11 0a 09 8e 69 5d 91 61 d2 9c 00 11 0a 17 58 13 0a 11 0a 08 8e 69 fe 04 13 0b 11 0b 2d d8}  //weight: 2, accuracy: High
        $x_1_2 = "SafeGameWinForms" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAM_2147840495_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAM!MTB"
        threat_id = "2147840495"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {91 13 06 16 16 11 06 11 05 18 28 ?? 00 00 06 28 ?? 00 00 0a 28 ?? 00 00 0a 13 07 16 16 02 74 ?? 00 00 1b 11 04 28 ?? 00 00 0a 91 11 07 18 28 ?? 00 00 06 28 ?? 00 00 0a 28 ?? 00 00 0a 13 08 06 1a 9a 74 ?? 00 00 1b 11 04 28 ?? 00 00 0a 11 08 b4 9c 11 04 09 12 04 28}  //weight: 2, accuracy: Low
        $x_2_2 = {11 04 04 03 8e 69 16 16 17 28 ?? 00 00 06 28 ?? 00 00 0a 28 ?? 00 00 0a 04 5f 13 05 03 11 04 28 ?? 00 00 0a 03 8e 69 16 16 17 28}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JW_2147840497_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JW!MTB"
        threat_id = "2147840497"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {04 05 28 82 00 00 0a 04 28 ?? 00 00 0a 05 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a 28 85 00 00 0a 0a}  //weight: 2, accuracy: Low
        $x_2_2 = {02 03 5d 0c 08}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAJ_2147840557_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAJ!MTB"
        threat_id = "2147840557"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0a 2b 5c 00 72 01 00 00 70 28 ?? 00 00 06 73 ?? 00 00 0a 0b 73 ?? 00 00 0a 0c 07 16 73 ?? 00 00 0a 73 ?? 00 00 0a 0d 09 08 6f ?? 00 00 0a de 0a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_YT_2147840566_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.YT!MTB"
        threat_id = "2147840566"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 03 04 03 8e 69 5d 91 07 04 1f 16 5d 91 61 28 ?? ?? ?? 0a 03 04 17 58 03 8e 69 5d 91 28 ?? ?? ?? 0a 59 06 58 06 5d d2 0c 2b 00 08 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_TSP_2147840667_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.TSP!MTB"
        threat_id = "2147840667"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 03 04 03 8e 69 5d 91 07 04 05 5d 91 61 28 ?? ?? ?? 0a 03 04 17 58 03 8e 69 5d 91 28 ?? ?? ?? 0a 59 06 58 06 5d d2 0c 2b 00 08 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GEA_2147840750_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GEA!MTB"
        threat_id = "2147840750"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "aspwerYevents" ascii //weight: 1
        $x_1_2 = "rcimlmZrukgMgr" ascii //weight: 1
        $x_1_3 = "sfmsystemYSg400" ascii //weight: 1
        $x_1_4 = "GetCurrentDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GEG_2147840752_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GEG!MTB"
        threat_id = "2147840752"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "PoralPeril_StefanTicu" ascii //weight: 1
        $x_1_2 = "Invoke" ascii //weight: 1
        $x_3_3 = "hGd8R4RTbsr4S5PynS" ascii //weight: 3
        $x_3_4 = "HoQMPGJM8cop9feYT6" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            ((2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_CAL_2147840785_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAL!MTB"
        threat_id = "2147840785"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {26 20 02 00 00 00 38 ?? ?? ?? ?? 11 04 11 00 18 5b 11 02 11 00 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 06 9c 20 03 00 00 00 38}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAN_2147840787_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAN!MTB"
        threat_id = "2147840787"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 11 04 8e 69 2f 25 11 04 11 05 9a 13 06 11 06 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 2e 07 11 06 6f ?? ?? ?? 0a 11 05 17 d6 13 05 2b d3}  //weight: 5, accuracy: Low
        $x_1_2 = "ScannerService.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAN_2147840787_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAN!MTB"
        threat_id = "2147840787"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0d 16 13 04 2b 3a 09 17 8d ?? 00 00 01 25 16 08 17 8d ?? 00 00 01 25 16 11 04 8c ?? 00 00 01 a2 14 28 ?? 00 00 0a 28 ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 6f ?? 00 00 0a 00 11 04 17 d6 13 04 00 11 04}  //weight: 4, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAS_2147840804_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAS!MTB"
        threat_id = "2147840804"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 06 72 87 03 00 70 28 ?? ?? 00 06 28 ?? ?? 00 0a 28 ?? ?? 00 06 25 28 ?? ?? 00 06 0b 07 6f ?? ?? 00 0a 6f ?? ?? 00 0a 28 ?? ?? 00 0a 0c 07 08 28 ?? ?? 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "incurable.exe" ascii //weight: 1
        $x_1_3 = "WinForms_RecursiveFormCreate" wide //weight: 1
        $x_1_4 = "WinForms_SeeInnerException" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAK_2147840888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAK!MTB"
        threat_id = "2147840888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "21"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {18 8d 17 00 00 01 25 16 72 57 55 02 70 a2 25 17 72 d7 01 00 70 a2 14 14 14 28 18 02 00 0a 28 ab 01 00 0a 0b 07 0a 2b 00 06 2a}  //weight: 10, accuracy: High
        $x_5_2 = "dl.dropbox.com" wide //weight: 5
        $x_2_3 = "hide.bat" wide //weight: 2
        $x_2_4 = "show.bat" wide //weight: 2
        $x_1_5 = "Invoke" wide //weight: 1
        $x_1_6 = "Replace" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAL_2147840890_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAL!MTB"
        threat_id = "2147840890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0a 03 04 03 8e 69 5d 91 06 04 1f 16 5d 91 61 28 ?? 00 00 0a 03 04 17 58 03 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 0b 2b 00 07 2a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAR_2147840931_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAR!MTB"
        threat_id = "2147840931"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0b 03 8e 69 0c 03 04 08 5d 91 07 04 1f 16 5d 91 61 28 ?? 00 00 0a 03 04 17 58 08 5d 91 28 ?? 00 00 0a 59 06 58 06 5d d2 0d 09 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAT_2147840984_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAT!MTB"
        threat_id = "2147840984"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0b 03 04 03 8e 69 5d 91 07 04 05 5d 91 61 28 ?? 01 00 0a 6e 03 04 17 58 03 8e 69 5d 91 28 ?? 01 00 0a 6a 59 06 6a 58 06 6a 5d d2 0c 2b 00 08 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAU_2147840986_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAU!MTB"
        threat_id = "2147840986"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0d 16 13 04 2b 1d 06 09 11 04 09 8e 69 5d 91 08 11 04 91 61 d2 6f ?? 00 00 0a 11 04 17 58 16 2d e1 13 04 11 04 08 8e 69 1c 2c fc}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAU_2147840986_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAU!MTB"
        threat_id = "2147840986"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2b 41 16 6f ?? 00 00 0a 6f ?? 00 00 0a 72 ?? 00 00 70 7e ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 2a 73 ?? 00 00 0a 38 ?? ff ff ff 0a 38 ?? ff ff ff 06 2b c2 6f ?? 00 00 0a 2b bd 28 ?? 00 00 0a 2b bd 06 2b bc}  //weight: 3, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAV_2147840991_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAV!MTB"
        threat_id = "2147840991"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {16 6a 17 11 33 1f 1f 5f 62 6a 11 40 1f 73 95 6e 5f 2e 03 16 2b 01 17 17 59 11 40 20 39 0e 00 00 95 5f 11 40 20 ee 0f 00 00 95 61 58 13 43}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPRP_2147841025_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPRP!MTB"
        threat_id = "2147841025"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 05 07 8e 69 5d 02 07 11 05 28 ?? ?? ?? 06 9c 00 11 05 15 58 13 05 11 05 16 fe 04 16 fe 01 13 06 11 06 2d d9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAW_2147841047_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAW!MTB"
        threat_id = "2147841047"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {61 2b ae 03 04 08 5d 91 07 04 1f 16 5d 91 61 28 ?? 00 00 06 03 04 17 58 08 5d 91 28 ?? 00 00 06 59 06 58 06 5d d2 0d 11 04 20 f4 da 76 13 5a 20 39 ec 43 75 61 38 ?? ff ff ff 11 04 20 2d e4 1d f9 5a 20 a9 cc 2c 0a 61 38 ?? ff ff ff 03 8e 69 17 59 17 58 0c 11 04 20 b9 7e 2d 6b 5a 20 82 94 ad 74 61 38}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKH_2147841102_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKH!MTB"
        threat_id = "2147841102"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {45 00 6c 00 6c 00 69 00 63 00 6f 00 74 00 74 00 76 00 69 00 6c 00 6c 00 65 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 43 00 53 00 33}  //weight: 2, accuracy: High
        $x_2_2 = "Are_AirPods_Waterproof_the_simple_answer_is_No" wide //weight: 2
        $x_2_3 = "Reasons_to_Allow_Pop_Ups_Safari" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKZ_2147841104_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKZ!MTB"
        threat_id = "2147841104"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 11 08 08 11 08 9a 1f 10 28 ?? 00 00 0a d2 6f ?? 00 00 0a 00 11 08 17 58 13 08 11 08 08 8e 69 fe 04 13 09 11 09 2d d8}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAM_2147841113_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAM!MTB"
        threat_id = "2147841113"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {0b 03 8e 69 0c 03 04 08 5d 91 07 04 1f 16 5d 91 61 28 ?? 00 00 0a 03 04 17 58 08 5d 91 28 ?? 00 00 0a 59 06 58 06 5d d2 0d 2b 00 09 2a}  //weight: 10, accuracy: Low
        $x_1_2 = "Invoke" ascii //weight: 1
        $x_1_3 = "AssemblyTitleAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAV_2147841119_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAV!MTB"
        threat_id = "2147841119"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 06 18 6f ?? 00 00 0a 06 6f ?? 00 00 0a 0c 02 0d 08 09 16 09 8e b7 6f ?? 00 00 0a 13 04 dd}  //weight: 2, accuracy: Low
        $x_1_2 = "mprzrulmemtpoaj.Resource" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAO_2147841124_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAO!MTB"
        threat_id = "2147841124"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 02 8e b7 17 59 13 2d 13 23 2b 1a 02 11 23 02 11 23 91 08 11 23 07 6f ?? 00 00 0a 5d 91 61 9c 11 23 17 58 13 23 11 23 11 2d 31 e0}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAP_2147841125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAP!MTB"
        threat_id = "2147841125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 0a 06 72 e3 05 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 0b 07 02 16 02 8e 69 6f ?? 00 00 0a 0c 2b 00 08 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAS_2147841127_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAS!MTB"
        threat_id = "2147841127"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {08 11 06 07 11 06 9a 1f 10 28 ?? 00 00 0a d2 9c 11 06 17 58 13 06 11 06 07 8e 69 fe 04 13 07 11 07 2d dd}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAZ_2147841198_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAZ!MTB"
        threat_id = "2147841198"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 06 72 ed 05 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 0b 07 02 16 02 8e 69 6f ?? 00 00 0a 0c 2b 00 08 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "tLyVZ97GOylcjqUlHyHxJQeyK9CnC2R2OlKvKwwxZCk" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAN_2147841213_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAN!MTB"
        threat_id = "2147841213"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {28 22 00 00 0a 72 25 00 00 70 28 07 00 00 06 6f 23 00 00 0a 28 24 00 00 0a 28 02 00 00 2b 28 03 00 00 2b 0b de 17}  //weight: 10, accuracy: High
        $x_5_2 = "wtrash" wide //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAB_2147841246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAB!MTB"
        threat_id = "2147841246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 11 0a 75 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 75 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 1f 11 13 0e 38 ?? fe ff ff 11 09 17 58 13 09 1e 13 0e 38 ?? fe ff ff 11 09 11 07 31 08 1b 13 0e 38}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMG_2147841282_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMG!MTB"
        threat_id = "2147841282"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 07 11 0a 11 06 11 0a 9a 1f 10 28 ?? ?? ?? 0a d2 9c 11 0a 17 58 13 0a 11 0a 11 06 8e 69 fe 04 13 0b 11 0b 2d da}  //weight: 4, accuracy: Low
        $x_1_2 = "AmirCalendar.ResourceCombo" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAF_2147841319_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAF!MTB"
        threat_id = "2147841319"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 11 0a 75 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 74 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 18 13 0e 38 [0-4] 11 09 17 58 13 09 1c 13 0e 38}  //weight: 4, accuracy: Low
        $x_1_2 = "Append" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAG_2147841334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAG!MTB"
        threat_id = "2147841334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0d 16 13 07 2b 18 00 09 11 07 08 11 07 9a 1f 10 28 ?? 00 00 0a d2 9c 00 11 07 17 58 13 07 11 07 08 8e 69 fe 04 13 08 11 08 2d db}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAI_2147841362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAI!MTB"
        threat_id = "2147841362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0d 16 0a 2b 12 09 06 08 06 9a 1f 10 28 ?? 00 00 0a d2 9c 06 17 58 0a 06 08 8e 69 fe 04 13 08 11 08 2d e2}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAK_2147841395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAK!MTB"
        threat_id = "2147841395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1f 1d 95 34 03 16 2b 01 17 17 59 7e 21 00 00 04 20 2e 04 00 00 95 5f 7e 21 00 00 04 20 9c 02 00 00 95 61 58 80 10 00 00 04}  //weight: 2, accuracy: High
        $x_2_2 = {11 2a 16 95 7e 1f 00 00 04 6f 05 00 00 0a 37 03 16 2b 01 17 17 59 7e 21 00 00 04 20 12 03 00 00 95 5f 7e 21 00 00 04 20 a2 01 00 00 95 61 58 80 10 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAK_2147841404_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAK!MTB"
        threat_id = "2147841404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {2d 02 16 2a 16 0a 16 0b 28 ?? ?? ?? 0a 0c 16 0d 2b 4b 08 09 9a 6f ?? ?? ?? 0a 03 28 ?? ?? ?? 0a 2c 37 06 2d 15 08 09 9a}  //weight: 5, accuracy: Low
        $x_1_2 = "b9d98034-456c-4f97-95da-b3e192ae4bf6" ascii //weight: 1
        $x_1_3 = "WriteProcessMemory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAL_2147841445_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAL!MTB"
        threat_id = "2147841445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 11 0a 74 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 74 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 1f 0d 13 0e 38 [0-4] 11 09 17 58 13 09 1f 0b 13 0e 38 [0-4] 11 09 11 07 31 09 1f 0c 13 0e 38}  //weight: 4, accuracy: Low
        $x_1_2 = "Append" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DAM_2147841446_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAM!MTB"
        threat_id = "2147841446"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {11 09 1f 41 59 1f 0a 58 d1 13 09 2b 08 11 09 1f 30 59 d1 13 09 09 11 07 1f 10 11 08 5a 11 09 58 d2 9c 00 11 07 17 58 13 07 11 07 08 fe 04 13 0c 11 0c 2d 84}  //weight: 4, accuracy: High
        $x_1_2 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_DAH_2147841591_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAH!MTB"
        threat_id = "2147841591"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 fe 01 13 07 11 07 2c 14 00 06 72 ?? 09 00 70 28 ?? 00 00 0a 08 28 ?? 00 00 0a 00 00 06 72 ?? 09 00 70 28 ?? 00 00 0a 28 ?? 00 00 0a 26 20 88 13 00 00 28 ?? 00 00 0a 00 d0 ?? 00 00 01 28}  //weight: 2, accuracy: Low
        $x_1_2 = "C:\\Users\\Public\\DynamicUserFolder" wide //weight: 1
        $x_1_3 = "Exclusion.bat" wide //weight: 1
        $x_1_4 = "BIN\\DATA.BIN" wide //weight: 1
        $x_1_5 = "WriteAllBytes" ascii //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAJ_2147841592_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAJ!MTB"
        threat_id = "2147841592"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "Simulateur_des.Properties.Resources.resources" ascii //weight: 2
        $x_2_2 = "Simulateur_des.Form1.resources" ascii //weight: 2
        $x_1_3 = "ToByte" ascii //weight: 1
        $x_1_4 = "DebuggerNonUserCodeAttribute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAN_2147841595_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAN!MTB"
        threat_id = "2147841595"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "czN3czN3czN3czN3czN3ESIhEyN3czN3ESI3czNhEyNhESIhczNhc" wide //weight: 1
        $x_1_2 = "hESIhESI3cTI3EyNhczN3czN3czN3czN3czN3czN3czNK0wN3c" wide //weight: 1
        $x_1_3 = "ESIhczNhEyN3czNhEyN3EyNK0wN3czN3ESIhEyN3E" wide //weight: 1
        $x_1_4 = "5nfhESIhESIhESIhESIhESIhESIhESIhESI3ESIhESIhEyN" wide //weight: 1
        $x_1_5 = "KFSIhESIhEyN3ESIhEyN3czN3ESIhESI3cTIh4XIhE" wide //weight: 1
        $x_1_6 = "FromBase64String" ascii //weight: 1
        $x_1_7 = "Split" ascii //weight: 1
        $x_1_8 = "StrReverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKA_2147841603_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKA!MTB"
        threat_id = "2147841603"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {09 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 86 6f ?? ?? ?? 0a 00 11 04}  //weight: 3, accuracy: Low
        $x_3_2 = {65 00 72 00 72 00 33 00 00 0f 43 00 51 00 4c 00 6b 00 6b 00 67 00 6b 00 00 1f 77 00 73 00 73 00 73 00 73 00 73 00 73 00 73 00 73 00 73 00 73 00 73 00 33 00 32 00 34}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKC_2147841605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKC!MTB"
        threat_id = "2147841605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 04}  //weight: 5, accuracy: Low
        $x_1_2 = "pongroot.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAO_2147841619_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAO!MTB"
        threat_id = "2147841619"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 11 0a 74 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 75 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 1f 0e 13 0e 38 ?? fe ff ff 11 09 17 58 13 09 16 13 0e 38 ?? fe ff ff 11 09 11 07 31 08 19 13 0e 38}  //weight: 4, accuracy: Low
        $x_1_2 = "Append" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBAQ_2147841624_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBAQ!MTB"
        threat_id = "2147841624"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 13 04 2b 15 07 11 04 06 11 04 9a 1f 10 28 ?? 00 00 0a 9c 11 04 17 58 13 04 11 04 06 8e 69 fe 04 13 05 11 05 2d de}  //weight: 1, accuracy: Low
        $x_1_2 = " System.Activator " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAR_2147841644_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAR!MTB"
        threat_id = "2147841644"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 08 1f 41 59 1f 0a 58 d1 13 08 2b 08 11 08 1f 30 59 d1 13 08 09 11 06 1f 10 11 07 5a 11 08 58 d2 9c 00 11 06 17 58 13 06 11 06 08 fe 04 13 0b 11 0b 2d 84}  //weight: 2, accuracy: High
        $x_2_2 = {11 07 1f 41 59 1f 0a 58 d1 13 07 2b 08 11 07 1f 30 59 d1 13 07 07 19 11 06 5a 17 58 6f}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAT_2147841691_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAT!MTB"
        threat_id = "2147841691"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {13 05 16 13 08 2b 18 11 05 11 08 11 04 11 08 9a 1f 10 28 ?? 00 00 0a d2 9c 11 08 17 58 13 08 11 08 11 04 8e 69 32 e0}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAU_2147841692_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAU!MTB"
        threat_id = "2147841692"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0a 07 16 07 8e 69 6f ?? 00 00 0a 13 04 11 04 8e 69 1f 10 59 8d ?? 00 00 01 13 05 11 04 1f 10 11 05 16 11 04 8e 69 1f 10 59 28}  //weight: 4, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAW_2147841726_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAW!MTB"
        threat_id = "2147841726"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 13 06 2b 18 00 08 11 06 07 11 06 9a 1f 10 28 ?? 00 00 0a d2 9c 00 11 06 17 58 13 06 11 06 07 8e 69 fe 04 13 07 11 07 2d db}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAX_2147841727_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAX!MTB"
        threat_id = "2147841727"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {2b 14 2b 19 2b 1e 15 2d 06 26 16 2d 04 de 22 2b 1a 19 2c ec 2b f4 28 ?? 00 00 06 2b e5 28 ?? 00 00 2b 2b e0 28 ?? 00 00 2b 2b db 0a 2b e3 26 de cb}  //weight: 4, accuracy: Low
        $x_1_2 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CND_2147841802_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CND!MTB"
        threat_id = "2147841802"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 06 11 05 08 28 4a 00 00 06 13 07 09 28 4b 00 00 06 13 08 11 08 11 07 16 28 4c 00 00 06 13 09}  //weight: 5, accuracy: High
        $x_1_2 = "PassGen" ascii //weight: 1
        $x_1_3 = "Mutex" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MRX_2147841808_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MRX!MTB"
        threat_id = "2147841808"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 06 72 df 11 00 70 6f ?? ?? ?? 0a 74 ?? ?? ?? 01 28 ?? ?? ?? 06 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 17 8d ?? ?? ?? 01 25 16 1f 2d 9d 6f ?? ?? ?? 0a 0b 07 8e 69 8d ?? ?? ?? 01 0c 16 13 06 2b 17 00 08 11 06 07 11 06 9a 1f 10 28 ?? ?? ?? 0a 9c 00 11 06 17 58 13 06 11 06 07 8e 69 fe 04 13 07 11 07 2d dc}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAY_2147841815_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAY!MTB"
        threat_id = "2147841815"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 13 05 2b 18 00 08 11 05 07 11 05 9a 1f 10 28 ?? 00 00 0a d2 9c 00 11 05 17 58 13 05 11 05 07 8e 69 fe 04 13 06 11 06 2d db}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CNG_2147841871_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CNG!MTB"
        threat_id = "2147841871"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 14 72 ca 51 02 70 18 8d ?? ?? ?? ?? 25 16 72 ?? ?? ?? ?? a2 25 17 72 ?? ?? ?? ?? a2 [0-3] 28 ?? ?? ?? ?? 14 72 ?? ?? ?? ?? 18 8d ?? ?? ?? ?? 25 16 72 ?? ?? ?? ?? a2 25 17 72 ?? ?? ?? ?? a2 [0-3] 28 ?? ?? ?? ?? 14 72 ?? ?? ?? ?? 18 8d ?? ?? ?? ?? 25 16 72 ?? ?? ?? ?? a2 25 17 72 ?? ?? ?? ?? a2 [0-3] 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 13}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAA_2147841879_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAA!MTB"
        threat_id = "2147841879"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 13 05 2b 17 00 08 11 05 07 11 05 9a 1f 10 28 ?? 00 00 0a 9c 00 11 05 17 58 13 05 11 05 07 8e 69 fe 04 13 06 11 06 2d dc}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
        $x_2_4 = "radarsystem.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCJ_2147841910_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCJ!MTB"
        threat_id = "2147841910"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {13 04 06 11 04 6f ?? ?? ?? 0a 06 18 6f ?? ?? ?? 0a 28 ?? ?? ?? 06 0c 06 6f ?? ?? ?? 0a 08 16 08 8e 69 6f ?? ?? ?? 0a 13 05 de 0e 07 6f ?? ?? ?? 0a dc}  //weight: 3, accuracy: Low
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKG_2147841912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKG!MTB"
        threat_id = "2147841912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 09 11 09 2d df}  //weight: 4, accuracy: Low
        $x_1_2 = "ProjectAI.RCSACD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKJ_2147841913_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKJ!MTB"
        threat_id = "2147841913"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 11 08 08 11 08 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 08 17 58 13 08 11 08 08 8e 69 fe 04 13 09 11 09 2d d9}  //weight: 5, accuracy: Low
        $x_1_2 = "BuildEvent.RCSAW" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKS_2147841914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKS!MTB"
        threat_id = "2147841914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {17 59 7e 11 00 00 04 20 73 01 00 00 95 5f 7e 11 00 00 04 20 d6 01 00 00 95 61 58 80 20 00 00 04 7e 20 00 00 04 7e 11 00 00 04 20 fe 02 00 00 95 33 72 7e 23 00 00 04 1f 1e 11 24 11 22 1b 95 59 7e 11 00 00 04 20 e7 01 00 00 95 59 7e 11 00 00 04 20 00 01 00 00 95 1f 1f 5f 64}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAC_2147841999_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAC!MTB"
        threat_id = "2147841999"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 1f 5c 9d 6f ?? 00 00 0a 25 8e 69 18 59 0b 07 9a 0a de 03 26 de 00 06 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {16 0a 2b 36 7e ?? 00 00 04 06 7e ?? 00 00 04 06 9a 1b 28}  //weight: 1, accuracy: Low
        $x_1_3 = {0a a2 06 17 58 0a 06 7e ?? 00 00 04 8e 69 32 c0}  //weight: 1, accuracy: Low
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAC_2147841999_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAC!MTB"
        threat_id = "2147841999"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 01 13 05 38 ?? 00 00 00 11 01 11 02 11 01 11 03 91 9c 20 03 00 00 00 fe ?? 06 00 38 ?? ff ff ff 11 01 11 03 11 04 9c 38 ?? 00 00 00 11 03 17 59 13 03 20 02 00 00 00 7e ?? 06 00 04 7b ?? 06 00 04 39 ?? ff ff ff 26 20 02 00 00 00 38 ?? ff ff ff 11 01 11 02 91 13 04 38 ?? ff ff ff 11 02 17 58 13 02 20 00 00 00 00 7e}  //weight: 4, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAV_2147842018_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAV!MTB"
        threat_id = "2147842018"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0d 16 13 05 2b 35 08 11 05 9a 28 ?? 00 00 0a 13 06 11 06 18 5d 2d 10 09 11 05 11 06 1f 19 58 28 ?? 00 00 0a 9c 2b 0e 09 11 05 11 06 1f 0f 59 28 ?? 00 00 0a 9c 11 05 17 58 13 05 11 05 08 8e 69 17 59 32 c2}  //weight: 2, accuracy: Low
        $x_1_2 = "Decrypt" ascii //weight: 1
        $x_1_3 = "DownloadString" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBS_2147842115_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBS!MTB"
        threat_id = "2147842115"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D-5A-90-}03-}}}04-}}}FF-FF-}}B8-}}}}}}}40" wide //weight: 1
        $x_1_2 = "}}48-}}}}}}}}}}}2E-74-65-78-74-}}}0" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBP_2147842122_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBP!MTB"
        threat_id = "2147842122"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D+5A+9}:+}3:::+}4:::+FF+FF::+B" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBR_2147842123_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBR!MTB"
        threat_id = "2147842123"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00=================================================" ascii //weight: 1
        $x_1_2 = "System.Reflection.Assembly" wide //weight: 1
        $x_1_3 = "KP.Xd" wide //weight: 1
        $x_1_4 = "360f84d73f03" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAZ_2147842126_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAZ!MTB"
        threat_id = "2147842126"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 08 11 05 11 01 11 05 9a 1f 10 28 ?? 00 00 0a d2 9c 20 26 00 00 00 38 ?? ?? ff ff 00 02 7b ?? 00 00 04 16 6f ?? 00 00 0a 38 ?? ?? ff ff 00 02 7b ?? 00 00 04 02}  //weight: 4, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAB_2147842127_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAB!MTB"
        threat_id = "2147842127"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 09 5a 20 ff 00 00 00 5d 1f 14 11 09 5a 20 ff 00 00 00 5d 20 96 00 00 00 11 09 5a 20 ff 00 00 00 5d 28}  //weight: 2, accuracy: High
        $x_2_2 = {09 11 06 08 11 06 9a 7b ?? 00 00 04 a1 00 11 06 17 58 13 06 11 06 03 6f ?? 00 00 0a fe 04 13 07 11 07}  //weight: 2, accuracy: Low
        $x_1_3 = "radarsystem.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAP_2147842137_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAP!MTB"
        threat_id = "2147842137"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {38 00 00 00 00 11 00 6f ?? 00 00 0a 11 03 16 11 03 8e 69 6f ?? 00 00 0a 13 04 38 41 00 00 00 11 00 18}  //weight: 10, accuracy: Low
        $x_2_2 = "TripleDESCryptoServiceProvider" ascii //weight: 2
        $x_2_3 = "Ytaaajcerzguid" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPAH_2147842177_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPAH!MTB"
        threat_id = "2147842177"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cmd.exe /c C:\\Windows\\System32\\netsh.exe interface ipv4 set dns name=" wide //weight: 1
        $x_1_2 = "t.me/dRidulEDhRQYNREkN" wide //weight: 1
        $x_1_3 = "37.139.129.222" wide //weight: 1
        $x_1_4 = "vZjNeHqM" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAD_2147842247_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAD!MTB"
        threat_id = "2147842247"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 13 06 2b 17 00 08 11 06 07 11 06 9a 1f 10 28 ?? 00 00 0a 9c 00 11 06 17 58 13 06 11 06 07 8e 69 fe 04 13 07 11 07 2d dc}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBT_2147842254_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBT!MTB"
        threat_id = "2147842254"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 17 8d ?? 00 00 01 25 16 06 8c ?? 00 00 01 a2 14 28 ?? 00 00 0a 28 ?? 00 00 0a 1f 10 28 ?? ?? ?? 0a 86 6f ?? 00 00 0a 06 17 d6 0a 06 20 00 7c 00 00 fe 04 13 06 11 06 2d c4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAE_2147842256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAE!MTB"
        threat_id = "2147842256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 11 0a 75 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 75 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 1f 0f 13 0e 38 ?? fe ff ff 11 09 17 58 13 09 1f 0d 13 0e 38}  //weight: 4, accuracy: Low
        $x_1_2 = "Append" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBV_2147842316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBV!MTB"
        threat_id = "2147842316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 2b 00 35 00 41 00 2b 00 39 00 7d 00 5c 00 2b 00 7d 00 33 00 5c 00 5c 00 5c 00 2b 00 7d 00 34 00 5c 00 5c 00 5c 00 2b 00 46 00 46 00 2b 00 46 00 46 00 5c 00 5c 00 2b 00 42 00 38 00 5c}  //weight: 1, accuracy: High
        $x_1_2 = "69+73+2}+7}+72+6F+67+72+61+" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBV_2147842316_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBV!MTB"
        threat_id = "2147842316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 07 11 04 9a 1f 10 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 05 11 05 2d dc}  //weight: 1, accuracy: Low
        $x_1_2 = "           System.Activator       " wide //weight: 1
        $x_1_3 = " CreateInstance " wide //weight: 1
        $x_1_4 = "Manning.Passenger" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAF_2147842322_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAF!MTB"
        threat_id = "2147842322"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 16 0d 2b 10 07 08 09 93 66 d1 6f ?? 00 00 0a 26 09 17 58 0d 09 08 8e 69 fe 04 13 04 11 04 2d e4}  //weight: 1, accuracy: Low
        $x_1_2 = {16 fe 01 2b 01 16 0b 07 2c 10 02 17 9a 28 ?? 00 00 0a 28 ?? 00 00 06 0a 2b 03 1f 28 0a 06 0c 08 2a}  //weight: 1, accuracy: Low
        $x_1_3 = "Append" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
        $x_1_5 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBW_2147842393_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBW!MTB"
        threat_id = "2147842393"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "E}:::|}2::::::|}3:|4}|85::|1}::" wide //weight: 1
        $x_1_2 = {34 00 44 00 7c 00 35 00 41 00 7c 00 39 00 7d 00 3a 00 7c 00 7d 00 33 00 3a 00 3a 00 3a 00 7c 00 7d 00 34 00 3a 00 3a 00 3a 00 7c 00 46 00 46 00 7c 00 46 00 46 00 3a 00 3a 00 7c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAL_2147842511_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAL!MTB"
        threat_id = "2147842511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {0b 16 0c 2b 13 07 08 9a 03 28 0b 00 00 06 0d 09 2c 02 09 2a 08 17 58 0c 08 07 8e 69 32 e7 14 2a}  //weight: 5, accuracy: High
        $x_5_2 = {28 12 00 00 06 0a 28 18 00 00 0a 06 6f 19 00 00 0a 28 1a 00 00 0a 28 01 00 00 2b 28 02 00 00 2b 0b de 03 26 de d9 07 2a}  //weight: 5, accuracy: High
        $x_1_3 = "get_myon" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_DAQ_2147842556_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.DAQ!MTB"
        threat_id = "2147842556"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {18 5b 0b 07 8d ?? 00 00 01 0c 16 0d 38 ?? 00 00 00 02 09 18 5a 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 13 04 08 09 11 04 d2 9c 09 17 58 0d 09 07 32 df}  //weight: 2, accuracy: Low
        $x_1_2 = "I see it" wide //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "GetBytes" ascii //weight: 1
        $x_1_5 = "tutorial.gya" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCD_2147842639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCD!MTB"
        threat_id = "2147842639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$cd2ea338-5960-4577-874e-d2eabd9cb0e4" ascii //weight: 10
        $x_1_2 = "FyodorDostoyevsky" wide //weight: 1
        $x_1_3 = "PlayerData.xml" wide //weight: 1
        $x_1_4 = "Engine.Properties.Resources.resources" ascii //weight: 1
        $x_1_5 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resource" ascii //weight: 1
        $x_1_6 = {57 9d a2 29 09 0b 00 00 00 00 00 00 00 00 00 00 02}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBU_2147842655_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBU!MTB"
        threat_id = "2147842655"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "iK/dVxZzPYBjBRmgSeYxh3FXnu58OIucT8Ww1F" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBBX_2147842657_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBBX!MTB"
        threat_id = "2147842657"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$11fceaac-aadd-44b9-807c-2b64573c393c" ascii //weight: 10
        $x_1_2 = "Steps Recorder" ascii //weight: 1
        $x_1_3 = "SnakesAndLadders.Properties.Resources.resources" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCB_2147842658_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCB!MTB"
        threat_id = "2147842658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {08 11 04 07 11 04 9a 1f 10 28 [0-6] 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13}  //weight: 10, accuracy: Low
        $x_10_2 = "Manning.Passenger" wide //weight: 10
        $x_1_3 = "GetObject" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
        $x_1_6 = "ToByte" ascii //weight: 1
        $x_1_7 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ANT_2147842664_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANT!MTB"
        threat_id = "2147842664"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 18 5b 8d 2c 00 00 01 0b 16 0c 2b 18 07 08 18 5b 03 08 18 6f 30 00 00 0a 1f 10 28 31 00 00 0a 9c 08 18 58 0c 08 06 32 e4}  //weight: 1, accuracy: High
        $x_1_2 = {20 c5 e1 01 00 28 ?? ?? ?? 0a 03 a5 34 00 00 01 18 33 02 de 05 de e9 26 de e6}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANK_2147842665_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANK!MTB"
        threat_id = "2147842665"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 04 11 0d 91 13 0e 07 17 58 11 09 5d 13 0f 08 07 02 08 07 91 11 0e 61 08 11 0f 91 59 28 34 00 00 06 28 4b 00 00 0a 9c 07 17 58 0b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANK_2147842665_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANK!MTB"
        threat_id = "2147842665"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0a 06 18 5b 8d 31 00 00 01 0b 16 0c 2b 18 07 08 18 5b 03 08 18 6f 32 00 00 0a 1f 10 28 33 00 00 0a 9c 08 18 58 0c 08 06 32 e4}  //weight: 1, accuracy: High
        $x_1_2 = {2b 0a 20 d6 02 92 02 28 1d 00 00 0a 03 2d f3 17 28 2d 00 00 0a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCG_2147842717_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCG!MTB"
        threat_id = "2147842717"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6fc70aba-12f1-4f82-9226-bc3451606b13" ascii //weight: 1
        $x_1_2 = "Pinterest_Board_Manager.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCG_2147842717_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCG!MTB"
        threat_id = "2147842717"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4DZ5AZ90@0@3@0@0@0@4@0@0@0ZFFZFF@0@" wide //weight: 1
        $x_1_2 = "0@0@2Z21@B@1@8@0@0Z54" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAH_2147842721_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAH!MTB"
        threat_id = "2147842721"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 0d 06 16 99 13 04 2b 5d 00 09 17 58 0d 11 04 23 00 00 00 00 00 00 59 40 5a 28 ?? ?? ?? 0a 69 13 05 11 04 06 07 1b 28 ?? ?? ?? 06 23 00 00 00 00 00 00 59 40 5a 28 ?? ?? ?? 0a 69 13 06 02 7b 01 00 00 04 28 ?? ?? ?? 0a 73 11 00 00 0a 11 05 11 06 1b 1b 73 12 00 00 0a 6f ?? ?? ?? 0a 00 00 11 04 08 58 13 04 11 04 06 1a 99 08 58 fe 03 16 fe 01 13 07 11 07 2d 91}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCH_2147842726_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCH!MTB"
        threat_id = "2147842726"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 05 08 11 05 9a 1f 10 28 ?? ?? ?? 0a 9c 00 11 05 17 58 13 05 11 05 08 8e 69 fe 04 13 06 11 06 2d dc}  //weight: 1, accuracy: Low
        $x_1_2 = {72 66 11 00 70 72 6a 11 00 70 6f ?? ?? ?? 0a 0b 07 72 6e 11 00 70 72 72 11 00 70}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCH_2147842726_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCH!MTB"
        threat_id = "2147842726"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 9a 13 08 09 11 08 1f 10 28 ?? ?? ?? 0a b4 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04 00 11 04 08 8e 69 fe 04 13 09}  //weight: 1, accuracy: Low
        $x_1_2 = {34 00 44 00 5a 00 35 00 41 00 5a 00 39 00 51 00 51 00 33 00 40 00 51 00 51 00 51 00 34 00 40 00 51 00 51 00 30 00 5a 00 46 00 46 00 5a 00 46 00 46 00 40 00 51 00 30 00 5a 00 42 00 38 00 40 00 51 00 51 00 51 00 51 00 51 00 51 00 30}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCH_2147842726_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCH!MTB"
        threat_id = "2147842726"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "7Xx7fFvVkf+5V68ryZJ9JVuWYztSniix" wide //weight: 1
        $x_1_2 = "TihC+2Wid1N5RhMO+UfCcRQ9htGZFjT" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GFQ_2147842758_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GFQ!MTB"
        threat_id = "2147842758"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 1f 24 9d 6f ?? ?? ?? 0a 0b 07 8e 69 8d 56 00 00 01 0c 16 13 04 2b 17 00 08 11 04 07 11 04 9a 1f 10 28 ?? ?? ?? 0a 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 05 11 05 2d dc}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAJ_2147842805_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAJ!MTB"
        threat_id = "2147842805"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0b 02 28 ?? 00 00 0a 73 ?? 00 00 0a 0c 08 07 16 73 ?? 00 00 0a 0d 00 02 6f ?? 00 00 0a 8d ?? 00 00 01 13 04 09 11 04 16 11 04 8e 69 6f ?? 00 00 0a 13 05 11 04 11 05 28 ?? 00 00 2b 28 ?? 00 00 2b 13 06 de 2c}  //weight: 2, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAK_2147842811_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAK!MTB"
        threat_id = "2147842811"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0c 16 13 04 2b 17 00 08 11 04 07 11 04 9a 1f 10 28 ?? 00 00 0a 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 05 11 05 2d dc}  //weight: 2, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "Customers_Simulation.Properties.Resources" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
        $x_1_5 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KK_2147842828_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KK!ibt"
        threat_id = "2147842828"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "ibt: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "16"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "4D+5A+9}" wide //weight: 2
        $x_2_2 = "21+54+68+69+73+2}+7}+72+6F+67+72+61+6D+2}+63+61+6E+6E+6F+74+2}+62+65+2}+72+75+6E+2}+69+6E+2}+44+4F+53+2}+6D+6F+64+65+2E" wide //weight: 2
        $x_2_3 = "43+61+72+64+47+61+6D+65+41+7}+7}+6C+69+63+61+74+69+6F+6E" wide //weight: 2
        $x_2_4 = "57+69+6E+46+6F+72+6D+2E+64+6C+6C" wide //weight: 2
        $x_10_5 = "System.Windows.Forms" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MBCJ_2147842864_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCJ!MTB"
        threat_id = "2147842864"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 05 08 11 05 91 07 11 05 07 8e 69 5d 91 61 d2 9c 00 11 05 17 58 13 05 11 05 08 8e 69 fe 04 13 06 11 06 2d d9}  //weight: 1, accuracy: High
        $x_1_2 = "bbca" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCJ_2147842864_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCJ!MTB"
        threat_id = "2147842864"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 80 01 00 8d ?? 00 00 01 0b 06 72 73 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 16 07 16 20 00 c0 00 00 28 ?? 00 00 0a 00 06 72 79 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 16 07 20 00 c0 00 00 20 00 c0 00 00 28 ?? 00 00 0a 00 d0 ?? 00 00 01 28 5a 00 00 0a 72 7f 02 00 70 20 00 01 00 00 14 14 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCJ_2147842864_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCJ!MTB"
        threat_id = "2147842864"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {18 da 13 06 16 13 07 2b 23 07 08 06 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 08 17 d6 0c 11 07 18 d6 13 07 11 07 11 06 31 d7}  //weight: 1, accuracy: Low
        $x_1_2 = {34 00 30 00 32 00 30 00 30 00 35 00 32 00 46 00 46 00 30 00 30 00 30 00 30 00 30 00 30 00 30 00 30 00 30 00 30 00 43 00 36 00 43 00 36 00 34 00 36 00 45 00 32 00 35 00 36 00 35 00 36 00 32 00 37 00 46 00 36 00 33 00 36 00 33 00 37 00 44}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAK_2147842865_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAK!MTB"
        threat_id = "2147842865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 17 0d 00 06 07 25 17 58 0b 08 9e 00 08 17 58 0c 00 07 03 fe 04 13 04 11 04 2d e4}  //weight: 2, accuracy: High
        $x_2_2 = "$59bd9ce0-5c2b-463e-98a9-420429d0c8c5" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCC_2147842888_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCC!MTB"
        threat_id = "2147842888"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 08 8c ?? 00 00 01 a2 14 28 ?? 01 00 0a 28 ?? 00 00 0a 0d 07 09 28 ?? 01 00 0a 1f 10 28 ?? 01 00 0a b4 6f ?? 01 00 0a 08 17 d6 0c 08 20 00 7c 00 00 32 c4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCK_2147842892_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCK!MTB"
        threat_id = "2147842892"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 c1 16 00 70 0b 16 13 05 2b 2b 00 07 06 72 f3 16 00 70 12 05 28 ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a 74 ?? 00 00 01 28 ?? 00 00 0a 0b 00 11 05 17 58 13 05 11 05 1f 34 fe 02 16 fe 01 13 06 11 06 2d c6}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCK_2147842892_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCK!MTB"
        threat_id = "2147842892"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {23 73 64 23 00 23 61 61 2e 64 6c 6c 23 00 23 67 61 61 2e 64 6c 6c 23 00 23 64 61}  //weight: 1, accuracy: High
        $x_1_2 = "#hdfsafaaaadadsadfffwtwfffffffgsssssdf.dll#" ascii //weight: 1
        $x_1_3 = "#dshsstadaaadwsssssg.dll#" ascii //weight: 1
        $x_1_4 = "fsassgdsadfassssssssssssssssssad" ascii //weight: 1
        $x_1_5 = "#aa.dll#" ascii //weight: 1
        $x_1_6 = "#fasdfgsfsd.dll#" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCL_2147842901_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCL!MTB"
        threat_id = "2147842901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {a2 11 09 17 7e ?? 00 00 0a a2 11 09 18 11 06 72 de 07 00 70 6f ?? 00 00 0a a2 11 09 13 0a 11 0a 13 0b 1f 1a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCL_2147842901_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCL!MTB"
        threat_id = "2147842901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 72 0f 01 00 70 6f ?? 00 00 0a 74 ?? 00 00 01 28 ?? 00 00 06 28 ?? 00 00 06 17 8d ?? 00 00 01 25 16 1f 3d 9d 6f ?? 00 00 0a 0b 20 00 2c 01 00 8d ?? 00 00 01 0c 16 13 04 2b 17 00 08 11 04 07 11 04 9a}  //weight: 1, accuracy: Low
        $x_1_2 = "3-55dd4bbcd269" ascii //weight: 1
        $x_1_3 = "Eg.Cp" wide //weight: 1
        $x_1_4 = "M0M0M0M0M0M0M0M0M0M0M0M0M0M0M" ascii //weight: 1
        $x_1_5 = "UmdParser.Pro" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAM_2147842945_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAM!MTB"
        threat_id = "2147842945"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 20 00 80 01 00 8d ?? 00 00 01 0b 06 72 d5 05 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 16 07 16 20 00 c0 00 00 28 ?? 00 00 0a 00 06 72 db 05 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 16 07 20 00 c0 00 00 20 00 c0 00 00 28 ?? 00 00 0a 00 07 28 ?? 00 00 0a 0c 08 6f ?? 00 00 0a 17 9a 7e ?? 00 00 04 0d 09 28}  //weight: 3, accuracy: Low
        $x_1_2 = "enemy.BackgroundImage" wide //weight: 1
        $x_1_3 = "GeneralProject.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAN_2147842962_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAN!MTB"
        threat_id = "2147842962"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {20 00 94 01 00 8d 5c 00 00 01 0b 06 72 29 06 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 16 07 16 20 00 ca 00 00 28 8c 00 00 0a 00 06 72 2f 06 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 16 07 20 00 ca 00 00 20 00 ca 00 00 28 ?? 00 00 0a 00 02 7b ?? 00 00 04 18 6f ?? 00 00 0a 00 02 7b ?? 00 00 04 72 ?? 06 00 70 22 00 00 40 41 16 19 20 88 00 00 00 73}  //weight: 3, accuracy: Low
        $x_1_2 = "Ready to Rock" wide //weight: 1
        $x_1_3 = "OStock_Simulation.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GFM_2147842966_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GFM!MTB"
        threat_id = "2147842966"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {25 16 1f 25 9d 6f ?? ?? ?? 0a 0b 07 8e 69 8d 2c 00 00 01 0c 16 0d 2b 11 08 09 07 09 9a 1f 10 28 ?? ?? ?? 0a 9c 09 17 58 0d 09 07 8e 69 32 e9}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABOL_2147842975_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABOL!MTB"
        threat_id = "2147842975"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {16 0b 02 8e 69 17 da 0c 2b 17 02 07 91 0d 02 07 02 08 91 9c 02 08 09 9c 07 17 d6 0b 08 17 da 0c 00 07 08 fe 04 13 04 11 04 2d df}  //weight: 5, accuracy: High
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "Metropolis_Launcher.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCI_2147843072_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCI!MTB"
        threat_id = "2147843072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 bb 03 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 0c 08 28 ?? 00 00 0a 07 08 6f ?? 00 00 0a 07 06 72 c7 03 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 6f ?? 00 00 0a 07 06 72 d3 03 00 70}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCI_2147843072_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCI!MTB"
        threat_id = "2147843072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {55 00 36 00 44 00 52 00 65 00 4d 00 72 00 6f 00 36 00 45 00 77 00 4a 00 65 00 61 00 55 00 6a 00 35 00 6a 00 41 00 39 00 6e 00 30 00 31 00 42 00 6d 00 5a 00 62 00 44 00 63 00 7a 00 6b 00 69 00 5a 00 43 00 6b 00 32 00 79}  //weight: 1, accuracy: High
        $x_1_2 = "Z59Z13@4Z2BZB0Z16@AZ18Z13@4Z2BZA9@3@4" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAP_2147843136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAP!MTB"
        threat_id = "2147843136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {1a 2c 42 00 2b 10 2b 15 2b 16 2b 1b 2b 1c 2b 21 2b 26 2b 2b de 2f 28 ?? 00 00 06 2b e9 0a 2b e8 28 ?? 00 00 0a 2b e3 06 2b e2 6f ?? 00 00 0a 2b dd 28 ?? 00 00 0a 2b d8 28 ?? 00 00 06 2b d3 0b 2b d2 26 de bb 2b 01 2a 07 2b fc}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAL_2147843168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAL!MTB"
        threat_id = "2147843168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 13 05 2b 1f 00 09 08 11 05 18 6f 7b 00 00 0a 1f 10 28 7c 00 00 0a 6f 7d 00 00 0a 00 00 11 05 18 58 13 05 11 05 08 6f 1c 00 00 0a fe 04 13 06 11 06 2d d1}  //weight: 2, accuracy: High
        $x_1_2 = "Sudoku.App" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAR_2147843180_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAR!MTB"
        threat_id = "2147843180"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2b 22 15 2d 14 26 16 2d f7 2b 20 2b 25 2b 26 2b 2b 2b 30 17 2d 07 26 de 3d 2b 2f 2b e9 2b 2e 16 2d f9 2b f3 28 ?? 00 00 06 2b d7 28 ?? 00 00 0a 2b d9 06 2b d8 6f ?? 00 00 0a 2b d3 28 ?? 00 00 0a 2b ce 28 ?? 00 00 06 2b c9 0a 2b ce 0b 2b cf 26 dd}  //weight: 3, accuracy: Low
        $x_2_2 = "WindowsFormsApp68.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPU_2147843315_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPU!MTB"
        threat_id = "2147843315"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "OStock_Simulation.Properties.Resources.resources" ascii //weight: 5
        $x_1_2 = "GetObject" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "OStock Simulation" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPV_2147843316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPV!MTB"
        threat_id = "2147843316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {57 00 32 00 50 00 69 00 7a 00 7a 00 61 00 4f 00 72 00 64 00 65 00 72 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73 00 00 4d 50 00 72 00 69 00 73 00 63 00 69 00 6c 00 6c 00 61 00 5f 00 54 00 61 00 79 00 6c 00 6f 00 72 00 5f 00 5f 00 36 00 36 00 5f 00 4e 00 75 00 64 00 65 00 5f 00 50 00 68 00 6f 00 74 00 6f 00 73 00 5f 00 5f 00 5f 00 32 00 32}  //weight: 3, accuracy: High
        $x_3_2 = {5f 00 00 4d 50 00 72 00 69 00 73 00 63 00 69 00 6c 00 6c 00 61 00 5f 00 54 00 61 00 79 00 6c 00 6f 00 72 00 5f 00 5f 00 36 00 36 00 5f 00 4e 00 75 00 64 00 65 00 5f 00 50 00 68 00 6f 00 74 00 6f 00 73 00 5f 00 5f 00 5f 00 32 00 38}  //weight: 3, accuracy: High
        $x_1_3 = "W2PizzaOrder" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXA_2147843330_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXA!MTB"
        threat_id = "2147843330"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 07 20 ad 04 b7 2e 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 74 ?? ?? ?? ?? 28 ?? ?? ?? ?? 17 8d ?? ?? ?? ?? 25 16 1f 3d 9d 6f ?? ?? ?? ?? 0c 20 ?? ?? ?? ?? 8d ?? ?? ?? ?? 0d 16 0a}  //weight: 5, accuracy: Low
        $x_5_2 = {09 06 08 06 9a 1f 10 28 ?? ?? ?? ?? 9c 06 17 58 0a 06 08 8e 69 fe 04 13 05 11 05 2d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SRP_2147843336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SRP!MTB"
        threat_id = "2147843336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0a 73 65 00 00 0a 0b 07 06 6f 66 00 00 0a 00 07 03 6f 67 00 00 0a 00 07 73 68 00 00 0a 0c 73 69 00 00 0a 0d 08 09 6f 6a 00 00 0a 26 09 13 04 2b 00 11 04 2a}  //weight: 1, accuracy: High
        $x_1_2 = "hXxe.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAO_2147843352_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAO!MTB"
        threat_id = "2147843352"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {20 00 01 00 00 14 14 17 8d 17 00 00 01 25 16 07 6f ?? 00 00 0a a2 28 ?? 00 00 0a 74 20 00 00 01 0c 08 6f ?? 00 00 0a 17 9a 6f ?? 00 00 0a 17 9a 0d 09 16 8c 59 00 00 01 7e ?? 00 00 04 13 04 11 04 6f ?? 00 00 0a 26 02 7b 33 00 00 04 72 43 06 00 70 6f}  //weight: 3, accuracy: Low
        $x_2_2 = "EightGame.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAQ_2147843353_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAQ!MTB"
        threat_id = "2147843353"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {1d 2d 1c 26 28 ?? 00 00 0a 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 1b 2d 06 26 de 09 0a 2b e2 0b 2b f8 26 de d2}  //weight: 3, accuracy: Low
        $x_2_2 = "WindowsFormsApp61.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAS_2147843433_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAS!MTB"
        threat_id = "2147843433"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 0b 06 72 ?? 02 00 70 6f ?? 00 00 0a 74 02 00 00 1b 0c 08 28 ?? 00 00 0a 00 07 08 6f ?? 00 00 0a 00 07 06 72 ?? 02 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 00 07 06 72 ?? 02 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 00 02 28 ?? 00 00 0a 00 28 ?? 00 00 0a 07 6f ?? 00 00 0a 6f ?? 00 00 0a 0d 09 6f ?? 00 00 0a 17 9a 7e ?? 00 00 04 13 04 11 04 28}  //weight: 3, accuracy: Low
        $x_2_2 = "Nude_Photos" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCN_2147843541_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCN!MTB"
        threat_id = "2147843541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 06 08 11 06 91 07 11 06 07 8e 69 5d 91 61 d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCN_2147843541_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCN!MTB"
        threat_id = "2147843541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D_5A_9PP3?PPP4?PP0_FF_FF?P0_B8?" wide //weight: 1
        $x_1_2 = "PPPPPPPPPP0_8PPPPE_1F_BA?E?0_B4" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAU_2147843584_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAU!MTB"
        threat_id = "2147843584"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 19 11 05 5a 6f ?? 00 00 0a 13 06 11 06 1f 39 fe 02 13 08 11 08 2c 0d 11 06 1f 41 59 1f 0a 58 d1 13 06 2b 08 11 06 1f 30 59 d1 13 06 07 19 11 05 5a 17 58 6f ?? 00 00 0a 13 07 11 07 1f 39 fe 02 13 09 11 09 2c 0d 11 07 1f 41 59 1f 0a 58 d1 13 07 2b 08 11 07 1f 30 59 d1 13 07 09 11 05 1f 10 11 06 5a 11 07 58 d2 9c 00 11 05 17 58 13 05 11 05 08 fe 04 13 0a 11 0a 2d 84}  //weight: 3, accuracy: Low
        $x_2_2 = "Marliece_Andrada" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAW_2147843689_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAW!MTB"
        threat_id = "2147843689"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0c 16 13 04 2b 17 00 08 11 04 07 11 04 9a 1f 10 28 ?? 00 00 0a 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 05 11 05 2d dc}  //weight: 2, accuracy: Low
        $x_2_2 = "LogicGames.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPF_2147843712_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPF!MTB"
        threat_id = "2147843712"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 13 06 09 11 06 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04 00 11 04 20 ?? ?? ?? 00 fe 04 13 07 11 07 2d b7 49 00 08 17 8d}  //weight: 6, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCO_2147843713_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCO!MTB"
        threat_id = "2147843713"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 08 02 8e 69 5d 02 08 02 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? 00 00 0a 02 08 1d 58 1c 59 02 8e 69 5d 91 59 20 fd 00 00 00 58 19 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJC_2147843733_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJC!MTB"
        threat_id = "2147843733"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 06 06 6f 3c 00 00 0a 06 6f 3d 00 00 0a 6f 3e 00 00 0a 0b 02 73 3f 00 00 0a 0c 08 07 16 73 40 00 00 0a 0d 00 02 8e 69 8d 24 00 00 01 13 04 09 11 04 16 11 04 8e 69 6f 41 00 00 0a 13 05 11 04 11 05 28 01 00 00 2b 28 02 00 00 2b 13 06 de 2c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJE_2147843734_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJE!MTB"
        threat_id = "2147843734"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 00 72 08 23 00 70 72 ec 22 00 70 28 ?? ?? ?? 06 72 0c 23 00 70 72 10 23 00 70 6f ?? ?? ?? 0a 72 16 23 00 70 72 1a 23 00 70 6f ?? ?? ?? 0a 13 00 38 76 fd ff ff 00 02}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJF_2147843735_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJF!MTB"
        threat_id = "2147843735"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 03 6f 89 00 00 0a 0a 02 73 ?? ?? ?? 0a 0b 07 06 16 73 ?? ?? ?? 0a 0c 00 02 8e 69 8d 4b 00 00 01 0d 08 09 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJJ_2147843737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJJ!MTB"
        threat_id = "2147843737"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 72 df 04 00 70 6f ?? ?? ?? 0a 74 ?? ?? ?? 1b 0c 08 8e 69 8d 7f 00 00 01 0d 16 13 05 2b 18 09 11 05 08 11 05 91 07 11 05 07 8e 69 5d 91 61 d2 9c 11 05 17 58 13 05 11 05 08 8e 69 32 e1}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAT_2147843773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAT!MTB"
        threat_id = "2147843773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1c 2d 16 26 2b 3d 16 2b 3d 8e 69 15 2d 0e 26 26 26 2b 36 2b 0e 2b 35 2b da 0b 2b e8 28 ?? ?? ?? 0a 2b ee 2a 28 ?? ?? ?? 06 2b c4 28 ?? ?? ?? 0a 2b c3 06 2b c2 6f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMJ_2147843778_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMJ!MTB"
        threat_id = "2147843778"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 05 91 11 04 11 05 91 3b 02 00 00 00 16 2a 11 05 17 58 13 05 11 05 09 8e 69 32 e3}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMJ_2147843778_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMJ!MTB"
        threat_id = "2147843778"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {16 0a 38 fc 00 00 00 16 0b 38 e5 00 00 00 06 18 5d 2c 0a 02 06 07 6f 3b 00 00 0a 2b 08 02 06 07 6f 3b 00 00 0a 0c 04 03 6f 3c 00 00 0a 59 0d 12 02 28 3d 00 00 0a 13 04 12 02 28 3e 00 00 0a 13 05 12 02 28 3f 00 00 0a 13 06 19}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCT_2147843814_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCT!MTB"
        threat_id = "2147843814"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0d 00 08 09 28 ?? 00 00 0a 02 28 ?? 00 00 06 6f [0-16] 6f 46 00 00 0a 00 08 18 6f ?? 00 00 0a 00 08 6f ?? 00 00 0a 13 04 07 13 05 11 04 11 05 16 11 05 8e 69 6f 49 00 00 0a 0a de 11}  //weight: 1, accuracy: Low
        $x_1_2 = "ClsEncryptDecryptFiles" ascii //weight: 1
        $x_1_3 = "7ab36d7b2613" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCT_2147843814_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCT!MTB"
        threat_id = "2147843814"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dd}  //weight: 1, accuracy: Low
        $x_1_2 = "4D5A9YYYY3YYYYYYY4YYYYYYFFFFYYYYB8YYYYYYYY" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JV_2147843842_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JV!MTB"
        threat_id = "2147843842"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 01 11 03 1f 10 28 ?? 01 00 0a b4 6f}  //weight: 2, accuracy: Low
        $x_2_2 = {70 15 16 28 ?? 01 00 0a 13 04}  //weight: 2, accuracy: Low
        $x_2_3 = "Invoke" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAG_2147843855_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAG!MTB"
        threat_id = "2147843855"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 02 2a 00 28 ?? 00 00 06 13 00 38 ?? 00 00 00 02 11 01 28 ?? 00 00 06 13 02 38 ?? 00 00 00 28 ?? 00 00 0a 11 00 6f ?? 00 00 0a 28 ?? 00 00 0a 13 01 38}  //weight: 3, accuracy: Low
        $x_1_2 = "GetString" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAT_2147843857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAT!MTB"
        threat_id = "2147843857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0b 06 16 73 ?? 00 00 0a 73 ?? 00 00 0a 0c 08 07 6f ?? 00 00 0a 07 6f ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0d de 1e 08 2c 06 08 6f ?? 00 00 0a dc 07 2c 06 07 6f ?? 00 00 0a dc 06 2c 06 06 6f ?? 00 00 0a dc 09 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAQ_2147843933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAQ!MTB"
        threat_id = "2147843933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "3f6c3564-1795-4584-8a48-b720cb30ea8a" ascii //weight: 5
        $x_2_2 = "HGgGGg7.exe" ascii //weight: 2
        $x_1_3 = "Confuser.Core 1.6" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCS_2147843960_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCS!MTB"
        threat_id = "2147843960"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 19 00 03 07 08 6f ?? 00 00 0a 0d 06 07 12 03 28 ?? 00 00 0a 9c 00 08 17 58 0c 08 03 6f ?? 00 00 0a fe 04 13 04 11 04 2d d8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAR_2147844055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAR!MTB"
        threat_id = "2147844055"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {28 13 00 00 06 0a 28 04 00 00 0a 06 6f 05 00 00 0a 28 06 00 00 0a 28 05 00 00 06 0b dd 06 00 00 00 26}  //weight: 10, accuracy: High
        $x_1_2 = "DebuggerHiddenAttribute" ascii //weight: 1
        $x_1_3 = "WindowsFormsApp" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAS_2147844056_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAS!MTB"
        threat_id = "2147844056"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "18"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "Golden's Distributors 2021" ascii //weight: 5
        $x_5_2 = "get__151_705_033_102" ascii //weight: 5
        $x_2_3 = "numeroDeClient" ascii //weight: 2
        $x_2_4 = "SauvegarderFichier" ascii //weight: 2
        $x_2_5 = "SGA.Form1.resources" ascii //weight: 2
        $x_2_6 = "UQG.d" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAV_2147844075_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAV!MTB"
        threat_id = "2147844075"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TanksGame_V4" wide //weight: 1
        $x_1_2 = "Scraper.White" wide //weight: 1
        $x_1_3 = "Ytgh.exe" wide //weight: 1
        $x_1_4 = "SetPixel" ascii //weight: 1
        $x_1_5 = "ToSByte" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSKE_2147844080_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSKE!MTB"
        threat_id = "2147844080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 0c 2b 17 03 07 08 6f 29 00 00 0a 0d 06 07 12 03 28 2a 00 00 0a 9c 08 17 58 0c 08 03 6f 2b 00 00 0a 32 e0}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAY_2147844125_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAY!MTB"
        threat_id = "2147844125"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 04 11 08 07 11 08 91 09 61 08 11 05 91 61 28 ?? 00 00 0a 9c 11 05 1f 15 33 05 16 13 05 2b 06 11 05 17 58 13 05 11 08 17 58 13 08 11 08 07 8e 69 17 59 31 cb 12 04 07 8e 69 17 59 28 04 00 00 2b d0 53 00 00 01 28}  //weight: 2, accuracy: Low
        $x_2_2 = "Silleal.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAZ_2147844130_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAZ!MTB"
        threat_id = "2147844130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 0b 06 6f ?? 00 00 0a 18 da 0c 16 0d 2b 19 07 06 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 09 18 d6 0d 09 08 31 e3}  //weight: 3, accuracy: Low
        $x_2_2 = "151_691_033_062" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAT_2147844171_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAT!MTB"
        threat_id = "2147844171"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 28 19 00 00 06 28 06 00 00 06 74 02 00 00 01 28 05 00 00 06 74 01 00 00 1b 28 03 00 00 06 0a dd 03 00 00 00 26 de d8 06 2a}  //weight: 10, accuracy: High
        $x_5_2 = {02 25 16 02 8e 69 28 02 00 00 0a 2a}  //weight: 5, accuracy: High
        $x_2_3 = "AForge.Video" ascii //weight: 2
        $x_2_4 = "WindowsFormsApp" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMZ_2147844201_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMZ!MTB"
        threat_id = "2147844201"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {07 11 05 06 11 05 9a 1f 10 28 ?? ?? ?? 0a d2 9c 00 11 05 17 58 13 05 11 05 06 8e 69 fe 04 13 06 11 06 2d db}  //weight: 6, accuracy: Low
        $x_1_2 = "Nth.Eindhoven.Fontys.ze" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABNE_2147844203_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABNE!MTB"
        threat_id = "2147844203"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 19 11 06 5a 6f ?? ?? ?? 0a 13 07 11 07 1f 39 fe 02 13 09 11 09 2c 0d 11 07 1f 41 59 1f 0a 58 d1 13 07 2b 08 11 07 1f 30 59 d1 13 07 06 19 11 06 5a 17 58 6f ?? ?? ?? 0a 13 08 11 08 1f 39 fe 02 13 0a 11 0a 2c 0d 11 08 1f 41 59 1f 0a 58 d1 13 08 2b 08 11 08 1f 30 59 d1 13 08 08 11 06 1f 10 11 07 5a 11 08 58 d2 9c 00 11 06 17 58 13 06 11 06 07 fe 04 13 0b 11 0b 2d 84}  //weight: 5, accuracy: Low
        $x_1_2 = "Blackjack_threading.ResourceCS" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABNF_2147844204_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABNF!MTB"
        threat_id = "2147844204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "GamesTest.ResourceInventory.resources" ascii //weight: 2
        $x_2_2 = "get_DASJHDBJKADHBKJD" ascii //weight: 2
        $x_2_3 = "get_HJSABJDGJSAHDGASJHDGAJHSGD" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABNH_2147844205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABNH!MTB"
        threat_id = "2147844205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {01 0b 07 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 08 6f ?? ?? ?? 0a 09 6f ?? ?? ?? 0a 00 09 6f ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "Recontech.Net" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAB_2147844235_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAB!MTB"
        threat_id = "2147844235"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0b 07 06 72 ?? 08 00 70 6f ?? 00 00 0a 74 1c 00 00 1b 6f ?? 00 00 0a 00 06 72 ?? 08 00 70 6f ?? 00 00 0a 74 1c 00 00 1b 0c 06 72 ?? 08 00 70 6f ?? 00 00 0a 74 1c 00 00 1b 0d 08 28 ?? 00 00 0a 00 09 28 ?? 00 00 0a 00 07 08 6f ?? 00 00 0a 00 07 09 6f ?? 00 00 0a 00 07 06 72 ?? 08 00 70 6f}  //weight: 3, accuracy: Low
        $x_2_2 = "GameOfLifeUI.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAC_2147844314_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAC!MTB"
        threat_id = "2147844314"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 00 06 7e ?? 00 00 04 28 ?? 00 00 0a 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 0b 00 73 ?? 00 00 06 25 03 6f ?? 00 00 06 00 25 07 6f ?? 00 00 06 00 0c 02 7b ?? 00 00 04 25 2d 03 26 2b 08 02 08 6f ?? 00 00 0a 00 08 6f ?? 00 00 06 0d de 16}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAD_2147844338_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAD!MTB"
        threat_id = "2147844338"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 0b 07 06 72 ?? 06 00 70 6f ?? 00 00 0a 74 04 00 00 1b 6f ?? 00 00 0a 00 06 72 ?? 06 00 70 6f ?? 00 00 0a 74 04 00 00 1b 0c 06 72 ?? 06 00 70 6f ?? 00 00 0a 74 04 00 00 1b 0d 08 28 ?? 00 00 0a 00 09 28 ?? 00 00 0a 00 07 08 6f ?? 00 00 0a 00 07 09 6f ?? 00 00 0a 00 07 06 72 ?? 06 00 70 6f}  //weight: 3, accuracy: Low
        $x_2_2 = "CoreCLI.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSHL_2147844434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSHL!MTB"
        threat_id = "2147844434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 03 00 00 0a 28 12 00 00 06 6f 04 00 00 0a 0a 06 6f 05 00 00 0a 0b 07 18 5b 8d 05 00 00 01 0c 16 0d 2b 18 08 09 18 5b 06 09 18 6f 06 00 00 0a 1f 10 28 07 00 00 0a 9c 09 18 58 0d 09 07 32 e4}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAA_2147844443_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAA!MTB"
        threat_id = "2147844443"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2d 35 2b 1c 06 08 2b 09 06 18 6f ?? 00 00 0a 2b 07 6f ?? 00 00 0a 2b f0 28 ?? 00 00 06 0d 2b 03 26 2b e1 06 6f ?? 00 00 0a 09 16 09 8e 69 6f ?? 00 00 0a 13 04 de 11 0c 2b ca}  //weight: 3, accuracy: Low
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPJ_2147844450_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPJ!MTB"
        threat_id = "2147844450"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 07 11 07 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAE_2147844492_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAE!MTB"
        threat_id = "2147844492"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0d 16 0a 2b 11 09 06 07 06 9a 1f 10 28 ?? 00 00 0a 9c 06 17 58 0a 06 07 8e 69 fe 04 13 06 11 06 2d e3}  //weight: 3, accuracy: Low
        $x_2_2 = "radarsystem.Properties.Resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJR_2147844533_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJR!MTB"
        threat_id = "2147844533"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 79 00 00 70 28 14 00 00 06 0b 28 ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 72 e3 00 00 70 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c de 0d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AGA_2147844637_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AGA!MTB"
        threat_id = "2147844637"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0b 07 8e 69 8d ?? ?? ?? 01 0d 16 0a 2b 11 09 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 9c 06 17 58 0a 06 07 8e 69 fe 04 13 05 11 05 2d e3}  //weight: 2, accuracy: Low
        $x_1_2 = "STKSIMUL" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANA_2147844653_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANA!MTB"
        threat_id = "2147844653"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 fe 01 13 08 11 08 2c 6f 00 16 13 09 16 13 0a 2b 32 00 09 7b 03 00 00 04 11 0a 6f ?? ?? ?? 0a 7b 1c 00 00 04 11 07 7b 1c 00 00 04 28 ?? ?? ?? 0a 13 0b 11 0b 2c 06 00 11 0a 13 09 00 00 11 0a 17 58 13 0a 11 0a 09 7b 03 00 00 04 6f ?? ?? ?? 0a fe 04 13 0c 11 0c 2d b9}  //weight: 2, accuracy: Low
        $x_1_2 = "ahp_metoda_projekt" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XMX_2147844694_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XMX!MTB"
        threat_id = "2147844694"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 07 0c 08 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 72 ?? ?? ?? 70 6f ?? ?? ?? 0a 0c 73 ?? ?? ?? 0a 0d 16 13 07 2b 1c 09 08 11 07 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 11 07 18 58 13 07 11 07 08 6f ?? ?? ?? 0a 32 da}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMO_2147844699_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMO!MTB"
        threat_id = "2147844699"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 11 07 09 11 07 9a 1f 10 28 ?? 00 00 0a 9c 00 11 07 17 58 13 07 11 07 09 8e 69 fe 04 13 08 11 08 2d db}  //weight: 5, accuracy: Low
        $x_1_2 = "Simulateur_des.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMP_2147844700_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMP!MTB"
        threat_id = "2147844700"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 07 09 07 9a 1f 10 28 ?? 00 00 0a 9c 07 17 58 0b 07 09 8e 69 fe 04 13 07 11 07 2d e2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPX_2147844701_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPX!MTB"
        threat_id = "2147844701"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0a 0b 02 8e 69 17 da 0c 16 0d 2b 37 09 1c 5d 16 fe 01 13 04 11 04 2c 16 07 02 09 9a 28 ?? ?? ?? 0a 1c 6a 61 b4 6f ?? ?? ?? 0a 00 00 2b 11 00 07 02 09 9a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 09 17 d6 0d 09 08 31 c5 07 6f ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "Reverse" ascii //weight: 1
        $x_1_3 = "Metropolis_Launcher.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABRP_2147844702_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABRP!MTB"
        threat_id = "2147844702"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {03 18 fe 01 13 08 11 08 2c 31 02 8e 69 17 da 13 09 16 13 0a 2b 1b 02 11 0a 91 16 fe 01 13 0b 11 0b 2c 07 02 11 0a 1f 41 9c 00 00 11 0a 17 d6 13 0a 11 0a 11 09 31 df}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSHD_2147844707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSHD!MTB"
        threat_id = "2147844707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 53 00 00 06 0a 28 37 00 00 06 0b 07 1f 20 8d 1e 00 00 01 25 d0 c7 00 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 1f 10 8d 1e 00 00 01 25 d0 ca 00 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 25 02}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJK_2147844708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJK!MTB"
        threat_id = "2147844708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 06 72 01 00 00 70 6f ?? ?? ?? 0a 06 28 ?? ?? ?? 0a 72 09 00 00 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 6f ?? ?? ?? 0a 06 28 12 00 00 0a 26 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSJN_2147844709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSJN!MTB"
        threat_id = "2147844709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {08 20 cc 48 3c f9 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 74 ?? ?? ?? 1b 0b 07 8e 69 8d 0b 00 00 01 13 04 16 0a 2b 14 11 04 06 07 06 91 09 06 09 8e 69 5d 91 61 d2 9c 06 17 58 0a 06 07 8e 69 32 e6}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAF_2147844745_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAF!MTB"
        threat_id = "2147844745"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0b 07 06 72 ?? 01 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 00 07 06 72 ?? 01 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 00 07 06 72 ?? 01 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 00 02 28 ?? 00 00 0a 02 7b ?? 00 00 04 6f ?? 00 00 0a 00 02 28 ?? 00 00 0a 02 7b ?? 00 00 04 6f}  //weight: 3, accuracy: Low
        $x_2_2 = "_16matikkapeli.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSES_2147844774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSES!MTB"
        threat_id = "2147844774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 7e 05 00 00 04 28 ?? ?? ?? 0a 02 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 2, accuracy: Low
        $x_2_2 = {00 7e 04 00 00 04 6f ?? ?? ?? 0a 02 16 02 8e 69 6f ?? ?? ?? 0a 0a 2b 00 06 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAG_2147844829_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAG!MTB"
        threat_id = "2147844829"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 01 11 00 11 04 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 20 ?? 00 00 00 28 ?? 00 00 06 3a ?? ?? ff ff 26 20 16 00 00 00 38 ?? ?? ff ff 02 6f ?? 00 00 06 28 ?? 01 00 06 02 6f ?? 00 00 06 6f ?? 00 00 0a 38 ?? 13 00 00 02 6f ?? 00 00 06 72}  //weight: 3, accuracy: Low
        $x_2_2 = "Stella_Daupine__50_Nude_Photos" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSKK_2147844906_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSKK!MTB"
        threat_id = "2147844906"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 09 00 00 06 28 01 00 00 2b 28 02 00 00 2b 0a de 03 26 de ea}  //weight: 2, accuracy: High
        $x_1_2 = "Wwetwnaewliywfnndmzze" wide //weight: 1
        $x_1_3 = "Hnztpylpyvhigfiogmc" wide //weight: 1
        $x_1_4 = "lld.cmgoifgihvyplyptznH" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAI_2147844948_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAI!MTB"
        threat_id = "2147844948"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 0b 2b 19 08 06 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 07 18 58 0b 07 06 6f ?? 00 00 0a 32 de}  //weight: 3, accuracy: Low
        $x_2_2 = "waterwheel1.Properties.Resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDQ_2147844959_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDQ!MTB"
        threat_id = "2147844959"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {04 8e 69 5d 04 08 04 8e 69 5d 91 07 08 07 8e 69 5d 91 61}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPQE_2147845029_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPQE!MTB"
        threat_id = "2147845029"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {20 00 01 00 00 0d 06 17 58 13 09 06 20 00 0e 01 00 5d 13 04 11 09 20 00 0e 01 00 5d 13 0a 07 11 0a 91 09 58 13 0b 07 11 04 91 13 0c 11 06 06 1f 16 5d 91 13 0d 11 0c 11 0d 61 13 0e 11 0e 11 0b 59 13 0f 07 11 04 11 0f 09 5d d2 9c 06 17 58 0a}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABNU_2147845034_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABNU!MTB"
        threat_id = "2147845034"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 08 11 08 2d df}  //weight: 5, accuracy: Low
        $x_1_2 = "RangerUp.DJJDS.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDH_2147845045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDH!MTB"
        threat_id = "2147845045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3ea95cb7-0df4-4eb6-af1d-84c3ed39814e" ascii //weight: 1
        $x_1_2 = "PuzzleGame.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDH_2147845045_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDH!MTB"
        threat_id = "2147845045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 19 00 07 06 08 8f ?? 00 00 01 28 ?? 00 00 0a 28 ?? 00 00 0a 0b 00 08 17 59 0c 08 15 fe 02 0d 09 2d df}  //weight: 1, accuracy: Low
        $x_1_2 = "6aeb8bc2-3e26-4bc8-b609-c038d64ffa9f" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDI_2147845046_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDI!MTB"
        threat_id = "2147845046"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D5A9^^^^3^^^^^^^4^^^^^^QQQQ^^^^B8^^" wide //weight: 1
        $x_1_2 = "^E1QBA^E^^B4^9CD21B8^1" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMT_2147845132_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMT!MTB"
        threat_id = "2147845132"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0b de 03 26 de d4 2b 00 28 ?? ?? ?? 06 0a 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0b de 03 26 de d4}  //weight: 5, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMU_2147845133_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMU!MTB"
        threat_id = "2147845133"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 06 11 0a 11 05 11 0a 9a 1f 10 28 ?? ?? ?? 0a 9c 00 11 0a 17 58 13 0a 11 0a 11 05 8e 69 fe 04 13 0b 11 0b 2d d9}  //weight: 5, accuracy: Low
        $x_1_2 = "PriceAndGraph.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAK_2147845171_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAK!MTB"
        threat_id = "2147845171"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {da 13 08 16 13 09 2b 1f 11 04 09 11 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 09 18 d6 13 09 11 09 11 08 31 db}  //weight: 3, accuracy: Low
        $x_2_2 = "LUG_PIMI_gonzalo_guerra.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAH_2147845236_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAH!MTB"
        threat_id = "2147845236"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {1a 2d 48 26 08 16 07 16 1f 10 16 2c 41 26 26 26 26 26 08 16 07 1f 0f 1f 10 1a 2d 39 26 26 26 26 26 06 07 1a 2d 36 26 26 06 18 6f ?? 00 00 0a 06 6f ?? 00 00 0a 0d 09 03 16 03 8e 69 6f ?? 00 00 0a 13 04 de 2c 0a 2b 98 0b 2b a0 0c 2b b6 28 ?? 00 00 0a 2b bd 28 ?? 00 00 0a 2b c5 6f ?? 00 00 0a 2b c5 06 07 08 09 02 03 04 28}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JU_2147845238_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JU!MTB"
        threat_id = "2147845238"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {09 08 11 05 18 6f ?? 00 00 0a 1f 10 28}  //weight: 2, accuracy: Low
        $x_2_2 = {11 05 18 58 13 05 11 05 08 6f}  //weight: 2, accuracy: High
        $x_1_3 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAM_2147845252_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAM!MTB"
        threat_id = "2147845252"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 13 04 2b 1c 08 07 11 04 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 11 04 18 58 13 04 11 04 07 6f ?? 00 00 0a 32 da}  //weight: 3, accuracy: Low
        $x_2_2 = "SudokuUI.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MZL_2147845281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MZL!MTB"
        threat_id = "2147845281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {38 90 02 00 00 38 95 02 00 00 38 96 02 00 00 28 d5 00 00 0a 0d 72 2f 00 00 70 17 8d 81 00 00 01 25 16 1f 2c 9d 28 d6 00 00 0a 13 04 7e d7 00 00 0a 13 05 16 13 06 16 13 07 06 16 54 2b 1e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MZO_2147845301_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MZO!MTB"
        threat_id = "2147845301"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 73 2f 00 00 0a 28 30 00 00 0a 74 23 00 00 01 0b 08 16 8c 24 00 00 01 07 6f 31 00 00 0a 17 da 8c 24 00 00 01 17 8c 24 00 00 01 12 03 12 02 28 32 00 00 0a 39 27 00 00 00 06 07 08 28 33 00 00 0a 16 6f 34 00 00 0a 13 04 12 04 28 35 00 00 0a 6f 36 00 00 0a 08 09 12 02 28 37 00 00 0a 2d d9}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAN_2147845315_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAN!MTB"
        threat_id = "2147845315"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 16 0d 2b 23 00 07 09 18 6f ?? 00 00 0a 20 ?? 02 00 00 28 ?? 00 00 0a 13 05 08 11 05 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d ce}  //weight: 3, accuracy: Low
        $x_2_2 = "MySudokuGame.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JT_2147845317_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JT!MTB"
        threat_id = "2147845317"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 04 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 06}  //weight: 2, accuracy: Low
        $x_2_2 = {70 20 00 01 00 00 14 14 17 8d ?? 00 00 01 25 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDR_2147845427_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDR!MTB"
        threat_id = "2147845427"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {ff 11 08 72 ?? 0d 00 70 72 ?? 01 00 70 6f ?? 00 00 0a 72 ?? 0d 00 70 72 ?? 0d 00 70 6f ?? 00 00 0a 13 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDK_2147845448_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDK!MTB"
        threat_id = "2147845448"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "jfvmfeXQaNNWJ1QSXg0MUeUsDcpzKVNRGSfz3J" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDS_2147845499_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDS!MTB"
        threat_id = "2147845499"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D5A9}}}}3}}}}}}}4}}}}}}QQQQ}}}}B8}}}}" wide //weight: 1
        $x_1_2 = "}}5}45}}}}4C}1}3}}C28D}A64}}}" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAJ_2147845507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAJ!MTB"
        threat_id = "2147845507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {13 04 11 04 28 ?? 00 00 0a 25 11 04 6f ?? 00 00 0a 25 09 72 ?? 01 00 70 6f ?? 00 00 0a 74 0d 00 00 1b 6f ?? 00 00 0a 25 09 72 ?? 01 00 70 6f ?? 00 00 0a 74 0d 00 00 1b 6f}  //weight: 3, accuracy: Low
        $x_2_2 = "Quantum.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAL_2147845508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAL!MTB"
        threat_id = "2147845508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 09 08 16 73 ?? 00 00 0a 13 04 00 02 8e 69 8d ?? 00 00 01 13 05 11 04 11 05 16 11 05 8e 69 6f ?? 00 00 0a 13 06 11 05 11 06 28 ?? 00 00 2b 28 ?? 00 00 2b 13 07 de 2e 11 04 2c 08 11 04 6f ?? 00 00 0a 00 dc}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAO_2147845540_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAO!MTB"
        threat_id = "2147845540"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {18 da 13 06 16 13 07 2b 1e 08 07 11 07 18 6f ?? 01 00 0a 1f 10 28 ?? 01 00 0a b4 6f ?? 01 00 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 3, accuracy: Low
        $x_2_2 = "Priscilla_Taylor" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABRR_2147845552_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABRR!MTB"
        threat_id = "2147845552"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {04 08 04 8e 69 5d 04 08 04 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 04 08 1e 58 1d 59 04 8e 69 5d 91 59 20 ?? ?? ?? 00 58 18 58 20 ?? ?? ?? 00 5d d2 9c 08 16 2d 02}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JS_2147845579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JS!MTB"
        threat_id = "2147845579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 04 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 07}  //weight: 2, accuracy: Low
        $x_2_2 = {13 05 11 05 6f ?? 00 00 0a 16 9a 72}  //weight: 2, accuracy: Low
        $x_1_3 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JR_2147845585_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JR!MTB"
        threat_id = "2147845585"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 08 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 07 09 11 07 8c ?? 00 00 01 6f 63 00 00 0a 26 08 18 58 0c 08 07 6f}  //weight: 2, accuracy: Low
        $x_2_2 = {00 00 0a 13 05 11 05 6f ?? 00 00 0a 16 9a}  //weight: 2, accuracy: Low
        $x_1_3 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NYU_2147845586_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NYU!MTB"
        threat_id = "2147845586"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {25 16 16 8c 03 00 00 01 a2 25 17 19 8d ?? ?? ?? 01 25 16 28 ?? ?? ?? 06 16 9a a2 25 17}  //weight: 5, accuracy: Low
        $x_1_2 = "Pirates.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAP_2147845594_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAP!MTB"
        threat_id = "2147845594"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {18 da 13 06 16 13 07 2b 1e 08 07 11 07 18 6f ?? 01 00 0a 1f 10 28 ?? 01 00 0a b4 6f ?? 01 00 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDU_2147845595_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDU!MTB"
        threat_id = "2147845595"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Syste@m.Refl@ection.As@sembly" wide //weight: 1
        $x_1_2 = "Lo@ad" wide //weight: 1
        $x_1_3 = "Ge@tExp@ortedTy@pes" wide //weight: 1
        $x_1_4 = "Sys@tem.Del@egate" wide //weight: 1
        $x_1_5 = "Dyn@am@icInv@oke" wide //weight: 1
        $x_1_6 = "Cr@eateDe@lega@te" wide //weight: 1
        $x_1_7 = "Dvybwqza" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDV_2147845613_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDV!MTB"
        threat_id = "2147845613"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 15 16 13 16 2b 28 00 11 14 11 16 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 18 11 15 11 18 6f ?? 00 00 0a 00 11 16 18 58 13 16 00 11 16 11 14 6f ?? 00 00 0a fe 04 13 19 11 19 2d c7}  //weight: 1, accuracy: Low
        $x_1_2 = "5A90000300000004000000FFFF000" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSG_2147845622_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSG!MTB"
        threat_id = "2147845622"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 14 11 16 18 6f ?? ?? ?? 0a 20 03 02 00 00 28 ?? ?? ?? 0a 13 18 11 15 11 18 6f ?? ?? ?? 0a 00 11 16 18 58 13 16 00 11 16 11 14 6f ?? ?? ?? 0a fe 04 13 19 11 19 2d c7}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GHS_2147845647_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GHS!MTB"
        threat_id = "2147845647"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 13 11 15 18 6f ?? ?? ?? 0a 20 03 02 00 00 28 ?? ?? ?? 0a 13 17 11 14 11 17 6f ?? ?? ?? 0a 00 11 15 18 58 13 15 00 11 15 11 13 6f ?? ?? ?? 0a fe 04 13 18 11 18 2d c7}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPAF_2147845658_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPAF!MTB"
        threat_id = "2147845658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "KiemTraTapTin" ascii //weight: 1
        $x_1_2 = "DemSoLuongTapTin" ascii //weight: 1
        $x_1_3 = "CheckgameAll" ascii //weight: 1
        $x_1_4 = "RunGameBak" ascii //weight: 1
        $x_1_5 = "TuyChonPic" wide //weight: 1
        $x_1_6 = "ThuLaiPic" wide //weight: 1
        $x_1_7 = "ThuNhoPic" wide //weight: 1
        $x_1_8 = "DangNhapPic" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPJG_2147845659_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPJG!MTB"
        threat_id = "2147845659"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 72 71 06 00 70 72 b1 00 00 70 6f ?? ?? ?? 0a 0b 73 ?? ?? ?? 0a 0c 16 0d 2b 23 00 07 09 18 6f 80 00 00 0a 20 03 02 00 00 28 81 00 00 0a 13 05 08 11 05 6f 82 00 00 0a 00 09 18 58 0d 00 09 07 6f 83 00 00 0a fe 04 13 06 11 06 2d ce}  //weight: 3, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDW_2147845669_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDW!MTB"
        threat_id = "2147845669"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MA8761181A8C1C8B26AC6C562}7D848" wide //weight: 1
        $x_1_2 = "E4117A3D}1D}48347AM4}677B96A9B4A6CCA" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDQ_2147845678_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDQ!MTB"
        threat_id = "2147845678"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D5A9::::3:::::::4::::::QQQQ::::B8" wide //weight: 1
        $x_1_2 = "E1QBA:E::B4:9CD21B8:14CCD21546" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CBTD_2147845686_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CBTD!MTB"
        threat_id = "2147845686"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 04 18 6f ?? ?? ?? ?? 20 ?? ?? ?? ?? 28 ?? ?? ?? ?? 13 06 09 11 06 6f ?? ?? ?? ?? 00 11 04 18 58 13 04 00 11 04 08 6f ?? ?? ?? ?? fe 04 13 07 11 07 2d ca}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDX_2147845688_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDX!MTB"
        threat_id = "2147845688"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sy@stem.Refl@ection.Asse@mbly" wide //weight: 1
        $x_1_2 = "Dyn@am@icInv@oke" wide //weight: 1
        $x_1_3 = "Ge@tExp@ortedTy@pes" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDX_2147845688_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDX!MTB"
        threat_id = "2147845688"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 20 2b 28 00 11 1e 11 20 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 22 11 1f 11 22 6f ?? 00 00 0a 00 11 20 18 58 13 20 00 11 20 11 1e 6f ?? 00 00 0a fe 04 13 23 11 23 2d c7}  //weight: 1, accuracy: Low
        $x_1_2 = "A90000300000004000000FFFF0000B80000000000000040" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDU_2147845696_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDU!MTB"
        threat_id = "2147845696"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "eb39c518-ccdf-4ad3-90d2-0faeed78d704" ascii //weight: 1
        $x_1_2 = "LKMPO7" ascii //weight: 1
        $x_1_3 = "aR3nbf8dQp2feLmk31" ascii //weight: 1
        $x_1_4 = "lSfgApatkdxsVcGcrktoFd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAQ_2147845751_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAQ!MTB"
        threat_id = "2147845751"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {16 2c 21 26 28 ?? 00 00 0a 06 6f ?? 00 00 0a 28 ?? 01 00 06 74 ?? 00 00 1b 28 ?? 01 00 06 17 2d 06 26 de 09 0a 2b dd 0b 2b f8 26 de c8}  //weight: 3, accuracy: Low
        $x_2_2 = "spb-gan.ru/panel/uploads/Decju.bmp" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAR_2147845753_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAR!MTB"
        threat_id = "2147845753"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 13 00 38 00 00 00 00 28 ?? 00 00 0a 11 00 6f ?? 00 00 0a 28 ?? 00 00 06 28 ?? 00 00 06 13 01 38 00 00 00 00 dd ?? 00 00 00 26 38 00 00 00 00 dd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABSS_2147845759_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABSS!MTB"
        threat_id = "2147845759"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {57 00 69 00 6e 00 64 00 6f 00 77 00 73 00 46 00 6f 00 72 00 6d 00 73 00 41 00 70 00 70 00 39 00 35 00 2e 00 50 00 72 00 6f 00 70 00 65 00 72 00 74 00 69 00 65 00 73 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73}  //weight: 2, accuracy: High
        $x_2_2 = {50 00 78 00 76 00 62 00 6a 00 6d 00 6a 00 6f 00 73 00 67 00 66 00 64 00 77 00 67 00 69 00 6d 00 69 00 69 00 71 00 69}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABST_2147845760_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABST!MTB"
        threat_id = "2147845760"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {1b 0b 07 73 ?? 00 00 0a 16 73 ?? 00 00 0a 0c 00 20 00 10 00 00 8d ?? 00 00 01 0d 00 00 73 ?? 00 00 0a 13 04 00 00 08 09 16 20 00 10 00 00 6f ?? 00 00 0a 13 05 11 05 16 fe 02 13 06 11 06 2c 0e 00 11 04 09 16 11 05 6f ?? 00 00 0a 00 00 00 11 05 16 fe 02 13 07 11 07 2d cb}  //weight: 4, accuracy: Low
        $x_1_2 = "PBXEmulator.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAS_2147845779_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAS!MTB"
        threat_id = "2147845779"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0c 16 13 04 2b 17 00 08 11 04 07 11 04 9a 1f 10 28 ?? 00 00 0a 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 05 11 05 2d dc}  //weight: 2, accuracy: Low
        $x_2_2 = {0a 00 02 28 ?? 00 00 06 28 ?? 00 00 06 72 ?? 02 00 70 72 ?? 02 00 70 6f ?? 00 00 0a 17 8d ?? 00 00 01 25 16 1f 2d 9d 6f ?? 00 00 0a 0b 07 8e 69 8d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KNZ_2147845819_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KNZ!MTB"
        threat_id = "2147845819"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {19 8d 01 00 00 01 25 16 72 01 00 00 70 a2 25 17 72 23 00 00 70 a2 25 18 72 7d 00 00 70 a2 18 9a 2b 11 2b 16 2b 1b 14 2b 1f 2b 24 2a 28 35 00 00 0a 2b cd 6f 0f 00 00 0a 2b e8 28 88 0c 00 06 2b e3 28 36 00 00 0a 2b de 28 81 0c 00 06 2b da 6f 37 00 00 0a 2b d5}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAT_2147845831_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAT!MTB"
        threat_id = "2147845831"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {13 1e 16 13 1f 2b 28 00 11 1d 11 1f 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 21 11 1e 11 21 6f ?? 00 00 0a 00 11 1f 18 58 13 1f 00 11 1f 11 1d 6f ?? 00 00 0a fe 04 13 22 11 22 2d c7}  //weight: 3, accuracy: Low
        $x_2_2 = "SudokuCWL.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABQW_2147845862_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABQW!MTB"
        threat_id = "2147845862"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 08 02 8e 69 5d 02 08 02 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? ?? ?? 0a 02 08 1e 58 1d 59 02 8e 69 5d 91 59 20 ?? ?? ?? 00 58 18 58 20 ?? ?? ?? 00 5d d2 9c 08 16 2d 02}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABQY_2147845863_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABQY!MTB"
        threat_id = "2147845863"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {03 06 07 6f ?? 00 00 0a 13 06 08 06 12 06 28 ?? 00 00 0a 9c 07 17 58 0b 07 03 6f ?? 00 00 0a fe 04 0d 09 2d db}  //weight: 6, accuracy: Low
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAU_2147845943_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAU!MTB"
        threat_id = "2147845943"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 13 0e 2b 1b 08 11 0e 8f ?? 00 00 01 25 47 07 11 0e 07 8e 69 5d 91 61 d2 52 11 0e 17 58 13 0e 11 0e 08 8e 69 32 de}  //weight: 2, accuracy: Low
        $x_2_2 = {13 0b 20 00 04 00 00 8d ?? 00 00 01 13 0c 16 13 0d 2b 0c 11 0b 11 0c 16 11 0d 6f ?? 00 00 0a 11 0a 11 0c 16 11 0c 8e 69 6f ?? 00 00 0a 25 13 0d 16 30 e0}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABSE_2147845962_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABSE!MTB"
        threat_id = "2147845962"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 07 11 05 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 00 11 05 18 58 13 05 11 05 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d d1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABSH_2147845964_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABSH!MTB"
        threat_id = "2147845964"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 89 00 00 70 28 ?? 00 00 06 13 00 38 ?? 00 00 00 28 ?? 00 00 06 11 00 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 13 01 38 ?? 00 00 00 dd ?? ?? ?? ff 26}  //weight: 5, accuracy: Low
        $x_1_2 = "ReadAsByteArrayAsyn" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTM_2147845967_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTM!MTB"
        threat_id = "2147845967"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {06 08 18 6f ?? 00 00 0a 20 03 02 00 00 28 ?? 00 00 0a 13 04 07 11 04 6f ?? 00 00 0a 08 18 58 0c 08 06 6f ?? 00 00 0a fe 04 13 05 11 05 2d d1}  //weight: 6, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTO_2147845968_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTO!MTB"
        threat_id = "2147845968"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 08 16 07 16 1f 10 28 ?? 00 00 0a 08 16 07 1f 0f 1f 10 28 ?? 00 00 0a 06 07 6f ?? 00 00 0a 06 18 6f ?? 00 00 0a 06 6f ?? 00 00 0a 0d 09 03 16 03 8e 69 6f ?? 00 00 0a 2a 73 ?? 00 00 0a 2b a0 0a 2b 9f 0b 2b a5}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPAZ_2147846049_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPAZ!MTB"
        threat_id = "2147846049"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2b 08 2b 0d 2b 12 2b 17 de 1b 28 ?? ?? ?? 06 2b f1 28 ?? ?? ?? 2b 2b ec 28 ?? ?? ?? 2b 2b e7 0a 2b e6}  //weight: 3, accuracy: Low
        $x_1_2 = "Ycxubmpcmicucqh" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABSV_2147846101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABSV!MTB"
        threat_id = "2147846101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 07 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 5, accuracy: Low
        $x_1_2 = "Marliece Andrada" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTB_2147846105_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTB!MTB"
        threat_id = "2147846105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 07 11 07 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a b4 6f ?? ?? ?? 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 5, accuracy: Low
        $x_1_2 = "Marliece Andrada" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTC_2147846106_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTC!MTB"
        threat_id = "2147846106"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 16 07 1f 0f 1f 10 28 ?? ?? ?? 0a 06 07 6f ?? ?? 00 0a 06 18 6f ?? ?? 00 0a 06 6f ?? ?? 00 0a 0d 09 03 16 03 8e 69 6f ?? ?? 00 0a 13 04 de 46}  //weight: 4, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTD_2147846107_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTD!MTB"
        threat_id = "2147846107"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 07 18 6f ?? ?? ?? 0a 20 03 02 00 00 28 ?? ?? ?? 0a 13 08 09 11 08 6f ?? ?? ?? 0a 00 00 11 07 18 58 13 07 11 07 07 6f ?? ?? ?? 0a fe 04 13 09 11 09 2d ca}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUE_2147846110_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUE!MTB"
        threat_id = "2147846110"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 13 07 2b 23 07 08 06 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f d6 00 00 0a 00 08 17 ?? 0c 11 07 18 d6 13 07 11 07 11 06 31 d7}  //weight: 4, accuracy: Low
        $x_1_2 = "pryControlStock.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUF_2147846111_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUF!MTB"
        threat_id = "2147846111"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 0d 2b 20 00 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 13 07 08 11 07 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 08 11 08 2d d1}  //weight: 4, accuracy: Low
        $x_1_2 = "QUANLYBANHANG.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAV_2147846113_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAV!MTB"
        threat_id = "2147846113"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {18 da 13 06 16 13 07 2b 23 07 08 06 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 08 17 d6 0c 11 07 18 d6 13 07 11 07 11 06 31 d7}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CAQ_2147846117_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CAQ!MTB"
        threat_id = "2147846117"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 11 0a 75 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 74 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 1c 13 0e 38 ?? fe ff ff 11 09 17 58 13 09 1f 0d 13 0e 38 ?? fe ff ff 11 09 11 07 31 09 1f 11 13 0e 38}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUI_2147846122_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUI!MTB"
        threat_id = "2147846122"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0d 2b 20 00 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 13 05 08 11 05 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d d1 28 ?? 00 00 0a 08 6f ?? 00 00 0a 6f ?? 00 00 0a 13 04}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSLH_2147846131_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSLH!MTB"
        threat_id = "2147846131"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 8e 2d 06 17 28 0f 00 00 0a 02 16 9a 28 02 00 00 06 28 03 00 00 06 28 10 00 00 0a 28 11 00 00 0a 26 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSLJ_2147846132_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSLJ!MTB"
        threat_id = "2147846132"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7e 01 00 00 04 02 19 58 91 1f 18 62 60 0c 28 16 00 00 0a 7e 01 00 00 04 02 1a 58 08 6f 17 00 00 0a 28 18 00 00 0a a5 01 00 00 1b 0b 38 d6 00 00 00 06 18}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSLU_2147846178_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSLU!MTB"
        threat_id = "2147846178"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 2a 00 00 0a 7e 01 00 00 04 02 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a a5 01 00 00 1b 0b 11 07 20 42 2c b6 fe 5a 20 f8 98 51 58 61 38 63 fd ff ff d0 01 00 00 1b 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 11 05 28 2e 00 00 0a 13 06 7e 01 00 00 04 02 11 06 16 11 04 1a 59 28 29 00 00 0a 11 07}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSMC_2147846182_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSMC!MTB"
        threat_id = "2147846182"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 05 a2 25 1b 72 37 0b 00 70 a2 28 ?? ?? ?? 0a 13 06 11 06 72 83 0a 00 70 28 ?? ?? ?? 0a 13 06 11 06 72 79 0b 00 70 28 ?? ?? ?? 0a 13 06 11 06 72 c5 0b 00 70 28 ?? ?? ?? 0a 13 06 72 fd 0b 00 70 11 06 28 ?? ?? ?? 0a 72 fd 0b 00 70 28 ?? ?? ?? 0a 26 de 45}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NAM_2147846191_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NAM!MTB"
        threat_id = "2147846191"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 6f 82 00 00 06 2d 10 02 16 1c 2d 04 26 26 2b 07 28 ?? 00 00 06 2b 00 02 06 28 ?? 00 00 06}  //weight: 5, accuracy: Low
        $x_1_2 = "Etstgdttbncqaj" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUN_2147846216_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUN!MTB"
        threat_id = "2147846216"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 0d 2b 1d 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 13 05 08 11 05 6f ?? 00 00 0a 09 18 58 0d 09 07 6f ?? 00 00 0a 32 da}  //weight: 4, accuracy: Low
        $x_1_2 = "Optiks_CSharp.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUO_2147846220_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUO!MTB"
        threat_id = "2147846220"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {16 13 07 2b 1e 08 07 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 3, accuracy: Low
        $x_1_2 = "appPizza.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSMD_2147846242_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSMD!MTB"
        threat_id = "2147846242"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 73 72 00 00 0a 0d 04 28 6d 00 00 0a 13 04 16 13 05 00 11 04 11 05 9a 13 06 11 06 7e 34 02 00 04 6f 6e 00 00 0a 13 07 11 07 2c 30 00 17 0b 09 7e b2 02 00 04 03 28 15 00 00 0a 6f 73 00 00 0a 00 02 11 06 7e 34 02 00 04 14 6f 6f 00 00 0a 6f 70 00 00 0a 7d 0c 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSME_2147846243_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSME!MTB"
        threat_id = "2147846243"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 06 8e 69 2e 13 07 8d 0a 00 00 01 0d 06 16 09 16 07 28 0e 00 00 0a 09 0a 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSWL_2147846250_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSWL!MTB"
        threat_id = "2147846250"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 06 11 07 6f ?? ?? ?? ?? 0d 00 06 09 6f ?? ?? ?? ?? 13 04 11 04 1a 28 ?? ?? ?? ?? fe 04 1e 28 ?? ?? ?? ?? fe 01 13 08 11 08 2d 0c 00 08 09 6f ?? ?? ?? ?? 26 00 2b 25 00 11 04 07 59 06 6f ?? ?? ?? ?? 58 06 6f ?? ?? ?? ?? 5d 13 04 08 06 11 04 6f ?? ?? ?? ?? 6f ?? ?? ?? ?? 26 00 00 11 07 1f 0c 28 ?? ?? ?? ?? 58 13 07 11 07 11 06 6f ?? ?? ?? ?? fe 04 13 08 11 08 3a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAW_2147846259_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAW!MTB"
        threat_id = "2147846259"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 13 08 11 06 6f ?? 00 00 0a d4 8d ?? 00 00 01 13 09 11 06 16 6a 6f ?? 00 00 0a 11 06 11 09 16 11 09 8e 69 6f ?? 00 00 0a 26 11 09 28 ?? 00 00 0a 13 0a 11 0a 2a}  //weight: 3, accuracy: Low
        $x_2_2 = {0c 08 07 07 6f ?? 00 00 0a 0d 17 13 04 72 01 00 00 70 13 05 11 05}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAX_2147846300_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAX!MTB"
        threat_id = "2147846300"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0d 16 13 04 2b 23 00 08 11 04 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 13 06 09 11 06 6f ?? 00 00 0a 00 11 04 18 58 13 04 00 11 04 08 6f ?? 00 00 0a fe 04 13 07 11 07 2d cd}  //weight: 3, accuracy: Low
        $x_2_2 = "QuanlybanhangFAHASA.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTV_2147846304_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTV!MTB"
        threat_id = "2147846304"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 72 3b 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 0c 08 28 ?? 00 00 0a 00 07 08 6f ?? 00 00 0a 00 07 06 72 49 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 6f ?? 00 00 0a 00 07 06 72 55 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 6f ?? 00 00 0a 00 02 28 ?? 00 00 0a 00 07 6f ?? 00 00 0a 28 ?? 00 00 0a 0d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTY_2147846306_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTY!MTB"
        threat_id = "2147846306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {72 0f 00 00 70 28 ?? 00 00 06 0a 28 ?? 00 00 0a 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0b dd ?? 00 00 00 26 de d6 07 2a}  //weight: 3, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUS_2147846314_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUS!MTB"
        threat_id = "2147846314"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {18 da 13 18 16 13 19 2b 23 07 08 06 11 19 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 08 17 d6 0c 11 19 18 d6 13 19 11 19 11 18 31 d7}  //weight: 4, accuracy: Low
        $x_1_2 = "Cookies_Project.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTL_2147846319_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTL!MTB"
        threat_id = "2147846319"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {41 00 62 00 6f 00 75 00 74 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73 00 00 0b 44 00 6f 00 67 00 67 00 6f 00 00 0d 44 00 6f 00 67 00 67 00 6f 00 31}  //weight: 2, accuracy: High
        $x_1_2 = "032e71a3-5fe9-46d5-a266-36e0f126322b" ascii //weight: 1
        $x_1_3 = "About.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTP_2147846320_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTP!MTB"
        threat_id = "2147846320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 09 16 20 00 10 00 00 6f ?? 00 00 0a 13 05 11 05 16 fe 02 13 06 11 06 2c 0e 00 11 04 09 16 11 05 6f ?? 00 00 0a 00 00 00 11 05 16 fe 02 13 07 11 07 2d cb 72 8f 02 00 70 28 ?? 00 00 0a 72 c5 02 00 70 20 00 01 00 00 14 14 17 8d ?? 00 00 01 25 16 11 04 6f ?? 00 00 0a a2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTQ_2147846321_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTQ!MTB"
        threat_id = "2147846321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0b 06 16 73 ?? 00 00 0a 73 ?? 00 00 0a 0c 08 07 6f ?? 00 00 0a 07 6f ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0d de 1e 08 2c 06 08 6f ?? 00 00 0a dc}  //weight: 4, accuracy: Low
        $x_1_2 = "WindowsFormsApp1.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTS_2147846322_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTS!MTB"
        threat_id = "2147846322"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 72 55 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 0c 08 28 ?? 00 00 0a 00 07 08 6f ?? 00 00 0a 00 07 06 72 63 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 6f ?? 00 00 0a 00 07 06 72 6f 02 00 70 6f ?? 00 00 0a 74 ?? 00 00 1b 6f ?? 00 00 0a 00 02 28 ?? 00 00 0a 00 07 6f ?? 00 00 0a 28 ?? 00 00 0a 0d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCM_2147846348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCM!MTB"
        threat_id = "2147846348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 01 28 ?? 00 00 06 13 02 38 ?? 00 00 00 28 ?? 00 00 06 11 00 6f ?? 00 00 0a 28 ?? 00 00 0a 13 01}  //weight: 1, accuracy: Low
        $x_1_2 = "/carlcederlaw.com/" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTH_2147846394_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTH!MTB"
        threat_id = "2147846394"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ReadAsByteArrayAsyn" ascii //weight: 1
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_3_3 = {31 00 30 00 39 00 2e 00 32 00 30 00 36 00 2e 00 32 00 34 00 33 00 2e 00 31 00 39 00 33 00 2f 00 62 00 69 00 6e 00 2e 00 62 00 6d 00 70}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUT_2147846398_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUT!MTB"
        threat_id = "2147846398"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "SudokuCWL.Properties.Resources.resources" ascii //weight: 2
        $x_1_2 = "ee5393ae-e3e3-44f6-9773-7853b7186598" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUY_2147846406_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUY!MTB"
        threat_id = "2147846406"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {18 da 13 18 16 13 19 2b 22 07 08 06 11 19 18 6f ?? ?? 00 0a 1f 10 28 ?? 01 00 0a 6f ?? ?? 00 0a 00 08 17 d6 0c 11 19 18 d6 13 19 11 19 11 18 31 d8}  //weight: 4, accuracy: Low
        $x_1_2 = "Projected_Sales_Project.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSMR_2147846447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSMR!MTB"
        threat_id = "2147846447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 32 00 00 0a 06 28 07 00 00 06 6f 33 00 00 0a 25 28 34 00 00 0a 72 3f 00 00 70 28 02 00 00 06 28 08 00 00 06 de 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSMU_2147846448_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSMU!MTB"
        threat_id = "2147846448"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 28 03 00 00 0a 0a 28 04 00 00 0a 06 6f 05 00 00 0a 0b 07 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSST_2147846469_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSST!MTB"
        threat_id = "2147846469"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 0b 00 00 06 0a 28 0b 00 00 0a 06 6f 0c 00 00 0a 28 0a 00 00 06 75 01 00 00 1b 0b 07 16 07 8e 69 28 ?? ?? ?? ?? 07 2a}  //weight: 5, accuracy: Low
        $x_1_2 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 62 00 6c 00 6f 00 63 00 65 00 78 00 70 00 65 00 72 00 74 00 2e 00 65 00 75 00 2f 00 2e 00 77 00 65 00 6c 00 6c 00 2d 00 6b 00 6e 00 6f 00 77 00 6e 00 2f [0-31] 2e 00 70 00 6e 00 67 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAY_2147846493_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAY!MTB"
        threat_id = "2147846493"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 07 8e 69 17 da 13 18 16 13 19 2b 15 08 11 19 07 11 19 9a 1f 10 28 ?? 00 00 0a 9c 11 19 17 d6 13 19 11 19 11 18 31 e5}  //weight: 3, accuracy: Low
        $x_2_2 = {5a 00 69 00 6c 00 6c 00 69 00 6f 00 6e 00 54 00 65 00 63 00 68 00 6e 00 6f 00 6c 00 6f 00 67 00 69 00 65 00 73 00 53 00 61 00 6c 00 65 00 73 00 [0-5] 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCP_2147846507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCP!MTB"
        threat_id = "2147846507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a a2 25 17 03 a2 25 18 02 17 8d ?? 00 00 01 25 16 1e 8c ?? 00 00 01 a2 14 28 ?? 00 00 0a a2 6f ?? 00 00 0a}  //weight: 1, accuracy: Low
        $x_1_2 = "bd5a-153ad14f3c35" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCQ_2147846508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCQ!MTB"
        threat_id = "2147846508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 27 00 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 28 ?? 00 00 0a 16 91 13 05 08 11 05 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 06 11 06}  //weight: 1, accuracy: Low
        $x_1_2 = {34 00 44 00 35 00 41 00 39 00 00 0b 50 00 69 00 67 00 75 00 65 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCR_2147846509_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCR!MTB"
        threat_id = "2147846509"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 cb 02 00 70 20 00 01 00 00 14 14 17 8d ?? 00 00 01 25 16 11 05 6f ?? 00 00 0a a2 6f ?? 00 00 0a 74 ?? 00 00 01 13 07 11 07 6f ?? 00 00 0a 16 9a 7e ?? 00 00 04 13 09 11 09}  //weight: 1, accuracy: Low
        $x_1_2 = {53 00 79 00 73 00 74 00 65 00 6d 00 2e 00 52 00 65 00 66 00 6c 00 65 00 63 00 74 00 69 00 6f 00 6e 00 2e 00 41 00 73 00 73 00 65 00 6d 00 62 00 6c 00 79 00 00 09 4c 00 6f 00 61 00 64}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAZ_2147846565_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAZ!MTB"
        threat_id = "2147846565"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {18 da 13 19 16 13 1a 2b 22 08 09 07 11 1a 18 6f ?? 01 00 0a 1f 10 28 ?? 01 00 0a 6f ?? 01 00 0a 00 09 17 d6 0d 11 1a 18 d6 13 1a 11 1a 11 19 31 d8}  //weight: 3, accuracy: Low
        $x_2_2 = "HJNFCSUHBF IUYFGVUYFGYIUFGYFGHYIU EFGYUFGU YEFGEUYGF" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAA_2147846566_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAA!MTB"
        threat_id = "2147846566"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {43 00 44 00 2d 00 32 00 31 00 2d 00 35 00 34 00 2d 00 36 00 38 00 2d 00 36 00 39 00 2d 00 37 00 33 00 2d 00 32 00 23 00 2d 00 37 00 23 00 2d 00 37 00 32 00 2d 00 36 00 46 00 2d 00 36 00 37 00 2d 00 37 00 32 00 2d 00 36 00 31 00 2d 00 36 00 44 00 2d 00 32 00 23 00 2d 00 36 00 33 00 2d 00 36 00 31 00 2d 00 36 00 45 00 2d 00 36 00 45 00 2d 00 36 00 46 00 2d 00 37 00 34}  //weight: 1, accuracy: High
        $x_1_2 = "16-9A-74-#6-##-##-#1-6F-21-##-##-#A-#C-2B-##-#8-2A-##" wide //weight: 1
        $x_1_3 = "A-25-2D-#6-26-72-2D-##-##-7#-73-8A-##-##-#A-#C-#8-6F-8B" wide //weight: 1
        $x_2_4 = "Kona dwarmack" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDM_2147846568_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDM!MTB"
        threat_id = "2147846568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {18 da 13 06 16 13 07 2b 1e 08 07 11 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 1, accuracy: Low
        $x_1_2 = "73751d81-379f-4949-a4fc-8a8ffb542797" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTE_2147846600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTE!MTB"
        threat_id = "2147846600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 08 11 01 11 07 18 6f ?? ?? 00 0a 1f 10 28 ?? ?? ?? 0a b4 6f ?? ?? 00 0a 38 ?? ?? 00 00 28 ?? ?? ?? 0a 11 08 28 ?? ?? ?? 06 6f ?? ?? 00 0a 13 03}  //weight: 4, accuracy: Low
        $x_1_2 = "Priscilla_Taylor" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABTF_2147846601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABTF!MTB"
        threat_id = "2147846601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 07 11 07 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a b4 6f ?? ?? ?? 0a 00 11 07 18 d6 13 07 11 07 11 06 31 dc}  //weight: 4, accuracy: Low
        $x_1_2 = "Priscilla_Taylor" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABUV_2147846604_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABUV!MTB"
        threat_id = "2147846604"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {a2 13 04 d0 ?? 00 00 01 28 ?? ?? 00 0a 11 04 28 ?? ?? 00 0a 20 00 01 00 00 14 14 17 8d ?? 00 00 01 25 16 07 6f ?? ?? 00 0a a2 28 ?? ?? 00 0a 74 ?? 00 00 01 13 05 11 05 6f ?? 01 00 0a 17 9a 7e ?? 00 00 04 13 06 11 06}  //weight: 4, accuracy: Low
        $x_1_2 = "GameOfLifeUI.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAC_2147846699_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAC!MTB"
        threat_id = "2147846699"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 0c 11 07 58 11 09 59 93 61 11 0b 75 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 19 13 0e 38 ?? fe ff ff 11 09 17 58 13 09 1f 09 13 0e 38}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPHD_2147846714_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPHD!MTB"
        threat_id = "2147846714"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 16 09 16 1e 28 ?? ?? ?? 0a 00 07 09 6f ?? ?? ?? 0a 00 07 18 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 03 16 03 8e}  //weight: 1, accuracy: Low
        $x_1_2 = "MOANMZAAAAAAAR555" ascii //weight: 1
        $x_1_3 = "CASLLLLLLL" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAD_2147846778_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAD!MTB"
        threat_id = "2147846778"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 0d 2b 21 00 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 13 05 08 11 05 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d d0}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCW_2147846818_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCW!MTB"
        threat_id = "2147846818"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 13 05 08 11 05 6f ?? 00 00 0a 09 18 58 0d 09 07 6f ?? 00 00 0a 32 d9}  //weight: 1, accuracy: Low
        $x_1_2 = "##3###04###FFFF##B8#######4####################" ascii //weight: 1
        $x_1_3 = "#2802##2B1308120820C503##208D03##2833##0620C8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABVU_2147846847_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABVU!MTB"
        threat_id = "2147846847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {07 8e 69 17 da 13 18 16 13 19 2b 15 08 11 19 07 11 19 9a 1f 10 28 ?? 00 00 0a 9c 11 19 17 d6 13 19 11 19 11 18 31 e5}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAE_2147846872_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAE!MTB"
        threat_id = "2147846872"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 07 8e 69 17 da 13 06 16 13 07 2b 18 08 07 11 07 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 07 17 d6 13 07 11 07 11 06 31 e2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAF_2147846886_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAF!MTB"
        threat_id = "2147846886"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 02 72 01 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 0a dd 06 00 00 00 26 dd 00 00 00 00 06 2c db}  //weight: 3, accuracy: Low
        $x_2_2 = "185.254.37.108" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAG_2147846899_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAG!MTB"
        threat_id = "2147846899"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 0d 2b 20 00 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 13 05 08 11 05 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d d1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCX_2147846901_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCX!MTB"
        threat_id = "2147846901"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 db 0e 00 70 06 72 e9 0e 00 70 7e ?? ?? ?? ?? 28 ?? ?? ?? 06 72 f1 0e 00 70 72 f5 0e 00 70}  //weight: 1, accuracy: Low
        $x_1_2 = {16 91 13 05 08 17 8d ?? 00 00 01 25 16 11 05 9c 6f ?? 00 00 0a 09 18 58 0d 09 07}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAH_2147846955_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAH!MTB"
        threat_id = "2147846955"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 13 08 2b 2f 00 08 6f ?? 00 00 0a 11 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 28 ?? 00 00 0a 16 91 13 09 09 11 09 6f ?? 00 00 0a 00 00 11 08 18 58 13 08 11 08 08 6f ?? 00 00 0a 6f ?? 00 00 0a fe 04 13 0a 11 0a 2d bc}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAI_2147846965_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAI!MTB"
        threat_id = "2147846965"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0c 07 8e 69 17 da 13 06 16 13 07 2b 19 08 07 11 07 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 00 11 07 17 d6 13 07 11 07 11 06 31 e1}  //weight: 3, accuracy: Low
        $x_2_2 = "D0~E2~56~46~F6~D6~02~35~F4~44~02~E6~96~02~E6~57" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDA_2147846966_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDA!MTB"
        threat_id = "2147846966"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 16 0b 2b 2a 09 6f ?? 00 00 0a 07 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 28 ?? 00 00 0a 16 91 13 08 11 05 11 08 6f ?? 00 00 0a 07 18 58 0b 07 09 6f ?? 00 00 0a 6f ?? 00 00 0a fe 04 13 09 11 09 2d c2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBCU_2147846969_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBCU!MTB"
        threat_id = "2147846969"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 28 ?? 00 00 0a 16 91 13 05 08 17 8d ?? 00 00 01 25 16 11 05 9c 6f ?? 00 00 0a 00 09 18 58 0d 00 09 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d c1}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXB_2147846995_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXB!MTB"
        threat_id = "2147846995"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0d 16 13 04 2b 3c 00 16 13 04 2b 21 00 07 09 11 04 6f ?? 00 00 0a 13 06 08 12 06 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 04 17 58 13 04 00 11 04 07 6f ?? 00 00 0a fe 04 13 07 11 07 2d cf}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSTE_2147847011_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSTE!MTB"
        threat_id = "2147847011"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 13 04 2b 21 00 07 09 11 04 6f ?? ?? ?? ?? 13 06 08 12 06 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 00 11 04 17 58 13 04 00 11 04 07 6f ?? ?? ?? ?? fe 04 13 07 11 07 2d cf 09 17 58 0d 00 09 07 6f ?? ?? ?? ?? fe 04 13 08 11 08 2d b5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNN_2147847080_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNN!MTB"
        threat_id = "2147847080"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 24 00 00 0a 7e 01 00 00 04 02 08 6f 25 00 00 0a 28 26 00 00 0a a5 01 00 00 1b 0b 11 07 20 3f 26 89 5a 5a 20 a3 54 2f df 61 38 5c ff ff ff d0 01 00 00 1b 28 18 00 00 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNS_2147847081_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNS!MTB"
        threat_id = "2147847081"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 7e 03 00 00 04 6f 35 00 00 0a 02 16 02 8e 69 6f 36 00 00 0a 0a 2b 00 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JQ_2147847106_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JQ!MTB"
        threat_id = "2147847106"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 09 11 04 6f ?? 00 00 0a 13 06 08 12 06 28 ?? 00 00 0a 6f ?? 00 00 0a 11 04 17 58 13 04 11 04 07 6f ?? 00 00 0a 32 ?? 09 17 58 0d 09 07 6f}  //weight: 2, accuracy: Low
        $x_1_2 = "GetExportedTypes" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GIF_2147847110_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GIF!MTB"
        threat_id = "2147847110"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {16 0d 16 13 04 2b 31 16 13 04 2b 1e 07 09 11 04 6f ?? ?? ?? 0a 13 06 08 12 06 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 11 04 17 58 13 04 11 04 07 6f ?? ?? ?? 0a 32 d8 09 17 58 0d 09 07 6f ?? ?? ?? 0a 32 c6}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPW_2147847160_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPW!MTB"
        threat_id = "2147847160"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 20 8b 18 fe f1 5a 20 40 d2 f6 f6 61 38 b7 fe ff ff 28 ?? ?? ?? 0a 7e 01 00 00 04 02 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a a5 01 00 00 1b 0b 11 07 20 41 68 4f 51 5a 20 e0 6d 88 f0 61 38 88 fe ff ff}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPW_2147847160_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPW!MTB"
        threat_id = "2147847160"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 73 0e 00 00 0a 0d 09 17 6f ?? ?? ?? 0a 09 18 6f ?? ?? ?? 0a 09 0c 08 06 06 1f 10 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 13 04 73 12 00 00 0a 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "YUCg1fBz3k5N1EkdPu7JjU8y3dowVQ6z" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABVV_2147847206_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABVV!MTB"
        threat_id = "2147847206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 02 11 01 11 07 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 38 ?? ?? 00 00 00 02}  //weight: 3, accuracy: Low
        $x_1_2 = "KonaSWDCarm" wide //weight: 1
        $x_1_3 = "DeleteMC" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDL_2147847211_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDL!MTB"
        threat_id = "2147847211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "22XZZZXIIiiiiOOOoiiiiO00" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDB_2147847213_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDB!MTB"
        threat_id = "2147847213"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {53 00 79 00 73 00 74 00 65 00 6d 00 2e 00 41 00 63 00 74 00 69 00 76 00 61 00 74 00 6f 00 72 00 00 1d 65 00 63 00 6e 00 61 00 74 00 73 00 6e 00 49 00 65 00 74 00 61 00 65 00 72 00 43 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CSTU_2147847236_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CSTU!MTB"
        threat_id = "2147847236"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 a5 15 00 70 28 2f 01 00 0a 72 ?? ?? ?? ?? 28 ?? ?? ?? ?? 20 ?? ?? ?? ?? 14 14 17 8d 01 00 00 01 25 16 7e 89 00 00 04 a2 6f 31 01 00 0a 26 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "QEssDJZhQnLywDnJGpBEr" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAD_2147847254_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAD!MTB"
        threat_id = "2147847254"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {00 09 11 04 e0 58 06 11 04 91 52 00 11 04 17 58 13 04 11 04 06 8e 69 fe 05 13 05 11 05 2d e1}  //weight: 10, accuracy: High
        $x_1_2 = "Writing Shellcode in the Remote Process" wide //weight: 1
        $x_1_3 = "Injecting into process with PID" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXD_2147847256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXD!MTB"
        threat_id = "2147847256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 04 2b 44 00 16 13 05 2b 27 00 07 11 04 11 05 6f ?? 00 00 0a 13 06 08 12 06 28 ?? 00 00 0a 8c ?? 00 00 01 6f ?? 00 00 0a 26 00 11 05 17 58 13 05 11 05 07 6f ?? 00 00 0a fe 04 13 07 11 07 2d c9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDE_2147847298_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDE!MTB"
        threat_id = "2147847298"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 11 08 09 11 08 9a 1f 10 28 ?? 00 00 0a 9c 11 08 17 58 13 08 11 08 09 8e 69 fe 04 13 09 11 09 2d dd}  //weight: 1, accuracy: Low
        $x_1_2 = "ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-ZZ-" ascii //weight: 1
        $x_1_3 = {01 25 16 1f 2d 9d 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXG_2147847329_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXG!MTB"
        threat_id = "2147847329"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 0d 2b 43 00 16 13 04 2b 28 00 08 09 11 04 6f ?? 00 00 0a 13 0b 12 0b 28 ?? 00 00 0a 13 0c 07 11 05 11 0c 9c 11 05 17 58 13 05 00 11 04 17 58 13 04 11 04 08 6f ?? 00 00 0a fe 04 13 0d 11 0d 2d c8}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXH_2147847344_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXH!MTB"
        threat_id = "2147847344"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {07 8e 69 17 da 13 06 16 13 07 2b 19 08 07 11 07 9a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 07 17 d6 13 07 11 07 11 06 31 e1}  //weight: 4, accuracy: Low
        $x_1_2 = "DeleteMC" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXRG_2147847364_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXRG!MTB"
        threat_id = "2147847364"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 11 04 6f 74 00 00 0a 13 0b 12 0b 28 ?? ?? ?? ?? 13 0c 07 11 05 11 0c 9c 11 05 17 58 13 05 00 11 04 17 58 13 04 11 04 08 6f ?? ?? ?? ?? fe 04 13 0d 11 0d 2d c8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBDG_2147847387_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBDG!MTB"
        threat_id = "2147847387"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "XXP03XPE2XP03XPE2XP03XPE2X" wide //weight: 1
        $x_1_2 = "XXXP13P8EXXXPC0XXP0FXX" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAK_2147847404_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAK!MTB"
        threat_id = "2147847404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 16 0b 16 0a 2b 2d 16 0a 2b 1c 09 07 06 6f ?? 00 00 0a 13 07 11 04 12 07 28 ?? 00 00 0a 6f ?? 00 00 0a 06 17 58 0a 06 09 6f ?? 00 00 0a 32 db}  //weight: 4, accuracy: Low
        $x_4_2 = {d2 13 35 11 17 1e 63 d1 13 17 11 15 11 0a 91 13 29 11 15 11 0a 11 26 11 29 61 19 11 1f 58 61 11 35 61 d2 9c 11 0a 17 58 13 0a 11 29 13 1f 11 0a 11 23 32 a4}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_NEAU_2147847434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NEAU!MTB"
        threat_id = "2147847434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {28 20 00 00 0a 0a 00 06 7e 0e 00 00 04 28 21 00 00 0a 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 73 65 00 00 06 0b 07 06 6f ?? 00 00 0a}  //weight: 10, accuracy: Low
        $x_5_2 = "AnimeOverviewer-master" ascii //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNQ_2147847441_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNQ!MTB"
        threat_id = "2147847441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {38 12 00 00 00 00 28 04 00 00 06 0a dd 06 00 00 00 26 dd 00 00 00 00 06 2c eb 28 02 00 00 0a 06 6f 03 00 00 0a 0b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNU_2147847443_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNU!MTB"
        threat_id = "2147847443"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {14 0a 38 18 00 00 00 00 02 72 01 00 00 70 28 03 00 00 06 0a dd 06 00 00 00 26 dd 00 00 00 00 06 2c e5 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNV_2147847444_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNV!MTB"
        threat_id = "2147847444"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 11 0e 11 10 6f ?? ?? ?? 0a 13 11 11 11 16 16 16 16 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 2c 2a 11 04 12 11 28 ?? ?? ?? 0a 6f a1 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNW_2147847445_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNW!MTB"
        threat_id = "2147847445"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {14 0a 38 2c 00 00 00 00 28 ?? ?? ?? 0a 02 72 01 00 00 70 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 28 ?? ?? ?? 06 0a dd 06 00 00 00 26 dd 00 00 00 00 06 2c d1}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNY_2147847447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNY!MTB"
        threat_id = "2147847447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {13 05 2b 13 28 64 00 00 0a 11 12 16 11 12 8e 69 6f 65 00 00 0a 13 05 11 0b 06 20 d3 ba 83 39 58 07 58 19 11 0b 5f 58 1b 62 58}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXJ_2147847455_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXJ!MTB"
        threat_id = "2147847455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0d 2b 43 00 16 13 04 2b 28 00 08 09 11 04 6f ?? 00 00 0a 13 0f 12 0f 28 ?? 00 00 0a 13 10 07 11 05 11 10 9c 11 05 17 58 13 05 00 11 04 17 58 13 04 11 04 08 6f ?? 00 00 0a fe 04 13 11 11 11 2d c8}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CNL_2147847509_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CNL!MTB"
        threat_id = "2147847509"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 15 00 00 06 28 ?? ?? ?? 2b 28 ?? ?? ?? 2b 0a de 03}  //weight: 5, accuracy: Low
        $x_1_2 = "WindowsFormsApp60.Properties" ascii //weight: 1
        $x_1_3 = "Ofkzmlucwal" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CNT_2147847510_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CNT!MTB"
        threat_id = "2147847510"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 00 1f 2c 6f ?? ?? ?? 0a 25 26 13 01 38 ?? ?? ?? 00 02 28 ?? ?? ?? 06 25 26 13 00 38 ?? ?? ?? ff}  //weight: 5, accuracy: Low
        $x_1_2 = "HHGg65.g.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAF_2147847613_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAF!MTB"
        threat_id = "2147847613"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 08 11 05 07 11 05 18 5a 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 9c 00 11 05 17 58 13 05 11 05 08 8e 69 fe 04 13 06 11 06 2d d4}  //weight: 10, accuracy: Low
        $x_10_2 = "4C0103ZZ4AEAB76" wide //weight: 10
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSLT_2147847616_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSLT!MTB"
        threat_id = "2147847616"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 00 10 00 00 8d 59 00 00 01 0d 73 ?? ?? ?? 0a 13 04 08 09 16 20 00 10 00 00 6f ?? ?? ?? 0a 13 05 11 05 16 31 0b 11 04 09 16 11 05 6f ?? ?? ?? 0a 11 05 16 30 dc 28 ?? ?? ?? 0a 11 04 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 28 00 00 06 de 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSMM_2147847617_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSMM!MTB"
        threat_id = "2147847617"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0a 73 25 00 00 0a 13 06 00 11 06 72 0a 03 00 70 6f 26 00 00 0a 0a 00 de 0d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNK_2147847620_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNK!MTB"
        threat_id = "2147847620"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 04 00 00 06 0a dd 06 00 00 00 26 dd 00 00 00 00 06 2c eb 28 02 00 00 0a 06 6f 03 00 00 0a 0b}  //weight: 1, accuracy: High
        $x_2_2 = {28 08 00 00 0a 6f 09 00 00 0a 14 17 8d 06 00 00 01 25 16 07 a2 6f 0a 00 00 0a 75 01 00 00 1b 08 28 0b 00 00 0a 28 01 00 00 2b 28 02 00 00 2b 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOD_2147847623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOD!MTB"
        threat_id = "2147847623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 24 00 00 0a 7e 01 00 00 04 02 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a a5 01 00 00 1b 0b 11 07 20 fc 73 f5 3d 5a 20 be 2e 12 d7 61 38 6f ff ff ff 09 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAG_2147847629_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAG!MTB"
        threat_id = "2147847629"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 07 11 04 11 05 6f ?? 00 00 0a 13 09 07 11 04 11 05 6f ?? 00 00 0a 13 0a 11 0a 28 ?? 00 00 0a 13 0b 09 08 11 0b d2 9c 00 11 05 17 58 13 05 11 05 07 6f ?? 00 00 0a fe 04 13 0c 11 0c 2d c1}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPC_2147847641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPC!MTB"
        threat_id = "2147847641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 73 0e 00 00 0a 0d 09 17 6f ?? ?? ?? 0a 09 18 6f ?? ?? ?? 0a 09 0c 08 06 06 1f 10 28 ?? ?? ?? 06 6f ?? ?? ?? 0a 13 04 73 12 00 00 0a 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "PdIAeDgdUpI6fuXPyqmr20emJaGZP5ti" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JO_2147847660_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JO!MTB"
        threat_id = "2147847660"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "su0UGMRcRFpG45MMHy.40g08Dtsi4VpcKhiXc" ascii //weight: 2
        $x_2_2 = "aR3nbf8dQp2feLmk31.lSfgApatkdxsVcGcrktoFd.resources" ascii //weight: 2
        $x_2_3 = "Tjmxm.g.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAA_2147847664_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAA!MTB"
        threat_id = "2147847664"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "OPN1LW_v1._1.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAM_2147847717_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAM!MTB"
        threat_id = "2147847717"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0b 07 06 72 ?? 00 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 07 06 72 ?? 00 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 07 06 72 ?? 00 00 70 6f ?? 00 00 0a 74 02 00 00 1b 6f ?? 00 00 0a 02 73}  //weight: 3, accuracy: Low
        $x_2_2 = "MyMemoryManagement.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAB_2147847721_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAB!MTB"
        threat_id = "2147847721"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "XXU13U8EXXXUC0XXU0FXX" wide //weight: 1
        $x_1_2 = "XU03XUE2XU03XUE2XU03XUE2XU" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXS_2147847725_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXS!MTB"
        threat_id = "2147847725"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0d 2b 2d 07 09 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 28 ?? 00 00 0a 16 91 13 05 08 17 8d ?? 00 00 01 25 16 11 05 9c 6f ?? 00 00 0a 09 18 58 0d 09 07 6f ?? 00 00 0a fe 04 13 06 11 06 2d c4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXT_2147847740_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXT!MTB"
        threat_id = "2147847740"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 04 2b 3f 00 16 13 05 2b 22 00 07 11 04 11 05 28 ?? 00 00 06 13 06 08 12 06 28 ?? 00 00 0a 6f ?? 00 00 0a 00 00 11 05 17 58 13 05 11 05 07 28 ?? 00 00 06 fe 04 13 07 11 07 2d ce 00 11 04 17 58 13 04 11 04 07 28 ?? 00 00 06 fe 04 13 08 11 08 2d b1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAD_2147847754_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAD!MTB"
        threat_id = "2147847754"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "~E6~96~16~D4~C6~C6~44~27~F6~34~F5~00~0" wide //weight: 2
        $x_2_2 = "82~90~D0~B1~00~00~10~47~60~00" wide //weight: 2
        $x_1_3 = "System.Reflection.Assembly" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAN_2147847757_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAN!MTB"
        threat_id = "2147847757"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 1f 16 13 20 2b 25 11 1e 11 20 18 6f ?? 00 00 0a 20 ?? 02 00 00 28 ?? 00 00 0a 13 22 11 1f 11 22 6f ?? 00 00 0a 11 20 18 58 13 20 11 20 11 1e 6f ?? 00 00 0a fe 04 2d ce}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAF_2147847787_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAF!MTB"
        threat_id = "2147847787"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 51 06 00 70 06 72 5d 06 00 70 6f ?? 00 00 0a 72 67 06 00 70 72 6b 06 00 70}  //weight: 2, accuracy: Low
        $x_1_2 = "System.Activator" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOR_2147847793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOR!MTB"
        threat_id = "2147847793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 38 2b 00 00 00 73 ?? ?? ?? 0a 0a dd ?? ?? ?? 00 26 72 8b 1b 00 70 72 2a 1c 00 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 74 71 00 00 01 0a dd 00 00 00 00 06 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXC_2147847812_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXC!MTB"
        threat_id = "2147847812"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "Havanna.Properties.Resources" wide //weight: 2
        $x_1_2 = "a9b440eb-329c-4216-8971-6458f1c29019" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABXO_2147847816_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABXO!MTB"
        threat_id = "2147847816"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {4b 00 4a 00 47 00 4e 00 45 00 44 00 4b 00 48 00 47 00 4e 00 46 00 45 00 49 00 4b 00 48 00 20 00 4a 00 4b 00 45 00 48 00 4a 00 4b 00 4c 00 52 00 48 00 4a 00 4b 00 45 00 52 00 48 00 45 00 4a 00 4b 00 20 00 52 00 48 00 4a 00 45 00 4b 00 4c 00 48 00 52 00 4a 00 4b 00 4c 00 45 00 48 00 52 00 4c 00 4b 00 4a 00 45 00 52 00 48}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAJ_2147847853_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAJ!MTB"
        threat_id = "2147847853"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {fe 0c 01 00 fe 0c 02 00 8f 43 00 00 01 25 47 fe 0c 01 00 fe 0c 07 00 91 fe 0c 00 00 20 04 00 00 00 58 4a 61 d2 61 d2 52 20 11 00 00 00 fe 0e 0a 00}  //weight: 10, accuracy: High
        $x_10_2 = {fe 0c 01 00 fe 0c 01 00 8e 69 20 01 00 00 00 63 8f 43 00 00 01 25 47 fe 0c 00 00 20 04 00 00 00 58 4a d2 61 d2 52 20 19 00 00 00 fe 0e 0a 00}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAK_2147847879_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAK!MTB"
        threat_id = "2147847879"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 07 11 08 07 8e 69 5d 07 11 08 07 8e 69 5d 91 08 11 08 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 08 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 ?? ?? 00 00 58 20 ?? ?? 00 00 5d 28 ?? 00 00 0a 9c 00 11 08 15 58 13 08 11 08 16 fe 04 16 fe 01 13 09 11 09 2d a4}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAP_2147847892_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAP!MTB"
        threat_id = "2147847892"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 16 13 05 16 13 06 2b 31 00 11 05 09 5d 13 09 11 05 09 5b 13 0a 08 11 09 11 0a 6f ?? 00 00 0a 13 0b 07 11 06 12 0b 28 ?? 00 00 0a 9c 11 06 17 58 13 06 11 05 17 58 13 05 00 11 05 09 11 04 5a fe 04 13 0c 11 0c 2d c1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABYD_2147847907_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABYD!MTB"
        threat_id = "2147847907"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 09 5d 13 0a 11 05 09 5b 13 0b 08 11 0a 11 0b 6f ?? 00 00 0a 13 0c 07 11 06 12 0c 28 ?? 00 00 0a 9c 11 06 17 58 13 06 11 05 17 58 13 05 11 05 09 11 04 5a 32 c9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAR_2147847913_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAR!MTB"
        threat_id = "2147847913"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 06 16 0a 16 0d 2b 29 06 08 5d 13 0a 06 08 5b 13 0b 07 11 0a 11 0b 6f ?? 00 00 0a 13 0c 11 05 09 12 0c 28 ?? 00 00 0a 9c 09 17 58 0d 06 17 58 0a 06 08 11 06 5a 32 d0}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAS_2147847914_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAS!MTB"
        threat_id = "2147847914"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 13 04 16 13 05 2b 2d 09 11 05 06 11 05 91 08 61 07 11 04 91 61 28 ?? 00 00 0a 9c 2b 00 11 04 1f 15 33 05 16 13 04 2b 06 11 04 17 58 13 04 11 05 17 58 13 05 11 05 06 8e 69 17 59 31 ca}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAN_2147848057_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAN!MTB"
        threat_id = "2147848057"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 11 59 11 53 5d 13 5a 11 59 11 54 5d 13 5b 11 51 11 5a 91 13 5c 11 52 11 5b 6f ?? 00 00 0a 13 5d 11 51 11 59 17 58 11 53 5d 91 13 5e 11 5c 11 5d 61 11 5e 59 20 ?? ?? 00 00 58 13 5f 11 51 11 5a 11 5f 20 ?? ?? 00 00 5d d2 9c 00 11 59 17 59 13 59 11 59 16 fe 04 16 fe 01 13 60 11 60 2d a0}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPXL_2147848060_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPXL!MTB"
        threat_id = "2147848060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 07 09 07 8e 69 5d 91 02 09 91 61 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 09 17 58 0d 09 02 8e 69 fe 04 13 04 11 04 2d d7}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAO_2147848071_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAO!MTB"
        threat_id = "2147848071"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 08 06 08 91 72 ?? 00 00 70 28 ?? 00 00 0a 59 d2 9c 08 17 58 0c 08 06 8e 69 32 e4}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAU_2147848123_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAU!MTB"
        threat_id = "2147848123"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 16 13 05 16 13 06 2b 2f 11 05 09 5d 13 07 11 05 09 5b 13 08 08 11 07 11 08 6f ?? 00 00 0a 13 09 07 11 06 12 09 28 ?? 00 00 0a 9c 11 06 17 58 13 06 11 05 17 58 13 05 11 05 09 11 04 5a 32 c9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPAX_2147848250_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPAX!MTB"
        threat_id = "2147848250"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {2b 36 2b 0e 2b 35 2b da 0b 2b e8 28 ?? ?? ?? 0a 2b ee 2a 28 ?? ?? ?? 06 2b c4 28 ?? ?? ?? 0a 2b c3 06 2b c2 6f ?? ?? ?? 0a 2b bd 28 ?? ?? ?? 06 2b b8 07 2b c0 07 2b c0}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABYP_2147848273_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABYP!MTB"
        threat_id = "2147848273"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 06 2b 31 00 11 05 09 5d 13 16 11 05 09 5b 13 17 08 11 16 11 17 6f ?? 00 00 0a 13 18 07 11 06 12 18 28 ?? 00 00 0a 9c 11 06 17 58 13 06 11 05 17 58 13 05 00 11 05 09 11 04 5a fe 04 13 19 11 19 2d c1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAV_2147848375_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAV!MTB"
        threat_id = "2147848375"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 11 04 13 05 17 13 06 2b 30 02 6f ?? 00 00 06 6f ?? 00 00 0a 09 11 06 9a 6f ?? 00 00 0a 00 02 6f ?? 00 00 06 6f ?? 00 00 0a 09 11 06 9a 6f ?? 00 00 0a 26 11 06 17 d6 13 06 11 06 11 05 31 ca}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABYQ_2147848376_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABYQ!MTB"
        threat_id = "2147848376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0b 2b 2a 07 11 04 5d 13 09 07 11 04 5b 13 0a 09 11 09 11 0a 6f ?? 00 00 0a 13 0d 11 05 12 0d 28 ?? 00 00 0a 6f ?? 00 00 0a 07 17 58 0b 07 11 04 11 06 5a fe 04 13 0b 11 0b 2d c8}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAW_2147848384_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAW!MTB"
        threat_id = "2147848384"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {58 00 4e 00 30 00 32 00 58 00 4e 00 39 00 37 00 58 00 4e 00 43 00 36 00 58 00 4e 00 32 00 36 00 58 00 4e 00 44 00 36 00 58 00 4e 00 35 00 36 00 58 00 4e 00 33 00 37 00 58 00 4e 00 33 00 37 00 58 00 4e 00 31 00 34 00 58 00 4e 00 31 00 30 00 58 00 4e 00 38}  //weight: 1, accuracy: High
        $x_1_2 = {4e 00 31 00 36 00 58 00 4e 00 45 00 36 00 58 00 4e 00 39 00 36 00 58 00 4e 00 37 00 36 00 58 00 4e 00 39 00 36 00 58 00 4e 00 32 00 37 00 58 00 4e 00 46 00 34 00 58 00 4e 00 31 00 30 00 58 00 4e 00 41 00 30 00 58 00 4e 00 43 00 33}  //weight: 1, accuracy: High
        $x_1_3 = {31 00 36 00 58 00 4e 00 43 00 36 00 58 00 4e 00 33 00 37 00 58 00 4e 00 45 00 36 00 58 00 4e 00 31 00 36 00 58 00 4e 00 32 00 37 00 58 00 4e 00 34 00 35 00 58 00 58 00 58 00 4e 00 34 00 30 00 58 00 4e 00 34 00 32 00 58 00 58 00 58 00 58 00 58 00 4e 00 46 00 36 00 58 00 4e}  //weight: 1, accuracy: High
        $x_1_4 = {58 00 4e 00 34 00 44 00 58 00 58 00 58 00 4e 00 34 00 30 00 58 00 58 00 4e 00 31 00 30 00 58 00 58 00 58 00 58 00 4e 00 33 00 30 00 4e 00 38 00 37 00 58 00 58 00 58 00 4e 00 33 00 36 00 4e 00 32 00 37 00 4e 00 33 00 37 00 4e 00 32 00 37 00 4e 00 45 00 32 00 4e 00 30 00 36 00 58 00 58 00 4e 00 30 00 32 00 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAU_2147848388_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAU!MTB"
        threat_id = "2147848388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 11 06 07 8e 69 5d 13 07 11 06 08 6f ?? 00 00 0a 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? 00 00 0a 13 0a 02 07 11 06 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 11 0c 20 ?? ?? 00 00 5d d2 9c 00 11 06 17 59 13 06 11 06 16 fe 04 16 fe 01 13 0d 11 0d 2d a1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAW_2147848397_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAW!MTB"
        threat_id = "2147848397"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 11 06 07 8e 69 5d 13 07 11 06 08 6f ?? 00 00 0a 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? 00 00 0a 13 0a 02 07 11 06 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 02 11 0c 28 ?? 00 00 06 9c 00 11 06 17 59 13 06 11 06 16 fe 04 16 fe 01 13 0d 11 0d 2d a2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAN_2147848444_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAN!MTB"
        threat_id = "2147848444"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 13 11 14 9a 13 0b 11 09 11 0b 6f ?? 00 00 0a 11 14 17 58 13 14 11 14 11 13 8e 69 32 e2}  //weight: 1, accuracy: Low
        $x_1_2 = "System.Environment" wide //weight: 1
        $x_1_3 = "Exit" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAX_2147848447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAX!MTB"
        threat_id = "2147848447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 07 11 06 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 11 0e}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAY_2147848452_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAY!MTB"
        threat_id = "2147848452"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {03 04 61 05 59 20 00 ?? 00 00 58 2a}  //weight: 5, accuracy: Low
        $x_5_2 = {03 8e 69 0a 03 04 17 58 06 5d 91 2a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAZ_2147848457_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAZ!MTB"
        threat_id = "2147848457"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 11 05 08 8e 69 5d 13 09 11 05 09 6f ?? 00 00 0a 5d 13 0a 08 11 09 91 13 0b 09 11 0a 6f ?? 00 00 0a 13 0c 02 08 11 05 28 ?? 00 00 06 13 0d 02 11 0b 11 0c 11 0d 28 ?? 00 00 06 13 0e 08 11 09 02 11 0e 28 ?? 00 00 06 9c 11 05 17 59 13 05 00 11 05 16 fe 04 16 fe 01 13 0f 11 0f 2d a2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZB_2147848473_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZB!MTB"
        threat_id = "2147848473"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 06 2b 2b 11 06 09 5d 13 07 11 06 09 5b 13 08 08 11 07 11 08 6f ?? 00 00 0a 13 09 07 12 09 28 ?? 00 00 0a 6f ?? 00 00 0a 11 06 17 58 13 06 11 06 09 11 04 5a 32 cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZD_2147848511_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZD!MTB"
        threat_id = "2147848511"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 09 8e 69 17 da 13 08 16 13 09 2b 1a 11 04 09 11 09 9a 1f 10 28 ?? ?? 00 0a 86 6f ?? ?? 00 0a 00 11 09 17 d6 13 09 11 09 11 08 31 e0}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAR_2147848515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAR!MTB"
        threat_id = "2147848515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "F7Eyf5INInabrDFhHE.c16Ik02KSwLmqoBFDy" wide //weight: 1
        $x_1_2 = {41 00 41 00 00 05 42 00 42}  //weight: 1, accuracy: High
        $x_1_3 = "Liu" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAU_2147848516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAU!MTB"
        threat_id = "2147848516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 5d 13 09 07 09 5b 13 0a 08 11 09 11 0a 6f ?? 00 00 0a 13 0c 11 05 11 04 12 0c 28 ?? 00 00 0a 9c 11 04 17 58 13 04 07 17 58 0b 07 09 11 06 5a 32 cd}  //weight: 1, accuracy: Low
        $x_1_2 = {20 01 e8 00 00 8d 06 00 00 01 13 05 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZE_2147848521_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZE!MTB"
        threat_id = "2147848521"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0a 2b 28 06 09 5d 13 08 06 09 5b 13 09 08 11 08 11 09 6f ?? 00 00 0a 13 0c 11 05 12 0c 28 ?? 00 00 0a 6f ?? 00 00 0a 06 17 58 0a 06 09 11 06 5a fe 04 13 0a 11 0a 2d cb}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAZ_2147848522_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAZ!MTB"
        threat_id = "2147848522"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 16 13 06 2b 2e 00 11 06 09 5d 13 07 11 06 09 5b 13 08 08 11 07 11 08 6f ?? 00 00 0a 13 09 07 12 09 28 ?? 00 00 0a 6f ?? 00 00 0a 00 00 11 06 17 58 13 06 11 06 09 11 04 5a fe 04 13 0a 11 0a 2d c4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZF_2147848525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZF!MTB"
        threat_id = "2147848525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 05 2b 2e 00 11 05 09 5d 13 09 11 05 09 5b 13 0a 08 11 09 11 0a 6f ?? 00 00 0a 13 0b 07 12 0b 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 05 17 58 13 05 00 11 05 09 11 04 5a fe 04 13 0c 11 0c 2d c4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HAA_2147848629_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HAA!MTB"
        threat_id = "2147848629"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {18 2c 10 2b 10 2b 15 2b 1a 2b 1f 16 2c 03 26 de 26 2b 1e 2b fa 28 ?? 00 00 0a 2b e9 28 ?? 00 00 06 2b e4 6f ?? 00 00 0a 2b df 28 ?? 00 00 0a 2b da 0a 2b df}  //weight: 2, accuracy: Low
        $x_2_2 = {06 08 09 9c 07 17 58 0b 08 17 59 0c 16 2d d4 07 08 32 e0 06 2a 0a 38 ?? ff ff ff 06 2b bb 06 2b c4 0c 2b ca}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAZ_2147848639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAZ!MTB"
        threat_id = "2147848639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 1f 12 0a 28 ?? 00 00 0a 13 0b 2b 14 12 0a 28 ?? 00 00 0a 13 0b 2b 09 12 0a 28 ?? 00 00 0a 13 0b 07 11 0b 6f ?? 00 00 0a 11 09 17 58 13 09 11 09 09 32 aa}  //weight: 1, accuracy: Low
        $x_1_2 = "dK6q1iPPG" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAP_2147848641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAP!MTB"
        threat_id = "2147848641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 0a 0a 06 18 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 7e ?? 00 00 04 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 02 16 02 8e 69 6f ?? 00 00 0a 0b 2b 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZO_2147848655_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZO!MTB"
        threat_id = "2147848655"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 0b 2b 68 16 0c 2b 5b 16 0d 2b 4e 11 05 09 08 6f ?? 00 00 0a 13 0b 16 13 04 07}  //weight: 2, accuracy: Low
        $x_2_2 = {2b 1f 12 0b 28 ?? 00 00 0a 13 04 2b 14 12 0b 28 ?? 00 00 0a 13 04 2b 09 12 0b 28 ?? 00 00 0a 13 04 11 06 11 04 6f ?? 00 00 0a 09 17 58 0d 09 11 07 32 ad}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZQ_2147848661_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZQ!MTB"
        threat_id = "2147848661"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 0c 2b 5b 16 0d 2b 4e 11 05 09 08 6f ?? 00 00 0a 13 0c 16 13 04 07}  //weight: 2, accuracy: Low
        $x_2_2 = {2b 1f 12 0c 28 ?? 00 00 0a 13 04 2b 14 12 0c 28 ?? 00 00 0a 13 04 2b 09 12 0c 28 ?? 00 00 0a 13 04 11 06 11 04 6f ?? 00 00 0a 09 17 58 0d 09 11 07 32 ad}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAX_2147848720_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAX!MTB"
        threat_id = "2147848720"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {14 0a 38 26 00 00 00 00 28 ?? 00 00 0a 72 ?? 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 0a dd 06 00 00 00 26 dd 00 00 00 00 06 2c d7}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HAB_2147848721_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HAB!MTB"
        threat_id = "2147848721"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "UkzjrqQRxhZLk2E71Py5zSo8nOCwZmTNWs+zy2F9LRBX3O8IEcs7hWZ2bqaKZ46vJo0" ascii //weight: 1
        $x_1_2 = "XaSWDfQcylSbRt69E4r6I9QVXtE0MVzFMPPu3OGoihxBJdt+1GnYDnH6Sh0V77" ascii //weight: 1
        $x_1_3 = "suHB+ScuBcirRqHINViyhwDX4N1at4CX5dIo7NXcgS6KgEvlfNJnmV+24r/6bdkzY5UbXcRzYaXs" ascii //weight: 1
        $x_1_4 = "VaTSkHJq4CEkohISP3XYcUhqzW/qMLPgjMDvqEET/rEm1ntXl5jFzlnbYF0JTTHO8DEiWgIQVy" ascii //weight: 1
        $x_1_5 = "9uYKIsVjX32oEamTFVdzPmMbQyDD5k4nQttYYDSRr7CX5+158oqK5URNkjM+0rrqJdLWNLpDyXtu6BwDQCcXEUtHE1NGGxk7KlEe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNT_2147848732_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNT!MTB"
        threat_id = "2147848732"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 7c 05 00 0a 13 06 11 06 07 16 07 8e 69 6f ?? ?? 00 0a 11 06 6f ?? ?? 00 0a 11 04 6f ?? ?? 00 0a 28 ?? ?? 00 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "MG.Office.Editor.frmDebug.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAX_2147848743_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAX!MTB"
        threat_id = "2147848743"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 03 02 7b ?? 00 00 04 8e 69 5d 91 02 7b ?? 00 00 04 03 91 61 d2 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEC_2147848759_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEC!MTB"
        threat_id = "2147848759"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 11 04 6f ?? 01 00 0a 13 06 11 05 11 06 d0 ?? 00 00 02 28 ?? 00 00 0a 6f ?? 01 00 0a 74 ?? 00 00 02 0d de 0c}  //weight: 1, accuracy: Low
        $x_1_2 = "b4bd29a83a99" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAA_2147848760_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAA!MTB"
        threat_id = "2147848760"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 13 07 2b 61 16 13 08 2b 51 08 11 08 11 07 6f ?? 01 00 0a 13 09 16 13 0a 11 06}  //weight: 2, accuracy: Low
        $x_2_2 = {2b 1f 12 09 28 ?? 01 00 0a 13 0a 2b 14 12 09 28 ?? 01 00 0a 13 0a 2b 09 12 09 28 ?? 01 00 0a 13 0a 07 11 0a 6f ?? 01 00 0a 11 08 17 58 13 08 11 08 09 32 aa}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZI_2147848762_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZI!MTB"
        threat_id = "2147848762"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0b 07 28 ?? 00 00 0a 02 6f ?? 00 00 0a 6f ?? 00 00 0a 0c 06 08 6f ?? 00 00 0a 00 06 18 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 7e ?? ?? 00 04 16 7e ?? ?? 00 04 8e 69 6f ?? 00 00 0a 0d 2b 00 09 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZU_2147848824_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZU!MTB"
        threat_id = "2147848824"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 13 09 2b 7f 16 13 0a 2b 6f 08 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 13 0d 11 0d 72 02 11 00 70 28 ?? 00 00 0a 2d 1e 11 0d 72 06 11 00 70 28 ?? 00 00 0a 2d 1b 11 0d 72 0a 11 00 70 28 ?? 00 00 0a 2d 18 2b 1f 12 0b 28 ?? 00 00 0a 13 0c 2b 14 12 0b 28 ?? 00 00 0a 13 0c 2b 09 12 0b 28 ?? 00 00 0a 13 0c 07 11 0c 6f ?? 00 00 0a 11 0a 17 58 13 0a 11 0a 09 32 8c}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAB_2147848826_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAB!MTB"
        threat_id = "2147848826"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JLtqB?i9M9tL2FS32;dm+obKTUot_e0" wide //weight: 1
        $x_1_2 = "RWFsGHAR1iMEtzDW/Ae+XQ6lFzM1QUCb9folfCBCsDSeIRabe1" wide //weight: 1
        $x_1_3 = {74 00 58 00 62 00 38 00 6c 00 54 00 4e 00 33 00 53 00 30 00 4c 00 51 00 6c 00 4e 00 58 00 7a 00 4f 00 54 00 75 00 67 00 63 00 6f 00 2b 00 76 00 39 00 65 00 31 00 51 00 73 00 78 00 7a 00 52 00 6a 00 58 00 44 00 61 00 38 00 4d 00 42 00 4b}  //weight: 1, accuracy: High
        $x_1_4 = {44 00 6f 00 6c 00 4c 00 74 00 68 00 52 00 53 00 55 00 53 00 31 00 6b 00 30 00 50 00 34 00 73 00 4c 00 4c 00 51 00 48 00 61 00 66 00 44 00 7a 00 4f 00 47 00 62 00 79 00 4d 00 42 00 67 00 4b 00 30 00 5a 00 56 00 31 00 44 00 4b 00 33 00 51 00 6d 00 62 00 44 00 42 00 44 00 75 00 54 00 70 00 50 00 69 00 30 00 51}  //weight: 1, accuracy: High
        $x_1_5 = {48 00 74 00 73 00 57 00 68 00 6f 00 30 00 34 00 5a 00 75 00 4b 00 4a 00 4c 00 75 00 69 00 73 00 6b 00 57 00 36 00 68 00 6c 00 51 00 48 00 37 00 33 00 33 00 69 00 75 00 6b 00 49 00 47 00 33 00 34 00 79 00 66 00 34 00 46 00 46 00 53 00 48 00 30 00 52 00 52 00 75 00 6c 00 37 00 4f 00 61 00 4e 00 57 00 48 00 59}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZA_2147848850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZA!MTB"
        threat_id = "2147848850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 09 11 04 28 ?? 00 00 06 13 06 08 12 06 28 ?? 00 00 0a 6f}  //weight: 3, accuracy: Low
        $x_1_2 = "memory_allocator.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZM_2147848851_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZM!MTB"
        threat_id = "2147848851"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 2e 00 00 0a 0a 06 28 ?? 00 00 0a 02 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 7e ?? 00 00 04 07 6f ?? 00 00 0a 00 7e ?? 00 00 04 18 6f ?? 00 00 0a 00 28 ?? 00 00 06 0c 2b 00 08 2a}  //weight: 2, accuracy: Low
        $x_2_2 = {04 8e 69 6f ?? 00 00 0a 0a 2b 00 06 2a 21 00 7e ?? 00 00 04 6f ?? 00 00 0a 7e ?? 00 00 04 16 7e}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOA_2147848854_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOA!MTB"
        threat_id = "2147848854"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 04 00 00 0a 73 03 04 00 06 28 04 04 00 06 75 01 00 00 1b 6f 05 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOE_2147848855_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOE!MTB"
        threat_id = "2147848855"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 0b 28 7e 00 00 06 17 8d 39 00 00 01 25 16 1f 5c 9d 6f ?? ?? ?? 0a 28 0d 00 00 2b 0c 1b 13 08 38 7c ff ff ff 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 08 14 14 1e}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOF_2147848856_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOF!MTB"
        threat_id = "2147848856"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 40 01 00 0a 02 28 ?? ?? ?? 0a 02 7e 40 00 00 04 20 24 12 00 00 28 37 01 00 06 02 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 02 7b 3a 00 00 04 02 28 42 01 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOG_2147848857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOG!MTB"
        threat_id = "2147848857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 7b 00 00 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 20 a7 01 00 00 20 9d 01 00 00 28 ?? ?? ?? 2b 74 0c 00 00 02 28 ?? ?? ?? 06 6f ?? ?? ?? 06 80 05 00 00 04 2a d0 8c 00 00 06 26 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOH_2147848858_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOH!MTB"
        threat_id = "2147848858"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 11 08 28 48 00 00 06 72 c7 03 00 70 72 cb 03 00 70 28 54 00 00 06 72 cf 03 00 70 72 d3 03 00 70 6f 60 00 00 0a 13 08 38 e4 fe ff ff 00 02 16 28 5a 00 00 06 20 00 00 00 00 28 51 00 00 06 39 90 fd ff ff}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOO_2147848860_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOO!MTB"
        threat_id = "2147848860"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0b 00 07 18 6f ?? ?? ?? 0a 00 07 18 6f ?? ?? ?? 0a 00 07 06 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 03 16 03 8e 69 6f ?? ?? ?? 0a 0c de 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOP_2147848877_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOP!MTB"
        threat_id = "2147848877"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 06 7b 7e 00 00 04 2d 11 20 65 28 e2 0f 28 ?? ?? ?? 2b 28 ?? ?? ?? 06 2b 01 17 6f ?? ?? ?? 06 20 20 3b ae 53 38 e8 fe ff ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSOQ_2147848878_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSOQ!MTB"
        threat_id = "2147848878"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {8d 46 00 00 01 25 d0 1e 01 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 1f 10 8d 46 00 00 01 25 d0 1f 01 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 6f a4 00 00 0a 17 73 ?? ?? ?? 0a 0c 08 02 16 02 8e 69 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABB_2147848919_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABB!MTB"
        threat_id = "2147848919"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 72 1d 08 00 70 7d ?? 01 00 04 06 06 7b ?? 01 00 04 28 ?? 00 00 2b 28 ?? 00 00 2b 73 ?? 00 00 0a 7d ?? 01 00 04 16 06 7b ?? 01 00 04 6f ?? 00 00 0a 28 ?? 00 00 0a 7e ?? 01 00 04 25 2d 17 26 7e ?? 01 00 04 fe ?? ?? 00 00 06 73 ?? 00 00 0a 25 80 ?? 01 00 04 28 ?? 00 00 2b 06 fe ?? ?? 00 00 06 73 ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0b 72 22 c0 08 70 28 ?? 00 00 0a 72 58 c0 08 70 20 00 01 00 00 14 14 17 8d ?? 00 00 01 25 16 07 a2 6f ?? 00 00 0a 75 ?? 00 00 01 0c 08 6f ?? 00 00 0a 16 9a 6f ?? 00 00 0a 18 9a 0d 09 16 8c ?? 00 00 01 02 7b ?? 00 00 04 13 04 11 04}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAC_2147848921_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAC!MTB"
        threat_id = "2147848921"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 09 8e 69 17 da 13 08 16 13 09 38 ?? 00 00 00 11 04 11 09 09 11 09 9a 1f 10 7e ?? 01 00 04 28 ?? 02 00 06 6f ?? 00 00 0a 00 11 09 17 d6 13 09 11 09 11 08 3e}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABC_2147848924_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABC!MTB"
        threat_id = "2147848924"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {06 07 8e 69 08 16 08 8e 69 28 ?? 00 00 0a 03 07 28 ?? 00 00 06 0d 09 6f ?? 00 00 0a 13 04 11 04 08 16 08 8e 69 6f ?? 00 00 0a 13 05 28 ?? 00 00 0a 11 05 6f ?? 00 00 0a 13 06 dd ?? 00 00 00 11 04 39 ?? 00 00 00 11 04 6f ?? 00 00 0a dc}  //weight: 4, accuracy: Low
        $x_1_2 = "ThisIsASecretKey" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABD_2147848930_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABD!MTB"
        threat_id = "2147848930"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 0a 2b 6f 08 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 13 0d 11 0d 72 1e 11 00 70 28 ?? 00 00 0a 2d 1e 11 0d 72 22 11 00 70 28 ?? 00 00 0a 2d 1b 11 0d 72 26 11 00 70 28 ?? 00 00 0a 2d 18 2b 1f 12 0b 28 ?? 00 00 0a 13 0c 2b 14 12 0b 28 ?? 00 00 0a 13 0c 2b 09 12 0b 28 ?? 00 00 0a 13 0c 07 11 0c 6f ?? 00 00 0a 11 0a 17 58 13 0a 11 0a 09 32 8c}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABF_2147848934_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABF!MTB"
        threat_id = "2147848934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 13 0e 11 0e 13 0d 11 0d 72 b5 09 00 70 28 ?? 00 00 0a 2d 1e 11 0d 72 b9 09 00 70 28 ?? 00 00 0a 2d 1b 11 0d 72 bd 09 00 70 28 ?? 00 00 0a 2d 18 2b 21 12 0b 28 ?? 00 00 0a 13 0c 2b 16 12 0b 28 ?? 00 00 0a 13 0c 2b 0b 12 0b 28 ?? 00 00 0a 13 0c 2b 00 07 11 0c 6f ?? 00 00 0a 00 00 11 0a 17 58 13 0a 11 0a 09 fe 04 13 0f 11 0f}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAE_2147848989_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAE!MTB"
        threat_id = "2147848989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {04 16 06 7b ?? 00 00 04 6f ?? 00 00 0a 28 ?? 00 00 0a 7e ?? 00 00 04 25 2d 17 26 7e ?? 00 00 04 fe ?? ?? 00 00 06 73 ?? 00 00 0a 25 80 ?? 00 00 04 28 ?? 00 00 2b 06 fe ?? ?? 00 00 06 73 ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0b 72}  //weight: 3, accuracy: Low
        $x_2_2 = {20 00 01 00 00 14 14 17 8d ?? 00 00 01 25 16 07 a2 6f}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEH_2147848990_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEH!MTB"
        threat_id = "2147848990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {8e 69 6a 5d d4 91 08 11 13 08 8e 69 6a 5d d4 91 61 07 11 13 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 13 14 07 11 13 07 8e 69 6a 5d d4 11 14 20 00 01 00 00 5d}  //weight: 1, accuracy: High
        $x_1_2 = {8e 69 6a 5d d4 91 09 07 09 8e 69 6a 5d d4 91 61 06 07 17 6a 58 06 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 13 08 07 06 8e 69 6a 5d 13 09 11 08 20 00 01 00 00 5d 13 0a 06 11 09 d4 11 0a d2 9c 07}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEH_2147848990_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEH!MTB"
        threat_id = "2147848990"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4N(5K(90(00(03(00(00(00(04(00(" wide //weight: 1
        $x_1_2 = "(1P(LK(0O(00(L4(09(MN(21(L8(01(4" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAF_2147848991_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAF!MTB"
        threat_id = "2147848991"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 07 8e 69 17 da 0d 16 13 04 38 ?? 00 00 00 08 07 11 04 9a 1f 10 7e ?? 01 00 04 28 ?? 02 00 06 6f ?? 00 00 0a 11 04 17 d6 13 04 11 04 09 3e}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZJ_2147849000_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZJ!MTB"
        threat_id = "2147849000"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {72 0d 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 1d 2d 03 26 de 06 0a 2b fb 26 de 00 06 2c d7}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAG_2147849070_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAG!MTB"
        threat_id = "2147849070"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 11 0a 11 09 6f ?? 01 00 0a 13 0b 16 13 0c 11 05 11 08 9a 13 0e 11 0e 13 0d 11 0d 72 ?? 06 00 70 28 ?? 01 00 0a 2d 1e 11 0d 72 ?? 06 00 70 28 ?? 01 00 0a 2d 1b 11 0d 72 ?? 06 00 70 28 ?? 01 00 0a 2d 18 2b 21 12 0b 28}  //weight: 4, accuracy: Low
        $x_1_2 = {13 0c 2b 00 07 11 0c 6f ?? 01 00 0a 00 00 11 0a 17 58 13 0a 11 0a 09 fe 04 13 0f 11 0f 3a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABR_2147849073_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABR!MTB"
        threat_id = "2147849073"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 0b 11 0a 6f ?? 00 00 0a 13 0c 16 13 0d 11 05 11 09 9a 13 0f 11 0f 13 0e 11 0e 72 e5 09 00 70 28 ?? 00 00 0a 2d 1e 11 0e 72 e9 09 00 70 28 ?? 00 00 0a 2d 1b 11 0e 72 ed 09 00 70 28 ?? 00 00 0a 2d 18 2b 21 12 0c 28 ?? 00 00 0a 13 0d 2b 16 12 0c 28 ?? 00 00 0a 13 0d 2b 0b 12 0c 28 ?? 00 00 0a 13 0d 2b 00 07 11 0d 6f ?? 00 00 0a 00 00 11 0b 17 58 13 0b 11 0b 09 fe 04 13 10 11 10}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAD_2147849085_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAD!MTB"
        threat_id = "2147849085"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0b 07 6f ?? 00 00 0a 16 fe 01 0c 08 2c 0a 00 07 06 6f ?? 00 00 0a 00 00 07 6f ?? 00 00 0a 00 07 6f ?? 00 00 0a 0d 2b 00 09 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAI_2147849086_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAI!MTB"
        threat_id = "2147849086"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {2d 16 2b 1c 12 13 28 ?? 00 00 0a 0d 2b 12 12 13 28 ?? 00 00 0a 0d 2b 08 12 13 28 ?? 00 00 0a 0d 11 06 09 6f ?? 00 00 0a 08 17 58 0c 08 11 08 fe 04 13 0e 11 0e 3a}  //weight: 4, accuracy: Low
        $x_1_2 = {11 04 08 07 6f ?? 00 00 0a 13 13 16 0d 11 0a 06 9a 13 0d 11 0d 13 05 11 05}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSFV_2147849088_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSFV!MTB"
        threat_id = "2147849088"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 7f 00 00 70 0a 06 28 ?? ?? ?? 0a 25 26 0b 28 ?? ?? ?? 0a 25 26 07 16 07 8e 69 6f ?? ?? ?? 0a 25 26 0a 28 ?? ?? ?? 0a 25 26 06 6f ?? ?? ?? 0a 25 26 0c}  //weight: 5, accuracy: Low
        $x_1_2 = "IPTV Tools" ascii //weight: 1
        $x_1_3 = "AuthenticationMode" ascii //weight: 1
        $x_1_4 = "IEnumerable" ascii //weight: 1
        $x_1_5 = "HashAlgorithm" ascii //weight: 1
        $x_1_6 = "SymmetricAlgorithm" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSFZ_2147849090_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSFZ!MTB"
        threat_id = "2147849090"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 28 75 00 00 0a 0a 06 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 06 6f ?? ?? ?? 0a 0b 07 02 16 02 8e 69 6f ?? ?? ?? 0a 0c 2b 00 08 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGE_2147849091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGE!MTB"
        threat_id = "2147849091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {28 2c 00 00 06 11 0a 20 bd 2b ba 0e 5a 20 b7 6c 9a 9e 61 38 0f dd ff ff 28 66 01 00 06 28 35 00 00 06 72 05 04 00 70 72 09 04 00 70 28 36 00 00 06 72 11 04 00 70 72 15 04 00 70 28 36 00 00 06 72 19 04 00 70 72 f5 00 00 70 28 36 00 00 06 0b 11 0a}  //weight: 5, accuracy: High
        $x_1_2 = "IEnumerator" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGG_2147849092_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGG!MTB"
        threat_id = "2147849092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 cb 00 00 0a 13 04 11 04 17 6f ?? ?? ?? 0a 11 04 17 6f ?? ?? ?? 0a 11 04 0b 07 03 06 6f ?? ?? ?? 0a 0c 28 ?? ?? ?? 0a 08 02 16 02 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0d 09 1f 10 6f ?? ?? ?? 0a 13 05 de 06}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGL_2147849093_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGL!MTB"
        threat_id = "2147849093"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 28 4e 00 00 0a 0a 06 72 5b 03 00 70 28 0d 00 00 06 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 06 18 6f ?? ?? ?? 0a 00 06 6f ?? ?? ?? 0a 0b 07 02 16 02 8e 69 6f ?? ?? ?? 0a 0c 2b 00 08 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGM_2147849094_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGM!MTB"
        threat_id = "2147849094"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 28 02 00 00 0a 0a 28 ?? ?? ?? 0a 0b 07 28 ?? ?? ?? 0a 03 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 1e 5b 8d 08 00 00 01 0c 06 8e 69 08 8e 69 59 8d 08 00 00 01 0d 06 08 08 8e 69 28 ?? ?? ?? 0a 06 08 8e 69 09 16 09 8e 69 28 ?? ?? ?? 0a 07 08 6f ?? ?? ?? 0a 07 17 6f ?? ?? ?? 0a 07 07 6f ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 09 73 ?? ?? ?? 0a 13 05}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGP_2147849095_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGP!MTB"
        threat_id = "2147849095"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 24 3b 02 70 18 18 8d 16 00 00 01 25 16 72 34 3b 02 70 a2 25 17 72 38 3b 02 70 a2 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 72 24 3b 02 70 18 18 8d 16 00 00 01 25 16 72 3c 3b 02 70 a2 25 17 72 40 3b 02 70 a2 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 72 24 3b 02 70 18 18 8d 16 00 00 01 25 16 72 48 3b 02 70 a2 25 17 72 4c 3b 02 70 a2 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGQ_2147849096_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGQ!MTB"
        threat_id = "2147849096"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {20 00 0c 00 00 28 16 00 00 0a 7e 05 00 00 04 72 03 00 00 70 6f 17 00 00 0a 80 ?? ?? ?? 04 16 0a 2b 19 7e ?? ?? ?? 04 06 7e ?? ?? ?? 04 06 91 20 34 03 00 00 59 d2 9c 06 17 58 0a 06 7e ?? ?? ?? 04 8e 69 32 dd 7e ?? ?? ?? 04 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGS_2147849097_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGS!MTB"
        threat_id = "2147849097"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {6f 1f 00 00 0a 26 07 08 6f ?? ?? ?? 06 11 08 ?? ?? ?? ?? ?? 5a 20 ba e4 d8 4f 61 38 4d ff ff ff 06 6f ?? ?? ?? 0a 13 07 20 81 6e fd d6 38 3b ff ff ff 09 11 07 d2 6e 1e 11 06 5a 1f 3f 5f 62 60 0d 11 08 20 46 0b 49 e7 5a 20 1a 0d ab de 61 38 19 ff ff ff 09 69 8d 76 00 00 01 25 17 73 ?? ?? ?? 0a 13 04 06 6f ?? ?? ?? 0a 1f 0d 6a 59 13 05 07 06 11 04 11 05 09 6f ?? ?? ?? 06 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAH_2147849136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAH!MTB"
        threat_id = "2147849136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {04 08 07 6f ?? 02 00 0a 28 ?? 02 00 0a 13 04 28 ?? 01 00 0a 11 04 16 11 04 8e 69 6f ?? 02 00 0a 28 0d 02 00 0a 13 05 7e ?? 00 00 04 2c 17 7e ?? 00 00 04 02 8c 91 00 00 01 11 05 6f ?? 00 00 0a de 03 26 de 00 11 05 13 06 de 06}  //weight: 4, accuracy: Low
        $x_1_2 = "CreateDecryptor" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAJ_2147849139_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAJ!MTB"
        threat_id = "2147849139"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2d 16 2b 1c 12 12 28 ?? 01 00 0a 0d 2b 12 12 12 28 ?? 01 00 0a 0d 2b 08 12 12 28 ?? 01 00 0a 0d 11 07 09 6f ?? 00 00 0a 08 17 58 0c 08 11 08 fe 04 13 0e 11 0e 3a}  //weight: 3, accuracy: Low
        $x_2_2 = {11 04 08 07 6f ?? 01 00 0a 13 12 16 0d 11 0a 06 9a 13 0d 11 0d 13 05 11 05 20}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLN_2147849144_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLN!MTB"
        threat_id = "2147849144"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 6f 26 00 00 0a 09 16 09 8e 69 6f ?? 00 00 0a 13 04 de 38 07 2b be 28 ?? 00 00 0a 2b b9 6f ?? 00 00 0a 2b b9}  //weight: 5, accuracy: Low
        $x_1_2 = "Rkikc.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABT_2147849146_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABT!MTB"
        threat_id = "2147849146"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 72 b3 02 00 70 28 ?? 00 00 0a 13 0d 11 0d 2c 0d 00 12 0b 28 ?? 00 00 0a 13 0c 00 2b 42 11 05 11 08 9a 72 b7 02 00 70 28 ?? 00 00 0a 13 0e 11 0e 2c 0d 00 12 0b 28 ?? 00 00 0a 13 0c 00 2b 20 11 05 11 08 9a 72 bb 02 00 70 28 ?? 00 00 0a 13 0f 11 0f 2c 0b 00 12 0b 28 ?? 00 00 0a 13 0c 00 07 11 0c 6f ?? 00 00 0a 00 00 11 0a 17 58 13 0a 11 0a 09 fe 04 13 10 11 10 3a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MAAM_2147849168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MAAM!MTB"
        threat_id = "2147849168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 04 13 05 11 05 17 58 13 04 11 04 15 2c d3 16 2d f4}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEI_2147849169_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEI!MTB"
        threat_id = "2147849169"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$7fe901cf-314d-42c6-a78f-86a27dd556ec" ascii //weight: 1
        $x_1_2 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEI_2147849169_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEI!MTB"
        threat_id = "2147849169"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 8e 69 5d 13 08 11 04 08 6f ?? 00 00 0a 5d 13 09 07 11 08 91 13 0a 08 11 09 6f ?? 00 00 0a 13 0b 02 07 11 04 28 ?? 00 00 06 13 0c 02 11 0a 11 0b 11 0c}  //weight: 1, accuracy: Low
        $x_1_2 = "E7QCY74CF884AZD4A8Z9S5" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABV_2147849170_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABV!MTB"
        threat_id = "2147849170"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 09 08 6f ?? 00 00 0a 13 0d 16 13 04 11 06 06 9a 20 6d 5f 9d a1 28 ?? 00 00 06 28 ?? 00 00 0a 2c 0b 12 0d 28 ?? 00 00 0a 13 04 2b 3e 11 06 06 9a 20 65 5f 9d a1 28 ?? 00 00 06 28 ?? 00 00 0a 2c 0b 12 0d 28 ?? 00 00 0a 13 04 2b 1e 11 06 06 9a 20 5d 5f 9d a1 28 ?? 00 00 06 28 ?? 00 00 0a 2c 09 12 0d 28 ?? 00 00 0a 13 04 11 07 11 04 6f ?? 00 00 0a 09 17 58 0d 09 11 08 3f}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAK_2147849173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAK!MTB"
        threat_id = "2147849173"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 72 ?? 0e 00 70 28 ?? 00 00 0a 13 0d 11 0d 2c 0d 00 12 0b 28 ?? 00 00 0a 13 0c 00 2b 42 11 05 11 08 9a 72 ?? 0e 00 70 28 ?? 00 00 0a 13 0e 11 0e 2c 0d 00 12 0b 28 ?? 00 00 0a 13 0c 00 2b 20 11 05 11 08 9a 72 ?? 0e 00 70 28 ?? 00 00 0a 13 0f 11 0f 2c 0b 00 12 0b 28 ?? 00 00 0a 13 0c 00 07 11 0c 6f ?? 00 00 0a 00 00 11 0a 17 58 13 0a 11 0a 09 fe 04 13 10 11 10 3a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABJ_2147849179_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABJ!MTB"
        threat_id = "2147849179"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {13 05 1a 8d ?? 00 00 01 25 16 11 04 a2 25 17 7e ?? 00 00 0a a2 25 18 07 a2 25 19 17 8c ?? 00 00 01 a2 13 06 11 05 08 6f ?? 00 00 0a 09 20 00 01 00 00 14 14}  //weight: 2, accuracy: Low
        $x_1_2 = "b4d7611d-881d-41dd-be7b-460a550eedac" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABN_2147849182_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABN!MTB"
        threat_id = "2147849182"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "QuanLyVatLieuXayDung" wide //weight: 2
        $x_1_2 = "a9bf8cb8-a3a4-4017-9372-1e81439a88c1" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEL_2147849184_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEL!MTB"
        threat_id = "2147849184"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 6f 08 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 72 b3 02 00 70 28 ?? 00 00 0a 2c 0b 12 0b 28 ?? 00 00 0a 13 0c 2b 36 11 05 11 08 9a 72 b7 02 00 70 28 ?? 00 00 0a 2c 0b 12 0b 28 ?? 00 00 0a 13 0c 2b 1a 11 05 11 08 9a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAL_2147849256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAL!MTB"
        threat_id = "2147849256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0d 08 8e 69 17 da 13 04 16 13 05 2b 1a 09 11 05 08 11 05 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 11 05 17 d6 13 05 11 05 11 04 31 e0}  //weight: 4, accuracy: Low
        $x_1_2 = {31 00 36 00 28 00 58 00 58 00 28 00 58 00 58 00 28 00 58 00 4b 00 28 00 58 00 58 00 28 00 58 00 32 00 28 00 37 00 4c 00 28 00 58 00 37 00 28 00 58 00 58 00 28 00 58 00 58 00 28 00 58 00 34 00 28 00 58 00 32 00 28 00 32 00 38 00 28 00 58 00 37}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXJK_2147849258_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXJK!MTB"
        threat_id = "2147849258"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 13 08 16 13 09 11 08 12 09 28 ?? ?? ?? ?? 00 08 07 11 07 18 6f ?? ?? ?? ?? 1f 10 28 ?? ?? ?? ?? 6f ?? ?? ?? ?? 00 de 0d 11 09 2c 08 11 08 28 ?? ?? ?? ?? 00 dc 00 11 07 18 58 13 07 11 07 07 6f ?? ?? ?? ?? fe 04 13 0a 11 0a 2d b2}  //weight: 1, accuracy: Low
        $x_1_2 = "Shozbxyxpoj.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JL_2147849265_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JL!MTB"
        threat_id = "2147849265"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {57 95 a2 29 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 68 00 00 00 1c 00 00 00 8c 05 00 00 15 0c}  //weight: 2, accuracy: High
        $x_2_2 = "Shrmota_Hyga.My" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAM_2147849272_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAM!MTB"
        threat_id = "2147849272"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {38 00 36 00 36 00 33 00 36 00 32 00 38 00 37 00 39 00 42 00 42 00 36 00 35 00 36 00 34 00 37 00 34 00 39 00 44 00 38 00 41 00 31 00 37 00 43 00 45 00 39 00 42 00 32 00 34 00 33 00 39 00 32 00 42}  //weight: 1, accuracy: High
        $x_1_2 = {32 00 43 00 32 00 39 00 43 00 39 00 42 00 35 00 41 00 34 00 34 00 33 00 46 00 35 00 46 00 44 00 41 00 44 00 43 00 36 00 43 00 44 00 35 00 34 00 44 00 45 00 31 00 39 00 41 00 44 00 42 00 38 00 33 00 39 00 38 00 39 00 39 00 39 00 39 00 38 00 42 00 31 00 34 00 32 00 31 00 34}  //weight: 1, accuracy: High
        $x_1_3 = {37 00 42 00 33 00 41 00 31 00 35 00 31 00 36 00 39 00 35 00 44 00 41 00 44 00 36 00 43 00 39 00 38 00 34 00 2d 00 45 00 36 00 43 00 32 00 44 00 37 00 33 00 45 00 38 00 36 00 33 00 45 00 37 00 35 00 46 00 45 00 44 00 36 00 36 00 42 00 41 00 41 00 37}  //weight: 1, accuracy: High
        $x_1_4 = {36 00 39 00 41 00 32 00 38 00 44 00 2d 00 44 00 43 00 39 00 42 00 44 00 45 00 44 00 33 00 2d 00 39 00 31 00 42 00 46 00 38 00 32 00 43 00 46 00 31 00 46 00 37 00 43 00 34 00 46 00 45 00 43 00 41}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACC_2147849276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACC!MTB"
        threat_id = "2147849276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {08 11 09 11 08 6f ?? 00 00 0a 13 0a 16 13 0b 11 05 11 07 9a 72 8d 02 00 70 28 ?? 00 00 0a 13 0c 11 0c 2c 0d 00 12 0a 28 ?? 00 00 0a 13 0b 00 2b 42 11 05 11 07 9a 72 91 02 00 70 28 ?? 00 00 0a 13 0d 11 0d 2c 0d 00 12 0a 28 ?? 00 00 0a 13 0b 00 2b 20 11 05 11 07 9a 72 95 02 00 70 28 ?? 00 00 0a 13 0e 11 0e 2c 0b 00 12 0a 28 ?? 00 00 0a 13 0b 00 07 11 0b 6f ?? 00 00 0a 00 00 11 09 17 58 13 09 11 09 09 fe 04 13 0f 11 0f 3a}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAN_2147849278_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAN!MTB"
        threat_id = "2147849278"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 11 0a 11 09 6f ?? 00 00 0a 13 0b 16 13 0c 11 06 11 08 9a 72 ?? 11 00 70 28 ?? 00 00 0a 13 0d 11 0d 2c 0d 00 12 0b 28 ?? 00 00 0a 13 0c 00 2b 42 11 06 11 08 9a 72 ?? 03 00 70 28 ?? 00 00 0a 13 0e 11 0e 2c 0d 00 12 0b 28 ?? 00 00 0a 13 0c 00 2b 20 11 06 11 08 9a 72 ?? 0f 00 70 28 ?? 00 00 0a 13 0f 11 0f 2c 0b 00 12 0b 28 ?? 00 00 0a 13 0c 00 08 11 0c 6f ?? 01 00 0a 00 00 11 0a 17 58 13 0a 11 0a 11 04 fe 04 13 10 11 10 3a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACD_2147849282_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACD!MTB"
        threat_id = "2147849282"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 02 16 04 8e 69 6f ?? 00 00 0a 0a 06 0b 2b 00 07 2a}  //weight: 2, accuracy: Low
        $x_1_2 = "bcdefgmnopqrstuvwxyzFG" wide //weight: 1
        $x_1_3 = "DataBasePracticalJob" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAO_2147849286_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAO!MTB"
        threat_id = "2147849286"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 09 11 08 6f ?? 00 00 0a 13 0a 16 13 0b 11 05 11 07 9a 72 ?? 02 00 70 28 ?? 00 00 0a 13 0c 11 0c 2c 0d 00 12 0a 28 ?? 00 00 0a 13 0b 00 2b 42 11 05 11 07 9a 72 ?? 02 00 70 28 ?? 00 00 0a 13 0d 11 0d 2c 0d 00 12 0a 28 ?? 00 00 0a 13 0b 00 2b 20 11 05 11 07 9a 72 ?? 02 00 70 28 ?? 00 00 0a 13 0e 11 0e 2c 0b 00 12 0a 28 ?? 00 00 0a 13 0b 00 07 11 0b 6f ?? 00 00 0a 00 00 11 09 17 58 13 09 11 09 09 fe 04 13 0f 11 0f 3a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACE_2147849291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACE!MTB"
        threat_id = "2147849291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 09 08 6f ?? 00 00 0a 13 11 16 13 04 11 06 07 9a 20 44 55 13 ce 28 ?? 00 00 06 28 ?? 00 00 0a 13 0b 11 0b 2c 0b 12 11 28 ?? 00 00 0a 13 04 2b 46 11 06 07 9a 20 4c 55 13 ce 28 ?? 00 00 06 28 ?? 00 00 0a 13 0c 11 0c 2c 0b 12 11 28 ?? 00 00 0a 13 04 2b 22 11 06 07 9a 20 54 55 13 ce 28 ?? 00 00 06 28 ?? 00 00 0a 13 0d 11 0d 2c 09 12 11 28 ?? 00 00 0a 13 04 11 07 11 04 6f ?? 00 00 0a 09 17 58 0d 09 11 08 fe 04 13 0e 11 0e 3a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAP_2147849320_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAP!MTB"
        threat_id = "2147849320"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 04 07 8e 69 5d 07 11 04 72 ?? 3e 00 70 28 ?? 03 00 06 d2 9c 00 11 04 15 58 13 04 11 04 16 fe 04 16 fe 01 13 05 11 05 2d d4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAQ_2147849334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAQ!MTB"
        threat_id = "2147849334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 04 09 6f ?? 00 00 0a 11 04 18 6f ?? 00 00 0a 11 04 6f ?? 00 00 0a 07 16 07 8e 69 6f ?? 00 00 0a 13 05}  //weight: 3, accuracy: Low
        $x_2_2 = "5898C2YE5S4B4PBB8E4C45" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACI_2147849355_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACI!MTB"
        threat_id = "2147849355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 13 06 2b 2e 11 0a 09 11 05 58 11 04 11 06 58 6f ?? 00 00 0a 13 12 12 12 28 ?? 00 00 0a 13 0c 11 09 11 07 11 0c 9c 11 07 17 58 13 07 11 06 17 58 13 06 11 06 17 fe 04 13 0d 11 0d 2d c7}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSQD_2147849362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSQD!MTB"
        threat_id = "2147849362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 61 00 00 0a 0a 06 72 aa 05 00 70 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 0b 07 6f ?? ?? ?? 0a 0c 08 2c 24 00 07 6f ?? ?? ?? 0a 17 6f 65 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AABS_2147849369_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AABS!MTB"
        threat_id = "2147849369"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "QuanLyInternet" wide //weight: 1
        $x_1_2 = "dd15d8ab-866a-46d6-bb7f-81fd012b1538" ascii //weight: 1
        $x_1_3 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAR_2147849422_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAR!MTB"
        threat_id = "2147849422"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 09 8e 69 17 da 13 08 16 13 09 2b 1c 11 04 11 09 09 11 09 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 00 11 09 17 d6 13 09 11 09 11 08 31 de}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAS_2147849442_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAS!MTB"
        threat_id = "2147849442"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 1e 11 18 11 1a 58 11 19 11 1b 58 6f ?? 00 00 0a 13 59 12 59 28 ?? 00 00 0a 13 22 11 1d 11 1c 11 22 9c 11 1c 17 58 13 1c 11 1b 17 58 13 1b 11 1b 17 fe 04 13 23 11 23 2d c6}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACP_2147849446_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACP!MTB"
        threat_id = "2147849446"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 1e 11 20 58 11 1f 11 21 58 6f ?? 00 00 0a 13 22 12 22 28 ?? 00 00 0a 13 23 07 09 11 23 9c 09 17 58 0d 00 11 21 17 58 13 21 11 21 17 fe 04 13 24 11 24 2d c9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAT_2147849449_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAT!MTB"
        threat_id = "2147849449"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 0a 2b 36 08 13 04 16 13 06 11 04 12 06 28 ?? 00 00 0a 08 09 06 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a de 0c 11 06 2c 07 11 04 28 ?? 00 00 0a dc 06 18 58 0a 06 09 6f ?? 00 00 0a fe 04 13 07 11 07 2d bb}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEP_2147849500_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEP!MTB"
        threat_id = "2147849500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 06 16 73 ?? 00 00 0a 0c 08 07 7e ?? 02 00 04 28 ?? 03 00 06 00 03 07 7e ?? 02 00 04}  //weight: 1, accuracy: Low
        $x_1_2 = "232a25efb947" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEP_2147849500_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEP!MTB"
        threat_id = "2147849500"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 07 5d 13 09 07 11 0c 5d 13 0f 07 17 58 11 07 5d 13 10 11 04 11 09 91 13 11 20 00 01 00 00 13 0a 11 11 11 08 11 0f 91 61 11 04 11 10 91 59 11 0a 58 11 0a 5d 13 12 11 04 11 09 11 12 d2 9c 07 17 58 0b 07 11 07 11 0b 17 58 5a fe 04 13 13 11 13 2d ac}  //weight: 1, accuracy: High
        $x_1_2 = {06 08 5d 13 05 06 11 08 5d 13 0b 06 17 58 08 5d 13 0c 07 11 05 91 13 0d 20 00 01 00 00 13 06 11 0d 11 04 11 0b 91 61 07 11 0c 91 59 11 06 58 11 06 5d 13 0e 07 11 05 11 0e d2 9c 06 17 58 0a 06 08 11 07 17 58 5a 32 b8}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBES_2147849516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBES!MTB"
        threat_id = "2147849516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0d 08 09 28 ?? 00 00 06 09 [0-16] 6f ?? 00 00 0a 09 13 04 de 1c}  //weight: 1, accuracy: Low
        $x_1_2 = "$a5e90af5-e00a-4b47-9c6e-b9ce2ac64af6" ascii //weight: 1
        $x_1_3 = "Fuck.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBES_2147849516_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBES!MTB"
        threat_id = "2147849516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4D-5A-9#-##-#3-##-##-##-#4-##-##-##-FF-FF" wide //weight: 1
        $x_1_2 = {46 00 2d 00 36 00 34 00 2d 00 36 00 35 00 2d 00 32 00 45 00 2d 00 23 00 44 00 2d 00 23 00 44 00 2d 00 23 00 41 00 2d 00 32 00 34 00 2d 00 23 00 23 00 2d 00 23 00 23 00 2d 00 23 00 23 00 2d 00 23 00 23 00 2d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACU_2147849541_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACU!MTB"
        threat_id = "2147849541"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 0d 2b 29 11 06 06 08 58 07 09 58 6f ?? 00 00 0a 13 0f 12 0f 28 ?? 00 00 0a 13 09 11 05 11 04 11 09 9c 11 04 17 58 13 04 09 17 58 0d 09 17 fe 04 13 0a 11 0a 2d cd}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACA_2147849622_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACA!MTB"
        threat_id = "2147849622"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "fe3ba6cb-09ae-4dce-a7d7-7593cae3f2e7" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACH_2147849624_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACH!MTB"
        threat_id = "2147849624"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {47 00 72 00 61 00 64 00 75 00 61 00 74 00 65 00 49 00 6e 00 73 00 74 00 72 00 75 00 63 00 74 00 69 00 6f 00 6e 00 43 00 6f 00 6d 00 70 00 6c 00 69 00 61 00 6e 00 63 00 65 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73}  //weight: 2, accuracy: High
        $x_1_2 = "b579f664-7c5a-4121-a2b0-68c4263c5685" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AACZ_2147849642_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AACZ!MTB"
        threat_id = "2147849642"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {04 16 06 7b ?? 00 00 04 6f ?? 01 00 0a 28 ?? 01 00 0a 7e ?? 00 00 04 25 2d 17 26 7e ?? 00 00 04 fe ?? ?? 00 00 06 73 ?? 01 00 0a 25 80 ?? 00 00 04 28 ?? 00 00 2b 06 fe ?? ?? 00 00 06 73 ?? 01 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0c}  //weight: 3, accuracy: Low
        $x_1_2 = "QuanLiDoanVien" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AADA_2147849643_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AADA!MTB"
        threat_id = "2147849643"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 06 2b 2c 00 11 04 11 06 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 28 ?? 00 00 0a 16 91 13 08 11 05 11 08 6f ?? 00 00 0a 00 11 06 18 58 13 06 00 11 06 11 04 6f ?? 00 00 0a fe 04 13 09 11 09 2d c3}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAU_2147849714_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAU!MTB"
        threat_id = "2147849714"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0b 07 0c 02 08 1f f6 28 ?? 00 00 06 17 8d ?? 00 00 01 25 16 1f 7e 9d 6f ?? 00 00 0a 0d 73 ?? 00 00 0a 13 04 09 8e 69 17 da 13 08 16 13 09 2b 1b 11 04 11 09 09 11 09 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 09 17 d6 13 09 11 09 11 08 31 df}  //weight: 4, accuracy: Low
        $x_1_2 = "QuanLyBanGiay.CCM" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEY_2147849720_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEY!MTB"
        threat_id = "2147849720"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 09 08 6f ?? 00 00 0a 13 11 16 13 04 11 06 07 9a 20 ?? ?? ?? ?? 28 ?? 00 00 06 28 ?? 00 00 0a 13 0b 11 0b 2c 0b 12 11 28 ?? 00 00 0a 13 04 2b 46 11 06 07 9a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEY_2147849720_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEY!MTB"
        threat_id = "2147849720"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {69 0d 16 0a 2b 3f 06 09 5d 13 04 06 1f 16 5d 13 0b 06 17 58 09 5d 13 0c 07 11 04 91 13 0d 20 00 01 00 00 13 05 11 0d 11 06 11 0b 91 61 07 11 0c 91 59 11 05 58 11 05 5d 13 0e 07 11 04 11 0e d2 9c 06 17 58 0a 06 09 11 07 17 58 5a fe 04 13 0f 11 0f 2d b2}  //weight: 1, accuracy: High
        $x_1_2 = {16 0a 2b 3f 06 08 5d 13 04 06 1f 16 5d 13 0a 06 17 58 08 5d 13 0b 07 11 04 91 13 0c 20 00 01 00 00 13 05 11 0c 11 06 11 0a 91 61 07 11 0b 91 59 11 05 58 11 05 5d 13 0d 07 11 04 11 0d d2 9c 06 17 58 0a 06 08 11 07 17 58 5a fe 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AADF_2147849738_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AADF!MTB"
        threat_id = "2147849738"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {04 20 dc e2 9d 09 28 ?? 00 00 2b 20 59 f4 3b fd 28 ?? 00 00 2b 28 ?? 00 00 06 28 ?? 00 00 2b 28 ?? 00 00 2b 28 ?? 00 00 06 7d ?? 00 00 04 11 05 20 a9 d4 22 8e 5a 20 79 8e 67 ed 61 38}  //weight: 2, accuracy: Low
        $x_1_2 = "QLQuanCF" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAV_2147849742_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAV!MTB"
        threat_id = "2147849742"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {04 16 06 7b ?? 00 00 04 28 ?? 00 00 06 28 ?? 00 00 06 7e ?? 00 00 04 25 2d 17 26 7e ?? 00 00 04 fe ?? ?? 00 00 06 73 ?? 00 00 0a 25 80 ?? 00 00 04 28 ?? 00 00 2b 06 fe ?? ?? 00 00 06 73 ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0b 20}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAX_2147849812_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAX!MTB"
        threat_id = "2147849812"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {04 16 06 7b ?? 00 00 04 6f ?? 00 00 0a 28 ?? 00 00 0a 7e ?? 00 00 04 25 2d 17 26 7e ?? 00 00 04 fe ?? ?? 00 00 06 73 ?? 00 00 0a 25 80 4c 00 00 04 28 ?? 00 00 2b 06 fe ?? ?? 00 00 06 73 ?? 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0b 28 ?? 00 00 0a 07 6f ?? 00 00 0a 0c 08 6f ?? 00 00 0a 17 9a}  //weight: 2, accuracy: Low
        $x_2_2 = {0a 0d 02 7b ?? 00 00 04 8e 69 17 59 8d ?? 00 00 01 13 04 02 7b ?? 00 00 04 11 04 02 7b 22 00 00 04 8e 69 17 59 28 ?? 00 00 0a 00 09 16 8c ?? 00 00 01 11 04 13 05 11 05 6f}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSQS_2147849816_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSQS!MTB"
        threat_id = "2147849816"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 7e 0e 00 00 04 72 23 05 00 70 72 2f 05 00 70 72 39 05 00 70 28 1c 00 00 06 6f 34 00 00 0a 0a 2b 00 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFB_2147849820_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFB!MTB"
        threat_id = "2147849820"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 07 11 ?? 91 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFB_2147849820_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFB!MTB"
        threat_id = "2147849820"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 03 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "5e8b5b964190" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFB_2147849820_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFB!MTB"
        threat_id = "2147849820"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {5d 91 61 11 [0-7] 91 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 10, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "Invoke" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AADK_2147849877_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AADK!MTB"
        threat_id = "2147849877"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 36 05 00 70 72 7e 10 00 70 28 ?? 00 00 0a 7d ?? 00 00 04 06 06 7b ?? 00 00 04 72 62 b8 01 70 72 36 05 00 70 6f ?? 00 00 0a 7d ?? 00 00 04 16 06 7b ?? 00 00 04 6f ?? 01 00 0a 28 ?? 01 00 0a 7e ?? 00 00 04 25 2d 17 26 7e ?? 00 00 04 fe ?? ?? 01 00 06 73 ?? 01 00 0a 25 80 ?? 00 00 04 28 ?? 00 00 2b 06 fe ?? ?? 01 00 06 73 ?? 01 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0c}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAY_2147849890_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAY!MTB"
        threat_id = "2147849890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "7007E002||0046F12||00A00A00674001" wide //weight: 1
        $x_1_2 = {41 00 7c 00 31 00 31 00 30 00 30 00 35 00 31 00 33 00 30 00 30 00 42 00 32 00 42 00 7c 00 31 00 31 00 30 00 30 00 42 00 32 00 41 00 7c 00 31 00 33 00 33 00 7c 00 34 00 7c 00 36 00 36 00 7c 00 7c 00 7c 00 30 00 30 00 35}  //weight: 1, accuracy: High
        $x_1_3 = {44 00 43 00 30 00 30 00 37 00 32 00 43 00 30 00 30 00 37 00 30 00 30 00 37 00 36 00 46 00 32 00 32 00 7c 00 7c 00 30 00 30 00 41 00 7c 00 44 00 43 00 31 00 31 00 30 00 30 00 37 00 32 00 41 00 30 00 30 00 31 00 31 00 43}  //weight: 1, accuracy: High
        $x_1_4 = {41 00 31 00 33 00 30 00 30 00 37 00 44 00 45 00 31 00 36 00 30 00 30 00 39 00 32 00 43 00 30 00 30 00 37 00 30 00 30 00 39 00 36 00 46 00 32 00 32 00 7c 00 7c 00 30 00 30 00 41 00 7c 00 44 00 43 00 30 00 30 00 37 00 32 00 43 00 30 00 30 00 37 00 30 00 30 00 37 00 36 00 46 00 32 00 32}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXLL_2147849939_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXLL!MTB"
        threat_id = "2147849939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 0a 17 5f 2d 20 11 1c 20 ?? ?? ?? ?? 06 61 07 58 5a 06 20 ?? ?? ?? ?? 58 07 61 58 13 1c 11 1c 1f 10 64 d1 13 16 11 16 d2 13 2b 11 16 1e 63 d1 13 16 11 18 11 0a 91 13 24 11 18 11 0a 11 28 11 24 61 19 11 20 58 61 11 2b 61 d2 9c 11 0a 17 58 13 0a 11 24 13 20 11 0a 11 27 32 a4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFE_2147849951_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFE!MTB"
        threat_id = "2147849951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 06 07 8e 69 0c 16 0a 2b ?? 06 08 5d 0d 06 17 58 08 5d}  //weight: 1, accuracy: Low
        $x_1_2 = {91 61 07 11 09 91 59 20 00 01 00 00 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFE_2147849951_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFE!MTB"
        threat_id = "2147849951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "4N(5K(9|(||(|3(||(||(||(|4" wide //weight: 1
        $x_1_2 = " Lo-ad " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNR_2147849993_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNR!MTB"
        threat_id = "2147849993"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 40 00 00 06 0a 06 28 ?? ?? ?? 0a 0b 28 ?? ?? ?? 0a 25 26 07 16 07 8e 69 6f ?? ?? ?? 0a 0a 28 ?? ?? ?? 0a 25 26 06 6f ?? ?? ?? 0a 0c 1f 61}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREJ_2147850032_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREJ!MTB"
        threat_id = "2147850032"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Fijkoreg" ascii //weight: 1
        $x_1_2 = "Kfopewf" ascii //weight: 1
        $x_1_3 = "get_CurrentDomain" ascii //weight: 1
        $x_1_4 = "DownloadData" ascii //weight: 1
        $x_1_5 = "GetExportedTypes" ascii //weight: 1
        $x_1_6 = "InvokeMember" ascii //weight: 1
        $x_1_7 = "stateMachine" ascii //weight: 1
        $x_1_8 = "Efekowqygnb" ascii //weight: 1
        $x_1_9 = "Dejeg" ascii //weight: 1
        $x_1_10 = "AsyncTaskMethodBuilder" ascii //weight: 1
        $x_1_11 = "AppDomain" ascii //weight: 1
        $x_1_12 = "$e62c7918-4e43-4d0a-a001-3f3095d98362" ascii //weight: 1
        $x_1_13 = {31 00 30 00 33 00 2e 00 32 00 32 00 38 00 2e 00 33 00 36 00 2e 00 31 00 30 00 34 00 2f 00 75 00 6c 00 74 00 72 00 6f 00 6e 00 2f 00 [0-20] 2e 00 77 00 61 00 76 00}  //weight: 1, accuracy: Low
        $x_1_14 = {31 30 33 2e 32 32 38 2e 33 36 2e 31 30 34 2f 75 6c 74 72 6f 6e 2f [0-20] 2e 77 61 76}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (13 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAW_2147850084_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAW!MTB"
        threat_id = "2147850084"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0b 07 6f ?? 00 00 0a 0c 08 2c 24 00 07 6f ?? 00 00 0a 17 6f ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0d 2b 04 14 0d 2b 00}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFI_2147850091_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFI!MTB"
        threat_id = "2147850091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {16 0a 11 05 1f 45 93 11 05 1f 45 93 59 13 04 2b c0 03 04 61 1f 10 59 06 61}  //weight: 1, accuracy: High
        $x_1_2 = {6a 55 73 47 69 44 33 75 73 68 31 75 42 79 59 4f 34 4a 00 66 65 4a 6d 55 30 30 4b 64 00 63 46 6f 77}  //weight: 1, accuracy: High
        $x_1_3 = "Ben.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFI_2147850091_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFI!MTB"
        threat_id = "2147850091"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "&3&E200&3&E2&33&E2&23&&&" wide //weight: 1
        $x_1_2 = "6&34&&&&&37&B6&27&16&D6&56&46&1" wide //weight: 1
        $x_1_3 = " System.Reflection.Assembly " wide //weight: 1
        $x_1_4 = " Load " wide //weight: 1
        $x_1_5 = "Dodge" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFJ_2147850092_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFJ!MTB"
        threat_id = "2147850092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 11 58 13 19 11 0d 11 12 91 13 1a 11 1a 11 13 11 08 1f 16 5d 91 61 13 1b 11 1b 11 19 59 13 1c 11 0d 11 12 11 1c 11 11 5d d2 9c 11 08 17 58 13 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFJ_2147850092_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFJ!MTB"
        threat_id = "2147850092"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 18 6f ?? 00 00 0a 13 05 07 11 04 18 5b 11 05 1f 10 28 ?? 00 00 0a 9c 00 11 04 18 58 13 04 11 04 06 6f ?? 00 00 0a fe 04 13 06 11 06 2d ce}  //weight: 1, accuracy: Low
        $x_1_2 = "*3*E200*3*E2*33*E2*23***E6*F6*96*37*" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASAZ_2147850109_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASAZ!MTB"
        threat_id = "2147850109"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 8e 69 17 da 13 08 16 13 09 2b 1c 11 04 11 09 09 11 09 9a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 09 17 d6 13 09 11 09 11 08 31 de}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXFW_2147850130_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXFW!MTB"
        threat_id = "2147850130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 04 18 6f ?? ?? ?? ?? 13 05 07 11 04 18 5b 11 05 1f 10 28 ?? ?? ?? ?? 9c 00 11 04 18 58 13 04 11 04 06 6f ?? ?? ?? ?? fe 04 13 06 11 06 2d ce}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBA_2147850166_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBA!MTB"
        threat_id = "2147850166"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0b 16 13 04 2b 23 00 06 11 04 18 6f ?? 00 00 0a 13 05 07 11 04 18 5b 11 05 1f 10 28 ?? 00 00 0a d2 9c 00 11 04 18 58 13 04 11 04 06 6f ?? 00 00 0a fe 04 13 06 11 06 2d cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFN_2147850172_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFN!MTB"
        threat_id = "2147850172"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 08 5d 13 04 06 1f 16 5d 13 0b 06 17 58 08 5d 13 0c 07 11 04 91 13 0d 20 00 01 00 00 13 05 11 0d 11 06 11 0b 91 61 07 11 0c 91 59 11 05 58 11 05}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFN_2147850172_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFN!MTB"
        threat_id = "2147850172"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 1c 06 07 18 6f ?? 00 00 0a 13 05 08 07 18 5b 11 05 1f 10 28 ?? 00 00 0a 9c 07 18 58 0b 07 06 6f ?? 00 00 0a fe 04 13 06 11 06 2d d5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBB_2147850173_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBB!MTB"
        threat_id = "2147850173"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {04 16 06 7b ?? 0a 00 04 6f ?? 00 00 0a 28 ?? 00 00 0a 7e ?? 0a 00 04 25 3a ?? 00 00 00 26 7e ?? 0a 00 04 fe 06 ?? 12 00 06 73 ?? 00 00 0a 25 80 ?? 0a 00 04 28 ?? 00 00 2b 06 fe 06 ?? 12 00 06 73 ?? 00 00 0a 28 ?? 00 00 2b 28}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFO_2147850174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFO!MTB"
        threat_id = "2147850174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 07 08 07 8e 69 5d 91 61 28 ?? 00 00 06 03 08 1a 58 19 59 03 8e 69 5d 91 59 20 ff 00 00 00 58 17 58 20 00 01 00 00 5d d2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAEC_2147850184_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAEC!MTB"
        threat_id = "2147850184"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 8e 69 17 da 13 08 16 13 09 2b 1c 11 04 11 09 09 11 09 9a 1f 10 28 ?? 01 00 0a b4 6f ?? 01 00 0a 00 11 09 17 d6 13 09 11 09 11 08 31 de}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBC_2147850241_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBC!MTB"
        threat_id = "2147850241"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 13 05 2b 23 00 07 11 05 18 6f ?? 00 00 0a 13 06 08 11 05 18 5b 11 06 1f 10 28 ?? 00 00 0a d2 9c 00 11 05 18 58 13 05 11 05 07 6f ?? 00 00 0a fe 04 13 07 11 07 2d cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFR_2147850243_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFR!MTB"
        threat_id = "2147850243"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 1d 06 07 18 6f ?? 00 00 0a 13 05 08 07 18 5b 11 05 1f 10 28 ?? 00 00 0a d2 9c 07 18 58 0b 07 06 6f ?? 00 00 0a fe 04 13 06 11 06 2d d4}  //weight: 1, accuracy: Low
        $x_1_2 = "cd9d49421bdf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBD_2147850245_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBD!MTB"
        threat_id = "2147850245"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 09 8e 69 17 da 13 0b 16 13 0c 2b 1b 11 04 11 0c 09 11 0c 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 0c 17 d6 13 0c 11 0c 11 0b 31 df}  //weight: 4, accuracy: Low
        $x_1_2 = {4d 00 4e 00 29 00 32 00 31 00 29 00 4c 00 38 00 29 00 26 00 31 00 29 00 34 00 4d 00 29 00 4d 00 4e 00 29 00 32 00 31 00 29 00 35 00 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAEI_2147850266_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAEI!MTB"
        threat_id = "2147850266"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 08 2b 22 00 06 11 08 18 6f ?? 00 00 0a 13 09 07 11 08 18 5b 11 09 1f 10 28 ?? 00 00 0a 9c 00 11 08 18 58 13 08 11 08 06 6f ?? 00 00 0a fe 04 13 0a 11 0a 2d ce}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CXLM_2147850268_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CXLM!MTB"
        threat_id = "2147850268"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 22 11 0d 11 11 11 0d 91 9d 11 0d 17 58 13 0d 11 0d 11 1a 32 ea}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSRF_2147850301_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSRF!MTB"
        threat_id = "2147850301"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 17 00 00 06 72 56 96 01 70 72 5c 96 01 70 6f 42 00 00 0a 0a 06 72 60 96 01 70 72 64 96 01 70 6f 42 00 00 0a 0a 06 6f 43 00 00 0a 18 5b 8d 4f 00 00 01 0b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSRG_2147850302_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSRG!MTB"
        threat_id = "2147850302"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 02 00 00 0a 28 14 00 00 06 6f 03 00 00 0a 28 04 00 00 0a 28 0f 00 00 06 1a 2d 03 26 de 06 0a 2b fb 26 de 00}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFV_2147850544_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFV!MTB"
        threat_id = "2147850544"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 18 6f ?? 00 00 0a 13 05 08 07 18 5b 11 05 1f 10 28 ?? 00 00 0a d2 9c 07 18 58 0b 07 06 6f ?? 00 00 0a fe 04 13 06 11 06 2d d4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFY_2147850546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFY!MTB"
        threat_id = "2147850546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 56 71 51 e7 be 8e e5 a4 8d e5 a4 8d e5 a4 8d e7 be 8e e5 a4 8d e5 a4 8d e5 a4 8d 4d e7 be 8e e5 a4 8d e5 a4 8d e5 a4 8d e7 be 8e e5 a4 8d e5 a4 8d}  //weight: 1, accuracy: High
        $x_1_2 = {8d e5 a4 8d 34 66 75 67 34 e7 be 8e e5 a4 8d e5 a4 8d e5 a4 8d 74 e7 be 8e e5 a4 8d e5 a4 8d e5 a4 8d 6e 4e 49 62 67 42 54 4d 30 68 56}  //weight: 1, accuracy: High
        $x_1_3 = "clean_2.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFZ_2147850547_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFZ!MTB"
        threat_id = "2147850547"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "$9b2446da-c79d-430a-b1b0-d01c02a58ec1" ascii //weight: 10
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "RijndaelManaged" ascii //weight: 1
        $x_1_4 = "TransformFinalBlock" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGB_2147850554_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGB!MTB"
        threat_id = "2147850554"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 01 68 00 00 8d ?? 00 00 01 0d 16 0a 2b 1d 08 06 18 6f ?? 00 00 0a 13 08 09 06 18 5b 11 08 1f 10 28 ?? 00 00 0a d2 9c 06 18 58 0a 06 20 02 d0 00 00 fe 04 13 09 11 09 2d d5}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGC_2147850555_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGC!MTB"
        threat_id = "2147850555"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 3b 16 0d 2b 29 11 08 06 08 58 07 09 58 6f ?? 00 00 0a 13 10 12 10 28 ?? 00 00 0a 13 0a 11 05 11 04 11 0a 9c 11 04 17 58 13 04 09 17 58 0d 09 17 fe 04 13 0b 11 0b 2d cd}  //weight: 1, accuracy: Low
        $x_1_2 = {13 07 16 13 04 20 01 5c 00 00 8d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGF_2147850557_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGF!MTB"
        threat_id = "2147850557"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "asdadafs3asdadafs" wide //weight: 1
        $x_1_2 = "asdadafs44asdadafs" wide //weight: 1
        $x_1_3 = "asdadafs" wide //weight: 1
        $x_1_4 = "InvokeMember" wide //weight: 1
        $x_1_5 = "Method0" wide //weight: 1
        $x_1_6 = "GetTypes" wide //weight: 1
        $x_1_7 = "Load" wide //weight: 1
        $x_1_8 = "GZipStream" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGH_2147850559_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGH!MTB"
        threat_id = "2147850559"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {04 1f 1a 7e ?? 00 00 04 1f 1a 93 7e ?? 00 00 04 20 33 01 00 00 93 61 1f 56 5f 9d 2a}  //weight: 1, accuracy: Low
        $x_1_2 = {0a 0d 08 74 ?? 00 00 01 16 73 ?? 00 00 0a 73 ?? 00 00 0a 13 04 11 04 75 ?? 00 00 01 09 75 ?? 00 00 01 6f ?? 00 00 0a de 45}  //weight: 1, accuracy: Low
        $x_1_3 = "b58e4c33fd46af.Resources.resource" ascii //weight: 1
        $x_1_4 = "Ts6a8G9Nmp4J2QxEj7b3W5DdFg10ScMq27L" ascii //weight: 1
        $x_1_5 = "87bb-ca6b396373e9" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGI_2147850560_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGI!MTB"
        threat_id = "2147850560"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 20 00 01 00 00 6f ?? 00 00 0a 06 20 bd 97 00 00 28 ?? 00 00 06 28 ?? 00 00 0a 6f ?? 00 00 0a 06 20 76 94 00 00 28 ?? 00 00 06 28 ?? 00 00 0a 6f ?? 00 00 0a 06 06 6f ?? 00 00 0a 06 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 14}  //weight: 1, accuracy: Low
        $x_1_2 = "b206-d36a49efe2a8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGJ_2147850561_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGJ!MTB"
        threat_id = "2147850561"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "AxvhMfnyTrBArEBQAyLhAhZBOw" wide //weight: 10
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "RC2CryptoServiceProvider" ascii //weight: 1
        $x_1_5 = "GetBytes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGK_2147850562_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGK!MTB"
        threat_id = "2147850562"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0a 06 07 6f 99 00 00 0a 17 73 75 00 00 0a 25 02 16 02 8e 69 6f 9a 00 00 0a}  //weight: 1, accuracy: High
        $x_1_2 = "6b21b575-6e43-499e-81f8-48d3913950ae" ascii //weight: 1
        $x_1_3 = "JJjUh877" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGP_2147850567_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGP!MTB"
        threat_id = "2147850567"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 25 16 1f 2c 9d 6f ?? 01 00 0a 16 9a 73 ?? 01 00 0a 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "ee-73fb6678cdbe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGP_2147850567_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGP!MTB"
        threat_id = "2147850567"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "R-03-R-E2-R-03-R-E2-R-03-R-E2-R-13-R-R-R-E6-R-F6-R-96" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGP_2147850567_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGP!MTB"
        threat_id = "2147850567"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 11 06 11 21 9a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 21 17 d6 13 21 11 21 11 20 31 df}  //weight: 1, accuracy: Low
        $x_1_2 = {4c 00 6f 00 2d 00 61 00 64 00 20 00 01 03 2d 00 01 13 51 00 75 00 61 00 6e 00 4c 00 79 00 42 00 61 00 6e 00 00 11 47 00 69 00 61 00 79}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGO_2147850568_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGO!MTB"
        threat_id = "2147850568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 20 00 01 00 00 6f ?? 00 00 0a 06 7e 01 00 00 04 28 ?? 00 00 0a 6f ?? 00 00 0a 06 7e 02 00 00 04 28 ?? 00 00 0a 6f ?? 00 00 0a 06 06 6f ?? 00 00 0a 06 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 14 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGO_2147850568_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGO!MTB"
        threat_id = "2147850568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 2b 29 11 07 06 08 58 07 09 58 6f ?? 00 00 0a 13 0f 12 0f 28 ?? 00 00 0a 13 09 11 06 11 04 11 09 9c 11 04 17 58 13 04 09 17 58 0d 09 17 fe 04 13 0a 11 0a 2d cd}  //weight: 1, accuracy: Low
        $x_1_2 = {16 13 04 20 00 ac 00 00 8d ?? 00 00 01 13 06 11 05}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBE_2147850601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBE!MTB"
        threat_id = "2147850601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 09 8e 69 17 da 13 11 16 13 12 2b 1b 11 04 11 12 09 11 12 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 12 17 d6 13 12 11 12 11 11 31 df}  //weight: 4, accuracy: Low
        $x_1_2 = "QuanLyBanGiay.CCM" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBF_2147850605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBF!MTB"
        threat_id = "2147850605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 13 0a 2b 22 00 08 11 0a 18 6f ?? 00 00 0a 13 0b 09 11 0a 18 5b 11 0b 1f 10 28 ?? 00 00 0a 9c 00 11 0a 18 58 13 0a 11 0a 08 6f ?? 00 00 0a fe 04 13 0c 11 0c 2d ce}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBG_2147850606_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBG!MTB"
        threat_id = "2147850606"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 16 13 0b 2b 23 00 09 11 0b 18 6f ?? 00 00 0a 13 0c 11 04 11 0b 18 5b 11 0c 1f 10 28 ?? 00 00 0a 9c 00 11 0b 18 58 13 0b 11 0b 09 6f ?? 00 00 0a fe 04 13 0d 11 0d 2d cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBH_2147850610_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBH!MTB"
        threat_id = "2147850610"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 09 8e 69 17 da 13 11 16 13 12 2b 1c 11 04 11 12 09 11 12 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 00 11 12 17 d6 13 12 11 12 11 11 31 de}  //weight: 4, accuracy: Low
        $x_1_2 = "finalProject.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBI_2147850614_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBI!MTB"
        threat_id = "2147850614"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 13 06 2b 23 00 08 11 06 18 6f ?? 00 00 0a 13 07 09 11 06 18 5b 11 07 1f 10 28 ?? 00 00 0a d2 9c 00 11 06 18 58 13 06 11 06 20 02 d0 00 00 fe 04 13 08 11 08 2d ce}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBJ_2147850616_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBJ!MTB"
        threat_id = "2147850616"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 05 11 04 8e 69 17 da 13 0c 16 13 0d 2b 1c 11 05 11 0d 11 04 11 0d 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 0d 17 d6 13 0d 11 0d 11 0c 31 de}  //weight: 4, accuracy: Low
        $x_1_2 = "XAXAXSADXSADXADDADAD DADAQDD" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBK_2147850617_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBK!MTB"
        threat_id = "2147850617"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 16 13 06 2b 22 00 08 11 06 18 6f ?? 00 00 0a 13 07 09 11 06 18 5b 11 07 1f 10 28 ?? 00 00 0a 9c 00 11 06 18 58 13 06 11 06 08 6f ?? 00 00 0a fe 04 13 08 11 08 2d ce}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBL_2147850621_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBL!MTB"
        threat_id = "2147850621"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 09 8e 69 17 da 13 1d 16 13 1e 2b 1c 11 04 11 1e 09 11 1e 9a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 1e 17 d6 13 1e 11 1e 11 1d 31 de}  //weight: 4, accuracy: Low
        $x_1_2 = "FinalProjectVB.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBM_2147850622_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBM!MTB"
        threat_id = "2147850622"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {03 08 03 8e 69 5d 7e ?? 00 00 04 03 08 03 8e 69 5d 91 07 08 07 8e 69 5d 91 61 28 ?? 00 00 06 03 08}  //weight: 2, accuracy: Low
        $x_2_2 = {8e 69 5d 91 59 20 fe 00 00 00 58 18 58 20 00 01 00 00 5d d2 9c 08 17 58 16 2c 3f}  //weight: 2, accuracy: High
        $x_1_3 = {0f 01 03 8e 69 17 59 16 2c 1f 26 26 03 2a 0a 38 ?? ff ff ff 0b 38 ?? ff ff ff 0c 38 ?? ff ff ff 0c 38 ?? ff ff ff 0c 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBN_2147850623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBN!MTB"
        threat_id = "2147850623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 09 8e 69 17 da 13 1d 16 13 1e 2b 1c 11 04 11 1e 09 11 1e 9a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 1e 17 d6 13 1e 11 1e 11 1d 31 de}  //weight: 4, accuracy: Low
        $x_1_2 = "FinalProject_Turner.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBO_2147850627_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBO!MTB"
        threat_id = "2147850627"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 04 09 8e 69 17 da 13 1d 16 13 1e 2b 1a 11 04 09 11 1e 9a 1f 10 28 ?? 01 00 0a b4 6f ?? 01 00 0a 00 11 1e 17 d6 13 1e 11 1e 11 1d 31 e0}  //weight: 4, accuracy: Low
        $x_1_2 = "CoolerMaster.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBQ_2147850629_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBQ!MTB"
        threat_id = "2147850629"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 06 11 05 8e 69 17 da 13 1f 16 13 20 2b 1b 11 06 11 05 11 20 9a 1f 10 28 ?? 01 00 0a b4 6f ?? 01 00 0a 00 11 20 17 d6 13 20 11 20 11 1f 31 df}  //weight: 4, accuracy: Low
        $x_1_2 = "Final_Project.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAEY_2147850715_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAEY!MTB"
        threat_id = "2147850715"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 06 2b 22 11 05 11 06 18 6f ?? 00 00 0a 13 0c 11 07 11 06 18 5b 11 0c 1f 10 28 ?? 00 00 0a 9c 11 06 18 58 13 06 11 06 11 05 6f ?? 00 00 0a fe 04 13 0d 11 0d 2d cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAFE_2147850721_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAFE!MTB"
        threat_id = "2147850721"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {01 25 16 07 8c ?? 00 00 01 a2 14 28 ?? 00 00 0a 28 ?? 00 00 0a 13 04 16 13 07 38 ?? ff ff ff 02 18 8d ?? 00 00 01 25 16 07 8c ?? 00 00 01 a2 25 17 11 04 1f 48 61 8c ?? 00 00 01 a2 14 28 ?? 00 00 0a 1e 13 07}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAFH_2147850722_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAFH!MTB"
        threat_id = "2147850722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {06 20 00 01 00 00 6f ?? 00 00 0a 06 72 49 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 06 72 a3 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 06 06 6f ?? 00 00 0a 06 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 73 ?? 00 00 0a 0c 02 73 ?? 00 00 0a 0d 09 07 16 73 ?? 00 00 0a 13 04 11 04 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 13 05 dd ?? 00 00 00 11 04 39 ?? 00 00 00 11 04 6f ?? 00 00 0a dc}  //weight: 3, accuracy: Low
        $x_1_2 = "ReadAsByteArrayAsync" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "System.Reactive.Strings_Core" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAFI_2147850723_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAFI!MTB"
        threat_id = "2147850723"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 05 11 04 8e 69 17 da 13 12 16 13 13 2b 1c 11 05 11 13 11 04 11 13 9a 1f 10 28 ?? 01 00 0a 6f ?? 01 00 0a 00 11 13 17 d6 13 13 11 13 11 12 31 de}  //weight: 4, accuracy: Low
        $x_1_2 = "Comiclandia.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSRL_2147850748_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSRL!MTB"
        threat_id = "2147850748"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 28 20 00 00 0a 6f 21 00 00 0a 17 2b d3 02 28 22 00 00 0a 28 23 00 00 0a 0b 18 2b c4 07 6f 24 00 00 0a 0c 19 2b ba 06 08 6f 25 00 00 0a 0d 1a 2b af}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSSG_2147850767_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSSG!MTB"
        threat_id = "2147850767"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 00 0a 02 72 0d 00 00 70 28 09 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 0a dd 06 00 00 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBR_2147850981_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBR!MTB"
        threat_id = "2147850981"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 08 2b 3a 16 13 09 2b 2a 09 11 04 11 08 58 11 07 11 09 58 6f ?? 00 00 0a 13 0a 12 0a 28 ?? 00 00 0a 13 0b 08 07 11 0b 9c 07 17 58 0b 11 09 17 58 13 09 11 09 17 32 d1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBS_2147850982_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBS!MTB"
        threat_id = "2147850982"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 8e 69 1f 10 da 17 da 17 d6 8d ?? 00 00 01 0a 02 1f 10 06 16 06 8e 69 28 ?? 00 00 0a 06 8e 69 17 da 0b 16 0c 2b 16 06 08 8f ?? 00 00 01 25 47 02 08 1f 10 5d 91 61 d2 52 08 17 d6 0c 08 07 fe 02 16 fe 01 0d 09 2d df}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBT_2147850986_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBT!MTB"
        threat_id = "2147850986"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {13 07 11 06 8e 69 17 da 13 20 16 13 21 38 ?? 00 00 00 11 07 11 06 11 21 9a 1f 10 7e ?? 02 00 04 28 ?? 03 00 06 b4 6f ?? 00 00 0a 00 11 21 17 d6 13 21 11 21 11 20 3e}  //weight: 4, accuracy: Low
        $x_1_2 = "CollinsSemesterProject.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBU_2147851006_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBU!MTB"
        threat_id = "2147851006"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {16 13 22 2b 44 00 16 13 23 2b 2c 00 09 11 04 11 22 58 11 21 11 23 58 6f ?? 01 00 0a 13 24 12 24 28 ?? 01 00 0a 13 25 08 07 11 25 9c 07 17 58 0b 11 23 17 58 13 23 00 11 23 17 fe 04 13 26 11 26 2d c9}  //weight: 4, accuracy: Low
        $x_1_2 = "Interface.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBV_2147851057_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBV!MTB"
        threat_id = "2147851057"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 09 11 0c 11 0e 58 17 58 17 59 11 0d 11 0f 58 17 58 17 59 6f ?? 00 00 0a 13 10 12 10 28 ?? 00 00 0a 13 11 11 08 11 07 11 11 9c 11 07 17 58 13 07 11 0f 17 58 13 0f 00 11 0f 17 fe 04 13 12 11 12 2d bc}  //weight: 4, accuracy: Low
        $x_1_2 = {16 13 07 20 01 84 00 00 8d ?? 00 00 01 13 08 11 06 72}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGQ_2147851062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGQ!MTB"
        threat_id = "2147851062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {51 00 75 00 61 00 6e 00 4c 00 79 00 42 00 61 00 6e 00 00 11 47 00 69 00 61 00 79 00 2e 00 43 00 43 00 4d}  //weight: 1, accuracy: High
        $x_1_2 = {44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGQ_2147851062_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGQ!MTB"
        threat_id = "2147851062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$6b219d00-fb8a-4f95-9578-a02b1855b25e" ascii //weight: 1
        $x_1_2 = "QUANLYDAILY.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGQ_2147851062_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGQ!MTB"
        threat_id = "2147851062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0a 2b 19 07 06 08 06 18 5a 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 9c 06 17 58 0a 06 07 8e 69 fe 04 13 05 11 05 2d db}  //weight: 1, accuracy: Low
        $x_1_2 = "QLTV.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBW_2147851066_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBW!MTB"
        threat_id = "2147851066"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 03 11 04 11 08 58 17 58 17 59 11 07 11 09 58 17 58 17 59 6f ?? 00 00 0a 13 0a 20 02 00 00 00 38}  //weight: 2, accuracy: Low
        $x_1_2 = {11 02 11 01 11 0b 9c 38 ?? ?? ff ff 02 7b}  //weight: 1, accuracy: Low
        $x_1_3 = "ResourceFailureModel.Properties.Resources" ascii //weight: 1
        $x_1_4 = "GetPixel" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBX_2147851076_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBX!MTB"
        threat_id = "2147851076"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 07 2b 64 00 16 13 08 2b 4c 00 16 13 09 2b 34 00 09 11 06 11 08 58 17 58 17 59 11 07 11 09 58 17 58 17 59 6f ?? 00 00 0a 13 0a 12 0a 28 ?? 00 00 0a 13 0b 08 07 11 0b 9c 07 17 58 0b 11 09 17 58 13 09 00 11 09 17 fe 04 13 0c 11 0c 2d c1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBY_2147851112_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBY!MTB"
        threat_id = "2147851112"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 0a 11 07 6f ?? 00 00 0a 5d 13 0b 11 0a 11 07 6f ?? 00 00 0a 5b 13 0c 11 07 72 ?? 01 00 70 18 18 8d ?? 00 00 01 25 16 11 0b 8c ?? 00 00 01 a2 25 17 11 0c 8c ?? 00 00 01 a2 28}  //weight: 2, accuracy: Low
        $x_2_2 = {01 13 0d 12 0d 28 ?? 00 00 0a 13 0e 11 06 11 0e 6f ?? 00 00 0a 11 0a 17 58 13 0a 11 0a 11 07 6f ?? 00 00 0a 11 07 6f ?? 00 00 0a 5a 32 8f}  //weight: 2, accuracy: Low
        $x_1_3 = "TandemLine.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASBZ_2147851119_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASBZ!MTB"
        threat_id = "2147851119"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 08 6f ?? 00 00 0a 5d 13 06 11 05 08 6f ?? 00 00 0a 5b 13 07 08 72 ?? 0d 00 70 18 18 8d ?? 00 00 01 25 16 11 06 8c ?? 00 00 01 a2 25 17 11 07 8c ?? 00 00 01 a2 28 ?? 00 00 0a a5 ?? 00 00 01 13 08 12 08 28 ?? 00 00 0a 13 09 07 11 09 6f ?? 00 00 0a 00 00 11 05 17 58 13 05 11 05 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 5a fe 04 13 0a 11 0a 2d 8c}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGS_2147851135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGS!MTB"
        threat_id = "2147851135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 20 10 27 00 00 13 00 12 00 6f ?? 00 00 06 1c 13 00 12 00 1d 13 01 12 01}  //weight: 1, accuracy: Low
        $x_1_2 = {4d 6f 64 75 6c 65 31 00 4b 45 53 41 52}  //weight: 1, accuracy: High
        $x_1_3 = "AesCryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGS_2147851135_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGS!MTB"
        threat_id = "2147851135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0d 2b 31 11 08 06 08 58 17 58 17 59 07 09 58 17 58 17 59 6f ?? 00 00 0a 13 11 12 11 28 ?? 00 00 0a 13 0b 11 05 11 04 11 0b 9c 11 04 17 58 13 04 09 17 58 0d 09 17 fe 04 13 0c 11 0c 2d c5}  //weight: 1, accuracy: Low
        $x_1_2 = {16 13 04 20 01 84 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDW_2147851156_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDW!MTB"
        threat_id = "2147851156"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "d3ec23d5-a604-485c-bf11-ec90a3423787" ascii //weight: 1
        $x_1_2 = "QuanLyBanHang" ascii //weight: 1
        $x_1_3 = "frmHeThong" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGT_2147851200_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGT!MTB"
        threat_id = "2147851200"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 2d 05 00 70 18 18 8d ?? 00 00 01 25 16 11 06 8c ?? 00 00 01 a2 25 17 11 07 8c ?? 00 00 01 a2 28 ?? 00 00 0a a5 ?? 00 00 01 13 08 12 08 28 ?? 00 00 0a 13 09 07 11 09 6f ?? 00 00 0a 11 05 17 58 13 05}  //weight: 1, accuracy: Low
        $x_1_2 = "HeartRate" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAGJ_2147851211_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAGJ!MTB"
        threat_id = "2147851211"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {01 25 16 20 ea 5e 00 00 28 ?? 00 00 06 73 ?? 00 00 0a a2 6f ?? 00 00 0a 74 ?? 00 00 1b 6f ?? 00 00 0a 2b 08 06 6f ?? 00 00 0a 2b 07 6f ?? 00 00 0a 2b f1}  //weight: 3, accuracy: Low
        $x_1_2 = "Reverse" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCC_2147851214_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCC!MTB"
        threat_id = "2147851214"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0d 16 13 06 2b 1f 00 09 11 06 08 11 06 18 5a 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 9c 00 11 06 17 58 13 06 11 06 09 8e 69 fe 04 13 07 11 07 2d d4}  //weight: 4, accuracy: Low
        $x_1_2 = "GUI.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGW_2147851225_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGW!MTB"
        threat_id = "2147851225"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 04 11 05 6f ?? 00 00 0a 13 08 07 11 04 11 05 6f ?? 00 00 0a 13 09 11 09 28 ?? 00 00 0a 13 0a 09 08 11 0a d2 9c 11 05 17 58 13 05 11 05 07 6f ?? 00 00 0a 32 c9}  //weight: 1, accuracy: Low
        $x_1_2 = {0b 16 0c 20 00 ba 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSST_2147851257_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSST!MTB"
        threat_id = "2147851257"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 18 00 00 0a 6f 19 00 00 0a 6f 1a 00 00 0a 6f 1b 00 00 0a 6f 1c 00 00 0a 0a 28 1d 00 00 0a 06 6f 1e 00 00 0a 28 1f 00 00 0a 0a 73 20 00 00 0a 0b 07 6f 21 00 00 0a 16 fe 01 0c 08 2c 07}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREY_2147851276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREY!MTB"
        threat_id = "2147851276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WriteParser" ascii //weight: 1
        $x_1_2 = "CallParser" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
        $x_1_7 = "CallDescriptor" ascii //weight: 1
        $x_1_8 = "$210c7346-7558-49f6-9121-80c06231ba38" ascii //weight: 1
        $x_1_9 = "FillMapper" ascii //weight: 1
        $x_1_10 = "://38.255.43.23/dcd.vdf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREY_2147851276_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREY!MTB"
        threat_id = "2147851276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "SetupField" ascii //weight: 1
        $x_1_2 = "ListField" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" ascii //weight: 1
        $x_1_4 = "RegisterField" ascii //weight: 1
        $x_1_5 = "RevertHelper" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
        $x_1_7 = "ToString" ascii //weight: 1
        $x_1_8 = "GetString" ascii //weight: 1
        $x_1_9 = "PDFescape Desktop" ascii //weight: 1
        $x_1_10 = "$e17ca2d4-a333-48a6-94b1-03d85ceb0876" ascii //weight: 1
        $x_1_11 = {2f 00 2f 00 38 00 32 00 2e 00 31 00 31 00 38 00 2e 00 32 00 31 00 2e 00 36 00 39 00 2f 00 79 00 69 00 79 00 2f 00 [0-20] 2e 00 77 00 61 00 76 00}  //weight: 1, accuracy: Low
        $x_1_12 = {2f 2f 38 32 2e 31 31 38 2e 32 31 2e 36 39 2f 79 69 79 2f [0-20] 2e 77 61 76}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (11 of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCA_2147851321_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCA!MTB"
        threat_id = "2147851321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {06 25 26 20 [0-4] 28 ?? 00 00 06 25 26 6f ?? 00 00 0a 0a 08 20 [0-4] 5a 20 [0-4] 61 38 ?? ff ff ff 06 28 ?? 00 00 0a 0b 08 20 [0-4] 5a 20 [0-4] 61 38}  //weight: 4, accuracy: Low
        $x_1_2 = "BNnHh87$" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCD_2147851410_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCD!MTB"
        threat_id = "2147851410"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 8e 69 17 da 13 1e 16 13 1f 2b 1b 11 06 11 05 11 1f 9a 1f 10 28 ?? 01 00 0a 86 6f ?? 01 00 0a 00 11 1f 17 d6 13 1f 11 1f 11 1e 31 df}  //weight: 4, accuracy: Low
        $x_1_2 = "WindowsApp1.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCE_2147851519_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCE!MTB"
        threat_id = "2147851519"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 0d 2b 59 00 09 08 6f ?? 00 00 0a 5d 13 06 09 08 6f ?? 00 00 0a 5b 13 07 08 72 ?? ?? 00 70 18 18 8d ?? 00 00 01 25 16 11 06 8c ?? 00 00 01 a2 25 17 11 07 8c ?? 00 00 01 a2 28 ?? 00 00 0a a5 ?? 00 00 01 13 08 12 08 28 ?? 00 00 0a 13 09 07 11 09 6f ?? 00 00 0a 00 09 17 58 0d 00 09 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 5a fe 04 13 0a 11 0a 2d 91}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCF_2147851520_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCF!MTB"
        threat_id = "2147851520"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 0d 2b 5b 09 08 6f ?? 00 00 0a 5d 13 06 09 08 6f ?? 00 00 0a 5b 13 07 08 20 ?? ?? ?? ?? 28 ?? 01 00 06 18 18 8d ?? 00 00 01 25 16 11 06 8c ?? 00 00 01 a2 25 17 11 07 8c ?? 00 00 01 a2 28 ?? 00 00 0a a5 ?? 00 00 01 13 08 12 08 28 ?? 00 00 0a 13 09 07 11 09 6f ?? 00 00 0a 09 17 58 0d 09 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 5a fe 04 13 0a 11 0a 2d 8f}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHB_2147851525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHB!MTB"
        threat_id = "2147851525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 11 07 09 8e 69 5d 09 11 07 09 8e 69 5d 91 11 04 11 07 1f 16 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 09 11 07 17 58 09 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 00}  //weight: 1, accuracy: Low
        $x_1_2 = "2F45H8F4FE4EQS5D8585TD" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHC_2147851526_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHC!MTB"
        threat_id = "2147851526"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 50 00 16 13 05 2b 2f 00 07 11 04 11 05 6f ?? 00 00 0a 13 09 07 11 04 11 05 6f ?? 00 00 0a 13 0a 11 0a 28 ?? 00 00 0a 13 0b 09 08 11 0b d2 9c 00 11 05 17 58 13 05 11 05 07 6f 35 00 00 0a fe 04 13 0c 11 0c 2d c1}  //weight: 1, accuracy: Low
        $x_1_2 = {16 0c 20 00 ba 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHD_2147851544_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHD!MTB"
        threat_id = "2147851544"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 16 5c 01 00 0d 2b 43 08 09 08 8e 69 5d 08 09 08 8e 69 5d 91 11 05 09 1f 16 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 08 09 17 58 08 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 09}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCG_2147851608_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCG!MTB"
        threat_id = "2147851608"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 06 8e 69 17 da 13 1f 16 13 20 2b 1b 11 07 11 06 11 20 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 00 11 20 17 d6 13 20 11 20 11 1f 31 df}  //weight: 4, accuracy: Low
        $x_1_2 = "lab6.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCH_2147851609_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCH!MTB"
        threat_id = "2147851609"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 05 07 8e 69 5d 07 11 05 07 8e 69 5d 91 08 11 05 1f 16 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 05 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 00 11 05 15 58 13 05 11 05 16 fe 04 16 fe 01 13 06 11 06 2d a8}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAHG_2147851619_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAHG!MTB"
        threat_id = "2147851619"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 72 0d 00 00 70 28 ?? 00 00 06 6f ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 13 00 38}  //weight: 2, accuracy: Low
        $x_1_2 = {34 00 35 00 2e 00 31 00 32 00 2e 00 32 00 35 00 33 00 2e 00 31 00 34 00 37}  //weight: 1, accuracy: High
        $x_1_3 = "FromBase64String" ascii //weight: 1
        $x_1_4 = "ReadAsByteArrayAsync" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCI_2147851679_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCI!MTB"
        threat_id = "2147851679"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 20 16 64 01 00 13 05 2b 46 00 07 11 05 07 8e 69 5d 07 11 05 07 8e 69 5d 91 08 11 05 1f 16 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 05 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 05 15 58 13 05 11 05 16 fe 04 16 fe 01 13 06 11 06 2d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDV_2147851692_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDV!MTB"
        threat_id = "2147851692"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 09 18 6f 42 00 00 0a 20 03 02 00 00 28 43 00 00 0a 13 05 08 11 05 6f ?? ?? ?? ?? 09 18 58 0d 09 07 6f 45 00 00 0a fe 04 13 06 11 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCJ_2147851704_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCJ!MTB"
        threat_id = "2147851704"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 8e 69 17 da 13 1e 16 13 1f 2b 1d 11 06 11 1f 11 05 11 1f 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 00 11 1f 17 d6 13 1f 11 1f 11 1e 31 dd}  //weight: 4, accuracy: Low
        $x_1_2 = "VCCCVVVVVVVV VVVVVVVVV FSDF" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAHR_2147851740_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAHR!MTB"
        threat_id = "2147851740"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 06 8e b7 17 da 11 04 da 02 17 8d ?? 00 00 01 13 06 11 06 16 11 04 8c ?? 00 00 01 a2 11 06 14 28 ?? 00 00 0a 28 ?? 00 00 0a 07 08 17 8d ?? 00 00 01 13 08 11 08 16 11 04 8c ?? 00 00 01 08 14 72 01 00 00 70 16 8d ?? 00 00 01 14 14 14 28 ?? 00 00 0a 28 ?? 00 00 0a a2 11 08 14 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 28 ?? 00 00 0a 9c 11 04 17 d6 13 04 11 04 11 07 31 83}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGR_2147851745_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGR!MTB"
        threat_id = "2147851745"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 dd 08 00 70 1b 8d ?? 00 00 01 25 16 72 f7 08 00 70 72 0d 09 00 70 72 73 07 00 70 28 ?? 00 00 0a a2 25 17 20 00 01 00 00 8c ?? 00 00 01 a2 14 14}  //weight: 1, accuracy: Low
        $x_1_2 = {47 00 65 00 74 00 54 00 79 00 70 00 65 00 73 00 00 09 4c 00 6f 00 61 00 64 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCK_2147851846_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCK!MTB"
        threat_id = "2147851846"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 05 16 13 09 2b 25 00 11 04 11 09 18 6f ?? 00 00 0a 13 0a 11 05 11 09 18 5b 11 0a 1f 10 28 ?? 00 00 0a d2 9c 00 11 09 18 58 13 09 11 09 11 04 6f ?? 00 00 0a fe 04 13 0b 11 0b 2d ca}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCL_2147851847_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCL!MTB"
        threat_id = "2147851847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0c 16 13 06 2b 23 00 07 11 06 18 6f ?? 01 00 0a 13 07 08 11 06 18 5b 11 07 1f 10 28 ?? 01 00 0a d2 9c 00 11 06 18 58 13 06 11 06 07 6f ?? 01 00 0a fe 04 13 08 11 08 2d cd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHK_2147851857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHK!MTB"
        threat_id = "2147851857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 14 72 4a 07 00 70 18 8d ?? 00 00 01 25 16 72 62 07 00 70 a2 25 17 72 66 07 00 70 a2 14 14 14}  //weight: 1, accuracy: Low
        $x_1_2 = {11 06 11 1f 11 05 11 1f 9a 1f 10 28 ?? 00 00 0a 86 6f ?? 00 00 0a 00 11 1f 17 d6 13 1f 11 1f 11 1e 31 dd}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGX_2147851912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGX!MTB"
        threat_id = "2147851912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://discord.gg/fndev" wide //weight: 1
        $x_1_2 = "1ff0b709-2aa7-41b1-9a22-4d14461fdd20" ascii //weight: 1
        $x_1_3 = "Atomic_Launcher.Properties.Resource" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPP_2147851984_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPP!MTB"
        threat_id = "2147851984"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {07 11 05 07 8e 69 5d 07 11 05 07 8e 69 5d 91 08 11 05 1f 16 5d 6f ?? ?? ?? 0a 61 28 ?? ?? ?? 0a 07 11 05 17 58 07 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 00 11 05 15 58 13 05 11 05 16 fe 04 16 fe 01 13 06 11 06 2d ac}  //weight: 4, accuracy: Low
        $x_1_2 = "HotelSim.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCB_2147851989_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCB!MTB"
        threat_id = "2147851989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {4d 00 61 00 72 00 6c 00 69 00 65 00 58 00 43 00 63 00 65 00 20 00 41 00 6e 00 64 00 72 00 61 00 64 00 61 00 20 00 44 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53 00 53}  //weight: 4, accuracy: High
        $x_1_2 = "Finals.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDX_2147852002_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDX!MTB"
        threat_id = "2147852002"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 28 17 00 00 0a 03 04 05 6f 1d 00 00 0a 28 11 00 00 0a 51}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAA_2147852098_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAA!MTB"
        threat_id = "2147852098"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 08 11 0a 18 6f ?? 00 00 0a 13 0b 09 11 0a 18 5b 11 0b 1f 10 28 ?? 00 00 0a 9c 00 11 0a 18 58 13 0a 11 0a 08 6f ?? 00 00 0a fe 04 13 0c 11 0c 2d ce}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCN_2147852120_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCN!MTB"
        threat_id = "2147852120"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 8e 69 17 da 13 1e 16 13 1f 2b 1a 11 06 11 05 11 1f 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 1f 17 d6 13 1f 11 1f 11 1e 31 e0}  //weight: 1, accuracy: Low
        $x_1_2 = "FinalProject.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCO_2147852183_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCO!MTB"
        threat_id = "2147852183"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 8e 69 17 da 13 1f 16 13 20 2b 1a 11 07 11 06 11 20 9a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 00 11 20 17 d6 13 20 11 20 11 1f 31 e0}  //weight: 1, accuracy: Low
        $x_1_2 = "Final_Project.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCP_2147852294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCP!MTB"
        threat_id = "2147852294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 05 2b 44 07 11 05 07 8e 69 5d 07 11 05 07 8e 69 5d 91 08 11 05 1f 16 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 05 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 11 05 15 58 13 05 11 05 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ALA_2147852396_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALA!MTB"
        threat_id = "2147852396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {d2 0b 03 07 1f 1f 5f 64 28 ?? ?? ?? 0a 0c 02 1b 40 12 00 00 00 06 08 19 91 6f ?? ?? ?? 0a 06 08 18 91 6f ?? ?? ?? 0a 06 08 17 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAE_2147852431_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAE!MTB"
        threat_id = "2147852431"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 11 05 08 6f ?? 00 00 0a 5d 13 06 11 05 08 6f ?? 00 00 0a 5b 13 07 08 72 ?? ?? ?? ?? 18 18 8d ?? 00 00 01 25 16 11 06 8c ?? 00 00 01 a2 25 17 11 07 8c ?? 00 00 01 a2 28 ?? 00 00 0a a5 ?? 00 00 01 13 08 12 08 28 ?? 00 00 0a 13 09 07 11 09 6f ?? 00 00 0a 00 00 11 05 17 58 13 05 11 05 08 6f ?? 00 00 0a 08 6f ?? 00 00 0a 5a fe 04 13 0a 11 0a 2d 8c}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCQ_2147852440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCQ!MTB"
        threat_id = "2147852440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 8e 69 17 da 13 1e 16 13 1f 2b 1a 11 06 11 05 11 1f 9a 1f 10 28 ?? 01 00 0a 6f ?? 01 00 0a 00 11 1f 17 d6 13 1f 11 1f 11 1e 31 e0}  //weight: 1, accuracy: Low
        $x_1_2 = "billing_system.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCR_2147852550_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCR!MTB"
        threat_id = "2147852550"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0b 07 72 ?? 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 07 72 ?? 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 07 07 6f ?? 00 00 0a 07 6f ?? 00 00 0a 6f ?? 00 00 0a 0c 73 ?? 00 00 0a 0d 09 08 17 73 ?? 00 00 0a 13 04 11 04 06 16 06 8e 69 6f ?? 00 00 0a 09 6f ?? 00 00 0a 13 05 dd}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GNV_2147852574_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GNV!MTB"
        threat_id = "2147852574"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {58 4a d2 61 d2 52 20 ?? ?? ?? 00 fe 0e 0a 00 00 fe 0c 0a 00 20 ?? ?? ?? 00 fe 01}  //weight: 10, accuracy: Low
        $x_10_2 = {25 47 fe 0c 01 00 fe 0c 02 00 91 61 d2 52 20 10 00 00 00 fe 0e 0a 00 00 fe 0c 0a 00}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHN_2147852579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHN!MTB"
        threat_id = "2147852579"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 00 46 0b 00 0c 07 73 ?? 00 00 0a 0d 09 16 73 ?? 00 00 0a 13 04 08 8d ?? 00 00 01 13 05 11 04 11 05 16 08}  //weight: 1, accuracy: Low
        $x_1_2 = "3.g.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHO_2147852580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHO!MTB"
        threat_id = "2147852580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 1f 16 5d 6f ?? 00 00 0a 61 07 09 17 58 07 8e 69 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 06 11 06 2d bd}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAJI_2147852590_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAJI!MTB"
        threat_id = "2147852590"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0d 07 09 1f 37 8c ?? 00 00 01 28 ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a 00 00 08 6f ?? 00 00 0a 13 04 11 04 2d ce de 15 08 75 ?? 00 00 01 2c 0c 08 75 ?? 00 00 01 6f ?? 00 00 0a 00 dc 07 6f ?? 00 00 0a 28 ?? 00 00 06 74 ?? 00 00 1b 0a 2b 00 06 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAJJ_2147852597_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAJJ!MTB"
        threat_id = "2147852597"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 04 08 8e 69 5d 08 11 04 08 8e 69 5d 91 09 11 04 1f 16 5d 6f ?? 00 00 0a 61 08 11 04 17 58 08 8e 69 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 11 04 15 58 13 04 00 11 04 16 fe 04 16 fe 01 13 07 11 07 2d b6}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHQ_2147852600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHQ!MTB"
        threat_id = "2147852600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "$$$$$$$$$$C$$$$$$$$$$$$reat$$$$$$$eIn$$$$$$$$$$stan$$$$$$$$$$$ce" wide //weight: 5
        $x_5_2 = "$$$$$Sy$$$$$$$$$$$s$$$$$$$$tem.A$$$$$$$$$$$$$$cti$$$$$$$va$$$$$$$$$$$$$$$tor$$$$$$$$$$$" wide //weight: 5
        $x_1_3 = "Replace" ascii //weight: 1
        $x_1_4 = "GetType" ascii //weight: 1
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCS_2147852633_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCS!MTB"
        threat_id = "2147852633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 20 16 a8 02 00 0d 2b 36 00 07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 1f 16 5d 6f ?? 01 00 0a 61 07 09 17 58 07 8e 69 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 06 11 06 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCT_2147852635_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCT!MTB"
        threat_id = "2147852635"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 20 16 a8 02 00 0d 2b 34 07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 1f 16 5d 6f ?? 00 00 0a 61 07 09 17 58 07 8e 69 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 09 15 58 0d 09 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCU_2147852641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCU!MTB"
        threat_id = "2147852641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 07 07 6f ?? 00 00 0a 07 6f ?? 00 00 0a 6f ?? 00 00 0a 0c 73 ?? 00 00 0a 0d 09 08 17 73 ?? 00 00 0a 13 04 11 04 06 16 06 8e 69 6f ?? 00 00 0a 09 6f ?? 00 00 0a 13 05 dd ?? 00 00 00 11 04 39 ?? 00 00 00 11 04 6f ?? 00 00 0a dc}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPVB_2147852645_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPVB!MTB"
        threat_id = "2147852645"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 08 94 0d 00 06 03 09 59 d1 13 04 12 04 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 0a 00 08 17 58 0c 08 07 8e 69 32 dc}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAJU_2147852789_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAJU!MTB"
        threat_id = "2147852789"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 07 8e 69 5d 13 06 07 11 06 91 13 07 08 11 05 1f 16 5d 6f ?? 00 00 0a d2 13 08 07 11 05 17 58 07 8e 69 5d 91 13 09 11 07 11 08 61 11 09 20 00 01 00 00 58 20 00 01 00 00 5d 59 13 0a 07 11 06 11 0a d2 9c 00 11 05 17 59 13 05 11 05 16 fe 04 16 fe 01 13 0b 11 0b 2d a5}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHS_2147852790_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHS!MTB"
        threat_id = "2147852790"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 11 07 08 11 07 91 11 04 61 09 11 06 91 61 28 ?? ?? ?? 0a 9c 11 06 1f 15 33 05 16 13 06 2b 06 11 06 17 58 13 06 11 07 17 58 13 07 11 07 08 8e 69 17 59 31 ca}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCW_2147852838_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCW!MTB"
        threat_id = "2147852838"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 07 07 6f ?? 00 00 0a 07 6f ?? 00 00 0a 6f ?? 00 00 0a 0c 73 ?? 00 00 0a 0d 09 08 17 73 ?? 00 00 0a 13 04 11 04 06 16 06 8e 69 6f ?? 00 00 0a 09 6f ?? 00 00 0a 13 05 de 26 11 04 2c 07 11 04 6f ?? 00 00 0a dc}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHU_2147852847_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHU!MTB"
        threat_id = "2147852847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1a 58 4a 07 8e 69 5d 91 61 28 ?? 00 00 06 03 06 1a 58 4a 1b 58 1a 59 03 8e 69 5d 91 59 20 fe 00 00 00 58 18 58 20 00 01 00 00 5d d2 9c 06 1a 58 06 1a 58 4a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHU_2147852847_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHU!MTB"
        threat_id = "2147852847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "H5K4H55HD5AP458FF48548" wide //weight: 1
        $x_1_2 = "Dodge" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCX_2147852921_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCX!MTB"
        threat_id = "2147852921"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 06 06 6f ?? 01 00 0a 06 6f ?? 01 00 0a 6f ?? 01 00 0a 13 04 73 ?? 01 00 0a 0c 08 11 04 17 73 ?? 01 00 0a 0d 09 07 16 07 8e 69 6f ?? 01 00 0a 08 6f ?? 01 00 0a 13 05 de 1e}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCY_2147852922_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCY!MTB"
        threat_id = "2147852922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 06 06 6f ?? 01 00 0a 06 6f ?? 01 00 0a 6f ?? 01 00 0a 13 05 73 ?? 00 00 0a 0c 08 11 05 17 73 ?? 01 00 0a 13 04 11 04 07 16 07 8e 69 6f ?? 01 00 0a 08 6f ?? 01 00 0a 13 06 de 1f}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCV_2147852927_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCV!MTB"
        threat_id = "2147852927"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 8e 2d 06 16 28 ?? 00 00 0a 20 88 13 00 00 28 ?? 00 00 0a 2b e1}  //weight: 2, accuracy: Low
        $x_1_2 = "MQ\\~ZFCYu[YyjIezDit2NahhLa|_h{vrw}=s|0|sy{fJZH" ascii //weight: 1
        $x_1_3 = "$e95a9913-034c-40d5-98c0-653b342eb00e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHP_2147852938_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHP!MTB"
        threat_id = "2147852938"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "23"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {4c 00 6f 00 61 00 64 00 00 23 51 00 75 00 61 00 6e 00 4c 00 79 00 42 00 61 00 6e 00 47 00 69 00 61 00 79 00 2e 00 43 00 43 00 4d}  //weight: 10, accuracy: High
        $x_5_2 = "Replace" wide //weight: 5
        $x_5_3 = "String1" wide //weight: 5
        $x_1_4 = "ToByte" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
        $x_1_6 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHT_2147852939_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHT!MTB"
        threat_id = "2147852939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "5S07RSGG8ZC488W4A955AT" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPWE_2147852949_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPWE!MTB"
        threat_id = "2147852949"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 40 00 00 0a 28 ?? ?? ?? 0a 13 04 28 ?? ?? ?? 0a 12 04 72 4e 03 00 70 28 ?? ?? ?? 0a 12 04 72 70 03 00 70 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 05 28 ?? ?? ?? 0a 12 04 72 70 03 00 70 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 06 28 ?? ?? ?? 06 28 ?? ?? ?? 0a 11 05 11 06}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAKM_2147853028_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAKM!MTB"
        threat_id = "2147853028"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 07 07 8e 69 5d 07 11 07 07 8e 69 5d 91 08 11 07 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 07 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 00 11 07 15 58 13 07 11 07 16 fe 04 16 fe 01 13 08 11 08 2d a4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JJ_2147853077_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JJ!MTB"
        threat_id = "2147853077"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 00 01 25 16 72 ?? ?? 00 70 a2 25 17 72 ?? ?? 00 70 a2 14 14 14 7e}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHV_2147853093_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHV!MTB"
        threat_id = "2147853093"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 05 11 0f 9a 1f 10 28 ?? 00 00 0a b4 6f ?? 00 00 0a 00 11 0f 17 d6 13 0f 11 0f 11 0e 31 df}  //weight: 1, accuracy: Low
        $x_1_2 = "DeleteMC" wide //weight: 1
        $x_1_3 = "Load" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHW_2147853094_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHW!MTB"
        threat_id = "2147853094"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 07 17 58 06 8e 69 5d 91 13 09 11 07 11 08 61 11 09 20 00 01 00 00 58 20 00 01 00 00 5d 59 13 0a 06 08 11 0a d2 9c 07 17 59}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCZ_2147853106_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCZ!MTB"
        threat_id = "2147853106"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {58 0b 2b 46 06 07 06 8e 69 5d 06 07 06 8e 69 5d 91 09 07 09 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 06 07 17 58 06 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 07 15 58 0b 07 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSUW_2147853127_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSUW!MTB"
        threat_id = "2147853127"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 28 16 00 00 0a 03 6f 17 00 00 0a 0a 02 02 8e 69 17 59 91 1f 70 61 0b 02 8e 69 8d 32 00 00 01 0c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDA_2147853129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDA!MTB"
        threat_id = "2147853129"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {58 0d 2b 48 00 07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 07 11 07 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDB_2147853206_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDB!MTB"
        threat_id = "2147853206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 41 00 20 00 53 00 44 00 41 00 53 00 53 00 41 00 53 00 41 00 53}  //weight: 2, accuracy: High
        $x_1_2 = "FinalProject.Resources" ascii //weight: 1
        $x_1_3 = "$9253ccfc-484b-4d84-b27d-e2ac7f11a13a" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDC_2147853207_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDC!MTB"
        threat_id = "2147853207"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 17 da 13 10 16 13 11 2b 25 11 07 11 11 17 8d ?? 00 00 01 25 16 11 06 11 11 9a 1f 10 28 ?? 00 00 0a 9c 6f ?? 00 00 0a 00 11 11 17 d6 13 11 11 11 11 10 31}  //weight: 1, accuracy: Low
        $x_1_2 = "SHYGFBJKHGFJ HGJKSF GJKFGHKSJFG HJGFGSJFS" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDD_2147853208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDD!MTB"
        threat_id = "2147853208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 09 15 58 0d 09 16 fe 04 16 fe 01 13 07 11 07 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDY_2147853227_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDY!MTB"
        threat_id = "2147853227"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ebd3b33d-6067-40aa-92f8-3bb0451932cb" ascii //weight: 1
        $x_1_2 = "22janX64" ascii //weight: 1
        $x_1_3 = "AutoOpen" ascii //weight: 1
        $x_1_4 = "AutoClose" ascii //weight: 1
        $x_1_5 = "AddIn" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVB_2147853357_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVB!MTB"
        threat_id = "2147853357"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {09 15 58 0d 09 16 2f b6 02 73 48 00 00 0a 7d 18 00 00 04 02 7b 18 00 00 04 6f ?? 00 00 0a 02 28 ?? 00 00 0a 07 28 ?? 00 00 0a 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVC_2147853358_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVC!MTB"
        threat_id = "2147853358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 07 28 e7 00 00 06 17 73 66 00 00 0a 0c 08 02 16 02 8e 69 28 ?? 00 00 06 08 28 ?? 00 00 06 06 28 ?? 00 00 06 0d 28 ?? 00 00 06 09 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDE_2147853378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDE!MTB"
        threat_id = "2147853378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 06 06 6f ?? 00 00 0a 06 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 73 ?? 00 00 0a 0c 08 07 17 73 ?? 00 00 0a 0d 28 ?? 00 00 06 16 9a 75 ?? 00 00 1b 13 04 09 11 04 16 11 04 8e 69 6f ?? 00 00 0a 08 6f ?? 00 00 0a 13 05 dd}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDF_2147853379_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDF!MTB"
        threat_id = "2147853379"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 09 15 58 0d 09 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDG_2147853380_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDG!MTB"
        threat_id = "2147853380"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 06 07 8e 69 5d 07 11 06 07 8e 69 5d 91 08 11 06 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 06 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 11 06 15 58 13 06 11 06 16 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "94HUAF4S5G505H95585A74" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AALC_2147887417_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AALC!MTB"
        threat_id = "2147887417"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 11 04 08 8e 69 5d 91 09 11 04 09 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 08 11 04 17 58 08 8e 69 5d 91 59 20 00 01 00 00 58 13 08 08 11 04 08 8e 69 5d 11 08 20 00 01 00 00 5d d2 9c 11 04 15 58 13 04 00 11 04 16 fe 04 16 fe 01 13 09 11 09 2d ae}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDH_2147887425_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDH!MTB"
        threat_id = "2147887425"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {58 4a 61 d2 61 d2 52 20 ?? 00 00 00 fe 0e 0a 00 00 fe 0c 0a 00 20 ?? 00 00 00 fe 01 39}  //weight: 1, accuracy: Low
        $x_1_2 = {25 47 fe 0c 01 00 fe 0c 02 00 91 61 d2 52 20 ?? 00 00 00 fe 0e 0a 00 00 fe 0c 0a 00 20 ?? 00 00 00 fe 01 39}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVD_2147888097_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVD!MTB"
        threat_id = "2147888097"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 6f 04 00 00 0a 17 3e 16 00 00 00 02 28 ?? 00 00 06 75 01 00 00 1b 28 ?? 00 00 0a 0b dd 14 00 00 00 06 0b dd 0d 00 00 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVE_2147888098_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVE!MTB"
        threat_id = "2147888098"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {26 20 01 00 00 00 38 c0 ff ff ff 11 07 11 07 28 ?? 00 00 06 11 07 28 ?? 00 00 06 6f ?? 00 00 0a 13 01}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVF_2147888099_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVF!MTB"
        threat_id = "2147888099"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 91 02 00 0a 73 bc 04 00 06 28 ?? 04 00 06 75 7c 00 00 1b 6f ?? 02 00 0a 0b 07 14 28 ?? 02 00 0a 2c 11 07 20 92 37 4d a6 28 ?? 05 00 06 6f ?? 02 00 0a 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AALM_2147888217_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AALM!MTB"
        threat_id = "2147888217"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 13 14 2b 19 00 11 06 11 14 11 06 11 14 91 20 ?? 04 00 00 59 d2 9c 00 11 14 17 58 13 14 11 14 11 06 8e 69 fe 04 13 15 11 15 2d d9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVJ_2147888234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVJ!MTB"
        threat_id = "2147888234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 08 11 08 28 ?? 00 00 06 11 08 28 ?? 00 00 06 6f ?? 00 00 0a 13 09}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVL_2147888235_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVL!MTB"
        threat_id = "2147888235"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 03 00 00 0a 72 01 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDJ_2147888264_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDJ!MTB"
        threat_id = "2147888264"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 07 09 17 58 07 8e 69 5d 91 59 20 00 01 00 00 58 13 08 07 09 07 8e 69 5d 11 08 20 00 01 00 00 5d d2 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 09 11 09 2d}  //weight: 1, accuracy: Low
        $x_1_2 = {07 09 07 8e 69 5d 91 08 09 08 6f ?? 01 00 0a 5d 6f ?? 01 00 0a 61 07 09 17 58 07 8e 69 5d 91 59 20 00 01 00 00 58 13 08 07 09 07 8e 69 5d 11 08 20 00 01 00 00 5d d2 9c 09 15 58 0d 09 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIA_2147888302_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIA!MTB"
        threat_id = "2147888302"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 56 00 71 00 51 00 28 06 98 06 cc 06 a9 06 d5 06 31 06 a9 06 48 06 a9 06 48 06 31 06 2f 06 33 06 2a 06 27 06 46 06 28 06 98 06 cc 06 a9 06 d5 06 31 06 a9 06 48 06 a9 06 48 06 31 06 2f 06 33 06 2a 06 27 06 46 06 4d 00}  //weight: 1, accuracy: High
        $x_1_2 = {a9 06 48 06 31 06 2f 06 33 06 2a 06 27 06 46 06 6e 00 4e 00 49 00 62 00 67 00 42 00 54 00 4d 00 30 00 68 00 56 00 47 00 68 00 70 00 63 00 79 00 42 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIB_2147888303_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIB!MTB"
        threat_id = "2147888303"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0c 2b 1b 07 08 06 08 91 20 9a 84 00 00 28 ?? ?? ?? 06 28 ?? 00 00 0a 59 d2 9c 08 17 58 0c 08 06 8e 69 32 df}  //weight: 1, accuracy: Low
        $x_1_2 = "Ckrkidaz.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVM_2147888314_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVM!MTB"
        threat_id = "2147888314"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 28 14 00 00 0a 75 04 00 00 1b 0a 06 8e 69 8d 15 00 00 01 0b 16 0c 2b 1b 07 08 06 08 91 20 9a 84 00 00 28 ?? 01 00 06 28 ?? 00 00 0a 59 d2}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVN_2147888315_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVN!MTB"
        threat_id = "2147888315"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 28 0c 00 00 06 75 16 00 00 01 28 ?? 00 00 06 28 ?? 00 00 2b 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVO_2147888316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVO!MTB"
        threat_id = "2147888316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 28 0c 00 00 06 75 04 00 00 1b 28 15 00 00 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBGZ_2147888483_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBGZ!MTB"
        threat_id = "2147888483"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {44 00 4e 00 37 00 34 00 36 00 35 00 35 00 32 00 42 00 31 00 36 00 33 00 46 00 36 00 46 00 43 00 35 00 46}  //weight: 10, accuracy: High
        $x_10_2 = {44 00 4e 00 37 00 34 00 36 00 35 00 35 00 32 00 42 00 31 00 36 00 33 00 35 00 39 00 46 00 39 00 45 00 33}  //weight: 10, accuracy: High
        $x_1_3 = "chromeNotEncode.exe" wide //weight: 1
        $x_1_4 = {77 ff b7 3f 09 1f 00 00 00 fa 25 33 00 16 c4 00 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ASDK_2147888508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDK!MTB"
        threat_id = "2147888508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {8e 69 5d 91 13 09 11 07 11 08 61 11 09 20 00 01 00 00 58 20 00 01 00 00 5d 59}  //weight: 1, accuracy: High
        $x_1_2 = "QuanLyQuanCafe.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDL_2147888624_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDL!MTB"
        threat_id = "2147888624"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 09 09 5d 13 0a 11 09 11 04 5d 13 0b 07 11 0a 91 13 0c 08 11 0b 6f ?? 00 00 0a 13 0d 07 11 09 17 58 09 5d 91 13 0e 11 0c 11 0d 61 11 0e 59 20 00 01 00 00 58 13 0f 07 11 0a 11 0f 20 00 01 00 00 5d d2 9c 11 09 17 59 13 09 11 09 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDM_2147888625_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDM!MTB"
        threat_id = "2147888625"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 8e 69 8d ?? 00 00 01 0b 16 0c 2b 1b 07 08 06 08 91 20 f2 52 00 00 28 ?? 03 00 06 28 ?? 00 00 0a 59 d2 9c 08 17 58 0c 08 06 8e 69 32 df}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAD_2147888633_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAD!MTB"
        threat_id = "2147888633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 06 07 8e 69 5d 07 11 06 07 8e 69 5d 91 08 11 06 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 11 06 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 11 06 15 58 13 06 11 06 16 2f af}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDN_2147888794_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDN!MTB"
        threat_id = "2147888794"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 11 07 08 11 07 91 11 04 61 09 11 06 91 61 28 ?? 00 00 0a 9c 11 06 1f 15 fe 01 13 09 11 09 2c 05 16 13 06 2b 06 11 06 17 58 13 06 11 07 17 58 13 07 00 11 07 08 8e 69 17 59 fe 02 16 fe 01 13 0a 11 0a 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVS_2147888830_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVS!MTB"
        threat_id = "2147888830"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 14 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a 20 02 00 00 00 38 10 fe ff ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVV_2147888831_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVV!MTB"
        threat_id = "2147888831"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {2b 63 72 0d 00 00 70 38 5f 00 00 00 1a 2d 1a 26 38 60 00 00 00 1b 2d 15 26 16 2d e4 38 5e 00 00 00 8e 69 17 2d 0e}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIE_2147889025_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIE!MTB"
        threat_id = "2147889025"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 07 09 91 06 09 06 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 d2 9c 09 17 58 0d 09 07 8e 69 32}  //weight: 1, accuracy: Low
        $x_1_2 = {20 76 83 00 00 28 ?? 00 00 06 0a 14 0b 28 ?? 00 00 06 0b 07 8e 69 8d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDZ_2147889047_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDZ!MTB"
        threat_id = "2147889047"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "6100db3f-47fe-457f-acdb-4e951e5c416e" ascii //weight: 1
        $x_1_2 = "MIS OrderStatus" ascii //weight: 1
        $x_1_3 = "love" ascii //weight: 1
        $x_1_4 = "Salida" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDO_2147889087_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDO!MTB"
        threat_id = "2147889087"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0c 2b 1b 07 08 06 08 91 20 [0-4] 28 ?? 00 00 06 28 ?? 00 00 0a 59 d2 9c 08 17 58 0c 08 06 8e 69 32}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIG_2147889115_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIG!MTB"
        threat_id = "2147889115"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 07 6f ?? 00 00 0a 17 73 7a 00 00 0a 0c 08 02 16 02 8e 69 6f cc 00 00 0a 08 6f ?? 00 00 0a 06 28 ?? 00 00 06 0d 09 2a}  //weight: 1, accuracy: Low
        $x_1_2 = "$a7a7a2d1-df00-4b15-b2cd-1cab99864b7f" ascii //weight: 1
        $x_1_3 = "DormAndMealPlanCalculator.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GAO_2147889133_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GAO!MTB"
        threat_id = "2147889133"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "3+|E2+|13+|||E6+|F6+|96+|37+|27+|56+|65+|}2+|97+|C6" wide //weight: 1
        $x_1_2 = "E2+|13+|||E6+|F6+|96+|37+|27+|56+|65+|47+|36+|57+|46+|F6" wide //weight: 1
        $x_1_3 = "D6+|F6+|34+|1}+|1}+|22+|||||||37+|47+|E6+|56" wide //weight: 1
        $x_1_4 = "D2+B7+4}+||2}+B7+2}+|A}+||91+F6+6}+||41+37+}" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDI_2147889136_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDI!MTB"
        threat_id = "2147889136"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0c 38 ?? 00 00 00 07 08 06 08 91 72 ?? 01 00 70 28 ?? 00 00 0a 59 d2 9c 08 17 58 0c 08 06 8e 69 32 e4}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAA_2147889168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAA!MTB"
        threat_id = "2147889168"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "6b43181c-0a0a-4354-be3e-9c355b1072d3" ascii //weight: 1
        $x_1_2 = "AVG SecureVPN" ascii //weight: 1
        $x_1_3 = "Cseqnmh" ascii //weight: 1
        $x_1_4 = "Producers" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDP_2147889290_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDP!MTB"
        threat_id = "2147889290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 08 8e 69 17 da 13 08 16 13 09 2b 23 09 11 09 17 8d ?? 00 00 01 25 16 08 11 09 9a 1f 10 28 ?? 00 00 0a 86 9c 6f ?? 00 00 0a 11 09 17 d6 13 09 11 09 11 08 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDP_2147889290_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDP!MTB"
        threat_id = "2147889290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 09 11 04 5d 13 0a 11 09 11 05 5d 13 0b 08 11 0a 91 13 0c 09 11 0b 6f ?? 00 00 0a 13 0d 08 11 09 17 58 11 04 5d 91 13 0e 11 0c 11 0d 61 11 0e 59 20 00 01 00 00 58 13 0f 08 11 0a 11 0f 20 00 01 00 00 5d d2 9c 00 11 09 17 59 13 09 11 09 16 fe 04 16 fe 01 13 10 11 10 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHY_2147889316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHY!MTB"
        threat_id = "2147889316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4c 00 6f 00 61 00 64 00 00 11 47 00 65 00 74 00 54 00 79 00 70 00 65 00 73 00 00 13 47 00 65 00 74 00 4d 00 65 00 74 00 68 00 6f 00 64 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDQ_2147889392_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDQ!MTB"
        threat_id = "2147889392"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 07 20 e8 03 00 00 73 ?? 00 00 0a 13 04 09 11 04 09 6f ?? 00 00 0a 1e 5b 6f ?? 00 00 0a 6f ?? 00 00 0a 09 11 04 09 6f ?? 00 00 0a 1e 5b 6f ?? 00 00 0a 6f ?? 00 00 0a 09 17 6f ?? 00 00 0a 08 09 6f ?? 00 00 0a 17 73 ?? 00 00 0a 13 05 11 05 02 16 02 8e 69 6f ?? 00 00 0a 11 05 6f ?? 00 00 0a dd}  //weight: 1, accuracy: Low
        $x_1_2 = {07 09 93 61 d1 9d 09 17 58 0d 09 06 32}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIL_2147889394_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIL!MTB"
        threat_id = "2147889394"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 a1 03 00 70 72 a7 03 00 70 6f ?? 00 00 0a 72 ab 03 00 70 72 b1 03 00 70}  //weight: 1, accuracy: Low
        $x_1_2 = {20 00 4c 00 6f 00 2d 00 61 00 64 00 20 00 00 03 2d 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIM_2147889395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIM!MTB"
        threat_id = "2147889395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 0f 17 8d ?? ?? ?? 01 25 16 11 05 11 0f 9a 1f 10 28 ?? 00 00 0a 9c 6f ?? 00 00 0a 00 11 0f 17 d6 13 0f 11 0f 11 0e 31 d5}  //weight: 1, accuracy: Low
        $x_1_2 = {72 29 09 00 70 72 2f 09 00 70 6f ?? 00 00 0a 0c 08 72 35 09 00 70 72 35 02 00 70}  //weight: 1, accuracy: Low
        $x_1_3 = {4c 00 6f 00 2d 00 61 00 64 00 20 00 01 03 2d 00 01 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AANV_2147889419_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AANV!MTB"
        threat_id = "2147889419"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 1b 11 04 5d 13 1c 11 1b 11 05 5d 13 1d 08 11 1c 91 13 1e 09 11 1d 6f ?? 00 00 0a 13 1f 08 11 1b 17 58 11 04 5d 91 13 20 11 1e 11 1f 61 11 20 59 20 00 01 00 00 58 13 21 08 11 1c 11 21 20 00 01 00 00 5d d2 9c 00 11 1b 17 59 13 1b 11 1b 16 fe 04 16 fe 01 13 22 11 22 2d a4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDR_2147889472_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDR!MTB"
        threat_id = "2147889472"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 07 8e 69 17 da 13 07 16 13 08 2b 22 08 11 08 17 8d ?? 00 00 01 25 16 07 11 08 9a 1f 10 28 ?? 00 00 0a 9c 6f ?? 00 00 0a 11 08 17 d6 13 08 11 08 11 07 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIN_2147890024_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIN!MTB"
        threat_id = "2147890024"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 0f 17 8d ?? 00 00 01 25 16 11 05 11 0f 9a 1f 10 28 ?? 00 00 0a b4 ?? 6f 9c 00 00 0a 00 11 0f 17 d6 13 0f 11 0f 11 0e 31 d4}  //weight: 1, accuracy: Low
        $x_1_2 = {20 00 4c 00 6f 00 2d 00 61 00 64 00 20 00 01 03 2d 00 01 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDS_2147890036_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDS!MTB"
        threat_id = "2147890036"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FZ88ZADZC5Z0BZ9AZCDZA4Z47Z48ZAAZD2Z9EZC2" wide //weight: 1
        $x_1_2 = "6Z80Z91Z4AZ1CZ61Z01ZA6Z0AZ07Z4FZE0Z53Z58Z6DZ99Z60" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDT_2147890040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDT!MTB"
        threat_id = "2147890040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 04 11 04 2c 50 08 07 28 ?? 00 00 0a 02 72 [0-4] 28 ?? 00 00 06 03 18 8c ?? 00 00 01 07 28 ?? 00 00 0a 17 8c ?? 00 00 01 28 ?? 00 00 0a 28 ?? 00 00 0a 18 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a b4 9c 07 09 12 01 28 ?? 00 00 0a 13 05 11 05 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "E#nt#r##yP###oin#t" wide //weight: 1
        $x_1_3 = "L###o####a#d##" wide //weight: 1
        $x_1_4 = "I###nv#o###ke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDU_2147890046_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDU!MTB"
        threat_id = "2147890046"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 11 10 17 8d ?? 00 00 01 25 16 11 06 11 10 9a 1f 10 28 ?? 00 00 0a b4 9c 6f ?? 00 00 0a 00 11 10 17 d6 13 10 11 10 11 0f 31}  //weight: 1, accuracy: Low
        $x_1_2 = "njkwdsh udhgkuyjdgykuwjdg" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSWY_2147890098_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSWY!MTB"
        threat_id = "2147890098"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 72 4f 00 00 70 02 28 ?? 00 00 0a 0b 07 28 ?? 00 00 0a 75 15 00 00 01 0c 08 72 2e 01 00 70 6f ?? 00 00 0a 00 08 6f ?? 00 00 0a 0d 09 6f ?? 00 00 0a 28 ?? 00 00 0a 73 26 00 00 0a 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXA_2147890100_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXA!MTB"
        threat_id = "2147890100"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 06 8e 69 2e 13 07 8d 06 00 00 01 0d 06 16 09 16 07 28 50 00 00 0a 09 0a 06 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXB_2147890101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXB!MTB"
        threat_id = "2147890101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 bd 01 00 0a 08 6f ?? 00 00 0a 6f ?? 01 00 0a 20 3e ed c0 07 28 ?? 01 00 06 6f ?? 01 00 0a 13 09 11 07 6f ?? 01 00 0a 16 31 1a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KBA_2147890145_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KBA!MTB"
        threat_id = "2147890145"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "0xfc,0xe8,0x8f,0x00,0x00,0x00" wide //weight: 1
        $x_1_2 = "PAGE_EXECUTE_READWRITE" wide //weight: 1
        $x_1_3 = "shellcode" wide //weight: 1
        $x_1_4 = "DllImport" wide //weight: 1
        $x_1_5 = "VirtualAlloc" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAI_2147890149_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAI!MTB"
        threat_id = "2147890149"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 40 02 7b ?? 00 00 04 6f ?? 00 00 0a 06 08 9a 6f ?? 00 00 0a 25 07 08 8f ?? 00 00 01 28 ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 17 8d ?? 00 00 01 25 16 07 08 99 a1 6f ?? 00 00 0a 26 08 17 58 0c 08 06 8e 69 32 ba}  //weight: 10, accuracy: Low
        $x_10_2 = "tYUykT1a8EPvDezRY6nb3CryqbhCNIMl70SpskdW6Xo=" wide //weight: 10
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIS_2147890280_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIS!MTB"
        threat_id = "2147890280"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {53 00 74 00 72 00 69 00 6e 00 67 00 31 00 00 05 3e 00 3c 00 00 03 7e 00 00 05 7b 00 7d 00 00 05 7d 00 7d 00 00 03 7d 00 00 03 30 00 00 0f 20 00 4c 00 6f 00 2d 00 61 00 64 00 20 00 00 03 2d 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 10, accuracy: High
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDV_2147890285_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDV!MTB"
        threat_id = "2147890285"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 0f 17 8d ?? 00 00 01 25 16 11 05 11 0f 9a 1f 10 28 ?? 00 00 0a b4 9c 6f ?? 00 00 0a 00 11 0f 17 d6 13 0f 11 0f 11 0e 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXC_2147890341_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXC!MTB"
        threat_id = "2147890341"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 01 00 00 70 28 ?? 00 00 0a 72 33 00 00 70 28 ?? 00 00 0a 6f 03 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXD_2147890342_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXD!MTB"
        threat_id = "2147890342"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 3c 45 00 00 28 ?? 0a 00 06 28 ?? 00 00 0a 20 d4 45 00 00 28 ?? 0a 00 06 28 ?? 00 00 0a 6f 04 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIT_2147890351_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIT!MTB"
        threat_id = "2147890351"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {72 ad 0b 00 70 72 b3 0b 00 70 6f ?? 00 00 0a 72 b7 0b 00 70 72 bd 0b 00 70}  //weight: 1, accuracy: Low
        $x_1_2 = {05 7d 00 7d 00 00 03 7d 00 00 03 30 00 00 0f 20 00 4c 00 6f 00 2d 00 61 00 64 00 20}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIU_2147890403_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIU!MTB"
        threat_id = "2147890403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {53 00 74 00 72 00 69 00 6e 00 67 00 31 00 00 05 3e 00 3c 00 00 03 7e 00 00 05 29 00 28 00 00 05 7d 00 7d 00 00 03 7d 00 00 03 30 00 00 0f 20 00 4c 00 6f 00 2d 00 61 00 64 00 20 00 00 03 2d 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 10, accuracy: High
        $x_1_2 = "InvokeMember" ascii //weight: 1
        $x_1_3 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDW_2147890489_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDW!MTB"
        threat_id = "2147890489"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {ff ff 00 11 11 72 ?? 00 00 70 28 ?? 00 00 0a 72 ?? 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 13 0f 20 06 00 00 00 7e ?? 02 00 04 7b ?? 02 00 04 39 ?? 00 00 00 26 20 07 00 00 00 38}  //weight: 1, accuracy: Low
        $x_1_2 = "Phurezjftgg.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAOY_2147890497_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAOY!MTB"
        threat_id = "2147890497"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 09 09 5d 13 0a 11 09 11 04 5d 13 0b 07 11 0a 91 13 0c 08 11 0b 6f ?? 00 00 0a 13 0d 02 07 11 09 28 ?? 00 00 06 13 0e 02 11 0c 11 0d 11 0e 28 ?? 00 00 06 13 0f 07 11 0a 11 0f 20 00 01 00 00 5d d2 9c 00 11 09 17 59 13 09 11 09 16 fe 04 16 fe 01 13 10 11 10 2d a7}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXJ_2147890551_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXJ!MTB"
        threat_id = "2147890551"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 22 00 00 0a 0c 08 6f 23 00 00 0a 28 ?? 00 00 0a 73 25 00 00 0a 0d 09}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXK_2147890552_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXK!MTB"
        threat_id = "2147890552"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 06 11 04 6f ?? 00 00 0a 73 08 00 00 06 11 04 6f ?? 00 00 0a 28 ?? 00 00 06 de 2e}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDX_2147891154_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDX!MTB"
        threat_id = "2147891154"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 1c 11 21 20 00 01 00 00 5d d2 9c 00 11 1b 17 59 13 1b 11 1b 16 fe 04 16 fe 01 13 22 11 22 2d}  //weight: 1, accuracy: High
        $x_1_2 = "G8FZHGX0A9PJ355847GIF8" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDY_2147891193_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDY!MTB"
        threat_id = "2147891193"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {13 20 07 11 1b 11 20 20 00 01 00 00 5d d2 9c 00 11 1a 17 59 13 1a 11 1a 16 fe 04 16 fe 01 13 21 11 21 2d}  //weight: 1, accuracy: High
        $x_1_2 = "H745G7GGE1GAJ45778B7C9" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASDZ_2147891194_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASDZ!MTB"
        threat_id = "2147891194"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 11 05 5d 13 06 06 11 07 5d 13 0b 07 11 06 91 13 0c 11 04 11 0b 6f ?? 00 00 0a 13 0d 02 07 06 28 ?? 00 00 06 13 0e 02 11 0c 11 0d 11 0e 28 ?? 00 00 06 13 0f 07 11 06 11 0f 20 00 01 00 00 5d d2 9c 06 17 59 0a 06 16 fe 04 16 fe 01 13 10 11 10 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIZ_2147891202_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIZ!MTB"
        threat_id = "2147891202"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 1c 11 0e 11 16 91 13 1d 11 14 11 1c 6f ?? 00 00 0a 13 1e 02 11 0e 11 0d 28 ?? 00 00 06 13 1f 02 11 1d 11 1e 11 1f 28 ?? 00 00 06 13 20 11 0e 11 16 11 20 20 00 01 00 00 5d d2 9c 11 0d 17 59 13 0d 11 0d 16 fe 04 16 fe 01 13 21 11 21 2d a4}  //weight: 1, accuracy: Low
        $x_1_2 = "questionsGenerator.Properties.Resources.resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXL_2147891205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXL!MTB"
        threat_id = "2147891205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7e f0 01 00 04 6f ?? 03 00 0a 74 d0 00 00 01 fe 09 00 00 8c 42 00 00 01 6f ?? 03 00 0a 74 19 00 00 01 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXM_2147891206_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXM!MTB"
        threat_id = "2147891206"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 15 00 00 06 11 07 28 ?? 00 00 06 28 ?? 00 00 06 20 00 00 00 00 7e df 01 00 04 7b 24 02 00 04 3a c9 ff ff ff 26}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXN_2147891207_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXN!MTB"
        threat_id = "2147891207"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 02 11 00 11 01 28 ?? 00 00 06 13 07 20 00 00 00 00 7e 0d 02 00 04 7b d8 01 00 04 39 0f 00 00 00 26}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIY_2147891261_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIY!MTB"
        threat_id = "2147891261"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {53 00 74 00 72 00 69 00 6e 00 67 00 31 00 00 05 2a 00 2a 00 00 03 7e 00 00 03 3a 00 00 05 7d 00 7d 00 00 03 7d 00 00 09 4c 00 6f 00 61 00 64 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 10, accuracy: High
        $x_1_2 = "GetTypes" ascii //weight: 1
        $x_1_3 = "GetMethod" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BAL_2147891264_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BAL!MTB"
        threat_id = "2147891264"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 38 00 00 00 00 20 88 13 00 00 28 ?? 00 00 0a 38 00 00 00 00 dd ?? 00 00 00 38 00 00 00 00 11 02 17 58 13 02 38}  //weight: 1, accuracy: Low
        $x_1_2 = "bll10.shop/gpAIHBIT" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBIW_2147891282_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBIW!MTB"
        threat_id = "2147891282"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "35"
        strings_accuracy = "High"
    strings:
        $x_20_1 = {0f 53 00 74 00 72 00 69 00 6e 00 67 00 31}  //weight: 20, accuracy: High
        $x_10_2 = {4c 00 6f 00 2d 00 61 00 64 00 20 00 00 03 2d 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 10, accuracy: High
        $x_10_3 = {4c 00 6f 00 61 00 64 00 00 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 10, accuracy: High
        $x_1_4 = "GetTypes" ascii //weight: 1
        $x_1_5 = "GetMethod" ascii //weight: 1
        $x_1_6 = "Replace" ascii //weight: 1
        $x_1_7 = "Split" ascii //weight: 1
        $x_1_8 = "ToInt32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 1 of ($x_10_*) and 5 of ($x_1_*))) or
            ((1 of ($x_20_*) and 2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_ASEA_2147891287_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEA!MTB"
        threat_id = "2147891287"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 10 11 0a 5d 13 11 11 10 11 0b 5d 13 12 11 08 11 11 91 13 13 11 09 11 12 6f ?? 00 00 0a 13 14 02 11 08 11 10 28 ?? 00 00 06 13 15 02 11 13 11 14 11 15 28 ?? 00 00 06 13 16 11 08 11 11 11 16 20 00 01 00 00 5d d2 9c 11 10 17 59 13 10 11 10 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEB_2147891293_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEB!MTB"
        threat_id = "2147891293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FUBHGSDOABJTGSCVDINFZSA4DSN5TXEYLNEBRWC3TON52CAYTFEBZHK3RANFXCARCPKMQG233EMUXA2DIKEQ" wide //weight: 1
        $x_1_2 = "JVNJAAADAAAAABAAAAAP77YAAC4AAAAAAAAAAACA" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXO_2147891316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXO!MTB"
        threat_id = "2147891316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 28 00 00 0a 20 00 00 00 00 3e 3b 00 00 00 28 ?? 00 00 0a 28 ?? 00 00 06 fe 0c 01 00 6f 27 00 00 0a 28 ?? 00 00 0a 6f 1a 00 00 0a 20 39 7c 19 14 28 ?? 02 00 06 28 ?? 00 00 06 20 2f 7c 19 14}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXP_2147891317_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXP!MTB"
        threat_id = "2147891317"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {fe 0c 03 00 28 a3 00 00 0a 28 17 02 00 06 fe 0e 04 00 73 6c 01 00 06 fe 0e 05 00 fe 0c 04 00 6f 13 02 00 06 6f 0c 01 00 0a fe 0e 0a 00}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXQ_2147891337_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXQ!MTB"
        threat_id = "2147891337"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0c 02 28 ?? 00 00 06 75 01 00 00 1b 73 06 00 00 0a 0d 09 07 16 73 07 00 00 0a 13 04 11 04 08 6f 08 00 00 0a 08 13 05 dd 29 00 00 00 11 04 39 07 00 00 00 11 04 6f 09 00 00 0a dc}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXR_2147891338_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXR!MTB"
        threat_id = "2147891338"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7b d1 00 00 04 6f ?? 00 00 0a 6f ?? 02 00 06 00 0b 07 28 ?? 02 00 06 0c 73 a0 00 00 06 0d 09 73 59 00 00 06 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXS_2147891339_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXS!MTB"
        threat_id = "2147891339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 b4 4b 00 00 28 ?? 00 00 06 28 ?? 00 00 06 13 01 20 00 00 00 00 7e 10 02 00 04 7b 27 02 00 04 3a bd ff ff ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEC_2147891377_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEC!MTB"
        threat_id = "2147891377"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {09 8e 69 17 da 13 08 16 0c 2b 20 11 04 08 17 8d ?? 00 00 01 25 16 09 08 9a 1f 10 28 ?? 00 00 0a b4 9c 6f ?? 00 00 0a 08 17 d6 0c 08 11 08 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJB_2147891385_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJB!MTB"
        threat_id = "2147891385"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4a 00 56 00 4e 00 4a 00 2a 00 41 00 44 00 2a 00 2a 00 41 00 42 00 2a 00 2a 00 41 00 50 00 37 00 37 00 59 00 2a 00 43 00 34 00 2a 00 2a 00 2a 00 2a 00 2a 00 41 00 43 00 2a 00 2a 00 2a}  //weight: 1, accuracy: High
        $x_1_2 = {55 00 58 00 41 00 32 00 44 00 49 00 4b 00 45 00 51 00 2a 00 2a 00 2a 00 2a 00 2a 00 41 00 55 00 43 00 46 00 2a 00 41 00 45 00 59 00 41 00 49 00 44 00 41 00 44 00 47 00 46 00 53 00 47}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAL_2147891396_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAL!MTB"
        threat_id = "2147891396"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {00 11 08 08 5d 13 09 11 08 09 5d 13 0a 06 11 09 91 13 0b 07 11 0a 6f ?? 00 00 0a 13 0c 02 06 11 08 28 ?? 00 00 06 13 0d 02 11 0b 11 0c 11 0d 28 ?? 00 00 06 13 0e 06 11 09 11 0e 20 00 01 00 00 5d d2 9c 00 11 08 17 59 13 08 11 08 16 fe 04 16 fe 01 13 0f 11 0f 2d a8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXT_2147891438_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXT!MTB"
        threat_id = "2147891438"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 72 2b 00 00 70 28 ?? 00 00 0a 72 5d 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 0b 73 12 00 00 0a 0c 02 28 ?? 00 00 06 75 01 00 00 1b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXU_2147891439_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXU!MTB"
        threat_id = "2147891439"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 00 72 37 00 00 70 28 ?? 00 00 06 72 69 00 00 70 28 ?? 00 00 0a 28 ?? 00 00 06 13 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXV_2147891440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXV!MTB"
        threat_id = "2147891440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 05 6f 2a 00 00 0a 00 02 7b 16 00 00 04 08 6f 2b 00 00 0a 1f 64 6a 5a 08 6f 2c 00 00 0a 5b 69 18 8d 55 00 00 01 25 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASED_2147891462_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASED!MTB"
        threat_id = "2147891462"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "KgITKoViAdal25K1P7aVXCdcR0iCZNKx" wide //weight: 1
        $x_1_2 = "Px9WkRUZDutOq4z6ha5U" wide //weight: 1
        $x_1_3 = "d4/0O7ZtDfO9ncOgS0uNmYL4275ClqQj" wide //weight: 1
        $x_1_4 = "lcE04s+00GtWowUF9Ut/VbTzrrJS8DIj" wide //weight: 1
        $x_1_5 = "MX171-9LY7-R17Y-V6KU-UY99P" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJC_2147891555_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJC!MTB"
        threat_id = "2147891555"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JVNJ*AD**A_**AP77Y*C4*****AC**" wide //weight: 1
        $x_1_2 = {41 00 51 00 2a 00 2a 00 2a 00 4f 00 44 00 36 00 35 00 41 00 34 00 41 00 46 00 55 00 5f 00 48 00 47 00 53 00 44 00 4f 00 41}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEE_2147891557_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEE!MTB"
        threat_id = "2147891557"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {26 20 88 13 00 00 28 ?? 00 00 0a 73 ?? 00 00 0a 0d 09 16 6f}  //weight: 2, accuracy: Low
        $x_1_2 = {43 04 41 04 42 04 30 04 3d 04 3e 04 32 04 3b 04 35 04 3d 04 38 04 4f 04 20 00 3a 04 40 04 35 04 34 04 38 04 42 04 3d 04 4b 04 3c 04 38 04 20 00 3e 04 40 04 33 04 30 04 3d 04 38 04 37 04 30 04 46 04 38 04 4f 04 3c 04 38 04}  //weight: 1, accuracy: High
        $x_1_3 = {3f 04 3e 04 42 04 40 04 35 04 31 04 38 04 42 04 35 04 3b 04 4f 04 20 00 37 04 30 04 20 00 41 04 3e 04 32 04 35 04 40 04 48 04 35 04 3d 04 38 04 35 04 20 00 3e 04 3f 04 35 04 40 04 30 04 46 04 38 04 39 04 20 00 3f 04 3e 04 20 00 34 04 3e 04 33 04 3e 04 32 04 3e 04 40 04 43 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSXZ_2147891600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSXZ!MTB"
        threat_id = "2147891600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 0c 20 fd 4d a8 22 28 ?? 00 00 06 28 ?? 00 00 06 20 da 4d a8 22 28 ?? 00 00 06 28 ?? 00 00 06 28 ?? 00 00 06 13 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYC_2147891683_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYC!MTB"
        threat_id = "2147891683"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 5f ff ff ff 28 ?? 00 00 0a 7e 01 00 00 04 02 08 6f 31 00 00 0a 28 ?? 00 00 0a a5 01 00 00 1b 0b 11 07}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYD_2147891684_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYD!MTB"
        threat_id = "2147891684"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 85 00 00 0a 11 07 1e d6 13 07 11 07 11 0b 3e 75 ff ff ff 73 88 00 00 0a 0d 09 07 6f ?? 00 00 0a 6f ?? 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAL_2147891720_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAL!MTB"
        threat_id = "2147891720"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 11 05 11 0b 8f ?? 00 00 01 25 71 ?? 00 00 01 11 04 11 0b 11 04 8e 69 5d 91 61 d2 81 ?? 00 00 01 00 11 0b 17 58 13 0b 11 0b 11 05 8e 69 fe 04 13 0f 11 0f 2d ca}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAM_2147891721_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAM!MTB"
        threat_id = "2147891721"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 07 09 17 58 07 8e 69 5d 91 59 20 ?? ?? 00 00 58 13 07 07 09 07 8e 69 5d 11 07 20 ?? ?? 00 00 5d d2 9c 09 15 58 0d 09 16 fe 04 16 fe 01 13 08 11 08 2d b7}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEF_2147891785_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEF!MTB"
        threat_id = "2147891785"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 11 0c 20 00 01 00 00 5d d2 9c 00 11 06 17 59 13 06 11 06 16 fe 04 16 fe 01 13 0d 11 0d 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "HT57TQ8H7ZR9P5087VZH82" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJD_2147891786_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJD!MTB"
        threat_id = "2147891786"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 8e 69 5d 13 05 07 11 04 6f ?? 00 00 0a 5d 13 08 06 11 05 91 13 09 11 04 11 08 6f ?? 00 00 0a 13 0a 02 06 07 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 06 11 05 11 0c 20 00 01 00 00 5d d2 9c 07 17 59 0b 07 16 fe 04 16 fe 01 13 0d 11 0d 2d a7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAP_2147891795_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAP!MTB"
        threat_id = "2147891795"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 06 07 8e 69 5d 13 07 11 06 08 6f ?? 00 00 0a 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? 00 00 0a 13 0a 02 07 11 06 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 11 0c 20 00 01 00 00 5d d2 9c 11 06 17 59 13 06 11 06 16 2f ac}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEG_2147891817_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEG!MTB"
        threat_id = "2147891817"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 11 06 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 11 0c 20 00 01 00 00 5d d2 9c 11 10 20 [0-4] 5a 20 [0-4] 61 38}  //weight: 1, accuracy: Low
        $x_1_2 = {11 06 07 8e 69 5d 13 07 20}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJF_2147891869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJF!MTB"
        threat_id = "2147891869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "sgfhjffffgdrfhddfhfffadfsfsscfgdb" ascii //weight: 1
        $x_1_2 = "ffchkffdafhfdsfsfj" ascii //weight: 1
        $x_1_3 = "jffffgfdsdfsdgkffff" ascii //weight: 1
        $x_1_4 = "fghhfgsffrfdfdfffdfdshfdasdfh" ascii //weight: 1
        $x_1_5 = "sgfhjffffgdrfhdfdfhfffadfsfsscfgdb" ascii //weight: 1
        $x_1_6 = "cfffdfafdffrsfsshdkfffgh" ascii //weight: 1
        $x_1_7 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYE_2147891894_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYE!MTB"
        threat_id = "2147891894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 20 65 0d d3 63 28 ?? 01 00 06 28 ?? 00 00 0a 20 46 0d d3 63 28 ?? 01 00 06 28 ?? 00 00 0a 6f 45 05 00 0a 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYF_2147891895_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYF!MTB"
        threat_id = "2147891895"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 05 00 00 0a 28 01 00 00 2b 6f 07 00 00 0a 0a 06 16 06 6f 08 00 00 0a 6f 09 00 00 0a 0a 06}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYG_2147891896_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYG!MTB"
        threat_id = "2147891896"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 00 20 8c 0f c1 05 28 ?? 00 00 06 28 ?? 00 00 06 20 ab 0f c1 05 28 ?? 00 00 06 28 ?? 00 00 0a 6f 35 00 00 0a 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAM_2147891902_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAM!MTB"
        threat_id = "2147891902"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {09 1b 62 11 09 60 0d 11 04 1b d6 13 04 11 04 1e fe 04 16 fe 01 13 0c 11 0c 2c 1f 11 05 09 11 04 1e da 1f 1f 5f 63 20 ?? 00 00 00 5f b4 6f ?? 00 00 0a 00 11 04 1e da 13 04 00 00 00 11 07 17 d6 13 07 11 07 11 06 6f ?? 00 00 0a fe 04 13 0d 11 0d 3a}  //weight: 4, accuracy: Low
        $x_1_2 = "NMVXHKSLUMVWQAU3ZON2GK3IAKRZGS3IAKJQW4ZDPNUAEM33SNUAHEZLTN52XEY3FJV" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAN_2147891903_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAN!MTB"
        threat_id = "2147891903"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 06 03 8e 69 5d 0b 06 04 6f ?? 00 00 0a 5d 0c 03 07 91 0d 04 08 6f ?? 00 00 0a 13 04 02 03 06 28 ?? 00 00 06 13 05 02 09 11 04 11 05 28 ?? 00 00 06 13 06 03 07 11 06 20 00 01 00 00 5d d2 9c 00 06 17 59 0a 06 16 fe 04 16 fe 01 13 07 11 07 2d ae}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCBT_2147892027_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCBT!MTB"
        threat_id = "2147892027"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 07 8e 69 5d 13 07 11 06 08 6f ?? ?? ?? ?? 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? ?? ?? ?? 13 0a 02 07 11 06 28 ?? ?? ?? ?? 13 0b 02 11 09 11 0a 11 0b 28 ?? ?? ?? ?? 13 0c 07 11 07 11 0c 20 ?? ?? ?? ?? 5d d2 9c 00 11 06 17 59 13 06 11 06 16 fe 04 16 fe 01 13 0d 11 0d 2d a1}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJG_2147892055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJG!MTB"
        threat_id = "2147892055"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JVNJ:AD::A_::AP77Y:C4:::::AC:::" wide //weight: 1
        $x_1_2 = "AQ::::::::A_QG4:AJ4:::Q::4AD:::" wide //weight: 1
        $x_1_3 = " Lo-ad " wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJK_2147892087_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJK!MTB"
        threat_id = "2147892087"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 1f 02 11 10 11 0f 28 ?? 01 00 06 13 20 02 11 1e 11 1f 11 20 28 ?? 01 00 06 13 21 11 10 11 18 11 21 20 00 01 00 00 5d d2 9c 11 0f 17 59 13 0f 11 0f 16 fe 04 16 fe 01 13 22 11 22 2d a4}  //weight: 1, accuracy: Low
        $x_1_2 = "projectqltss.Propertie" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GNW_2147892105_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GNW!MTB"
        threat_id = "2147892105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 13 05 28 ?? ?? ?? 0a 11 05 6f ?? ?? ?? 0a 13 06 11 06 28 ?? ?? ?? 0a 13 07 11 04 72 1c 01 00 70}  //weight: 10, accuracy: Low
        $x_1_2 = {04 3b 04 4f 04 20 00 37 04 30 04 20 00 41 04 3e 04 32 04 35 04 40 04 48 04 35 04 3d 04 38 04 35 04 20 00 3e 04 3f 04 35 04 40 04 30 04 46 04 38 04 39 04}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBHZ_2147892175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBHZ!MTB"
        threat_id = "2147892175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 16 0c 2b 1b 07 08 06 08 91 20 ?? ?? ?? ?? 28 ?? 00 00 06 28 ?? 00 00 0a 59 d2 9c 08 17 58 0c 08 06 8e 69 32 df}  //weight: 1, accuracy: Low
        $x_1_2 = {57 17 02 0a 09 07 00 00 00 fa 01 33 00 16 00 00 01 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NBM_2147892259_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NBM!MTB"
        threat_id = "2147892259"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "://glassclicker.xyz/auth.txt" wide //weight: 1
        $x_1_2 = "$68bfdfd9-4027-4c48-b9b8-131770f659f0" ascii //weight: 1
        $x_1_3 = "DownloadString" ascii //weight: 1
        $x_1_4 = "cimv2" wide //weight: 1
        $x_1_5 = "cps drops" wide //weight: 1
        $x_1_6 = "freeglass.resources" ascii //weight: 1
        $x_1_7 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPDI_2147892262_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPDI!MTB"
        threat_id = "2147892262"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0a 28 14 00 00 0a 06 6f ?? ?? ?? 0a 0b 28 ?? ?? ?? 0a 0c 08 07 6f ?? ?? ?? 0a 0d 09 28 ?? ?? ?? 0a 26 28 ?? ?? ?? 0a 74 13 00 00 01 13 04 11 04}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYK_2147892301_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYK!MTB"
        threat_id = "2147892301"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {61 38 27 fe ff ff 28 ?? 00 00 0a 7e 01 00 00 04 02 08 6f 2a 00 00 0a 28 ?? 00 00 0a a5 01 00 00 1b 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAQ_2147892360_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAQ!MTB"
        threat_id = "2147892360"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 06 07 8e 69 5d 13 07 11 06 08 6f ?? 00 00 0a 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? 00 00 0a 13 0a 02 07 11 06 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 02 11 0c 28 ?? 00 00 06 9c 11 06 17 59 13 06 11 06 16 2f ad}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJL_2147892362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJL!MTB"
        threat_id = "2147892362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4a 00 56 00 4e 00 4a 00 26 00 41 00 44 00 26 00 26 00 41 00 5f 00 26 00 26 00 41 00 50 00 37 00 37 00 59 00 26 00 43 00 34 00 26 00 26 00 26 00 26 00 26 00 41}  //weight: 1, accuracy: High
        $x_1_2 = {26 00 26 00 41 00 51 00 26 00 26 00 26 00 4f 00 44 00 36 00 35 00 41 00 34 00 41 00 46 00 55 00 5f 00 48 00 47 00 53 00 44 00 4f 00 41 00 5f 00 4a 00 54 00 47 00 53 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYN_2147892409_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYN!MTB"
        threat_id = "2147892409"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 11 05 02 6f 11 00 00 0a 00 11 05 6f 12 00 00 0a 00 11 04 16 6a 16 6f 13 00 00 0a 26 07 11 04 7e 17 00 00 0a 6f 15 00 00 0a 00 00 de 0d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GNX_2147892441_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GNX!MTB"
        threat_id = "2147892441"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "gyREdJKqTD/cborinew.txt" ascii //weight: 1
        $x_1_2 = "transfer.sh/get/4BmUkBGNO6/BANGG.txt" ascii //weight: 1
        $x_1_3 = "MKLP0998.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEH_2147892451_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEH!MTB"
        threat_id = "2147892451"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "qw8ynrEEKgs7WjyadB.PhmiYoQN07RAnehXwN" wide //weight: 2
        $x_1_2 = {ff ff 11 06 07 8e 69 5d 13 07}  //weight: 1, accuracy: High
        $x_1_3 = "F784JA7GA848I4ER8D7GH5" wide //weight: 1
        $x_1_4 = "H8AAB4H7FTZSF8VG5EC857" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_MBJN_2147892468_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJN!MTB"
        threat_id = "2147892468"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {03 04 61 05 59 20 00 01 00 00 58 2a}  //weight: 1, accuracy: High
        $x_1_2 = {11 09 09 5d 13 0a 11 09 11 04 5d 13 0b 07 11 0a 91 13 0c 08 11 0b 6f ?? 00 00 0a 13 0d 02 07 11 09 28 ?? 00 00 06 13 0e 02 11 0c 11 0d}  //weight: 1, accuracy: Low
        $x_1_3 = "H745G7GGE1GAJ45778B7C9" wide //weight: 1
        $x_1_4 = "System.Reflection.Assembly" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJP_2147892469_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJP!MTB"
        threat_id = "2147892469"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 0a 11 15 5d 13 16 11 0a 11 18 5d 13 1c 11 0b 11 16 91 13 1d 11 14 11 1c 6f ?? 00 00 0a 13 1e 02 11 0b 11 0a 28 ?? 00 00 06 13 1f 02 11 1d 11 1e 11 1f 28 ?? 00 00 06 13 20 11 0b 11 16 11 20 20 00 01 00 00 5d d2 9c 11 0a 17 59 13 0a 11 0a 16 fe 04 16 fe 01 13 21 11 21 2d a4}  //weight: 1, accuracy: Low
        $x_1_2 = "ccd05abe0750" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAR_2147892476_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAR!MTB"
        threat_id = "2147892476"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 11 07 08 8e 69 5d 13 08 11 07 09 6f ?? 00 00 0a 5d 13 09 08 11 08 91 13 0a 09 11 09 6f ?? 00 00 0a 13 0b 02 08 11 07 28 ?? 00 00 06 13 0c 02 11 0a 11 0b 11 0c 28 ?? 00 00 06 13 0d 08 11 08 02 11 0d 28 ?? 00 00 06 9c 00 11 07 17 59 13 07 11 07 16 fe 04 16 fe 01 13 0e 11 0e 2d a2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJQ_2147892498_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJQ!MTB"
        threat_id = "2147892498"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 13 05 06 11 06 5d 13 0a 07 11 05 91 13 0b 09 11 0a 6f ?? 00 00 0a 13 0c 02 07 06 28 ?? 00 00 06 13 0d 02 11 0b 11 0c 11 0d 28 ?? 00 00 06 13 0e 07 11 05 11 0e 20 00 01 00 00 5d d2 9c 06 17 59 0a 06 16 fe 04 16 fe 01 13 0f 11 0f 2d ae}  //weight: 1, accuracy: Low
        $x_1_2 = "quanlybanhang2022" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYO_2147892533_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYO!MTB"
        threat_id = "2147892533"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 0b 28 56 00 00 06 28 8d 00 00 0a 17 8d 5c 00 00 01 25 16 1f 5c 9d 6f 8e 00 00 0a 28 04 00 00 2b 0c 1a 13 08}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYQ_2147892534_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYQ!MTB"
        threat_id = "2147892534"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 22 00 00 0a 9a 28 ?? 00 00 0a 13 0c 11 0c 73 21 00 00 0a 11 0c 8e 69 6f 22 00 00 0a 9a 11 0b 28 ?? 00 00 0a 13 0d 72 66 8b 09 70 1e 28 ?? 00 00 06 72 6a 8b 09 70 28 ?? 00 00 0a 13 0e 11 0e 11 0d 28 ?? 00 00 0a 11 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEI_2147892556_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEI!MTB"
        threat_id = "2147892556"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "F784JA7GA848I4ER8D7GH5" wide //weight: 2
        $x_2_2 = "Jeopardy.Properties.Resources" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEJ_2147892557_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEJ!MTB"
        threat_id = "2147892557"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 11 12 28 ?? 00 00 06 13 17 02 11 15 11 16 11 17 28 ?? 00 00 06 13 18}  //weight: 1, accuracy: Low
        $x_1_2 = {11 12 07 8e 69 5d}  //weight: 1, accuracy: High
        $x_2_3 = "GVZTA85G5AACGS4745R8IH" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJR_2147892578_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJR!MTB"
        threat_id = "2147892578"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {03 04 61 05 59 20 0a 01 00 00 58 1f 0a 59 0a 2b 00}  //weight: 1, accuracy: High
        $x_1_2 = {07 11 09 11 0e 20 00 01 00 00 5d d2 9c 00 11 08 17 59 13 08}  //weight: 1, accuracy: High
        $x_1_3 = "SD557I84G7ZY47E7FZ527Y" wide //weight: 1
        $x_1_4 = "24e2a5950624" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYS_2147892580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYS!MTB"
        threat_id = "2147892580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 09 16 a3 01 00 00 1b 0b 11 07 20 4f e1 4e d0 5a 20 f8 29 3a 76 61 38 2e ff ff ff 28 ?? 00 00 0a 7e 01 00 00 04 02 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYT_2147892581_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYT!MTB"
        threat_id = "2147892581"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 2e 40 00 00 28 ?? 00 00 06 28 ?? 00 00 06 20 03 40 00 00 28 ?? 00 00 06 28 ?? 00 00 06 6f 03 00 00 0a 13 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAS_2147892637_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAS!MTB"
        threat_id = "2147892637"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 07 8e 69 5d 13 07 11 04 08 6f ?? 00 00 0a 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? 00 00 0a 13 0a 02 07 11 04 28 ?? 00 00 06 13 0b 02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 02 11 0c 28 ?? 00 00 06 9c 11 04 17 59 13 04 00 11 04 16 fe 04 16 fe 01 13 0d 11 0d 2d a2}  //weight: 5, accuracy: Low
        $x_5_2 = {03 8e 69 0a 03 04 17 58 06 5d 91 0b 2b 00 07 2a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEK_2147892657_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEK!MTB"
        threat_id = "2147892657"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {0a 06 06 6f ?? 03 00 0a 06 6f ?? 03 00 0a 6f ?? 03 00 0a 13 04 73 ?? 03 00 0a 0b 28 ?? 03 00 06 75 ?? 00 00 1b 73 ?? 03 00 0a 0c 08 11 04 16 73 ?? 03 00 0a 0d 09 07 6f ?? 03 00 0a 07 6f ?? 03 00 0a 13 05 de}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJT_2147892680_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJT!MTB"
        threat_id = "2147892680"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 0a 07 11 05 91 13 0b 09 11 0a 6f ?? 01 00 0a 13 0c 02 07 06 28 ?? 00 00 06 13 0d 02 11 0b 11 0c 11 0d 28 ?? 00 00 06 13 0e 07 11 05 11 0e 20 00 01 00 00 5d d2 9c 06 17 59 0a 06 16 fe 04 16 fe 01 13 0f 11 0f 2d ae}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJU_2147892682_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJU!MTB"
        threat_id = "2147892682"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {03 04 61 05 59 20 00 01 00 00 58 0a 2b 00}  //weight: 1, accuracy: High
        $x_1_2 = {13 06 03 07 11 06 20 00 01 00 00 5d d2 9c 00 06 17 59 0a}  //weight: 1, accuracy: High
        $x_1_3 = "8F5Y4FF7H525FDZS5G744D" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASCM_2147892759_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASCM!MTB"
        threat_id = "2147892759"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 17 58 13 07 11 07 20 00 01 00 00 5d 13 07 11 05 08 11 07 94 58 13 05 11 05 20 00 01 00 00 5d 13 05 08 11 07 94 13 06 08 11 07 08 11 05 94 9e 08 11 05 11 06 9e 08 08 11 07 94 08 11 05 94 58 20 00 01 00 00 5d 94 13 08 09 11 04 02 11 04 91 11 08 61 d2 9c 11 04 17 58 13 04 11 04 02 8e 69 32 9d}  //weight: 1, accuracy: High
        $x_1_2 = {20 e8 03 00 00 5a 28 ?? 00 00 0a 7e ?? 00 00 04 08 28 ?? 00 00 06 0b 06 17 58 0a 07 17 8d ?? 00 00 01 25 16 1f 20 9d 6f ?? 00 00 0a 0d 7e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEL_2147892764_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEL!MTB"
        threat_id = "2147892764"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 07 06 8e 69 5d 13 11 11 07 11 10 6f ?? 00 00 0a 5d 13 13 06 11 11 91 13 14 11 10 11 13 6f ?? 00 00 0a 13 15 02 06 11 07 28 ?? 00 00 06 13 16 02 11 14 11 15 11 16 28 ?? 00 00 06 13 17 06 11 11 02 11 17 28 ?? 00 00 06 9c 11 07 17 59 13 07 11 07 16 fe 04 16 fe 01 13 18 11 18 2d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEM_2147892765_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEM!MTB"
        threat_id = "2147892765"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 06 06 6f ?? 02 00 0a 06 6f ?? 02 00 0a 6f ?? 02 00 0a 13 04 73 ?? 00 00 0a 0b 28 ?? 0c 00 06 75 ?? 00 00 1b 73 ?? 01 00 0a 0c 08 11 04 16 73 ?? 02 00 0a 0d 09 07 6f ?? 02 00 0a 07 6f ?? 01 00 0a 13 05 de}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AASE_2147892781_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AASE!MTB"
        threat_id = "2147892781"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {70 0a 06 28 ?? 00 00 0a 74 ?? 00 00 01 0b 07 72 ?? 00 00 70 6f ?? 00 00 0a 00 07 6f ?? 00 00 0a 0c 08 6f ?? 00 00 0a 28 ?? 00 00 0a 73 ?? 00 00 0a 0d 09 6f ?? 00 00 0a 13 04 11 04 28 ?? 00 00 0a 13 05 2b 00 11 05 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAT_2147892834_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAT!MTB"
        threat_id = "2147892834"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 11 04 07 8e 69 5d 13 08 11 04 08 6f ?? 00 00 0a 5d 13 09 07 11 08 91 13 0a 08 11 09 6f ?? 00 00 0a 13 0b 02 07 11 04 28 ?? 00 00 06 13 0c 02 11 0a 11 0b 11 0c 28 ?? 00 00 06 13 0d 07 11 08 02 11 0d 28 ?? 00 00 06 9c 11 04 17 59 13 04 00 11 04 16 fe 04 16 fe 01 13 0e 11 0e 2d a2}  //weight: 5, accuracy: Low
        $x_5_2 = {03 04 61 05 59 20 00 01 00 00 58 0a 2b 00 06 2a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEN_2147892838_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEN!MTB"
        threat_id = "2147892838"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JTGSCVDINFZSA4DSN5TX~YLN~%RWC3TON52CAYTF~%ZHK3" wide //weight: 1
        $x_1_2 = "AQAQIAOMAHGADFA%WQAYQANQAHSA%#%L#ZIAOIAHGADJA%XQA3Q" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPX_2147892841_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPX!MTB"
        threat_id = "2147892841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 04 07 8e 69 5d 13 07 11 04 08 6f ?? ?? ?? 0a 5d 13 08 07 11 07 91 13 09 08 11 08 6f ?? ?? ?? 0a 13 0a 02 07 11 04 28 ?? ?? ?? 06 13 0b 02 11 09 11 0a 11 0b 28 ?? ?? ?? 06 13 0c 07 11 07 02 11 0c 28 ?? ?? ?? 06 9c 11 04 17 59 13 04}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJW_2147892857_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJW!MTB"
        threat_id = "2147892857"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 5d 13 0b 07 11 06 91 13 0c 11 05 11 0b 6f ?? 00 00 0a 13 0d 07 06 17 58 09 5d 91 13 0e 11 0c 11 0d 61 11 0e 59 20 00 01 00 00 58 13 0f 07 11 06 11 0f 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "Cluster_MGF.Proper" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYU_2147892893_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYU!MTB"
        threat_id = "2147892893"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 72 30 15 00 70 6f 92 00 00 0a 75 01 00 00 1b 0b 72 38 15 00 70 0c 19 8d 36 00 00 01 25 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYW_2147892894_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYW!MTB"
        threat_id = "2147892894"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 08 8d 05 00 00 01 0d 11 09 09 16 09 8e 69 28 ?? 00 00 0a 11 07 09 16 09 8e 69 6f 7c 00 00 0a de 0c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYX_2147892933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYX!MTB"
        threat_id = "2147892933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 75 1e 00 00 28 ?? 00 00 06 28 ?? 00 00 0a 13 0c 20 00 00 00 00 7e 2d 02 00 04 7b 3a 02 00 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYY_2147892934_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYY!MTB"
        threat_id = "2147892934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 0c 8e 69 28 ?? 00 00 06 00 11 0b 11 0c 16 11 0c 8e 69 28 ?? 00 00 06 11 0d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSYZ_2147892935_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSYZ!MTB"
        threat_id = "2147892935"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {09 11 04 07 11 04 91 06 59 d2 9c 11 04 17 58 13 04 11 04 07 8e 69 32 e8}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJX_2147892950_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJX!MTB"
        threat_id = "2147892950"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 05 06 11 05 91 08 61 07 11 04 91 61 d2 9c 11 04 1f 15}  //weight: 1, accuracy: High
        $x_1_2 = "E8Q749GBYG4D87F84G7U4J" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEO_2147892951_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEO!MTB"
        threat_id = "2147892951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 09 5d 13 05 06 11 07 5d 13 0a 07 11 05 91 13 0b 11 04 11 0a 6f ?? 00 00 0a 13 0c 07 06 17 58 09 5d 91 13 0d 11 0b 11 0c 61 11 0d 59 20 00 01 00 00 58 13 0e 07 11 05 11 0e 20 00 01 00 00 5d d2 9c 06 17 59 0a 06 16 fe 04 16 fe 01 13 0f 11 0f 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEP_2147892962_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEP!MTB"
        threat_id = "2147892962"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 11 08 58 17 58 17 59 11 07 11 09 58 17 58 17 59 6f ?? 00 00 0a 13 0a 12 0a 28 ?? 00 00 0a 13 0b 08 07 11 0b 9c 07 17 58 0b 11 09 17 58 13 09 00 11 09 17 fe 04 13 0c 11 0c 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEQ_2147892963_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEQ!MTB"
        threat_id = "2147892963"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "E8Q749GBYG4D87F84G7U4J" wide //weight: 1
        $x_1_2 = "QuanChi.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASER_2147892964_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASER!MTB"
        threat_id = "2147892964"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 07 09 17 58 07 8e 69 5d 91 59 20 00 01 00 00 58 13 07 07 09 07 8e 69 5d 11 07 20 00 01 00 00 5d d2 9c 09 15 58 0d 00 09 16 fe 04 16 fe 01 13 08 11 08 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "QuanLyKho.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASES_2147892991_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASES!MTB"
        threat_id = "2147892991"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 0a 11 0f 20 00 01 00 00 5d d2 9c 00 11 09 17 59 13 09 11}  //weight: 1, accuracy: High
        $x_1_2 = {11 09 09 5d 13 0a 11 09 11 04 5d 13 0b 07 11 0a 91 13 0c 08 11 0b}  //weight: 1, accuracy: High
        $x_1_3 = {13 0d 07 11 09 17 58 09 5d 91 13 0e}  //weight: 1, accuracy: High
        $x_1_4 = "InterViewCode.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASET_2147892992_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASET!MTB"
        threat_id = "2147892992"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 13 04 73 ?? 02 00 0a 0b 02 28 ?? 05 00 06 75 ?? 00 00 1b 73 ?? 02 00 0a 0c 08 11 04 16 73 ?? 02 00 0a 0d 09 07 6f ?? 02 00 0a 07 13 05 de}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AASN_2147892993_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AASN!MTB"
        threat_id = "2147892993"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 07 8e 69 5d 13 16 11 04 08 6f ?? 00 00 0a 5d 13 17 07 11 16 91 13 18 08 11 17 6f ?? 00 00 0a 13 19 02 07 11 04 28 ?? 00 00 06 13 1a 02 11 18 11 19 11 1a 28 ?? 00 00 06 13 1b 07 11 16 02 11 1b 28 ?? 00 00 06 9c 11 04 17 59 13 04 00 11 04 16 fe 04 16 fe 01 13 1c 11 1c 2d a2}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AASP_2147892994_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AASP!MTB"
        threat_id = "2147892994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 0d 11 15 5d 13 16 11 0d 11 18 5d 13 1c 11 0e 11 16 91 13 1d 11 14 11 1c 6f ?? 00 00 0a 13 1e 02 11 0e 11 0d 28 ?? 00 00 06 13 1f 02 11 1d 11 1e 11 1f 28 ?? 00 00 06 13 20 11 0e 11 16 11 20 20 00 01 00 00 5d d2 9c 11 0d 17 59 13 0d 11 0d 16 fe 04 16 fe 01 13 21 11 21 2d a4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEU_2147893060_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEU!MTB"
        threat_id = "2147893060"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = "nChi.Properties.Resources" wide //weight: 4
        $x_1_2 = "98HG43F7J7BYH5F47HHT5E" wide //weight: 1
        $x_1_3 = "E8Q749GBYG4D87F84G7U4J" wide //weight: 1
        $x_1_4 = "18S4H4FGEHV4FGGR47VBGE" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_PSZA_2147893077_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZA!MTB"
        threat_id = "2147893077"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {fe 0c 03 00 28 ?? 00 00 0a fe 0c 02 00 6f c0 01 00 06 6f 2f 00 00 0a 7d 3c 01 00 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZC_2147893079_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZC!MTB"
        threat_id = "2147893079"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 e7 28 69 67 28 ?? 01 00 06 6f 61 00 00 0a 1c 0d 2b b4 07 75 11 00 00 02 20 fe 00 00 00 20 b1 02 00 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEV_2147893146_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEV!MTB"
        threat_id = "2147893146"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "E600F6009600370027005600650002009700C6" wide //weight: 1
        $x_1_2 = {45 00 34 00 30 00 30 00 43 00 36 00 30 00 30 00 31 00 36 00 30 00 30 00 45 00 36 00 30 00 30 00 32 00 37 00 30 00 30 00 35 00 36 00 30 00 30 00 34 00 37 00 30 00 30 00 45 00 36 00 30 00 30 00 39 00 34 00 30 00 30 00 31}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJZ_2147893238_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJZ!MTB"
        threat_id = "2147893238"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {13 0b 02 07 11 04 28 ?? 00 00 06 13 0c 02 17 11 0a 11 0b 11 0c 28 ?? 00 00 06 13 0d 07 11 08 02 11 0d 28 ?? 00 00 06 9c 11 04 17 59 13 04 11 04 16 2f ac}  //weight: 1, accuracy: Low
        $x_1_2 = "G54Q737H5K544H5U855G77" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBJJ_2147893239_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBJJ!MTB"
        threat_id = "2147893239"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 02 07 91 72 2f 00 00 70 28 ?? 00 00 0a 59 d2 9c 07 17 58 0b 07 02 8e 69 32 e4}  //weight: 1, accuracy: Low
        $x_1_2 = {2f 00 2f 00 71 00 75 00 2e 00 61 00 78 00 2f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEW_2147893251_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEW!MTB"
        threat_id = "2147893251"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5d 91 13 0d 11 0b 11 0c 61 11 0d 59 20 00 01 00 00 58 13 0e 07 11 06 11 0e 20 00 01 00 00 5d d2 9c 06 17 59 0a 06 16 fe 04 16 fe 01 13 0f 11 0f 2d}  //weight: 1, accuracy: High
        $x_1_2 = "ThucTapNhom1.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKA_2147893256_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKA!MTB"
        threat_id = "2147893256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {54 00 65 00 7a 00 76 00 77 00 2e 00 4c 00 64 00 69 00 75 00 68 00 74 00 6a 00 74 00 68 00 77 00 00 11 58 00 62 00 72 00 68 00 63 00 6c 00 72 00 6f}  //weight: 1, accuracy: High
        $x_1_2 = {71 00 75 00 2e 00 61 00 78 00 2f 00 6d 00 44 00 48 00 6c 00 2e 00 70}  //weight: 1, accuracy: High
        $x_1_3 = "6d1d67150b15" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKA_2147893256_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKA!MTB"
        threat_id = "2147893256"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4a 00 56 00 4e 00 4a 00 23 00 41 00 44 00 23 00 23 00 41 00 60 00 23 00 23 00 41 00 50 00 37 00 37 00 59 00 23 00 43 00 34 00 23 00 23 00 23 00 23 00 23 00 41 00 43 00 23}  //weight: 1, accuracy: High
        $x_1_2 = {41 00 52 00 43 00 50 00 4b 00 4d 00 51 00 47 00 32 00 33 00 33 00 7e 00 4d 00 55 00 58 00 41 00 32 00 44 00 49 00 4b 00 7e 00 51 00 23 00 23 00 23 00 23 00 23 00 41 00 55 00 43 00 46 00 23 00 41 00 7e 00 59}  //weight: 1, accuracy: High
        $x_1_3 = {20 00 4c 00 6f 00 2d 00 61 00 64 00 20 00 01 03 2d 00 01 17 20 00 47 00 65 00 74 00 4d 00 65 00 74 00 68 00 6f 00 64 00 20 00 00 15 20 00 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEX_2147893327_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEX!MTB"
        threat_id = "2147893327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 8e 69 5d 13 05 07 11 04 6f ?? 00 00 0a 5d 13 09 06 11 05 91 13 0a 11 04 11 09 6f ?? 00 00 0a 13 0b 02}  //weight: 1, accuracy: Low
        $x_1_2 = {11 0a 11 0b 11 0c 28 ?? 00 00 06 13 0d 06 11 05 02 11 0d 28 ?? 00 00 06 9c 07 17 59 0b 07 16 fe 04 16 fe 01 13 0e 11 0e 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEY_2147893328_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEY!MTB"
        threat_id = "2147893328"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 16 0d 2b 11 08 09 06 09 91 7e ?? 01 00 04 59 d2 9c 09 17 58 0d 09 06 8e 69 fe 04 13 04 11 04 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZD_2147893340_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZD!MTB"
        threat_id = "2147893340"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {00 72 a9 01 00 70 28 ?? 00 00 06 0a 28 ?? 00 00 06 00 06 28 ?? 00 00 06 0b 07 14 fe 03 0c 08 2c 71}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZE_2147893341_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZE!MTB"
        threat_id = "2147893341"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 25 00 00 0a 28 ?? 00 00 0a a5 01 00 00 1b 0b 11 07 20 18 0d 6a c6 5a 20 c0 a2 17 f4 61 38 df fe ff ff 17 8d 01 00 00 1b 0d 7e 01 00 00 04 02 09 16 fe 1c 01 00 00 1b 28 ?? 00 00 0a 11 07}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZG_2147893405_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZG!MTB"
        threat_id = "2147893405"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {75 12 00 00 01 28 ?? 00 00 06 28 ?? 00 00 2b 72 33 00 00 70 6f 0c 00 00 0a 14 14 28 ?? 00 00 06 74 13 00 00 01 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZH_2147893406_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZH!MTB"
        threat_id = "2147893406"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {75 10 00 00 01 28 ?? 00 00 06 28 ?? 00 00 2b 72 55 00 00 70 6f 0b 00 00 0a 14 14 28 ?? 00 00 06 74 13 00 00 01 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASEZ_2147893411_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASEZ!MTB"
        threat_id = "2147893411"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 00 11 01 02 11 01 91 72 ?? 00 00 70 28 ?? 00 00 06 59 d2 9c 20 02 00 00 00 38 ?? ff ff ff 11 01 17 58 13 01 20 06 00 00 00 38}  //weight: 1, accuracy: Low
        $x_1_2 = "Yuyfizeaz.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AATI_2147893433_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AATI!MTB"
        threat_id = "2147893433"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 09 07 8e 69 5d 02 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a 9c 09 15 58 0d 09 16 2f b6}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZI_2147893434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZI!MTB"
        threat_id = "2147893434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {75 01 00 00 1b 28 ?? 00 00 06 28 ?? 00 00 06 2a 19 8c 08 00 00 01 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKE_2147893476_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKE!MTB"
        threat_id = "2147893476"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 06 8e 69 5d 02 06 07 06 8e 69 5d 91 11 04 07 11 04 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 06 07 17 58 06 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a 9c 07 15 58 0b 07 16 2f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKF_2147893477_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKF!MTB"
        threat_id = "2147893477"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 18 5b 02 08 18 28 ?? 00 00 06 1f 10 28 ?? 00 00 06 d2 9c 11 05}  //weight: 1, accuracy: Low
        $x_1_2 = "b226-edee4489b488" ascii //weight: 1
        $x_1_3 = "DLPK.Properties.Resource" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFA_2147893481_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFA!MTB"
        threat_id = "2147893481"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 02 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 28}  //weight: 1, accuracy: Low
        $x_1_2 = "GEG7F7Q5DG5P22C5S8CFZ5" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFB_2147893493_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFB!MTB"
        threat_id = "2147893493"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 91 08 09 08 28 ?? 00 00 06 5d 28 ?? 00 00 06 61 28 ?? 00 00 06 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 06 59 20 00 01 00 00 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZK_2147893515_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZK!MTB"
        threat_id = "2147893515"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 bf ff ff ff 28 ?? 00 00 06 75 01 00 00 1b 28 ?? 00 00 06 28 ?? 00 00 0a 2a 19 8c 09 00 00 01 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZL_2147893516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZL!MTB"
        threat_id = "2147893516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 bf ff ff ff 28 ?? 00 00 06 75 01 00 00 1b 28 ?? 00 00 06 28 ?? 00 00 06 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFC_2147893562_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFC!MTB"
        threat_id = "2147893562"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 02 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a d2 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a d2 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a d2 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 07 11 07 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GEG7F7Q5DG5P22C5S8CFZ5" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKH_2147893565_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKH!MTB"
        threat_id = "2147893565"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58}  //weight: 1, accuracy: Low
        $x_1_2 = "7HJP8HZPDUG48GD35GY845" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKI_2147893566_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKI!MTB"
        threat_id = "2147893566"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 07 06 8e 69 5d 91 11 04 07 11 04 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 06 07 17 58 06 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZM_2147893662_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZM!MTB"
        threat_id = "2147893662"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {75 10 00 00 01 28 ?? 00 00 06 28 ?? 00 00 2b 72 4f 00 00 70 6f 0b 00 00 0a 14 14 28 ?? 00 00 06 74 13 00 00 01 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZN_2147893663_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZN!MTB"
        threat_id = "2147893663"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 7b 85 00 00 04 7e 63 00 00 04 02 9a 7b 5a 00 00 04 9a 7c 31 00 00 04 fe 16 0d 00 00 02 6f 5f 00 00 0a a2 28 ?? 00 00 06 28 ?? 00 00 06 00 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZO_2147893664_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZO!MTB"
        threat_id = "2147893664"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {61 2b c7 28 ?? 00 00 06 0b 02 07 06 28 ?? 00 00 06 74 03 00 00 1b 7d 44 00 00 04 06 28 ?? 00 00 06 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKJ_2147893814_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKJ!MTB"
        threat_id = "2147893814"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4a 00 56 00 4e 00 4a 00 26 00 41 00 44 00 26 00 26 00 41 00 5f 00 26 00 26 00 41 00 50 00 37 00 37 00 59 00 26 00 43 00 34 00 26 00 26 00 26 00 26 00 26 00 41}  //weight: 1, accuracy: High
        $x_1_2 = {26 00 26 00 26 00 26 00 26 00 26 00 26 00 26 00 41 00 51 00 26 00 26 00 26 00 4f 00 44 00 36 00 35 00 41 00 34 00 41 00 46 00 55 00 5f 00 48 00 47}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFE_2147893822_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFE!MTB"
        threat_id = "2147893822"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 07 8e 69 5d 02 07 09 07 8e 69 5d 91 08 09 08 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a 9c 00 09 15 58 0d 09 16 fe 04 16 fe 01 13 08 11 08 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "GZB5S4AG8ZFEH1A78TZH5Z" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFF_2147893823_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFF!MTB"
        threat_id = "2147893823"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 06 8e 69 5d 02 06 07 06 8e 69 5d 91 09 07 09 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 06 07 17 58 06 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a 9c 07 15 58 0b 07 16 fe 04 16 fe 01 13 07 11 07 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZR_2147893874_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZR!MTB"
        threat_id = "2147893874"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3a e9 03 00 00 28 ?? 00 00 0a 13 2a 28 ?? 00 00 0a 13 2b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFG_2147893897_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFG!MTB"
        threat_id = "2147893897"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a d2 9c 08 18 58 0c 08 06 fe 04 0d 09 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "Windows_Pursuit.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKG_2147893903_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKG!MTB"
        threat_id = "2147893903"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "$9ac72904-22ff-4296-86c9-834e901c9c31" ascii //weight: 5
        $x_5_2 = "TriviaNow.QuestionDetails.resource" ascii //weight: 5
        $x_1_3 = "HexStringToByteArray" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
        $x_1_5 = "GetTypes" ascii //weight: 1
        $x_1_6 = "GetMethods" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKK_2147893912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKK!MTB"
        threat_id = "2147893912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4a 00 56 00 4e 00 4a 00 23 00 41 00 44 00 23 00 23 00 41 00 60 00 23 00 23 00 41 00 50 00 37 00 37 00 59 00 23 00 43 00 34 00 23 00 23 00 23 00 23 00 23 00 41 00 43 00 23 00 23 00 23 00 23 00 23 00 23 00 23 00 23 00 23 00 23 00 23 00 23 00 23}  //weight: 1, accuracy: High
        $x_1_2 = "8-f6ed2c0e30f6" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAV_2147893923_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAV!MTB"
        threat_id = "2147893923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0a 06 18 6f ?? 01 00 0a 00 06 18 6f ?? 01 00 0a 00 06 72 ?? ?? ?? 70 28 ?? 01 00 0a 6f ?? 01 00 0a 00 06 6f ?? 01 00 0a 0b 28 ?? 00 00 06 0c 07 08 16 08 8e 69 6f ?? 01 00 0a 0d 28 ?? 01 00 0a 09 6f ?? 01 00 0a 13 04 11 04}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAU_2147893947_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAU!MTB"
        threat_id = "2147893947"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0b 07 18 6f ?? 00 00 0a 00 07 18 6f ?? 00 00 0a 00 07 06 6f ?? 00 00 0a 00 02 07 28 ?? 00 00 06 00 2a}  //weight: 5, accuracy: Low
        $x_5_2 = {04 8e 69 0b 02 06 07 28 ?? 00 00 06 28 ?? 00 00 0a 6f ?? 00 00 0a 07 8c ?? 00 00 01 14 6f ?? 00 00 0a 26}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBB_2147893949_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBB!MTB"
        threat_id = "2147893949"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 0a 12 00 28 ?? 00 00 06 06 72 ?? 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 06 28 ?? 00 00 06 28 ?? 00 00 06 2a}  //weight: 2, accuracy: Low
        $x_2_2 = {6f 25 00 00 0a 03 16 03 8e 69 6f ?? 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBB_2147893949_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBB!MTB"
        threat_id = "2147893949"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {01 11 05 11 0a 74 ?? 00 00 1b 11 0c 11 07 58 11 09 59 93 61 11 0b 74 ?? 00 00 1b 11 09 11 0c 58 1f 11 58 11 08 5d 93 61 d1 6f ?? 00 00 0a 26 1f 10 13 0e}  //weight: 1, accuracy: Low
        $x_1_2 = {21 00 69 03 00 d8 d9 f1 ab ea 8e 16 5f df 71 d2 d5 ed 77 a7 e3 7a 94 5d 00 b5 70 d4 79 c1 05 b0 6b 63 9d 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZS_2147893957_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZS!MTB"
        threat_id = "2147893957"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {17 8d 25 00 00 01 80 1a 00 00 04 7e 1a 00 00 04 16 fe 06 45 00 00 06 9b 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZV_2147894000_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZV!MTB"
        threat_id = "2147894000"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 bf fe ff ff 11 02 28 ?? 00 00 06 13 06 20 07 00 00 00 38 ac fe ff ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZW_2147894001_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZW!MTB"
        threat_id = "2147894001"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 55 ff ff ff 11 01 11 0b 16 28 ?? 00 00 06 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAW_2147894015_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAW!MTB"
        threat_id = "2147894015"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 01 11 03 11 01 8e 69 5d 02 11 01 11 03 11 01 8e 69 5d 91 11 02 11 03 11 02 6f ?? 01 00 0a 5d 6f ?? 01 00 0a 61 28 ?? 02 00 06 11 01 11 03 17 58 11 01 8e 69 5d 91 28 ?? 02 00 06 59 20 00 01 00 00 58 28 ?? 02 00 06 28 ?? 02 00 06 9c 38}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAX_2147894016_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAX!MTB"
        threat_id = "2147894016"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 05 09 11 04 1e da 1f 1f 5f 63 20 ?? 00 00 00 5f b4 6f ?? 00 00 0a 00 11 04 1e da 13 04}  //weight: 2, accuracy: Low
        $x_2_2 = "_MAD4_NLQ4FQAMQIFODQWACVRAVYOCYANCCCX_" wide //weight: 2
        $x_2_3 = "HN_XWCACDMFZXGYIAKN4XG5DFNUX~IYLUM~AFC5L_NZGHSQ" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAY_2147894044_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAY!MTB"
        threat_id = "2147894044"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 01 11 03 11 01 8e 69 5d 02 11 01 11 03 11 01 8e 69 5d 91 11 02 11 03 11 02 6f ?? 01 00 0a 5d 28 ?? 02 00 06 61 28 ?? 01 00 0a 11 01 11 03 17 58 11 01 8e 69 5d 91 28 ?? 01 00 0a 59 20 00 01 00 00 58 28 ?? 02 00 06 28 ?? 01 00 0a 9c 20 ?? 00 00 00 38}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFD_2147894257_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFD!MTB"
        threat_id = "2147894257"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GDDEDFLKPkI22274jGDDjjD8DDDXvLRDLmG" ascii //weight: 1
        $x_1_2 = "22OhY7DDDDrQLfFjOP7SDDDzIjDDNP7222Ohg7DDDEPELfFjOP7SDDDzEjDDNP7222Ohl7DjPR7SDDDjvjzMZDDDDyEFDDDzVjDDDD" ascii //weight: 1
        $x_1_3 = "22WhT7DDDDjRLflIDDDDfjDDDDnDLDDDDMDFDrzj222S8nkGDD3jL8DDDYzMRDLmG" ascii //weight: 1
        $x_1_4 = "jJRDLmG.GDDEDILHDDDVELDDfUf7HUH22y8FlGDDDTYjDjOR7SZDDDDTDFDDDjEj" ascii //weight: 1
        $x_1_5 = "GDDEXHL22i2h2GGUTUH22S9ysGDDnEQ7DjPR7SDDDz9jzMDpzj2DDDDLDFDWzj222S9TtGDDn" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPPE_2147894264_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPPE!MTB"
        threat_id = "2147894264"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {07 11 06 18 6f ?? ?? ?? 0a 13 07 08 11 06 18 5b 11 07 1f 10 28 ?? ?? ?? 0a d2 9c 00 11 06 18 58 13 06 11 06 07 6f ?? ?? ?? 0a fe 04 13 08 11 08 2d cd}  //weight: 4, accuracy: Low
        $x_1_2 = "CinemaManagement.FrSuatChieu.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKM_2147894269_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKM!MTB"
        threat_id = "2147894269"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 00 08 18 58 0c 08 06 fe 04 0d 09 2d}  //weight: 1, accuracy: Low
        $x_1_2 = {5a 00 34 00 33 00 5a 00 5a 00 45 00 32 00 5a 00 5a 00 34 00 33 00 5a 00 5a 00 45 00 32 00 5a 00 5a 00 5a 00 33 00 5a 00 5a 00 45 00 32 00 5a 00 5a 00 34 00 33 00 5a 00 5a 00 5a 00 5a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKM_2147894269_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKM!MTB"
        threat_id = "2147894269"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JVNJ#AD##A%##AP77Y#C4#####AC############################AQ###OD65A4AFU%" wide //weight: 1
        $x_1_2 = "AQ|||OD65A4AFU_HGSDOA_JTGSCVDINFZSA4DSN5TX~Y" wide //weight: 1
        $x_1_3 = "####AQ###OD65A4AFU%HGSDOA%JTGSCVDINFZSA4DSN5TX~YLN~%RW" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAZ_2147894293_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAZ!MTB"
        threat_id = "2147894293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 17 d2 13 2e 11 17 1e 63 d1 13 17 11 15 11 0b 91 13 22 11 15 11 0b 11 23 11 22 61 19 11 20 58 61 11 2e 61 d2 9c 11 0b 17 58 13 0b 11 22 13 20 11 0b 11 27 32 a4}  //weight: 2, accuracy: High
        $x_2_2 = {11 25 11 14 11 0d 11 14 91 9d 11 14 17 58 13 14 11 14 11 1b 32 ea}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBD_2147894294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBD!MTB"
        threat_id = "2147894294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 07 06 8e 69 5d 02 06 07 06 8e 69 5d 91 11 04 07 11 04 6f ?? 00 00 0a 5d 6f ?? 01 00 0a 61 28 ?? 01 00 0a 06 07 17 58 06 8e 69 5d 91 28 ?? 01 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 01 00 0a 9c 07 15 58 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKN_2147894372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKN!MTB"
        threat_id = "2147894372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {6a 5d d4 91 08 11 07 08 8e 69 6a 5d d4 91 61 28 ?? 00 00 0a 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = "9C885G5745Y5JAB8488FEU" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKO_2147894373_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKO!MTB"
        threat_id = "2147894373"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {d4 06 07 06 8e 69 6a 5d d4 91 11 04 07 11 04 8e 69 6a 5d d4 91 61 28 ?? 00 00 0a 06 07 17 6a 58 06 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SSPP_2147894378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SSPP!MTB"
        threat_id = "2147894378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {13 04 09 73 ?? ?? ?? 0a 13 05 11 05 08 16 73 ?? ?? ?? 0a 13 06 11 06 11 04 6f ?? ?? ?? 0a 11 04 6f ?? ?? ?? 0a 0a de 2e}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKP_2147894422_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKP!MTB"
        threat_id = "2147894422"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {6a 5d d4 06 07 06 8e 69 6a 5d d4 91 09 07 09 8e 69 6a 5d d4 91 61 28 ?? 00 00 0a 06 07 17 6a 58 06 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFH_2147894532_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFH!MTB"
        threat_id = "2147894532"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 07 8e 69 6a 5d d4 07 11 07 07 8e 69 6a 5d d4 91 08 11 07 08 8e 69 6a 5d d4 91 61 28 ?? 00 00 0a 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFH_2147894532_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFH!MTB"
        threat_id = "2147894532"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0c 17 0d 2b 31 02 09 28 ?? 00 00 0a 03 09 03 6f ?? 00 00 0a 5d 17 d6 28 ?? 00 00 0a da 13 04 07 11 04 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a 0b 09 17 d6 0d 09 08 31}  //weight: 1, accuracy: Low
        $x_1_2 = "Invoke" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAUN_2147894545_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAUN!MTB"
        threat_id = "2147894545"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0b 07 18 6f ?? 00 00 0a 00 07 18 6f ?? 00 00 0a 00 07 72 c3 04 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 00 07 6f ?? 00 00 0a 0c 08 06 16 06 8e 69 6f ?? 00 00 0a 0d}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKQ_2147894552_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKQ!MTB"
        threat_id = "2147894552"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 00 08 18 58 0c 08 06 fe 04 0d 09 2d de}  //weight: 1, accuracy: Low
        $x_1_2 = "GiaoDien" ascii //weight: 1
        $x_1_3 = "Z3ZZE2ZZ13ZZE2ZZ13ZZE2ZZ13ZZ" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABC_2147894554_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABC!MTB"
        threat_id = "2147894554"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 11 07 07 8e 69 6a 5d d4 07 11 07 07 8e 69 6a 5d d4 91 08 11 07 08 8e 69 6a 5d d4 91 61 28 ?? 00 00 0a d2 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? 00 00 0a d2 59 20 00 ?? 00 00 58 20 00 ?? 00 00 5d 28 ?? 00 00 0a d2 9c 00 11 07 17 6a 58 13 07 11 07 07 8e 69 17 59 09 17 58 5a 6a fe 02 16 fe 01 13 08 11 08 2d 95}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABA_2147894569_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABA!MTB"
        threat_id = "2147894569"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 07 8e 69 5d 13 08 11 04 08 6f ?? 00 00 0a 5d 13 09 07 11 08 91 13 0a 08 11 09 6f ?? 00 00 0a 13 0b 02 07 11 04 28 ?? 00 00 06 13 0c 02 11 0a 11 0b 11 0c 28 ?? 00 00 06 13 0d 07 11 08 02 11 0d 28 ?? 00 00 06 9c 11 04 17 59 13 04 11 04 16 2f ad}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTAE_2147894584_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTAE!MTB"
        threat_id = "2147894584"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 74 0f 00 00 01 13 04 16 0b 2b 26 11 04 07 16 6f ?? 00 00 0a 13 08 12 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCDF_2147894600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCDF!MTB"
        threat_id = "2147894600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "keyLogger" ascii //weight: 1
        $x_1_2 = "screenLogger" ascii //weight: 1
        $x_1_3 = "IP Address:" wide //weight: 1
        $x_1_4 = "Time:" wide //weight: 1
        $x_1_5 = "CPU:" wide //weight: 1
        $x_1_6 = "OSFullName:" wide //weight: 1
        $x_1_7 = "RAM:" wide //weight: 1
        $x_1_8 = "EncryptedPassword" wide //weight: 1
        $x_1_9 = "Google\\Chrome\\User Data" wide //weight: 1
        $x_1_10 = "Network\\Cookies" wide //weight: 1
        $x_1_11 = "SELECT * FROM Win32_Processor" wide //weight: 1
        $x_1_12 = "Win32_NetworkAdapterConfiguration" wide //weight: 1
        $x_1_13 = "MacAddress" wide //weight: 1
        $x_1_14 = "chat_id" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFI_2147894613_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFI!MTB"
        threat_id = "2147894613"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 06 07 8e 69 6a 5d d4 07 11 06 07 8e 69 6a 5d d4 91 08 11 06 08 8e 69 6a 5d d4 91 61 28 ?? 00 00 0a 07 11 06 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? 00 00 0a 9c 00 11 06 17 6a 58 13 06 11 06 07 8e 69 17 59 09 17 58 5a 6a fe 02 16 fe 01 13 07 11 07 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "TRD87X7C58FQKBGG5BHBG7" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFJ_2147894618_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFJ!MTB"
        threat_id = "2147894618"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 8e 69 5d 13 05 07 11 05 91 13 06 08 11 04 1f 16 5d}  //weight: 1, accuracy: High
        $x_1_2 = {d2 13 07 07 11 04 17 58 07 8e 69 5d 91 13 08}  //weight: 1, accuracy: High
        $x_1_3 = {11 06 11 07 61 11 08 20 00 01 00 00 58 20 00 01 00 00 5d 59 13 09}  //weight: 1, accuracy: High
        $x_1_4 = "BankingSystemSimulation.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFK_2147894619_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFK!MTB"
        threat_id = "2147894619"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 07 8e 69 6a 5d d4 07 11 07 07 8e 69 6a 5d d4 91 08 11 07 08 8e 69 6a 5d d4 91 61 28 [0-5] 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 28 [0-5] 59 20 00 01 00 00 58 20 00 01 00 00 5d 28}  //weight: 1, accuracy: Low
        $x_1_2 = {11 07 07 8e 69 17 59 09 17 58 5a 6a fe 02 16 fe 01 13 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKR_2147894649_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKR!MTB"
        threat_id = "2147894649"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 07 07 8e 69 6a 5d d4 91 08 11 07 1f 16 6a 5d d4 91 61 28 ?? 00 00 0a 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
        $x_1_2 = "A52R7526444JSD1C9FHCH8" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKS_2147894650_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKS!MTB"
        threat_id = "2147894650"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 07 07 8e 69 6a 5d d4 07 11 07 07 8e 69 6a 5d d4 91 08 11 07 1f 16 6a 5d d4 91 61 28 ?? 00 00 06 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? 00 00 06 59 20 00 01 00 00 58 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCDH_2147894675_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCDH!MTB"
        threat_id = "2147894675"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 11 06 07 8e 69 6a 5d d4 07 11 06 07 8e 69 6a 5d d4 91 08 11 06 1f 16 6a 5d d4 91 61 28 ?? ?? ?? ?? d2 07 11 06 17 6a 58 07 8e 69 6a 5d d4 91 28 ?? ?? ?? ?? d2 59 20 ?? ?? ?? ?? 58 20 ?? ?? ?? ?? 5d 28 ?? ?? ?? ?? d2 9c 00 11 06 17 6a 58 13 06 11 06 07 8e 69 17 59 09 17 58 5a 6a fe 02 16 fe 01 13 07 11 07 2d 96}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTAJ_2147894737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTAJ!MTB"
        threat_id = "2147894737"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 d2 d6 ff ff 28 ?? 00 00 06 25 17 28 ?? 00 00 06 11 09 11 0b 28 ?? 00 00 06 13 04 20 0e 00 00 00 28 ?? 00 00 06 39 ac d6 ff ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFM_2147894892_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFM!MTB"
        threat_id = "2147894892"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 8e 69 6a 5d d4 91 08 11 ?? 08 8e 69 6a 5d d4 91 61 07 11 ?? 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 13 [0-4] 07 8e 69 6a 5d d4 11 ?? 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "O7554S5HZ4DRDP8K8CVHP8" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABD_2147894951_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABD!MTB"
        threat_id = "2147894951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 07 08 8e 69 6a 5d d4 91 61 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 ?? 00 00 58 13 08 07 11 07 07 8e 69 6a 5d d4 11 08 20 00 ?? 00 00 5d d2 9c 11 07 17 6a 58 13 07 11 07 07 8e 69 17 59 09 17 58}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTAM_2147895026_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTAM!MTB"
        threat_id = "2147895026"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 37 e1 ff ff 28 ?? 00 00 06 fe 0c 01 00 28 ?? 00 00 06 20 cf f2 45 fc 20 c9 e6 1e 1d 58 20 5f 6e bf 1e 61 65 20 d7 b7 db 07 58 20 04 00 00 00 63 8d 25 00 00 01 25}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBI_2147895064_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBI!MTB"
        threat_id = "2147895064"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 06 07 8e 69 6a 5d d4 91 08 11 06 08 8e 69 6a 5d d4 91 61 07 11 06 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 13 07 07 11 06 07 8e 69 6a 5d d4 11 07 20 00 01 00 00 5d d2 9c 00 11 06 17 6a 58 13 06 11 06 07 8e 69 17 59 09 17 58 5a 6a fe 02 16 fe 01 13 08 11 08 2d a2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFL_2147895073_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFL!MTB"
        threat_id = "2147895073"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 0c 08 18 8c ?? 00 00 01 28 ?? 00 00 0a a5 ?? 01 00 01 6f ?? 00 00 0a 00 08 18 8c ?? 00 00 01 28 ?? 00 00 0a a5 ?? 01 00 01 6f ?? 00 00 0a 00 08 72 ?? 0c 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 00 08 6f ?? 00 00 0a 0d 09 07 16 07 8e 69 6f ?? 00 00 0a 13 04 02 7b ?? 00 00 04 6f ?? 00 00 0a 00 02 28 ?? 00 00 0a 00 02 7b}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTAQ_2147895130_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTAQ!MTB"
        threat_id = "2147895130"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7d 0a 00 00 04 06 28 ?? 00 00 0a 00 72 01 00 00 70 28 ?? 00 00 0a 00 28 ?? 00 00 0a 0b 07 2c 15}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTAR_2147895131_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTAR!MTB"
        threat_id = "2147895131"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 73 13 00 00 0a 7d 0a 00 00 04 06 28 ?? 00 00 0a 00 72 01 00 00 70 28 ?? 00 00 0a 00 28 16 00 00 0a 0b 07 2c 15}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKU_2147895163_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKU!MTB"
        threat_id = "2147895163"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 07 07 8e 69 6a 5d d4 91 08 11 07 08 8e 69 6a 5d d4 91 61 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 13 08 07 11 07 07 8e 69 6a 5d d4 11 08 20 00 01 00 00 5d d2 9c 11 07}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABE_2147895167_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABE!MTB"
        threat_id = "2147895167"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 07 08 8e 69 6a 5d d4 91 61 07 11 07 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 ?? 00 00 58 13 08 11 07 07 8e 69 6a 5d 13 09 11 08 20 00 ?? 00 00 5d 13 0a 07 11 09 d4 11 0a d2 9c 11 07 17 6a 58 13 07}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFO_2147895174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFO!MTB"
        threat_id = "2147895174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0b de 03 26 de 00 07 2c ?? 07 8e 69 8d ?? 00 00 01 0c 16 0d 2b ?? 08 09 07 09 91 06 59 d2 9c 09 17 58 0d 09 07 8e 69 32 ed}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFP_2147895175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFP!MTB"
        threat_id = "2147895175"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 0b 28 ?? 00 00 06 13 0d 07 11 09 17 58 09 5d 91 13 0e}  //weight: 1, accuracy: Low
        $x_1_2 = {ff 11 09 11 04 5d 13 0b 11}  //weight: 1, accuracy: High
        $x_1_3 = {07 11 0a 11 0f 20 00 01 00 00 5d d2 9c 11}  //weight: 1, accuracy: High
        $x_1_4 = "Quantum.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEJ_2147895246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEJ!MTB"
        threat_id = "2147895246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 8e 69 5d 02 06 07 06 8e 69 5d 91 09 07 09 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a d2 06 07 17 58 06 8e 69 5d 91 28 ?? 00 00 0a d2 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a d2 9c 07 15 58 0b 07 16 fe 04 16 fe 01 13 07 11 07}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFQ_2147895297_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFQ!MTB"
        threat_id = "2147895297"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 06 8e 69 5d 02 06 07 06 8e 69 5d 91 11 04 07 11 04 6f}  //weight: 1, accuracy: High
        $x_1_2 = {0a 06 07 17 58 06 8e 69 5d 91 28 ?? ?? 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? ?? 00 0a 9c 07 15 58 0b 07 16 fe 04 16 fe 01 13 07 11 07 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBKD_2147895302_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBKD!MTB"
        threat_id = "2147895302"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {03 8e 69 0a 03 04 17 58 06 5d 91 0b 2b 00 07 2a}  //weight: 1, accuracy: High
        $x_1_2 = "$33223f42-403a-4f46-82c8-76156fe370e8" ascii //weight: 1
        $x_1_3 = "Jeopardy.Properties.Resources.resourc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEK_2147895303_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEK!MTB"
        threat_id = "2147895303"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 07 8e 69 5d 02 07 08 07 8e 69 5d 91 11 04 08 11 04 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 61 28 ?? 00 00 0a 07 08 17 58 07 8e 69 5d 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 00 00 0a 9c 08 15 58 0c 08 16 fe 04 16 fe 01 13 08 11 08 2d ab}  //weight: 1, accuracy: Low
        $x_1_2 = "QLTHUVIEN.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEM_2147895336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEM!MTB"
        threat_id = "2147895336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 8e 69 18 5a 1f 16 58 0c 2b 4b 08 07 8e 69 5d 13 05 08 11 04 6f ?? 00 00 0a 5d 13 09 07 11 05 91 13 0a 11 04 11 09 6f ?? 00 00 0a 13 0b 02 07 08 28 ?? 00 00 06 13 0c 02 11 0a 11 0b 11 0c 28 ?? 00 00 06 13 0d 07 11 05 02 11 0d}  //weight: 1, accuracy: Low
        $x_1_2 = "AppConnectData.Propertie" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEN_2147895356_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEN!MTB"
        threat_id = "2147895356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "30"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 02 18 d6 13 02 38 ?? 00 00 00 11 00 02 11 02}  //weight: 10, accuracy: Low
        $x_10_2 = {02 11 06 91 11 01 61 11 00 11 03 91 61 13 05}  //weight: 10, accuracy: High
        $x_10_3 = {62 02 03 04 18 6f ?? 00 00 0a 1f 10}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFS_2147895358_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFS!MTB"
        threat_id = "2147895358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {07 09 07 8e 69 5d 02 07 09 07 8e 69 5d 91 08 09 08 28 ?? 01 00 06 5d 28 ?? 01 00 06 61 28 ?? 01 00 06 d2 07 09 17 58 07 8e 69 5d 91 28 ?? 01 00 06 d2 59 20 00 01 00 00 58 28 ?? 01 00 06 28 ?? 01 00 06 d2 9c}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFN_2147895395_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFN!MTB"
        threat_id = "2147895395"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 00 0a 02 73 ?? 00 00 0a 7d ?? 00 00 04 06 28 ?? 00 00 0a 00 72 ?? 00 00 70 28 ?? 00 00 0a 00 28 ?? 00 00 0a 0b 07 2c 15}  //weight: 1, accuracy: Low
        $x_1_2 = {47 00 f6 00 6e 00 64 00 65 00 72 00 20 00 77 00 61 00 6c 00 74}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFR_2147895494_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFR!MTB"
        threat_id = "2147895494"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 09 11 0a 11 0b 28 ?? 00 00 06 13 0c 07 11 07 11 0c 20 00 01 00 00 5d d2 9c 00 11 06 17 59 13 06}  //weight: 1, accuracy: Low
        $x_1_2 = {11 06 07 8e 69 5d 13 07 11 06 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAB_2147895501_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAB!MTB"
        threat_id = "2147895501"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 6f 14 00 00 0a 28 15 00 00 0a 73 16 00 00 0a 0d 09 6f 17 00 00 0a 13 04 11 04 13 05 11 05}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PABX_2147895504_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PABX!MTB"
        threat_id = "2147895504"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "eYOfRgxX7gECwn7+ww652g==" wide //weight: 1
        $x_1_2 = "UEUD5hbHI+wN3g/u9dg4Sw==" wide //weight: 1
        $x_1_3 = "dO/lmNT3RI52P1afLQplFw==" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBH_2147895531_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBH!MTB"
        threat_id = "2147895531"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 00 06 18 6f ?? 00 00 0a 00 06 03 28 ?? 00 00 0a 6f ?? 00 00 0a 00 06 6f ?? 00 00 0a 0b 07 02 16 02 8e 69 6f ?? 00 00 0a 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBH_2147895531_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBH!MTB"
        threat_id = "2147895531"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {30 00 43 00 32 00 30 00 44 00 43 00 3c 00 3e 00 3c 00 3e 00 3c 00 3e 00 30 00 42 00 32 00 30 00 34 00 43 00 30 00 34 00 3c 00 3e 00 3c 00 3e 00 30 00 37 00 30 00 38 00 31 00 42 00 35 00 41 00 35 00 39 00 33 00 3c 00 3e}  //weight: 2, accuracy: High
        $x_2_2 = "4D5A9<><>3<><><>04<><><>FFFF<><>B8" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBJ_2147895538_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBJ!MTB"
        threat_id = "2147895538"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 00 0e 04 28 ?? 00 00 06 00 7e ?? 00 00 04 6f ?? 00 00 0a 05 16 03 8e 69 6f ?? 00 00 0a 0a 06 0b 2b 00 07 2a}  //weight: 2, accuracy: Low
        $x_2_2 = "SwdLfnwSNdfqjSHHdw0Sa" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAVS_2147895546_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAVS!MTB"
        threat_id = "2147895546"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 0a 06 28 ?? 00 00 0a 74 ?? 00 00 01 0b 07 20 5a 00 00 00 28 ?? 00 00 06 6f ?? 00 00 0a 00 07 6f ?? 00 00 0a 0c 08 6f ?? 00 00 0a 28 ?? 00 00 0a 73 ?? 00 00 0a 0d 09 6f ?? 00 00 0a 13 04 11 04 28 ?? 00 00 0a 13 05 38 00 00 00 00 11 05 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFT_2147895622_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFT!MTB"
        threat_id = "2147895622"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 06 18 5b 8d ?? 00 00 01 0b 16 0c 2b 1a 00 07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 00 08 18 58 0c 08 06 fe 04 0d 09 2d}  //weight: 1, accuracy: Low
        $x_4_2 = "B4>9CD21B8>14CCD21546869732>7>726:6772616D2>63616" wide //weight: 4
        $x_4_3 = "BA0E00B409CD21B8014CCD21546869732070726:6772616D2063616E6E6" wide //weight: 4
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*) and 1 of ($x_1_*))) or
            ((2 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_AMBK_2147895623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBK!MTB"
        threat_id = "2147895623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 1b d2 13 2d 11 1b 1e 63 d1 13 1b 11 1a 11 0b 91 13 29 11 1a 11 0b 11 25 11 29 61 11 1f 19 58 61 11 2d 61 d2 9c 11 29 13 1f 11 0b 17 58 13 0b 11 0b 11 28 32 a4}  //weight: 2, accuracy: High
        $x_2_2 = {11 24 11 12 11 0c 11 12 91 9d 11 12 17 58 13 12 11 12 11 15 32 ea}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFU_2147895661_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFU!MTB"
        threat_id = "2147895661"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {06 09 5d 13 05 06 11 08 5d 13 0a 06 17 58 09 5d 13 0b 07 11 05 91 11 04 11 0a 91 61 20 00 01 00 00 13 06 07 11 0b 91 59 11 06 58 11 06 5d 13 0c 07 11 05 11 0c d2 9c 06 17 58 0a 06 09 11 07 17 58 5a 32 bc}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEO_2147895690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEO!MTB"
        threat_id = "2147895690"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0c 08 11 0a 91 61 07 11 0b 91 59 11 0d 58 11 0d 5d 13 0e 07 11 09 11 0e d2 9c 11 06 17 58 13 06}  //weight: 1, accuracy: High
        $x_1_2 = "RZP448RN5VZ5AGC8757552" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFV_2147895708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFV!MTB"
        threat_id = "2147895708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {e4 02 f0 02 f4 02 0c 03 f8 02 e4 02 02 03 f3 02 12 03 e6 02 ef 02 f4 02 af 06 17 03 f1 02 0c 03 f0 02 12 03 f7 02 15 03 e0 02 eb 02 f3 02 0c 03 f4 02 ed 02 ef 02 0a 03 0a 03 12 03 f7 02 d0 02 cf 02 e7 02 f2 02 18 03 e0 02 ce 02 ec 02 e4 02 06 03 f4 02 f7 02 d1 02 af 06 af 06 ef 02 ce 02 16 03 e3 02 f2 02 d0 02 ef 02 d3 02 f2 02 cf 02 f8 02}  //weight: 2, accuracy: High
        $x_2_2 = {ea 02 00 03 f6 02 02 03 e5 02 f5 02 f6 02 0a 03 d3 02 ff 02 ce 02 cf 02 ef 02 f7 02 09 03 f0 02 e9 02 01 03 18 03 f3 02 d3 02 f8 02 05 03 e0 02 e8 02 02 03 f5 02 01 03 18 03 eb 02 f5 02 0a 03 f8 02 ec 02 09 03 d7 02 e3 02 f2 02 e5 02 cf 02 f4 02 f0 02 08 03 f0 02 ec 02 ef 02 0c 03 f7 02 d0 02 af 06 e6 02 0a 03 e3 02 ef 02 f3 02 02 03 e9 02 00 03 f4 02 0a 03 13 03 ef 02 f3 02 f4 02 0a 03 00 03 d1 02 e0 02 f7 02 00 03 f5 02 06 03 16 03 f0 02 09 03 11 03 af 06 03 03 0c 03 0a 03 17 03 f0 02 e5 02 16 03 0f 03 f5 02 f4 02 0e 03 d3 02 02 03}  //weight: 2, accuracy: High
        $x_1_3 = "EU4_Mod_Manager.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBM_2147895710_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBM!MTB"
        threat_id = "2147895710"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 1b d2 13 2d 11 1b 1e 63 d1 13 1b 11 1a 11 0b 91 13 29 11 1a 11 0b 11 25 11 29 61 11 1f 19 58 61 11 2d 61 d2 9c 11 29 13 1f 11 0b 17 58 13 0b 11 0b 11 28 32 a4}  //weight: 2, accuracy: High
        $x_2_2 = {11 24 11 12 11 0c 11 12 91 9d 17 11 12 58 13 12 11 12 11 15 32 ea}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBN_2147895716_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBN!MTB"
        threat_id = "2147895716"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 06 11 04 5d 13 19 11 06 11 05 5d 13 1a 11 06 17 58 11 04 5d 13 1b 07 11 19 91 13 1c 20 00 01 00 00 13 1d 11 1c 08 11 1a 91 61 07 11 1b 91 59 11 1d 58 11 1d 5d 13 1e 07 11 19 11 1e d2 9c 11 06 17 58 13 06 00 11 06 11 04 09 17 58 5a fe 04 13 1f 11 1f 2d a9}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEW_2147895728_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEW!MTB"
        threat_id = "2147895728"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 11 11 5d 13 13 06 11 17 5d 13 1a 06 17 58 11 11 5d 13 1b 11 0b 11 13 91 13 1c 20 00 01 00 00 13 14 11 1c 11 12 11 1a 91 61 11 0b 11 1b 91 59 11 14 58 11 14 5d 13 1d 11 0b 11 13 11 1d d2 9c 06 17 58 0a 06 11 11 11 16 17 58 5a fe 04 13 1e 11 1e 2d ac}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAVL_2147895737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAVL!MTB"
        threat_id = "2147895737"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "NeverUnderstand.Resources" wide //weight: 1
        $x_1_2 = "IsraelWillGiveYouTheRightAnswer" wide //weight: 1
        $x_1_3 = "CaXByNz" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCDS_2147895789_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCDS!MTB"
        threat_id = "2147895789"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 04 5d 13 0d 11 06 11 05 5d 13 0e 11 06 17 58 11 04 5d 13 0f 07 11 0d 91 13 10 20 ?? ?? ?? ?? 13 11 11 10 08 11 0e 91 61 07 11 0f 91 59 11 11 58 11 11 5d 13 12 07 11 0d 11 12 d2 9c 11 06 17 58 13 06 00 11 06 11 04 09 17 58 5a fe 04 13 13 11 13 2d a9}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBER_2147895837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBER!MTB"
        threat_id = "2147895837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 35 00 41 00 39 00 5f 00 5f 00 33 00 5f 00 5f 00 5f 00 30 00 34 00 5f 00 5f 00 5f 00 5b 00 5b 00 5b 00 5b 00 5f 00 5f 00 42 00 38 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 34 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFW_2147895911_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFW!MTB"
        threat_id = "2147895911"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 11 04 5d 13 06 11 05 1f 16 5d 13 07 11 05 17 58 11 04 5d 13 08 07 11 06 91 20 00 01 00 00 13 09 08 11 07 91 61 07 11 08 91 59 11 09 58 11 09 5d 13 0a 07 11 06 11 0a d2 9c 11 05 17 58 13 05 11 05 11 04 09 17 58 5a 32}  //weight: 1, accuracy: High
        $x_1_2 = "PGJ845Z45DHHF55558C98P" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBE_2147895922_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBE!MTB"
        threat_id = "2147895922"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0b 07 18 8c ?? 00 00 01 28 ?? 00 00 0a a5 ?? 00 00 01 6f ?? 00 00 0a 00 07 18 8c ?? 00 00 01 28 ?? 00 00 0a a5 ?? 00 00 01 6f ?? 00 00 0a 00 07 72 ?? 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 00 07 6f ?? 00 00 0a 0c 08 06 16 06 8e 69 6f ?? 00 00 0a 0d 17}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBF_2147895923_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBF!MTB"
        threat_id = "2147895923"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://qu.ax" wide //weight: 1
        $x_1_2 = "Kheiotrj+<Oikoherg>d__1" ascii //weight: 1
        $x_1_3 = "HttpClient" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAWH_2147895949_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAWH!MTB"
        threat_id = "2147895949"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {06 0a 12 00 28 ?? 00 00 06 06 72 43 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 06 28 ?? 00 00 06 28 ?? 00 00 06 2a}  //weight: 4, accuracy: Low
        $x_1_2 = "zzzXXXXXXXXX" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPQX_2147896062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPQX!MTB"
        threat_id = "2147896062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "EP0BRDsrktpBR336" ascii //weight: 1
        $x_1_2 = "msenchijKCatt" ascii //weight: 1
        $x_1_3 = "w00dgTSockeneDps" ascii //weight: 1
        $x_1_4 = "omqtzsoft7W285.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WF_2147896076_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WF!MTB"
        threat_id = "2147896076"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "19"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {fe 0e 00 00 38 00 00 00 00 fe 0c 00 00 45 02 00 00 00 57 00 00 00 20 00 00 00 38 52 00 00 00 28 1e 00 00 0a 14 fe 06 16 00 00 06 73 1f 00 00 0a 6f 20 00 00 0a 38 1b 00 00 00 17 3a 48 00 00 00 20 00 00 00 00 7e 76 00 00 04 3a be ff ff ff 26 38 b4 ff ff ff}  //weight: 10, accuracy: High
        $x_3_2 = "MulticastDelegate" ascii //weight: 3
        $x_3_3 = "ProccesorDecoratorResolver" ascii //weight: 3
        $x_3_4 = "ProxyAttributePool" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JKIN_2147896114_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JKIN!MTB"
        threat_id = "2147896114"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {03 11 04 1c 58 1c 58 28 ?? ?? ?? 0a 13 1c 03 11 04 1e 58 1e 58 28 ?? ?? ?? 0a 13 0a 03 11 04 1f 14 58 28 ?? ?? ?? 0a 13 1d 11 0a 16 fe 03 13 1e 11 1e 2c 3e 11 0a 8d 10 00 00 01 13 05 03 11 1d 11 05 16 11 05 8e 69 28 ?? ?? ?? 0a 06 7b 23 00 00 04 09 11 1c 58 11 05 11 05 8e 69 12 28 28 ?? ?? ?? 06 16 fe 01 13 1f 11 1f 2c 06 73 82 00 00 0a 7a 11 04 1f 28 58 13 04 11 06 17 58 13 06 11 06 11 11 fe 04 13 20 11 20 3a 72 ff ff ff}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEU_2147896135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEU!MTB"
        threat_id = "2147896135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 08 5d 0d 06 1f 16 5d 13 0b 06 17 58 08 5d 13 0c 07 09 91 13 0d 20 00 01 00 00 13 04 11 0d 11 06 11 0b 91 61 07 11 0c 91 59 11 04 58 11 04 5d 13 0e 07 09 11 0e d2 9c 06 17 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GYA_2147896143_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GYA!MTB"
        threat_id = "2147896143"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {38 81 00 00 00 38 86 00 00 00 1a 2c 60 17 2c 5e 38 81 00 00 00 38 82 00 00 00 7d 04 00 00 04 00 38 7d 00 00 00 38 82 00 00 00 38 83 00 00 00 38 84 00 00 00 38 89 00 00 00 fe 06 0d 00 00 06 73 2e 00 00 0a 28 ?? ?? ?? 2b 25 2d 09 26 1e 2c b0 72 75 01 00 70 0c 07 08 6f ?? ?? ?? 0a 0d 73 31 00 00 0a 13 04 09 11 04 6f ?? ?? ?? 0a 00 11 04 6f ?? ?? ?? 0a 13 05 11 05 13 06 1c 2c e7 18 2c 9f 2b 00 11 06 2a 73 0c 00 00 06 38 75 ff ff ff 0a 38 74 ff ff ff 06 38 79 ff ff ff 02 38 78 ff ff ff 28 ?? ?? ?? 0a 38 79 ff ff ff 0b 38 78 ff ff ff 07 38 77 ff ff ff 6f ?? ?? ?? 0a 38 72 ff ff ff 06 38 71 ff ff ff}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_WOWF_2147896146_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.WOWF!MTB"
        threat_id = "2147896146"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {09 11 04 91 61 d2 9c 00 11 04 17 58 13 04 11 04 09 8e 69 fe 04 13 05 11 05 2d d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ANOO_2147896149_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ANOO!MTB"
        threat_id = "2147896149"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 02 11 07 11 01 02 11 07 18 5a 18 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFX_2147896224_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFX!MTB"
        threat_id = "2147896224"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 06 07 8e 69 6a 5d d4 91 08 11 06 08 8e 69 6a 5d d4 91 61 07 11 06 17 6a 58 07 8e 69 6a 5d d4 91 59 20 00 01 00 00 58 13 07}  //weight: 1, accuracy: High
        $x_1_2 = {07 11 06 07 8e 69 6a 5d d4 11 07 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAA_2147896227_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAA!MTB"
        threat_id = "2147896227"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = {08 11 0a 11 09 6f 6c 00 00 0a 13 0b 16 13 0c 11 05 11 08 9a 72 b3 02 00 70 28 6d 00 00 0a 2c 0b 12 0b 28 6e 00 00 0a 13 0c 2b 36 11 05 11 08 9a 72 b7 02 00 70 28 6d 00 00 0a 2c 0b 12 0b 28 6f 00 00 0a 13 0c 2b 1a 11 05 11 08 9a 72 bb 02 00 70 28 6d 00 00 0a 2c 09 12 0b 28 70 00 00 0a 13 0c 07 11 0c 6f 71 00 00 0a 11 0a 17 58 13 0a 11 0a 09 32 8c}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAB_2147896231_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAB!MTB"
        threat_id = "2147896231"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 09 11 04 11 07 58 11 06 11 08 58 6f ?? 00 00 0a 13 09 12 09 28 ?? 00 00 0a 13 0a 08 07 11 0a 9c 07 17 58 0b 11 08 17 58 13 08 00 11 08 17 fe 04 13 0b 11 0b 2d c9}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAH_2147896233_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAH!MTB"
        threat_id = "2147896233"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2b 09 11 04 6f ?? 00 00 0a 13 05 07 11 05 28 ?? 00 00 0a 08 da 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 0a 0b 00 11 04 17 d6 13 04 11 04 09 6f ?? 00 00 0a fe 04 13 06 11 06 2d c5}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEV_2147896239_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEV!MTB"
        threat_id = "2147896239"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 17 58 11 04 5d 13 0a 07 11 08 91 08 11 09 91 61 20 00 01 00 00 13 0b 07 11 0a 91 59 11 0b 58 11 0b 5d 13 0c 07 11 08 11 0c d2 9c 11 07 17 58 13 07}  //weight: 1, accuracy: High
        $x_1_2 = "THB5Z8GHCFU44845HW5CY7" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAG_2147896268_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAG!MTB"
        threat_id = "2147896268"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 0f 17 8d ?? 00 00 01 25 16 11 05 11 0f 9a 1f 10 28 ?? 00 00 0a 86 9c 6f ?? 00 00 0a 00 11 0f 17 d6 13 0f 11 0f 11 0e 31 d4}  //weight: 1, accuracy: Low
        $x_1_2 = {4c 00 6f 00 2d 00 61 00 64 00 20 00 01 03 2d 00 01 11 44 00 65 00 6c 00 65 00 74 00 65 00 4d 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAJ_2147896271_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAJ!MTB"
        threat_id = "2147896271"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 25 4b 11 0c 11 0f 1f 0f 5f 95 61 54 11 0c 11 0f 1f 0f 5f 11 0c 11 0f 1f 0f 5f 95 11 05 25 1a 58 13 05 4b 61 20 ?? ?? ?? ?? 58 9e 11 0f 17 58 13 0f 11 16 17 58 13 16 11 16 11 06 37 c1}  //weight: 5, accuracy: Low
        $x_1_2 = "NMKLPO.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAJ_2147896271_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAJ!MTB"
        threat_id = "2147896271"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {07 03 17 8d ?? 00 00 01 25 16 09 20 ?? ?? 00 00 d6 8c ?? 00 00 01 a2 14 28 ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a 00 09 17 d6 0d 09 08 31 d0}  //weight: 3, accuracy: Low
        $x_1_2 = {03 08 04 08 1f 09 5d 9a 28 ?? 00 00 0a 03 08 91 28 ?? 00 00 06 28 ?? 00 00 0a 9c 08 17 d6 0c 08 07 31 dd}  //weight: 1, accuracy: Low
        $x_1_3 = "Ljrorarjdr" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KAAQ_2147896281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KAAQ!MTB"
        threat_id = "2147896281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 11 1a 09 5d 13 1b 11 1a 11 04 5d 13 1c 07 11 1b 91 13 1d 08 11 1c 6f ?? 00 00 0a 13 1e 02 07 11 1a 28 ?? 00 00 06 13 1f 02 11 1d 11 1e 11 1f 28 ?? 00 00 06 13 20 07 11 1b 11 20 20 ?? ?? 00 00 5d d2 9c 00 11 1a 17 59 13 1a 11 1a 16 fe 04 16 fe 01 13 21 11 21 2d a7}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEX_2147896316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEX!MTB"
        threat_id = "2147896316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0e 11 05 11 0c 91 61 11 04 11 0d 91 59 11 0f 58 11 0f 5d 13 10 11 04 11 0b 11 10 d2 9c 11 08 17 58 13 08 00 11 08 11 07 11 06 17 58 5a fe 04 13 11 11 11 2d a4}  //weight: 1, accuracy: High
        $x_1_2 = "78BS7GF85AT8PQG4F9874Y" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABG_2147896317_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABG!MTB"
        threat_id = "2147896317"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 07 11 04 5d 13 08 11 07 1f 16 5d 13 09 11 07 17 58 11 04 5d 13 0a 07 11 08 91 13 0b 20 00 ?? 00 00 13 0c 11 0b 08 11 09 91 61 07 11 0a 91 59 11 0c 58 11 0c 5d 13 0d 07 11 08 11 0d d2 9c 11 07 17 58 13 07 11 07 11 04 09 17 58 5a 32 b1}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABOM_2147896332_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABOM!MTB"
        threat_id = "2147896332"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "CellularAutomatonSimulation.MainForm.resources" ascii //weight: 3
        $x_1_2 = "ErrorDetectionSimulator.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAC_2147896364_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAC!MTB"
        threat_id = "2147896364"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 01 6f 1a 00 00 0a 13 02}  //weight: 2, accuracy: High
        $x_2_2 = {11 06 28 13 00 00 0a 13 05 20 01}  //weight: 2, accuracy: High
        $x_2_3 = {11 00 28 16 00 00 0a 74 1b 00 00 01 13 01}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMAO_2147896392_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMAO!MTB"
        threat_id = "2147896392"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 0c 14 fe ?? ?? 00 00 06 73 ?? 00 00 0a 28 ?? 00 00 06 28 ?? 00 00 06 75 ?? 00 00 1b 73 ?? 00 00 0a 0d 09 07 16 73 ?? 00 00 0a 13 04 11 04 08 6f ?? 00 00 0a 7e ?? 00 00 04 08 6f ?? 00 00 0a 14 6f ?? 00 00 0a dd}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABB_2147896402_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABB!MTB"
        threat_id = "2147896402"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {69 5d 91 08 09 08 6f ?? 01 00 0a 5d 6f ?? 01 00 0a 61 28 ?? 01 00 0a 07 09 17 58 07 8e 69 5d 91 28 ?? 01 00 0a 59 20 00 ?? 00 00 58 28 ?? 01 00 06 28 ?? 01 00 0a 9c 09 15 58 0d 09 16 2f b6}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBO_2147896440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBO!MTB"
        threat_id = "2147896440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 11 04 5d 13 08 11 07 1f 16 5d 13 09 11 07 17 58 11 04 5d 13 0a 07 11 08 91 13 0b 20 00 01 00 00 13 0c 11 0b 08 11 09 91 61 07 11 0a 91 59 11 0c 58 11 0c 5d 13 0d 07 11 08 11 0d d2 9c 00 11 07 17 58 13 07 11 07 11 04 09 17 58 5a fe 04 13 0e 11 0e 2d a9}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABLG_2147896446_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABLG!MTB"
        threat_id = "2147896446"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 08 11 08 2d df}  //weight: 5, accuracy: Low
        $x_1_2 = "CoreApps.ResourceCS3.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABLH_2147896447_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABLH!MTB"
        threat_id = "2147896447"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "eBookProcessor.XAXASADAWEQW.resources" ascii //weight: 2
        $x_2_2 = "eBookProcessor.Resources.resources" ascii //weight: 2
        $x_1_3 = "eBookProcessor" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABLJ_2147896448_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABLJ!MTB"
        threat_id = "2147896448"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_6_1 = {01 25 16 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a a2 25 17 1f 10 8c ?? ?? ?? 01 a2 6f ?? ?? ?? 0a a2 14 14 14 17 28 ?? ?? ?? 0a 26 5f 00 09 14 72 ?? ?? ?? 70 17 8d ?? ?? ?? 01 25 16 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 20 ?? ?? ?? 00 14 14 18 8d}  //weight: 6, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABLY_2147896452_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABLY!MTB"
        threat_id = "2147896452"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {01 25 16 06 17 8d ?? ?? ?? 01 25 16 08 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 6f ?? ?? ?? 0a 08 17 d6 0c 08 20 ?? ?? ?? 00 32 c3 3d 00 07 17 8d}  //weight: 5, accuracy: Low
        $x_1_2 = "Sistema_de_Quiniela.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABML_2147896453_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABML!MTB"
        threat_id = "2147896453"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2b 34 16 2b 34 2b 39 2b 3e 2b 06 2b 07 2b 08 de 1a 09 2b f7 08 2b f6 6f ?? 00 00 0a 2b f1 16 2d 06 09 6f ?? 00 00 0a 1b 2c f4 dc 2b 1d 6f ?? 00 00 0a 13 04 de 42}  //weight: 3, accuracy: Low
        $x_1_2 = "MemoryStream" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABMY_2147896454_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABMY!MTB"
        threat_id = "2147896454"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 11 07 08 11 07 9a 1f 10 28 ?? ?? ?? 0a d2 9c 00 11 07 17 58 13 07 11 07 08 8e 69 fe 04 13 08 11 08 2d db}  //weight: 5, accuracy: Low
        $x_1_2 = "TankBattle.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABNB_2147896455_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABNB!MTB"
        threat_id = "2147896455"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {01 25 16 08 17 8d ?? ?? ?? 01 25 16 11 04 8c ?? ?? ?? 01 a2 14 28 ?? ?? ?? 0a 28 ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 86 9c 6f ?? ?? ?? 0a 00 11 04 17 d6 13 04 00 11 04 20 ?? ?? ?? 00 fe 04 13 06 11 06 2d b6 4a 00 09 17 8d}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABNJ_2147896456_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABNJ!MTB"
        threat_id = "2147896456"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {16 0a 2b 35 00 72 ?? ?? ?? 70 28 ?? ?? ?? 06 0b 28 ?? ?? ?? 0a 07 6f ?? ?? ?? 0a 72 ?? ?? ?? 70 7e ?? ?? ?? 0a 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 0c de 0e 26 de 00}  //weight: 3, accuracy: Low
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "GetType" ascii //weight: 1
        $x_1_4 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIF_2147896471_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIF!MTB"
        threat_id = "2147896471"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 02 11 03 11 04 28 ?? ?? ?? 06 28 ?? ?? ?? 06 38 ?? ?? ?? 00 38 ?? ?? ?? 00 38 ?? ?? ?? 00 00 11 01 11 00 28 ?? ?? ?? 06 d2 9c 38 ?? ?? ?? ff 11 06 3a ?? ?? ?? 00 38 ?? ?? ?? ff 00 16 13 04 38 ?? ?? ?? 00 11 08 2a 38 ?? ?? ?? ff 38 ?? ?? ?? ff 28 ?? ?? ?? 06 13 02 38 ?? ?? ?? ff 11 00 17 58 13 00 20 ?? ?? ?? 00 38 ?? ?? ?? ff 11 03 20 ?? ?? ?? 00 fe 04 13 06 38 ?? ?? ?? ff 00 28 ?? ?? ?? 06 28 ?? ?? ?? 06 28 ?? ?? ?? 06 38 ?? ?? ?? ff 00 16 13}  //weight: 2, accuracy: Low
        $x_1_2 = "ADGC.g.resources" ascii //weight: 1
        $x_1_3 = "WindowsFormsApp1.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABIV_2147896473_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABIV!MTB"
        threat_id = "2147896473"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 04 1f 20 6f ?? ?? ?? 0a 13 05 73 ?? ?? ?? 0a 13 06 11 06 20 ?? ?? ?? 00 6f ?? ?? ?? 0a 11 06 17 6f ?? ?? ?? 0a 11 06 18 6f ?? ?? ?? 0a 11 06 11 05 08 6f ?? ?? ?? 0a 13 07 09 73 ?? ?? ?? 0a 13 08 11 08 11 07 16 73 ?? ?? ?? 0a 13 09 11 09 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 13 0a}  //weight: 3, accuracy: Low
        $x_1_2 = "ZkNOSFFiSGk=" wide //weight: 1
        $x_1_3 = "RYyRqpQcgSVGrjV" wide //weight: 1
        $x_1_4 = "NLXhHWXASGIQiZn" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABJJ_2147896476_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABJJ!MTB"
        threat_id = "2147896476"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {08 11 07 07 11 07 9a 1f 10 28 ?? ?? ?? 06 9c}  //weight: 2, accuracy: Low
        $x_2_2 = {52 00 65 00 6c 00 61 00 79 00 2e 00 47 00 52 00 45 00 45 00 4e}  //weight: 2, accuracy: High
        $x_2_3 = "Relay.GREEN" wide //weight: 2
        $x_1_4 = "Relay.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKT_2147896478_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKT!MTB"
        threat_id = "2147896478"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {08 11 07 07 11 07 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 07}  //weight: 2, accuracy: Low
        $x_2_2 = {57 00 69 00 6e 00 64 00 6f 00 77 00 73 00 46 00 6f 00 72 00 6d 00 73 00 41 00 70 00 70 00 31 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 53 00 43 00 43}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKW_2147896479_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKW!MTB"
        threat_id = "2147896479"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {08 06 07 06 9a 1f 10 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 17 58 0a 06 07 8e 69 fe 04 13 08 11 08 2d df}  //weight: 5, accuracy: Low
        $x_1_2 = "FrameworkEntity.MNBVB.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABKX_2147896480_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABKX!MTB"
        threat_id = "2147896480"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {17 59 7e 32 00 00 04 20 73 03 00 00 95 5f 7e 32 00 00 04 07 0b 20 ea 00 00 00 95 61 59 80 2b 00 00 04 2b 72 7e 2b 00 00 04 7e 32 00 00 04 20 28 01 00 00 95 33 25 7e 2b 00 00 04 7e 32 00 00 04 20 cf 01 00 00 95 58}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABGN_2147896497_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABGN!MTB"
        threat_id = "2147896497"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 07 02 8e 69 5d 02 07 02 8e 69 5d 91 06 07 06 8e 69 5d 91 61 7e ?? ?? ?? 04 28 ?? ?? ?? 06 02 07 17 58 02 8e 69 5d 91 7e ?? ?? ?? 04 28 ?? ?? ?? 06 59 20 ?? ?? ?? 00 58 20 ?? ?? ?? 00 5d d2 9c 00 07 15 58 0b 07 6c}  //weight: 5, accuracy: Low
        $x_1_2 = "745445BJ5CHO8980FGGAZ7" wide //weight: 1
        $x_1_3 = "CombineTxt.Properties.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABID_2147896503_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABID!MTB"
        threat_id = "2147896503"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "KhaosBringher.Properties.Resources" wide //weight: 2
        $x_2_2 = "KhaosKissMe" wide //weight: 2
        $x_2_3 = "KhaosBringherKhaosBringher" wide //weight: 2
        $x_2_4 = "KhaosBringher.exe" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBP_2147896505_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBP!MTB"
        threat_id = "2147896505"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 08 11 04 5d 13 09 11 08 17 58 11 04 5d 13 0a 07 11 09 91 13 0b 11 0b 08 11 08 1f 16 5d 91 61 07 11 0a 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 13 0c 07 11 09 11 0c d2 9c 00 11 08 17 58 13 08 11 08 11 04 09 17 58 5a fe 04 13 0d 11 0d 2d ae}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UL_2147896508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UL!MTB"
        threat_id = "2147896508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {19 8d 22 00 00 01 25 16 72 e1 01 00 70 a2 25 17 72 f3 01 00 70 a2 25 18 72 8f 01 00 70 a2 0a 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCD_2147896524_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCD!MTB"
        threat_id = "2147896524"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TransformFinalBlock" ascii //weight: 1
        $x_1_2 = "pbDebuggerPresent" ascii //weight: 1
        $x_1_3 = "$43f48ba8-a5e7-482f-aede-7531e07db011" ascii //weight: 1
        $x_3_4 = "VkJYQ0JDWFZIR1Mk" wide //weight: 3
        $x_3_5 = "VBXCBCXVHGS$" wide //weight: 3
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABCF_2147896525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABCF!MTB"
        threat_id = "2147896525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "Hotel_management.Resources" wide //weight: 2
        $x_3_2 = "iuy0876ftt" wide //weight: 3
        $x_2_3 = "Ncuisdhfiiuf" wide //weight: 2
        $x_2_4 = "rrSryrsrtrermr.rRrerfrlrercrtriornr.rArrrsrsrermrbrrlrryr" wide //weight: 2
        $x_2_5 = "roAdLoad" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFY_2147896529_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFY!MTB"
        threat_id = "2147896529"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 06 91 20 00 01 00 00 13 09 08 11 07 91 61 07 11 08 91 59 11 09 58 11 09 5d 13 0a 07 11 06 11 0a d2 9c}  //weight: 1, accuracy: High
        $x_1_2 = {11 05 1f 16 5d 13 07 11 05 17 58 11 04 5d 13 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBEZ_2147896550_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBEZ!MTB"
        threat_id = "2147896550"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 08 91 08 11 09 91 61 20 00 01 00 00 13 0b 07 11 0a 91 59 11 0b 58 11 0b 5d 13 0c 11 0d}  //weight: 1, accuracy: High
        $x_1_2 = "TinyAlertExample.Prope" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASFZ_2147896618_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASFZ!MTB"
        threat_id = "2147896618"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5a 00 42 00 41 00 50 00 45 00 50 00 50 00 42 00 34 00 50 00 39 00 43 00 44 00 32 00 31 00 42 00 38 00 50 00 31 00 34 00 43 00 43 00 44 00 32 00 31 00 35 00 34 00 36 00 38 00 36 00 39 00 37 00 33 00 32 00 50 00 37 00 50 00 37 00 32 00 36 00 5a 00 36 00 37 00 37 00 32 00 36 00 31 00 36 00 44 00 32 00 50 00 36 00 33 00 36 00 31 00 36 00 45 00 36 00 45 00 36 00 5a 00 37 00 34}  //weight: 1, accuracy: High
        $x_1_2 = {32 00 37 00 42 00 31 00 34 00 50 00 50 00 50 00 50 00 50 00 41 00 37 00 33 00 31 00 32 00 50 00 50 00 50 00 50 00 50 00 41 00 32 00 35 00 50 00 33 00 36 00 5a 00 31 00 33 00 50 00 50 00 50 00 50 00 50 00 41 00 50 00 50 00 32 00 35 00 50 00 32 00 37 00 42 00 31 00 34 00 50 00 50 00 50 00 50 00 50 00 41 00 36 00 5a 00 31 00 35 00 50 00 50 00 50 00 50 00 50 00 41 00 50 00 50 00 36 00 5a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGA_2147896624_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGA!MTB"
        threat_id = "2147896624"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 11 04 5d 13 08 11 07 17 58 11 04 5d 13 09 07 11 08 91 13 0a 11 0a 08 11 07 1f 16 5d 91 61 07 11 09 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 13 0b 07 11 08 11 0b d2 9c 00 11 07 17 58 13 07 11 07 11 04 09 17 58 5a fe 04 13 0c 11 0c 2d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGB_2147896625_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGB!MTB"
        threat_id = "2147896625"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 11 04 5d 13 08 11 05 1f 16 5d 13 09 11 05 17 58 11 04 5d 13 0a 07 11 08 91 13 0b 20 00 01 00 00 13 0c 11 0b 08 11 09 91 61 07 11 0a 91 59 11 0c 58 11 0c 5d 13 0d 07 11 08 11 0d d2 9c 11 05 17 58 13 05 00 11 05 11 04 09 17 58 5a fe 04 13 0e 11 0e 2d}  //weight: 1, accuracy: High
        $x_1_2 = "D7488RT85DS5I5ZG587C89" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABOX_2147896707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABOX!MTB"
        threat_id = "2147896707"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0d 09 08 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 09 08 1f 10 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 09 6f ?? ?? ?? 0a 07 16 07 8e 69 6f ?? ?? ?? 0a 13 04 11 04 8e 69 1f 10 59 8d ?? ?? ?? 01 13 05 11 04}  //weight: 5, accuracy: Low
        $x_1_2 = "SimulacionAbejasHilos" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPJ_2147896709_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPJ!MTB"
        threat_id = "2147896709"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 06 08 06 9a 1f 10 28 ?? ?? ?? 0a 9c 06 17 58 0a 06 08 8e 69 fe 04 13 05 11 05 2d e3}  //weight: 5, accuracy: Low
        $x_1_2 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPL_2147896710_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPL!MTB"
        threat_id = "2147896710"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "TravianGame_WindowsForms.Properties.Resources.resources" ascii //weight: 2
        $x_2_2 = "WindowsInterface.Form1.resources" ascii //weight: 2
        $x_1_3 = "TravianGame_WindowsForms" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABPN_2147896711_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABPN!MTB"
        threat_id = "2147896711"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 05 11 04 07 08 6f ?? ?? ?? 0a 16 73 ?? ?? ?? 0a 13 06 73 ?? ?? ?? 0a 13 07 20 ?? ?? ?? 00 8d ?? ?? ?? 01 13 08 16 13 09 38 ?? ?? ?? 00 11 07 11 08 16 11 09 6f ?? ?? ?? 0a 11 06 11 08 16 11 08 8e 69 6f ?? ?? ?? 0a 25 13 09 16 30 e0 11 07 6f ?? ?? ?? 0a 0d dd ?? ?? ?? 00 11 07 39 ?? ?? ?? 00 11 07 6f ?? ?? ?? 0a dc}  //weight: 4, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABQA_2147896714_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABQA!MTB"
        threat_id = "2147896714"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 08 11 0a 9a 13 0e 11 09 11 0e 1f 10 28 ?? ?? ?? 0a b4 6f ?? ?? ?? 0a 00 11 0a 17 d6 13 0a 00 11 0a 11 08 8e 69 fe 04 13 0f 11 0f 2d d2}  //weight: 5, accuracy: Low
        $x_1_2 = "PingGraph.Resources" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABQO_2147896718_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABQO!MTB"
        threat_id = "2147896718"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {0a 08 09 08 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 13 04 73 ?? ?? ?? 0a 13 05 11 05 11 04 17 73 ?? ?? ?? 0a 13 06 11 06 06 16 06 8e 69 6f ?? ?? ?? 0a 11 06 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 11 05 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 2a 60 00 1e 5b 6f ?? ?? ?? 0a 6f}  //weight: 5, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBQ_2147896720_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBQ!MTB"
        threat_id = "2147896720"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 11 04 5d 13 08 11 07 17 58 11 04 5d 13 09 07 11 08 91 13 0a 11 07 1f 16 5d 13 0b 07 11 08 11 0a 08 11 0b 91 61 07 11 09 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 07 17 58 13 07 11 07 11 04 09 17 58 5a fe 04 13 0c 11 0c 2d ae}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ABZR_2147896756_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ABZR!MTB"
        threat_id = "2147896756"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {03 1f 10 28 ?? 00 00 06 6f ?? 00 00 0a 0a 02 28 ?? 00 00 0a 0b 73 ?? 00 00 0a 0c 08 06 6f ?? 00 00 0a 08 18 6f ?? 00 00 0a 08 17 6f ?? 00 00 0a 08 6f ?? 00 00 0a 0d 09 07 16 07 8e 69 6f ?? 00 00 0a 13 04 28 ?? 00 00 0a 11 04 6f ?? 00 00 0a 13 05 11 05 17 8d ?? 00 00 01 13 06 11 06 6f ?? 00 00 0a 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBR_2147896795_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBR!MTB"
        threat_id = "2147896795"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 08 11 04 5d 13 09 11 08 17 58 11 04 5d 13 0a 07 11 09 91 13 0b 07 11 09 11 0b 08 11 08 1f 16 5d 91 61 07 11 0a 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 08 17 58 13 08 11 08 11 04 09 17 58 5a fe 04 13 0c 11 0c 2d b2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBS_2147896890_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBS!MTB"
        threat_id = "2147896890"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 05 11 04 5d 13 08 11 05 1f 16 5d 13 09 11 05 17 58 11 04 5d 13 0a 07 11 08 91 13 0b 20 00 01 00 00 13 0c 11 0b 08 11 09 91 61 07 11 0a 91 59 11 0c 58 11 0c 5d 13 0d 07 11 08 11 0d d2 9c 11 05 17 58 13 05 00 11 05 11 04 09 17 58 5a fe 04 13 0e 11 0e 2d a9}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABH_2147896947_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABH!MTB"
        threat_id = "2147896947"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 15 91 13 17 07 11 15 11 17 08 11 14 1f 16 5d 91 61 07 11 16 11 04 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 00 11 14 17 58 13 14 11 14 11 04 09 17 58 5a fe 04 13 18 11 18 2d b2}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTCG_2147897000_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTCG!MTB"
        threat_id = "2147897000"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 19 00 00 0a 0b 28 ?? 00 00 0a 16 9a 6f 1b 00 00 0a 0c 07 28 ?? 00 00 0a 0d 09 12 02}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABI_2147897014_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABI!MTB"
        threat_id = "2147897014"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 0a 11 0c 08 11 09 1f 16 5d 91 61 07 11 0b 11 04 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 11 09 17 58 13 09 11 09 11 04 09 17 58 5a 32 ba}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAWZ_2147897021_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAWZ!MTB"
        threat_id = "2147897021"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {11 0e 11 0e 28 ?? 02 00 06 11 0e 28 ?? 02 00 06 6f ?? 02 00 0a 13 07 20 00 00 00 00 7e ?? 03 00 04 7b ?? 03 00 04 39 ?? ff ff ff 26 20 01 00 00 00 38}  //weight: 3, accuracy: Low
        $x_1_2 = "FromBase64String" ascii //weight: 1
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFC_2147897024_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFC!MTB"
        threat_id = "2147897024"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 07 11 ?? 11 ?? 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFD_2147897025_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFD!MTB"
        threat_id = "2147897025"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 00 74 00 00 05 31 00 32 00 00 05 6e 00 64 00 00 05 31 00 33 00 00 05 72 00 64 00 00 0b 4e 00 69 00 67 00 68 00 74 00 00 05 4b 00 37 00 00 33 50 00 72 00 6f 00 74 00 6f 00 74 00 79 00 70 00 65 00 5f 00 54 00 6f 00 6b 00 65 00 6e 00 5f 00 49 00 6e 00 74 00 65 00 72 00 66 00 61 00 63 00 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAD_2147897036_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAD!MTB"
        threat_id = "2147897036"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 11 04 16 73 5d 02 00 0a 0d 09 07 6f 5e 02 00 0a 07 6f 4c 00 00 0a 13 05}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSZT_2147897055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSZT!MTB"
        threat_id = "2147897055"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 bd fe ff ff 1f 64 28 ?? 00 00 06 0c 1f 63 28 ?? 00 00 06 0d 38 a8 fe ff ff d0 0e 01 00 06 26 1f f0 0d 38 9a fe ff ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBT_2147897131_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBT!MTB"
        threat_id = "2147897131"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 08 91 13 06 11 04 07 1f 16 5d 6f ?? 00 00 0a d2 13 07 06 07 17 58 06 8e 69 5d 91 13 08 11 06 11 07 61 11 08 20 00 01 00 00 58 20 00 01 00 00 5d 59 13 09 06 08 11 09 d2}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSQG_2147897146_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSQG!MTB"
        threat_id = "2147897146"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 73 f0 01 00 06 7d 23 00 00 04 38 00 00 00 00 02 14 7d 25 00 00 04 38 00 00 00 00 02 28 10 00 00 0a 20 00 00 00 00 17 3a 0f 00 00 00 26 38 05 00 00 00 38 be ff ff ff}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSQI_2147897147_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSQI!MTB"
        threat_id = "2147897147"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 4a 00 00 0a 72 d8 34 05 70 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 08 6f ?? ?? ?? 0a 16 6a 6f ?? ?? ?? 0a 08 08 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 69 ?? ?? ?? 00 0a 0d 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSQJ_2147897148_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSQJ!MTB"
        threat_id = "2147897148"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {b7 6f 47 00 00 0a 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 13 04 73 ?? ?? ?? 0a 13 05 11 05 11 04 17 73 ?? ?? ?? 0a 25 03 16 03 8e 69 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 11 05 6f 50 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSSK_2147897153_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSSK!MTB"
        threat_id = "2147897153"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 28 05 00 00 0a 0a 28 06 00 00 0a 06 28 05 00 00 06 6f 07 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFF_2147897258_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFF!MTB"
        threat_id = "2147897258"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 17 58 11 ?? 5d 13 ?? 07 11 ?? 91 08 11 ?? 91 61 13 0b 20 00 01 00 00 13 0c 11 0b 07 11 ?? 91 59 11 ?? 58 11 ?? 5d 13}  //weight: 1, accuracy: Low
        $x_1_2 = "57FG2G8EQ7BC8885HWUG88" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGC_2147897270_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGC!MTB"
        threat_id = "2147897270"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 08 17 58 11 04 5d 13 0a 07 11 0a 91 20 00 01 00 00 58 13 0b 07 11 09 91 13 0c 07 11 09 11 0c 08 11 08 1f 16 5d 91 61 11 0b 59 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABJ_2147897271_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABJ!MTB"
        threat_id = "2147897271"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {13 0d 11 04 11 0d 91 20 00 01 00 00 58 13 0e 11 04 11 0c 91 13 0f 11 0f 11 05 11 0b 1f 16 5d 91 61 13 10 11 04 11 0c 11 10 11 0e 59 20 00 01 00 00 5d d2 9c 00 11 0b 17 58 13 0b}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABK_2147897331_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABK!MTB"
        threat_id = "2147897331"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {07 11 09 91 13 0c 11 0c 08 11 08 1f 16 5d 91 61 13 0d 07 11 09 11 0d 11 0b 59 20 00 01 00 00 5d d2 9c 00 11 08 17 58 13 08 11 08 11 04 09 17 58 5a fe 04 13 0e 11 0e 2d aa}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABL_2147897370_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABL!MTB"
        threat_id = "2147897370"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {07 11 09 91 13 0c 11 0c 08 11 08 1f 16 5d 91 61 13 0d 11 0d 11 0b 59 13 0e 07 11 09 11 0e 20 00 01 00 00 5d d2 9c 00 11 08 17 58 13 08 11 08 11 04 09 17 58 5a fe 04 13 0f 11 0f 2d a6}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BKC_2147897381_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BKC!MTB"
        threat_id = "2147897381"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 fe 01 00 0a 28 18 02 00 06 28 16 02 00 06 28 17 02 00 06 28 39 00 00 0a 28 19 02 00 06 fe 0e 00 00 fe 0c 00 00 72 d3 08 00 70 6f 58 00 00 0a 39 17 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGD_2147897400_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGD!MTB"
        threat_id = "2147897400"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 09 5d 13 05 06 17 58 13 0b 08 11 05 91 13 0c 08 11 05 11 0c 11 06 06 1f 16 5d 91 61 08 11 0b 09 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 06 17 58 0a 06 09 11 07 17 58 5a 32}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFG_2147897440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFG!MTB"
        threat_id = "2147897440"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 1f 16 5d 91 61 13 0d 11 0d 11 0b 59 13 0e 07 11 05 11 0e 20 00 01 00 00 5d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBX_2147897505_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBX!MTB"
        threat_id = "2147897505"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 11 0b 91 11 09 58 13 0c 07 11 0a 91 13 0d 11 0d 08 11 08 1f 16 5d 91 61 13 0e 11 0e 11 0c 59 13 0f 07 11 0a 11 0f 11 09 5d d2 9c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTCV_2147897539_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTCV!MTB"
        threat_id = "2147897539"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 87 ff ff ff 12 01 7c 0b 00 00 04 12 01 28 ?? 00 00 2b 20 03}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTCW_2147897540_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTCW!MTB"
        threat_id = "2147897540"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 ac ff ff ff 12 01 28 ?? 00 00 06 7d 0c 00 00 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBW_2147897543_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBW!MTB"
        threat_id = "2147897543"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 06 19 5d 28 ?? 00 00 0a 61 d2 9c 06 17 58 0a 06 08 8e 69 32 db}  //weight: 2, accuracy: Low
        $x_2_2 = {13 17 11 1d 11 09 91 13 20 11 1d 11 09 11 20 11 21 61 19 11 1c 58 61 11 28 61 d2 9c 11 20 13 1c 17 11 09 58 13 09}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSLK_2147897583_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSLK!MTB"
        threat_id = "2147897583"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {72 01 00 00 70 28 08 00 00 06 0a dd 03 00 00 00 26 de ec 06 2a}  //weight: 2, accuracy: High
        $x_2_2 = {28 05 00 00 0a 02 6f 06 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSLN_2147897584_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSLN!MTB"
        threat_id = "2147897584"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 8b 00 00 0a 6f ?? ?? ?? 0a 13 04 73 ?? ?? ?? 0a 13 05 11 05 11 04 6f ?? ?? ?? 0a 11 05 18 6f ?? ?? ?? 0a 11 05 18 6f ?? ?? ?? 0a 11 05 6f ?? ?? ?? 0a 13 06 11 06 07 16 07 8e 69 6f ?? ?? ?? 0a 13 07 28 ?? ?? ?? 0a 11 07 6f ?? ?? ?? 0a 13 08 11 08 6f ?? ?? ?? 0a 13 0a de 4f 02 38 5e ff ff ff 28 69 00 00 06 38 63 ff ff ff 6f ?? ?? ?? 0a 38 5f ff ff ff 0a 38 5e ff ff ff 06 38 5d ff ff ff 28 79 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSMB_2147897586_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSMB!MTB"
        threat_id = "2147897586"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 05 00 00 2b 6f ?? ?? ?? 0a 00 07 6f ?? ?? ?? 0a 0c 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0d 09 6f ?? ?? ?? 0a 13 04 11 04 28 ?? ?? ?? 0a 13 05 2b 00 11 05 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSNZ_2147897588_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSNZ!MTB"
        threat_id = "2147897588"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 05 00 00 06 28 ?? ?? ?? 06 74 03 00 00 01 28 ?? ?? ?? 06 0a 17 8d 04 00 00 01 25 16 06 74 02 00 00 1b 28 ?? ?? ?? 06 a2 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBY_2147897592_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBY!MTB"
        threat_id = "2147897592"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0a 11 04 5d 13 0c 07 11 0c 91 11 09 58 13 0d 07 11 0b 91 13 0e 11 0e 08 11 08 1f 16 5d 91 61 13 0f 11 0f 11 0d 59 13 10 07 11 0b 11 10 11 09 5d d2 9c 00 11 08 17 58 13 08}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFH_2147897600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFH!MTB"
        threat_id = "2147897600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {58 13 0b 07 11 04 91 13 0c 07 11 04 11 0c 11 06 06 1f 16 5d 91 61 11 0b 59 20 00 01 00 00 5d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGE_2147897604_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGE!MTB"
        threat_id = "2147897604"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 08 11 04 5d 13 0a 11 08 17 58 11 04 5d 13 0b 07 11 0b 91 11 09 58 13 0c}  //weight: 1, accuracy: High
        $x_1_2 = {07 11 0a 91 13 0d 11 0d 08 11 08 1f 16 5d 91 61 13 0e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABM_2147897626_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABM!MTB"
        threat_id = "2147897626"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {13 04 06 17 58 13 0b 06 08 5d 13 05 11 0b 08 5d 13 0c 07 11 0c 91 11 04 58 13 0d 07 11 05 91 13 0e 11 0e 11 07 06 1f 16 5d 91 61 13 0f 11 0f 11 0d 59 13 10 07 11 05 11 10 11 04 5d d2 9c 06 17 58 0a 06 08 11 08 17 58 5a fe 04 13 11 11 11 2d aa}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARAA_2147897688_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARAA!MTB"
        threat_id = "2147897688"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 11 04 5d 13 08 11 07 11 05 5d 13 09 11 07 17 58 11 04 5d 13 0a 07 11 08 91 08 11 09 91 61 20 00 01 00 00 13 0b 07 11 0a 91 59 11 0b 58 11 0b 5d 13 0c 07 11 08 11 0c d2 9c 11 07 17 58 13 07 11 07 11 04 09 17 58 5a 32 b5}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARAA_2147897688_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARAA!MTB"
        threat_id = "2147897688"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {20 00 01 00 00 13 09 11 08 17 58 13 0a 11 08 11 04 5d 13 0b 11 0a 11 04 5d 13 0c 07 11 0c 91 11 09 58 13 0d 07 11 0b 91 13 0e 11 0e 08 11 08 1f 16 5d 91 61 13 0f 11 0f 11 0d 59 13 10 07 11 0b 11 10 11 09 5d d2 9c 11 08 17 58 13 08 11 08 11 04 09 17 58 5a 32 a9}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMBZ_2147897716_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMBZ!MTB"
        threat_id = "2147897716"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {91 11 15 58 13 19 07 11 17 91 13 1a 11 1a 08 11 14 1f 16 5d 91 61 13 1b 11 1b 11 19 59 13 1c 07 11 17 11 1c 11 15 5d d2 9c 00 11 14 17 58 13 14}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGF_2147897720_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGF!MTB"
        threat_id = "2147897720"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0e 08 11 08 1f 16 5d 91 61 13 0f 11}  //weight: 1, accuracy: High
        $x_1_2 = {11 0f 11 0d 59 13 10 07 11 0b 11 10 11 09 5d d2 9c}  //weight: 1, accuracy: High
        $x_1_3 = {20 00 01 00 00 13 09 11 08 17 58 13 0a 11 08 11 04 5d 13 0b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDA_2147897729_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDA!MTB"
        threat_id = "2147897729"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 72 4b 00 00 70 7e 08 00 00 04 28 ?? 00 00 06 74 01 00 00 1b 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDC_2147897730_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDC!MTB"
        threat_id = "2147897730"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 3d 00 00 06 0a 06 03 7d 44 00 00 04 02 06 fe 06 3e 00 00 06 73 54 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASGG_2147897740_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASGG!MTB"
        threat_id = "2147897740"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {20 00 01 00 00 13 10 11 08 17 58 13 17 11 08 11 0e 5d 13 11 11 17 11 0e 5d 13 18 11 0d 11 18 91 11 10 58 13 19 11 0d 11 11 91 13 1a 11 1a 11 13 11 08 1f 16 5d 91 61 13 1b 11 1b 11 19 59 13 1c 11 0d 11 11 11 1c 11 10 5d d2 9c 11 08 17 58 13 08 11 08 11 0e 11 14 17 58 5a fe 04 13 1d 11 1d 2d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCA_2147897782_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCA!MTB"
        threat_id = "2147897782"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {13 0a 07 11 0a 91 11 07 58 13 0b 07 11 09 91 13 0c 11 0c 08 11 06 1f 16 5d 91 61 13 0d 11 0d 11 0b 59 13 0e 07 11 09 11 0e 11 07 5d d2 9c 00 11 06 17 58 13 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCA_2147897782_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCA!MTB"
        threat_id = "2147897782"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {13 0b 08 11 0b 91 11 08 58 13 0c 08 11 0a 91 13 0d 09 11 04 1f 16 5d 91 13 0e 11 0d 11 0e 61 13 0f 11 0f 11 0c 59 13 10 08 11 0a 11 10 11 08 5d d2 9c 11 04 17 58 13 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDD_2147897828_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDD!MTB"
        threat_id = "2147897828"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f 08 00 00 0a 6f 0a 00 00 0a 06 6f 0b 00 00 0a 02 16 02 8e 69 6f 0c 00 00 0a 0b de 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDE_2147897829_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDE!MTB"
        threat_id = "2147897829"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 cd fd ff ff 28 ?? 00 00 0a 7e 01 00 00 04 02 08 6f 28 00 00 0a 28 ?? 00 00 0a a5 01 00 00 1b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREX_2147897886_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREX!MTB"
        threat_id = "2147897886"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetExportedTypes" ascii //weight: 1
        $x_1_2 = "ToString" ascii //weight: 1
        $x_1_3 = "Reverse" ascii //weight: 1
        $x_1_4 = "ToArray" ascii //weight: 1
        $x_1_5 = "$a0fb186e-c0c7-4156-aa3c-e2cdd24949ba" ascii //weight: 1
        $x_1_6 = "://filebin.net/gdua73i760bj7z51/Jtcuyvqba.dat" ascii //weight: 1
        $x_1_7 = "CancelProducer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREX_2147897886_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREX!MTB"
        threat_id = "2147897886"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "GetTypes" ascii //weight: 1
        $x_1_2 = "HttpClient" ascii //weight: 1
        $x_1_3 = "GetByteArrayAsync" ascii //weight: 1
        $x_1_4 = "GetMethod" ascii //weight: 1
        $x_1_5 = "MethodBase" ascii //weight: 1
        $x_1_6 = "Invoke" ascii //weight: 1
        $x_1_7 = "$4ac9812b-c8b2-49d2-bac2-c2e0ecdc81d4" ascii //weight: 1
        $x_1_8 = {3a 00 2f 00 2f 00 72 00 65 00 6d 00 69 00 73 00 61 00 74 00 2e 00 63 00 6f 00 6d 00 2e 00 75 00 79 00 2f 00 6e 00 6f 00 6e 00 2f 00 [0-20] 2e 00 70 00 64 00 66 00}  //weight: 1, accuracy: Low
        $x_1_9 = {3a 2f 2f 72 65 6d 69 73 61 74 2e 63 6f 6d 2e 75 79 2f 6e 6f 6e 2f [0-20] 2e 70 64 66}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (8 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFK_2147898085_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFK!MTB"
        threat_id = "2147898085"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {91 11 1c 58 13 20 07 11 1e 91 13 21 11 21 08 11 1b 1f 16 5d 91 61 13 22 11 22 11 20 59 13 23 07 11 1e 11 23 11 1c 5d d2 9c 00 11 1b 17 58 13 1b 11 1b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCB_2147898264_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCB!MTB"
        threat_id = "2147898264"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0a 72 01 00 00 70 6f ?? 00 00 0a 6f ?? 00 00 0a 06 28 ?? 00 00 0a 72 01 00 00 70 6f ?? 00 00 0a 6f ?? 00 00 0a 06 6f ?? 00 00 0a 02 16 02 8e 69 6f ?? 00 00 0a 0b de 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCB_2147898264_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCB!MTB"
        threat_id = "2147898264"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "1A0D2B98192BFA140B1C0D2B8F028C0B||1B2842||" wide //weight: 2
        $x_2_2 = "UDF_Utility.Properties.Resources" ascii //weight: 2
        $x_1_3 = "HexStringToByteArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFM_2147898274_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFM!MTB"
        threat_id = "2147898274"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 08 06 09 91 9c 08 17 58 0c 09 17 59 0d 09 16 2f ee 07 13 04 dd 03 00}  //weight: 1, accuracy: High
        $x_1_2 = {33 00 36 00 2e 00 31 00 30 00 34 00 2f 00 75 00 6c 00 74 00 72 00 6f 00 6e 00 2f 00 55 00 76 00 69}  //weight: 1, accuracy: High
        $x_1_3 = {49 7a 79 6a 79 69 74 66 68 00 4b 66 65 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MM1_2147898296_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MM1!MTB"
        threat_id = "2147898296"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$928afa20-cdaa-4493-b39a-33216c813952" ascii //weight: 1
        $x_1_2 = "get_tendocgia" ascii //weight: 1
        $x_1_3 = "rtxtb_diachi" ascii //weight: 1
        $x_1_4 = "QLTV.frmMain.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABO_2147898297_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABO!MTB"
        threat_id = "2147898297"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 0a 91 11 07 58 13 0b 07 11 09 91 13 0c 08 11 06 1f 16 5d 91 13 0d 11 0c 11 0d 61 13 0e 11 0e 11 0b 59 13 0f 07 11 09 11 0f 11 07 5d d2 9c 00 11 06 17 58 13 06}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAE_2147898298_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAE!MTB"
        threat_id = "2147898298"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f 25 00 00 0a 13 04 73 26 00 00 0a 13 05 08 73 27 00 00 0a 13 06 11 06 11 04 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDG_2147898305_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDG!MTB"
        threat_id = "2147898305"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {75 07 00 00 1b 0b 28 ?? 01 00 06 20 81 7c 9e 98 28 ?? 00 00 2b 28 ?? 01 00 06 0c 16 0d 11 37}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_STJI_2147898312_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.STJI!MTB"
        threat_id = "2147898312"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 11 08 1f 16 5d 91 61 11 0b 59 20 00 01 00 00 5d d2 9c 00 11 08 17 58 13 08 11 08 11 04 09 17 58 5a fe 04 13 0d 11 0d 2d ae}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAYM_2147898319_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAYM!MTB"
        threat_id = "2147898319"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {16 0a 2b 36 06 08 5d 13 04 06 17 58 13 0a 07 11 04 91 13 0b 07 11 04 11 0b 11 06 06 1f 16 5d 91 61 07 11 0a 08 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c 06 17 58 0a 06 08 11 07 17 58 5a fe 04 13 0c 11 0c 2d bb}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAYN_2147898332_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAYN!MTB"
        threat_id = "2147898332"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {16 0a 2b 3a 06 08 5d 13 05 06 17 58 08 5d 13 0a 07 11 0a 91 20 00 01 00 00 58 13 0b 07 11 05 91 13 0c 07 11 05 11 0c 11 06 06 1f 16 5d 91 61 11 0b 59 20 00 01 00 00 5d d2 9c 06 17 58 0a 06 08 11 07 17 58 5a fe 04 13 0d 11 0d 2d b7}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAYO_2147898436_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAYO!MTB"
        threat_id = "2147898436"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {20 00 01 00 00 13 17 11 0b 17 58 13 1d 11 0b 20 00 40 01 00 5d 13 18 11 1d 20 00 40 01 00 5d 13 1e 11 15 11 1e 91 11 17 58 13 1f 11 15 11 18 91 13 20 11 20 11 1a 11 0b 1f 16 5d 91 61 13 21 11 21 11 1f 59 13 22 11 15 11 18 11 22 11 17 5d d2 9c 11 0b 17 58 13 0b 11 0b 20 00 40 01 00 fe 04 13 23 11 23 2d 9a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDP_2147898470_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDP!MTB"
        threat_id = "2147898470"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f c0 01 00 06 6f 30 00 00 0a 7d 38 01 00 04 fe 0c 03 00 fe 0c 02 00 6f be 01 00 06 72 e7 00 00 70}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARAC_2147898568_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARAC!MTB"
        threat_id = "2147898568"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 06 8e 69 8d ?? ?? ?? 01 0b 16 0c 06 8e 69 17 59 0d 38 ?? ?? ?? 00 07 08 06 09 91 9c 08 17 58 0c 09 17 59 0d 09 16 2f ee}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAYX_2147898609_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAYX!MTB"
        threat_id = "2147898609"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {16 0a 2b 1c 11 04 06 08 06 91 20 25 26 56 d4 28 ?? 00 00 06 28 ?? 00 00 0a 59 d2 9c 06 17 58 0a 06 08 8e 69 32 de}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JF_2147898640_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JF!MTB"
        threat_id = "2147898640"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 00 01 00 00 14 14 18 8d ?? 00 00 01 25 16 08 a2 25 17 19 8d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCG_2147898657_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCG!MTB"
        threat_id = "2147898657"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 2c 23 06 6f ?? 00 00 0a 72 ?? 00 00 70 6f ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 0b 02 07 28 ?? 00 00 06 2a 73 ?? 00 00 0a 7a}  //weight: 2, accuracy: Low
        $x_2_2 = {2a 5a 02 7b ?? 00 00 04 6f ?? 00 00 0a 03 16 03 8e 69 6f ?? 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AMCI_2147898658_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AMCI!MTB"
        threat_id = "2147898658"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 11 0c 91 11 09 58 13 0d 07 11 0b 91 13 0e 08 09 1f 16 5d 91 13 0f 11 0e 11 0f 61 13 10 11 10 11 0d 59 13 11 07 11 0b 11 11 11 09 5d d2 9c 09 17 58 0d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABQ_2147898687_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABQ!MTB"
        threat_id = "2147898687"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {13 08 09 17 58 13 09 09 11 04 5d 13 0a 11 09 11 04 5d 13 0b 07 11 0b 91 11 08 58 13 0c 07 11 0a 91 13 0d 08 09 1f 16 5d 91 13 0e 11 0d 11 0e 61 13 0f 11 0f 11 0c 59 13 10 07 11 0a 11 10 11 08 5d d2 9c 09 17 58 0d}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NNLL_2147898970_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NNLL!MTB"
        threat_id = "2147898970"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 6f 7e 02 ?? ?? 08 07 5d 91 0d 0e 04 08 0e 05 58 03 08 04 58 91 02 6f 7d 02 ?? ?? 09 06 5d 91 61 d2 9c 08 17 58 0c 08 05 32 d5}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFP_2147899004_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFP!MTB"
        threat_id = "2147899004"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "lm.oQ" wide //weight: 10
        $x_1_2 = "Load" wide //weight: 1
        $x_1_3 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MMC_2147899061_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MMC!MTB"
        threat_id = "2147899061"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {72 3a 01 00 70 72 54 01 00 70 72 d0 01 00 70 72 e0 01 00 70 28 1c 00 00 0a}  //weight: 1, accuracy: High
        $x_1_2 = "WinFormGregorCatch.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABR_2147899132_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABR!MTB"
        threat_id = "2147899132"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 07 08 18 5b 02 08 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 9c 00 08 18 58 0c 08 06 fe 04 0d 09 2d de}  //weight: 5, accuracy: Low
        $x_5_2 = "062BF62872" wide //weight: 5
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PRH_2147899174_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PRH!MTB"
        threat_id = "2147899174"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {00 11 06 17 58 20 ff 00 00 00 5f 13 06 11 05 11 04 11 06 95 58 20 ff 00 00 00 5f 13 05 02 11 04 11 06 8f 78 00 00 01 11 04 11 05 8f 78 00 00 01 28 ?? 00 00 06 00 11 04 11 06 95 11 04 11 05 95 58 20 ff 00 00 00 5f 13 0f 09 11 0e 07 11 0e 91 11 04 11 0f 95 61 d2 9c 00 11 0e 17 58 13 0e 11 0e 09 8e 69 fe 04 13 10 11 10 2d 94}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEG_2147899210_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEG!MTB"
        threat_id = "2147899210"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 0e 06 09 28 ?? 00 00 0a 14 d0 04 00 00 02 28 ?? 00 00 0a 18 8d 23 00 00 01 25 16 16 14 28 ?? 00 00 0a a2}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSD_2147899276_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSD!MTB"
        threat_id = "2147899276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {72 c7 01 00 70 11 04 8c 0c ?? ?? ?? 28 2a ?? ?? ?? 28 1b ?? ?? ?? 73 2b ?? ?? ?? 25 72 f3 01 00 70 6f 2c ?? ?? ?? 25 72 03 02 00 70 28 01 ?? ?? ?? 28 2a ?? ?? ?? 6f 2d ?? ?? ?? 25 17 6f 2e ?? ?? ?? 25 17 6f 2f ?? ?? ?? 25 16 6f 30 ?? ?? ?? 25 17 6f 31 ?? ?? ?? 28 32 ?? ?? ?? 26 28 01 ?? ?? ?? 14 1a 28 0a ?? ?? ?? 26 16 2a}  //weight: 5, accuracy: Low
        $x_1_2 = "GetExecutingAssembly" ascii //weight: 1
        $x_1_3 = "GetAuthEncryptedContentInfo" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSD_2147899276_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSD!MTB"
        threat_id = "2147899276"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e 9c 00 00 04 d0 0e ?? ?? ?? 28 0e ?? ?? ?? 6f a3 ?? ?? ?? 2c 25 20 2e 17 c4 03 28 df ?? ?? ?? 16 8d a7 ?? ?? ?? 28 a4 ?? ?? ?? 73 a5 ?? ?? ?? 7a 73 a6 ?? ?? ?? 80 9c ?? ?? ?? 7e 9c ?? ?? ?? d0 0e ?? ?? ?? 28 0e ?? ?? ?? 14 6f a7 ?? ?? ?? 28 ?? ?? ?? 2b 0a}  //weight: 5, accuracy: Low
        $x_1_2 = "CryptoStreamMode" ascii //weight: 1
        $x_1_3 = "AuthenticationMode" ascii //weight: 1
        $x_1_4 = "CreateInstance" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSL_2147899277_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSL!MTB"
        threat_id = "2147899277"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 1f b6 0b 09 1f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 b6 00 00 00 22 00 00 00 73 00 00 00 33 01 00 00 d2 00 00 00}  //weight: 5, accuracy: High
        $x_1_2 = "DebuggingModes" ascii //weight: 1
        $x_1_3 = "get_Assembly" ascii //weight: 1
        $x_1_4 = "GetHashCode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSV_2147899280_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSV!MTB"
        threat_id = "2147899280"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 00 7e 07 00 00 04 11 01 7e 07 00 00 04 8e 69 5d 91 02 11 01 91 61 d2 6f 15 ?? ?? ?? 38 43 ?? ?? ?? 11 00 6f 16 ?? ?? ?? 25 3a 4a ?? ?? ?? 26 38 43 ?? ?? ?? 73 17 ?? ?? ?? 13 00 38 2f ?? ?? ?? 38 ba ?? ?? ?? 20 ?? ?? ?? 00 7e 35 00 00 04 7b 30 00 00 04 39 7f ?? ?? ?? 26 20 ?? ?? ?? 00 38 74 ?? ?? ?? 11 01 17 58 13 01 38 77 ?? ?? ?? 16 13 01 38 7e ?? ?? ?? 14 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAB_2147899281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAB!MTB"
        threat_id = "2147899281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e d7 00 00 04 d0 07 00 00 1b 28 2b ?? ?? ?? 6f 75 ?? ?? ?? 0d 09 2c 16 72 41 39 02 70 16 8d 87 00 00 01 28 76 ?? ?? ?? 73 77 ?? ?? ?? 7a 00 00 2b 0c 00 73 78 ?? ?? ?? 80 d7 00 00 04 00 7e d7 00 00 04 d0 07 00 00 1b 28 2b ?? ?? ?? 14 6f 79 ?? ?? ?? 00 00 28 01 00 00 2b 0a de 74}  //weight: 5, accuracy: Low
        $x_1_2 = "CreateInstance" ascii //weight: 1
        $x_1_3 = "GetHashCode" ascii //weight: 1
        $x_1_4 = "ContainsKey" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAE_2147899282_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAE!MTB"
        threat_id = "2147899282"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 28 0f 00 00 0a 6f 10 ?? ?? ?? 6f 11 ?? ?? ?? 0a 06 73 12 ?? ?? ?? 0b 2b 09 2b 0a 2b 0f 17 2c f7 de 30 07 2b f4 6f 13 ?? ?? ?? 2b ef 0c 2b ee}  //weight: 5, accuracy: Low
        $x_5_2 = {11 04 12 05 28 1f ?? ?? ?? 07 09 18 6f 20 ?? ?? ?? 06 28 21 ?? ?? ?? 13 06 08 09 11 06 6f 22 ?? ?? ?? de 0c}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAM_2147899285_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAM!MTB"
        threat_id = "2147899285"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e 69 01 00 04 73 b8 00 00 0a 20 1e 14 f2 c5 28 d5 00 00 06 6f 7d 00 00 0a 74 05 00 00 1b 0a 28 9c 00 00 0a 20 11 14 f2 c5 28 d5 00 00 06 6f 2d ?? ?? ?? 1e 8d 07 00 00 01 17 73 43 ?? ?? ?? 0b 73 44 ?? ?? ?? 0c 08 07 1f 10 6f 45 ?? ?? ?? 6f 46 ?? ?? ?? 08 07 1f 10 6f 45 ?? ?? ?? 6f 47 ?? ?? ?? 08 6f 48 ?? ?? ?? 06 16 06 8e 69 6f 49 ?? ?? ?? 0d 09 8e 69 1f 10 59 8d 07 00 00 01 13 04 09 1f 10 11 04 16 09 8e 69 1f 10 59 28 1e ?? ?? ?? 11 04 28 72 01 00 06 28 71 01 00 06 6f 4a ?? ?? ?? 17 9a 80 68 01 00 04 02 13 05 11 05 2a}  //weight: 5, accuracy: Low
        $x_1_2 = "Rfc2898DeriveBytes" ascii //weight: 1
        $x_1_3 = "ICryptoTransform" ascii //weight: 1
        $x_1_4 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_5 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAQ_2147899288_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAQ!MTB"
        threat_id = "2147899288"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {09 12 05 28 1a 00 00 0a 18 2c 11 08 06 18 6f 1b 00 00 0a 11 04 28 1c 00 00 0a 13 06 07 06 11 06 6f 1d 00 00 0a de 0b}  //weight: 5, accuracy: High
        $x_5_2 = {08 6f 1f 00 00 0a 32 ae 07 6f 20 00 00 0a 28 01 00 00 2b 2a 28 09 00 00 06 38 63 ff ff ff 73 22 00 00 0a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAR_2147899289_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAR!MTB"
        threat_id = "2147899289"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 12 05 28 21 ?? ?? ?? 07 09 18 6f 22 ?? ?? ?? 06 28 23 ?? ?? ?? 13 06 08 09 11 06 6f 24 ?? ?? ?? de 0c}  //weight: 5, accuracy: Low
        $x_5_2 = {09 07 6f 26 00 00 0a 32 aa 08 6f 27 00 00 0a 28 01 00 00 2b 2a 0a 38 71 ff ff ff 28 09 00 00 06 38 71 ff ff ff 0b 38 70 ff ff ff 73 29 00 00 0a 38 6b ff ff ff 0c}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAS_2147899290_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAS!MTB"
        threat_id = "2147899290"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 12 05 28 10 ?? ?? ?? 07 09 18 6f 11 ?? ?? ?? 06 28 12 ?? ?? ?? 13 06 08 09 11 06 6f 13 ?? ?? ?? de 0c 11 05 2c 07 11 04 28 14 ?? ?? ?? dc 09 18 58 0d 09 07 6f 15 ?? ?? ?? 32 bd 08 6f 16 ?? ?? ?? 28 01 00 00 2b 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAT_2147899291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAT!MTB"
        threat_id = "2147899291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 12 05 28 1c ?? ?? ?? 08 06 18 6f 1d ?? ?? ?? 11 04 28 1e ?? ?? ?? 13 06 07 06 11 06 6f 1f ?? ?? ?? de 0b 11 05 2c 06 09 28 20 ?? ?? ?? dc 06 18 58 0a 06 08 6f 21 ?? ?? ?? 32 bf 07 6f 22 ?? ?? ?? 28 01 00 00 2b 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAU_2147899292_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAU!MTB"
        threat_id = "2147899292"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 04 12 05 28 1b ?? ?? ?? 07 09 18 6f 1c ?? ?? ?? 06 28 1d ?? ?? ?? 13 06 08 09 11 06 6f 1e ?? ?? ?? de 0c 11 05 2c 07 11 04 28 1f ?? ?? ?? dc 09 18 58 0d 09 07 6f 20 ?? ?? ?? 32 bd 08 6f 21 ?? ?? ?? 28 01 00 00 2b}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAV_2147899293_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAV!MTB"
        threat_id = "2147899293"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {7e 5f 01 00 04 25 13 26 12 17 28 6a 00 00 0a 73 6b 00 00 0a 0b d0 23 00 00 02 28 8f 01 00 06 6f 5a 00 00 0a 72 ac 35 00 70 6f 6c 00 00 0a 73 6d 00 00 0a 0c 08 28 8c 01 00 06 16 6a 28 8d 01 00 06 08 08 6f 6e 00 00 0a 6f 6f 00 00 0a 69 6f 70 00 00 0a 0d 08 28 90 01 00 06 09 8e 69 16}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSAZ_2147899294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSAZ!MTB"
        threat_id = "2147899294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
        $x_1_3 = "TransformFinalBlock" ascii //weight: 1
        $x_1_4 = "ICryptoTransform" ascii //weight: 1
        $x_1_5 = "AllowPartiallyTrustedCallersAttribute" ascii //weight: 1
        $x_1_6 = "UTF8Encoding" ascii //weight: 1
        $x_1_7 = "f0659e5905454a5e99b9752afc78b700" ascii //weight: 1
        $x_1_8 = "0a13cf615c3d472e40d5299d09807ec1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_STMK_2147899301_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.STMK!MTB"
        threat_id = "2147899301"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0b 07 06 72 65 00 00 70 6f [0-2] 00 00 0a 74 02 00 00 1b 6f [0-2] 00 00 0a 07 06 72 6d 00 00 70 6f [0-2] 00 00 0a 74 02 00 00 1b 6f [0-2] 00 00 0a 07 06 72 75 00 00 70 6f [0-2] 00 00 0a 74 02 00 00 1b 6f [0-2] 00 00 0a 02}  //weight: 1, accuracy: Low
        $x_1_2 = "MyMemoryManagement.Properties.Resources" ascii //weight: 1
        $x_1_3 = "MyMemoryManagement.Form1.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSBM_2147899327_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSBM!MTB"
        threat_id = "2147899327"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {7e be 00 00 04 14 fe 03 0d 09 2c 37 7e be 00 00 04 d0 08 00 00 1b 28 24 ?? ?? ?? 6f f3 ?? ?? ?? 13 04 11 04 2c 1b 20 cd b3 7d fb 28 d0 01 00 06 16 8d 7b 00 00 01 28 f4 ?? ?? ?? 73 f5 ?? ?? ?? 7a 2b 0a 73 f6 ?? ?? ?? 80 be 00 00 04 7e be 00 00 04 d0 08 00 00 1b 28 24 ?? ?? ?? 14 6f f7 ?? ?? ?? 28 01 00 00 2b 0b de 70}  //weight: 5, accuracy: Low
        $x_1_2 = "GetHashCode" ascii //weight: 1
        $x_1_3 = "ContainsKey" ascii //weight: 1
        $x_1_4 = "GetResourceString" ascii //weight: 1
        $x_1_5 = "CreateInstance" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSBO_2147899328_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSBO!MTB"
        threat_id = "2147899328"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {02 6f 1c 01 00 0a 13 09 38 05 01 00 00 12 09 28 1d 01 00 0a 13 05 11 04 2c 25 08 7e 43 00 00 04 28 bb 02 00 06 6f 77 00 00 0a 16 7e 43 00 00 04 28 bb 02 00 06 6f 1e 01 00 0a 6f 96 00 00 0a 17 13 04 12 05 28 1f 01 00 0a}  //weight: 5, accuracy: High
        $x_1_2 = "VirtualAllocExNuma" ascii //weight: 1
        $x_1_3 = "GetHashCode" ascii //weight: 1
        $x_1_4 = "CryptoStreamMode" ascii //weight: 1
        $x_1_5 = "SymmetricAlgorithm" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSBP_2147899329_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSBP!MTB"
        threat_id = "2147899329"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 73 5c 00 00 0a 0a 73 5d ?? ?? ?? 0b 07 04 6f 5e ?? ?? ?? 0c 06 08 6f 5f ?? ?? ?? 0d 07 09 6f 60 ?? ?? ?? 10 02 72 54 a9 06 70 13 04 11 04 02 7b 18 00 00 04 73 4e ?? ?? ?? 13 05 11 05 6f 4f ?? ?? ?? 72 1b aa 06 70}  //weight: 5, accuracy: Low
        $x_1_2 = "HashAlgorithm" ascii //weight: 1
        $x_1_3 = "ContainsKey" ascii //weight: 1
        $x_1_4 = "ComputeHash" ascii //weight: 1
        $x_1_5 = "SHA1CryptoServiceProvider" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSBU_2147899331_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSBU!MTB"
        threat_id = "2147899331"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {57 ff a3 3f 09 0f 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 bf 00 00 00 77 01 00 00 27 06 00 00 98 07 00 00 fc 0b 00 00}  //weight: 5, accuracy: High
        $x_1_2 = "CipherMode" ascii //weight: 1
        $x_1_3 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_4 = "ICryptoTransform" ascii //weight: 1
        $x_1_5 = "HashAlgorithm" ascii //weight: 1
        $x_1_6 = "DeriveBytes" ascii //weight: 1
        $x_1_7 = "System.Security.Cryptography" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSCG_2147899338_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSCG!MTB"
        threat_id = "2147899338"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 28 2a 00 00 06 72 97 01 00 70 72 9d 01 00 70 6f 4b ?? ?? ?? 72 a1 01 00 70 72 a5 01 00 70 6f 4b ?? ?? ?? 72 a9 01 00 70 72 ad 01 00 70 6f 4b ?? ?? ?? 72 b3 01 00 70 72 b7 01 00 70 6f 4b ?? ?? ?? 72 bb 01 00 70 72 c1 01 00 70 6f 4b ?? ?? ?? 17 8d 4f 00 00 01 25 16 1f 2d 9d 6f 4c ?? ?? ?? 0b 73 4d ?? ?? ?? 0c 16 13 08 2b 18 08 07 11 08 9a 1f 10 28 4e ?? ?? ?? 6f 4f ?? ?? ?? 00 11 08 17 58 13 08 11 08 20 00 ea 00 00 fe 04 13 09 11 09 2d d9 28 50 ?? ?? ?? 08 6f 51 ?? ?? ?? 6f 52 ?? ?? ?? 0d 09}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSCK_2147899339_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSCK!MTB"
        threat_id = "2147899339"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {72 5b 00 00 70 0a 06 28 7b 00 00 0a 25 26 0b 28 7c 00 00 0a 25 26 07 16 07 8e 69 6f 7d 00 00 0a 25 26 0a 28 2b 00 00 0a 25 26 06 6f 30 00 00 0a 25 26}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSCL_2147899340_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSCL!MTB"
        threat_id = "2147899340"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {06 28 0f 00 00 0a 0b 28 04 00 00 06 28 05 00 00 06 3a d0 00 00 00 26 20 0a 00 00 00 38 a0 ff ff ff 11 05 08 6f 10 00 00 0a 09 20 00 01 00 00 14 14 11 06 74 01 00 00 1b 6f 11 00 00 0a 26 20 0b 00 00 00 28 04 00 00 06 3a 74 ff ff ff 26}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSCQ_2147899341_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSCQ!MTB"
        threat_id = "2147899341"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 23 73 ee 00 00 0a 13 04 2b 13 28 b9 00 00 0a 11 0c 16 11 0c 8e 69 6f f0 00 00 0a 13 04 11 0b 06 20 46 ff 1b 5d 61 07 61 19}  //weight: 5, accuracy: High
        $x_5_2 = {d1 28 eb 00 00 0a 26 11 06 28 ec 00 00 0a 6f ed 00 00 0a 13 31 18 13 08 11 08 16 73 e0 00 00 0a 13 13 7e 37 00 00 04 06 20 83 19 04 bd 58 07 61 11 08 60 61}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSCV_2147899342_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSCV!MTB"
        threat_id = "2147899342"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 16 73 07 ?? ?? ?? 73 08 ?? ?? ?? 13 03 38 16 ?? ?? ?? fe 0c 00 00 45 02 ?? ?? ?? 6d ?? ?? ?? 45 ?? ?? ?? 38 68 ?? ?? ?? 00 11 03 11 02 28 0a 00 00 06 38 ?? ?? ?? 00 dd 2c ?? ?? ?? 11 03 6f 09 ?? ?? ?? 38 ?? ?? ?? 00 dc 20 01 ?? ?? ?? 7e 54 00 00 04 7b 17 00 00 04 39 b9 ff ff ff 26 20 01 ?? ?? ?? 38 ae ff ff ff 11 02 6f 0a ?? ?? ?? 13 09 20 ?? ?? ?? 00 7e 54 00 00 04 7b 12 00 00 04 39 91 ff ff ff 26 20 ?? ?? ?? 00 38 86 ff ff ff dd 79 00 00 00}  //weight: 5, accuracy: Low
        $x_1_2 = "GetResponseStream" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSCW_2147899343_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSCW!MTB"
        threat_id = "2147899343"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {28 04 00 00 06 73 18 00 00 0a 0b 73 14 00 00 0a 0c 07 16 73 19 00 00 0a 73 1a 00 00 0a 0d 09 08 6f 16 00 00 0a de 0a}  //weight: 5, accuracy: High
        $x_1_2 = "GetResponseStream" ascii //weight: 1
        $x_1_3 = "ToArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAF_2147899345_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAF!MTB"
        threat_id = "2147899345"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 00 11 05 11 00 11 06 11 05 59 17 59 91 9c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSDE_2147899354_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSDE!MTB"
        threat_id = "2147899354"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {00 06 7e 01 00 00 04 6f 28 ?? ?? ?? 00 06 18 6f 29 ?? ?? ?? 00 06 18 6f 2a ?? ?? ?? 00 06 6f 2e ?? ?? ?? 0b 02 28 2f ?? ?? ?? 0c 07 08 16 08 8e 69 6f 2c ?? ?? ?? 0d 09 13 04 de 0b}  //weight: 5, accuracy: Low
        $x_1_2 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_3 = "IEnumerable" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSDW_2147899357_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSDW!MTB"
        threat_id = "2147899357"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 cb 00 00 0a 13 04 11 04 17 6f cc ?? ?? ?? 11 04 17 6f cd ?? ?? ?? 11 04 0b 07 03 06 6f ce ?? ?? ?? 0c 28 2a ?? ?? ?? 08 02 16 02 8e 69 6f cf ?? ?? ?? 6f 2b ?? ?? ?? 0d 09 1f 10 6f d0 ?? ?? ?? 13 05 de 06}  //weight: 5, accuracy: Low
        $x_1_2 = "TransformFinalBlock" ascii //weight: 1
        $x_1_3 = "ComputeHash" ascii //weight: 1
        $x_1_4 = "SymmetricAlgorithm" ascii //weight: 1
        $x_1_5 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSEK_2147899362_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSEK!MTB"
        threat_id = "2147899362"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {09 69 8d a7 00 00 01 25 17 73 26 00 00 0a 13 04 06 6f 27 00 00 0a 1f 0d 6a 59 13 05 07 06 11 04 11 05 09 6f 23 00 00 06 2a}  //weight: 5, accuracy: High
        $x_1_2 = "IEnumerable" ascii //weight: 1
        $x_1_3 = "DebuggingModes" ascii //weight: 1
        $x_1_4 = "BlockCopy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSEN_2147899363_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSEN!MTB"
        threat_id = "2147899363"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {73 b0 00 00 0a 0d 16 13 04 2b 32 09 08 17 8d 17 00 00 01 25 16 11 04 8c 63 00 00 01 a2 14 28 aa ?? ?? ?? 28 ae ?? ?? ?? 1f 10 28 b1 ?? ?? ?? 86 6f b2 ?? ?? ?? 00 11 04}  //weight: 5, accuracy: Low
        $x_1_2 = "GetHashCode" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGB_2147899367_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGB!MTB"
        threat_id = "2147899367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 a9 01 00 06 0a 06 6f ?? ?? ?? 0a 0b 20 ed 13 04 4c 28 6f 02 00 06 28 0c 00 00 06 28 0a 00 00 06 07 73 ?? ?? ?? 0a 18 28 17 02 00 06 06 6f ?? ?? ?? 0a de 03}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGF_2147899368_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGF!MTB"
        threat_id = "2147899368"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {03 28 f3 00 00 0a 20 6e ba fb 42 28 6b 02 00 06 6f ?? ?? ?? 0a 73 ?? ?? ?? 0a 0c 02 28 ?? ?? ?? 0a 73 ?? ?? ?? 0a 0d 73 ?? ?? ?? 0a 0a 06 08 06 6f ?? ?? ?? 0a 1e 5b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 09 28 1b 01 00 06 6f ?? ?? ?? 0a 06 06 6f ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 13 04 09 11 04 16 73 31 01 00 0a 13 05}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGK_2147899369_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGK!MTB"
        threat_id = "2147899369"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {8d 1a 00 00 01 25 d0 33 00 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 0c 08 02 16 02 8e 69 6f ?? ?? ?? 0a 08 6f ?? ?? ?? 0a 06 28 ?? ?? ?? 06 0d 28 ?? ?? ?? 06 09 2a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSGW_2147899370_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSGW!MTB"
        threat_id = "2147899370"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {28 22 00 00 06 0b 07 1f 20 8d 1f 00 00 01 25 d0 34 00 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 07 1f 10 8d 1f 00 00 01 25 d0 37 00 00 04 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 06 07 6f ?? ?? ?? 0a 17 73 ?? ?? ?? 0a 25 02 16 02 8e 69 6f ?? ?? ?? 0a 6f 99 00 00 0a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSHI_2147899371_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSHI!MTB"
        threat_id = "2147899371"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 16 00 00 0a 72 01 00 00 70 28 04 00 00 06 6f ?? ?? ?? 0a 0a 06 6f ?? ?? ?? 0a 0b 07 18 5b 8d 21 00 00 01 0c 16 0d 2b 18 08 09 18 5b 06 09 18 6f ?? ?? ?? 0a 1f 10 28 ?? ?? ?? 0a 9c 09 18 58 0d 09 07 32 e4}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSHM_2147899372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSHM!MTB"
        threat_id = "2147899372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {73 53 00 00 06 0a 06 28 95 00 00 0a 7d 46 00 00 04 06 02 7d 48 00 00 04 06 03 7d 47 00 00 04 06 15 7d 45 00 00 04 06 7c 46 00 00 04 12 00 28 05 00 00 2b 06 7c 46 00 00 04 28 97 00 00 0a 2a}  //weight: 2, accuracy: High
        $x_1_2 = "GetEnumerator" ascii //weight: 1
        $x_1_3 = "VirtualProtect" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSQK_2147899411_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSQK!MTB"
        threat_id = "2147899411"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {28 27 00 00 0a 7e 01 00 00 04 02 08 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a a5 01 00 00 1b 0b 11 07 20 07 41 65 e7 5a 20 15 a1 3c 4e 61 38 9a fe ff ff 02 20 ff ff ff 3f 5f 10 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSUZ_2147899413_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSUZ!MTB"
        threat_id = "2147899413"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 67 00 00 06 14 fe 06 65 00 00 06 73 6f 00 00 06 80 14 00 00 04 7e 14 00 00 04 20 45 8c f5 f8 65 20 4f b6 2e fa 58 20 0a 2a 39 01 61 65 28 68 00 00 06 28 69 00 00 06}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PSVA_2147899414_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PSVA!MTB"
        threat_id = "2147899414"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 00 11 00 28 ?? 00 00 06 11 00 28 ?? 00 00 06 28 ?? 00 00 06 13 01 20 02 00 00 00 38 9f ff ff ff 11 00 02 7b 04 00 00 04 28 ?? 00 00 06 28 ?? 00 00 06 28 14 00 00 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEH_2147899426_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEH!MTB"
        threat_id = "2147899426"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 11 2d ab 07 28 ?? 00 00 0a 13 05 11 05 72 55 10 00 70 6f b7 00 00 0a 13 06 11 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NLR_2147899699_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NLR!MTB"
        threat_id = "2147899699"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 18 d2 13 2e 11 18 1e 63 d1 13 18 11 1a 11 0a 91 13 25 11 1a 11 0a 11 23 ?? ?? 61 19 11 1d 58 61 11 2e 61 d2 9c 11 25 13 1d 17 11 0a 58 ?? ?? 11 0a 11 26 32 a4}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCFT_2147899715_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCFT!MTB"
        threat_id = "2147899715"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 35 00 41 00 39 00 5b 00 5d 00 5b 00 5d 00 33 00 5b 00 5d 00 5b 00 5d 00 5b 00 5d 00 30 00 34 00 5b 00 5d 00 5b 00 5d 00 5b 00 5d 00 46 00 46 00 46 00 46 00 5b 00 5d 00 5b 00 5d 00 42 00 38}  //weight: 1, accuracy: High
        $x_1_2 = {46 00 30 00 36 00 37 00 35 00 30 00 34 00 5b 00 5d 00 5b 00 5d 00 31 00 42 00 36 00 46 00 30 00 35 00 5b 00 5d 00 5b 00 5d 00 30 00 41 00 30 00 41 00 31 00 31 00 30 00 39 00 32 00 30 00 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFQ_2147899774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFQ!MTB"
        threat_id = "2147899774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 35 00 41 00 39 00 7b 00 7d 00 7b 00 7d 00 33 00 7b 00 7d 00 7b 00 7d 00 7b 00 7d 00 30 00 34 00 7b 00 7d 00 7b 00 7d 00 7b 00 7d 00 46 00 46 00 46 00 46}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAG_2147899776_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAG!MTB"
        threat_id = "2147899776"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 08 18 6f 6f 00 00 0a 1f 10 28 70 00 00 0a 9c 00 08 18 58 0c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AAAR_2147899850_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AAAR!MTB"
        threat_id = "2147899850"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {11 05 11 02 18 5b 02 11 02 18 6f ?? ?? 00 0a 1f 10 28 ?? ?? 00 06 9c 38 ?? 00 00 00 16 13 02 38 ?? ff ff ff 11 00 18 5b 8d ?? 00 00 01 13 05 38 ?? ff ff ff 00 11 02 18 58 13 02 38 ?? 00 00 00 00 02 6f ?? ?? 00 0a 13 00}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SSPF_2147899886_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SSPF!MTB"
        threat_id = "2147899886"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {1f 09 9a 0c 02 7b ?? ?? ?? 04 17 8d ?? ?? ?? 01 25 16 1f 5f 9d 6f ?? ?? ?? 0a 0d 08 19 8d ?? ?? ?? 01 25 16 09 16 9a a2 25 17 09 17 9a a2}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREZ_2147899934_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREZ!MTB"
        threat_id = "2147899934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DownloadData" ascii //weight: 1
        $x_1_2 = "GetExportedTypes" ascii //weight: 1
        $x_1_3 = "ToString" ascii //weight: 1
        $x_1_4 = "Reverse" ascii //weight: 1
        $x_1_5 = "ToArray" ascii //weight: 1
        $x_1_6 = "$bbdaa562-85b9-4290-9304-9954728bee9b" ascii //weight: 1
        $x_1_7 = "://gigantoferkft.hu/Bajtolqrb.dat" ascii //weight: 1
        $x_1_8 = "RunFactory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREZ_2147899934_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREZ!MTB"
        threat_id = "2147899934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "PushServer" ascii //weight: 1
        $x_1_2 = "GetMethod" ascii //weight: 1
        $x_1_3 = "PublishTests" ascii //weight: 1
        $x_1_4 = "GetExportedTypes" ascii //weight: 1
        $x_1_5 = "InvokeServer" ascii //weight: 1
        $x_1_6 = "DownloadData" ascii //weight: 1
        $x_1_7 = "$3264063e-2c1f-492f-8889-e796cc728652" ascii //weight: 1
        $x_1_8 = {2f 00 2f 00 38 00 32 00 2e 00 31 00 31 00 38 00 2e 00 32 00 31 00 2e 00 36 00 39 00 2f 00 79 00 69 00 79 00 2f 00 [0-20] 2e 00 77 00 61 00 76 00}  //weight: 1, accuracy: Low
        $x_1_9 = {2f 2f 38 32 2e 31 31 38 2e 32 31 2e 36 39 2f 79 69 79 2f [0-20] 2e 77 61 76}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (8 of ($x*))
}

rule Trojan_MSIL_AgentTesla_PREZ_2147899934_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PREZ!MTB"
        threat_id = "2147899934"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 59 00 20 00 01 00 00 13 ?? 11 ?? 17 58 13 ?? 11 ?? 20 00 ba 00 00 5d 13 ?? 11 ?? 20 00 ba 00 00 5d 13 ?? ?? 11 ?? 91 13 ?? ?? 11 ?? 1f 16 5d 91 13 ?? ?? 11 ?? 91 11 ?? 58 13 ?? 11 ?? 11 ?? 61 13 ?? 11 ?? 11 ?? 59 13 ?? ?? 11 ?? 11 ?? 11 ?? 5d d2 9c 00 11 ?? 17 58 13 ?? 11 ?? 20 00 ba 00 00 fe 04 13 ?? 11 ?? 2d 98}  //weight: 1, accuracy: Low
        $x_1_2 = "5JZ44K8EG5GZST7HE57QR7" ascii //weight: 1
        $x_1_3 = "16690FAAA72C4979F9391D7018A2DD73179782E3A0773D8350230C1CFB9CE23B" ascii //weight: 1
        $x_1_4 = "ToString" ascii //weight: 1
        $x_1_5 = "InitializeComponent" ascii //weight: 1
        $x_1_6 = "SuspendLayout" ascii //weight: 1
        $x_1_7 = "ResumeLayout" ascii //weight: 1
        $x_1_8 = "InitializeArray" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEK_2147899994_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEK!MTB"
        threat_id = "2147899994"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f 38 01 00 0a 06 6f 39 01 00 0a 13 04 02 0d 11 04 09 16}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEL_2147899995_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEL!MTB"
        threat_id = "2147899995"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {39 b6 00 00 00 28 ?? 00 00 06 6c 28 ?? 00 00 06 06 28 ?? 00 00 06 28 ?? 00 00 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEM_2147899996_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEM!MTB"
        threat_id = "2147899996"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7e 2a 01 00 04 28 ?? 01 00 06 11 26 7e 2a 01 00 04 28 ?? 01 00 06 7e 88 01 00 04 28 ?? 02 00 06 28 ?? 00 00 2b 13 15}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_YAA_2147900135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.YAA!MTB"
        threat_id = "2147900135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ResolveStrategy" ascii //weight: 1
        $x_1_2 = "Mduwokd.Annotations" ascii //weight: 1
        $x_1_3 = "Mduwokd.States" ascii //weight: 1
        $x_1_4 = "PolicyErrorStatus" ascii //weight: 1
        $x_1_5 = {73 05 00 00 0a 72 01 00 00 70 28 0c 00 00 06 13 00 20 00 00 00 00}  //weight: 1, accuracy: High
        $x_1_6 = {11 00 28 01 00 00 2b 28 02 00 00 2b 13 00 20 01 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SSR_2147900208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SSR!MTB"
        threat_id = "2147900208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {11 04 11 0a 02 11 0a 91 03 11 0a 03 6f ?? ?? ?? 0a 5d 28 ?? ?? ?? 06 61 d2 9c 38 ?? ?? ?? 00 00 11 0a 17 58 13 0a 20 ?? ?? ?? 00 38 21 fe ff ff}  //weight: 4, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEY_2147900408_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEY!MTB"
        threat_id = "2147900408"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 7a 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0c 00 28 ?? 00 00 0a 72 62 0d 00 70 18 17 8d 16 00 00 01 25 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTEZ_2147900409_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTEZ!MTB"
        threat_id = "2147900409"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {8d 43 00 00 01 25 16 72 d8 0c 00 70 28 ?? 00 00 0a d2 9c 25 17 17 28 ?? 00 00 0a 16 91 9c 25}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CYD_2147900432_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CYD!MTB"
        threat_id = "2147900432"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {38 79 00 00 00 2b 0a 72 ?? ?? ?? 70 2b 0a 0b de 18 73 20 00 00 0a 2b ef 28 21 00 00 0a 2b ef 08 2c 06 08 6f 02 00 00 0a dc 07 28 ?? ?? ?? 2b 28 02 00 00 2b 28 24 00 00 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCFW_2147900452_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCFW!MTB"
        threat_id = "2147900452"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 11 06 1f 16 5d 91 13 0d 11 0c 11 0d 61 13 0e 07 11 09 11 0e 11 0b 59 11 07 5d d2 9c 00 11 06 17 58 13 06 11 06 20 ?? ?? ?? ?? fe 04 13 0f 11 0f 2d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTFK_2147900621_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTFK!MTB"
        threat_id = "2147900621"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {75 3c 00 00 01 28 ?? 00 00 06 28 ?? 00 00 06 28 ?? 00 00 2b 28 ?? 00 00 06 14 1a d0 16 00 00 02}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCGP_2147900708_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCGP!MTB"
        threat_id = "2147900708"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 16 1f 16 5d 91 13 1c 07 11 1a 91 11 17 58 13 1d 11 1b 11 1c 61 13 1e 11 1e 11 1d 59 13 1f 07 11 19 11 1f 11 17 5d d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTFQ_2147900766_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTFQ!MTB"
        threat_id = "2147900766"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 49 00 00 0a dc 06 28 ?? 00 00 2b 28 ?? 00 00 2b 0a de 03 26 de bb}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTFZ_2147900844_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTFZ!MTB"
        threat_id = "2147900844"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {72 01 00 00 70 6f 15 00 00 0a 0d 09 17 8d 1a 00 00 01 25 16 1f 0a 9d 6f 16 00 00 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGB_2147900846_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGB!MTB"
        threat_id = "2147900846"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7b 0c 00 00 04 17 8d 74 00 00 01 25 16 1f 5f 9d 6f 9c 00 00 0a 0b 06 28 ?? 00 00 06 28 ?? 00 00 0a 0c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCGT_2147900869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCGT!MTB"
        threat_id = "2147900869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 10 1f 16 5d 91 13 16 11 0b 11 14 91 11 11 58 13 17 11 15 11 16 61 13 18 11 18 11 17 59 13 19 11 0b 11 13 11 19 11 11 5d d2 9c 00 11 10 17 58 13 10 11 10}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVA_2147900919_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVA!MTB"
        threat_id = "2147900919"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 11 09 11 0e 11 0b 59 11 07 5d d2 9c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGN_2147900967_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGN!MTB"
        threat_id = "2147900967"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7b e7 00 00 04 6f 39 01 00 0a 28 ?? 01 00 0a 7e e5 00 00 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGP_2147901033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGP!MTB"
        threat_id = "2147901033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 4b 00 00 70 6f 05 00 00 06 0c 28 ?? 00 00 0a 06 72 7b 00 00 70 28 ?? 00 00 0a 6f 04 00 00 06 6f 08 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGR_2147901058_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGR!MTB"
        threat_id = "2147901058"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7b 0c 00 00 04 03 58 7d 0c 00 00 04 20 00 00 00 00 7e 1d 00 00 04 7b 19 00 00 04 3a cc ff ff ff 26}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGS_2147901059_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGS!MTB"
        threat_id = "2147901059"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {ff ff 11 00 28 ?? 00 00 2b 28 ?? 00 00 2b 28 ?? ?? ?? ?? 02 7b 04 00 00 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAH_2147901101_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAH!MTB"
        threat_id = "2147901101"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 7b 07 00 00 04 6f 2b 00 00 0a 28 2c 00 00 0a 0c 16 13 08}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JD_2147901105_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JD!MTB"
        threat_id = "2147901105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 05 11 0a 94 13 0b 11 04 11 0a 11 04 8e 69 5d 91 13 0c 11 06 11 0a 11 0b 11 0c 61 9e}  //weight: 2, accuracy: High
        $x_2_2 = {11 0a 17 58 13 0a 11 0a 11 05 8e 69}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGT_2147901135_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGT!MTB"
        threat_id = "2147901135"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 01 00 00 0a dc 07 28 ?? 00 00 2b 28 ?? 00 00 2b 28 ?? 01 00 0a 6f 1e 01 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTAS_2147901141_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTAS!MTB"
        threat_id = "2147901141"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 26 11 04 28 ?? 00 00 0a 6f 26 00 00 0a 13 37 18 13 07 11 07 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTDB_2147901145_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTDB!MTB"
        threat_id = "2147901145"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 72 51 00 00 70 7e 08 00 00 04 28 ?? 00 00 06 74 01 00 00 1b 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAI_2147901195_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAI!MTB"
        threat_id = "2147901195"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 08 91 66 03 5f 60 d2 9c 00 08 17 58 0c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SU_2147901224_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SU!MTB"
        threat_id = "2147901224"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 11 05 11 04 5d 13 08 07 11 08 91 08 11 05 1f 16 5d 91 61 13 09 11 09 07 11 05 17 58 11 04 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d 13 0a 07 11 08 11 0a d2 9c 11 05 17 58 13 05 00 11 05 11 04 09 17 58 5a fe 04 13 0b 11 0b 2d b2}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_JE_2147901227_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.JE!MTB"
        threat_id = "2147901227"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0a 06 8e 69 8d ?? 00 00 01 0b 16 0c 2b}  //weight: 2, accuracy: Low
        $x_2_2 = {07 08 06 08 91 03 66 5f 06 08 91 66 03 5f 60 d2 9c 00 08 17 58 0c 08 06 8e 69 fe 04 0d 09 2d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGU_2147901273_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGU!MTB"
        threat_id = "2147901273"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {fe 06 1a 00 00 06 73 14 00 00 0a 28 02 00 00 2b 28 03 00 00 2b 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_UNk_2147901309_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.UNk!MTB"
        threat_id = "2147901309"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 0a 91 11 07 58 13 0d 07 11 09 11 0b 11 0c 61 11 0d 11 07 5d 59 d2 9c 00 11 06 17 58 13 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAJ_2147901316_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAJ!MTB"
        threat_id = "2147901316"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 16 02 8e 69 6f 0f 00 00 0a 0b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BF_2147901409_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BF!MTB"
        threat_id = "2147901409"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ZAAM,AACUAAB,QATAAMUAGOADBABWAAVAAOIAGCADEABSQA3IAMEAHEADLABZQ,,,,AA7AACYAAEAE6ADSABUQAZYANEAG4ADBABWAARQANEAGYADFABXAAYIANUAGK,ABLQA2IANYAFEADBABZAALQAMQAGYADM,,AAFYAAOAABA" ascii //weight: 1
        $x_1_2 = "BIAA4QAN4AGIADVABRQA5AAJYAGCADNABSQ,,AFOADJABXAAUQAMEAHE,,AANAAB,CACQABZAA3YAMQAHKADDAB2AAVQAMUAHEADTABUQA3YANY,ABRAAXAAMAAFYADAABOAAY,AAH,QAABABAQA4YAOMAGKADNABRAA3AAPEACAA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_BF_2147901409_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.BF!MTB"
        threat_id = "2147901409"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {06 17 58 20 ff 00 00 00 5f 0a 07 05 06 95 58 20 ff 00 00 00 5f 0b 02 05 06 8f ?? 00 00 01 05 07 8f ?? 00 00 01 28 ?? 00 00 06 00 05 06 95 05 07 95 58 20 ff 00 00 00 5f 0d 04 08 03 08 91 05 09 95 61 d2 9c 00 08 17 58 0c 08 03 8e 69 fe 04}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGZ_2147901423_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGZ!MTB"
        threat_id = "2147901423"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 08 00 00 0a 72 61 00 00 70 28 ?? 00 00 0a 0d 09 28 ?? 00 00 2b 28 ?? 00 00 2b 0d dd 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHA_2147901424_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHA!MTB"
        threat_id = "2147901424"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 12 02 28 ?? 00 00 0a 6f 04 00 00 0a 6f 05 00 00 0a 28 ?? 00 00 0a 07 28 ?? 00 00 0a 39}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHB_2147901425_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHB!MTB"
        threat_id = "2147901425"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 e6 09 00 70 28 ?? 02 00 06 26 02 28 ?? 02 00 06 0a 28 47 01 00 0a 06 16 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHC_2147901521_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHC!MTB"
        threat_id = "2147901521"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 1f 21 9d 28 ?? 00 00 06 0c 20 62 87 c3 6e 28 ?? 00 00 2b 28 80 00 00 06 20 19 4c 04 34}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHD_2147901522_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHD!MTB"
        threat_id = "2147901522"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {1f 61 6a 08 28 ?? 00 00 06 80 08 00 00 04 20 09 00 00 00 17 3a 99 00 00 00 26 28 ?? 00 00 06 25 26 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHE_2147901523_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHE!MTB"
        threat_id = "2147901523"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 0f 00 00 0a dc 06 28 ?? 00 00 2b 28 ?? 00 00 2b 0a 28 ?? 01 00 0a 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVB_2147901631_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVB!MTB"
        threat_id = "2147901631"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {73 07 00 00 0a 72 01 00 00 70 28 08 00 00 0a 0b dd 0d 00 00 00}  //weight: 2, accuracy: High
        $x_2_2 = {07 28 01 00 00 2b 28 02 00 00 2b 28 0c 00 00 0a 6f 0d 00 00 0a 28 03 00 00 2b 0d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_SGA_2147901635_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SGA!MTB"
        threat_id = "2147901635"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 04 11 05 28 07 00 00 0a 6f 08 00 00 0a 28 09 00 00 0a 11 06 16 16 6f 0b 00 00 06 16 26 26 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAK_2147901644_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAK!MTB"
        threat_id = "2147901644"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 03 28 03 00 00 2b 28 04 00 00 2b 13 03}  //weight: 2, accuracy: High
        $x_1_2 = "Hjxcseugaji" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHF_2147901689_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHF!MTB"
        threat_id = "2147901689"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {16 80 ef 01 00 04 28 ?? 03 00 06 28 ?? 04 00 0a 80 f0 01 00 04 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHG_2147901690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHG!MTB"
        threat_id = "2147901690"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 00 16 11 03 16 11 04 28 ?? 00 00 06 20 01 00 00 00 7e 07 08 00 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHH_2147901792_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHH!MTB"
        threat_id = "2147901792"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 6c 00 00 0a 0c 20 4b 47 14 a2 28 ?? 00 00 06 28 ?? 00 00 0a 20 ac 47 14 a2 28 ?? 00 00 06 20 00 01 00 00 14}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAL_2147901946_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAL!MTB"
        threat_id = "2147901946"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SDNViewer" ascii //weight: 1
        $x_1_2 = "John Coleman" ascii //weight: 1
        $x_1_3 = "BETA 2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHO_2147901949_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHO!MTB"
        threat_id = "2147901949"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 d6 e0 ff ff 28 ?? 00 00 06 11 0e 16 11 0e 8e 69 28 ?? 00 00 06 13 05}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHP_2147901950_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHP!MTB"
        threat_id = "2147901950"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 f5 00 00 0a 13 05 2b 13 28 ?? 00 00 0a 11 11 16 11 11 8e 69 6f f8 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHQ_2147901951_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHQ!MTB"
        threat_id = "2147901951"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 09 6f d8 00 00 0a 28 0c 00 00 2b 13 07}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LZ_2147901972_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LZ!MTB"
        threat_id = "2147901972"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {57 df b6 fd 09 0f 00 00 00 fa 25 33 00 16 00 00 02 00 00 00 f8 00 00 00 94 00 00 00 34 04 00 00 f8 14}  //weight: 2, accuracy: High
        $x_1_2 = "GetDomain" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZN_2147902022_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZN!MTB"
        threat_id = "2147902022"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 8e 69 5d 02 06 07 06 8e 69 5d 91 09 07 09 6f ?? 01 00 0a 5d 6f ?? 01 00 0a 61 28 ?? 01 00 0a 06 07 17 58 06 8e 69 5d 91 28 ?? 01 00 0a 59 20 00 01 00 00 58 28 ?? 00 00 06 28 ?? 01 00 0a 9c 07 15 58 0b}  //weight: 1, accuracy: Low
        $x_1_2 = "SwitchboardServer.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHR_2147902040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHR!MTB"
        threat_id = "2147902040"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 8f 00 00 70 28 ?? 00 00 0a 06 28 ?? 00 00 0a 0b 02}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHS_2147902041_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHS!MTB"
        threat_id = "2147902041"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {8d 4b 00 00 01 25 17 73 20 00 00 0a 13 04 06 6f 21 00 00 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHU_2147902063_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHU!MTB"
        threat_id = "2147902063"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 bd 00 00 70 28 ?? 00 00 06 28 ?? 00 00 06 fe 0c 01 00 6f 28 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAO_2147902222_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAO!MTB"
        threat_id = "2147902222"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 6f 9f 00 00 0a 28 17 00 00 2b 13 06 11 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAP_2147902318_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAP!MTB"
        threat_id = "2147902318"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {13 07 11 07 47 20 ?? ?? ?? ?? 59 d2 52 11 06 17 58 13 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCHS_2147902336_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCHS!MTB"
        threat_id = "2147902336"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "screenLogger" ascii //weight: 1
        $x_1_2 = "keyLogger" ascii //weight: 1
        $x_1_3 = "OSFullName" wide //weight: 1
        $x_1_4 = "CPU:" wide //weight: 1
        $x_1_5 = "User Name" wide //weight: 1
        $x_1_6 = "SbieDll.dll" wide //weight: 1
        $x_1_7 = "Opera Mail\\Opera Mail" wide //weight: 1
        $x_1_8 = "Software\\TightVNC" wide //weight: 1
        $x_1_9 = "DownloadManager\\Passwords" wide //weight: 1
        $x_1_10 = "hostname|encryptedPassword|encryptedUsername" wide //weight: 1
        $x_1_11 = "Google\\Chrome\\User Data" wide //weight: 1
        $x_1_12 = "Chromium\\User Data" wide //weight: 1
        $x_1_13 = "Mozilla\\icecat" wide //weight: 1
        $x_1_14 = "Elements Browser\\User Data" wide //weight: 1
        $x_1_15 = "Microsoft\\Edge\\User Data" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIC_2147902399_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIC!MTB"
        threat_id = "2147902399"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 0f 11 11 6f 44 00 00 0a 00 11 0f 6f 45 00 00 0a 00 11 10 6f 46 00 00 0a 13 12 11 08}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTID_2147902400_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTID!MTB"
        threat_id = "2147902400"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {d0 09 00 00 01 28 ?? 00 00 0a 11 06 72 37 00 00 70 28 ?? 00 00 06 28 ?? 00 00 2b 28 ?? 00 00 06 26 20 05 00 00 00 fe 0e 01 00 38 c8 fc ff ff 11 07 28 ?? 00 00 06 28 ?? 00 00 2b 13 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIE_2147902401_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIE!MTB"
        threat_id = "2147902401"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f 1a 00 00 0a 04 0e 08 04 8e 69 6f 1b 00 00 0a 0a 06 0b 2b 00}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAQ_2147902497_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAQ!MTB"
        threat_id = "2147902497"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {61 d1 6f 07 00 00 0a 26 08 17 58 0c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAR_2147902516_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAR!MTB"
        threat_id = "2147902516"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {1f 20 5d 17 58 13 04 11 04 59 20 80 00 00 00 58 20 80 00 00 00 5d d1 13 05 06 11 05}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SX_2147902570_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SX!MTB"
        threat_id = "2147902570"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$93D29062-9E61-4AAC-B286-AEC0179ACEF1" ascii //weight: 1
        $x_1_2 = "Stub\\Projects\\Confiformsyalla\\obj\\Debug\\Confiformsyalla.pdb" ascii //weight: 1
        $x_1_3 = "You have been hacked by Confiformsyalla" ascii //weight: 1
        $x_1_4 = "Confiformsyalla.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFT_2147902584_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFT!MTB"
        threat_id = "2147902584"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 09 2a 00 02 11 04 91 11 01 61 11 00 11 03 91 61 13 0a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVC_2147902588_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVC!MTB"
        threat_id = "2147902588"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {8f 36 00 00 01 25 47 09 11 10 09 8e 69 5d 91 61 d2 52}  //weight: 1, accuracy: High
        $x_1_2 = "WeAreChmnet.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAS_2147902610_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAS!MTB"
        threat_id = "2147902610"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 28 07 00 00 0a 07 28 08 00 00 0a 0d 07}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIJ_2147902640_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIJ!MTB"
        threat_id = "2147902640"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 49 00 00 0a 7e 13 00 00 04 03 04 6f 4a 00 00 0a 0a 7e 14 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIK_2147902641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIK!MTB"
        threat_id = "2147902641"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f 21 00 00 0a 6f 23 00 00 0a 06 6f 24 00 00 0a 02 16 02 8e 69 6f 25 00 00 0a 0b de 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAT_2147902642_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAT!MTB"
        threat_id = "2147902642"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {13 0f 11 0c 11 0f 6f ?? ?? ?? ?? 00 00 11 0d 18 58 13 0d 11 0d 11 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIL_2147902691_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIL!MTB"
        threat_id = "2147902691"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7e 03 00 00 04 6f 35 00 00 0a 03 0e 07 03 8e 69 6f 36 00 00 0a 0a 06 0b}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIM_2147902692_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIM!MTB"
        threat_id = "2147902692"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {20 95 11 9d 67 18 28 ?? 00 00 06 12 12 28 ?? 00 00 0a 28 ?? 00 00 0a 28 ?? 00 00 06 11 12 28 ?? 00 00 06 a2}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIN_2147902693_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIN!MTB"
        threat_id = "2147902693"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {1f 40 12 08 28 ?? 00 00 06 00 08 28 ?? 00 00 2b 16 11 06 08 8e 69 28 ?? 00 00 0a 00 11 06}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIP_2147902805_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIP!MTB"
        threat_id = "2147902805"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {1f 24 9d 6f d0 00 00 0a 0d 72 2b 06 00 70 28 ?? 00 00 0a 72 61 06 00 70}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GZZ_2147902812_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GZZ!MTB"
        threat_id = "2147902812"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {09 11 04 6f ?? ?? ?? 0a 13 05 00 07 17 1f 15 6f ?? ?? ?? 0a 13 06 11 05 11 06 59 20 00 00 01 00 58 20 00 00 01 00 5d d1 13 07 08 11 07 6f ?? ?? ?? 0a 26 00 11 04 17 58 13 04 11 04 09 6f ?? ?? ?? 0a 32 bc}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVD_2147902835_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVD!MTB"
        threat_id = "2147902835"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 11 06 59 7e 03 00 00 04 28 01 00 00 2b 58 7e 03 00 00 04 28 01 00 00 2b 5d d1 13 07}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVE_2147902836_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVE!MTB"
        threat_id = "2147902836"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 06 11 07 11 06 11 07 6f 3a 00 00 0a 06 11 05 06 8e 69 5d 91 61 d2 6f 3b 00 00 0a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVF_2147902837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVF!MTB"
        threat_id = "2147902837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 11 0a 11 0c 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
        $x_1_2 = "GrowServices" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVG_2147902838_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVG!MTB"
        threat_id = "2147902838"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 07 06 8e 69 6a 5d d4 11 07 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
        $x_1_2 = "prosper" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GPD_2147902881_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GPD!MTB"
        threat_id = "2147902881"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {03 00 90 5a 4d 30 00 31 00 32}  //weight: 1, accuracy: High
        $x_1_2 = {00 52 65 76 65 72 73 65 00}  //weight: 1, accuracy: High
        $x_1_3 = {6c 6c 64 2e 65 65 72 6f 63 73 6d 00 6e 69 61 4d 6c 6c 44 72 6f 43 5f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GPE_2147902933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GPE!MTB"
        threat_id = "2147902933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "allstarprivate.net" ascii //weight: 1
        $x_1_2 = {00 44 6f 77 6e 6c 6f 61 64 50 61 79 6c 6f 61 64 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SY_2147902961_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SY!MTB"
        threat_id = "2147902961"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 17 58 13 07 06 20 c0 e1 00 00 5d 13 04 07 11 04 91 13 08 06 1f 16 5d 13 09 07 11 04 11 08 1f 16 8d 06 00 00 01 25 d0 15 00 00 04 28 0f 01 00 0a 11 09 91 61 07 11 07 20 c0 e1 00 00 5d 91 20 00 01 00 00 58 20 00 01 00 00 5d 59 d2 9c 06 17 58 0a 06 20 c0 e1 00 00 fe 04 13 0a 11 0a 2d a0}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAU_2147902989_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAU!MTB"
        threat_id = "2147902989"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 03 28 74 00 00 0a 20 1b}  //weight: 2, accuracy: High
        $x_2_2 = {11 03 28 75 00 00 0a 13 05}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVH_2147903176_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVH!MTB"
        threat_id = "2147903176"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 08 07 8e 69 5d 11 0e 20 00 01 00 00 5d d2 9c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EZAA_2147903187_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EZAA!MTB"
        threat_id = "2147903187"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {11 0b 91 61 11 01 11 09 91 11 06 58 11 06 5d 59 d2 9c}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_FAAA_2147903188_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.FAAA!MTB"
        threat_id = "2147903188"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = {0a 16 06 6f ?? 00 00 06 8e 69 20 00 10 00 00 1f 40 28 ?? 00 00 06 0b 16 06 6f ?? 00 00 06 8e 69 20 00 10 00 00 1f 40 28 ?? 00 00 06 0c 06 6f ?? 00 00 06 16 07 06 6f ?? 00 00 06 8e 69}  //weight: 4, accuracy: Low
        $x_1_2 = "CreateDecryptor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTIW_2147903204_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTIW!MTB"
        threat_id = "2147903204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7e 1b 00 00 04 11 00 6f 59 00 00 0a 28 ?? 00 00 06 28 ?? 00 00 0a 20}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAW_2147903222_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAW!MTB"
        threat_id = "2147903222"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 8e 69 6a 5d d4 91 61 28}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPCX_2147903233_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPCX!MTB"
        threat_id = "2147903233"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {5d d4 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 11 05 17 6a 58 13 05}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GPF_2147903250_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GPF!MTB"
        threat_id = "2147903250"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {06 11 10 8f 33 00 00 01 25 47 07 11 10 07 8e 69 5d 91 61 d2 52 00 11 10 17 58 13 10 11 10 06 8e 69 fe 04 13}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SGB_2147903287_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SGB!MTB"
        threat_id = "2147903287"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7e 02 00 00 04 7e 03 00 00 04 28 0f 00 00 0a 28 06 00 00 0a 26 2a}  //weight: 2, accuracy: High
        $x_1_2 = "LootAlert.exe" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ATE_2147903334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATE!MTB"
        threat_id = "2147903334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {13 1b 2b 1e 00 11 04 11 1b 11 04 11 1b 91 11 05 11 1b 11 05 8e 69 5d 91 61 d2 9c 00 11 1b 17 58 13 1b 11 1b 11 04 8e 69}  //weight: 2, accuracy: High
        $x_1_2 = "Stub\\Projects\\Jabret\\obj\\Debug\\Jabret.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_GPC_2147903348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.GPC!MTB"
        threat_id = "2147903348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {09 08 5d 13 ?? 07 11 ?? 91 11 ?? 09 1f ?? 5d 91 61 13 ?? 07 11 ?? 11 ?? 07 09 17 58 08 5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d d2 9c}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SPXP_2147903378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SPXP!MTB"
        threat_id = "2147903378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {5d d4 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? 0a 9c 06 17 6a 58 0a}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJC_2147903416_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJC!MTB"
        threat_id = "2147903416"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {26 7e 16 00 00 04 fe 06 36 00 00 06 73 15 00 00 0a 25 80 17 00 00 04 28 ?? 00 00 2b 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJD_2147903417_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJD!MTB"
        threat_id = "2147903417"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {5a 61 2b 84 28 ?? 00 00 0a 7e 01 00 00 04 02 08 6f 27 00 00 0a 28 ?? 00 00 0a a5 01 00 00 1b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVI_2147903547_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVI!MTB"
        threat_id = "2147903547"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 11 05 91 72 27 00 00 70 7e 1d 00 00 04 25 2d 17 26 7e 1c 00 00 04 fe 06 46 00 00 06 73 32 00 00 0a 25 80 1d 00 00 04 28 01 00 00 2b 28 02 00 00 2b 09 1f}  //weight: 1, accuracy: High
        $x_1_2 = "StepNavigation Wizard" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVJ_2147903548_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVJ!MTB"
        threat_id = "2147903548"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 04 28 11 00 00 0a 28 12 00 00 0a 11 04 6f 13 00 00 0a 13 05}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJJ_2147903793_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJJ!MTB"
        threat_id = "2147903793"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 05 00 00 0a 07 16 6a 6f 06 00 00 0a 14 0a 07 6f 07 00 00 0a 28 ?? 00 00 0a 0c 08 14 28 ?? 00 00 0a 39 2b 00 00 00}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJM_2147903833_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJM!MTB"
        threat_id = "2147903833"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 7e 03 00 00 04 6f 31 00 00 0a 05 0e 07 0e 04 8e 69 6f 32 00 00 0a 0a 06 0b 2b 00 07 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFW_2147903896_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFW!MTB"
        threat_id = "2147903896"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {d4 91 61 28 ?? 00 00 0a 07 11 ?? 08 6a 5d d4 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBFX_2147904062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBFX!MTB"
        threat_id = "2147904062"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 11 04 09 6f ?? 00 00 0a 13 05 08 11 04 09 11 05}  //weight: 1, accuracy: Low
        $x_1_2 = "pathologist.d" ascii //weight: 1
        $x_1_3 = "8234B121842B" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZA_2147904063_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZA!MTB"
        threat_id = "2147904063"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0a 17 6a 58 13 17 20 00 01 00 00 13 13 11 0b 11 12 11 0b 11 12 91 1f 16}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZC_2147904252_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZC!MTB"
        threat_id = "2147904252"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5d 91 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: High
        $x_1_2 = "GTHVHH5GGYFCDFG8UD85VI" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZD_2147904253_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZD!MTB"
        threat_id = "2147904253"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 16 16 28 03 00 00 06 16 31 01 2a 20 b1 04 00 00 28 0a 00 00 0a 08 17 58 0c 08 1b 32 d2}  //weight: 1, accuracy: High
        $x_1_2 = {28 06 00 00 0a 16 0c 2b 2a 06 28 07 00 00 0a 6f 08 00 00 0a 28 09 00 00 0a 07 16}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKYU_2147904334_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKYU!MTB"
        threat_id = "2147904334"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {06 28 07 00 00 0a 6f 08 00 00 0a 28 09 00 00 0a 07 16 16 28 03 00 00 06 16 31 01 2a 20 b1 04 00 00 28 0a 00 00 0a 08 17 58 0c 08 1b 32 d2}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJS_2147904372_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJS!MTB"
        threat_id = "2147904372"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {73 2d 00 00 0a 07 28 2e 00 00 0a 6f 2f 00 00 0a 28 21 00 00 06 28 03 00 00 2b 7e 1e 00 00 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJU_2147904402_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJU!MTB"
        threat_id = "2147904402"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {8c 42 00 00 01 a2 28 ?? 00 00 0a 13 0d 02 11 0d 28 ?? 00 00 06 13 0e 72 df 01 00 70 28 ?? 00 00 06 1f 0f}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJV_2147904403_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJV!MTB"
        threat_id = "2147904403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7e 04 00 00 04 28 ?? 00 00 0a 02 6f 25 00 00 0a 6f 26 00 00 0a 0a 7e 03 00 00 04 06 25 0b 6f 27 00 00 0a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJW_2147904404_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJW!MTB"
        threat_id = "2147904404"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {d0 1a 00 00 04 28 ?? 00 00 0a 00 13 07 16 13 14 2b 1e 11 06 11 14 11 05 11 14 18 5a 18 6f 4c 00 00 0a 1f 10 28 ?? 00 00 0a 9c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZE_2147904464_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZE!MTB"
        threat_id = "2147904464"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 28 ?? ?? ?? ?? 06 07 17 58 06 8e 69 5d 91 28 ?? ?? ?? ?? 59 20 00 01 00 00 58 20 00 01 00 00 5d 28 ?? ?? ?? ?? 9c 07 15 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZG_2147904580_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZG!MTB"
        threat_id = "2147904580"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "jffgjfdsddfsdgkffff" ascii //weight: 1
        $x_1_2 = "hfsdkffdghsfdffdafdchd" ascii //weight: 1
        $x_1_3 = "fghhdfgffffdfdfddshfdasdfh" ascii //weight: 1
        $x_1_4 = "cffdfdffrsfsshdkfffgh" ascii //weight: 1
        $x_1_5 = "hjfdfhgfaffdfddcdffffskhj" ascii //weight: 1
        $x_1_6 = "ffgrfdfffffkhsjd" ascii //weight: 1
        $x_1_7 = "FromBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZH_2147904618_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZH!MTB"
        threat_id = "2147904618"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d d4 07 11 ?? 07 8e 69 6a 5d d4 91 08 11 ?? 69 6f ?? ?? ?? 0a 61 07 11 ?? 17}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJX_2147904628_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJX!MTB"
        threat_id = "2147904628"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {73 02 00 00 0a 72 01 00 00 70 28 ?? 00 00 0a 0a 06 28 ?? 00 00 0a 02 06 28 ?? 00 00 0a 7d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZJ_2147904662_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZJ!MTB"
        threat_id = "2147904662"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {8e 69 6a 5d d4 91 08 11 ?? 69}  //weight: 5, accuracy: Low
        $x_5_2 = "Lo!!!!!ad" ascii //weight: 5
        $x_1_3 = "CreateInstance" ascii //weight: 1
        $x_1_4 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZK_2147904753_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZK!MTB"
        threat_id = "2147904753"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {61 06 08 17 6a 58 06 8e 69 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZL_2147904754_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZL!MTB"
        threat_id = "2147904754"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 28 ?? 01 00 0a 07 11 ?? 17 58 07 8e 69 5d 91}  //weight: 1, accuracy: Low
        $x_1_2 = {54 00 56 00 4e 00 48 00 53 00 35 00 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KKAA_2147904768_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KKAA!MTB"
        threat_id = "2147904768"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "SELECT * FROM Win32_Processor" wide //weight: 2
        $x_2_2 = "Win32_NetworkAdapterConfiguration" wide //weight: 2
        $x_2_3 = "IPEnabled" wide //weight: 2
        $x_2_4 = "Win32_BaseBoard" wide //weight: 2
        $x_2_5 = "FormatID: {0}" wide //weight: 2
        $x_2_6 = "Version: 0x{0:X}" wide //weight: 2
        $x_2_7 = "\\Device\\LanmanRedirector\\" wide //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKB_2147904772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKB!MTB"
        threat_id = "2147904772"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {08 15 31 10 12 01 07 8e 69 28 ?? 00 00 2b 07 28 ?? 00 00 0a 16 2d f7 07 28 ?? 00 00 0a 0d 07 2c 3d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKC_2147904773_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKC!MTB"
        threat_id = "2147904773"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {73 cc 00 00 0a 25 80 2c 00 00 04 28 05 00 00 2b 28 06 00 00 2b 0c 06}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKD_2147904774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKD!MTB"
        threat_id = "2147904774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f cd 00 00 0a 28 ?? 00 00 0a d0 13 00 00 02 28 ?? 00 00 0a 6f cf 00 00 0a 28 ?? 00 00 06 6f 3d 00 00 0a 73 3e 00 00 0a 0d}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAX_2147904778_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAX!MTB"
        threat_id = "2147904778"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 06 6f 5f 00 00 0a 11 04 91 08 11 04 08 8e 69 5d 91 61 d2 6f 5e 00 00 0a 11 04 17 58 13 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZM_2147904833_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZM!MTB"
        threat_id = "2147904833"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {91 61 07 11 ?? 17 58 07 8e 69 5d 91 28 ?? ?? ?? 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZO_2147904844_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZO!MTB"
        threat_id = "2147904844"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 08 06 08 91 20 00 01 00 00 59 03 08 03 6f ?? 00 00 0a 5d 6f ?? 00 00 0a 58 20 00 01 00 00 5d d2 9c 00 08 17 58 0c 08 06 8e 69}  //weight: 1, accuracy: Low
        $x_1_2 = {59 00 61 00 68 00 65 00 48 00 61 00 74 00 2e 00 65 00 78 00 65}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZP_2147904845_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZP!MTB"
        threat_id = "2147904845"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {61 06 07 17 6a 58 11 ?? 6a 5d d4 91 28 ?? 00 00 0a 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKE_2147904910_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKE!MTB"
        threat_id = "2147904910"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6f 11 00 00 0a 02 7b 20 00 00 04 6f 12 00 00 0a 02 02 fe 06 4e 00 00 06 73 24 00 00 0a 28 ?? 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKF_2147904911_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKF!MTB"
        threat_id = "2147904911"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {7d 02 00 00 04 de 2b 73 5d 00 00 0a 2b dd 28 ?? 00 00 0a 2b dd}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKG_2147904912_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKG!MTB"
        threat_id = "2147904912"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {09 08 8e 69 28 ?? 00 00 0a 07 16 11 04 07 8e 69 28 ?? 00 00 0a 09 11 04 28 ?? 00 00 06 6f 11 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_HKAA_2147904939_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.HKAA!MTB"
        threat_id = "2147904939"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {0a 0b 06 8e 69 8d 64 00 00 01 0c 16 0d 2b 15 00 08 09 06 09 91 07 09 07 8e 69 5d 91 61 d2 9c 00 09 17 58 0d 09 06 8e 69 fe 04 13 04 11 04 2d df}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKH_2147905019_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKH!MTB"
        threat_id = "2147905019"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {03 02 fe 06 3c 00 00 06 73 3e 00 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 73 41 00 00 0a 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKI_2147905020_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKI!MTB"
        threat_id = "2147905020"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 08 02 16 02 8e 69 6f 82 00 00 0a 00 11 08 6f 83 00 00 0a 00 11 07 6f 84 00 00 0a 0c de 0e}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKJ_2147905021_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKJ!MTB"
        threat_id = "2147905021"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {17 da 1f 13 14 1b 20 af 1d dd 1c 28 ?? 02 00 06 28 ?? 01 00 06 09 75 0d 00 00 1b 28 ?? 01 00 06 a2 1d 13 07}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZR_2147905037_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZR!MTB"
        threat_id = "2147905037"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 08 11 ?? 1f ?? 5d 6f ?? ?? ?? 0a 61 13 ?? 11 ?? 11 ?? 59 20 00 01 00 00 58 20 00 01 00 00 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZF_2147905045_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZF!MTB"
        threat_id = "2147905045"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {06 07 17 58 06 8e 69 5d 91 28 [0-64] 9c 07 15 58 0b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTKK_2147905054_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTKK!MTB"
        threat_id = "2147905054"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 08 02 16 02 8e 69 6f 81 00 00 0a 00 11 08 6f 82 00 00 0a 00 11 07 6f 83 00 00 0a 0c de 0e}  //weight: 2, accuracy: High
        $x_2_2 = {11 04 6f 29 01 00 0a 28 ?? 00 00 2b 28 ?? 00 00 2b 0a 2b 00 06 2a}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_SE_2147905072_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SE!MTB"
        threat_id = "2147905072"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "RejoiceRefReshing.resources" ascii //weight: 2
        $x_2_2 = "$2cb0bb1f-887f-4f48-ab8f-95b7e9d207af" ascii //weight: 2
        $x_2_3 = "KJCwLYMMbUDxCNRk" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_STY_2147905281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.STY!MTB"
        threat_id = "2147905281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {16 13 0c 2b 47 00 07 11 0c 17 58 11 07 5d 91 13 0d 07 11 0c 91 13 0e 08 11 0c 08 6f 44 00 00 0a 5d 6f 45 00 00 0a 13 0f 11 0e 11 0f 61 11 0d 59 20 00 01 00 00 58 20 ff 00 00 00 5f 13 10 07 11 0c 11 10 d2 9c 00 11 0c 17 58 13 0c 11 0c 11 07 fe 04 13 11 11 11 2d ad}  //weight: 1, accuracy: High
        $x_1_2 = {16 0a 2b 3e 07 06 17 58 09 5d 91 13 0c 07 06 91 13 0d 08 06 08 6f 72 00 00 0a 5d 6f 73 00 00 0a 13 0e 11 0d 11 0e 61 11 0c 59 20 00 01 00 00 58 20 ff 00 00 00 5f 13 0f 07 06 11 0f d2 9c 06 17 58 0a 06 09 fe 04 13 10 11 10 2d b8}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTGV_2147905354_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTGV!MTB"
        threat_id = "2147905354"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {17 8d 41 00 00 01 25 16 1f 2c 9d 28 ?? 00 00 0a 0d 7e 66 00 00 0a 13 04 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTHY_2147905356_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTHY!MTB"
        threat_id = "2147905356"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2b 08 15 2c ed 28 ?? 00 00 0a 06 28 ?? 00 00 0a 2b 15 02 16 25 2d 6a 2f 08 16 28 ?? 00 00 0a 2b 06 16 28 ?? 00 00 0a 06 28 ?? 00 00 0a 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJK_2147905358_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJK!MTB"
        threat_id = "2147905358"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {11 07 1f 16 6a 5d 13 0b 07 11 08 07 11 08 91 09 11 0b d4 91 61 28 ?? 00 00 0a 07 11 09 08 6a 5d d4 91 28 ?? 00 00 0a 59 11 0a 58 11 0a 5d 28 ?? 00 00 0a 9c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJT_2147905359_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJT!MTB"
        threat_id = "2147905359"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {d0 b6 00 00 02 28 ?? 00 00 0a 6f 7e 02 00 0a 72 34 06 00 70 6f 8c 02 00 0a 73 af 01 00 0a 25 6f b0 01 00 0a 16}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PTJZ_2147905361_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PTJZ!MTB"
        threat_id = "2147905361"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {38 20 02 00 00 28 ?? 00 00 0a 7e 01 00 00 04 02 08 6f 25 00 00 0a 28 ?? 00 00 0a a5 11 00 00 1b 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_STI_2147905476_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.STI!MTB"
        threat_id = "2147905476"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {72 01 00 00 70 28 0c 00 00 0a 73 0d 00 00 0a 0a 06 72 27 00 00 70 6f 0e 00 00 0a 28 0f 00 00 0a 28 04 00 00 06 0b 06 72 4d 00 00 70 6f 0e 00 00 0a 28 0f 00 00 0a 28 04 00 00 06 0c 16 08 8e 69 20 00 10 00 00 1f 40 28 02 00 00 06 0d 16 07 8e 69 20 00 10 00 00 1f 40 28 02 00 00 06}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_STJ_2147905582_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.STJ!MTB"
        threat_id = "2147905582"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {16 0c 2b 4b 11 05 08 91 13 08 07 17 58 06 8e 69 5d 13 09 06 11 09 91 13 0a 11 04 07 11 04 ?? ?? ?? ?? ?? 5d ?? ?? ?? ?? ?? 13 0b 11 08 11 0b 61 11 0a 59 20 00 01 00 00 58 20 ff 00 00 00 5f 13 0c 06 07 11 0c d2 9c 07 17 58 0b 08 17 58 0c 08 11 05 8e 69 32 ae}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIO_2147905630_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIO!MTB"
        threat_id = "2147905630"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 19 5d 16 fe 01 0c 08 2c 08 02 07 02 07 91 03 61 9c 07 17 d6 0b 07 06 31 e6}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIO_2147905630_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIO!MTB"
        threat_id = "2147905630"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {13 08 11 08 61 11 07 59 20 00 01 00 00 58 20 ff 00 00 00 5f 13 09 07 09 11 09 d2 9c 09}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIO_2147905630_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIO!MTB"
        threat_id = "2147905630"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 28 83 00 00 06 13 05 11 04 1f 16 5d 13 06 11 04 17 58 13 07 07 11 04 91 11 05 11 06 91 61 13 08 07 11 04 11 08 07 11 07 07 8e 69 5d 91 59 20 00 01 00 00 58 d2 9c 00 11 04 17 58 13 04 11 04 07 8e 69 fe 04 13 09 11 09 2d b5}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SJKY_2147905698_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SJKY!MTB"
        threat_id = "2147905698"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 06 11 05 11 (0f|1f) 9a 1f 10 28 [0-4] 6f [0-4] 00 11 (0f|1f) 17 d6 13 (0f|1f) 11 (0f|1f) 11 [0-2] 31 e0}  //weight: 1, accuracy: Low
        $x_1_2 = "GetType" ascii //weight: 1
        $x_1_3 = "GetObjectValue" ascii //weight: 1
        $x_1_4 = "LateGet" ascii //weight: 1
        $x_1_5 = "CallByName" ascii //weight: 1
        $x_1_6 = "QuanLyBanGiay.CCM" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZS_2147905864_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZS!MTB"
        threat_id = "2147905864"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 8e 69 5d 91 61 d2 07 [0-5] 17 58 09 5d 91 59 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAY_2147905974_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAY!MTB"
        threat_id = "2147905974"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 04 11 01 28 01 00 00 2b 28 02 00 00 2b 16 11 01 8e 69}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZT_2147906241_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZT!MTB"
        threat_id = "2147906241"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 58 07 8e 69 5d 91 13 [0-32] 61 13 [0-32] 59 20 00 01 00 00 58 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZU_2147906274_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZU!MTB"
        threat_id = "2147906274"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 8e 69 5d 91}  //weight: 1, accuracy: High
        $x_1_2 = {59 20 00 01 00 00 58 20 ff 00 00 00 5f d2 9c 00 11}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZV_2147906745_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZV!MTB"
        threat_id = "2147906745"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {d4 91 61 06 11 ?? 11 ?? 6a 5d d4 91 28 ?? 00 00 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SI_2147906977_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SI!MTB"
        threat_id = "2147906977"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {09 17 58 13 04 07 11 04 07 8e 69 5d 91 13 05 08 09 1f 16 5d 91 13 06 07 09 91 11 06 61 13 07 07 09 11 07 11 05 59 20 00 01 00 00 58 20 ff 00 00 00 5f d2 9c 09 17 58 0d 09 07 8e 69 32 c2}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVK_2147907301_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVK!MTB"
        threat_id = "2147907301"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 05 28 1b 00 00 0a 13 06}  //weight: 1, accuracy: High
        $x_1_2 = {06 28 14 00 00 0a 74 1e 00 00 01 0b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SUI_2147907381_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SUI!MTB"
        threat_id = "2147907381"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "://103.74.105.78/GRANADA/Znusl.vdf" ascii //weight: 1
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "Convert" ascii //weight: 1
        $x_1_4 = "ToBase64String" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SUI_2147907381_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SUI!MTB"
        threat_id = "2147907381"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0b 16 0c 07 8e 69 0d 11 0a 1f 68 91 20 8e 00 00 00 59 13 09 38 9b fe ff ff 00 08 17 58 13 06 07 08 07 08 91 28 07 00 00 06 08 1f 16 5d 91 61 07 11 06 07 8e 69 5d 91 59 20 00 01 00 00 58 d2 9c 1e 13 09}  //weight: 1, accuracy: High
        $x_1_2 = "FDEFCTNGHEWAORR8CZJF" ascii //weight: 1
        $x_1_3 = "Tehcizat.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZW_2147907475_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZW!MTB"
        threat_id = "2147907475"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5d 91 61 07 08 17 58 07 8e 69 5d 91 59 20 00 01 00 00 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZZ_2147907638_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZZ!MTB"
        threat_id = "2147907638"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 07 11 ?? 09 5d 91 59 20 00 01 00 00 58 d2}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZX_2147907639_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZX!MTB"
        threat_id = "2147907639"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5a 58 02 58 17 59 d3 1e 5a 58 4f 0c}  //weight: 1, accuracy: High
        $x_1_2 = "d13eb6222" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBZY_2147907687_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBZY!MTB"
        threat_id = "2147907687"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 07 11 [0-4] 8e 69 5d 91 59 20 00 01 00 00 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDAZ_2147907847_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDAZ!MTB"
        threat_id = "2147907847"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {03 28 34 00 00 0a 0a 02 7b 01 00 00 04 6f 35 00 00 0a 06 16 06 8e 69 6f 36 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYA_2147907855_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYA!MTB"
        threat_id = "2147907855"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {5d 91 61 11 [0-16] 5d 91 59 20 00 01 00 00 58}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBA_2147907933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBA!MTB"
        threat_id = "2147907933"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f e0 00 00 0a 28 62 00 00 06 a2 28 e1 00 00 0a 75 55 00 00 01 0c 08 6f e2 00 00 0a 17 9a 0d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYB_2147907974_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYB!MTB"
        threat_id = "2147907974"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 35 00 41 00 39 00 7c 00 7c 00 33 00 7c 00 7c 00 7c 00 30 00 34 00 7c 00 7c 00 7c 00 46 00 46 00 46 00 46 00 7c 00 7c 00 42 00 38 00 7c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYC_2147908215_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYC!MTB"
        threat_id = "2147908215"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 17 58 09 5d 13 ?? 07 08 91 1f ?? 8d ?? 00 00 01 25}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYE_2147908306_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYE!MTB"
        threat_id = "2147908306"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 58 08 5d 0d 06 07 91 1f ?? 8d ?? 00 00 01 25}  //weight: 1, accuracy: Low
        $x_1_2 = {5f 9c 58 09 5d 13 06 07 08 91 1f ?? 8d ?? 00 00 01 25}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBB_2147908355_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBB!MTB"
        threat_id = "2147908355"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 08 02 08 91 07 08 07 8e 69 5d 91 61 d2 9c 00 08 17 58 0c 08 02 8e 69 fe 04 0d 09}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVR_2147908403_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVR!MTB"
        threat_id = "2147908403"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 7b 3e 00 00 04 16 02 7b 41 00 00 04 02 7b 3e 00 00 04 8e 69}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKU_2147908432_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKU!MTB"
        threat_id = "2147908432"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Harmonizegraceful" ascii //weight: 1
        $x_1_2 = "MesMerizinggleeful" ascii //weight: 1
        $x_1_3 = "Nightmarewhimsy" ascii //weight: 1
        $x_1_4 = "dXRXuBXckhVoQJLV" ascii //weight: 1
        $x_1_5 = "$8b8aab0f-dc9b-4c90-815d-748b91f2b644" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKU_2147908432_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKU!MTB"
        threat_id = "2147908432"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "OpenMcdf.Structs" ascii //weight: 1
        $x_1_2 = "Lzefgtdydo.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "$5aca2ac2-278a-48f2-b691-f617cd269a23" ascii //weight: 1
        $x_1_4 = "twoPnphu.Consumers" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBC_2147908509_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBC!MTB"
        threat_id = "2147908509"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 1f 16 5d 91 61 07 08 17 58 11 08 5d 91 59 20 00 01 00 00 58 13 09}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ACK_2147908944_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ACK!MTB"
        threat_id = "2147908944"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 19 8d 5e 00 00 01 25 16 12 02 28 59 00 00 0a 9c 25 17 12 02 28 5a 00 00 0a 9c 25 18 12 02 28 5b 00 00 0a 9c 13 06 19}  //weight: 2, accuracy: High
        $x_2_2 = "CrudApplication.Properties.Resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ACK_2147908944_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ACK!MTB"
        threat_id = "2147908944"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\logs\\RecolectorDocumentos" ascii //weight: 1
        $x_1_2 = "SaxSettings" ascii //weight: 1
        $x_1_3 = "Regimen-Tipo-Operacion-CvePedimento Inv" ascii //weight: 1
        $x_1_4 = "Solium Forwarding Inc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBD_2147909009_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBD!MTB"
        threat_id = "2147909009"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 6f 52 00 00 0a 0c 08 06 16 06 8e 69 6f 53 00 00 0a 0d 09}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBE_2147909171_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBE!MTB"
        threat_id = "2147909171"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 10 91 13 11 11 0f 17 58 11 08 5d 13 12 11 07 11 0f 91 11 11 61 11 07 11 12 91 59 13 13 11 13 20 00 01 00 00 58 13 14}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKV_2147909204_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKV!MTB"
        threat_id = "2147909204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 06 1f 16 5d 13 07 09 11 04 28 01 00 00 2b 11 05 28 01 00 00 2b 28 02 00 00 2b 11 07 91 13 08 11 06 17 58 08 5d 13 09 07 11 06 91 11 08 61 07 11 09 91 59 20 00 01 00 00 58 13 0a 07 11 06 11 0a 20 ff 00 00 00 5f d2 9c 11 06 17 58 13 06 11 06 07 8e 69 32 aa}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKV_2147909204_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKV!MTB"
        threat_id = "2147909204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {91 13 0d 11 06 09 95 11 06 11 04 95 58 d2 13 0e 11 0e 20 ff 00 00 00 5f d2 13 0f 11 06 11 0f 95 d2 13 10 11 0d 11 10 61 13 11 11 07}  //weight: 1, accuracy: High
        $x_1_2 = "7FJE3F4R8FF015AGO4A58G" ascii //weight: 1
        $x_1_3 = "TimeWindowsFormsApplication.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PADS_2147909205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PADS!MTB"
        threat_id = "2147909205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "..\\..\\sound\\mayfall.WAV" wide //weight: 1
        $x_1_2 = "..\\..\\sound\\kill.WAV" wide //weight: 1
        $x_1_3 = "..\\..\\sound\\bk_music\\first.WAV" wide //weight: 1
        $x_1_4 = "/download?resid=" wide //weight: 1
        $x_1_5 = "..\\..\\cursor\\harrow.cur" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEK_2147909348_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEK!MTB"
        threat_id = "2147909348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {2b 2c 72 01 00 00 70 2b 28 2b 2d 0d 16 2d 0e 09 08 6f 12 00 00 0a 08 6f 13 00 00 0a 0a de 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AEK_2147909348_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AEK!MTB"
        threat_id = "2147909348"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 8e 69 13 05 08 1f 16 5d 13 06 09 11 04 28 ab 00 00 06 11 06 91 13 07 08 17 58 11 05 5d 13 08 07 08 91 11 07 61 07 11 08 91 59 20 00 01 00 00 58 13 09 07 08 11 09 20 ff 00 00 00 5f d2 9c 08 17 58 0c 08 07 8e 69 32 b7}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBF_2147909378_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBF!MTB"
        threat_id = "2147909378"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {0d 09 11 06 17 73 73 00 00 0a 13 04 11 04 02 16 02 8e 69}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBG_2147909523_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBG!MTB"
        threat_id = "2147909523"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 17 58 11 ?? 5d 13 ?? 07 06 91 11 ?? 61 07 11}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYF_2147909690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYF!MTB"
        threat_id = "2147909690"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {3c 4d 6f 64 75 6c 65 3e 00 45 75 67 65 6e 65 00 4f 62 6a 65 63 74 00 50 72 6f 67 72 61 6d 00 41 6e 67 65 6c 6f 00 52 65 6d 6f 74 65 4f 62 6a 65 63 74 73}  //weight: 1, accuracy: High
        $x_1_2 = {4e 00 45 00 54 00 43 00 72 00 79 00 70 00 74 00 2e 00 65 00 78}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AFK_2147909722_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFK!MTB"
        threat_id = "2147909722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 91 13 08 11 06 17 58 08 5d 13 09 07 11 06 91 11 08 61 07 11 09 91 59 20 00 01 00 00 58 13 0a 07 11 06 11 0a 20 ff 00 00 00 5f d2 9c 11 06 17 58 13 06 11 06 07 8e 69 32 aa}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AFK_2147909722_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AFK!MTB"
        threat_id = "2147909722"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "CryptoObfuscator_Output\\HHH887.pdb" ascii //weight: 2
        $x_2_2 = "HHH887.Properties" ascii //weight: 2
        $x_2_3 = "$4289b195-ac66-41c8-b680-687d024bf317" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBH_2147909733_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBH!MTB"
        threat_id = "2147909733"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {17 58 08 5d 13 ?? 07 11 ?? 91 11 ?? 61 07 11}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AIK_2147909869_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AIK!MTB"
        threat_id = "2147909869"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 0a 91 13 0b 06 17 58 09 5d 13 0c 07 06 91 11 0b 61 07 11 0c 91 59 13 0d 11 0d 20 00 01 00 00 58 13 0e 07 06 11 0e d2 9c 06 17 58 0a 06 07 8e 69 fe 04 13 0f 11 0f 2d ac}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AJK_2147909870_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJK!MTB"
        threat_id = "2147909870"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 1a 5d 16 fe 01 0d 09 2c 0b 02 08 02 08 91 1f 3d 61 b4 9c 00 00 08 17 d6 0c 08 07 31 e2}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AJK_2147909870_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AJK!MTB"
        threat_id = "2147909870"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 06 08 03 08 91 07 08 07 8e 69 5d 91 61 d2 9c 00 08 17 58 0c 08 04 8e 69 fe 04 0d 09 2d e1}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBI_2147909895_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBI!MTB"
        threat_id = "2147909895"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 09 5d 13 0f 08 07 91 11 0e 61 08 11 0f 91 59 13 10}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYG_2147910208_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYG!MTB"
        threat_id = "2147910208"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 05 11 04 91 11 11 61 11 05 11 12 91 59 13}  //weight: 1, accuracy: High
        $x_1_2 = {13 0f 09 20 ?? 00 00 00 91 20 ?? 00 00 00 59 0a}  //weight: 1, accuracy: Low
        $x_1_3 = {02 58 05 59 d2 61 d2 81}  //weight: 1, accuracy: High
        $x_1_4 = {13 07 06 20 ?? 00 00 00 91 06 1f ?? 91 59 0c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBJ_2147910209_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBJ!MTB"
        threat_id = "2147910209"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 11 0a 91 11 0e 61 07 11 0f 91 59 13 10}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKF_2147910376_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKF!MTB"
        threat_id = "2147910376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 02 06 07 28 f0 00 00 06 0c 04 03 6f f6 00 00 0a 59 0d 03 08 09 28 f2 00 00 06 00 03 08 09 28 f4 00 00 06 00 03 04 28 f5 00 00 06 00 00 07 17 58 0b 07 02 6f f7 00 00 0a fe 04 13 04 11 04 2d bf}  //weight: 1, accuracy: High
        $x_1_2 = "ConBook.Properties.Resources" ascii //weight: 1
        $x_1_3 = "ConBook.Properties.Resources.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKF_2147910376_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKF!MTB"
        threat_id = "2147910376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 11 04 07 11 04 91 09 11 04 09 6f 37 00 00 0a 5d 6f 38 00 00 0a 61 d2 9c 11 04 17 58 13 04 11 04 07 8e 69 32 da}  //weight: 1, accuracy: High
        $x_1_2 = "https://inspirecollege.co.uk/trashss/" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKF_2147910376_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKF!MTB"
        threat_id = "2147910376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Product.Properties.Resources" ascii //weight: 1
        $x_1_2 = "//167.160.166.205/1571.bin" ascii //weight: 1
        $x_1_3 = {00 7e 08 00 00 04 06 7e 08 00 00 04 06 91 20 23 06 00 00 59 d2 9c 00 06 17 58 0a 06 7e 08 00 00 04 8e 69 fe 04 0b 07 2d d7}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKF_2147910376_3
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKF!MTB"
        threat_id = "2147910376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {13 0c 11 0c 1f 7b 61 20 ff 00 00 00 5f 13 0d 11 0d 20 c8 01 00 00 58 20 00 01 00 00 5e 13 0d 11 0d 16 fe 01 13 0e 11 0e 2c 03 17 13 0d 09 11 0b 07 11 0b 91 11 04 11 0c 95 61 d2 9c 00 11 0b 17 58 13 0b 11 0b 07 8e 69 fe 04 13 0f 11 0f 3a 66 ff ff ff}  //weight: 1, accuracy: High
        $x_1_2 = "AP7H9H5OI4478F8CH05FGA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKF_2147910376_4
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKF!MTB"
        threat_id = "2147910376"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 06 07 28 05 00 00 06 0c 04 03 6f 40 00 00 0a 59 0d 03 08 09 28 06 00 00 06 07 17 58 0b 07 02 6f 41 00 00 0a 2f 09 03 6f 40 00 00 0a 04 32 d0}  //weight: 1, accuracy: High
        $x_1_2 = "Memori.Properties" ascii //weight: 1
        $x_1_3 = "$3a1672e0-0564-4928-bbf7-572cc7ea924f" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBK_2147910697_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBK!MTB"
        threat_id = "2147910697"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 09 5d 13 0d 11 07 11 06 91 11 0c 61 13 0e 11 07 11 0d}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBL_2147910848_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBL!MTB"
        threat_id = "2147910848"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 12 08 28 17 00 00 0a 11 05 11 04 11 06 18 6f 18 00 00 0a 1f 10 28}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYH_2147910891_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYH!MTB"
        threat_id = "2147910891"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 58 08 5d [0-64] 91 11 ?? 61 13}  //weight: 1, accuracy: Low
        $x_1_2 = "87558S7E72P84HGCCGGH5G" wide //weight: 1
        $x_1_3 = "Load" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOL_2147910907_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOL!MTB"
        threat_id = "2147910907"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {28 b4 00 00 0a 72 0f 0c 00 70 6f b5 00 00 0a 09 1f 16 5d 91 13 04 07 09 91 11 04 61 13 05 09 17 58 08 5d 13 06 07 11 06 91 13 07 20 00 01 00 00 13 08 11 05 11 07 59 11 08 58 11 08 17 59 5f 13 09 07 09 11 09 d2 9c 09 17 58 0d 09 08 32 b1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOL_2147910907_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOL!MTB"
        threat_id = "2147910907"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0d 11 10 61 13 11 11 07 11 0c d4 11 11 20 ff 00 00 00 5f d2 9c 1f 37 13 15 38 68 f9}  //weight: 1, accuracy: High
        $x_1_2 = "V7GUG45H0C75Z5AE7487UQ" ascii //weight: 1
        $x_1_3 = "Jokenpo.Properties" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOL_2147910907_2
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOL!MTB"
        threat_id = "2147910907"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 14 11 16 61 13 17 11 07 11 13 d4 11 17 20 ff 00 00 00 5f d2 9c 16 13 1b 2b 25 00 11 17 6e 11 1b 6a 5a 11 16 6e 58 69 20 00 01 00 00 5d 13 1c 11 1c 19 58 1f 40 5d 13 1c 00 11 1b 17 58 13 1b 11 1b 19 fe 04 13 1d 11 1d 2d d0}  //weight: 1, accuracy: High
        $x_1_2 = "F7H8A87554B888QJH574E2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYI_2147911014_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYI!MTB"
        threat_id = "2147911014"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 58 08 5d 13 ?? 07 11 ?? 91 11 06 61}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYJ_2147911215_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYJ!MTB"
        threat_id = "2147911215"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 58 08 5d 13 [0-2] 11 ?? 91 11 ?? 61 13}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYK_2147911216_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYK!MTB"
        threat_id = "2147911216"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 09 02 09 6f ?? 00 00 0a 03 09 07 5d 6f ?? 00 00 0a 61 d1 9d 09 17 58 0d 09}  //weight: 1, accuracy: Low
        $x_1_2 = "ROT13Encode" ascii //weight: 1
        $x_1_3 = "xorStub.g.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBM_2147911389_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBM!MTB"
        threat_id = "2147911389"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {25 26 11 00 6f ?? ?? ?? ?? 25 26 6f ?? ?? ?? ?? 25 26 13 08}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOP_2147911428_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOP!MTB"
        threat_id = "2147911428"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 07 11 0d d4 11 0e 6e 11 11 20 ff 00 00 00 5f 6a 61 d2 9c 00 11 0d 17 6a 58 13 0d 11 0d 11 07 8e 69 17 59 6a fe 02 16 fe 01 13 12}  //weight: 1, accuracy: High
        $x_1_2 = "ESH0G8A73SBAG78GN9ZZH4" ascii //weight: 1
        $x_1_3 = "Devices_Custom.Properties.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYL_2147911589_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYL!MTB"
        threat_id = "2147911589"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {5f 6a 61 d2 9c}  //weight: 1, accuracy: High
        $x_1_2 = "ESH0G8A73SBAG78GN9ZZH4" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBN_2147911633_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBN!MTB"
        threat_id = "2147911633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 6f b3 00 00 0a 0d 09 6f b4 00 00 0a 18 9a 13 04 11 04}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYM_2147911659_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYM!MTB"
        threat_id = "2147911659"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {34 00 44 00 35 00 41 00 39 00 7e 00 7e 00 33 00 7e 00 7e 00 7e 00 30 00 34 00 7e 00 7e 00 7e 00 46 00 46 00 46 00 46 00 7e 00 7e 00 42 00 38 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 7e 00 34}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBO_2147911763_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBO!MTB"
        threat_id = "2147911763"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {03 06 06 6f 1b 00 00 0a 06 6f 1c 00 00 0a 6f 1d 00 00 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOJ_2147911774_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOJ!MTB"
        threat_id = "2147911774"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$d9cdf6be-9923-4c99-a6bd-ba947b13dba4" ascii //weight: 1
        $x_1_2 = {02 6f 6a 00 00 0a 18 5b 8d 06 00 00 01 0a 16 0b 2b 18 06 07 02 07 18 5a 18 6f 6b 00 00 0a 1f 10 28 6c 00 00 0a 9c 07 17 58 0b 07 06 8e 69 fe 04 0c 08 2d de}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ALK_2147911837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ALK!MTB"
        threat_id = "2147911837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 0a 11 09 91 13 0b 11 08 17 58 08 5d 13 0c 07 11 08 91 11 0b 61 07 11 0c 91 59 13 0d 11 0d 20 00 01 00 00 58 13 0e 07 11 08 11 0e 20 ff 00 00 00 5f d2 9c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBP_2147911978_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBP!MTB"
        threat_id = "2147911978"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6e 11 0c 20 ff 00 00 00 5f 6a 61 d2 9c 11 09 17 6a 58 13 09}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBQ_2147912164_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBQ!MTB"
        threat_id = "2147912164"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {5d 91 0d 07 08 91 09 61 07 08 17 58 07 8e 69 5d 91}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBR_2147912424_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBR!MTB"
        threat_id = "2147912424"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {03 04 6f 8a 00 00 0a 02 16 02 8e 69 6f 8b 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_LY_2147912525_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.LY!MTB"
        threat_id = "2147912525"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 0b 07 06 8e 69 1f 40 12 02 28}  //weight: 2, accuracy: High
        $x_2_2 = {09 11 04 58 06 11 04 91 52}  //weight: 2, accuracy: High
        $x_2_3 = {11 04 17 58 13 04 11 04 06 8e 69 fe 04 13 05 11 05}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AHK_2147912605_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AHK!MTB"
        threat_id = "2147912605"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 0b 6f 03 00 00 0a 13 23 11 0c 11 23 11 10 59 61 13 0c 11 10 11 0c 19 58 1e 63 59 13 10 11 0b 6f 4a 00 00 06 2d d9}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBS_2147913026_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBS!MTB"
        threat_id = "2147913026"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {6f 1a 00 00 0a 6f 1c 00 00 0a 02 7b 02 00 00 04 6f 1d 00 00 0a 06 16 06 8e 69 6f 1e 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBT_2147913129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBT!MTB"
        threat_id = "2147913129"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bc38f5e3-3a51-43c5-897a-178228d7f420" ascii //weight: 1
        $x_1_2 = "Update from Java" ascii //weight: 1
        $x_1_3 = "NorthAmericaUpdate.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYQ_2147913368_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYQ!MTB"
        threat_id = "2147913368"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 06 91 11 ?? 61 13 ?? 06 17 58 13 ?? 07 11 ?? 11 ?? 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBU_2147913388_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBU!MTB"
        threat_id = "2147913388"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 06 1f 16 5d 91 13 07 07 11 06 91 11 07 61 13 08 1f 66 13 10}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYR_2147913524_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYR!MTB"
        threat_id = "2147913524"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {91 11 06 61 13 ?? 11 ?? 17 58 08 5d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYT_2147913620_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYT!MTB"
        threat_id = "2147913620"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {17 58 08 5d 13}  //weight: 1, accuracy: High
        $x_1_2 = {17 59 5f 13}  //weight: 1, accuracy: High
        $x_1_3 = "7KAYQ785477472T9445E74" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOG_2147913633_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOG!MTB"
        threat_id = "2147913633"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "EmployeeManagementSystem.Properties" ascii //weight: 1
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "7KAYQ785477472T9445E74" ascii //weight: 1
        $x_1_4 = "$33a71d4b-4cd4-40e4-9b85-878afb84aa1e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYU_2147913679_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYU!MTB"
        threat_id = "2147913679"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 07 09 91 11 ?? 61 07 09 17 58 08 5d 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYV_2147913732_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYV!MTB"
        threat_id = "2147913732"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {61 07 11 06 17 58 08 5d 91 59 11 ?? 58 11 ?? 17 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYW_2147913903_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYW!MTB"
        threat_id = "2147913903"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {0d 07 06 91 11 [0-3] 61 07 06 17 58 08 5d 91 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBV_2147913973_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBV!MTB"
        threat_id = "2147913973"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {07 6f 75 00 00 0a 16 9a 0c 08 6f 76 00 00 0a 17 9a 0d 11 07}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBW_2147914055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBW!MTB"
        threat_id = "2147914055"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {09 1f 16 5d 91 13 04 07 09 91 11 04 61 09 17 58 08 5d 13 05 07}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBX_2147914186_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBX!MTB"
        threat_id = "2147914186"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 06 1f 16 5d 91 13 07 09 11 06 91 11 07 61 11 06 17 58 11 04 5d 13 08 09 11 08}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBYY_2147914281_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBYY!MTB"
        threat_id = "2147914281"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {1f 16 5d 91 13 [0-21] 61 [0-9] 17 58 [0-7] 5d [0-34] 20 00 01 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXA_2147914689_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXA!MTB"
        threat_id = "2147914689"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {41 00 41 00 00 0d 49 00 6e 00 76 00 6f 00 6b 00 65 00 00 0d 43 00 6c 00 69 00 65 00 6e}  //weight: 1, accuracy: High
        $x_1_2 = "PizzaOrderReceipt.Files.Def" ascii //weight: 1
        $x_1_3 = "Client.Properties" ascii //weight: 1
        $x_1_4 = "UrlTokenDecode" ascii //weight: 1
        $x_1_5 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXB_2147914717_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXB!MTB"
        threat_id = "2147914717"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_8_1 = {4c 00 6f 00 61 00 64 00 00 03 3a 00 00 05 41 00 41 00 00 29 49 00 6e 00 76 00 65 00 6e 00 74 00 6f 00 72 00 79 00 4d 00 61 00 69 00 6e 00 74 00 65 00 6e 00 61 00 6e 00 63 00 65}  //weight: 8, accuracy: High
        $x_1_2 = "Replace" ascii //weight: 1
        $x_1_3 = "Split" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXC_2147914840_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXC!MTB"
        threat_id = "2147914840"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 91 11 ?? 61 07 09 17 58 08 5d 91}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ZL_2147914841_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ZL!MTB"
        threat_id = "2147914841"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {07 09 23 48 e1 7a 14 ae 47 e1 3f 23 71 3d 0a d7 a3 70 dd 3f 23 18 2d 44 54 fb 21 19 40 09 6c 5a 03 17 da 6c 5b 28 7a 00 00 0a 5a 59 a1 09 17 d6 0d 09 08 31 cb}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXE_2147915043_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXE!MTB"
        threat_id = "2147915043"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {16 13 0b 11 0c 06 91 11 18 61 13 19 11 0c 06 17 58}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBY_2147915204_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBY!MTB"
        threat_id = "2147915204"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 06 11 12 95 d2 13 19 11 10 11 19 61 13 1a 11 07 11 0f}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXG_2147915222_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXG!MTB"
        threat_id = "2147915222"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 01 11 03 11 06 11 03 91 11 07 11 03 11 07 28 ?? 00 00 06 5d 28 ?? 00 00 06 61 d2 9c}  //weight: 1, accuracy: Low
        $x_1_2 = "C24TGL_00000531.Importers" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXH_2147915223_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXH!MTB"
        threat_id = "2147915223"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_3_1 = {41 00 41 00 00 0d 49 00 6e 00 76 00 6f 00 6b 00 65 00 00 0d 43 00 6c 00 69 00 65 00 6e 00 74 00 00 1d}  //weight: 3, accuracy: High
        $x_2_2 = "PizzaOrderReceipt.Files.Def" ascii //weight: 2
        $x_1_3 = "Split" ascii //weight: 1
        $x_1_4 = "Replace" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDBZ_2147915369_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDBZ!MTB"
        threat_id = "2147915369"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {91 13 08 07 09 91 11 08 61 13 09 09 18 58 17 59 08 5d 13 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXI_2147915507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXI!MTB"
        threat_id = "2147915507"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {07 09 91 11 ?? 61 13 ?? 09 1b 58 1a 59 08 5d 18 58 18 59}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXJ_2147915508_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXJ!MTB"
        threat_id = "2147915508"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "DK8E8O547GS85F8HE55ZHC" wide //weight: 2
        $x_1_2 = "GetBytes" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "Substring" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_APK_2147915522_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.APK!MTB"
        threat_id = "2147915522"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {13 35 11 12 11 35 11 20 59 61 13 12 11 20 11 12 19 58 1e 63 59 13 20}  //weight: 2, accuracy: High
        $x_2_2 = "Grafik_Sistemi.Resource1.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXK_2147915572_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXK!MTB"
        threat_id = "2147915572"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 58 08 5d [0-18] 59 20 00 01 00 00 58 20 ff 00 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOK_2147917070_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOK!MTB"
        threat_id = "2147917070"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CEPZ675RR7FP7GQ7DEZY8H" ascii //weight: 1
        $x_1_2 = {00 11 07 11 12 58 20 00 01 00 00 5d 13 13 00 11 12 17 58 13 12 11 12 19 fe 04 13 14 11 14 2d e0}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDCB_2147917193_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDCB!MTB"
        threat_id = "2147917193"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {5f 95 d2 13 16 11 14 11 16 61 13 17 11 07}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MVS_2147917670_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MVS!MTB"
        threat_id = "2147917670"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {08 06 16 06 8e 69 6f 60 00 00 0a 0d 09 28 61 00 00 0a 13 04}  //weight: 1, accuracy: High
        $x_1_2 = "2875f92c-dfc5-46f6-8d4f-c7c18ec5364b" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ARK_2147917689_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ARK!MTB"
        threat_id = "2147917689"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 04 1f 0d 5a 06 58 1f 11 5d 26 11 04 17 58 13 04 11 04 18 fe 04 13 0f 11 0f 2d e4}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ASK_2147917690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ASK!MTB"
        threat_id = "2147917690"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 91 03 06 0e 04 8e 69 5d 91 61 d2 9c 00 06 17 58 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ATK_2147917837_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ATK!MTB"
        threat_id = "2147917837"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 03 33 06 07 04 fe 01 2b 01 16 0c 08 2c 03 00 2b 01 00 07 17 58 0b 07 02 7b 0f 00 00 04 6f 38 00 00 06 fe 04 0d 09 2d d6}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMH_2147918291_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMH!MTB"
        threat_id = "2147918291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 16 13 07 2b 64 00 07 11 06 11 07 6f c9 00 00 0a 13 08 08 12 08 28 ca 00 00 0a 6f cb 00 00 0a 00 08 6f cc 00 00 0a 20 00 b8 00 00 fe 04 13 09 11 09 2c 0e 08 12 08 28 cd 00 00 0a 6f cb 00 00 0a 00 08 6f cc 00 00 0a 20 00 b8 00 00 fe 04 13 0a 11 0a 2c 0e 08 12 08 28 ce 00 00 0a 6f cb 00 00 0a 00 00 11 07 17 58 13 07 11 07 07 6f a3 00 00 0a fe 04 13 0b 11 0b 2d 8c}  //weight: 1, accuracy: High
        $x_1_2 = {16 13 06 2b 68 16 13 07 2b 53 07 11 06 11 07 6f 6a 00 00 0a 13 08 08 12 08 28 6b 00 00 0a 6f 6c 00 00 0a 08 6f 6d 00 00 0a 20 00 b8 00 00 2f 0d 08 12 08 28 6e 00 00 0a 6f 6c 00 00 0a 08 6f 6d 00 00 0a 20 00 b8 00 00 2f 0d 08 12 08 28 6f 00 00 0a 6f 6c 00 00 0a 11 07 17 58 13 07 11 07 07 6f 70 00 00 0a 32 a3}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMH_2147918291_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMH!MTB"
        threat_id = "2147918291"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Crud3CamadasMota.Properties" ascii //weight: 1
        $x_1_2 = "Crud3CamadasMota.Form1.resources" ascii //weight: 1
        $x_1_3 = "Concat" ascii //weight: 1
        $x_1_4 = "FailFast" ascii //weight: 1
        $x_1_5 = "Crud3CamadasMota.Properties.Resources.resources" ascii //weight: 1
        $x_1_6 = "IsDebuggerPresent" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AVK_2147918590_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AVK!MTB"
        threat_id = "2147918590"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {09 08 07 5d 07 58 07 5d 91 11 06 61 11 08 59 20 00 02 00 00 58 13 09 16 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AWK_2147919082_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AWK!MTB"
        threat_id = "2147919082"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {07 09 11 04 6f ?? ?? ?? 0a 13 08 08 12 08 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 11 04 17 58 13 04 00 11 04 07 6f ?? ?? ?? 0a fe 04 13 09 11 09 2d cf}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AWK_2147919082_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AWK!MTB"
        threat_id = "2147919082"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 07 17 d6 13 07 11 07 07 6f 66 00 00 0a fe 04 13 0d 11 0d 3a 51 ff ff ff}  //weight: 2, accuracy: High
        $x_2_2 = "TextBoxMaskInput.Properties.Resources.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AUK_2147919611_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AUK!MTB"
        threat_id = "2147919611"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 91 04 08 06 8e 69 5d 91 61 d2 9c 00 08 17 58 0c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_VG_2147919679_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VG!MTB"
        threat_id = "2147919679"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "EbvsOCcOBZhzqaH" wide //weight: 5
        $x_4_2 = "^^^^^M^^^^^^^^^^^^a^^^^^^^^^^^^^^i^^^^^^^^^^^^^n^^^^^^^^^" wide //weight: 4
        $x_1_3 = "Credit Card" wide //weight: 1
        $x_1_4 = "Debit Card" wide //weight: 1
        $x_1_5 = "PayPal" wide //weight: 1
        $x_1_6 = "Bank Transfer" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_5_*) and 1 of ($x_4_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Trojan_MSIL_AgentTesla_VG_2147919679_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.VG!MTB"
        threat_id = "2147919679"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BlockCopy" ascii //weight: 1
        $x_2_2 = "c94e540b48d2ff499c90c69f31e05f006" ascii //weight: 2
        $x_1_3 = "GetFilePath" ascii //weight: 1
        $x_1_4 = "DebuggingModes" ascii //weight: 1
        $x_1_5 = "EvilProgram" ascii //weight: 1
        $x_2_6 = "c859aa88665be2148355b1794611631ff" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYK_2147920468_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYK!MTB"
        threat_id = "2147920468"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {06 03 33 06 07 04 fe 01 2b 01 16 0c 08 2c 03 00 2b 01 00 07 17 58 0b 07 02 7b 0f 00 00 04 6f ?? ?? ?? 06 fe 04 0d 09 2d d6}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYK_2147920468_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYK!MTB"
        threat_id = "2147920468"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "HN.Product.resources" ascii //weight: 2
        $x_2_2 = "$c4295815-fcc4-4307-95e2-f9691bc7fbe3" ascii //weight: 2
        $x_2_3 = "EbvsOCcOBZhzqaH" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_KABS_2147920818_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.KABS!MTB"
        threat_id = "2147920818"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AukcionDBDataSet" ascii //weight: 1
        $x_1_2 = "DB_kurswork" ascii //weight: 1
        $x_1_3 = "tempuri" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SHD_2147920862_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SHD!MTB"
        threat_id = "2147920862"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 71 04 00 06 0a 09 06 6f ?? ?? ?? 0a 16 06 6f ?? ?? ?? 0a 8e 69 6f 6c 05 00 0a 06 6f ?? ?? ?? 0a 08 13 05 de 0e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXT_2147921001_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXT!MTB"
        threat_id = "2147921001"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "FuhdwhLqvwdqfh" wide //weight: 5
        $x_4_2 = "Trif32" ascii //weight: 4
        $x_3_3 = "GetType" ascii //weight: 3
        $x_2_4 = "Split" ascii //weight: 2
        $x_1_5 = "InvokeMember" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMF_2147921601_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMF!MTB"
        threat_id = "2147921601"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$3bd14160-f0b7-47bf-83f9-b0a2e7ca628e" ascii //weight: 1
        $x_1_2 = "Hadouken.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "InvokeMember" ascii //weight: 1
        $x_1_4 = "GetTypes" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDCD_2147921741_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDCD!MTB"
        threat_id = "2147921741"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {04 6f 42 00 00 0a 8e 69 5d 91 61 d2 9c 00 06 17 58 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PNE_2147921865_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PNE!MTB"
        threat_id = "2147921865"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "EbvsOCcOBZhzqaH" wide //weight: 5
        $x_2_2 = "$c4295815-fcc4-4307-95e2-f9691bc7fbe3" ascii //weight: 2
        $x_1_3 = "CreateDecryptor" ascii //weight: 1
        $x_1_4 = "RijndaelManaged" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_XVAA_2147922105_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.XVAA!MTB"
        threat_id = "2147922105"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {09 17 2f 03 16 2b 07 12 01 28 ?? 00 00 0a 13 07 09 18 2f 03 16 2b 07 12 01 28 ?? 00 00 0a 13 08 09 19 2e 03 16 2b 07 12 01 28 ?? 00 00 0a 13 09 09}  //weight: 3, accuracy: Low
        $x_2_2 = {03 11 09 d2 6f ?? 00 00 0a 00 00 00 06 17 58 0a 06 02 6f ?? 00 00 0a fe 04 13 0d 11 0d}  //weight: 2, accuracy: Low
        $x_2_3 = {02 05 06 6f ?? 00 00 0a 0b 03 6f ?? 00 00 0a 0c 04 08 59 0d 09 16 30 03 16 2b 01 17}  //weight: 2, accuracy: Low
        $x_1_4 = {02 0f 01 28 ?? 00 00 0a 6f ?? 00 00 0a 00 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMX_2147922410_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMX!MTB"
        threat_id = "2147922410"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 03 12 02 28 47 00 00 0a 6f 48 00 00 0a 00 03 12 02 28 49 00 00 0a 6f 48 00 00 0a 00 03 12 02 28 4a 00 00 0a 6f 48 00 00 0a 00 2b 15 03 6f 4b 00 00 0a 19 58 04 31 03 16 2b 01 17 13 04 11 04 2d be}  //weight: 1, accuracy: High
        $x_1_2 = "GetPixel" ascii //weight: 1
        $x_1_3 = "Bitmap" ascii //weight: 1
        $x_1_4 = "ConnectFour.Kassa.NieuweKlant.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_YRAA_2147922652_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.YRAA!MTB"
        threat_id = "2147922652"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {02 06 07 6f ?? 00 00 0a 0c 2b 29 03 12 02 28 ?? 00 00 0a 6f ?? 00 00 0a 03 12 02 28 ?? 00 00 0a 6f ?? 00 00 0a 03 12 02 28 ?? 00 00 0a 6f ?? 00 00 0a 2b 0b 03 6f ?? 00 00 0a 19 58 04 31 cc}  //weight: 3, accuracy: Low
        $x_2_2 = {03 12 02 28 ?? 00 00 0a 6f ?? 00 00 0a 03 12 02 28 ?? 00 00 0a 6f ?? 00 00 0a 03 12 02 28 ?? 00 00 0a 6f ?? 00 00 0a 07 17 58 0b}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDCE_2147923232_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDCE!MTB"
        threat_id = "2147923232"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {28 0e 00 00 0a 02 28 0b 00 00 0a 75 01 00 00 1b 6f 0f 00 00 0a 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PPPW_2147923246_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PPPW!MTB"
        threat_id = "2147923246"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {11 04 08 09 6f ?? 00 00 0a 13 05 73 63 00 00 0a 13 06 11 06 11 05 17 73 64 00 00 0a 13 07 11 07 06 16 06 8e 69 6f ?? 00 00 0a 11 06 6f ?? 00 00 0a 0a dd 0f 00 00 00 11 07 39 07 00 00 00 11 07}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDCF_2147923341_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDCF!MTB"
        threat_id = "2147923341"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {11 04 6f 87 00 00 0a 13 08 11 08 02 16 02 8e 69 6f 88 00 00 0a 0a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AZK_2147923503_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AZK!MTB"
        threat_id = "2147923503"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {2b 0b 72 01 00 00 70 2b 07 2b 0c de 1a 07 2b f2 6f 0f 00 00 0a 2b f2 0a 2b f1}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXU_2147923611_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXU!MTB"
        threat_id = "2147923611"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "SqlrDY4QZCf51NjTiw" ascii //weight: 3
        $x_2_2 = "GB-lesson-forms.g.resource" ascii //weight: 2
        $x_1_3 = "lD7NR7KGwKf9iMaTfy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SYI_2147923749_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SYI!MTB"
        threat_id = "2147923749"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 06 17 58 20 ff 00 00 00 5f 13 06 11 07 09 11 06 95 58 20 ff 00 00 00 5f 13 07 02 09 11 06 8f 62 00 00 01 09 11 07 8f 62 00 00 01 28 80 00 00 06 09 11 06 95 09 11 07 95 58 20 ff 00 00 00 5f 13 0a 11 04 13 0b 06 11 0b 91 09 11 0a 95 13 0c 11 0c 61 13 0d 08 11 0b 11 0d d2 9c 11 04 17 58 13 04 11 04 6e 08 8e 69 6a 32 95}  //weight: 1, accuracy: High
        $x_1_2 = "8KAJ4CCOHA7F5A8YG785RO" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PHHZ_2147924032_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PHHZ!MTB"
        threat_id = "2147924032"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {17 fe 02 13 06 11 06 2c 0e 03 12 02 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 09 18 fe 02 13 07 11 07 2c 0e 03 12 02 28 ?? ?? ?? 0a 6f ?? ?? ?? 0a 00 00 03 6f ?? ?? ?? 0a 04 fe 04 16 fe 01 13 08}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PHPH_2147924033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PHPH!MTB"
        threat_id = "2147924033"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {02 06 07 6f ?? ?? ?? 0a 0c 04 03 6f ?? ?? ?? 0a 59 0d 09 19 fe 04 16 fe 01 13 05 11 05 2c 2f 00 03 19 8d 8f 00 00 01 25 16 12 02 28 ?? ?? ?? 0a 9c 25 17 12 02 28 ?? ?? ?? 0a 9c 25 18 12 02}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SIU_2147924087_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SIU!MTB"
        threat_id = "2147924087"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$0dec1f88-67e1-4b9c-a4cf-06a910412ed2" ascii //weight: 1
        $x_1_2 = "https://playstoremeta.com/wp-includes/Lwsgu.dat" ascii //weight: 1
        $x_1_3 = "Fyqcteret.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RVGU01_2147924271_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RVGU01!MTB"
        threat_id = "2147924271"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "7822083e-8a04-4b77-8e23-cf6478ea2409" ascii //weight: 1
        $x_1_2 = "MenuTry" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RVHR01_2147924272_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RVHR01!MTB"
        threat_id = "2147924272"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {11 0a 11 0e 59 20 00 02 00 00 58 20 00 01 00 00 5d 20 00 04 00 00 58 20 00 02 00 00 5d 20 00 01 00 00 59 20 00 04 00 00 58 20 ff 00 00 00 5f 20 ff 00 00 00 5f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADK_2147924275_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADK!MTB"
        threat_id = "2147924275"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {03 19 8d 5b 00 00 01 25 16 12 02 28 72 00 00 0a 9c 25 17 12 02 28 73 00 00 0a 9c 25 18 12 02 28 74 00 00 0a 9c}  //weight: 2, accuracy: High
        $x_2_2 = "ResumesApp.Properties.Resources.resources" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_ADK_2147924275_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.ADK!MTB"
        threat_id = "2147924275"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "0A3BCD28110C10DA9247838F4ED4A079D0C97DCF59F0CCEED10721E237EED484" ascii //weight: 1
        $x_1_2 = "EP1_Restaurante.Properties" ascii //weight: 1
        $x_1_3 = "$43a3b22b-f558-489a-ba21-72e55cd6fb99" ascii //weight: 1
        $x_1_4 = "485F4H84GH5G42CBS7H594x" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PNGH_2147924418_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PNGH!MTB"
        threat_id = "2147924418"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {02 06 07 28 ?? 00 00 06 0c 04 03 6f ?? 00 00 0a 59 0d 09 19 fe 04 16 fe 01 13 04 11 04 2c 2f 00 03 19 8d ?? 00 00 01 25 16 12 02 28 ?? 00 00 0a 9c 25 17 12 02 28 ?? 00 00 0a 9c 25 18 12 02 28 ?? 00 00 0a 9c 6f ?? 00 00 0a}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBXW_2147925129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBXW!MTB"
        threat_id = "2147925129"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {a7 00 a9 00 71 00 51 00 84 25 84 25 4d 00 84 25 84 25 84 25 84 25 45 00 84 25 84 25 84 25 84 25 2f 00 2f 00 38 00 84 25 84 25 4c 00 67 00 84 25 84 25 84 25 84 25 84 25 84 25 84 25 84 25}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBWA_2147925821_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBWA!MTB"
        threat_id = "2147925821"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {4b 53 41 00 6b 65 79 00 73 74 61 74 65 41 72 72 61 79 00 55 49 6e 74 33 32 00 50 72 6f 63 65 73 73 53 74 61 74 65 00 69 00 6a 00 49 6e 69 74 69 61 6c 69 7a 65 53 74 61 74 65 41 72 72 61 79 00 53 77 61 70}  //weight: 2, accuracy: High
        $x_1_2 = "8D1D-42EA-963D-48332A5643FC" ascii //weight: 1
        $x_1_3 = "erpsys" ascii //weight: 1
        $x_1_4 = "SmashOverlayGeneratorWebServiceLib" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RDCG_2147926069_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RDCG!MTB"
        threat_id = "2147926069"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {16 0f 01 28 8a 00 00 0a 9c 25 17 0f 01 28 8b 00 00 0a 9c 25 18 0f 01 28 8c 00 00 0a 9c}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PMUH_2147926205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PMUH!MTB"
        threat_id = "2147926205"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {13 04 16 13 05 38 1d 00 00 00 11 04 09 11 05 18 6f ?? 00 00 0a 1f 10 28 ?? 00 00 0a 6f ?? 00 00 0a 11 05 18 58 13 05 11 05 09 6f ?? 00 00 0a 32 d9}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_CCJN_2147926383_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.CCJN!MTB"
        threat_id = "2147926383"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {11 04 11 05 95 11 04 11 06 95 58 20 ?? ?? ?? ?? 5f 13 0b 11 09 11 0a 61 1f 2d 60 13 0c 11 09 1f 32 31 04 11 0c 13 09 11 0b 1f 7b 61 20 ?? ?? ?? ?? 5f 20 ?? ?? ?? ?? 58 20 ?? ?? ?? ?? 5e 26 09 11 07 07 11 07 91 11 04 11 0b 95 61}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SKI_2147927234_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SKI!MTB"
        threat_id = "2147927234"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {25 16 12 00 28 ?? 00 00 0a 9c 25 17 12 00 28 ?? 00 00 0a 9c 25 18 12 00 28 ?? 00 00 0a 9c 07 28}  //weight: 1, accuracy: Low
        $x_1_2 = "BloodBank.Properties.Resources.resources" ascii //weight: 1
        $x_1_3 = "BloodBank.Records.resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBWD_2147927367_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBWD!MTB"
        threat_id = "2147927367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {02 06 07 6f ?? 00 00 0a 0c 04 03 6f ?? 00 00 0a 59 0d 09 13 ?? 11 ?? 19 32}  //weight: 2, accuracy: Low
        $x_1_2 = {4c 00 6f 00 61 00 64}  //weight: 1, accuracy: High
        $x_1_3 = {79 00 73 00 74 00 65 00 6d 00 2e 00 41 00 63 00 74 00 69 00 76 00 61 00 74}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBWD_2147927367_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBWD!MTB"
        threat_id = "2147927367"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {60 0c 03 19 8d ?? ?? ?? 01 25 16 08 1f 10 63 20 ?? 00 00 00 5f d2 9c 25 17 08 1e}  //weight: 2, accuracy: Low
        $x_1_2 = "Kviskoteka.Properties" ascii //weight: 1
        $x_1_3 = "GetExportedTypes" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SMG_2147927921_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SMG!MTB"
        threat_id = "2147927921"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {73 53 00 00 06 0a 06 02 7d a3 00 00 04 00 16 06 7b a3 00 00 04 6f 54 00 00 0a 18 5b 28 55 00 00 0a 06 fe 06 54 00 00 06 73 56 00 00 0a 28 02 00 00 2b 28 03 00 00 2b 0b 2b 00 07 2a}  //weight: 1, accuracy: High
        $x_1_2 = "$a942b728-fc5d-4cc6-bbe8-e908af1c2113" ascii //weight: 1
        $x_1_3 = "4D5A900003~~04~~" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RVKA_2147927997_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RVKA!MTB"
        threat_id = "2147927997"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 29 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 88 00 00 00 14 00 00 00 f9 00 00 00 83 00 00 00 8a 00 00 00 fa 00 00 00 18 00 00 00 01 00 00 00 1e 00 00 00 03 00 00 00 07 00 00 00 0a 00 00 00 04 00 00 00 01 00 00 00 01 00 00 00 07 00 00 00 0e 00 00 00 02 00 00 00 04}  //weight: 1, accuracy: High
        $x_1_2 = "0ece043f-946a-421a-8aab-a0ce459fca30" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RVKB_2147928097_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RVKB!MTB"
        threat_id = "2147928097"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 95 a2 29 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 5e 00 00 00 10 00 00 00 3a 00 00 00 35 00 00 00 2e 00 00 00 91 00 00 00 1c 00 00 00 01 00 00 00 0a 00 00 00 03 00 00 00 06 00 00 00 09 00 00 00 04 00 00 00 02 00 00 00 01 00 00 00 06 00 00 00 04 00 00 00 06 00 00 00 01}  //weight: 1, accuracy: High
        $x_1_2 = "db2760e0-0028-4e8e-94b2-e26e364fa931" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RVKD_2147928983_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RVKD!MTB"
        threat_id = "2147928983"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 1f b6 09 09 0b 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 e0 00 00 00 17 00 00 00 59 00 00 00 cf 00 00 00 c9 00 00 00 01 00 00 00 83 01 00 00 02 00 00 00 38 01 00 00 4a 00 00 00 01 00 00 00 04 00 00 00 09 00 00 00 22 00 00 00 37 00 00 00 0d 00 00 00 01 00 00 00 0a 00 00 00 07 00 00 00 07 00 00 00 06}  //weight: 1, accuracy: High
        $x_1_2 = "kursachForAxl" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_RVKD_2147928983_1
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.RVKD!MTB"
        threat_id = "2147928983"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {57 9f a2 29 09 03 00 00 00 fa 01 33 00 16 00 00 01 00 00 00 a5 00 00 00 17 00 00 00 64 00 00 00 78 00 00 00 90 00 00 00 01 00 00 00 39 01 00 00 0a 00 00 00 48 00 00 00 04 00 00 00 29 00 00 00 06 00 00 00 14 00 00 00 21 00 00 00 0b 00 00 00 05 00 00 00 01 00 00 00 04 00 00 00 04 00 00 00 0c}  //weight: 1, accuracy: High
        $x_1_2 = "4e9d0520-cfc6-476b-9ef2-8ae902ca2cf9" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PLLPH_2147930319_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PLLPH!MTB"
        threat_id = "2147930319"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {06 2c 54 00 0f 01 28 ?? 00 00 0a 1f 10 62 0f 01 28 ?? 00 00 0a 1e 62 60 0f 01 28 ?? 00 00 0a 60 0b 02 19 8d ?? 00 00 01 25 16 07 1f 10 63 20 ?? 00 00 00 5f d2 9c 25 17 07 1e 63}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SOB_2147931434_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SOB!MTB"
        threat_id = "2147931434"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {08 20 ee 83 00 00 28 ?? ?? ?? 06 28 02 00 00 0a 6f 04 00 00 0a 08 6f 05 00 00 0a 0d 28 06 00 00 0a 09 07 16 07 8e 69 6f 07 00 00 0a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_MBWQ_2147931703_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.MBWQ!MTB"
        threat_id = "2147931703"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {0a 0b 1f 10 8d ?? 00 00 01 0c 07 08 6f ?? 00 00 0a 00 02 03 04 6f ?? 00 00 0a 0d de 0b}  //weight: 2, accuracy: Low
        $x_1_2 = "CreateInstance" wide //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCB_2147931928_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCB!MTB"
        threat_id = "2147931928"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {06 02 08 18 6f 17 00 00 0a 1f 10 28 18 00 00 0a 28 19 00 00 0a 6f 1a 00 00 0a 26 08 18 d6 0c 08 07 31 dd}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SWA_2147932321_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SWA!MTB"
        threat_id = "2147932321"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {00 03 07 20 ef be ad de 28 4d 00 00 06 0c 02 08 7e 40 00 00 04 07 19 5f 94 23 18 2d 44 54 fb 21 09 40 28 4a 00 00 06 00 00 07 17 58 0b 07 06 20 cd ab 34 12 6a 28 4c 00 00 06 0d 09 2d c2}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SWB_2147932322_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SWB!MTB"
        threat_id = "2147932322"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {7e 94 03 00 04 28 73 06 00 0a 7e 95 03 00 04 2c 03 17 2b 03 16 2b 00 2d 1c 28 01 00 00 0a 14 fe 06 5e 06 00 06 73 74 06 00 0a 6f 75 06 00 0a 17 80 95 03 00 04 de 0b 7e 94 03 00 04 28 76 06 00 0a dc}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCO_2147934272_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCO!MTB"
        threat_id = "2147934272"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {11 05 11 08 09 06 11 08 58 93 11 06 11 08 07 58 11 07 5d 93 61 d1 9d 1f 0c 13 09 38 1f ff ff ff}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_EAQU_2147934438_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.EAQU!MTB"
        threat_id = "2147934438"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {09 08 11 04 18 6f 0b 00 00 0a 1f 10 28 0c 00 00 0a 6f 0d 00 00 0a 11 04 18 58 13 04 11 04 08 6f 0e 00 00 0a 32 da}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SLO_2147934537_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SLO!MTB"
        threat_id = "2147934537"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 09 a3 06 00 00 1b 13 04 11 04 16 06 07 11 04 8e 69 28 3c 00 00 0a 07 11 04 8e 69 58 0b 09 17 58 0d 09 08 8e 69 32 d8}  //weight: 2, accuracy: High
        $x_1_2 = "$ebe193fb-e7d0-4af4-a953-4bf26986147b" ascii //weight: 1
        $x_1_3 = "Vfuqzohod.Properties" ascii //weight: 1
        $x_1_4 = "Dpjjxen" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SLP_2147934668_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SLP!MTB"
        threat_id = "2147934668"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {02 11 04 1e 6f 78 00 00 0a 13 05 11 05 18 28 ec 00 00 0a 13 06 11 06 28 ed 00 00 0a 13 07 07 11 07 6f ee 00 00 0a 26 11 04 1e d6 13 04 11 04 09 31 ce}  //weight: 1, accuracy: High
        $x_1_2 = "ListNobifex.Resources" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_AYA_2147935294_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.AYA!MTB"
        threat_id = "2147935294"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "$4a2f8fb6-1077-469a-9246-736e6afe8da1" ascii //weight: 2
        $x_2_2 = "AddRootkit" ascii //weight: 2
        $x_1_3 = "isVM_by_wim_temper" ascii //weight: 1
        $x_1_4 = "Client.Helper" ascii //weight: 1
        $x_1_5 = "EnvironmentDetected" ascii //weight: 1
        $x_1_6 = "RunAntiAnalysis" ascii //weight: 1
        $x_1_7 = "RemoveFileSecurity" ascii //weight: 1
        $x_1_8 = "DecodEncod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCJ_2147935600_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCJ!MTB"
        threat_id = "2147935600"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {02 28 09 00 00 06 ?? ?? 6f 0f 00 00 0a 28 10 00 00 0a ?? ?? 17 d6 8d 11 00 00 01 ?? ?? ?? ?? ?? 6f 11 00 00 0a 26 ?? 6f 12 00 00 0a ?? 0c 2b 00 08 2a}  //weight: 5, accuracy: Low
        $x_2_2 = "%filesStrings%" ascii //weight: 2
        $x_2_3 = "GetFolderPath" ascii //weight: 2
        $x_2_4 = "CreateInstance" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCK_2147935602_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCK!MTB"
        threat_id = "2147935602"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_5_1 = {00 02 17 da 17 d6 8d 01 00 00 01 0a 2b 00 06 2a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_NCR_2147935616_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.NCR!MTB"
        threat_id = "2147935616"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_4_1 = {08 09 a3 05 00 00 1b 13 04 11 04 16 06 07 11 04 8e 69 28 1b 00 00 0a 07 11 04 8e 69 58 0b 09 17 58 0d 09 08 8e 69 32 d8}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SWC_2147935629_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SWC!MTB"
        threat_id = "2147935629"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {02 14 7d 05 00 00 04 02 28 36 00 00 0a 00 00 28 0d 00 00 06 74 03 00 00 01 28 37 00 00 0a 26 02 28 27 00 00 06 00 2a}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_PKZM_2147935795_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.PKZM!MTB"
        threat_id = "2147935795"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {73 3c 00 00 0a 72 15 00 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 6f ?? 00 00 0a 0b 17}  //weight: 3, accuracy: Low
        $x_2_2 = {43 00 00 0a 0c 08 06 6f ?? 00 00 0a 08 07 6f ?? 00 00 0a 08 6f ?? 00 00 0a 0d 73 47 00 00 0a 25 09 03 16 03 8e 69 6f ?? 00 00 0a 6f ?? 00 00 0a 13 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Trojan_MSIL_AgentTesla_SLH_2147935819_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/AgentTesla.SLH!MTB"
        threat_id = "2147935819"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "AgentTesla"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_2_1 = {08 09 a3 06 00 00 1b 13 04 11 04 16 06 07 11 04 8e 69 28 3c 00 00 0a 07 11 04 8e 69 58 0b 09 17 58 0d 09 08 8e 69 32 d8}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

